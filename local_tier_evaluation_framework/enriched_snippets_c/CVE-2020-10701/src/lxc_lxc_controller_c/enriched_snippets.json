[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2496-2771",
    "snippet": "int main(int argc, char *argv[])\n{\n    pid_t pid;\n    int rc = -1;\n    const char *name = NULL;\n    size_t nveths = 0;\n    char **veths = NULL;\n    int ns_fd[VIR_LXC_DOMAIN_NAMESPACE_LAST];\n    int handshakeFd = -1;\n    bool bg = false;\n    const struct option options[] = {\n        { \"background\", 0, NULL, 'b' },\n        { \"name\",   1, NULL, 'n' },\n        { \"veth\",   1, NULL, 'v' },\n        { \"console\", 1, NULL, 'c' },\n        { \"passfd\", 1, NULL, 'p' },\n        { \"handshakefd\", 1, NULL, 's' },\n        { \"security\", 1, NULL, 'S' },\n        { \"share-net\", 1, NULL, 'N' },\n        { \"share-ipc\", 1, NULL, 'I' },\n        { \"share-uts\", 1, NULL, 'U' },\n        { \"help\", 0, NULL, 'h' },\n        { 0, 0, 0, 0 },\n    };\n    int *ttyFDs = NULL;\n    size_t nttyFDs = 0;\n    int *passFDs = NULL;\n    size_t npassFDs = 0;\n    virLXCControllerPtr ctrl = NULL;\n    size_t i;\n    const char *securityDriver = \"none\";\n\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n        ns_fd[i] = -1;\n\n    if (virGettextInitialize() < 0 ||\n        virErrorInitialize() < 0) {\n        fprintf(stderr, _(\"%s: initialization failed\\n\"), argv[0]);\n        exit(EXIT_FAILURE);\n    }\n\n    /* Initialize logging */\n    virLogSetFromEnv();\n\n    while (1) {\n        int c;\n\n        c = getopt_long(argc, argv, \"dn:v:p:m:c:s:h:S:N:I:U:\",\n                        options, NULL);\n\n        if (c == -1)\n            break;\n\n        switch (c) {\n        case 'b':\n            bg = true;\n            break;\n\n        case 'n':\n            name = optarg;\n            break;\n\n        case 'v':\n            if (VIR_REALLOC_N(veths, nveths+1) < 0)\n                goto cleanup;\n            veths[nveths++] = g_strdup(optarg);\n            break;\n\n        case 'c':\n            if (VIR_REALLOC_N(ttyFDs, nttyFDs + 1) < 0)\n                goto cleanup;\n            if (virStrToLong_i(optarg, NULL, 10, &ttyFDs[nttyFDs++]) < 0) {\n                fprintf(stderr, \"malformed --console argument '%s'\", optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'p':\n            if (VIR_REALLOC_N(passFDs, npassFDs + 1) < 0)\n                goto cleanup;\n            if (virStrToLong_i(optarg, NULL, 10, &passFDs[npassFDs++]) < 0) {\n                fprintf(stderr, \"malformed --passfd argument '%s'\", optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 's':\n            if (virStrToLong_i(optarg, NULL, 10, &handshakeFd) < 0) {\n                fprintf(stderr, \"malformed --handshakefd argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'N':\n            if (virStrToLong_i(optarg, NULL, 10, &ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHARENET]) < 0) {\n                fprintf(stderr, \"malformed --share-net argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'I':\n            if (virStrToLong_i(optarg, NULL, 10, &ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHAREIPC]) < 0) {\n                fprintf(stderr, \"malformed --share-ipc argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'U':\n            if (virStrToLong_i(optarg, NULL, 10, &ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS]) < 0) {\n                fprintf(stderr, \"malformed --share-uts argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'S':\n            securityDriver = optarg;\n            break;\n\n        case 'h':\n        case '?':\n            fprintf(stderr, \"\\n\");\n            fprintf(stderr, \"syntax: %s [OPTIONS]\\n\", argv[0]);\n            fprintf(stderr, \"\\n\");\n            fprintf(stderr, \"Options\\n\");\n            fprintf(stderr, \"\\n\");\n            fprintf(stderr, \"  -b, --background\\n\");\n            fprintf(stderr, \"  -n NAME, --name NAME\\n\");\n            fprintf(stderr, \"  -c FD, --console FD\\n\");\n            fprintf(stderr, \"  -v VETH, --veth VETH\\n\");\n            fprintf(stderr, \"  -s FD, --handshakefd FD\\n\");\n            fprintf(stderr, \"  -S NAME, --security NAME\\n\");\n            fprintf(stderr, \"  -N FD, --share-net FD\\n\");\n            fprintf(stderr, \"  -I FD, --share-ipc FD\\n\");\n            fprintf(stderr, \"  -U FD, --share-uts FD\\n\");\n            fprintf(stderr, \"  -h, --help\\n\");\n            fprintf(stderr, \"\\n\");\n            rc = 0;\n            goto cleanup;\n        }\n    }\n\n    if (name == NULL) {\n        fprintf(stderr, \"%s: missing --name argument for configuration\\n\", argv[0]);\n        goto cleanup;\n    }\n\n    if (handshakeFd < 0) {\n        fprintf(stderr, \"%s: missing --handshakefd argument for container PTY\\n\",\n                argv[0]);\n        goto cleanup;\n    }\n\n    if (geteuid() != 0) {\n        fprintf(stderr, \"%s: must be run as the 'root' user\\n\", argv[0]);\n        goto cleanup;\n    }\n\n    virEventRegisterDefaultImpl();\n\n    virDBusSetSharedBus(false);\n\n    if (!(ctrl = virLXCControllerNew(name)))\n        goto cleanup;\n\n    ctrl->handshakeFd = handshakeFd;\n\n    if (!(ctrl->securityManager = virSecurityManagerNew(securityDriver,\n                                                        LXC_DRIVER_NAME, 0)))\n        goto cleanup;\n\n    if (ctrl->def->seclabels) {\n        VIR_DEBUG(\"Security model %s type %s label %s imagelabel %s\",\n                  NULLSTR(ctrl->def->seclabels[0]->model),\n                  virDomainSeclabelTypeToString(ctrl->def->seclabels[0]->type),\n                  NULLSTR(ctrl->def->seclabels[0]->label),\n                  NULLSTR(ctrl->def->seclabels[0]->imagelabel));\n    } else {\n        VIR_DEBUG(\"Security model not initialized\");\n    }\n\n    ctrl->veths = veths;\n    ctrl->nveths = nveths;\n\n    ctrl->passFDs = passFDs;\n    ctrl->npassFDs = npassFDs;\n\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++) {\n        if (ns_fd[i] != -1) {\n            if (!ctrl->nsFDs) {/*allocate only once */\n                size_t j = 0;\n                if (VIR_ALLOC_N(ctrl->nsFDs, VIR_LXC_DOMAIN_NAMESPACE_LAST) < 0)\n                    goto cleanup;\n                for (j = 0; j < VIR_LXC_DOMAIN_NAMESPACE_LAST; j++)\n                    ctrl->nsFDs[j] = -1;\n            }\n            ctrl->nsFDs[i] = ns_fd[i];\n        }\n    }\n\n    for (i = 0; i < nttyFDs; i++) {\n        if (virLXCControllerAddConsole(ctrl, ttyFDs[i]) < 0)\n            goto cleanup;\n        ttyFDs[i] = -1;\n    }\n\n    if (virLXCControllerValidateNICs(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerGetNICIndexes(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerValidateConsoles(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupServer(ctrl) < 0)\n        goto cleanup;\n\n    if (bg) {\n        if ((pid = fork()) < 0)\n            goto cleanup;\n\n        if (pid > 0) {\n            if ((rc = virPidFileWrite(LXC_STATE_DIR, name, pid)) < 0) {\n                virReportSystemError(-rc,\n                                     _(\"Unable to write pid file '%s/%s.pid'\"),\n                                     LXC_STATE_DIR, name);\n                _exit(1);\n            }\n\n            /* First child now exits, allowing original caller\n             * (ie libvirtd's LXC driver to complete their\n             * waitpid & continue */\n            _exit(0);\n        }\n\n        /* Don't hold on to any cwd we inherit from libvirtd either */\n        if (chdir(\"/\") < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to change to root dir\"));\n            goto cleanup;\n        }\n\n        if (setsid() < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to become session leader\"));\n            goto cleanup;\n        }\n    }\n\n    rc = virLXCControllerRun(ctrl);\n\n cleanup:\n    if (rc < 0) {\n        fprintf(stderr,\n                _(\"Failure in libvirt_lxc startup: %s\\n\"),\n                virGetLastErrorMessage());\n    }\n\n    virPidFileDelete(LXC_STATE_DIR, name);\n    if (ctrl)\n        virLXCControllerDeleteInterfaces(ctrl);\n    for (i = 0; i < nttyFDs; i++)\n        VIR_FORCE_CLOSE(ttyFDs[i]);\n    VIR_FREE(ttyFDs);\n    for (i = 0; i < npassFDs; i++)\n        VIR_FORCE_CLOSE(passFDs[i]);\n    VIR_FREE(passFDs);\n\n    virLXCControllerFree(ctrl);\n\n    return rc < 0? EXIT_FAILURE : EXIT_SUCCESS;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerFree",
          "args": [
            "ctrl"
          ],
          "line": 2768
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "279-322",
          "snippet": "static void virLXCControllerFree(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    if (!ctrl)\n        return;\n\n    virLXCControllerStopInit(ctrl);\n\n    virObjectUnref(ctrl->securityManager);\n\n    for (i = 0; i < ctrl->nveths; i++)\n        VIR_FREE(ctrl->veths[i]);\n    VIR_FREE(ctrl->veths);\n    VIR_FREE(ctrl->nicindexes);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n    VIR_FREE(ctrl->passFDs);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n    VIR_FREE(ctrl->consoles);\n\n    VIR_FREE(ctrl->devptmx);\n\n    virDomainObjEndAPI(&ctrl->vm);\n    VIR_FREE(ctrl->name);\n\n    if (ctrl->timerShutdown != -1)\n        virEventRemoveTimeout(ctrl->timerShutdown);\n\n    virObjectUnref(ctrl->daemon);\n    virLXCControllerFreeFuse(ctrl);\n\n    VIR_FREE(ctrl->nbdpids);\n\n    VIR_FREE(ctrl->nsFDs);\n    virCgroupFree(&ctrl->cgroup);\n\n    /* This must always be the last thing to be closed */\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    VIR_FREE(ctrl);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    if (!ctrl)\n        return;\n\n    virLXCControllerStopInit(ctrl);\n\n    virObjectUnref(ctrl->securityManager);\n\n    for (i = 0; i < ctrl->nveths; i++)\n        VIR_FREE(ctrl->veths[i]);\n    VIR_FREE(ctrl->veths);\n    VIR_FREE(ctrl->nicindexes);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n    VIR_FREE(ctrl->passFDs);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n    VIR_FREE(ctrl->consoles);\n\n    VIR_FREE(ctrl->devptmx);\n\n    virDomainObjEndAPI(&ctrl->vm);\n    VIR_FREE(ctrl->name);\n\n    if (ctrl->timerShutdown != -1)\n        virEventRemoveTimeout(ctrl->timerShutdown);\n\n    virObjectUnref(ctrl->daemon);\n    virLXCControllerFreeFuse(ctrl);\n\n    VIR_FREE(ctrl->nbdpids);\n\n    VIR_FREE(ctrl->nsFDs);\n    virCgroupFree(&ctrl->cgroup);\n\n    /* This must always be the last thing to be closed */\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    VIR_FREE(ctrl);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "passFDs"
          ],
          "line": 2766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "passFDs[i]"
          ],
          "line": 2765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ttyFDs"
          ],
          "line": 2763
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ttyFDs[i]"
          ],
          "line": 2762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerDeleteInterfaces",
          "args": [
            "ctrl"
          ],
          "line": 2760
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerDeleteInterfaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2050-2061",
          "snippet": "static int virLXCControllerDeleteInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    int ret = 0;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevVethDelete(ctrl->veths[i]) < 0)\n            ret = -1;\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerDeleteInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    int ret = 0;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevVethDelete(ctrl->veths[i]) < 0)\n            ret = -1;\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPidFileDelete",
          "args": [
            "LXC_STATE_DIR",
            "name"
          ],
          "line": 2758
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileDelete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "316-328",
          "snippet": "int virPidFileDelete(const char *dir,\n                     const char *name)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileDeletePath(pidfile);\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileDelete(const char *dir,\n                     const char *name)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileDeletePath(pidfile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"Failure in libvirt_lxc startup: %s\\n\")",
            "virGetLastErrorMessage()"
          ],
          "line": 2753
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetLastErrorMessage",
          "args": [],
          "line": 2755
        },
        "resolved": true,
        "details": {
          "function_name": "virGetLastErrorMessage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "316-325",
          "snippet": "const char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nconst char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failure in libvirt_lxc startup: %s\\n\""
          ],
          "line": 2754
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerRun",
          "args": [
            "ctrl"
          ],
          "line": 2749
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2356-2493",
          "snippet": "static int\nvirLXCControllerRun(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    int control[2] = { -1, -1};\n    int containerhandshake[2] = { -1, -1 };\n    char **containerTTYPaths = NULL;\n    size_t i;\n\n    if (VIR_ALLOC_N(containerTTYPaths, ctrl->nconsoles) < 0)\n        goto cleanup;\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, control) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sockpair failed\"));\n        goto cleanup;\n    }\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, containerhandshake) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"socketpair failed\"));\n        goto cleanup;\n    }\n\n    if (virLXCControllerSetupPrivateNS() < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupLoopDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupResourceLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupDevPTS(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerPopulateDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupTimers(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllDisks(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllHostdevs(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupConsoles(ctrl, containerTTYPaths) < 0)\n        goto cleanup;\n\n    if (lxcSetPersonality(ctrl->def) < 0)\n        goto cleanup;\n\n    if ((ctrl->initpid = lxcContainerStart(ctrl->def,\n                                           ctrl->securityManager,\n                                           ctrl->nveths,\n                                           ctrl->veths,\n                                           ctrl->npassFDs,\n                                           ctrl->passFDs,\n                                           control[1],\n                                           containerhandshake[1],\n                                           ctrl->nsFDs,\n                                           ctrl->nconsoles,\n                                           containerTTYPaths)) < 0)\n        goto cleanup;\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n\n    if (ctrl->nsFDs)\n        for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n            VIR_FORCE_CLOSE(ctrl->nsFDs[i]);\n\n    if (virLXCControllerSetupCgroupLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupUserns(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerMoveInterfaces(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerStartFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (lxcContainerSendContinue(control[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to send container continue message\"));\n        goto cleanup;\n    }\n\n    if (lxcContainerWaitForContinue(containerhandshake[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error receiving signal from container\"));\n        goto cleanup;\n    }\n\n    /* ...and reduce our privileges */\n    if (lxcControllerClearCapabilities() < 0)\n        goto cleanup;\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        if (virLXCControllerConsoleSetNonblocking(&(ctrl->consoles[i])) < 0)\n            goto cleanup;\n\n    if (virLXCControllerDaemonHandshake(ctrl) < 0)\n        goto cleanup;\n\n    /* We must not hold open a dbus connection for life\n     * of LXC instance, since dbus-daemon is limited to\n     * only a few 100 connections by default\n     */\n    virDBusCloseSystemBus();\n\n    rc = virLXCControllerMain(ctrl);\n\n    virLXCControllerEventSendExit(ctrl, rc);\n\n cleanup:\n    VIR_FORCE_CLOSE(control[0]);\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[0]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        VIR_FREE(containerTTYPaths[i]);\n    VIR_FREE(containerTTYPaths);\n\n    virLXCControllerStopInit(ctrl);\n\n    return rc;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int\nvirLXCControllerRun(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    int control[2] = { -1, -1};\n    int containerhandshake[2] = { -1, -1 };\n    char **containerTTYPaths = NULL;\n    size_t i;\n\n    if (VIR_ALLOC_N(containerTTYPaths, ctrl->nconsoles) < 0)\n        goto cleanup;\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, control) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sockpair failed\"));\n        goto cleanup;\n    }\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, containerhandshake) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"socketpair failed\"));\n        goto cleanup;\n    }\n\n    if (virLXCControllerSetupPrivateNS() < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupLoopDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupResourceLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupDevPTS(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerPopulateDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupTimers(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllDisks(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllHostdevs(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupConsoles(ctrl, containerTTYPaths) < 0)\n        goto cleanup;\n\n    if (lxcSetPersonality(ctrl->def) < 0)\n        goto cleanup;\n\n    if ((ctrl->initpid = lxcContainerStart(ctrl->def,\n                                           ctrl->securityManager,\n                                           ctrl->nveths,\n                                           ctrl->veths,\n                                           ctrl->npassFDs,\n                                           ctrl->passFDs,\n                                           control[1],\n                                           containerhandshake[1],\n                                           ctrl->nsFDs,\n                                           ctrl->nconsoles,\n                                           containerTTYPaths)) < 0)\n        goto cleanup;\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n\n    if (ctrl->nsFDs)\n        for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n            VIR_FORCE_CLOSE(ctrl->nsFDs[i]);\n\n    if (virLXCControllerSetupCgroupLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupUserns(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerMoveInterfaces(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerStartFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (lxcContainerSendContinue(control[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to send container continue message\"));\n        goto cleanup;\n    }\n\n    if (lxcContainerWaitForContinue(containerhandshake[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error receiving signal from container\"));\n        goto cleanup;\n    }\n\n    /* ...and reduce our privileges */\n    if (lxcControllerClearCapabilities() < 0)\n        goto cleanup;\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        if (virLXCControllerConsoleSetNonblocking(&(ctrl->consoles[i])) < 0)\n            goto cleanup;\n\n    if (virLXCControllerDaemonHandshake(ctrl) < 0)\n        goto cleanup;\n\n    /* We must not hold open a dbus connection for life\n     * of LXC instance, since dbus-daemon is limited to\n     * only a few 100 connections by default\n     */\n    virDBusCloseSystemBus();\n\n    rc = virLXCControllerMain(ctrl);\n\n    virLXCControllerEventSendExit(ctrl, rc);\n\n cleanup:\n    VIR_FORCE_CLOSE(control[0]);\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[0]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        VIR_FREE(containerTTYPaths[i]);\n    VIR_FREE(containerTTYPaths);\n\n    virLXCControllerStopInit(ctrl);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to become session leader\")"
          ],
          "line": 2743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsid",
          "args": [],
          "line": 2742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to change to root dir\")"
          ],
          "line": 2737
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "\"/\""
          ],
          "line": 2736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "0"
          ],
          "line": 2732
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "1"
          ],
          "line": 2726
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "-rc",
            "_(\"Unable to write pid file '%s/%s.pid'\")",
            "LXC_STATE_DIR",
            "name"
          ],
          "line": 2723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPidFileWrite",
          "args": [
            "LXC_STATE_DIR",
            "name",
            "pid"
          ],
          "line": 2722
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileWrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "86-102",
          "snippet": "int virPidFileWrite(const char *dir,\n                    const char *name,\n                    pid_t pid)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (virFileMakePath(dir) < 0)\n        return -errno;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileWritePath(pidfile, pid);\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileWrite(const char *dir,\n                    const char *name,\n                    pid_t pid)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (virFileMakePath(dir) < 0)\n        return -errno;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileWritePath(pidfile, pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 2718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupServer",
          "args": [
            "ctrl"
          ],
          "line": 2714
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupServer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "956-1015",
          "snippet": "static int virLXCControllerSetupServer(virLXCControllerPtr ctrl)\n{\n    virNetServerPtr srv = NULL;\n    virNetServerServicePtr svc = NULL;\n    char *sockpath;\n\n    sockpath = g_strdup_printf(\"%s/%s.sock\", LXC_STATE_DIR, ctrl->name);\n\n    if (!(srv = virNetServerNew(\"LXC\", 1,\n                                0, 0, 0, 1,\n                                0, -1, 0,\n                                virLXCControllerClientPrivateNew,\n                                NULL,\n                                virLXCControllerClientPrivateFree,\n                                ctrl)))\n        goto error;\n\n    if (virSecurityManagerSetSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (!(svc = virNetServerServiceNewUNIX(sockpath,\n                                           0700,\n                                           0,\n                                           0,\n                                           NULL,\n                                           false,\n                                           0,\n                                           5)))\n        goto error;\n\n    if (virSecurityManagerClearSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (virNetServerAddService(srv, svc) < 0)\n        goto error;\n    virObjectUnref(svc);\n    svc = NULL;\n\n    if (!(ctrl->prog = virNetServerProgramNew(VIR_LXC_MONITOR_PROGRAM,\n                                              VIR_LXC_MONITOR_PROGRAM_VERSION,\n                                              virLXCMonitorProcs,\n                                              virLXCMonitorNProcs)))\n        goto error;\n\n    if (!(ctrl->daemon = virNetDaemonNew()) ||\n        virNetDaemonAddServer(ctrl->daemon, srv) < 0)\n        goto error;\n\n    virNetDaemonUpdateServices(ctrl->daemon, true);\n    VIR_FREE(sockpath);\n    return 0;\n\n error:\n    VIR_FREE(sockpath);\n    virObjectUnref(srv);\n    virObjectUnref(ctrl->daemon);\n    ctrl->daemon = NULL;\n    virObjectUnref(svc);\n    return -1;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupServer(virLXCControllerPtr ctrl)\n{\n    virNetServerPtr srv = NULL;\n    virNetServerServicePtr svc = NULL;\n    char *sockpath;\n\n    sockpath = g_strdup_printf(\"%s/%s.sock\", LXC_STATE_DIR, ctrl->name);\n\n    if (!(srv = virNetServerNew(\"LXC\", 1,\n                                0, 0, 0, 1,\n                                0, -1, 0,\n                                virLXCControllerClientPrivateNew,\n                                NULL,\n                                virLXCControllerClientPrivateFree,\n                                ctrl)))\n        goto error;\n\n    if (virSecurityManagerSetSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (!(svc = virNetServerServiceNewUNIX(sockpath,\n                                           0700,\n                                           0,\n                                           0,\n                                           NULL,\n                                           false,\n                                           0,\n                                           5)))\n        goto error;\n\n    if (virSecurityManagerClearSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (virNetServerAddService(srv, svc) < 0)\n        goto error;\n    virObjectUnref(svc);\n    svc = NULL;\n\n    if (!(ctrl->prog = virNetServerProgramNew(VIR_LXC_MONITOR_PROGRAM,\n                                              VIR_LXC_MONITOR_PROGRAM_VERSION,\n                                              virLXCMonitorProcs,\n                                              virLXCMonitorNProcs)))\n        goto error;\n\n    if (!(ctrl->daemon = virNetDaemonNew()) ||\n        virNetDaemonAddServer(ctrl->daemon, srv) < 0)\n        goto error;\n\n    virNetDaemonUpdateServices(ctrl->daemon, true);\n    VIR_FREE(sockpath);\n    return 0;\n\n error:\n    VIR_FREE(sockpath);\n    virObjectUnref(srv);\n    virObjectUnref(ctrl->daemon);\n    ctrl->daemon = NULL;\n    virObjectUnref(svc);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerValidateConsoles",
          "args": [
            "ctrl"
          ],
          "line": 2711
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerValidateConsoles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "444-454",
          "snippet": "static int virLXCControllerValidateConsoles(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nconsoles != ctrl->nconsoles) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu consoles, but got %zu tty file handlers\"),\n                       ctrl->def->nconsoles, ctrl->nconsoles);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerValidateConsoles(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nconsoles != ctrl->nconsoles) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu consoles, but got %zu tty file handlers\"),\n                       ctrl->def->nconsoles, ctrl->nconsoles);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerGetNICIndexes",
          "args": [
            "ctrl"
          ],
          "line": 2708
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerGetNICIndexes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "381-441",
          "snippet": "static int virLXCControllerGetNICIndexes(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    /* Gather the ifindexes of the \"parent\" veths for all interfaces\n     * implemented with a veth pair. These will be used when calling\n     * virCgroupNewMachine (and eventually the dbus method\n     * CreateMachineWithNetwork). ifindexes for the child veths, and\n     * for macvlan interfaces, *should not* be in this list, as they\n     * will be moved into the container. Only the interfaces that will\n     * remain outside the container, but are used for communication\n     * with the container, should be added to the list.\n     */\n\n    VIR_DEBUG(\"Getting nic indexes\");\n    for (i = 0; i < ctrl->def->nnets; i++) {\n        int nicindex = -1;\n        virDomainNetType actualType = virDomainNetGetActualType(ctrl->def->nets[i]);\n\n        switch (actualType) {\n        case VIR_DOMAIN_NET_TYPE_BRIDGE:\n        case VIR_DOMAIN_NET_TYPE_NETWORK:\n        case VIR_DOMAIN_NET_TYPE_ETHERNET:\n            if (ctrl->def->nets[i]->ifname == NULL)\n                continue;\n            if (virNetDevGetIndex(ctrl->def->nets[i]->ifname,\n                                  &nicindex) < 0)\n                return -1;\n            if (VIR_EXPAND_N(ctrl->nicindexes,\n                             ctrl->nnicindexes,\n                             1) < 0)\n                return -1;\n            VIR_DEBUG(\"Index %d for %s\", nicindex,\n                      ctrl->def->nets[i]->ifname);\n            ctrl->nicindexes[ctrl->nnicindexes-1] = nicindex;\n            break;\n\n        case VIR_DOMAIN_NET_TYPE_DIRECT:\n           break;\n\n        case VIR_DOMAIN_NET_TYPE_USER:\n        case VIR_DOMAIN_NET_TYPE_VHOSTUSER:\n        case VIR_DOMAIN_NET_TYPE_SERVER:\n        case VIR_DOMAIN_NET_TYPE_CLIENT:\n        case VIR_DOMAIN_NET_TYPE_MCAST:\n        case VIR_DOMAIN_NET_TYPE_UDP:\n        case VIR_DOMAIN_NET_TYPE_INTERNAL:\n        case VIR_DOMAIN_NET_TYPE_HOSTDEV:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported net type %s\"),\n                           virDomainNetTypeToString(actualType));\n            return -1;\n        case VIR_DOMAIN_NET_TYPE_LAST:\n        default:\n            virReportEnumRangeError(virDomainNetType, actualType);\n            return -1;\n        }\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerGetNICIndexes(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    /* Gather the ifindexes of the \"parent\" veths for all interfaces\n     * implemented with a veth pair. These will be used when calling\n     * virCgroupNewMachine (and eventually the dbus method\n     * CreateMachineWithNetwork). ifindexes for the child veths, and\n     * for macvlan interfaces, *should not* be in this list, as they\n     * will be moved into the container. Only the interfaces that will\n     * remain outside the container, but are used for communication\n     * with the container, should be added to the list.\n     */\n\n    VIR_DEBUG(\"Getting nic indexes\");\n    for (i = 0; i < ctrl->def->nnets; i++) {\n        int nicindex = -1;\n        virDomainNetType actualType = virDomainNetGetActualType(ctrl->def->nets[i]);\n\n        switch (actualType) {\n        case VIR_DOMAIN_NET_TYPE_BRIDGE:\n        case VIR_DOMAIN_NET_TYPE_NETWORK:\n        case VIR_DOMAIN_NET_TYPE_ETHERNET:\n            if (ctrl->def->nets[i]->ifname == NULL)\n                continue;\n            if (virNetDevGetIndex(ctrl->def->nets[i]->ifname,\n                                  &nicindex) < 0)\n                return -1;\n            if (VIR_EXPAND_N(ctrl->nicindexes,\n                             ctrl->nnicindexes,\n                             1) < 0)\n                return -1;\n            VIR_DEBUG(\"Index %d for %s\", nicindex,\n                      ctrl->def->nets[i]->ifname);\n            ctrl->nicindexes[ctrl->nnicindexes-1] = nicindex;\n            break;\n\n        case VIR_DOMAIN_NET_TYPE_DIRECT:\n           break;\n\n        case VIR_DOMAIN_NET_TYPE_USER:\n        case VIR_DOMAIN_NET_TYPE_VHOSTUSER:\n        case VIR_DOMAIN_NET_TYPE_SERVER:\n        case VIR_DOMAIN_NET_TYPE_CLIENT:\n        case VIR_DOMAIN_NET_TYPE_MCAST:\n        case VIR_DOMAIN_NET_TYPE_UDP:\n        case VIR_DOMAIN_NET_TYPE_INTERNAL:\n        case VIR_DOMAIN_NET_TYPE_HOSTDEV:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported net type %s\"),\n                           virDomainNetTypeToString(actualType));\n            return -1;\n        case VIR_DOMAIN_NET_TYPE_LAST:\n        default:\n            virReportEnumRangeError(virDomainNetType, actualType);\n            return -1;\n        }\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerValidateNICs",
          "args": [
            "ctrl"
          ],
          "line": 2705
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerValidateNICs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "368-378",
          "snippet": "static int virLXCControllerValidateNICs(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nnets != ctrl->nveths) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu veths, but got %zu\"),\n                       ctrl->def->nnets, ctrl->nveths);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerValidateNICs(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nnets != ctrl->nveths) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu veths, but got %zu\"),\n                       ctrl->def->nnets, ctrl->nveths);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerAddConsole",
          "args": [
            "ctrl",
            "ttyFDs[i]"
          ],
          "line": 2700
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerAddConsole",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "325-340",
          "snippet": "static int virLXCControllerAddConsole(virLXCControllerPtr ctrl,\n                                      int hostFd)\n{\n    if (VIR_EXPAND_N(ctrl->consoles, ctrl->nconsoles, 1) < 0)\n        return -1;\n    ctrl->consoles[ctrl->nconsoles-1].daemon = ctrl->daemon;\n    ctrl->consoles[ctrl->nconsoles-1].hostFd = hostFd;\n    ctrl->consoles[ctrl->nconsoles-1].hostWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].contFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].contWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].epollFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].epollWatch = -1;\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerAddConsole(virLXCControllerPtr ctrl,\n                                      int hostFd)\n{\n    if (VIR_EXPAND_N(ctrl->consoles, ctrl->nconsoles, 1) < 0)\n        return -1;\n    ctrl->consoles[ctrl->nconsoles-1].daemon = ctrl->daemon;\n    ctrl->consoles[ctrl->nconsoles-1].hostFd = hostFd;\n    ctrl->consoles[ctrl->nconsoles-1].hostWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].contFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].contWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].epollFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].epollWatch = -1;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "ctrl->nsFDs",
            "VIR_LXC_DOMAIN_NAMESPACE_LAST"
          ],
          "line": 2690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Security model not initialized\""
          ],
          "line": 2677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Security model %s type %s label %s imagelabel %s\"",
            "NULLSTR(ctrl->def->seclabels[0]->model)",
            "virDomainSeclabelTypeToString(ctrl->def->seclabels[0]->type)",
            "NULLSTR(ctrl->def->seclabels[0]->label)",
            "NULLSTR(ctrl->def->seclabels[0]->imagelabel)"
          ],
          "line": 2671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "ctrl->def->seclabels[0]->imagelabel"
          ],
          "line": 2675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "ctrl->def->seclabels[0]->label"
          ],
          "line": 2674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainSeclabelTypeToString",
          "args": [
            "ctrl->def->seclabels[0]->type"
          ],
          "line": 2673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "ctrl->def->seclabels[0]->model"
          ],
          "line": 2672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerNew",
          "args": [
            "securityDriver",
            "LXC_DRIVER_NAME",
            "0"
          ],
          "line": 2666
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "176-208",
          "snippet": "virSecurityManagerPtr\nvirSecurityManagerNew(const char *name,\n                      const char *virtDriver,\n                      unsigned int flags)\n{\n    virSecurityDriverPtr drv = virSecurityDriverLookup(name, virtDriver);\n    if (!drv)\n        return NULL;\n\n    /* driver \"none\" needs some special handling of *Confined bools */\n    if (STREQ(drv->name, \"none\")) {\n        if (flags & VIR_SECURITY_MANAGER_REQUIRE_CONFINED) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Security driver \\\"none\\\" cannot create confined guests\"));\n            return NULL;\n        }\n\n        if (flags & VIR_SECURITY_MANAGER_DEFAULT_CONFINED) {\n            if (name != NULL) {\n                VIR_WARN(\"Configured security driver \\\"none\\\" disables default\"\n                         \" policy to create confined guests\");\n            } else {\n                VIR_DEBUG(\"Auto-probed security driver is \\\"none\\\";\"\n                          \" confined guests will not be created\");\n            }\n            flags &= ~VIR_SECURITY_MANAGER_DEFAULT_CONFINED;\n        }\n    }\n\n    return virSecurityManagerNewDriver(drv,\n                                       virtDriver,\n                                       flags);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirSecurityManagerPtr\nvirSecurityManagerNew(const char *name,\n                      const char *virtDriver,\n                      unsigned int flags)\n{\n    virSecurityDriverPtr drv = virSecurityDriverLookup(name, virtDriver);\n    if (!drv)\n        return NULL;\n\n    /* driver \"none\" needs some special handling of *Confined bools */\n    if (STREQ(drv->name, \"none\")) {\n        if (flags & VIR_SECURITY_MANAGER_REQUIRE_CONFINED) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Security driver \\\"none\\\" cannot create confined guests\"));\n            return NULL;\n        }\n\n        if (flags & VIR_SECURITY_MANAGER_DEFAULT_CONFINED) {\n            if (name != NULL) {\n                VIR_WARN(\"Configured security driver \\\"none\\\" disables default\"\n                         \" policy to create confined guests\");\n            } else {\n                VIR_DEBUG(\"Auto-probed security driver is \\\"none\\\";\"\n                          \" confined guests will not be created\");\n            }\n            flags &= ~VIR_SECURITY_MANAGER_DEFAULT_CONFINED;\n        }\n    }\n\n    return virSecurityManagerNewDriver(drv,\n                                       virtDriver,\n                                       flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerNew",
          "args": [
            "name"
          ],
          "line": 2661
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "190-231",
          "snippet": "static virLXCControllerPtr virLXCControllerNew(const char *name)\n{\n    virLXCControllerPtr ctrl = NULL;\n    virLXCDriverPtr driver = NULL;\n    char *configFile = NULL;\n\n    if (VIR_ALLOC(ctrl) < 0)\n        goto error;\n\n    ctrl->timerShutdown = -1;\n    ctrl->firstClient = true;\n\n    ctrl->name = g_strdup(name);\n\n    if (!(driver = virLXCControllerDriverNew()))\n        goto error;\n\n    if ((configFile = virDomainConfigFile(LXC_STATE_DIR,\n                                          ctrl->name)) == NULL)\n        goto error;\n\n    if ((ctrl->vm = virDomainObjParseFile(configFile,\n                                          driver->xmlopt,\n                                          0)) == NULL)\n        goto error;\n    ctrl->def = ctrl->vm->def;\n\n    if ((ctrl->timerShutdown = virEventAddTimeout(-1,\n                                                  virLXCControllerQuitTimer, ctrl,\n                                                  NULL)) < 0)\n        goto error;\n\n cleanup:\n    VIR_FREE(configFile);\n    virLXCControllerDriverFree(driver);\n    return ctrl;\n\n error:\n    virLXCControllerFree(ctrl);\n    ctrl = NULL;\n    goto cleanup;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic virLXCControllerPtr virLXCControllerNew(const char *name)\n{\n    virLXCControllerPtr ctrl = NULL;\n    virLXCDriverPtr driver = NULL;\n    char *configFile = NULL;\n\n    if (VIR_ALLOC(ctrl) < 0)\n        goto error;\n\n    ctrl->timerShutdown = -1;\n    ctrl->firstClient = true;\n\n    ctrl->name = g_strdup(name);\n\n    if (!(driver = virLXCControllerDriverNew()))\n        goto error;\n\n    if ((configFile = virDomainConfigFile(LXC_STATE_DIR,\n                                          ctrl->name)) == NULL)\n        goto error;\n\n    if ((ctrl->vm = virDomainObjParseFile(configFile,\n                                          driver->xmlopt,\n                                          0)) == NULL)\n        goto error;\n    ctrl->def = ctrl->vm->def;\n\n    if ((ctrl->timerShutdown = virEventAddTimeout(-1,\n                                                  virLXCControllerQuitTimer, ctrl,\n                                                  NULL)) < 0)\n        goto error;\n\n cleanup:\n    VIR_FREE(configFile);\n    virLXCControllerDriverFree(driver);\n    return ctrl;\n\n error:\n    virLXCControllerFree(ctrl);\n    ctrl = NULL;\n    goto cleanup;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusSetSharedBus",
          "args": [
            "false"
          ],
          "line": 2659
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusSetSharedBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1739-1742",
          "snippet": "void virDBusSetSharedBus(bool shared G_GNUC_UNUSED)\n{\n    /* nothing */\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nvoid virDBusSetSharedBus(bool shared G_GNUC_UNUSED)\n{\n    /* nothing */\n}"
        }
      },
      {
        "call_info": {
          "callee": "virEventRegisterDefaultImpl",
          "args": [],
          "line": 2657
        },
        "resolved": true,
        "details": {
          "function_name": "virEventRegisterDefaultImpl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "304-315",
          "snippet": "int virEventRegisterDefaultImpl(void)\n{\n    VIR_DEBUG(\"registering default event implementation\");\n\n    virInitialize();\n\n    virResetLastError();\n\n    virEventGLibRegister();\n\n    return 0;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nint virEventRegisterDefaultImpl(void)\n{\n    VIR_DEBUG(\"registering default event implementation\");\n\n    virInitialize();\n\n    virResetLastError();\n\n    virEventGLibRegister();\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s: must be run as the 'root' user\\n\"",
            "argv[0]"
          ],
          "line": 2653
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 2652
        },
        "resolved": true,
        "details": {
          "function_name": "geteuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.h",
          "lines": "68-69",
          "snippet": "static inline int geteuid(void)\n{ return 0; }",
          "includes": [
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <unistd.h>\n#include \"internal.h\"\n\nstatic inline int geteuid(void)\n{ return 0; }"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s: missing --handshakefd argument for container PTY\\n\"",
            "argv[0]"
          ],
          "line": 2647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s: missing --name argument for configuration\\n\"",
            "argv[0]"
          ],
          "line": 2642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\n\""
          ],
          "line": 2635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -h, --help\\n\""
          ],
          "line": 2634
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -U FD, --share-uts FD\\n\""
          ],
          "line": 2633
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -I FD, --share-ipc FD\\n\""
          ],
          "line": 2632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -N FD, --share-net FD\\n\""
          ],
          "line": 2631
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -S NAME, --security NAME\\n\""
          ],
          "line": 2630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -s FD, --handshakefd FD\\n\""
          ],
          "line": 2629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -v VETH, --veth VETH\\n\""
          ],
          "line": 2628
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -c FD, --console FD\\n\""
          ],
          "line": 2627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -n NAME, --name NAME\\n\""
          ],
          "line": 2626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"  -b, --background\\n\""
          ],
          "line": 2625
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\n\""
          ],
          "line": 2624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Options\\n\""
          ],
          "line": 2623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\n\""
          ],
          "line": 2622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"syntax: %s [OPTIONS]\\n\"",
            "argv[0]"
          ],
          "line": 2621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\n\""
          ],
          "line": 2620
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"malformed --share-uts argument '%s'\"",
            "optarg"
          ],
          "line": 2608
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_i",
          "args": [
            "optarg",
            "NULL",
            "10",
            "&ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS]"
          ],
          "line": 2607
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "391-407",
          "snippet": "int\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"malformed --share-ipc argument '%s'\"",
            "optarg"
          ],
          "line": 2600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"malformed --share-net argument '%s'\"",
            "optarg"
          ],
          "line": 2592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"malformed --handshakefd argument '%s'\"",
            "optarg"
          ],
          "line": 2584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"malformed --passfd argument '%s'\"",
            "optarg"
          ],
          "line": 2577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_REALLOC_N",
          "args": [
            "passFDs",
            "npassFDs + 1"
          ],
          "line": 2574
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"malformed --console argument '%s'\"",
            "optarg"
          ],
          "line": 2568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_REALLOC_N",
          "args": [
            "ttyFDs",
            "nttyFDs + 1"
          ],
          "line": 2565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "optarg"
          ],
          "line": 2561
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_REALLOC_N",
          "args": [
            "veths",
            "nveths+1"
          ],
          "line": 2559
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getopt_long",
          "args": [
            "argc",
            "argv",
            "\"dn:v:p:m:c:s:h:S:N:I:U:\"",
            "options",
            "NULL"
          ],
          "line": 2543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogSetFromEnv",
          "args": [],
          "line": 2538
        },
        "resolved": true,
        "details": {
          "function_name": "virLogSetFromEnv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1208-1225",
          "snippet": "void\nvirLogSetFromEnv(void)\n{\n    const char *debugEnv;\n\n    if (virLogInitialize() < 0)\n        return;\n\n    debugEnv = getenv(\"LIBVIRT_DEBUG\");\n    if (debugEnv && *debugEnv)\n        virLogSetDefaultPriority(virLogParseDefaultPriority(debugEnv));\n    debugEnv = getenv(\"LIBVIRT_LOG_FILTERS\");\n    if (debugEnv && *debugEnv)\n        virLogSetFilters(debugEnv);\n    debugEnv = getenv(\"LIBVIRT_LOG_OUTPUTS\");\n    if (debugEnv && *debugEnv)\n        virLogSetOutputs(debugEnv);\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirLogSetFromEnv(void)\n{\n    const char *debugEnv;\n\n    if (virLogInitialize() < 0)\n        return;\n\n    debugEnv = getenv(\"LIBVIRT_DEBUG\");\n    if (debugEnv && *debugEnv)\n        virLogSetDefaultPriority(virLogParseDefaultPriority(debugEnv));\n    debugEnv = getenv(\"LIBVIRT_LOG_FILTERS\");\n    if (debugEnv && *debugEnv)\n        virLogSetFilters(debugEnv);\n    debugEnv = getenv(\"LIBVIRT_LOG_OUTPUTS\");\n    if (debugEnv && *debugEnv)\n        virLogSetOutputs(debugEnv);\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 2534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"%s: initialization failed\\n\")",
            "argv[0]"
          ],
          "line": 2533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virErrorInitialize",
          "args": [],
          "line": 2532
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorInitialize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "172-176",
          "snippet": "int\nvirErrorInitialize(void)\n{\n    return virThreadLocalInit(&virLastErr, virLastErrFreeData);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal virLastErr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirThreadLocal virLastErr;\n\nint\nvirErrorInitialize(void)\n{\n    return virThreadLocalInit(&virLastErr, virLastErrFreeData);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGettextInitialize",
          "args": [],
          "line": 2531
        },
        "resolved": true,
        "details": {
          "function_name": "virGettextInitialize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virgettext.c",
          "lines": "39-59",
          "snippet": "int\nvirGettextInitialize(void)\n{\n#if HAVE_LIBINTL_H\n    if (!setlocale(LC_ALL, \"\")) {\n        perror(\"setlocale\");\n        /* failure to setup locale is not fatal */\n    }\n\n    if (!bindtextdomain(PACKAGE, LOCALEDIR)) {\n        perror(\"bindtextdomain\");\n        return -1;\n    }\n\n    if (!textdomain(PACKAGE)) {\n        perror(\"textdomain\");\n        return -1;\n    }\n#endif /* HAVE_LIBINTL_H */\n    return 0;\n}",
          "includes": [
            "#include \"virgettext.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virgettext.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <config.h>\n\nint\nvirGettextInitialize(void)\n{\n#if HAVE_LIBINTL_H\n    if (!setlocale(LC_ALL, \"\")) {\n        perror(\"setlocale\");\n        /* failure to setup locale is not fatal */\n    }\n\n    if (!bindtextdomain(PACKAGE, LOCALEDIR)) {\n        perror(\"bindtextdomain\");\n        return -1;\n    }\n\n    if (!textdomain(PACKAGE)) {\n        perror(\"textdomain\");\n        return -1;\n    }\n#endif /* HAVE_LIBINTL_H */\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nint main(int argc, char *argv[])\n{\n    pid_t pid;\n    int rc = -1;\n    const char *name = NULL;\n    size_t nveths = 0;\n    char **veths = NULL;\n    int ns_fd[VIR_LXC_DOMAIN_NAMESPACE_LAST];\n    int handshakeFd = -1;\n    bool bg = false;\n    const struct option options[] = {\n        { \"background\", 0, NULL, 'b' },\n        { \"name\",   1, NULL, 'n' },\n        { \"veth\",   1, NULL, 'v' },\n        { \"console\", 1, NULL, 'c' },\n        { \"passfd\", 1, NULL, 'p' },\n        { \"handshakefd\", 1, NULL, 's' },\n        { \"security\", 1, NULL, 'S' },\n        { \"share-net\", 1, NULL, 'N' },\n        { \"share-ipc\", 1, NULL, 'I' },\n        { \"share-uts\", 1, NULL, 'U' },\n        { \"help\", 0, NULL, 'h' },\n        { 0, 0, 0, 0 },\n    };\n    int *ttyFDs = NULL;\n    size_t nttyFDs = 0;\n    int *passFDs = NULL;\n    size_t npassFDs = 0;\n    virLXCControllerPtr ctrl = NULL;\n    size_t i;\n    const char *securityDriver = \"none\";\n\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n        ns_fd[i] = -1;\n\n    if (virGettextInitialize() < 0 ||\n        virErrorInitialize() < 0) {\n        fprintf(stderr, _(\"%s: initialization failed\\n\"), argv[0]);\n        exit(EXIT_FAILURE);\n    }\n\n    /* Initialize logging */\n    virLogSetFromEnv();\n\n    while (1) {\n        int c;\n\n        c = getopt_long(argc, argv, \"dn:v:p:m:c:s:h:S:N:I:U:\",\n                        options, NULL);\n\n        if (c == -1)\n            break;\n\n        switch (c) {\n        case 'b':\n            bg = true;\n            break;\n\n        case 'n':\n            name = optarg;\n            break;\n\n        case 'v':\n            if (VIR_REALLOC_N(veths, nveths+1) < 0)\n                goto cleanup;\n            veths[nveths++] = g_strdup(optarg);\n            break;\n\n        case 'c':\n            if (VIR_REALLOC_N(ttyFDs, nttyFDs + 1) < 0)\n                goto cleanup;\n            if (virStrToLong_i(optarg, NULL, 10, &ttyFDs[nttyFDs++]) < 0) {\n                fprintf(stderr, \"malformed --console argument '%s'\", optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'p':\n            if (VIR_REALLOC_N(passFDs, npassFDs + 1) < 0)\n                goto cleanup;\n            if (virStrToLong_i(optarg, NULL, 10, &passFDs[npassFDs++]) < 0) {\n                fprintf(stderr, \"malformed --passfd argument '%s'\", optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 's':\n            if (virStrToLong_i(optarg, NULL, 10, &handshakeFd) < 0) {\n                fprintf(stderr, \"malformed --handshakefd argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'N':\n            if (virStrToLong_i(optarg, NULL, 10, &ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHARENET]) < 0) {\n                fprintf(stderr, \"malformed --share-net argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'I':\n            if (virStrToLong_i(optarg, NULL, 10, &ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHAREIPC]) < 0) {\n                fprintf(stderr, \"malformed --share-ipc argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'U':\n            if (virStrToLong_i(optarg, NULL, 10, &ns_fd[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS]) < 0) {\n                fprintf(stderr, \"malformed --share-uts argument '%s'\",\n                        optarg);\n                goto cleanup;\n            }\n            break;\n\n        case 'S':\n            securityDriver = optarg;\n            break;\n\n        case 'h':\n        case '?':\n            fprintf(stderr, \"\\n\");\n            fprintf(stderr, \"syntax: %s [OPTIONS]\\n\", argv[0]);\n            fprintf(stderr, \"\\n\");\n            fprintf(stderr, \"Options\\n\");\n            fprintf(stderr, \"\\n\");\n            fprintf(stderr, \"  -b, --background\\n\");\n            fprintf(stderr, \"  -n NAME, --name NAME\\n\");\n            fprintf(stderr, \"  -c FD, --console FD\\n\");\n            fprintf(stderr, \"  -v VETH, --veth VETH\\n\");\n            fprintf(stderr, \"  -s FD, --handshakefd FD\\n\");\n            fprintf(stderr, \"  -S NAME, --security NAME\\n\");\n            fprintf(stderr, \"  -N FD, --share-net FD\\n\");\n            fprintf(stderr, \"  -I FD, --share-ipc FD\\n\");\n            fprintf(stderr, \"  -U FD, --share-uts FD\\n\");\n            fprintf(stderr, \"  -h, --help\\n\");\n            fprintf(stderr, \"\\n\");\n            rc = 0;\n            goto cleanup;\n        }\n    }\n\n    if (name == NULL) {\n        fprintf(stderr, \"%s: missing --name argument for configuration\\n\", argv[0]);\n        goto cleanup;\n    }\n\n    if (handshakeFd < 0) {\n        fprintf(stderr, \"%s: missing --handshakefd argument for container PTY\\n\",\n                argv[0]);\n        goto cleanup;\n    }\n\n    if (geteuid() != 0) {\n        fprintf(stderr, \"%s: must be run as the 'root' user\\n\", argv[0]);\n        goto cleanup;\n    }\n\n    virEventRegisterDefaultImpl();\n\n    virDBusSetSharedBus(false);\n\n    if (!(ctrl = virLXCControllerNew(name)))\n        goto cleanup;\n\n    ctrl->handshakeFd = handshakeFd;\n\n    if (!(ctrl->securityManager = virSecurityManagerNew(securityDriver,\n                                                        LXC_DRIVER_NAME, 0)))\n        goto cleanup;\n\n    if (ctrl->def->seclabels) {\n        VIR_DEBUG(\"Security model %s type %s label %s imagelabel %s\",\n                  NULLSTR(ctrl->def->seclabels[0]->model),\n                  virDomainSeclabelTypeToString(ctrl->def->seclabels[0]->type),\n                  NULLSTR(ctrl->def->seclabels[0]->label),\n                  NULLSTR(ctrl->def->seclabels[0]->imagelabel));\n    } else {\n        VIR_DEBUG(\"Security model not initialized\");\n    }\n\n    ctrl->veths = veths;\n    ctrl->nveths = nveths;\n\n    ctrl->passFDs = passFDs;\n    ctrl->npassFDs = npassFDs;\n\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++) {\n        if (ns_fd[i] != -1) {\n            if (!ctrl->nsFDs) {/*allocate only once */\n                size_t j = 0;\n                if (VIR_ALLOC_N(ctrl->nsFDs, VIR_LXC_DOMAIN_NAMESPACE_LAST) < 0)\n                    goto cleanup;\n                for (j = 0; j < VIR_LXC_DOMAIN_NAMESPACE_LAST; j++)\n                    ctrl->nsFDs[j] = -1;\n            }\n            ctrl->nsFDs[i] = ns_fd[i];\n        }\n    }\n\n    for (i = 0; i < nttyFDs; i++) {\n        if (virLXCControllerAddConsole(ctrl, ttyFDs[i]) < 0)\n            goto cleanup;\n        ttyFDs[i] = -1;\n    }\n\n    if (virLXCControllerValidateNICs(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerGetNICIndexes(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerValidateConsoles(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupServer(ctrl) < 0)\n        goto cleanup;\n\n    if (bg) {\n        if ((pid = fork()) < 0)\n            goto cleanup;\n\n        if (pid > 0) {\n            if ((rc = virPidFileWrite(LXC_STATE_DIR, name, pid)) < 0) {\n                virReportSystemError(-rc,\n                                     _(\"Unable to write pid file '%s/%s.pid'\"),\n                                     LXC_STATE_DIR, name);\n                _exit(1);\n            }\n\n            /* First child now exits, allowing original caller\n             * (ie libvirtd's LXC driver to complete their\n             * waitpid & continue */\n            _exit(0);\n        }\n\n        /* Don't hold on to any cwd we inherit from libvirtd either */\n        if (chdir(\"/\") < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to change to root dir\"));\n            goto cleanup;\n        }\n\n        if (setsid() < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to become session leader\"));\n            goto cleanup;\n        }\n    }\n\n    rc = virLXCControllerRun(ctrl);\n\n cleanup:\n    if (rc < 0) {\n        fprintf(stderr,\n                _(\"Failure in libvirt_lxc startup: %s\\n\"),\n                virGetLastErrorMessage());\n    }\n\n    virPidFileDelete(LXC_STATE_DIR, name);\n    if (ctrl)\n        virLXCControllerDeleteInterfaces(ctrl);\n    for (i = 0; i < nttyFDs; i++)\n        VIR_FORCE_CLOSE(ttyFDs[i]);\n    VIR_FREE(ttyFDs);\n    for (i = 0; i < npassFDs; i++)\n        VIR_FORCE_CLOSE(passFDs[i]);\n    VIR_FREE(passFDs);\n\n    virLXCControllerFree(ctrl);\n\n    return rc < 0? EXIT_FAILURE : EXIT_SUCCESS;\n}"
  },
  {
    "function_name": "virLXCControllerRun",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2356-2493",
    "snippet": "static int\nvirLXCControllerRun(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    int control[2] = { -1, -1};\n    int containerhandshake[2] = { -1, -1 };\n    char **containerTTYPaths = NULL;\n    size_t i;\n\n    if (VIR_ALLOC_N(containerTTYPaths, ctrl->nconsoles) < 0)\n        goto cleanup;\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, control) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sockpair failed\"));\n        goto cleanup;\n    }\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, containerhandshake) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"socketpair failed\"));\n        goto cleanup;\n    }\n\n    if (virLXCControllerSetupPrivateNS() < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupLoopDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupResourceLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupDevPTS(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerPopulateDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupTimers(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllDisks(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllHostdevs(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupConsoles(ctrl, containerTTYPaths) < 0)\n        goto cleanup;\n\n    if (lxcSetPersonality(ctrl->def) < 0)\n        goto cleanup;\n\n    if ((ctrl->initpid = lxcContainerStart(ctrl->def,\n                                           ctrl->securityManager,\n                                           ctrl->nveths,\n                                           ctrl->veths,\n                                           ctrl->npassFDs,\n                                           ctrl->passFDs,\n                                           control[1],\n                                           containerhandshake[1],\n                                           ctrl->nsFDs,\n                                           ctrl->nconsoles,\n                                           containerTTYPaths)) < 0)\n        goto cleanup;\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n\n    if (ctrl->nsFDs)\n        for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n            VIR_FORCE_CLOSE(ctrl->nsFDs[i]);\n\n    if (virLXCControllerSetupCgroupLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupUserns(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerMoveInterfaces(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerStartFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (lxcContainerSendContinue(control[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to send container continue message\"));\n        goto cleanup;\n    }\n\n    if (lxcContainerWaitForContinue(containerhandshake[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error receiving signal from container\"));\n        goto cleanup;\n    }\n\n    /* ...and reduce our privileges */\n    if (lxcControllerClearCapabilities() < 0)\n        goto cleanup;\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        if (virLXCControllerConsoleSetNonblocking(&(ctrl->consoles[i])) < 0)\n            goto cleanup;\n\n    if (virLXCControllerDaemonHandshake(ctrl) < 0)\n        goto cleanup;\n\n    /* We must not hold open a dbus connection for life\n     * of LXC instance, since dbus-daemon is limited to\n     * only a few 100 connections by default\n     */\n    virDBusCloseSystemBus();\n\n    rc = virLXCControllerMain(ctrl);\n\n    virLXCControllerEventSendExit(ctrl, rc);\n\n cleanup:\n    VIR_FORCE_CLOSE(control[0]);\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[0]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        VIR_FREE(containerTTYPaths[i]);\n    VIR_FREE(containerTTYPaths);\n\n    virLXCControllerStopInit(ctrl);\n\n    return rc;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerStopInit",
          "args": [
            "ctrl"
          ],
          "line": 2490
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerStopInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "245-253",
          "snippet": "static void virLXCControllerStopInit(virLXCControllerPtr ctrl)\n{\n    if (ctrl->initpid == 0)\n        return;\n\n    virLXCControllerCloseLoopDevices(ctrl);\n    virProcessAbort(ctrl->initpid);\n    ctrl->initpid = 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic void virLXCControllerStopInit(virLXCControllerPtr ctrl)\n{\n    if (ctrl->initpid == 0)\n        return;\n\n    virLXCControllerCloseLoopDevices(ctrl);\n    virProcessAbort(ctrl->initpid);\n    ctrl->initpid = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "containerTTYPaths"
          ],
          "line": 2488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "containerTTYPaths[i]"
          ],
          "line": 2487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "containerhandshake[1]"
          ],
          "line": 2484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "containerhandshake[0]"
          ],
          "line": 2483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "control[1]"
          ],
          "line": 2482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "control[0]"
          ],
          "line": 2481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerEventSendExit",
          "args": [
            "ctrl",
            "rc"
          ],
          "line": 2478
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerEventSendExit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2302-2335",
          "snippet": "static int\nvirLXCControllerEventSendExit(virLXCControllerPtr ctrl,\n                              int exitstatus)\n{\n    virLXCMonitorExitEventMsg msg;\n\n    VIR_DEBUG(\"Exit status %d (client=%p)\", exitstatus, ctrl->client);\n    memset(&msg, 0, sizeof(msg));\n    switch (exitstatus) {\n    case 0:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_SHUTDOWN;\n        break;\n    case 1:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_REBOOT;\n        break;\n    default:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_ERROR;\n        break;\n    }\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_EXIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorExitEventMsg,\n                              (void*)&msg);\n\n    if (ctrl->client) {\n        VIR_DEBUG(\"Waiting for client to complete dispatch\");\n        ctrl->inShutdown = true;\n        virNetServerClientDelayedClose(ctrl->client);\n        virNetDaemonRun(ctrl->daemon);\n    }\n    VIR_DEBUG(\"Client has gone away\");\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerEventSendExit(virLXCControllerPtr ctrl,\n                              int exitstatus)\n{\n    virLXCMonitorExitEventMsg msg;\n\n    VIR_DEBUG(\"Exit status %d (client=%p)\", exitstatus, ctrl->client);\n    memset(&msg, 0, sizeof(msg));\n    switch (exitstatus) {\n    case 0:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_SHUTDOWN;\n        break;\n    case 1:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_REBOOT;\n        break;\n    default:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_ERROR;\n        break;\n    }\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_EXIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorExitEventMsg,\n                              (void*)&msg);\n\n    if (ctrl->client) {\n        VIR_DEBUG(\"Waiting for client to complete dispatch\");\n        ctrl->inShutdown = true;\n        virNetServerClientDelayedClose(ctrl->client);\n        virNetDaemonRun(ctrl->daemon);\n    }\n    VIR_DEBUG(\"Client has gone away\");\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerMain",
          "args": [
            "ctrl"
          ],
          "line": 2476
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerMain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1314-1375",
          "snippet": "static int virLXCControllerMain(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    size_t i;\n\n    if (virNetDaemonAddSignalHandler(ctrl->daemon,\n                                     SIGCHLD,\n                                     virLXCControllerSignalChildIO,\n                                     ctrl) < 0)\n        goto cleanup;\n\n    virResetLastError();\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        if ((ctrl->consoles[i].epollFd = epoll_create1(EPOLL_CLOEXEC)) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to create epoll fd\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].epollWatch = virEventAddHandle(ctrl->consoles[i].epollFd,\n                                                              VIR_EVENT_HANDLE_READABLE,\n                                                              virLXCControllerConsoleEPoll,\n                                                              &(ctrl->consoles[i]),\n                                                              NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch epoll FD\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].hostWatch = virEventAddHandle(ctrl->consoles[i].hostFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].contWatch = virEventAddHandle(ctrl->consoles[i].contFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n    }\n\n    virNetDaemonRun(ctrl->daemon);\n\n    if (virGetLastErrorCode() == VIR_ERR_OK)\n        rc = wantReboot ? 1 : 0;\n\n cleanup:\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n\n    return rc;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static bool wantReboot;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic bool wantReboot;\n\nstatic int virLXCControllerMain(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    size_t i;\n\n    if (virNetDaemonAddSignalHandler(ctrl->daemon,\n                                     SIGCHLD,\n                                     virLXCControllerSignalChildIO,\n                                     ctrl) < 0)\n        goto cleanup;\n\n    virResetLastError();\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        if ((ctrl->consoles[i].epollFd = epoll_create1(EPOLL_CLOEXEC)) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to create epoll fd\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].epollWatch = virEventAddHandle(ctrl->consoles[i].epollFd,\n                                                              VIR_EVENT_HANDLE_READABLE,\n                                                              virLXCControllerConsoleEPoll,\n                                                              &(ctrl->consoles[i]),\n                                                              NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch epoll FD\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].hostWatch = virEventAddHandle(ctrl->consoles[i].hostFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].contWatch = virEventAddHandle(ctrl->consoles[i].contFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n    }\n\n    virNetDaemonRun(ctrl->daemon);\n\n    if (virGetLastErrorCode() == VIR_ERR_OK)\n        rc = wantReboot ? 1 : 0;\n\n cleanup:\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusCloseSystemBus",
          "args": [],
          "line": 2474
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusCloseSystemBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1759-1762",
          "snippet": "void virDBusCloseSystemBus(void)\n{\n    /* nothing */\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nvoid virDBusCloseSystemBus(void)\n{\n    /* nothing */\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerDaemonHandshake",
          "args": [
            "ctrl"
          ],
          "line": 2467
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerDaemonHandshake",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "356-365",
          "snippet": "static int virLXCControllerDaemonHandshake(virLXCControllerPtr ctrl)\n{\n    if (lxcContainerSendContinue(ctrl->handshakeFd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error sending continue signal to daemon\"));\n        return -1;\n    }\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerDaemonHandshake(virLXCControllerPtr ctrl)\n{\n    if (lxcContainerSendContinue(ctrl->handshakeFd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error sending continue signal to daemon\"));\n        return -1;\n    }\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerConsoleSetNonblocking",
          "args": [
            "&(ctrl->consoles[i])"
          ],
          "line": 2464
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerConsoleSetNonblocking",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "343-353",
          "snippet": "static int virLXCControllerConsoleSetNonblocking(virLXCControllerConsolePtr console)\n{\n    if (virSetBlocking(console->hostFd, false) < 0 ||\n        virSetBlocking(console->contFd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set console file descriptor non-blocking\"));\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerConsoleSetNonblocking(virLXCControllerConsolePtr console)\n{\n    if (virSetBlocking(console->hostFd, false) < 0 ||\n        virSetBlocking(console->contFd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set console file descriptor non-blocking\"));\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcControllerClearCapabilities",
          "args": [],
          "line": 2460
        },
        "resolved": true,
        "details": {
          "function_name": "lxcControllerClearCapabilities",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1018-1034",
          "snippet": "static int lxcControllerClearCapabilities(void)\n{\n#if WITH_CAPNG\n    int ret;\n\n    capng_clear(CAPNG_SELECT_BOTH);\n\n    if ((ret = capng_apply(CAPNG_SELECT_BOTH)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to apply capabilities: %d\"), ret);\n        return -1;\n    }\n#else\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n#endif\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int lxcControllerClearCapabilities(void)\n{\n#if WITH_CAPNG\n    int ret;\n\n    capng_clear(CAPNG_SELECT_BOTH);\n\n    if ((ret = capng_apply(CAPNG_SELECT_BOTH)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to apply capabilities: %d\"), ret);\n        return -1;\n    }\n#else\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n#endif\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"error receiving signal from container\")"
          ],
          "line": 2454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"error receiving signal from container\""
          ],
          "line": 2455
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerWaitForContinue",
          "args": [
            "containerhandshake[0]"
          ],
          "line": 2453
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerWaitForContinue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "404-423",
          "snippet": "int lxcContainerWaitForContinue(int control)\n{\n    lxc_message_t msg;\n    int readLen;\n\n    VIR_DEBUG(\"Wait continue on fd %d\", control);\n    readLen = saferead(control, &msg, sizeof(msg));\n    VIR_DEBUG(\"Got continue on fd %d %d\", control, readLen);\n    if (readLen != sizeof(msg)) {\n        if (readLen >= 0)\n            errno = EIO;\n        return -1;\n    }\n    if (msg != LXC_CONTINUE_MSG) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LXC_CONTINUE_MSG 'c'"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerWaitForContinue(int control)\n{\n    lxc_message_t msg;\n    int readLen;\n\n    VIR_DEBUG(\"Wait continue on fd %d\", control);\n    readLen = saferead(control, &msg, sizeof(msg));\n    VIR_DEBUG(\"Got continue on fd %d %d\", control, readLen);\n    if (readLen != sizeof(msg)) {\n        if (readLen >= 0)\n            errno = EIO;\n        return -1;\n    }\n    if (msg != LXC_CONTINUE_MSG) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to send container continue message\")"
          ],
          "line": 2448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerSendContinue",
          "args": [
            "control[0]"
          ],
          "line": 2447
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSendContinue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "381-392",
          "snippet": "int lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LXC_CONTINUE_MSG 'c'"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerStartFuse",
          "args": [
            "ctrl"
          ],
          "line": 2444
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerStartFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2225-2229",
          "snippet": "static int\nvirLXCControllerStartFuse(virLXCControllerPtr ctrl)\n{\n    return lxcStartFuse(ctrl->fuse);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerStartFuse(virLXCControllerPtr ctrl)\n{\n    return lxcStartFuse(ctrl->fuse);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerMoveInterfaces",
          "args": [
            "ctrl"
          ],
          "line": 2441
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerMoveInterfaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2013-2039",
          "snippet": "static int virLXCControllerMoveInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr def = ctrl->def;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevSetNamespace(ctrl->veths[i], ctrl->initpid) < 0)\n            return -1;\n    }\n\n    for (i = 0; i < def->nhostdevs; i ++) {\n        virDomainHostdevDefPtr hdev = def->hostdevs[i];\n\n        if (hdev->mode != VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES)\n            continue;\n\n        virDomainHostdevCaps hdcaps = hdev->source.caps;\n\n        if (hdcaps.type != VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            continue;\n\n        if (virNetDevSetNamespace(hdcaps.u.net.ifname, ctrl->initpid) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int virLXCControllerMoveInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr def = ctrl->def;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevSetNamespace(ctrl->veths[i], ctrl->initpid) < 0)\n            return -1;\n    }\n\n    for (i = 0; i < def->nhostdevs; i ++) {\n        virDomainHostdevDefPtr hdev = def->hostdevs[i];\n\n        if (hdev->mode != VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES)\n            continue;\n\n        virDomainHostdevCaps hdcaps = hdev->source.caps;\n\n        if (hdcaps.type != VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            continue;\n\n        if (virNetDevSetNamespace(hdcaps.u.net.ifname, ctrl->initpid) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupUserns",
          "args": [
            "ctrl"
          ],
          "line": 2438
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupUserns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1432-1459",
          "snippet": "static int virLXCControllerSetupUserns(virLXCControllerPtr ctrl)\n{\n    g_autofree char *uid_map = NULL;\n    g_autofree char *gid_map = NULL;\n\n    /* User namespace is disabled for container */\n    if (ctrl->def->idmap.nuidmap == 0) {\n        VIR_DEBUG(\"No uid map, skipping userns setup\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Setting up userns maps\");\n    uid_map = g_strdup_printf(\"/proc/%d/uid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.uidmap,\n                                       ctrl->def->idmap.nuidmap,\n                                       uid_map) < 0)\n        return -1;\n\n    gid_map = g_strdup_printf(\"/proc/%d/gid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.gidmap,\n                                       ctrl->def->idmap.ngidmap,\n                                       gid_map) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int virLXCControllerSetupUserns(virLXCControllerPtr ctrl)\n{\n    g_autofree char *uid_map = NULL;\n    g_autofree char *gid_map = NULL;\n\n    /* User namespace is disabled for container */\n    if (ctrl->def->idmap.nuidmap == 0) {\n        VIR_DEBUG(\"No uid map, skipping userns setup\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Setting up userns maps\");\n    uid_map = g_strdup_printf(\"/proc/%d/uid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.uidmap,\n                                       ctrl->def->idmap.nuidmap,\n                                       uid_map) < 0)\n        return -1;\n\n    gid_map = g_strdup_printf(\"/proc/%d/gid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.gidmap,\n                                       ctrl->def->idmap.ngidmap,\n                                       gid_map) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupCgroupLimits",
          "args": [
            "ctrl"
          ],
          "line": 2435
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupCgroupLimits",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "881-917",
          "snippet": "static int virLXCControllerSetupCgroupLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    size_t i;\n\n    VIR_DEBUG(\"Setting up cgroup resource limits\");\n\n    if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n        goto cleanup;\n\n    nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n    if (!(ctrl->cgroup = virLXCCgroupCreate(ctrl->def,\n                                            ctrl->initpid,\n                                            ctrl->nnicindexes,\n                                            ctrl->nicindexes)))\n        goto cleanup;\n\n    if (virCgroupAddMachineProcess(ctrl->cgroup, getpid()) < 0)\n        goto cleanup;\n\n    /* Add all qemu-nbd tasks to the cgroup */\n    for (i = 0; i < ctrl->nnbdpids; i++) {\n        if (virCgroupAddMachineProcess(ctrl->cgroup, ctrl->nbdpids[i]) < 0)\n            goto cleanup;\n    }\n\n    if (virLXCCgroupSetup(ctrl->def, ctrl->cgroup, nodeset) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int virLXCControllerSetupCgroupLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    size_t i;\n\n    VIR_DEBUG(\"Setting up cgroup resource limits\");\n\n    if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n        goto cleanup;\n\n    nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n    if (!(ctrl->cgroup = virLXCCgroupCreate(ctrl->def,\n                                            ctrl->initpid,\n                                            ctrl->nnicindexes,\n                                            ctrl->nicindexes)))\n        goto cleanup;\n\n    if (virCgroupAddMachineProcess(ctrl->cgroup, getpid()) < 0)\n        goto cleanup;\n\n    /* Add all qemu-nbd tasks to the cgroup */\n    for (i = 0; i < ctrl->nnbdpids; i++) {\n        if (virCgroupAddMachineProcess(ctrl->cgroup, ctrl->nbdpids[i]) < 0)\n            goto cleanup;\n    }\n\n    if (virLXCCgroupSetup(ctrl->def, ctrl->cgroup, nodeset) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ctrl->nsFDs[i]"
          ],
          "line": 2433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ctrl->passFDs[i]"
          ],
          "line": 2429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "containerhandshake[1]"
          ],
          "line": 2426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "control[1]"
          ],
          "line": 2425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerStart",
          "args": [
            "ctrl->def",
            "ctrl->securityManager",
            "ctrl->nveths",
            "ctrl->veths",
            "ctrl->npassFDs",
            "ctrl->passFDs",
            "control[1]",
            "containerhandshake[1]",
            "ctrl->nsFDs",
            "ctrl->nconsoles",
            "containerTTYPaths"
          ],
          "line": 2413
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2371-2459",
          "snippet": "int lxcContainerStart(virDomainDefPtr def,\n                      virSecurityManagerPtr securityDriver,\n                      size_t nveths,\n                      char **veths,\n                      size_t npassFDs,\n                      int *passFDs,\n                      int control,\n                      int handshakefd,\n                      int *nsInheritFDs,\n                      size_t nttyPaths,\n                      char **ttyPaths)\n{\n    pid_t pid;\n    int cflags;\n    int stacksize = getpagesize() * 4;\n    char *stack, *stacktop;\n    lxc_child_argv_t args = {\n        .config = def,\n        .securityDriver = securityDriver,\n        .nveths = nveths,\n        .veths = veths,\n        .npassFDs = npassFDs,\n        .passFDs = passFDs,\n        .monitor = control,\n        .nttyPaths = nttyPaths,\n        .ttyPaths = ttyPaths,\n        .handshakefd = handshakefd,\n        .nsInheritFDs = nsInheritFDs,\n    };\n\n    /* allocate a stack for the container */\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    stacktop = stack + stacksize;\n\n    cflags = CLONE_NEWPID|CLONE_NEWNS|SIGCHLD;\n\n    if (userns_required(def)) {\n        if (virProcessNamespaceAvailable(VIR_PROCESS_NAMESPACE_USER) < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Kernel doesn't support user namespace\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Enable user namespace\");\n        cflags |= CLONE_NEWUSER;\n    }\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHARENET] == -1) {\n        if (lxcNeedNetworkNamespace(def)) {\n            VIR_DEBUG(\"Enable network namespaces\");\n            cflags |= CLONE_NEWNET;\n        }\n    } else {\n        if (lxcNeedNetworkNamespace(def)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Config asks for inherit net namespace \"\n                             \"as well as private network interfaces\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Inheriting a net namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREIPC] == -1) {\n        cflags |= CLONE_NEWIPC;\n    } else {\n        VIR_DEBUG(\"Inheriting an IPC namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS] == -1) {\n        cflags |= CLONE_NEWUTS;\n    } else {\n        VIR_DEBUG(\"Inheriting a UTS namespace\");\n    }\n\n    VIR_DEBUG(\"Cloning container init process\");\n    pid = clone(lxcContainerChild, stacktop, cflags, &args);\n    VIR_FREE(stack);\n    VIR_DEBUG(\"clone() completed, new container PID is %d\", pid);\n\n    if (pid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to run clone container\"));\n        return -1;\n    }\n\n    return pid;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerStart(virDomainDefPtr def,\n                      virSecurityManagerPtr securityDriver,\n                      size_t nveths,\n                      char **veths,\n                      size_t npassFDs,\n                      int *passFDs,\n                      int control,\n                      int handshakefd,\n                      int *nsInheritFDs,\n                      size_t nttyPaths,\n                      char **ttyPaths)\n{\n    pid_t pid;\n    int cflags;\n    int stacksize = getpagesize() * 4;\n    char *stack, *stacktop;\n    lxc_child_argv_t args = {\n        .config = def,\n        .securityDriver = securityDriver,\n        .nveths = nveths,\n        .veths = veths,\n        .npassFDs = npassFDs,\n        .passFDs = passFDs,\n        .monitor = control,\n        .nttyPaths = nttyPaths,\n        .ttyPaths = ttyPaths,\n        .handshakefd = handshakefd,\n        .nsInheritFDs = nsInheritFDs,\n    };\n\n    /* allocate a stack for the container */\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    stacktop = stack + stacksize;\n\n    cflags = CLONE_NEWPID|CLONE_NEWNS|SIGCHLD;\n\n    if (userns_required(def)) {\n        if (virProcessNamespaceAvailable(VIR_PROCESS_NAMESPACE_USER) < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Kernel doesn't support user namespace\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Enable user namespace\");\n        cflags |= CLONE_NEWUSER;\n    }\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHARENET] == -1) {\n        if (lxcNeedNetworkNamespace(def)) {\n            VIR_DEBUG(\"Enable network namespaces\");\n            cflags |= CLONE_NEWNET;\n        }\n    } else {\n        if (lxcNeedNetworkNamespace(def)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Config asks for inherit net namespace \"\n                             \"as well as private network interfaces\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Inheriting a net namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREIPC] == -1) {\n        cflags |= CLONE_NEWIPC;\n    } else {\n        VIR_DEBUG(\"Inheriting an IPC namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS] == -1) {\n        cflags |= CLONE_NEWUTS;\n    } else {\n        VIR_DEBUG(\"Inheriting a UTS namespace\");\n    }\n\n    VIR_DEBUG(\"Cloning container init process\");\n    pid = clone(lxcContainerChild, stacktop, cflags, &args);\n    VIR_FREE(stack);\n    VIR_DEBUG(\"clone() completed, new container PID is %d\", pid);\n\n    if (pid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to run clone container\"));\n        return -1;\n    }\n\n    return pid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcSetPersonality",
          "args": [
            "ctrl->def"
          ],
          "line": 2410
        },
        "resolved": true,
        "details": {
          "function_name": "lxcSetPersonality",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2064-2082",
          "snippet": "static int lxcSetPersonality(virDomainDefPtr def)\n{\n    virArch altArch;\n\n    VIR_DEBUG(\"Checking for 32-bit personality\");\n    altArch = lxcContainerGetAlt32bitArch(virArchFromHost());\n    if (altArch &&\n        (def->os.arch == altArch)) {\n        VIR_DEBUG(\"Setting personality to %s\",\n                  virArchToString(altArch));\n        if (personality(PER_LINUX32) < 0) {\n            virReportSystemError(errno, _(\"Unable to request personality for %s on %s\"),\n                                 virArchToString(altArch),\n                                 virArchToString(virArchFromHost()));\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int lxcSetPersonality(virDomainDefPtr def)\n{\n    virArch altArch;\n\n    VIR_DEBUG(\"Checking for 32-bit personality\");\n    altArch = lxcContainerGetAlt32bitArch(virArchFromHost());\n    if (altArch &&\n        (def->os.arch == altArch)) {\n        VIR_DEBUG(\"Setting personality to %s\",\n                  virArchToString(altArch));\n        if (personality(PER_LINUX32) < 0) {\n            virReportSystemError(errno, _(\"Unable to request personality for %s on %s\"),\n                                 virArchToString(altArch),\n                                 virArchToString(virArchFromHost()));\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupConsoles",
          "args": [
            "ctrl",
            "containerTTYPaths"
          ],
          "line": 2407
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupConsoles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2231-2256",
          "snippet": "static int\nvirLXCControllerSetupConsoles(virLXCControllerPtr ctrl,\n                              char **containerTTYPaths)\n{\n    size_t i;\n    g_autofree char *ttyHostPath = NULL;\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        VIR_DEBUG(\"Opening tty on private %s\", ctrl->devptmx);\n        if (lxcCreateTty(ctrl,\n                         &ctrl->consoles[i].contFd,\n                         &containerTTYPaths[i], &ttyHostPath) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Failed to allocate tty\"));\n            return -1;\n        }\n\n        /* Change the owner of tty device to the root user of container */\n        if (lxcContainerChown(ctrl->def, ttyHostPath) < 0)\n            return -1;\n\n        VIR_FREE(ttyHostPath);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupConsoles(virLXCControllerPtr ctrl,\n                              char **containerTTYPaths)\n{\n    size_t i;\n    g_autofree char *ttyHostPath = NULL;\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        VIR_DEBUG(\"Opening tty on private %s\", ctrl->devptmx);\n        if (lxcCreateTty(ctrl,\n                         &ctrl->consoles[i].contFd,\n                         &containerTTYPaths[i], &ttyHostPath) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Failed to allocate tty\"));\n            return -1;\n        }\n\n        /* Change the owner of tty device to the root user of container */\n        if (lxcContainerChown(ctrl->def, ttyHostPath) < 0)\n            return -1;\n\n        VIR_FREE(ttyHostPath);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupFuse",
          "args": [
            "ctrl"
          ],
          "line": 2404
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2219-2223",
          "snippet": "static int\nvirLXCControllerSetupFuse(virLXCControllerPtr ctrl)\n{\n    return lxcSetupFuse(&ctrl->fuse, ctrl->def);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupFuse(virLXCControllerPtr ctrl)\n{\n    return lxcSetupFuse(&ctrl->fuse, ctrl->def);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupAllHostdevs",
          "args": [
            "ctrl"
          ],
          "line": 2401
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupAllHostdevs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1873-1906",
          "snippet": "static int\nvirLXCControllerSetupAllHostdevs(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr vmDef = ctrl->def;\n    virSecurityManagerPtr securityDriver = ctrl->securityManager;\n    VIR_DEBUG(\"Setting up hostdevs\");\n\n    for (i = 0; i < vmDef->nhostdevs; i++) {\n        virDomainHostdevDefPtr def = vmDef->hostdevs[i];\n        switch (def->mode) {\n        case VIR_DOMAIN_HOSTDEV_MODE_SUBSYS:\n            if (virLXCControllerSetupHostdevSubsys(vmDef,\n                                                   def,\n                                                   securityDriver) < 0)\n                return -1;\n            break;\n        case VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES:\n            if (virLXCControllerSetupHostdevCaps(vmDef,\n                                                 def,\n                                                 securityDriver) < 0)\n                return -1;\n            break;\n        default:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported host device mode %s\"),\n                           virDomainHostdevModeTypeToString(def->mode));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all hostdevs\");\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupAllHostdevs(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr vmDef = ctrl->def;\n    virSecurityManagerPtr securityDriver = ctrl->securityManager;\n    VIR_DEBUG(\"Setting up hostdevs\");\n\n    for (i = 0; i < vmDef->nhostdevs; i++) {\n        virDomainHostdevDefPtr def = vmDef->hostdevs[i];\n        switch (def->mode) {\n        case VIR_DOMAIN_HOSTDEV_MODE_SUBSYS:\n            if (virLXCControllerSetupHostdevSubsys(vmDef,\n                                                   def,\n                                                   securityDriver) < 0)\n                return -1;\n            break;\n        case VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES:\n            if (virLXCControllerSetupHostdevCaps(vmDef,\n                                                 def,\n                                                 securityDriver) < 0)\n                return -1;\n            break;\n        default:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported host device mode %s\"),\n                           virDomainHostdevModeTypeToString(def->mode));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all hostdevs\");\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupAllDisks",
          "args": [
            "ctrl"
          ],
          "line": 2398
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupAllDisks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1986-1999",
          "snippet": "static int virLXCControllerSetupAllDisks(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    VIR_DEBUG(\"Setting up disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        if (virLXCControllerSetupDisk(ctrl, ctrl->def->disks[i],\n                                      ctrl->securityManager) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Setup all disks\");\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupAllDisks(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    VIR_DEBUG(\"Setting up disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        if (virLXCControllerSetupDisk(ctrl, ctrl->def->disks[i],\n                                      ctrl->securityManager) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Setup all disks\");\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupTimers",
          "args": [
            "ctrl"
          ],
          "line": 2395
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupTimers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1533-1601",
          "snippet": "static int\nvirLXCControllerSetupTimers(virLXCControllerPtr ctrl)\n{\n    virDomainDefPtr def = ctrl->def;\n    size_t i;\n\n    /* Not sync'ed with Host clock */\n    if (def->clock.offset != VIR_DOMAIN_CLOCK_OFFSET_LOCALTIME)\n        return 0;\n\n    for (i = 0; i < def->clock.ntimers; i++) {\n        virDomainTimerDefPtr timer = def->clock.timers[i];\n        g_autofree char *path = NULL;\n        const char *timer_dev = NULL;\n        struct stat sb;\n        dev_t dev;\n\n        /* Check if \"present\" is set to \"no\" otherwise enable it. */\n        if (!timer->present)\n            continue;\n\n        switch ((virDomainTimerNameType)timer->name) {\n        case VIR_DOMAIN_TIMER_NAME_PLATFORM:\n        case VIR_DOMAIN_TIMER_NAME_TSC:\n        case VIR_DOMAIN_TIMER_NAME_KVMCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_HYPERVCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_PIT:\n        case VIR_DOMAIN_TIMER_NAME_ARMVTIMER:\n        case VIR_DOMAIN_TIMER_NAME_LAST:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"unsupported timer type (name) '%s'\"),\n                           virDomainTimerNameTypeToString(timer->name));\n            return -1;\n        case VIR_DOMAIN_TIMER_NAME_RTC:\n            timer_dev = \"/dev/rtc0\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   def->name, \"/rtc\");\n            break;\n        case VIR_DOMAIN_TIMER_NAME_HPET:\n            timer_dev = \"/dev/hpet\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   ctrl->def->name, \"/hpet\");\n            break;\n        }\n\n        if (!timer_dev)\n            continue;\n\n        if (stat(timer_dev, &sb) < 0) {\n            virReportSystemError(errno, _(\"Unable to access %s\"),\n                                 timer_dev);\n            return -1;\n        }\n\n        dev = makedev(major(sb.st_rdev), minor(sb.st_rdev));\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, sb.st_mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupTimers(virLXCControllerPtr ctrl)\n{\n    virDomainDefPtr def = ctrl->def;\n    size_t i;\n\n    /* Not sync'ed with Host clock */\n    if (def->clock.offset != VIR_DOMAIN_CLOCK_OFFSET_LOCALTIME)\n        return 0;\n\n    for (i = 0; i < def->clock.ntimers; i++) {\n        virDomainTimerDefPtr timer = def->clock.timers[i];\n        g_autofree char *path = NULL;\n        const char *timer_dev = NULL;\n        struct stat sb;\n        dev_t dev;\n\n        /* Check if \"present\" is set to \"no\" otherwise enable it. */\n        if (!timer->present)\n            continue;\n\n        switch ((virDomainTimerNameType)timer->name) {\n        case VIR_DOMAIN_TIMER_NAME_PLATFORM:\n        case VIR_DOMAIN_TIMER_NAME_TSC:\n        case VIR_DOMAIN_TIMER_NAME_KVMCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_HYPERVCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_PIT:\n        case VIR_DOMAIN_TIMER_NAME_ARMVTIMER:\n        case VIR_DOMAIN_TIMER_NAME_LAST:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"unsupported timer type (name) '%s'\"),\n                           virDomainTimerNameTypeToString(timer->name));\n            return -1;\n        case VIR_DOMAIN_TIMER_NAME_RTC:\n            timer_dev = \"/dev/rtc0\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   def->name, \"/rtc\");\n            break;\n        case VIR_DOMAIN_TIMER_NAME_HPET:\n            timer_dev = \"/dev/hpet\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   ctrl->def->name, \"/hpet\");\n            break;\n        }\n\n        if (!timer_dev)\n            continue;\n\n        if (stat(timer_dev, &sb) < 0) {\n            virReportSystemError(errno, _(\"Unable to access %s\"),\n                                 timer_dev);\n            return -1;\n        }\n\n        dev = makedev(major(sb.st_rdev), minor(sb.st_rdev));\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, sb.st_mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerPopulateDevices",
          "args": [
            "ctrl"
          ],
          "line": 2392
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerPopulateDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1490-1530",
          "snippet": "static int virLXCControllerPopulateDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    g_autofree char *path = NULL;\n    const struct {\n        int maj;\n        int min;\n        mode_t mode;\n        const char *path;\n    } devs[] = {\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_NULL, 0666, \"/null\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_ZERO, 0666, \"/zero\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_FULL, 0666, \"/full\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_RANDOM, 0666, \"/random\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_URANDOM, 0666, \"/urandom\" },\n        { LXC_DEV_MAJ_TTY, LXC_DEV_MIN_TTY, 0666, \"/tty\" },\n    };\n\n    if (virLXCControllerSetupDev(ctrl) < 0)\n        return -1;\n\n    /* Populate /dev/ with a few important bits */\n    for (i = 0; i < G_N_ELEMENTS(devs); i++) {\n        path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                               devs[i].path);\n\n        dev_t dev = makedev(devs[i].maj, devs[i].min);\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, devs[i].mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(ctrl->def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerPopulateDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    g_autofree char *path = NULL;\n    const struct {\n        int maj;\n        int min;\n        mode_t mode;\n        const char *path;\n    } devs[] = {\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_NULL, 0666, \"/null\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_ZERO, 0666, \"/zero\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_FULL, 0666, \"/full\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_RANDOM, 0666, \"/random\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_URANDOM, 0666, \"/urandom\" },\n        { LXC_DEV_MAJ_TTY, LXC_DEV_MIN_TTY, 0666, \"/tty\" },\n    };\n\n    if (virLXCControllerSetupDev(ctrl) < 0)\n        return -1;\n\n    /* Populate /dev/ with a few important bits */\n    for (i = 0; i < G_N_ELEMENTS(devs); i++) {\n        path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                               devs[i].path);\n\n        dev_t dev = makedev(devs[i].maj, devs[i].min);\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, devs[i].mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(ctrl->def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupDevPTS",
          "args": [
            "ctrl"
          ],
          "line": 2389
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupDevPTS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2163-2216",
          "snippet": "static int\nvirLXCControllerSetupDevPTS(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *devpts = NULL;\n    gid_t ptsgid = 5;\n\n    VIR_DEBUG(\"Setting up private /dev/pts\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    devpts = g_strdup_printf(\"%s/%s.devpts\", LXC_STATE_DIR, ctrl->def->name);\n    ctrl->devptmx = g_strdup_printf(\"%s/%s.devpts/ptmx\", LXC_STATE_DIR, ctrl->def->name);\n\n    if (virFileMakePath(devpts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to make path %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (ctrl->def->idmap.ngidmap)\n        ptsgid = virLXCControllerLookupUsernsMap(ctrl->def->idmap.gidmap,\n                                                 ctrl->def->idmap.ngidmap,\n                                                 ptsgid);\n\n    /* XXX should we support gid=X for X!=5 for distros which use\n     * a different gid for tty?  */\n    opts = g_strdup_printf(\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\", ptsgid,\n                           NULLSTR_EMPTY(mount_options));\n\n    VIR_DEBUG(\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\",\n              devpts, MS_NOSUID, opts);\n    if (mount(\"devpts\", devpts, \"devpts\", MS_NOSUID, opts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount devpts on %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (access(ctrl->devptmx, R_OK) < 0) {\n        virReportSystemError(ENOSYS, \"%s\",\n                             _(\"Kernel does not support private devpts\"));\n        return -1;\n    }\n\n    if ((lxcContainerChown(ctrl->def, ctrl->devptmx) < 0) ||\n        (lxcContainerChown(ctrl->def, devpts) < 0))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupDevPTS(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *devpts = NULL;\n    gid_t ptsgid = 5;\n\n    VIR_DEBUG(\"Setting up private /dev/pts\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    devpts = g_strdup_printf(\"%s/%s.devpts\", LXC_STATE_DIR, ctrl->def->name);\n    ctrl->devptmx = g_strdup_printf(\"%s/%s.devpts/ptmx\", LXC_STATE_DIR, ctrl->def->name);\n\n    if (virFileMakePath(devpts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to make path %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (ctrl->def->idmap.ngidmap)\n        ptsgid = virLXCControllerLookupUsernsMap(ctrl->def->idmap.gidmap,\n                                                 ctrl->def->idmap.ngidmap,\n                                                 ptsgid);\n\n    /* XXX should we support gid=X for X!=5 for distros which use\n     * a different gid for tty?  */\n    opts = g_strdup_printf(\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\", ptsgid,\n                           NULLSTR_EMPTY(mount_options));\n\n    VIR_DEBUG(\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\",\n              devpts, MS_NOSUID, opts);\n    if (mount(\"devpts\", devpts, \"devpts\", MS_NOSUID, opts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount devpts on %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (access(ctrl->devptmx, R_OK) < 0) {\n        virReportSystemError(ENOSYS, \"%s\",\n                             _(\"Kernel does not support private devpts\"));\n        return -1;\n    }\n\n    if ((lxcContainerChown(ctrl->def, ctrl->devptmx) < 0) ||\n        (lxcContainerChown(ctrl->def, devpts) < 0))\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupResourceLimits",
          "args": [
            "ctrl"
          ],
          "line": 2386
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupResourceLimits",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "839-874",
          "snippet": "static int virLXCControllerSetupResourceLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    virDomainNumatuneMemMode mode;\n\n    if (virDomainNumatuneGetMode(ctrl->def->numa, -1, &mode) == 0) {\n        if (mode == VIR_DOMAIN_NUMATUNE_MEM_STRICT &&\n            virCgroupControllerAvailable(VIR_CGROUP_CONTROLLER_CPUSET)) {\n            /* Use virNuma* API iff necessary. Once set and child is exec()-ed,\n             * there's no way for us to change it. Rely on cgroups (if available\n             * and enabled in the config) rather than virNuma*. */\n            VIR_DEBUG(\"Relying on CGroups for memory binding\");\n        } else {\n\n            VIR_DEBUG(\"Setting up process resource limits\");\n\n            if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n                goto cleanup;\n\n            nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n            if (virNumaSetupMemoryPolicy(mode, nodeset) < 0)\n                goto cleanup;\n        }\n    }\n\n    if (virLXCControllerSetupCpuAffinity(ctrl) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupResourceLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    virDomainNumatuneMemMode mode;\n\n    if (virDomainNumatuneGetMode(ctrl->def->numa, -1, &mode) == 0) {\n        if (mode == VIR_DOMAIN_NUMATUNE_MEM_STRICT &&\n            virCgroupControllerAvailable(VIR_CGROUP_CONTROLLER_CPUSET)) {\n            /* Use virNuma* API iff necessary. Once set and child is exec()-ed,\n             * there's no way for us to change it. Rely on cgroups (if available\n             * and enabled in the config) rather than virNuma*. */\n            VIR_DEBUG(\"Relying on CGroups for memory binding\");\n        } else {\n\n            VIR_DEBUG(\"Setting up process resource limits\");\n\n            if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n                goto cleanup;\n\n            nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n            if (virNumaSetupMemoryPolicy(mode, nodeset) < 0)\n                goto cleanup;\n        }\n    }\n\n    if (virLXCControllerSetupCpuAffinity(ctrl) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupLoopDevices",
          "args": [
            "ctrl"
          ],
          "line": 2383
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupLoopDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "626-751",
          "snippet": "static int virLXCControllerSetupLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Setting up loop devices for filesystems\");\n\n    for (i = 0; i < ctrl->def->nfss; i++) {\n        virDomainFSDefPtr fs = ctrl->def->fss[i];\n        int fd;\n\n        if (fs->type != VIR_DOMAIN_FS_TYPE_FILE)\n            continue;\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_DEFAULT) {\n            if (fs->format == VIR_STORAGE_FILE_RAW ||\n                fs->format == VIR_STORAGE_FILE_NONE)\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_LOOP;\n            else\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_NBD;\n        }\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_LOOP) {\n            if (fs->format != VIR_STORAGE_FILE_RAW &&\n                fs->format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"fs format %s is not supported\"),\n                               virStorageFileFormatTypeToString(fs->format));\n                return -1;\n            }\n\n            fd = virLXCControllerSetupLoopDeviceFS(fs);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_NBD) {\n            if (virLXCControllerSetupNBDDeviceFS(fs) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, fs->src->path) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"fs driver %s is not supported\"),\n                           virDomainFSDriverTypeToString(fs->fsdriver));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setting up loop devices for disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        virDomainDiskDefPtr disk = ctrl->def->disks[i];\n        int fd;\n        const char *driver = virDomainDiskGetDriver(disk);\n        int format = virDomainDiskGetFormat(disk);\n\n        if (virDomainDiskGetType(disk) != VIR_STORAGE_TYPE_FILE)\n            continue;\n\n        /* If no driverName is set, we prefer 'loop' for\n         * dealing with raw or undefined formats, otherwise\n         * we use 'nbd'.\n         */\n        if (STREQ_NULLABLE(driver, \"loop\") ||\n            (!driver &&\n             (format == VIR_STORAGE_FILE_RAW ||\n              format == VIR_STORAGE_FILE_NONE))) {\n            if (format != VIR_STORAGE_FILE_RAW &&\n                format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"disk format %s is not supported\"),\n                               virStorageFileFormatTypeToString(format));\n                return -1;\n            }\n\n            /* We treat 'none' as meaning 'raw' since we\n             * don't want to go into the auto-probing\n             * business for security reasons\n             */\n            fd = virLXCControllerSetupLoopDeviceDisk(disk);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (!driver || STREQ(driver, \"nbd\")) {\n            if (disk->cachemode != VIR_DOMAIN_DISK_CACHE_DEFAULT &&\n                disk->cachemode != VIR_DOMAIN_DISK_CACHE_DISABLE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"Disk cache mode %s is not supported\"),\n                               virDomainDiskCacheTypeToString(disk->cachemode));\n                return -1;\n            }\n            if (virLXCControllerSetupNBDDeviceDisk(disk) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, virDomainDiskGetSource(disk)) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk driver %s is not supported\"),\n                           driver);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all loop devices\");\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Setting up loop devices for filesystems\");\n\n    for (i = 0; i < ctrl->def->nfss; i++) {\n        virDomainFSDefPtr fs = ctrl->def->fss[i];\n        int fd;\n\n        if (fs->type != VIR_DOMAIN_FS_TYPE_FILE)\n            continue;\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_DEFAULT) {\n            if (fs->format == VIR_STORAGE_FILE_RAW ||\n                fs->format == VIR_STORAGE_FILE_NONE)\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_LOOP;\n            else\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_NBD;\n        }\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_LOOP) {\n            if (fs->format != VIR_STORAGE_FILE_RAW &&\n                fs->format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"fs format %s is not supported\"),\n                               virStorageFileFormatTypeToString(fs->format));\n                return -1;\n            }\n\n            fd = virLXCControllerSetupLoopDeviceFS(fs);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_NBD) {\n            if (virLXCControllerSetupNBDDeviceFS(fs) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, fs->src->path) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"fs driver %s is not supported\"),\n                           virDomainFSDriverTypeToString(fs->fsdriver));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setting up loop devices for disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        virDomainDiskDefPtr disk = ctrl->def->disks[i];\n        int fd;\n        const char *driver = virDomainDiskGetDriver(disk);\n        int format = virDomainDiskGetFormat(disk);\n\n        if (virDomainDiskGetType(disk) != VIR_STORAGE_TYPE_FILE)\n            continue;\n\n        /* If no driverName is set, we prefer 'loop' for\n         * dealing with raw or undefined formats, otherwise\n         * we use 'nbd'.\n         */\n        if (STREQ_NULLABLE(driver, \"loop\") ||\n            (!driver &&\n             (format == VIR_STORAGE_FILE_RAW ||\n              format == VIR_STORAGE_FILE_NONE))) {\n            if (format != VIR_STORAGE_FILE_RAW &&\n                format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"disk format %s is not supported\"),\n                               virStorageFileFormatTypeToString(format));\n                return -1;\n            }\n\n            /* We treat 'none' as meaning 'raw' since we\n             * don't want to go into the auto-probing\n             * business for security reasons\n             */\n            fd = virLXCControllerSetupLoopDeviceDisk(disk);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (!driver || STREQ(driver, \"nbd\")) {\n            if (disk->cachemode != VIR_DOMAIN_DISK_CACHE_DEFAULT &&\n                disk->cachemode != VIR_DOMAIN_DISK_CACHE_DISABLE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"Disk cache mode %s is not supported\"),\n                               virDomainDiskCacheTypeToString(disk->cachemode));\n                return -1;\n            }\n            if (virLXCControllerSetupNBDDeviceDisk(disk) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, virDomainDiskGetSource(disk)) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk driver %s is not supported\"),\n                           driver);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all loop devices\");\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupPrivateNS",
          "args": [],
          "line": 2380
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupPrivateNS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2135-2160",
          "snippet": "static int\nvirLXCControllerSetupPrivateNS(void)\n{\n    /*\n     * If doing a chroot style setup, we need to prepare\n     * a private /dev/pts for the child now, which they\n     * will later move into position.\n     *\n     * This is complex because 'virsh console' needs to\n     * use /dev/pts from the host OS, and the guest OS\n     * needs to use /dev/pts from the guest.\n     *\n     * This means that we (libvirt_lxc) need to see and\n     * use both /dev/pts instances. We're running in the\n     * host OS context though and don't want to expose\n     * the guest OS /dev/pts there.\n     *\n     * Thus we call unshare(CLONE_NS) so that we can see\n     * the guest's new /dev/pts, without it becoming\n     * visible to the host OS. We also put the root FS\n     * into slave mode, just in case it was currently\n     * marked as shared\n     */\n\n    return virProcessSetupPrivateMountNS();\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupPrivateNS(void)\n{\n    /*\n     * If doing a chroot style setup, we need to prepare\n     * a private /dev/pts for the child now, which they\n     * will later move into position.\n     *\n     * This is complex because 'virsh console' needs to\n     * use /dev/pts from the host OS, and the guest OS\n     * needs to use /dev/pts from the guest.\n     *\n     * This means that we (libvirt_lxc) need to see and\n     * use both /dev/pts instances. We're running in the\n     * host OS context though and don't want to expose\n     * the guest OS /dev/pts there.\n     *\n     * Thus we call unshare(CLONE_NS) so that we can see\n     * the guest's new /dev/pts, without it becoming\n     * visible to the host OS. We also put the root FS\n     * into slave mode, just in case it was currently\n     * marked as shared\n     */\n\n    return virProcessSetupPrivateMountNS();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"socketpair failed\")"
          ],
          "line": 2375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socketpair",
          "args": [
            "PF_UNIX",
            "SOCK_STREAM",
            "0",
            "containerhandshake"
          ],
          "line": 2374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"sockpair failed\")"
          ],
          "line": 2369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socketpair",
          "args": [
            "PF_UNIX",
            "SOCK_STREAM",
            "0",
            "control"
          ],
          "line": 2368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "containerTTYPaths",
            "ctrl->nconsoles"
          ],
          "line": 2365
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int\nvirLXCControllerRun(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    int control[2] = { -1, -1};\n    int containerhandshake[2] = { -1, -1 };\n    char **containerTTYPaths = NULL;\n    size_t i;\n\n    if (VIR_ALLOC_N(containerTTYPaths, ctrl->nconsoles) < 0)\n        goto cleanup;\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, control) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sockpair failed\"));\n        goto cleanup;\n    }\n\n    if (socketpair(PF_UNIX, SOCK_STREAM, 0, containerhandshake) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"socketpair failed\"));\n        goto cleanup;\n    }\n\n    if (virLXCControllerSetupPrivateNS() < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupLoopDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupResourceLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupDevPTS(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerPopulateDevices(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupTimers(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllDisks(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupAllHostdevs(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupConsoles(ctrl, containerTTYPaths) < 0)\n        goto cleanup;\n\n    if (lxcSetPersonality(ctrl->def) < 0)\n        goto cleanup;\n\n    if ((ctrl->initpid = lxcContainerStart(ctrl->def,\n                                           ctrl->securityManager,\n                                           ctrl->nveths,\n                                           ctrl->veths,\n                                           ctrl->npassFDs,\n                                           ctrl->passFDs,\n                                           control[1],\n                                           containerhandshake[1],\n                                           ctrl->nsFDs,\n                                           ctrl->nconsoles,\n                                           containerTTYPaths)) < 0)\n        goto cleanup;\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n\n    if (ctrl->nsFDs)\n        for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n            VIR_FORCE_CLOSE(ctrl->nsFDs[i]);\n\n    if (virLXCControllerSetupCgroupLimits(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerSetupUserns(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerMoveInterfaces(ctrl) < 0)\n        goto cleanup;\n\n    if (virLXCControllerStartFuse(ctrl) < 0)\n        goto cleanup;\n\n    if (lxcContainerSendContinue(control[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to send container continue message\"));\n        goto cleanup;\n    }\n\n    if (lxcContainerWaitForContinue(containerhandshake[0]) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error receiving signal from container\"));\n        goto cleanup;\n    }\n\n    /* ...and reduce our privileges */\n    if (lxcControllerClearCapabilities() < 0)\n        goto cleanup;\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        if (virLXCControllerConsoleSetNonblocking(&(ctrl->consoles[i])) < 0)\n            goto cleanup;\n\n    if (virLXCControllerDaemonHandshake(ctrl) < 0)\n        goto cleanup;\n\n    /* We must not hold open a dbus connection for life\n     * of LXC instance, since dbus-daemon is limited to\n     * only a few 100 connections by default\n     */\n    virDBusCloseSystemBus();\n\n    rc = virLXCControllerMain(ctrl);\n\n    virLXCControllerEventSendExit(ctrl, rc);\n\n cleanup:\n    VIR_FORCE_CLOSE(control[0]);\n    VIR_FORCE_CLOSE(control[1]);\n    VIR_FORCE_CLOSE(containerhandshake[0]);\n    VIR_FORCE_CLOSE(containerhandshake[1]);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        VIR_FREE(containerTTYPaths[i]);\n    VIR_FREE(containerTTYPaths);\n\n    virLXCControllerStopInit(ctrl);\n\n    return rc;\n}"
  },
  {
    "function_name": "virLXCControllerEventSendInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2338-2353",
    "snippet": "static int\nvirLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                              pid_t initpid)\n{\n    virLXCMonitorInitEventMsg msg;\n\n    VIR_DEBUG(\"Init pid %lld\", (long long)initpid);\n    memset(&msg, 0, sizeof(msg));\n    msg.initpid = initpid;\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_INIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorInitEventMsg,\n                              (void*)&msg);\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerEventSend",
          "args": [
            "ctrl",
            "VIR_LXC_MONITOR_PROC_INIT_EVENT",
            "(xdrproc_t)xdr_virLXCMonitorInitEventMsg",
            "(void*)&msg"
          ],
          "line": 2348
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerEventSend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2259-2299",
          "snippet": "static void\nvirLXCControllerEventSend(virLXCControllerPtr ctrl,\n                          int procnr,\n                          xdrproc_t proc,\n                          void *data)\n{\n    virNetMessagePtr msg;\n\n    if (!ctrl->client) {\n        VIR_WARN(\"Dropping event %d because libvirtd is not connected\", procnr);\n        return;\n    }\n\n    VIR_DEBUG(\"Send event %d client=%p\", procnr, ctrl->client);\n    if (!(msg = virNetMessageNew(false)))\n        goto error;\n\n    msg->header.prog = virNetServerProgramGetID(ctrl->prog);\n    msg->header.vers = virNetServerProgramGetVersion(ctrl->prog);\n    msg->header.proc = procnr;\n    msg->header.type = VIR_NET_MESSAGE;\n    msg->header.serial = 1;\n    msg->header.status = VIR_NET_OK;\n\n    if (virNetMessageEncodeHeader(msg) < 0)\n        goto error;\n\n    if (virNetMessageEncodePayload(msg, proc, data) < 0)\n        goto error;\n\n    VIR_DEBUG(\"Queue event %d %zu\", procnr, msg->bufferLength);\n    if (virNetServerClientSendMessage(ctrl->client, msg) < 0)\n        goto error;\n\n    xdr_free(proc, data);\n    return;\n\n error:\n    virNetMessageFree(msg);\n    xdr_free(proc, data);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void\nvirLXCControllerEventSend(virLXCControllerPtr ctrl,\n                          int procnr,\n                          xdrproc_t proc,\n                          void *data)\n{\n    virNetMessagePtr msg;\n\n    if (!ctrl->client) {\n        VIR_WARN(\"Dropping event %d because libvirtd is not connected\", procnr);\n        return;\n    }\n\n    VIR_DEBUG(\"Send event %d client=%p\", procnr, ctrl->client);\n    if (!(msg = virNetMessageNew(false)))\n        goto error;\n\n    msg->header.prog = virNetServerProgramGetID(ctrl->prog);\n    msg->header.vers = virNetServerProgramGetVersion(ctrl->prog);\n    msg->header.proc = procnr;\n    msg->header.type = VIR_NET_MESSAGE;\n    msg->header.serial = 1;\n    msg->header.status = VIR_NET_OK;\n\n    if (virNetMessageEncodeHeader(msg) < 0)\n        goto error;\n\n    if (virNetMessageEncodePayload(msg, proc, data) < 0)\n        goto error;\n\n    VIR_DEBUG(\"Queue event %d %zu\", procnr, msg->bufferLength);\n    if (virNetServerClientSendMessage(ctrl->client, msg) < 0)\n        goto error;\n\n    xdr_free(proc, data);\n    return;\n\n error:\n    virNetMessageFree(msg);\n    xdr_free(proc, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&msg",
            "0",
            "sizeof(msg)"
          ],
          "line": 2345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Init pid %lld\"",
            "(long long)initpid"
          ],
          "line": 2344
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int\nvirLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                              pid_t initpid)\n{\n    virLXCMonitorInitEventMsg msg;\n\n    VIR_DEBUG(\"Init pid %lld\", (long long)initpid);\n    memset(&msg, 0, sizeof(msg));\n    msg.initpid = initpid;\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_INIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorInitEventMsg,\n                              (void*)&msg);\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerEventSendExit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2302-2335",
    "snippet": "static int\nvirLXCControllerEventSendExit(virLXCControllerPtr ctrl,\n                              int exitstatus)\n{\n    virLXCMonitorExitEventMsg msg;\n\n    VIR_DEBUG(\"Exit status %d (client=%p)\", exitstatus, ctrl->client);\n    memset(&msg, 0, sizeof(msg));\n    switch (exitstatus) {\n    case 0:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_SHUTDOWN;\n        break;\n    case 1:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_REBOOT;\n        break;\n    default:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_ERROR;\n        break;\n    }\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_EXIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorExitEventMsg,\n                              (void*)&msg);\n\n    if (ctrl->client) {\n        VIR_DEBUG(\"Waiting for client to complete dispatch\");\n        ctrl->inShutdown = true;\n        virNetServerClientDelayedClose(ctrl->client);\n        virNetDaemonRun(ctrl->daemon);\n    }\n    VIR_DEBUG(\"Client has gone away\");\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Client has gone away\""
          ],
          "line": 2333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDaemonRun",
          "args": [
            "ctrl->daemon"
          ],
          "line": 2331
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "799-864",
          "snippet": "void\nvirNetDaemonRun(virNetDaemonPtr dmn)\n{\n    int timerid = -1;\n    bool timerActive = false;\n\n    virObjectLock(dmn);\n\n    if (dmn->srvObject) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Not all servers restored, cannot run server\"));\n        goto cleanup;\n    }\n\n    dmn->quit = false;\n\n    if (dmn->autoShutdownTimeout &&\n        (timerid = virEventAddTimeout(-1,\n                                      virNetDaemonAutoShutdownTimer,\n                                      dmn, NULL)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to register shutdown timeout\"));\n        goto cleanup;\n    }\n\n    /* We are accepting connections now. Notify systemd\n     * so it can start dependent services. */\n    virSystemdNotifyStartup();\n\n    VIR_DEBUG(\"dmn=%p quit=%d\", dmn, dmn->quit);\n    while (!dmn->quit) {\n        /* A shutdown timeout is specified, so check\n         * if any drivers have active state, if not\n         * shutdown after timeout seconds\n         */\n        if (dmn->autoShutdownTimeout) {\n            if (timerActive) {\n                if (virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Deactivating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid, -1);\n                    timerActive = false;\n                }\n            } else {\n                if (!virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Activating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid,\n                                          dmn->autoShutdownTimeout * 1000);\n                    timerActive = true;\n                }\n            }\n        }\n\n        virObjectUnlock(dmn);\n        if (virEventRunDefaultImpl() < 0) {\n            virObjectLock(dmn);\n            VIR_DEBUG(\"Loop iteration error, exiting\");\n            break;\n        }\n        virObjectLock(dmn);\n\n        virHashForEach(dmn->servers, daemonServerProcessClients, NULL);\n    }\n\n cleanup:\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonRun(virNetDaemonPtr dmn)\n{\n    int timerid = -1;\n    bool timerActive = false;\n\n    virObjectLock(dmn);\n\n    if (dmn->srvObject) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Not all servers restored, cannot run server\"));\n        goto cleanup;\n    }\n\n    dmn->quit = false;\n\n    if (dmn->autoShutdownTimeout &&\n        (timerid = virEventAddTimeout(-1,\n                                      virNetDaemonAutoShutdownTimer,\n                                      dmn, NULL)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to register shutdown timeout\"));\n        goto cleanup;\n    }\n\n    /* We are accepting connections now. Notify systemd\n     * so it can start dependent services. */\n    virSystemdNotifyStartup();\n\n    VIR_DEBUG(\"dmn=%p quit=%d\", dmn, dmn->quit);\n    while (!dmn->quit) {\n        /* A shutdown timeout is specified, so check\n         * if any drivers have active state, if not\n         * shutdown after timeout seconds\n         */\n        if (dmn->autoShutdownTimeout) {\n            if (timerActive) {\n                if (virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Deactivating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid, -1);\n                    timerActive = false;\n                }\n            } else {\n                if (!virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Activating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid,\n                                          dmn->autoShutdownTimeout * 1000);\n                    timerActive = true;\n                }\n            }\n        }\n\n        virObjectUnlock(dmn);\n        if (virEventRunDefaultImpl() < 0) {\n            virObjectLock(dmn);\n            VIR_DEBUG(\"Loop iteration error, exiting\");\n            break;\n        }\n        virObjectLock(dmn);\n\n        virHashForEach(dmn->servers, daemonServerProcessClients, NULL);\n    }\n\n cleanup:\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerClientDelayedClose",
          "args": [
            "ctrl->client"
          ],
          "line": 2330
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerClientDelayedClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverclient.c",
          "lines": "1076-1081",
          "snippet": "void virNetServerClientDelayedClose(virNetServerClientPtr client)\n{\n    virObjectLock(client);\n    client->delayedClose = true;\n    virObjectUnlock(client);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virkeepalive.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserver.h\"",
            "# include <sasl/sasl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virNetServerClientUpdateEvent(virNetServerClientPtr client);",
            "static virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virkeepalive.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserver.h\"\n# include <sasl/sasl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic void virNetServerClientUpdateEvent(virNetServerClientPtr client);\nstatic virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);\n\nvoid virNetServerClientDelayedClose(virNetServerClientPtr client)\n{\n    virObjectLock(client);\n    client->delayedClose = true;\n    virObjectUnlock(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Waiting for client to complete dispatch\""
          ],
          "line": 2328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerEventSend",
          "args": [
            "ctrl",
            "VIR_LXC_MONITOR_PROC_EXIT_EVENT",
            "(xdrproc_t)xdr_virLXCMonitorExitEventMsg",
            "(void*)&msg"
          ],
          "line": 2322
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerEventSend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2259-2299",
          "snippet": "static void\nvirLXCControllerEventSend(virLXCControllerPtr ctrl,\n                          int procnr,\n                          xdrproc_t proc,\n                          void *data)\n{\n    virNetMessagePtr msg;\n\n    if (!ctrl->client) {\n        VIR_WARN(\"Dropping event %d because libvirtd is not connected\", procnr);\n        return;\n    }\n\n    VIR_DEBUG(\"Send event %d client=%p\", procnr, ctrl->client);\n    if (!(msg = virNetMessageNew(false)))\n        goto error;\n\n    msg->header.prog = virNetServerProgramGetID(ctrl->prog);\n    msg->header.vers = virNetServerProgramGetVersion(ctrl->prog);\n    msg->header.proc = procnr;\n    msg->header.type = VIR_NET_MESSAGE;\n    msg->header.serial = 1;\n    msg->header.status = VIR_NET_OK;\n\n    if (virNetMessageEncodeHeader(msg) < 0)\n        goto error;\n\n    if (virNetMessageEncodePayload(msg, proc, data) < 0)\n        goto error;\n\n    VIR_DEBUG(\"Queue event %d %zu\", procnr, msg->bufferLength);\n    if (virNetServerClientSendMessage(ctrl->client, msg) < 0)\n        goto error;\n\n    xdr_free(proc, data);\n    return;\n\n error:\n    virNetMessageFree(msg);\n    xdr_free(proc, data);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void\nvirLXCControllerEventSend(virLXCControllerPtr ctrl,\n                          int procnr,\n                          xdrproc_t proc,\n                          void *data)\n{\n    virNetMessagePtr msg;\n\n    if (!ctrl->client) {\n        VIR_WARN(\"Dropping event %d because libvirtd is not connected\", procnr);\n        return;\n    }\n\n    VIR_DEBUG(\"Send event %d client=%p\", procnr, ctrl->client);\n    if (!(msg = virNetMessageNew(false)))\n        goto error;\n\n    msg->header.prog = virNetServerProgramGetID(ctrl->prog);\n    msg->header.vers = virNetServerProgramGetVersion(ctrl->prog);\n    msg->header.proc = procnr;\n    msg->header.type = VIR_NET_MESSAGE;\n    msg->header.serial = 1;\n    msg->header.status = VIR_NET_OK;\n\n    if (virNetMessageEncodeHeader(msg) < 0)\n        goto error;\n\n    if (virNetMessageEncodePayload(msg, proc, data) < 0)\n        goto error;\n\n    VIR_DEBUG(\"Queue event %d %zu\", procnr, msg->bufferLength);\n    if (virNetServerClientSendMessage(ctrl->client, msg) < 0)\n        goto error;\n\n    xdr_free(proc, data);\n    return;\n\n error:\n    virNetMessageFree(msg);\n    xdr_free(proc, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&msg",
            "0",
            "sizeof(msg)"
          ],
          "line": 2309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Exit status %d (client=%p)\"",
            "exitstatus",
            "ctrl->client"
          ],
          "line": 2308
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerEventSendExit(virLXCControllerPtr ctrl,\n                              int exitstatus)\n{\n    virLXCMonitorExitEventMsg msg;\n\n    VIR_DEBUG(\"Exit status %d (client=%p)\", exitstatus, ctrl->client);\n    memset(&msg, 0, sizeof(msg));\n    switch (exitstatus) {\n    case 0:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_SHUTDOWN;\n        break;\n    case 1:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_REBOOT;\n        break;\n    default:\n        msg.status = VIR_LXC_MONITOR_EXIT_STATUS_ERROR;\n        break;\n    }\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_EXIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorExitEventMsg,\n                              (void*)&msg);\n\n    if (ctrl->client) {\n        VIR_DEBUG(\"Waiting for client to complete dispatch\");\n        ctrl->inShutdown = true;\n        virNetServerClientDelayedClose(ctrl->client);\n        virNetDaemonRun(ctrl->daemon);\n    }\n    VIR_DEBUG(\"Client has gone away\");\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerEventSend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2259-2299",
    "snippet": "static void\nvirLXCControllerEventSend(virLXCControllerPtr ctrl,\n                          int procnr,\n                          xdrproc_t proc,\n                          void *data)\n{\n    virNetMessagePtr msg;\n\n    if (!ctrl->client) {\n        VIR_WARN(\"Dropping event %d because libvirtd is not connected\", procnr);\n        return;\n    }\n\n    VIR_DEBUG(\"Send event %d client=%p\", procnr, ctrl->client);\n    if (!(msg = virNetMessageNew(false)))\n        goto error;\n\n    msg->header.prog = virNetServerProgramGetID(ctrl->prog);\n    msg->header.vers = virNetServerProgramGetVersion(ctrl->prog);\n    msg->header.proc = procnr;\n    msg->header.type = VIR_NET_MESSAGE;\n    msg->header.serial = 1;\n    msg->header.status = VIR_NET_OK;\n\n    if (virNetMessageEncodeHeader(msg) < 0)\n        goto error;\n\n    if (virNetMessageEncodePayload(msg, proc, data) < 0)\n        goto error;\n\n    VIR_DEBUG(\"Queue event %d %zu\", procnr, msg->bufferLength);\n    if (virNetServerClientSendMessage(ctrl->client, msg) < 0)\n        goto error;\n\n    xdr_free(proc, data);\n    return;\n\n error:\n    virNetMessageFree(msg);\n    xdr_free(proc, data);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "proc",
            "data"
          ],
          "line": 2298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetMessageFree",
          "args": [
            "msg"
          ],
          "line": 2297
        },
        "resolved": true,
        "details": {
          "function_name": "virNetMessageFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetmessage.c",
          "lines": "81-93",
          "snippet": "void virNetMessageFree(virNetMessagePtr msg)\n{\n    if (!msg)\n        return;\n\n    VIR_DEBUG(\"msg=%p nfds=%zu cb=%p\", msg, msg->nfds, msg->cb);\n\n    if (msg->cb)\n        msg->cb(msg, msg->opaque);\n\n    virNetMessageClearPayload(msg);\n    VIR_FREE(msg);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetmessage.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetmessage.h\"\n#include <unistd.h>\n#include <config.h>\n\nvoid virNetMessageFree(virNetMessagePtr msg)\n{\n    if (!msg)\n        return;\n\n    VIR_DEBUG(\"msg=%p nfds=%zu cb=%p\", msg, msg->nfds, msg->cb);\n\n    if (msg->cb)\n        msg->cb(msg, msg->opaque);\n\n    virNetMessageClearPayload(msg);\n    VIR_FREE(msg);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "proc",
            "data"
          ],
          "line": 2293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetServerClientSendMessage",
          "args": [
            "ctrl->client",
            "msg"
          ],
          "line": 2290
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerClientSendMessage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverclient.c",
          "lines": "1528-1538",
          "snippet": "int virNetServerClientSendMessage(virNetServerClientPtr client,\n                                  virNetMessagePtr msg)\n{\n    int ret;\n\n    virObjectLock(client);\n    ret = virNetServerClientSendMessageLocked(client, msg);\n    virObjectUnlock(client);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virkeepalive.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserver.h\"",
            "# include <sasl/sasl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virNetServerClientUpdateEvent(virNetServerClientPtr client);",
            "static virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);",
            "static int virNetServerClientSendMessageLocked(virNetServerClientPtr client,\n                                               virNetMessagePtr msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virkeepalive.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserver.h\"\n# include <sasl/sasl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic void virNetServerClientUpdateEvent(virNetServerClientPtr client);\nstatic virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);\nstatic int virNetServerClientSendMessageLocked(virNetServerClientPtr client,\n                                               virNetMessagePtr msg);\n\nint virNetServerClientSendMessage(virNetServerClientPtr client,\n                                  virNetMessagePtr msg)\n{\n    int ret;\n\n    virObjectLock(client);\n    ret = virNetServerClientSendMessageLocked(client, msg);\n    virObjectUnlock(client);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Queue event %d %zu\"",
            "procnr",
            "msg->bufferLength"
          ],
          "line": 2289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetMessageEncodePayload",
          "args": [
            "msg",
            "proc",
            "data"
          ],
          "line": 2286
        },
        "resolved": true,
        "details": {
          "function_name": "virNetMessageEncodePayloadRaw",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetmessage.c",
          "lines": "435-484",
          "snippet": "int virNetMessageEncodePayloadRaw(virNetMessagePtr msg,\n                                  const char *data,\n                                  size_t len)\n{\n    XDR xdr;\n    unsigned int msglen;\n\n    /* If the message buffer is too small for the payload increase it accordingly. */\n    if ((msg->bufferLength - msg->bufferOffset) < len) {\n        if ((msg->bufferOffset + len) >\n            (VIR_NET_MESSAGE_MAX + VIR_NET_MESSAGE_LEN_MAX)) {\n            virReportError(VIR_ERR_RPC,\n                           _(\"Stream data too long to send \"\n                             \"(%zu bytes needed, %zu bytes available)\"),\n                           len,\n                           VIR_NET_MESSAGE_MAX +\n                           VIR_NET_MESSAGE_LEN_MAX -\n                           msg->bufferOffset);\n            return -1;\n        }\n\n        msg->bufferLength = msg->bufferOffset + len;\n\n        if (VIR_REALLOC_N(msg->buffer, msg->bufferLength) < 0)\n            return -1;\n\n        VIR_DEBUG(\"Increased message buffer length = %zu\", msg->bufferLength);\n    }\n\n    memcpy(msg->buffer + msg->bufferOffset, data, len);\n    msg->bufferOffset += len;\n\n    /* Re-encode the length word. */\n    VIR_DEBUG(\"Encode length as %zu\", msg->bufferOffset);\n    xdrmem_create(&xdr, msg->buffer, VIR_NET_MESSAGE_HEADER_XDR_LEN, XDR_ENCODE);\n    msglen = msg->bufferOffset;\n    if (!xdr_u_int(&xdr, &msglen)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to encode message length\"));\n        goto error;\n    }\n    xdr_destroy(&xdr);\n\n    msg->bufferLength = msg->bufferOffset;\n    msg->bufferOffset = 0;\n    return 0;\n\n error:\n    xdr_destroy(&xdr);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetmessage.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetmessage.h\"\n#include <unistd.h>\n#include <config.h>\n\nint virNetMessageEncodePayloadRaw(virNetMessagePtr msg,\n                                  const char *data,\n                                  size_t len)\n{\n    XDR xdr;\n    unsigned int msglen;\n\n    /* If the message buffer is too small for the payload increase it accordingly. */\n    if ((msg->bufferLength - msg->bufferOffset) < len) {\n        if ((msg->bufferOffset + len) >\n            (VIR_NET_MESSAGE_MAX + VIR_NET_MESSAGE_LEN_MAX)) {\n            virReportError(VIR_ERR_RPC,\n                           _(\"Stream data too long to send \"\n                             \"(%zu bytes needed, %zu bytes available)\"),\n                           len,\n                           VIR_NET_MESSAGE_MAX +\n                           VIR_NET_MESSAGE_LEN_MAX -\n                           msg->bufferOffset);\n            return -1;\n        }\n\n        msg->bufferLength = msg->bufferOffset + len;\n\n        if (VIR_REALLOC_N(msg->buffer, msg->bufferLength) < 0)\n            return -1;\n\n        VIR_DEBUG(\"Increased message buffer length = %zu\", msg->bufferLength);\n    }\n\n    memcpy(msg->buffer + msg->bufferOffset, data, len);\n    msg->bufferOffset += len;\n\n    /* Re-encode the length word. */\n    VIR_DEBUG(\"Encode length as %zu\", msg->bufferOffset);\n    xdrmem_create(&xdr, msg->buffer, VIR_NET_MESSAGE_HEADER_XDR_LEN, XDR_ENCODE);\n    msglen = msg->bufferOffset;\n    if (!xdr_u_int(&xdr, &msglen)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to encode message length\"));\n        goto error;\n    }\n    xdr_destroy(&xdr);\n\n    msg->bufferLength = msg->bufferOffset;\n    msg->bufferOffset = 0;\n    return 0;\n\n error:\n    xdr_destroy(&xdr);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetMessageEncodeHeader",
          "args": [
            "msg"
          ],
          "line": 2283
        },
        "resolved": true,
        "details": {
          "function_name": "virNetMessageEncodeHeader",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetmessage.c",
          "lines": "226-272",
          "snippet": "int virNetMessageEncodeHeader(virNetMessagePtr msg)\n{\n    XDR xdr;\n    int ret = -1;\n    unsigned int len = 0;\n\n    msg->bufferLength = VIR_NET_MESSAGE_INITIAL + VIR_NET_MESSAGE_LEN_MAX;\n    if (VIR_REALLOC_N(msg->buffer, msg->bufferLength) < 0)\n        return ret;\n    msg->bufferOffset = 0;\n\n    /* Format the header. */\n    xdrmem_create(&xdr,\n                  msg->buffer,\n                  msg->bufferLength,\n                  XDR_ENCODE);\n\n    /* The real value is filled in shortly */\n    if (!xdr_u_int(&xdr, &len)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to encode message length\"));\n        goto cleanup;\n    }\n\n    if (!xdr_virNetMessageHeader(&xdr, &msg->header)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to encode message header\"));\n        goto cleanup;\n    }\n\n    len = xdr_getpos(&xdr);\n    xdr_setpos(&xdr, 0);\n\n    /* Fill in current length - may be re-written later\n     * if a payload is added\n     */\n    if (!xdr_u_int(&xdr, &len)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to re-encode message length\"));\n        goto cleanup;\n    }\n\n    msg->bufferOffset += len;\n\n    ret = 0;\n\n cleanup:\n    xdr_destroy(&xdr);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetmessage.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetmessage.h\"\n#include <unistd.h>\n#include <config.h>\n\nint virNetMessageEncodeHeader(virNetMessagePtr msg)\n{\n    XDR xdr;\n    int ret = -1;\n    unsigned int len = 0;\n\n    msg->bufferLength = VIR_NET_MESSAGE_INITIAL + VIR_NET_MESSAGE_LEN_MAX;\n    if (VIR_REALLOC_N(msg->buffer, msg->bufferLength) < 0)\n        return ret;\n    msg->bufferOffset = 0;\n\n    /* Format the header. */\n    xdrmem_create(&xdr,\n                  msg->buffer,\n                  msg->bufferLength,\n                  XDR_ENCODE);\n\n    /* The real value is filled in shortly */\n    if (!xdr_u_int(&xdr, &len)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to encode message length\"));\n        goto cleanup;\n    }\n\n    if (!xdr_virNetMessageHeader(&xdr, &msg->header)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to encode message header\"));\n        goto cleanup;\n    }\n\n    len = xdr_getpos(&xdr);\n    xdr_setpos(&xdr, 0);\n\n    /* Fill in current length - may be re-written later\n     * if a payload is added\n     */\n    if (!xdr_u_int(&xdr, &len)) {\n        virReportError(VIR_ERR_RPC, \"%s\", _(\"Unable to re-encode message length\"));\n        goto cleanup;\n    }\n\n    msg->bufferOffset += len;\n\n    ret = 0;\n\n cleanup:\n    xdr_destroy(&xdr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerProgramGetVersion",
          "args": [
            "ctrl->prog"
          ],
          "line": 2277
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerProgramGetVersion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverprogram.c",
          "lines": "91-94",
          "snippet": "int virNetServerProgramGetVersion(virNetServerProgramPtr prog)\n{\n    return prog->version;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserverprogram.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserverprogram.h\"\n#include <config.h>\n\nint virNetServerProgramGetVersion(virNetServerProgramPtr prog)\n{\n    return prog->version;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerProgramGetID",
          "args": [
            "ctrl->prog"
          ],
          "line": 2276
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerProgramGetID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverprogram.c",
          "lines": "85-88",
          "snippet": "int virNetServerProgramGetID(virNetServerProgramPtr prog)\n{\n    return prog->program;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserverprogram.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserverprogram.h\"\n#include <config.h>\n\nint virNetServerProgramGetID(virNetServerProgramPtr prog)\n{\n    return prog->program;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetMessageNew",
          "args": [
            "false"
          ],
          "line": 2273
        },
        "resolved": true,
        "details": {
          "function_name": "virNetMessageNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetmessage.c",
          "lines": "37-48",
          "snippet": "virNetMessagePtr virNetMessageNew(bool tracked)\n{\n    virNetMessagePtr msg;\n\n    if (VIR_ALLOC(msg) < 0)\n        return NULL;\n\n    msg->tracked = tracked;\n    VIR_DEBUG(\"msg=%p tracked=%d\", msg, tracked);\n\n    return msg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetmessage.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetmessage.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirNetMessagePtr virNetMessageNew(bool tracked)\n{\n    virNetMessagePtr msg;\n\n    if (VIR_ALLOC(msg) < 0)\n        return NULL;\n\n    msg->tracked = tracked;\n    VIR_DEBUG(\"msg=%p tracked=%d\", msg, tracked);\n\n    return msg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Send event %d client=%p\"",
            "procnr",
            "ctrl->client"
          ],
          "line": 2272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Dropping event %d because libvirtd is not connected\"",
            "procnr"
          ],
          "line": 2268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void\nvirLXCControllerEventSend(virLXCControllerPtr ctrl,\n                          int procnr,\n                          xdrproc_t proc,\n                          void *data)\n{\n    virNetMessagePtr msg;\n\n    if (!ctrl->client) {\n        VIR_WARN(\"Dropping event %d because libvirtd is not connected\", procnr);\n        return;\n    }\n\n    VIR_DEBUG(\"Send event %d client=%p\", procnr, ctrl->client);\n    if (!(msg = virNetMessageNew(false)))\n        goto error;\n\n    msg->header.prog = virNetServerProgramGetID(ctrl->prog);\n    msg->header.vers = virNetServerProgramGetVersion(ctrl->prog);\n    msg->header.proc = procnr;\n    msg->header.type = VIR_NET_MESSAGE;\n    msg->header.serial = 1;\n    msg->header.status = VIR_NET_OK;\n\n    if (virNetMessageEncodeHeader(msg) < 0)\n        goto error;\n\n    if (virNetMessageEncodePayload(msg, proc, data) < 0)\n        goto error;\n\n    VIR_DEBUG(\"Queue event %d %zu\", procnr, msg->bufferLength);\n    if (virNetServerClientSendMessage(ctrl->client, msg) < 0)\n        goto error;\n\n    xdr_free(proc, data);\n    return;\n\n error:\n    virNetMessageFree(msg);\n    xdr_free(proc, data);\n}"
  },
  {
    "function_name": "virLXCControllerSetupConsoles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2231-2256",
    "snippet": "static int\nvirLXCControllerSetupConsoles(virLXCControllerPtr ctrl,\n                              char **containerTTYPaths)\n{\n    size_t i;\n    g_autofree char *ttyHostPath = NULL;\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        VIR_DEBUG(\"Opening tty on private %s\", ctrl->devptmx);\n        if (lxcCreateTty(ctrl,\n                         &ctrl->consoles[i].contFd,\n                         &containerTTYPaths[i], &ttyHostPath) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Failed to allocate tty\"));\n            return -1;\n        }\n\n        /* Change the owner of tty device to the root user of container */\n        if (lxcContainerChown(ctrl->def, ttyHostPath) < 0)\n            return -1;\n\n        VIR_FREE(ttyHostPath);\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ttyHostPath"
          ],
          "line": 2252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "ctrl->def",
            "ttyHostPath"
          ],
          "line": 2249
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to allocate tty\")"
          ],
          "line": 2243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to allocate tty\""
          ],
          "line": 2244
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcCreateTty",
          "args": [
            "ctrl",
            "&ctrl->consoles[i].contFd",
            "&containerTTYPaths[i]",
            "&ttyHostPath"
          ],
          "line": 2240
        },
        "resolved": true,
        "details": {
          "function_name": "lxcCreateTty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2097-2132",
          "snippet": "static int\nlxcCreateTty(virLXCControllerPtr ctrl, int *ttymaster,\n             char **ttyName, char **ttyHostPath)\n{\n    int ret = -1;\n    int ptyno;\n    int unlock = 0;\n\n    if ((*ttymaster = open(ctrl->devptmx, O_RDWR|O_NOCTTY|O_NONBLOCK)) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCSPTLCK, &unlock) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCGPTN, &ptyno) < 0)\n        goto cleanup;\n\n    /* If mount() succeeded at honoring newinstance, then the kernel\n     * was new enough to also honor the mode=0620,gid=5 options, which\n     * guarantee that the new pty already has correct permissions; so\n     * while glibc has to fstat(), fchmod(), and fchown() for older\n     * kernels, we can skip those steps.  ptyno shouldn't currently be\n     * anything other than 0, but let's play it safe.  */\n    *ttyName = g_strdup_printf(\"/dev/pts/%d\", ptyno);\n    *ttyHostPath = g_strdup_printf(\"/%s/%s.devpts/%d\", LXC_STATE_DIR, ctrl->def->name, ptyno);\n\n    ret = 0;\n\n cleanup:\n    if (ret != 0) {\n        VIR_FORCE_CLOSE(*ttymaster);\n        VIR_FREE(*ttyName);\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nlxcCreateTty(virLXCControllerPtr ctrl, int *ttymaster,\n             char **ttyName, char **ttyHostPath)\n{\n    int ret = -1;\n    int ptyno;\n    int unlock = 0;\n\n    if ((*ttymaster = open(ctrl->devptmx, O_RDWR|O_NOCTTY|O_NONBLOCK)) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCSPTLCK, &unlock) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCGPTN, &ptyno) < 0)\n        goto cleanup;\n\n    /* If mount() succeeded at honoring newinstance, then the kernel\n     * was new enough to also honor the mode=0620,gid=5 options, which\n     * guarantee that the new pty already has correct permissions; so\n     * while glibc has to fstat(), fchmod(), and fchown() for older\n     * kernels, we can skip those steps.  ptyno shouldn't currently be\n     * anything other than 0, but let's play it safe.  */\n    *ttyName = g_strdup_printf(\"/dev/pts/%d\", ptyno);\n    *ttyHostPath = g_strdup_printf(\"/%s/%s.devpts/%d\", LXC_STATE_DIR, ctrl->def->name, ptyno);\n\n    ret = 0;\n\n cleanup:\n    if (ret != 0) {\n        VIR_FORCE_CLOSE(*ttymaster);\n        VIR_FREE(*ttyName);\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Opening tty on private %s\"",
            "ctrl->devptmx"
          ],
          "line": 2239
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupConsoles(virLXCControllerPtr ctrl,\n                              char **containerTTYPaths)\n{\n    size_t i;\n    g_autofree char *ttyHostPath = NULL;\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        VIR_DEBUG(\"Opening tty on private %s\", ctrl->devptmx);\n        if (lxcCreateTty(ctrl,\n                         &ctrl->consoles[i].contFd,\n                         &containerTTYPaths[i], &ttyHostPath) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Failed to allocate tty\"));\n            return -1;\n        }\n\n        /* Change the owner of tty device to the root user of container */\n        if (lxcContainerChown(ctrl->def, ttyHostPath) < 0)\n            return -1;\n\n        VIR_FREE(ttyHostPath);\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerStartFuse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2225-2229",
    "snippet": "static int\nvirLXCControllerStartFuse(virLXCControllerPtr ctrl)\n{\n    return lxcStartFuse(ctrl->fuse);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcStartFuse",
          "args": [
            "ctrl->fuse"
          ],
          "line": 2228
        },
        "resolved": true,
        "details": {
          "function_name": "lxcStartFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_fuse.c",
          "lines": "370-373",
          "snippet": "int lxcStartFuse(virLXCFusePtr f G_GNUC_UNUSED)\n{\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_fuse.h\"",
            "#include <unistd.h>",
            "#include <mntent.h>",
            "#include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_fuse.h\"\n#include <unistd.h>\n#include <mntent.h>\n#include <sys/mount.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcStartFuse(virLXCFusePtr f G_GNUC_UNUSED)\n{\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerStartFuse(virLXCControllerPtr ctrl)\n{\n    return lxcStartFuse(ctrl->fuse);\n}"
  },
  {
    "function_name": "virLXCControllerSetupFuse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2219-2223",
    "snippet": "static int\nvirLXCControllerSetupFuse(virLXCControllerPtr ctrl)\n{\n    return lxcSetupFuse(&ctrl->fuse, ctrl->def);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcSetupFuse",
          "args": [
            "&ctrl->fuse",
            "ctrl->def"
          ],
          "line": 2222
        },
        "resolved": true,
        "details": {
          "function_name": "lxcSetupFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_fuse.c",
          "lines": "364-368",
          "snippet": "int lxcSetupFuse(virLXCFusePtr *f G_GNUC_UNUSED,\n                  virDomainDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_fuse.h\"",
            "#include <unistd.h>",
            "#include <mntent.h>",
            "#include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_fuse.h\"\n#include <unistd.h>\n#include <mntent.h>\n#include <sys/mount.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcSetupFuse(virLXCFusePtr *f G_GNUC_UNUSED,\n                  virDomainDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupFuse(virLXCControllerPtr ctrl)\n{\n    return lxcSetupFuse(&ctrl->fuse, ctrl->def);\n}"
  },
  {
    "function_name": "virLXCControllerSetupDevPTS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2163-2216",
    "snippet": "static int\nvirLXCControllerSetupDevPTS(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *devpts = NULL;\n    gid_t ptsgid = 5;\n\n    VIR_DEBUG(\"Setting up private /dev/pts\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    devpts = g_strdup_printf(\"%s/%s.devpts\", LXC_STATE_DIR, ctrl->def->name);\n    ctrl->devptmx = g_strdup_printf(\"%s/%s.devpts/ptmx\", LXC_STATE_DIR, ctrl->def->name);\n\n    if (virFileMakePath(devpts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to make path %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (ctrl->def->idmap.ngidmap)\n        ptsgid = virLXCControllerLookupUsernsMap(ctrl->def->idmap.gidmap,\n                                                 ctrl->def->idmap.ngidmap,\n                                                 ptsgid);\n\n    /* XXX should we support gid=X for X!=5 for distros which use\n     * a different gid for tty?  */\n    opts = g_strdup_printf(\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\", ptsgid,\n                           NULLSTR_EMPTY(mount_options));\n\n    VIR_DEBUG(\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\",\n              devpts, MS_NOSUID, opts);\n    if (mount(\"devpts\", devpts, \"devpts\", MS_NOSUID, opts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount devpts on %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (access(ctrl->devptmx, R_OK) < 0) {\n        virReportSystemError(ENOSYS, \"%s\",\n                             _(\"Kernel does not support private devpts\"));\n        return -1;\n    }\n\n    if ((lxcContainerChown(ctrl->def, ctrl->devptmx) < 0) ||\n        (lxcContainerChown(ctrl->def, devpts) < 0))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "ctrl->def",
            "devpts"
          ],
          "line": 2212
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOSYS",
            "\"%s\"",
            "_(\"Kernel does not support private devpts\")"
          ],
          "line": 2206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Kernel does not support private devpts\""
          ],
          "line": 2207
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "ctrl->devptmx",
            "R_OK"
          ],
          "line": 2205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount devpts on %s\")",
            "devpts"
          ],
          "line": 2199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "\"devpts\"",
            "devpts",
            "\"devpts\"",
            "MS_NOSUID",
            "opts"
          ],
          "line": 2198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\"",
            "devpts",
            "MS_NOSUID",
            "opts"
          ],
          "line": 2196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\"",
            "ptsgid",
            "NULLSTR_EMPTY(mount_options)"
          ],
          "line": 2193
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR_EMPTY",
          "args": [
            "mount_options"
          ],
          "line": 2194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerLookupUsernsMap",
          "args": [
            "ctrl->def->idmap.gidmap",
            "ctrl->def->idmap.ngidmap",
            "ptsgid"
          ],
          "line": 2187
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerLookupUsernsMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1377-1390",
          "snippet": "static unsigned int\nvirLXCControllerLookupUsernsMap(virDomainIdMapEntryPtr map,\n                                int num,\n                                unsigned int src)\n{\n    size_t i;\n\n    for (i = 0; i < num; i++) {\n        if (src > map[i].start && src < map[i].start + map[i].count)\n            return map[i].target + (src - map[i].start);\n    }\n\n    return src;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic unsigned int\nvirLXCControllerLookupUsernsMap(virDomainIdMapEntryPtr map,\n                                int num,\n                                unsigned int src)\n{\n    size_t i;\n\n    for (i = 0; i < num; i++) {\n        if (src > map[i].start && src < map[i].start + map[i].count)\n            return map[i].target + (src - map[i].start);\n    }\n\n    return src;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make path %s\")",
            "devpts"
          ],
          "line": 2180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "devpts"
          ],
          "line": 2179
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerGetMountOptions",
          "args": [
            "ctrl->securityManager",
            "ctrl->def"
          ],
          "line": 2173
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerGetMountOptions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1014-1028",
          "snippet": "char *\nvirSecurityManagerGetMountOptions(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainGetSecurityMountOptions) {\n        char *ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainGetSecurityMountOptions(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return NULL;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nvirSecurityManagerGetMountOptions(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainGetSecurityMountOptions) {\n        char *ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainGetSecurityMountOptions(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up private /dev/pts\""
          ],
          "line": 2171
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupDevPTS(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *devpts = NULL;\n    gid_t ptsgid = 5;\n\n    VIR_DEBUG(\"Setting up private /dev/pts\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    devpts = g_strdup_printf(\"%s/%s.devpts\", LXC_STATE_DIR, ctrl->def->name);\n    ctrl->devptmx = g_strdup_printf(\"%s/%s.devpts/ptmx\", LXC_STATE_DIR, ctrl->def->name);\n\n    if (virFileMakePath(devpts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to make path %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (ctrl->def->idmap.ngidmap)\n        ptsgid = virLXCControllerLookupUsernsMap(ctrl->def->idmap.gidmap,\n                                                 ctrl->def->idmap.ngidmap,\n                                                 ptsgid);\n\n    /* XXX should we support gid=X for X!=5 for distros which use\n     * a different gid for tty?  */\n    opts = g_strdup_printf(\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\", ptsgid,\n                           NULLSTR_EMPTY(mount_options));\n\n    VIR_DEBUG(\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\",\n              devpts, MS_NOSUID, opts);\n    if (mount(\"devpts\", devpts, \"devpts\", MS_NOSUID, opts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount devpts on %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (access(ctrl->devptmx, R_OK) < 0) {\n        virReportSystemError(ENOSYS, \"%s\",\n                             _(\"Kernel does not support private devpts\"));\n        return -1;\n    }\n\n    if ((lxcContainerChown(ctrl->def, ctrl->devptmx) < 0) ||\n        (lxcContainerChown(ctrl->def, devpts) < 0))\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupPrivateNS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2135-2160",
    "snippet": "static int\nvirLXCControllerSetupPrivateNS(void)\n{\n    /*\n     * If doing a chroot style setup, we need to prepare\n     * a private /dev/pts for the child now, which they\n     * will later move into position.\n     *\n     * This is complex because 'virsh console' needs to\n     * use /dev/pts from the host OS, and the guest OS\n     * needs to use /dev/pts from the guest.\n     *\n     * This means that we (libvirt_lxc) need to see and\n     * use both /dev/pts instances. We're running in the\n     * host OS context though and don't want to expose\n     * the guest OS /dev/pts there.\n     *\n     * Thus we call unshare(CLONE_NS) so that we can see\n     * the guest's new /dev/pts, without it becoming\n     * visible to the host OS. We also put the root FS\n     * into slave mode, just in case it was currently\n     * marked as shared\n     */\n\n    return virProcessSetupPrivateMountNS();\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virProcessSetupPrivateMountNS",
          "args": [],
          "line": 2159
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessSetupPrivateMountNS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "1362-1368",
          "snippet": "int\nvirProcessSetupPrivateMountNS(void)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Namespaces are not supported on this platform.\"));\n    return -1;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirProcessSetupPrivateMountNS(void)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Namespaces are not supported on this platform.\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupPrivateNS(void)\n{\n    /*\n     * If doing a chroot style setup, we need to prepare\n     * a private /dev/pts for the child now, which they\n     * will later move into position.\n     *\n     * This is complex because 'virsh console' needs to\n     * use /dev/pts from the host OS, and the guest OS\n     * needs to use /dev/pts from the guest.\n     *\n     * This means that we (libvirt_lxc) need to see and\n     * use both /dev/pts instances. We're running in the\n     * host OS context though and don't want to expose\n     * the guest OS /dev/pts there.\n     *\n     * Thus we call unshare(CLONE_NS) so that we can see\n     * the guest's new /dev/pts, without it becoming\n     * visible to the host OS. We also put the root FS\n     * into slave mode, just in case it was currently\n     * marked as shared\n     */\n\n    return virProcessSetupPrivateMountNS();\n}"
  },
  {
    "function_name": "lxcCreateTty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2097-2132",
    "snippet": "static int\nlxcCreateTty(virLXCControllerPtr ctrl, int *ttymaster,\n             char **ttyName, char **ttyHostPath)\n{\n    int ret = -1;\n    int ptyno;\n    int unlock = 0;\n\n    if ((*ttymaster = open(ctrl->devptmx, O_RDWR|O_NOCTTY|O_NONBLOCK)) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCSPTLCK, &unlock) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCGPTN, &ptyno) < 0)\n        goto cleanup;\n\n    /* If mount() succeeded at honoring newinstance, then the kernel\n     * was new enough to also honor the mode=0620,gid=5 options, which\n     * guarantee that the new pty already has correct permissions; so\n     * while glibc has to fstat(), fchmod(), and fchown() for older\n     * kernels, we can skip those steps.  ptyno shouldn't currently be\n     * anything other than 0, but let's play it safe.  */\n    *ttyName = g_strdup_printf(\"/dev/pts/%d\", ptyno);\n    *ttyHostPath = g_strdup_printf(\"/%s/%s.devpts/%d\", LXC_STATE_DIR, ctrl->def->name, ptyno);\n\n    ret = 0;\n\n cleanup:\n    if (ret != 0) {\n        VIR_FORCE_CLOSE(*ttymaster);\n        VIR_FREE(*ttyName);\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*ttyName"
          ],
          "line": 2128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "*ttymaster"
          ],
          "line": 2127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/%s/%s.devpts/%d\"",
            "LXC_STATE_DIR",
            "ctrl->def->name",
            "ptyno"
          ],
          "line": 2121
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "*ttymaster",
            "TIOCGPTN",
            "&ptyno"
          ],
          "line": 2111
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "ctrl->devptmx",
            "O_RDWR|O_NOCTTY|O_NONBLOCK"
          ],
          "line": 2105
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nlxcCreateTty(virLXCControllerPtr ctrl, int *ttymaster,\n             char **ttyName, char **ttyHostPath)\n{\n    int ret = -1;\n    int ptyno;\n    int unlock = 0;\n\n    if ((*ttymaster = open(ctrl->devptmx, O_RDWR|O_NOCTTY|O_NONBLOCK)) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCSPTLCK, &unlock) < 0)\n        goto cleanup;\n\n    if (ioctl(*ttymaster, TIOCGPTN, &ptyno) < 0)\n        goto cleanup;\n\n    /* If mount() succeeded at honoring newinstance, then the kernel\n     * was new enough to also honor the mode=0620,gid=5 options, which\n     * guarantee that the new pty already has correct permissions; so\n     * while glibc has to fstat(), fchmod(), and fchown() for older\n     * kernels, we can skip those steps.  ptyno shouldn't currently be\n     * anything other than 0, but let's play it safe.  */\n    *ttyName = g_strdup_printf(\"/dev/pts/%d\", ptyno);\n    *ttyHostPath = g_strdup_printf(\"/%s/%s.devpts/%d\", LXC_STATE_DIR, ctrl->def->name, ptyno);\n\n    ret = 0;\n\n cleanup:\n    if (ret != 0) {\n        VIR_FORCE_CLOSE(*ttymaster);\n        VIR_FREE(*ttyName);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "lxcSetPersonality",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2064-2082",
    "snippet": "static int lxcSetPersonality(virDomainDefPtr def)\n{\n    virArch altArch;\n\n    VIR_DEBUG(\"Checking for 32-bit personality\");\n    altArch = lxcContainerGetAlt32bitArch(virArchFromHost());\n    if (altArch &&\n        (def->os.arch == altArch)) {\n        VIR_DEBUG(\"Setting personality to %s\",\n                  virArchToString(altArch));\n        if (personality(PER_LINUX32) < 0) {\n            virReportSystemError(errno, _(\"Unable to request personality for %s on %s\"),\n                                 virArchToString(altArch),\n                                 virArchToString(virArchFromHost()));\n            return -1;\n        }\n    }\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to request personality for %s on %s\")",
            "virArchToString(altArch)",
            "virArchToString(virArchFromHost())"
          ],
          "line": 2075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virArchToString",
          "args": [
            "virArchFromHost()"
          ],
          "line": 2077
        },
        "resolved": true,
        "details": {
          "function_name": "virArchToString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virarch.c",
          "lines": "126-132",
          "snippet": "const char *virArchToString(virArch arch)\n{\n    if (arch >= VIR_ARCH_LAST)\n        arch = VIR_ARCH_NONE;\n\n    return virArchData[arch].name;\n}",
          "includes": [
            "#include \"virarch.h\"",
            "#include \"virlog.h\"",
            "# include <sys/utsname.h>",
            "# include <windows.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const struct virArchData {\n    const char *name;\n    unsigned int wordsize;\n    virArchEndian endian;\n} virArchData[] = {\n    { \"none\",          0, VIR_ARCH_LITTLE_ENDIAN },\n    { \"alpha\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"armv6l\",       32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"armv7l\",       32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"armv7b\",       32, VIR_ARCH_BIG_ENDIAN },\n\n    { \"aarch64\",      64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"cris\",         32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"i686\",         32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"ia64\",         64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"lm32\",         32, VIR_ARCH_BIG_ENDIAN },\n\n    { \"m68k\",         32, VIR_ARCH_BIG_ENDIAN },\n    { \"microblaze\",   32, VIR_ARCH_BIG_ENDIAN },\n    { \"microblazeel\", 32, VIR_ARCH_LITTLE_ENDIAN},\n    { \"mips\",         32, VIR_ARCH_BIG_ENDIAN },\n    { \"mipsel\",       32, VIR_ARCH_LITTLE_ENDIAN },\n\n    { \"mips64\",       64, VIR_ARCH_BIG_ENDIAN },\n    { \"mips64el\",     64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"openrisc\",     32, VIR_ARCH_BIG_ENDIAN },\n    { \"parisc\",       32, VIR_ARCH_BIG_ENDIAN },\n    { \"parisc64\",     64, VIR_ARCH_BIG_ENDIAN },\n\n    { \"ppc\",          32, VIR_ARCH_BIG_ENDIAN },\n    { \"ppcle\",        32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"ppc64\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"ppc64le\",      64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"ppcemb\",       32, VIR_ARCH_BIG_ENDIAN },\n\n    { \"riscv32\",      32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"riscv64\",      64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"s390\",         32, VIR_ARCH_BIG_ENDIAN },\n    { \"s390x\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"sh4\",          32, VIR_ARCH_LITTLE_ENDIAN },\n\n    { \"sh4eb\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"sparc\",        32, VIR_ARCH_BIG_ENDIAN },\n    { \"sparc64\",      64, VIR_ARCH_BIG_ENDIAN },\n    { \"unicore32\",    32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"x86_64\",       64, VIR_ARCH_LITTLE_ENDIAN },\n\n    { \"xtensa\",       32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"xtensaeb\",     32, VIR_ARCH_BIG_ENDIAN },\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virarch.h\"\n#include \"virlog.h\"\n# include <sys/utsname.h>\n# include <windows.h>\n#include <config.h>\n\nstatic const struct virArchData {\n    const char *name;\n    unsigned int wordsize;\n    virArchEndian endian;\n} virArchData[] = {\n    { \"none\",          0, VIR_ARCH_LITTLE_ENDIAN },\n    { \"alpha\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"armv6l\",       32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"armv7l\",       32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"armv7b\",       32, VIR_ARCH_BIG_ENDIAN },\n\n    { \"aarch64\",      64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"cris\",         32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"i686\",         32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"ia64\",         64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"lm32\",         32, VIR_ARCH_BIG_ENDIAN },\n\n    { \"m68k\",         32, VIR_ARCH_BIG_ENDIAN },\n    { \"microblaze\",   32, VIR_ARCH_BIG_ENDIAN },\n    { \"microblazeel\", 32, VIR_ARCH_LITTLE_ENDIAN},\n    { \"mips\",         32, VIR_ARCH_BIG_ENDIAN },\n    { \"mipsel\",       32, VIR_ARCH_LITTLE_ENDIAN },\n\n    { \"mips64\",       64, VIR_ARCH_BIG_ENDIAN },\n    { \"mips64el\",     64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"openrisc\",     32, VIR_ARCH_BIG_ENDIAN },\n    { \"parisc\",       32, VIR_ARCH_BIG_ENDIAN },\n    { \"parisc64\",     64, VIR_ARCH_BIG_ENDIAN },\n\n    { \"ppc\",          32, VIR_ARCH_BIG_ENDIAN },\n    { \"ppcle\",        32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"ppc64\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"ppc64le\",      64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"ppcemb\",       32, VIR_ARCH_BIG_ENDIAN },\n\n    { \"riscv32\",      32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"riscv64\",      64, VIR_ARCH_LITTLE_ENDIAN },\n    { \"s390\",         32, VIR_ARCH_BIG_ENDIAN },\n    { \"s390x\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"sh4\",          32, VIR_ARCH_LITTLE_ENDIAN },\n\n    { \"sh4eb\",        64, VIR_ARCH_BIG_ENDIAN },\n    { \"sparc\",        32, VIR_ARCH_BIG_ENDIAN },\n    { \"sparc64\",      64, VIR_ARCH_BIG_ENDIAN },\n    { \"unicore32\",    32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"x86_64\",       64, VIR_ARCH_LITTLE_ENDIAN },\n\n    { \"xtensa\",       32, VIR_ARCH_LITTLE_ENDIAN },\n    { \"xtensaeb\",     32, VIR_ARCH_BIG_ENDIAN },\n};\n\nconst char *virArchToString(virArch arch)\n{\n    if (arch >= VIR_ARCH_LAST)\n        arch = VIR_ARCH_NONE;\n\n    return virArchData[arch].name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virArchFromHost",
          "args": [],
          "line": 2077
        },
        "resolved": true,
        "details": {
          "function_name": "virArchFromHost",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virarch.c",
          "lines": "206-235",
          "snippet": "virArch virArchFromHost(void)\n{\n    struct utsname ut;\n    virArch arch;\n\n    uname(&ut);\n\n    /* Some special cases we need to handle first\n     * for non-canonical names */\n    if (strlen(ut.machine) == 4 &&\n        ut.machine[0] == 'i' &&\n        ut.machine[2] == '8' &&\n        ut.machine[3] == '6' &&\n        ut.machine[4] == '\\0') {\n        arch = VIR_ARCH_I686;\n    } else if (STREQ(ut.machine, \"amd64\")) {\n        arch = VIR_ARCH_X86_64;\n    } else {\n        /* Otherwise assume the canonical name */\n        if ((arch = virArchFromString(ut.machine)) == VIR_ARCH_NONE) {\n            VIR_WARN(\"Unknown host arch %s, report to libvir-list@redhat.com\",\n                     ut.machine);\n        }\n    }\n\n    VIR_DEBUG(\"Mapped %s to %d (%s)\",\n              ut.machine, arch, virArchToString(arch));\n\n    return arch;\n}",
          "includes": [
            "#include \"virarch.h\"",
            "#include \"virlog.h\"",
            "# include <sys/utsname.h>",
            "# include <windows.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virarch.h\"\n#include \"virlog.h\"\n# include <sys/utsname.h>\n# include <windows.h>\n#include <config.h>\n\nvirArch virArchFromHost(void)\n{\n    struct utsname ut;\n    virArch arch;\n\n    uname(&ut);\n\n    /* Some special cases we need to handle first\n     * for non-canonical names */\n    if (strlen(ut.machine) == 4 &&\n        ut.machine[0] == 'i' &&\n        ut.machine[2] == '8' &&\n        ut.machine[3] == '6' &&\n        ut.machine[4] == '\\0') {\n        arch = VIR_ARCH_I686;\n    } else if (STREQ(ut.machine, \"amd64\")) {\n        arch = VIR_ARCH_X86_64;\n    } else {\n        /* Otherwise assume the canonical name */\n        if ((arch = virArchFromString(ut.machine)) == VIR_ARCH_NONE) {\n            VIR_WARN(\"Unknown host arch %s, report to libvir-list@redhat.com\",\n                     ut.machine);\n        }\n    }\n\n    VIR_DEBUG(\"Mapped %s to %d (%s)\",\n              ut.machine, arch, virArchToString(arch));\n\n    return arch;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to request personality for %s on %s\""
          ],
          "line": 2075
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "personality",
          "args": [
            "PER_LINUX32"
          ],
          "line": 2074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting personality to %s\"",
            "virArchToString(altArch)"
          ],
          "line": 2072
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerGetAlt32bitArch",
          "args": [
            "virArchFromHost()"
          ],
          "line": 2069
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerGetAlt32bitArch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2334-2356",
          "snippet": "virArch lxcContainerGetAlt32bitArch(virArch arch)\n{\n    /* Any Linux 64bit arch which has a 32bit\n     * personality available should be listed here */\n    if (arch == VIR_ARCH_X86_64)\n        return VIR_ARCH_I686;\n    if (arch == VIR_ARCH_S390X)\n        return VIR_ARCH_S390;\n    if (arch == VIR_ARCH_PPC64)\n        return VIR_ARCH_PPC;\n    if (arch == VIR_ARCH_PARISC64)\n        return VIR_ARCH_PARISC;\n    if (arch == VIR_ARCH_SPARC64)\n        return VIR_ARCH_SPARC;\n    if (arch == VIR_ARCH_MIPS64)\n        return VIR_ARCH_MIPS;\n    if (arch == VIR_ARCH_MIPS64EL)\n        return VIR_ARCH_MIPSEL;\n    if (arch == VIR_ARCH_AARCH64)\n        return VIR_ARCH_ARMV7L;\n\n    return VIR_ARCH_NONE;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirArch lxcContainerGetAlt32bitArch(virArch arch)\n{\n    /* Any Linux 64bit arch which has a 32bit\n     * personality available should be listed here */\n    if (arch == VIR_ARCH_X86_64)\n        return VIR_ARCH_I686;\n    if (arch == VIR_ARCH_S390X)\n        return VIR_ARCH_S390;\n    if (arch == VIR_ARCH_PPC64)\n        return VIR_ARCH_PPC;\n    if (arch == VIR_ARCH_PARISC64)\n        return VIR_ARCH_PARISC;\n    if (arch == VIR_ARCH_SPARC64)\n        return VIR_ARCH_SPARC;\n    if (arch == VIR_ARCH_MIPS64)\n        return VIR_ARCH_MIPS;\n    if (arch == VIR_ARCH_MIPS64EL)\n        return VIR_ARCH_MIPSEL;\n    if (arch == VIR_ARCH_AARCH64)\n        return VIR_ARCH_ARMV7L;\n\n    return VIR_ARCH_NONE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Checking for 32-bit personality\""
          ],
          "line": 2068
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int lxcSetPersonality(virDomainDefPtr def)\n{\n    virArch altArch;\n\n    VIR_DEBUG(\"Checking for 32-bit personality\");\n    altArch = lxcContainerGetAlt32bitArch(virArchFromHost());\n    if (altArch &&\n        (def->os.arch == altArch)) {\n        VIR_DEBUG(\"Setting personality to %s\",\n                  virArchToString(altArch));\n        if (personality(PER_LINUX32) < 0) {\n            virReportSystemError(errno, _(\"Unable to request personality for %s on %s\"),\n                                 virArchToString(altArch),\n                                 virArchToString(virArchFromHost()));\n            return -1;\n        }\n    }\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerDeleteInterfaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2050-2061",
    "snippet": "static int virLXCControllerDeleteInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    int ret = 0;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevVethDelete(ctrl->veths[i]) < 0)\n            ret = -1;\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDevVethDelete",
          "args": [
            "ctrl->veths[i]"
          ],
          "line": 2056
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevVethDelete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
          "lines": "189-209",
          "snippet": "int virNetDevVethDelete(const char *veth)\n{\n    int status;\n    g_autoptr(virCommand) cmd = virCommandNewArgList(\"ip\", \"link\",\n                                                       \"del\", veth, NULL);\n\n    if (virCommandRun(cmd, &status) < 0)\n        return -1;\n\n    if (status != 0) {\n        if (!virNetDevExists(veth)) {\n            VIR_DEBUG(\"Device %s already deleted (by kernel namespace cleanup)\", veth);\n            return 0;\n        }\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to delete veth device %s\"), veth);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\nint virNetDevVethDelete(const char *veth)\n{\n    int status;\n    g_autoptr(virCommand) cmd = virCommandNewArgList(\"ip\", \"link\",\n                                                       \"del\", veth, NULL);\n\n    if (virCommandRun(cmd, &status) < 0)\n        return -1;\n\n    if (status != 0) {\n        if (!virNetDevExists(veth)) {\n            VIR_DEBUG(\"Device %s already deleted (by kernel namespace cleanup)\", veth);\n            return 0;\n        }\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to delete veth device %s\"), veth);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerDeleteInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    int ret = 0;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevVethDelete(ctrl->veths[i]) < 0)\n            ret = -1;\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerMoveInterfaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "2013-2039",
    "snippet": "static int virLXCControllerMoveInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr def = ctrl->def;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevSetNamespace(ctrl->veths[i], ctrl->initpid) < 0)\n            return -1;\n    }\n\n    for (i = 0; i < def->nhostdevs; i ++) {\n        virDomainHostdevDefPtr hdev = def->hostdevs[i];\n\n        if (hdev->mode != VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES)\n            continue;\n\n        virDomainHostdevCaps hdcaps = hdev->source.caps;\n\n        if (hdcaps.type != VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            continue;\n\n        if (virNetDevSetNamespace(hdcaps.u.net.ifname, ctrl->initpid) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDevSetNamespace",
          "args": [
            "hdcaps.u.net.ifname",
            "ctrl->initpid"
          ],
          "line": 2034
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetNamespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "506-550",
          "snippet": "int virNetDevSetNamespace(const char *ifname, pid_t pidInNs)\n{\n    int ret = -1;\n    char *pid = NULL;\n    char *phy = NULL;\n    char *phy_path = NULL;\n    int len;\n\n    pid = g_strdup_printf(\"%lld\", (long long) pidInNs);\n\n    /* The 802.11 wireless devices only move together with their PHY. */\n    if (virNetDevSysfsFile(&phy_path, ifname, \"phy80211/name\") < 0)\n        goto cleanup;\n\n    if ((len = virFileReadAllQuiet(phy_path, 1024, &phy)) <= 0) {\n        /* Not a wireless device. */\n        const char *argv[] = {\n            \"ip\", \"link\", \"set\", ifname, \"netns\", NULL, NULL\n        };\n\n        argv[5] = pid;\n        if (virRun(argv, NULL) < 0)\n            goto cleanup;\n\n    } else {\n        const char *argv[] = {\n            \"iw\", \"phy\", NULL, \"set\", \"netns\", NULL, NULL\n        };\n\n        /* Remove a line break. */\n        phy[len - 1] = '\\0';\n\n        argv[2] = phy;\n        argv[5] = pid;\n        if (virRun(argv, NULL) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FREE(phy_path);\n    VIR_FREE(phy);\n    VIR_FREE(pid);\n    return ret;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevSetNamespace(const char *ifname, pid_t pidInNs)\n{\n    int ret = -1;\n    char *pid = NULL;\n    char *phy = NULL;\n    char *phy_path = NULL;\n    int len;\n\n    pid = g_strdup_printf(\"%lld\", (long long) pidInNs);\n\n    /* The 802.11 wireless devices only move together with their PHY. */\n    if (virNetDevSysfsFile(&phy_path, ifname, \"phy80211/name\") < 0)\n        goto cleanup;\n\n    if ((len = virFileReadAllQuiet(phy_path, 1024, &phy)) <= 0) {\n        /* Not a wireless device. */\n        const char *argv[] = {\n            \"ip\", \"link\", \"set\", ifname, \"netns\", NULL, NULL\n        };\n\n        argv[5] = pid;\n        if (virRun(argv, NULL) < 0)\n            goto cleanup;\n\n    } else {\n        const char *argv[] = {\n            \"iw\", \"phy\", NULL, \"set\", \"netns\", NULL, NULL\n        };\n\n        /* Remove a line break. */\n        phy[len - 1] = '\\0';\n\n        argv[2] = phy;\n        argv[5] = pid;\n        if (virRun(argv, NULL) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FREE(phy_path);\n    VIR_FREE(phy);\n    VIR_FREE(pid);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int virLXCControllerMoveInterfaces(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr def = ctrl->def;\n\n    for (i = 0; i < ctrl->nveths; i++) {\n        if (virNetDevSetNamespace(ctrl->veths[i], ctrl->initpid) < 0)\n            return -1;\n    }\n\n    for (i = 0; i < def->nhostdevs; i ++) {\n        virDomainHostdevDefPtr hdev = def->hostdevs[i];\n\n        if (hdev->mode != VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES)\n            continue;\n\n        virDomainHostdevCaps hdcaps = hdev->source.caps;\n\n        if (hdcaps.type != VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            continue;\n\n        if (virNetDevSetNamespace(hdcaps.u.net.ifname, ctrl->initpid) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupAllDisks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1986-1999",
    "snippet": "static int virLXCControllerSetupAllDisks(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    VIR_DEBUG(\"Setting up disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        if (virLXCControllerSetupDisk(ctrl, ctrl->def->disks[i],\n                                      ctrl->securityManager) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Setup all disks\");\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setup all disks\""
          ],
          "line": 1997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupDisk",
          "args": [
            "ctrl",
            "ctrl->def->disks[i]",
            "ctrl->securityManager"
          ],
          "line": 1992
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupDisk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1909-1984",
          "snippet": "static int virLXCControllerSetupDisk(virLXCControllerPtr ctrl,\n                                     virDomainDiskDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *tmpsrc = def->src->path;\n\n    if (virDomainDiskGetType(def) != VIR_STORAGE_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk for non-block device\"));\n        goto cleanup;\n    }\n    if (!tmpsrc) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk without media\"));\n        goto cleanup;\n    }\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                          def->dst);\n\n    if (stat(def->src->path, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), tmpsrc);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode) && !S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Disk source %s must be a character/block device\"),\n                       tmpsrc);\n        goto cleanup;\n    }\n\n    mode = 0700;\n    if (S_ISCHR(sb.st_mode))\n        mode |= S_IFCHR;\n    else\n        mode |= S_IFBLK;\n\n    /* Yes, the device name we're creating may not\n     * actually correspond to the major:minor number\n     * we're using, but we've no other option at this\n     * time. Just have to hope that containerized apps\n     * don't get upset that the major:minor is different\n     * to that normally implied by the device name\n     */\n    VIR_DEBUG(\"Creating dev %s (%d,%d) from %s\",\n              dst, major(sb.st_rdev), minor(sb.st_rdev), tmpsrc);\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(ctrl->def, dst) < 0)\n        goto cleanup;\n\n    /* Labelling normally operates on src, but we need\n     * to actually label the dst here, so hack the config */\n    def->src->path = dst;\n    if (virSecurityManagerSetImageLabel(securityDriver, ctrl->def, def->src,\n                                        VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->src->path = tmpsrc;\n    VIR_FREE(dst);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupDisk(virLXCControllerPtr ctrl,\n                                     virDomainDiskDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *tmpsrc = def->src->path;\n\n    if (virDomainDiskGetType(def) != VIR_STORAGE_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk for non-block device\"));\n        goto cleanup;\n    }\n    if (!tmpsrc) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk without media\"));\n        goto cleanup;\n    }\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                          def->dst);\n\n    if (stat(def->src->path, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), tmpsrc);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode) && !S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Disk source %s must be a character/block device\"),\n                       tmpsrc);\n        goto cleanup;\n    }\n\n    mode = 0700;\n    if (S_ISCHR(sb.st_mode))\n        mode |= S_IFCHR;\n    else\n        mode |= S_IFBLK;\n\n    /* Yes, the device name we're creating may not\n     * actually correspond to the major:minor number\n     * we're using, but we've no other option at this\n     * time. Just have to hope that containerized apps\n     * don't get upset that the major:minor is different\n     * to that normally implied by the device name\n     */\n    VIR_DEBUG(\"Creating dev %s (%d,%d) from %s\",\n              dst, major(sb.st_rdev), minor(sb.st_rdev), tmpsrc);\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(ctrl->def, dst) < 0)\n        goto cleanup;\n\n    /* Labelling normally operates on src, but we need\n     * to actually label the dst here, so hack the config */\n    def->src->path = dst;\n    if (virSecurityManagerSetImageLabel(securityDriver, ctrl->def, def->src,\n                                        VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->src->path = tmpsrc;\n    VIR_FREE(dst);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up disks\""
          ],
          "line": 1989
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupAllDisks(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    VIR_DEBUG(\"Setting up disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        if (virLXCControllerSetupDisk(ctrl, ctrl->def->disks[i],\n                                      ctrl->securityManager) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Setup all disks\");\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupDisk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1909-1984",
    "snippet": "static int virLXCControllerSetupDisk(virLXCControllerPtr ctrl,\n                                     virDomainDiskDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *tmpsrc = def->src->path;\n\n    if (virDomainDiskGetType(def) != VIR_STORAGE_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk for non-block device\"));\n        goto cleanup;\n    }\n    if (!tmpsrc) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk without media\"));\n        goto cleanup;\n    }\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                          def->dst);\n\n    if (stat(def->src->path, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), tmpsrc);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode) && !S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Disk source %s must be a character/block device\"),\n                       tmpsrc);\n        goto cleanup;\n    }\n\n    mode = 0700;\n    if (S_ISCHR(sb.st_mode))\n        mode |= S_IFCHR;\n    else\n        mode |= S_IFBLK;\n\n    /* Yes, the device name we're creating may not\n     * actually correspond to the major:minor number\n     * we're using, but we've no other option at this\n     * time. Just have to hope that containerized apps\n     * don't get upset that the major:minor is different\n     * to that normally implied by the device name\n     */\n    VIR_DEBUG(\"Creating dev %s (%d,%d) from %s\",\n              dst, major(sb.st_rdev), minor(sb.st_rdev), tmpsrc);\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(ctrl->def, dst) < 0)\n        goto cleanup;\n\n    /* Labelling normally operates on src, but we need\n     * to actually label the dst here, so hack the config */\n    def->src->path = dst;\n    if (virSecurityManagerSetImageLabel(securityDriver, ctrl->def, def->src,\n                                        VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->src->path = tmpsrc;\n    VIR_FREE(dst);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dst"
          ],
          "line": 1982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetImageLabel",
          "args": [
            "securityDriver",
            "ctrl->def",
            "def->src",
            "VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN"
          ],
          "line": 1974
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetImageLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "543-559",
          "snippet": "int\nvirSecurityManagerSetImageLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr vm,\n                                virStorageSourcePtr src,\n                                virSecurityDomainImageLabelFlags flags)\n{\n    if (mgr->drv->domainSetSecurityImageLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityImageLabel(mgr, vm, src, flags);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetImageLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr vm,\n                                virStorageSourcePtr src,\n                                virSecurityDomainImageLabelFlags flags)\n{\n    if (mgr->drv->domainSetSecurityImageLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityImageLabel(mgr, vm, src, flags);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "ctrl->def",
            "dst"
          ],
          "line": 1968
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create device %s\")",
            "dst"
          ],
          "line": 1962
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create device %s\""
          ],
          "line": 1963
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mknod",
          "args": [
            "dst",
            "mode",
            "sb.st_rdev"
          ],
          "line": 1961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating dev %s (%d,%d) from %s\"",
            "dst",
            "major(sb.st_rdev)",
            "minor(sb.st_rdev)",
            "tmpsrc"
          ],
          "line": 1959
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "minor",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "major",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISCHR",
          "args": [
            "sb.st_mode"
          ],
          "line": 1947
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Disk source %s must be a character/block device\")",
            "tmpsrc"
          ],
          "line": 1940
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISBLK",
          "args": [
            "sb.st_mode"
          ],
          "line": 1939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISCHR",
          "args": [
            "sb.st_mode"
          ],
          "line": 1939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to access %s\")",
            "tmpsrc"
          ],
          "line": 1934
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "def->src->path",
            "&sb"
          ],
          "line": 1933
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/%s/%s.dev/%s\"",
            "LXC_STATE_DIR",
            "ctrl->def->name",
            "def->dst"
          ],
          "line": 1930
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Can't setup disk without media\")"
          ],
          "line": 1925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Can't setup disk for non-block device\")"
          ],
          "line": 1920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetType",
          "args": [
            "def"
          ],
          "line": 1919
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2141-2145",
          "snippet": "int\nvirDomainDiskGetType(virDomainDiskDefPtr def)\n{\n    return def->src->type;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirDomainDiskGetType(virDomainDiskDefPtr def)\n{\n    return def->src->type;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupDisk(virLXCControllerPtr ctrl,\n                                     virDomainDiskDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *tmpsrc = def->src->path;\n\n    if (virDomainDiskGetType(def) != VIR_STORAGE_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk for non-block device\"));\n        goto cleanup;\n    }\n    if (!tmpsrc) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Can't setup disk without media\"));\n        goto cleanup;\n    }\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                          def->dst);\n\n    if (stat(def->src->path, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), tmpsrc);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode) && !S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Disk source %s must be a character/block device\"),\n                       tmpsrc);\n        goto cleanup;\n    }\n\n    mode = 0700;\n    if (S_ISCHR(sb.st_mode))\n        mode |= S_IFCHR;\n    else\n        mode |= S_IFBLK;\n\n    /* Yes, the device name we're creating may not\n     * actually correspond to the major:minor number\n     * we're using, but we've no other option at this\n     * time. Just have to hope that containerized apps\n     * don't get upset that the major:minor is different\n     * to that normally implied by the device name\n     */\n    VIR_DEBUG(\"Creating dev %s (%d,%d) from %s\",\n              dst, major(sb.st_rdev), minor(sb.st_rdev), tmpsrc);\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(ctrl->def, dst) < 0)\n        goto cleanup;\n\n    /* Labelling normally operates on src, but we need\n     * to actually label the dst here, so hack the config */\n    def->src->path = dst;\n    if (virSecurityManagerSetImageLabel(securityDriver, ctrl->def, def->src,\n                                        VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->src->path = tmpsrc;\n    VIR_FREE(dst);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerSetupAllHostdevs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1873-1906",
    "snippet": "static int\nvirLXCControllerSetupAllHostdevs(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr vmDef = ctrl->def;\n    virSecurityManagerPtr securityDriver = ctrl->securityManager;\n    VIR_DEBUG(\"Setting up hostdevs\");\n\n    for (i = 0; i < vmDef->nhostdevs; i++) {\n        virDomainHostdevDefPtr def = vmDef->hostdevs[i];\n        switch (def->mode) {\n        case VIR_DOMAIN_HOSTDEV_MODE_SUBSYS:\n            if (virLXCControllerSetupHostdevSubsys(vmDef,\n                                                   def,\n                                                   securityDriver) < 0)\n                return -1;\n            break;\n        case VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES:\n            if (virLXCControllerSetupHostdevCaps(vmDef,\n                                                 def,\n                                                 securityDriver) < 0)\n                return -1;\n            break;\n        default:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported host device mode %s\"),\n                           virDomainHostdevModeTypeToString(def->mode));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all hostdevs\");\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setup all hostdevs\""
          ],
          "line": 1904
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Unsupported host device mode %s\")",
            "virDomainHostdevModeTypeToString(def->mode)"
          ],
          "line": 1897
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainHostdevModeTypeToString",
          "args": [
            "def->mode"
          ],
          "line": 1899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unsupported host device mode %s\""
          ],
          "line": 1898
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupHostdevCaps",
          "args": [
            "vmDef",
            "def",
            "securityDriver"
          ],
          "line": 1891
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupHostdevCaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1845-1870",
          "snippet": "static int\nvirLXCControllerSetupHostdevCaps(virDomainDefPtr vmDef,\n                                 virDomainHostdevDefPtr def,\n                                 virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_STORAGE:\n        return virLXCControllerSetupHostdevCapsStorage(vmDef,\n                                                       def,\n                                                       securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_MISC:\n        return virLXCControllerSetupHostdevCapsMisc(vmDef,\n                                                    def,\n                                                    securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET:\n        return 0; /* case is handled in virLXCControllerMoveInterfaces */\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevCapsTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevCaps(virDomainDefPtr vmDef,\n                                 virDomainHostdevDefPtr def,\n                                 virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_STORAGE:\n        return virLXCControllerSetupHostdevCapsStorage(vmDef,\n                                                       def,\n                                                       securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_MISC:\n        return virLXCControllerSetupHostdevCapsMisc(vmDef,\n                                                    def,\n                                                    securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET:\n        return 0; /* case is handled in virLXCControllerMoveInterfaces */\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevCapsTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupHostdevSubsys",
          "args": [
            "vmDef",
            "def",
            "securityDriver"
          ],
          "line": 1885
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupHostdevSubsys",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1825-1842",
          "snippet": "static int\nvirLXCControllerSetupHostdevSubsys(virDomainDefPtr vmDef,\n                                   virDomainHostdevDefPtr def,\n                                   virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_USB:\n        return virLXCControllerSetupHostdevSubsysUSB(vmDef,\n                                                     def,\n                                                     securityDriver);\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevSubsysTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevSubsys(virDomainDefPtr vmDef,\n                                   virDomainHostdevDefPtr def,\n                                   virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_USB:\n        return virLXCControllerSetupHostdevSubsysUSB(vmDef,\n                                                     def,\n                                                     securityDriver);\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevSubsysTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up hostdevs\""
          ],
          "line": 1879
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupAllHostdevs(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    virDomainDefPtr vmDef = ctrl->def;\n    virSecurityManagerPtr securityDriver = ctrl->securityManager;\n    VIR_DEBUG(\"Setting up hostdevs\");\n\n    for (i = 0; i < vmDef->nhostdevs; i++) {\n        virDomainHostdevDefPtr def = vmDef->hostdevs[i];\n        switch (def->mode) {\n        case VIR_DOMAIN_HOSTDEV_MODE_SUBSYS:\n            if (virLXCControllerSetupHostdevSubsys(vmDef,\n                                                   def,\n                                                   securityDriver) < 0)\n                return -1;\n            break;\n        case VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES:\n            if (virLXCControllerSetupHostdevCaps(vmDef,\n                                                 def,\n                                                 securityDriver) < 0)\n                return -1;\n            break;\n        default:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported host device mode %s\"),\n                           virDomainHostdevModeTypeToString(def->mode));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all hostdevs\");\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupHostdevCaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1845-1870",
    "snippet": "static int\nvirLXCControllerSetupHostdevCaps(virDomainDefPtr vmDef,\n                                 virDomainHostdevDefPtr def,\n                                 virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_STORAGE:\n        return virLXCControllerSetupHostdevCapsStorage(vmDef,\n                                                       def,\n                                                       securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_MISC:\n        return virLXCControllerSetupHostdevCapsMisc(vmDef,\n                                                    def,\n                                                    securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET:\n        return 0; /* case is handled in virLXCControllerMoveInterfaces */\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevCapsTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Unsupported host device mode %s\")",
            "virDomainHostdevCapsTypeToString(def->source.subsys.type)"
          ],
          "line": 1865
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainHostdevCapsTypeToString",
          "args": [
            "def->source.subsys.type"
          ],
          "line": 1867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unsupported host device mode %s\""
          ],
          "line": 1866
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupHostdevCapsMisc",
          "args": [
            "vmDef",
            "def",
            "securityDriver"
          ],
          "line": 1857
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupHostdevCapsMisc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1750-1823",
          "snippet": "static int\nvirLXCControllerSetupHostdevCapsMisc(virDomainDefPtr vmDef,\n                                     virDomainHostdevDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.misc.chardev;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a character device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dst);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.misc.chardev = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.misc.chardev = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevCapsMisc(virDomainDefPtr vmDef,\n                                     virDomainHostdevDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.misc.chardev;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a character device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dst);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.misc.chardev = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.misc.chardev = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupHostdevCapsStorage",
          "args": [
            "vmDef",
            "def",
            "securityDriver"
          ],
          "line": 1852
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupHostdevCapsStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1674-1747",
          "snippet": "static int\nvirLXCControllerSetupHostdevCapsStorage(virDomainDefPtr vmDef,\n                                        virDomainHostdevDefPtr def,\n                                        virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.storage.block;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a block device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dev);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFBLK;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.storage.block = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.storage.block = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevCapsStorage(virDomainDefPtr vmDef,\n                                        virDomainHostdevDefPtr def,\n                                        virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.storage.block;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a block device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dev);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFBLK;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.storage.block = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.storage.block = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevCaps(virDomainDefPtr vmDef,\n                                 virDomainHostdevDefPtr def,\n                                 virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_STORAGE:\n        return virLXCControllerSetupHostdevCapsStorage(vmDef,\n                                                       def,\n                                                       securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_MISC:\n        return virLXCControllerSetupHostdevCapsMisc(vmDef,\n                                                    def,\n                                                    securityDriver);\n\n    case VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET:\n        return 0; /* case is handled in virLXCControllerMoveInterfaces */\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevCapsTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}"
  },
  {
    "function_name": "virLXCControllerSetupHostdevSubsys",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1825-1842",
    "snippet": "static int\nvirLXCControllerSetupHostdevSubsys(virDomainDefPtr vmDef,\n                                   virDomainHostdevDefPtr def,\n                                   virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_USB:\n        return virLXCControllerSetupHostdevSubsysUSB(vmDef,\n                                                     def,\n                                                     securityDriver);\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevSubsysTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Unsupported host device mode %s\")",
            "virDomainHostdevSubsysTypeToString(def->source.subsys.type)"
          ],
          "line": 1837
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainHostdevSubsysTypeToString",
          "args": [
            "def->source.subsys.type"
          ],
          "line": 1839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unsupported host device mode %s\""
          ],
          "line": 1838
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupHostdevSubsysUSB",
          "args": [
            "vmDef",
            "def",
            "securityDriver"
          ],
          "line": 1832
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupHostdevSubsysUSB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1604-1671",
          "snippet": "static int\nvirLXCControllerSetupHostdevSubsysUSB(virDomainDefPtr vmDef,\n                                      virDomainHostdevDefPtr def,\n                                      virSecurityManagerPtr securityDriver)\n{\n    int ret = -1;\n    char *src = NULL;\n    char *dstdir = NULL;\n    char *dstfile = NULL;\n    char *vroot = NULL;\n    struct stat sb;\n    mode_t mode;\n    virDomainHostdevSubsysUSBPtr usbsrc = &def->source.subsys.u.usb;\n\n    src = g_strdup_printf(USB_DEVFS \"/%03d/%03d\", usbsrc->bus, usbsrc->device);\n\n    vroot = g_strdup_printf(\"/%s/%s.dev/bus/usb/\", LXC_STATE_DIR, vmDef->name);\n\n    dstdir = g_strdup_printf(\"%s/%03d/\", vroot, usbsrc->bus);\n\n    dstfile = g_strdup_printf(\"%s/%03d\", dstdir, usbsrc->device);\n\n    if (stat(src, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), src);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"USB source %s was not a character device\"),\n                       src);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    if (virFileMakePath(dstdir) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create %s\"), dstdir);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\",\n              dstfile, major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dstfile, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dstfile);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dstfile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetHostdevLabel(securityDriver,\n                                          vmDef, def, vroot) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    VIR_FREE(dstfile);\n    VIR_FREE(dstdir);\n    VIR_FREE(vroot);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevSubsysUSB(virDomainDefPtr vmDef,\n                                      virDomainHostdevDefPtr def,\n                                      virSecurityManagerPtr securityDriver)\n{\n    int ret = -1;\n    char *src = NULL;\n    char *dstdir = NULL;\n    char *dstfile = NULL;\n    char *vroot = NULL;\n    struct stat sb;\n    mode_t mode;\n    virDomainHostdevSubsysUSBPtr usbsrc = &def->source.subsys.u.usb;\n\n    src = g_strdup_printf(USB_DEVFS \"/%03d/%03d\", usbsrc->bus, usbsrc->device);\n\n    vroot = g_strdup_printf(\"/%s/%s.dev/bus/usb/\", LXC_STATE_DIR, vmDef->name);\n\n    dstdir = g_strdup_printf(\"%s/%03d/\", vroot, usbsrc->bus);\n\n    dstfile = g_strdup_printf(\"%s/%03d\", dstdir, usbsrc->device);\n\n    if (stat(src, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), src);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"USB source %s was not a character device\"),\n                       src);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    if (virFileMakePath(dstdir) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create %s\"), dstdir);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\",\n              dstfile, major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dstfile, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dstfile);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dstfile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetHostdevLabel(securityDriver,\n                                          vmDef, def, vroot) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    VIR_FREE(dstfile);\n    VIR_FREE(dstdir);\n    VIR_FREE(vroot);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevSubsys(virDomainDefPtr vmDef,\n                                   virDomainHostdevDefPtr def,\n                                   virSecurityManagerPtr securityDriver)\n{\n    switch (def->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_USB:\n        return virLXCControllerSetupHostdevSubsysUSB(vmDef,\n                                                     def,\n                                                     securityDriver);\n\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported host device mode %s\"),\n                       virDomainHostdevSubsysTypeToString(def->source.subsys.type));\n        return -1;\n    }\n}"
  },
  {
    "function_name": "virLXCControllerSetupHostdevCapsMisc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1750-1823",
    "snippet": "static int\nvirLXCControllerSetupHostdevCapsMisc(virDomainDefPtr vmDef,\n                                     virDomainHostdevDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.misc.chardev;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a character device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dst);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.misc.chardev = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.misc.chardev = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "path"
          ],
          "line": 1821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dst"
          ],
          "line": 1820
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetHostdevLabel",
          "args": [
            "securityDriver",
            "vmDef",
            "def",
            "NULL"
          ],
          "line": 1813
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetHostdevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "581-597",
          "snippet": "int\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "vmDef",
            "dst"
          ],
          "line": 1809
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create device %s\")",
            "dev"
          ],
          "line": 1803
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create device %s\""
          ],
          "line": 1804
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mknod",
          "args": [
            "dst",
            "mode",
            "sb.st_rdev"
          ],
          "line": 1802
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating dev %s (%d,%d)\"",
            "dst",
            "major(sb.st_rdev)",
            "minor(sb.st_rdev)"
          ],
          "line": 1800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "minor",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "major",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "errno",
            "_(\"Failed to create directory for device %s\")",
            "dst"
          ],
          "line": 1792
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerSetupHostdevCapsMakePath",
          "args": [
            "dst"
          ],
          "line": 1791
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetupHostdevCapsMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1601-1623",
          "snippet": "int lxcContainerSetupHostdevCapsMakePath(const char *dev)\n{\n    int ret = -1;\n    char *dir, *tmp;\n\n    dir = g_strdup(dev);\n\n    if ((tmp = strrchr(dir, '/'))) {\n        *tmp = '\\0';\n        if (virFileMakePath(dir) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to create directory for '%s' dev '%s'\"),\n                                 dir, dev);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(dir);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerSetupHostdevCapsMakePath(const char *dev)\n{\n    int ret = -1;\n    char *dir, *tmp;\n\n    dir = g_strdup(dev);\n\n    if ((tmp = strrchr(dir, '/'))) {\n        *tmp = '\\0';\n        if (virFileMakePath(dir) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to create directory for '%s' dev '%s'\"),\n                                 dir, dev);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(dir);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Storage source %s must be a character device\")",
            "dev"
          ],
          "line": 1785
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISCHR",
          "args": [
            "sb.st_mode"
          ],
          "line": 1784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to access %s\")",
            "dev"
          ],
          "line": 1778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "dev",
            "&sb"
          ],
          "line": 1777
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/%s/%s.dev/%s\"",
            "LXC_STATE_DIR",
            "vmDef->name",
            "strchr(path + len, '/')"
          ],
          "line": 1774
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "path + len",
            "'/'"
          ],
          "line": 1775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Missing storage host block path\")"
          ],
          "line": 1764
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevCapsMisc(virDomainDefPtr vmDef,\n                                     virDomainHostdevDefPtr def,\n                                     virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.misc.chardev;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a character device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dst);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.misc.chardev = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.misc.chardev = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerSetupHostdevCapsStorage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1674-1747",
    "snippet": "static int\nvirLXCControllerSetupHostdevCapsStorage(virDomainDefPtr vmDef,\n                                        virDomainHostdevDefPtr def,\n                                        virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.storage.block;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a block device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dev);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFBLK;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.storage.block = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.storage.block = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "path"
          ],
          "line": 1745
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dst"
          ],
          "line": 1744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetHostdevLabel",
          "args": [
            "securityDriver",
            "vmDef",
            "def",
            "NULL"
          ],
          "line": 1737
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetHostdevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "581-597",
          "snippet": "int\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "vmDef",
            "dst"
          ],
          "line": 1733
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create device %s\")",
            "dst"
          ],
          "line": 1727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create device %s\""
          ],
          "line": 1728
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mknod",
          "args": [
            "dst",
            "mode",
            "sb.st_rdev"
          ],
          "line": 1726
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating dev %s (%d,%d)\"",
            "dst",
            "major(sb.st_rdev)",
            "minor(sb.st_rdev)"
          ],
          "line": 1724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "minor",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "major",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "errno",
            "_(\"Failed to create directory for device %s\")",
            "dev"
          ],
          "line": 1716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerSetupHostdevCapsMakePath",
          "args": [
            "dst"
          ],
          "line": 1715
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetupHostdevCapsMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1601-1623",
          "snippet": "int lxcContainerSetupHostdevCapsMakePath(const char *dev)\n{\n    int ret = -1;\n    char *dir, *tmp;\n\n    dir = g_strdup(dev);\n\n    if ((tmp = strrchr(dir, '/'))) {\n        *tmp = '\\0';\n        if (virFileMakePath(dir) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to create directory for '%s' dev '%s'\"),\n                                 dir, dev);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(dir);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerSetupHostdevCapsMakePath(const char *dev)\n{\n    int ret = -1;\n    char *dir, *tmp;\n\n    dir = g_strdup(dev);\n\n    if ((tmp = strrchr(dir, '/'))) {\n        *tmp = '\\0';\n        if (virFileMakePath(dir) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to create directory for '%s' dev '%s'\"),\n                                 dir, dev);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(dir);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Storage source %s must be a block device\")",
            "dev"
          ],
          "line": 1709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISBLK",
          "args": [
            "sb.st_mode"
          ],
          "line": 1708
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to access %s\")",
            "dev"
          ],
          "line": 1702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "dev",
            "&sb"
          ],
          "line": 1701
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/%s/%s.dev/%s\"",
            "LXC_STATE_DIR",
            "vmDef->name",
            "strchr(path + len, '/')"
          ],
          "line": 1698
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "path + len",
            "'/'"
          ],
          "line": 1699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Missing storage host block path\")"
          ],
          "line": 1688
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevCapsStorage(virDomainDefPtr vmDef,\n                                        virDomainHostdevDefPtr def,\n                                        virSecurityManagerPtr securityDriver)\n{\n    char *dst = NULL;\n    char *path = NULL;\n    int len = 0;\n    int ret = -1;\n    struct stat sb;\n    mode_t mode;\n    char *dev = def->source.caps.u.storage.block;\n\n    if (dev == NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Missing storage host block path\"));\n        goto cleanup;\n    }\n\n    path = g_strdup(dev);\n\n    while (*(path + len) == '/')\n        len++;\n\n    dst = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, vmDef->name,\n                          strchr(path + len, '/'));\n\n    if (stat(dev, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"),\n                             dev);\n        goto cleanup;\n    }\n\n    if (!S_ISBLK(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Storage source %s must be a block device\"),\n                       dev);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetupHostdevCapsMakePath(dst) < 0) {\n        virReportError(errno,\n                       _(\"Failed to create directory for device %s\"),\n                       dev);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFBLK;\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\", dst,\n              major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dst, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dst) < 0)\n        goto cleanup;\n\n    def->source.caps.u.storage.block = dst;\n    if (virSecurityManagerSetHostdevLabel(securityDriver, vmDef, def, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    def->source.caps.u.storage.block = dev;\n    VIR_FREE(dst);\n    VIR_FREE(path);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerSetupHostdevSubsysUSB",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1604-1671",
    "snippet": "static int\nvirLXCControllerSetupHostdevSubsysUSB(virDomainDefPtr vmDef,\n                                      virDomainHostdevDefPtr def,\n                                      virSecurityManagerPtr securityDriver)\n{\n    int ret = -1;\n    char *src = NULL;\n    char *dstdir = NULL;\n    char *dstfile = NULL;\n    char *vroot = NULL;\n    struct stat sb;\n    mode_t mode;\n    virDomainHostdevSubsysUSBPtr usbsrc = &def->source.subsys.u.usb;\n\n    src = g_strdup_printf(USB_DEVFS \"/%03d/%03d\", usbsrc->bus, usbsrc->device);\n\n    vroot = g_strdup_printf(\"/%s/%s.dev/bus/usb/\", LXC_STATE_DIR, vmDef->name);\n\n    dstdir = g_strdup_printf(\"%s/%03d/\", vroot, usbsrc->bus);\n\n    dstfile = g_strdup_printf(\"%s/%03d\", dstdir, usbsrc->device);\n\n    if (stat(src, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), src);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"USB source %s was not a character device\"),\n                       src);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    if (virFileMakePath(dstdir) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create %s\"), dstdir);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\",\n              dstfile, major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dstfile, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dstfile);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dstfile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetHostdevLabel(securityDriver,\n                                          vmDef, def, vroot) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    VIR_FREE(dstfile);\n    VIR_FREE(dstdir);\n    VIR_FREE(vroot);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vroot"
          ],
          "line": 1669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dstdir"
          ],
          "line": 1668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dstfile"
          ],
          "line": 1667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "src"
          ],
          "line": 1666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetHostdevLabel",
          "args": [
            "securityDriver",
            "vmDef",
            "def",
            "vroot"
          ],
          "line": 1659
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetHostdevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "581-597",
          "snippet": "int\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "vmDef",
            "dstfile"
          ],
          "line": 1656
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create device %s\")",
            "dstfile"
          ],
          "line": 1650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create device %s\""
          ],
          "line": 1651
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mknod",
          "args": [
            "dstfile",
            "mode",
            "sb.st_rdev"
          ],
          "line": 1649
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating dev %s (%d,%d)\"",
            "dstfile",
            "major(sb.st_rdev)",
            "minor(sb.st_rdev)"
          ],
          "line": 1647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "minor",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1648
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "major",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1648
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create %s\")",
            "dstdir"
          ],
          "line": 1642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "dstdir"
          ],
          "line": 1641
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"USB source %s was not a character device\")",
            "src"
          ],
          "line": 1633
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISCHR",
          "args": [
            "sb.st_mode"
          ],
          "line": 1632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to access %s\")",
            "src"
          ],
          "line": 1627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "src",
            "&sb"
          ],
          "line": 1626
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%03d\"",
            "dstdir",
            "usbsrc->device"
          ],
          "line": 1624
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupHostdevSubsysUSB(virDomainDefPtr vmDef,\n                                      virDomainHostdevDefPtr def,\n                                      virSecurityManagerPtr securityDriver)\n{\n    int ret = -1;\n    char *src = NULL;\n    char *dstdir = NULL;\n    char *dstfile = NULL;\n    char *vroot = NULL;\n    struct stat sb;\n    mode_t mode;\n    virDomainHostdevSubsysUSBPtr usbsrc = &def->source.subsys.u.usb;\n\n    src = g_strdup_printf(USB_DEVFS \"/%03d/%03d\", usbsrc->bus, usbsrc->device);\n\n    vroot = g_strdup_printf(\"/%s/%s.dev/bus/usb/\", LXC_STATE_DIR, vmDef->name);\n\n    dstdir = g_strdup_printf(\"%s/%03d/\", vroot, usbsrc->bus);\n\n    dstfile = g_strdup_printf(\"%s/%03d\", dstdir, usbsrc->device);\n\n    if (stat(src, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to access %s\"), src);\n        goto cleanup;\n    }\n\n    if (!S_ISCHR(sb.st_mode)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"USB source %s was not a character device\"),\n                       src);\n        goto cleanup;\n    }\n\n    mode = 0700 | S_IFCHR;\n\n    if (virFileMakePath(dstdir) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create %s\"), dstdir);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Creating dev %s (%d,%d)\",\n              dstfile, major(sb.st_rdev), minor(sb.st_rdev));\n    if (mknod(dstfile, mode, sb.st_rdev) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to create device %s\"),\n                             dstfile);\n        goto cleanup;\n    }\n\n    if (lxcContainerChown(vmDef, dstfile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetHostdevLabel(securityDriver,\n                                          vmDef, def, vroot) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    VIR_FREE(dstfile);\n    VIR_FREE(dstdir);\n    VIR_FREE(vroot);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerSetupTimers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1533-1601",
    "snippet": "static int\nvirLXCControllerSetupTimers(virLXCControllerPtr ctrl)\n{\n    virDomainDefPtr def = ctrl->def;\n    size_t i;\n\n    /* Not sync'ed with Host clock */\n    if (def->clock.offset != VIR_DOMAIN_CLOCK_OFFSET_LOCALTIME)\n        return 0;\n\n    for (i = 0; i < def->clock.ntimers; i++) {\n        virDomainTimerDefPtr timer = def->clock.timers[i];\n        g_autofree char *path = NULL;\n        const char *timer_dev = NULL;\n        struct stat sb;\n        dev_t dev;\n\n        /* Check if \"present\" is set to \"no\" otherwise enable it. */\n        if (!timer->present)\n            continue;\n\n        switch ((virDomainTimerNameType)timer->name) {\n        case VIR_DOMAIN_TIMER_NAME_PLATFORM:\n        case VIR_DOMAIN_TIMER_NAME_TSC:\n        case VIR_DOMAIN_TIMER_NAME_KVMCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_HYPERVCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_PIT:\n        case VIR_DOMAIN_TIMER_NAME_ARMVTIMER:\n        case VIR_DOMAIN_TIMER_NAME_LAST:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"unsupported timer type (name) '%s'\"),\n                           virDomainTimerNameTypeToString(timer->name));\n            return -1;\n        case VIR_DOMAIN_TIMER_NAME_RTC:\n            timer_dev = \"/dev/rtc0\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   def->name, \"/rtc\");\n            break;\n        case VIR_DOMAIN_TIMER_NAME_HPET:\n            timer_dev = \"/dev/hpet\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   ctrl->def->name, \"/hpet\");\n            break;\n        }\n\n        if (!timer_dev)\n            continue;\n\n        if (stat(timer_dev, &sb) < 0) {\n            virReportSystemError(errno, _(\"Unable to access %s\"),\n                                 timer_dev);\n            return -1;\n        }\n\n        dev = makedev(major(sb.st_rdev), minor(sb.st_rdev));\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, sb.st_mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "def",
            "path"
          ],
          "line": 1596
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make device %s\")",
            "path"
          ],
          "line": 1590
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to make device %s\""
          ],
          "line": 1591
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "chmod",
          "args": [
            "path",
            "sb.st_mode"
          ],
          "line": 1589
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mknod",
          "args": [
            "path",
            "S_IFCHR",
            "dev"
          ],
          "line": 1588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "makedev",
          "args": [
            "major(sb.st_rdev)",
            "minor(sb.st_rdev)"
          ],
          "line": 1587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "minor",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "major",
          "args": [
            "sb.st_rdev"
          ],
          "line": 1587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to access %s\")",
            "timer_dev"
          ],
          "line": 1582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "timer_dev",
            "&sb"
          ],
          "line": 1581
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/%s/%s.dev/%s\"",
            "LXC_STATE_DIR",
            "ctrl->def->name",
            "\"/hpet\""
          ],
          "line": 1573
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"unsupported timer type (name) '%s'\")",
            "virDomainTimerNameTypeToString(timer->name)"
          ],
          "line": 1562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainTimerNameTypeToString",
          "args": [
            "timer->name"
          ],
          "line": 1564
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupTimers(virLXCControllerPtr ctrl)\n{\n    virDomainDefPtr def = ctrl->def;\n    size_t i;\n\n    /* Not sync'ed with Host clock */\n    if (def->clock.offset != VIR_DOMAIN_CLOCK_OFFSET_LOCALTIME)\n        return 0;\n\n    for (i = 0; i < def->clock.ntimers; i++) {\n        virDomainTimerDefPtr timer = def->clock.timers[i];\n        g_autofree char *path = NULL;\n        const char *timer_dev = NULL;\n        struct stat sb;\n        dev_t dev;\n\n        /* Check if \"present\" is set to \"no\" otherwise enable it. */\n        if (!timer->present)\n            continue;\n\n        switch ((virDomainTimerNameType)timer->name) {\n        case VIR_DOMAIN_TIMER_NAME_PLATFORM:\n        case VIR_DOMAIN_TIMER_NAME_TSC:\n        case VIR_DOMAIN_TIMER_NAME_KVMCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_HYPERVCLOCK:\n        case VIR_DOMAIN_TIMER_NAME_PIT:\n        case VIR_DOMAIN_TIMER_NAME_ARMVTIMER:\n        case VIR_DOMAIN_TIMER_NAME_LAST:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"unsupported timer type (name) '%s'\"),\n                           virDomainTimerNameTypeToString(timer->name));\n            return -1;\n        case VIR_DOMAIN_TIMER_NAME_RTC:\n            timer_dev = \"/dev/rtc0\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   def->name, \"/rtc\");\n            break;\n        case VIR_DOMAIN_TIMER_NAME_HPET:\n            timer_dev = \"/dev/hpet\";\n            path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR,\n                                   ctrl->def->name, \"/hpet\");\n            break;\n        }\n\n        if (!timer_dev)\n            continue;\n\n        if (stat(timer_dev, &sb) < 0) {\n            virReportSystemError(errno, _(\"Unable to access %s\"),\n                                 timer_dev);\n            return -1;\n        }\n\n        dev = makedev(major(sb.st_rdev), minor(sb.st_rdev));\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, sb.st_mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerPopulateDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1490-1530",
    "snippet": "static int virLXCControllerPopulateDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    g_autofree char *path = NULL;\n    const struct {\n        int maj;\n        int min;\n        mode_t mode;\n        const char *path;\n    } devs[] = {\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_NULL, 0666, \"/null\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_ZERO, 0666, \"/zero\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_FULL, 0666, \"/full\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_RANDOM, 0666, \"/random\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_URANDOM, 0666, \"/urandom\" },\n        { LXC_DEV_MAJ_TTY, LXC_DEV_MIN_TTY, 0666, \"/tty\" },\n    };\n\n    if (virLXCControllerSetupDev(ctrl) < 0)\n        return -1;\n\n    /* Populate /dev/ with a few important bits */\n    for (i = 0; i < G_N_ELEMENTS(devs); i++) {\n        path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                               devs[i].path);\n\n        dev_t dev = makedev(devs[i].maj, devs[i].min);\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, devs[i].mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(ctrl->def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "ctrl->def",
            "path"
          ],
          "line": 1525
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make device %s\")",
            "path"
          ],
          "line": 1519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to make device %s\""
          ],
          "line": 1520
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "chmod",
          "args": [
            "path",
            "devs[i].mode"
          ],
          "line": 1518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mknod",
          "args": [
            "path",
            "S_IFCHR",
            "dev"
          ],
          "line": 1517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "makedev",
          "args": [
            "devs[i].maj",
            "devs[i].min"
          ],
          "line": 1516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/%s/%s.dev/%s\"",
            "LXC_STATE_DIR",
            "ctrl->def->name",
            "devs[i].path"
          ],
          "line": 1513
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "devs"
          ],
          "line": 1512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupDev",
          "args": [
            "ctrl"
          ],
          "line": 1508
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupDevPTS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2163-2216",
          "snippet": "static int\nvirLXCControllerSetupDevPTS(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *devpts = NULL;\n    gid_t ptsgid = 5;\n\n    VIR_DEBUG(\"Setting up private /dev/pts\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    devpts = g_strdup_printf(\"%s/%s.devpts\", LXC_STATE_DIR, ctrl->def->name);\n    ctrl->devptmx = g_strdup_printf(\"%s/%s.devpts/ptmx\", LXC_STATE_DIR, ctrl->def->name);\n\n    if (virFileMakePath(devpts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to make path %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (ctrl->def->idmap.ngidmap)\n        ptsgid = virLXCControllerLookupUsernsMap(ctrl->def->idmap.gidmap,\n                                                 ctrl->def->idmap.ngidmap,\n                                                 ptsgid);\n\n    /* XXX should we support gid=X for X!=5 for distros which use\n     * a different gid for tty?  */\n    opts = g_strdup_printf(\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\", ptsgid,\n                           NULLSTR_EMPTY(mount_options));\n\n    VIR_DEBUG(\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\",\n              devpts, MS_NOSUID, opts);\n    if (mount(\"devpts\", devpts, \"devpts\", MS_NOSUID, opts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount devpts on %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (access(ctrl->devptmx, R_OK) < 0) {\n        virReportSystemError(ENOSYS, \"%s\",\n                             _(\"Kernel does not support private devpts\"));\n        return -1;\n    }\n\n    if ((lxcContainerChown(ctrl->def, ctrl->devptmx) < 0) ||\n        (lxcContainerChown(ctrl->def, devpts) < 0))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int\nvirLXCControllerSetupDevPTS(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *devpts = NULL;\n    gid_t ptsgid = 5;\n\n    VIR_DEBUG(\"Setting up private /dev/pts\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    devpts = g_strdup_printf(\"%s/%s.devpts\", LXC_STATE_DIR, ctrl->def->name);\n    ctrl->devptmx = g_strdup_printf(\"%s/%s.devpts/ptmx\", LXC_STATE_DIR, ctrl->def->name);\n\n    if (virFileMakePath(devpts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to make path %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (ctrl->def->idmap.ngidmap)\n        ptsgid = virLXCControllerLookupUsernsMap(ctrl->def->idmap.gidmap,\n                                                 ctrl->def->idmap.ngidmap,\n                                                 ptsgid);\n\n    /* XXX should we support gid=X for X!=5 for distros which use\n     * a different gid for tty?  */\n    opts = g_strdup_printf(\"newinstance,ptmxmode=0666,mode=0620,gid=%u%s\", ptsgid,\n                           NULLSTR_EMPTY(mount_options));\n\n    VIR_DEBUG(\"Mount devpts on %s type=tmpfs flags=0x%x, opts=%s\",\n              devpts, MS_NOSUID, opts);\n    if (mount(\"devpts\", devpts, \"devpts\", MS_NOSUID, opts) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount devpts on %s\"),\n                             devpts);\n        return -1;\n    }\n\n    if (access(ctrl->devptmx, R_OK) < 0) {\n        virReportSystemError(ENOSYS, \"%s\",\n                             _(\"Kernel does not support private devpts\"));\n        return -1;\n    }\n\n    if ((lxcContainerChown(ctrl->def, ctrl->devptmx) < 0) ||\n        (lxcContainerChown(ctrl->def, devpts) < 0))\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerPopulateDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n    g_autofree char *path = NULL;\n    const struct {\n        int maj;\n        int min;\n        mode_t mode;\n        const char *path;\n    } devs[] = {\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_NULL, 0666, \"/null\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_ZERO, 0666, \"/zero\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_FULL, 0666, \"/full\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_RANDOM, 0666, \"/random\" },\n        { LXC_DEV_MAJ_MEMORY, LXC_DEV_MIN_URANDOM, 0666, \"/urandom\" },\n        { LXC_DEV_MAJ_TTY, LXC_DEV_MIN_TTY, 0666, \"/tty\" },\n    };\n\n    if (virLXCControllerSetupDev(ctrl) < 0)\n        return -1;\n\n    /* Populate /dev/ with a few important bits */\n    for (i = 0; i < G_N_ELEMENTS(devs); i++) {\n        path = g_strdup_printf(\"/%s/%s.dev/%s\", LXC_STATE_DIR, ctrl->def->name,\n                               devs[i].path);\n\n        dev_t dev = makedev(devs[i].maj, devs[i].min);\n        if (mknod(path, S_IFCHR, dev) < 0 ||\n            chmod(path, devs[i].mode)) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make device %s\"),\n                                 path);\n            return -1;\n        }\n\n        if (lxcContainerChown(ctrl->def, path) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupDev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1461-1488",
    "snippet": "static int virLXCControllerSetupDev(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *dev = NULL;\n\n    VIR_DEBUG(\"Setting up /dev/ for container\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    dev = g_strdup_printf(\"/%s/%s.dev\", LXC_STATE_DIR, ctrl->def->name);\n\n    /*\n     * tmpfs is limited to 64kb, since we only have device nodes in there\n     * and don't want to DOS the entire OS RAM usage\n     */\n\n    opts = g_strdup_printf(\"mode=755,size=65536%s\", mount_options);\n\n    if (virFileSetupDev(dev, opts) < 0)\n        return -1;\n\n    if (lxcContainerChown(ctrl->def, dev) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcContainerChown",
          "args": [
            "ctrl->def",
            "dev"
          ],
          "line": 1484
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerChown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2461-2480",
          "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileSetupDev",
          "args": [
            "dev",
            "opts"
          ],
          "line": 1481
        },
        "resolved": true,
        "details": {
          "function_name": "virFileSetupDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3787-3794",
          "snippet": "int\nvirFileSetupDev(const char *path G_GNUC_UNUSED,\n                const char *mount_options G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"mount is not supported on this platform.\"));\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileSetupDev(const char *path G_GNUC_UNUSED,\n                const char *mount_options G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"mount is not supported on this platform.\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"mode=755,size=65536%s\"",
            "mount_options"
          ],
          "line": 1479
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerGetMountOptions",
          "args": [
            "ctrl->securityManager",
            "ctrl->def"
          ],
          "line": 1469
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerGetMountOptions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1014-1028",
          "snippet": "char *\nvirSecurityManagerGetMountOptions(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainGetSecurityMountOptions) {\n        char *ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainGetSecurityMountOptions(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return NULL;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nvirSecurityManagerGetMountOptions(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainGetSecurityMountOptions) {\n        char *ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainGetSecurityMountOptions(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up /dev/ for container\""
          ],
          "line": 1467
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupDev(virLXCControllerPtr ctrl)\n{\n    g_autofree char *mount_options = NULL;\n    g_autofree char *opts = NULL;\n    g_autofree char *dev = NULL;\n\n    VIR_DEBUG(\"Setting up /dev/ for container\");\n\n    mount_options = virSecurityManagerGetMountOptions(ctrl->securityManager,\n                                                      ctrl->def);\n\n    dev = g_strdup_printf(\"/%s/%s.dev\", LXC_STATE_DIR, ctrl->def->name);\n\n    /*\n     * tmpfs is limited to 64kb, since we only have device nodes in there\n     * and don't want to DOS the entire OS RAM usage\n     */\n\n    opts = g_strdup_printf(\"mode=755,size=65536%s\", mount_options);\n\n    if (virFileSetupDev(dev, opts) < 0)\n        return -1;\n\n    if (lxcContainerChown(ctrl->def, dev) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupUserns",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1432-1459",
    "snippet": "static int virLXCControllerSetupUserns(virLXCControllerPtr ctrl)\n{\n    g_autofree char *uid_map = NULL;\n    g_autofree char *gid_map = NULL;\n\n    /* User namespace is disabled for container */\n    if (ctrl->def->idmap.nuidmap == 0) {\n        VIR_DEBUG(\"No uid map, skipping userns setup\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Setting up userns maps\");\n    uid_map = g_strdup_printf(\"/proc/%d/uid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.uidmap,\n                                       ctrl->def->idmap.nuidmap,\n                                       uid_map) < 0)\n        return -1;\n\n    gid_map = g_strdup_printf(\"/proc/%d/gid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.gidmap,\n                                       ctrl->def->idmap.ngidmap,\n                                       gid_map) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerSetupUsernsMap",
          "args": [
            "ctrl->def->idmap.gidmap",
            "ctrl->def->idmap.ngidmap",
            "gid_map"
          ],
          "line": 1453
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupUsernsMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1392-1423",
          "snippet": "static int\nvirLXCControllerSetupUsernsMap(virDomainIdMapEntryPtr map,\n                               int num,\n                               char *path)\n{\n    virBuffer map_value = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    int ret = -1;\n\n    /* The kernel supports up to 340 lines in /proc/<pid>/{g,u}id_map */\n    if (num > 340) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Too many id mappings defined.\"));\n        goto cleanup;\n    }\n\n    for (i = 0; i < num; i++)\n        virBufferAsprintf(&map_value, \"%u %u %u\\n\",\n                          map[i].start, map[i].target, map[i].count);\n\n    VIR_DEBUG(\"Set '%s' to '%s'\", path, virBufferCurrentContent(&map_value));\n\n    if (virFileWriteStr(path, virBufferCurrentContent(&map_value), 0) < 0) {\n        virReportSystemError(errno, _(\"unable write to %s\"), path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virBufferFreeAndReset(&map_value);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupUsernsMap(virDomainIdMapEntryPtr map,\n                               int num,\n                               char *path)\n{\n    virBuffer map_value = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    int ret = -1;\n\n    /* The kernel supports up to 340 lines in /proc/<pid>/{g,u}id_map */\n    if (num > 340) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Too many id mappings defined.\"));\n        goto cleanup;\n    }\n\n    for (i = 0; i < num; i++)\n        virBufferAsprintf(&map_value, \"%u %u %u\\n\",\n                          map[i].start, map[i].target, map[i].count);\n\n    VIR_DEBUG(\"Set '%s' to '%s'\", path, virBufferCurrentContent(&map_value));\n\n    if (virFileWriteStr(path, virBufferCurrentContent(&map_value), 0) < 0) {\n        virReportSystemError(errno, _(\"unable write to %s\"), path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virBufferFreeAndReset(&map_value);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/proc/%d/gid_map\"",
            "ctrl->initpid"
          ],
          "line": 1451
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up userns maps\""
          ],
          "line": 1443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No uid map, skipping userns setup\""
          ],
          "line": 1439
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int virLXCControllerSetupUserns(virLXCControllerPtr ctrl)\n{\n    g_autofree char *uid_map = NULL;\n    g_autofree char *gid_map = NULL;\n\n    /* User namespace is disabled for container */\n    if (ctrl->def->idmap.nuidmap == 0) {\n        VIR_DEBUG(\"No uid map, skipping userns setup\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Setting up userns maps\");\n    uid_map = g_strdup_printf(\"/proc/%d/uid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.uidmap,\n                                       ctrl->def->idmap.nuidmap,\n                                       uid_map) < 0)\n        return -1;\n\n    gid_map = g_strdup_printf(\"/proc/%d/gid_map\", ctrl->initpid);\n\n    if (virLXCControllerSetupUsernsMap(ctrl->def->idmap.gidmap,\n                                       ctrl->def->idmap.ngidmap,\n                                       gid_map) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupUsernsMap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1392-1423",
    "snippet": "static int\nvirLXCControllerSetupUsernsMap(virDomainIdMapEntryPtr map,\n                               int num,\n                               char *path)\n{\n    virBuffer map_value = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    int ret = -1;\n\n    /* The kernel supports up to 340 lines in /proc/<pid>/{g,u}id_map */\n    if (num > 340) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Too many id mappings defined.\"));\n        goto cleanup;\n    }\n\n    for (i = 0; i < num; i++)\n        virBufferAsprintf(&map_value, \"%u %u %u\\n\",\n                          map[i].start, map[i].target, map[i].count);\n\n    VIR_DEBUG(\"Set '%s' to '%s'\", path, virBufferCurrentContent(&map_value));\n\n    if (virFileWriteStr(path, virBufferCurrentContent(&map_value), 0) < 0) {\n        virReportSystemError(errno, _(\"unable write to %s\"), path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virBufferFreeAndReset(&map_value);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferFreeAndReset",
          "args": [
            "&map_value"
          ],
          "line": 1421
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferFreeAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "268-277",
          "snippet": "void virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable write to %s\")",
            "path"
          ],
          "line": 1415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable write to %s\""
          ],
          "line": 1415
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileWriteStr",
          "args": [
            "path",
            "virBufferCurrentContent(&map_value)",
            "0"
          ],
          "line": 1414
        },
        "resolved": true,
        "details": {
          "function_name": "virFileWriteStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1502-1524",
          "snippet": "int\nvirFileWriteStr(const char *path, const char *str, mode_t mode)\n{\n    int fd;\n\n    if (mode)\n        fd = open(path, O_WRONLY|O_TRUNC|O_CREAT, mode);\n    else\n        fd = open(path, O_WRONLY|O_TRUNC);\n    if (fd == -1)\n        return -1;\n\n    if (safewrite(fd, str, strlen(str)) < 0) {\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    /* Use errno from failed close only if there was no write error.  */\n    if (VIR_CLOSE(fd) != 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileWriteStr(const char *path, const char *str, mode_t mode)\n{\n    int fd;\n\n    if (mode)\n        fd = open(path, O_WRONLY|O_TRUNC|O_CREAT, mode);\n    else\n        fd = open(path, O_WRONLY|O_TRUNC);\n    if (fd == -1)\n        return -1;\n\n    if (safewrite(fd, str, strlen(str)) < 0) {\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    /* Use errno from failed close only if there was no write error.  */\n    if (VIR_CLOSE(fd) != 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferCurrentContent",
          "args": [
            "&map_value"
          ],
          "line": 1414
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferCurrentContent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "222-233",
          "snippet": "const char *\nvirBufferCurrentContent(virBufferPtr buf)\n{\n    if (!buf)\n        return NULL;\n\n    if (!buf->str ||\n        buf->str->len == 0)\n        return \"\";\n\n    return buf->str->str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nconst char *\nvirBufferCurrentContent(virBufferPtr buf)\n{\n    if (!buf)\n        return NULL;\n\n    if (!buf->str ||\n        buf->str->len == 0)\n        return \"\";\n\n    return buf->str->str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Set '%s' to '%s'\"",
            "path",
            "virBufferCurrentContent(&map_value)"
          ],
          "line": 1412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "&map_value",
            "\"%u %u %u\\n\"",
            "map[i].start",
            "map[i].target",
            "map[i].count"
          ],
          "line": 1409
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Too many id mappings defined.\")"
          ],
          "line": 1403
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int\nvirLXCControllerSetupUsernsMap(virDomainIdMapEntryPtr map,\n                               int num,\n                               char *path)\n{\n    virBuffer map_value = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    int ret = -1;\n\n    /* The kernel supports up to 340 lines in /proc/<pid>/{g,u}id_map */\n    if (num > 340) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Too many id mappings defined.\"));\n        goto cleanup;\n    }\n\n    for (i = 0; i < num; i++)\n        virBufferAsprintf(&map_value, \"%u %u %u\\n\",\n                          map[i].start, map[i].target, map[i].count);\n\n    VIR_DEBUG(\"Set '%s' to '%s'\", path, virBufferCurrentContent(&map_value));\n\n    if (virFileWriteStr(path, virBufferCurrentContent(&map_value), 0) < 0) {\n        virReportSystemError(errno, _(\"unable write to %s\"), path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virBufferFreeAndReset(&map_value);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerLookupUsernsMap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1377-1390",
    "snippet": "static unsigned int\nvirLXCControllerLookupUsernsMap(virDomainIdMapEntryPtr map,\n                                int num,\n                                unsigned int src)\n{\n    size_t i;\n\n    for (i = 0; i < num; i++) {\n        if (src > map[i].start && src < map[i].start + map[i].count)\n            return map[i].target + (src - map[i].start);\n    }\n\n    return src;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic unsigned int\nvirLXCControllerLookupUsernsMap(virDomainIdMapEntryPtr map,\n                                int num,\n                                unsigned int src)\n{\n    size_t i;\n\n    for (i = 0; i < num; i++) {\n        if (src > map[i].start && src < map[i].start + map[i].count)\n            return map[i].target + (src - map[i].start);\n    }\n\n    return src;\n}"
  },
  {
    "function_name": "virLXCControllerMain",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1314-1375",
    "snippet": "static int virLXCControllerMain(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    size_t i;\n\n    if (virNetDaemonAddSignalHandler(ctrl->daemon,\n                                     SIGCHLD,\n                                     virLXCControllerSignalChildIO,\n                                     ctrl) < 0)\n        goto cleanup;\n\n    virResetLastError();\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        if ((ctrl->consoles[i].epollFd = epoll_create1(EPOLL_CLOEXEC)) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to create epoll fd\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].epollWatch = virEventAddHandle(ctrl->consoles[i].epollFd,\n                                                              VIR_EVENT_HANDLE_READABLE,\n                                                              virLXCControllerConsoleEPoll,\n                                                              &(ctrl->consoles[i]),\n                                                              NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch epoll FD\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].hostWatch = virEventAddHandle(ctrl->consoles[i].hostFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].contWatch = virEventAddHandle(ctrl->consoles[i].contFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n    }\n\n    virNetDaemonRun(ctrl->daemon);\n\n    if (virGetLastErrorCode() == VIR_ERR_OK)\n        rc = wantReboot ? 1 : 0;\n\n cleanup:\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n\n    return rc;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static bool wantReboot;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerConsoleClose",
          "args": [
            "&(ctrl->consoles[i])"
          ],
          "line": 1372
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerConsoleClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "256-269",
          "snippet": "static void virLXCControllerConsoleClose(virLXCControllerConsolePtr console)\n{\n    if (console->hostWatch != -1)\n        virEventRemoveHandle(console->hostWatch);\n    VIR_FORCE_CLOSE(console->hostFd);\n\n    if (console->contWatch != -1)\n        virEventRemoveHandle(console->contWatch);\n    VIR_FORCE_CLOSE(console->contFd);\n\n    if (console->epollWatch != -1)\n        virEventRemoveHandle(console->epollWatch);\n    VIR_FORCE_CLOSE(console->epollFd);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerConsoleClose(virLXCControllerConsolePtr console)\n{\n    if (console->hostWatch != -1)\n        virEventRemoveHandle(console->hostWatch);\n    VIR_FORCE_CLOSE(console->hostFd);\n\n    if (console->contWatch != -1)\n        virEventRemoveHandle(console->contWatch);\n    VIR_FORCE_CLOSE(console->contFd);\n\n    if (console->epollWatch != -1)\n        virEventRemoveHandle(console->epollWatch);\n    VIR_FORCE_CLOSE(console->epollFd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetLastErrorCode",
          "args": [],
          "line": 1367
        },
        "resolved": true,
        "details": {
          "function_name": "virGetLastErrorCode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "280-287",
          "snippet": "int\nvirGetLastErrorCode(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (!err)\n        return VIR_ERR_OK;\n    return err->code;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirGetLastErrorCode(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (!err)\n        return VIR_ERR_OK;\n    return err->code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonRun",
          "args": [
            "ctrl->daemon"
          ],
          "line": 1365
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "799-864",
          "snippet": "void\nvirNetDaemonRun(virNetDaemonPtr dmn)\n{\n    int timerid = -1;\n    bool timerActive = false;\n\n    virObjectLock(dmn);\n\n    if (dmn->srvObject) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Not all servers restored, cannot run server\"));\n        goto cleanup;\n    }\n\n    dmn->quit = false;\n\n    if (dmn->autoShutdownTimeout &&\n        (timerid = virEventAddTimeout(-1,\n                                      virNetDaemonAutoShutdownTimer,\n                                      dmn, NULL)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to register shutdown timeout\"));\n        goto cleanup;\n    }\n\n    /* We are accepting connections now. Notify systemd\n     * so it can start dependent services. */\n    virSystemdNotifyStartup();\n\n    VIR_DEBUG(\"dmn=%p quit=%d\", dmn, dmn->quit);\n    while (!dmn->quit) {\n        /* A shutdown timeout is specified, so check\n         * if any drivers have active state, if not\n         * shutdown after timeout seconds\n         */\n        if (dmn->autoShutdownTimeout) {\n            if (timerActive) {\n                if (virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Deactivating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid, -1);\n                    timerActive = false;\n                }\n            } else {\n                if (!virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Activating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid,\n                                          dmn->autoShutdownTimeout * 1000);\n                    timerActive = true;\n                }\n            }\n        }\n\n        virObjectUnlock(dmn);\n        if (virEventRunDefaultImpl() < 0) {\n            virObjectLock(dmn);\n            VIR_DEBUG(\"Loop iteration error, exiting\");\n            break;\n        }\n        virObjectLock(dmn);\n\n        virHashForEach(dmn->servers, daemonServerProcessClients, NULL);\n    }\n\n cleanup:\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonRun(virNetDaemonPtr dmn)\n{\n    int timerid = -1;\n    bool timerActive = false;\n\n    virObjectLock(dmn);\n\n    if (dmn->srvObject) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Not all servers restored, cannot run server\"));\n        goto cleanup;\n    }\n\n    dmn->quit = false;\n\n    if (dmn->autoShutdownTimeout &&\n        (timerid = virEventAddTimeout(-1,\n                                      virNetDaemonAutoShutdownTimer,\n                                      dmn, NULL)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to register shutdown timeout\"));\n        goto cleanup;\n    }\n\n    /* We are accepting connections now. Notify systemd\n     * so it can start dependent services. */\n    virSystemdNotifyStartup();\n\n    VIR_DEBUG(\"dmn=%p quit=%d\", dmn, dmn->quit);\n    while (!dmn->quit) {\n        /* A shutdown timeout is specified, so check\n         * if any drivers have active state, if not\n         * shutdown after timeout seconds\n         */\n        if (dmn->autoShutdownTimeout) {\n            if (timerActive) {\n                if (virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Deactivating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid, -1);\n                    timerActive = false;\n                }\n            } else {\n                if (!virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Activating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid,\n                                          dmn->autoShutdownTimeout * 1000);\n                    timerActive = true;\n                }\n            }\n        }\n\n        virObjectUnlock(dmn);\n        if (virEventRunDefaultImpl() < 0) {\n            virObjectLock(dmn);\n            VIR_DEBUG(\"Loop iteration error, exiting\");\n            break;\n        }\n        virObjectLock(dmn);\n\n        virHashForEach(dmn->servers, daemonServerProcessClients, NULL);\n    }\n\n cleanup:\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to watch host console PTY\")"
          ],
          "line": 1359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to watch host console PTY\""
          ],
          "line": 1360
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virEventAddHandle",
          "args": [
            "ctrl->consoles[i].contFd",
            "VIR_EVENT_HANDLE_READABLE",
            "virLXCControllerConsoleIO",
            "&(ctrl->consoles[i])",
            "NULL"
          ],
          "line": 1354
        },
        "resolved": true,
        "details": {
          "function_name": "virEventAddHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "73-84",
          "snippet": "int\nvirEventAddHandle(int fd,\n                  int events,\n                  virEventHandleCallback cb,\n                  void *opaque,\n                  virFreeCallback ff)\n{\n    if (!addHandleImpl)\n        return -1;\n\n    return addHandleImpl(fd, events, cb, opaque, ff);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventAddHandleFunc addHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventAddHandleFunc addHandleImpl;\n\nint\nvirEventAddHandle(int fd,\n                  int events,\n                  virEventHandleCallback cb,\n                  void *opaque,\n                  virFreeCallback ff)\n{\n    if (!addHandleImpl)\n        return -1;\n\n    return addHandleImpl(fd, events, cb, opaque, ff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to watch host console PTY\")"
          ],
          "line": 1349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to watch epoll FD\")"
          ],
          "line": 1339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to create epoll fd\")"
          ],
          "line": 1329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_create1",
          "args": [
            "EPOLL_CLOEXEC"
          ],
          "line": 1328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1325
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonAddSignalHandler",
          "args": [
            "ctrl->daemon",
            "SIGCHLD",
            "virLXCControllerSignalChildIO",
            "ctrl"
          ],
          "line": 1319
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonAddSignalHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "737-746",
          "snippet": "int\nvirNetDaemonAddSignalHandler(virNetDaemonPtr dmn G_GNUC_UNUSED,\n                             int signum G_GNUC_UNUSED,\n                             virNetDaemonSignalFunc func G_GNUC_UNUSED,\n                             void *opaque G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Signal handling not available on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNetDaemonAddSignalHandler(virNetDaemonPtr dmn G_GNUC_UNUSED,\n                             int signum G_GNUC_UNUSED,\n                             virNetDaemonSignalFunc func G_GNUC_UNUSED,\n                             void *opaque G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Signal handling not available on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic bool wantReboot;\n\nstatic int virLXCControllerMain(virLXCControllerPtr ctrl)\n{\n    int rc = -1;\n    size_t i;\n\n    if (virNetDaemonAddSignalHandler(ctrl->daemon,\n                                     SIGCHLD,\n                                     virLXCControllerSignalChildIO,\n                                     ctrl) < 0)\n        goto cleanup;\n\n    virResetLastError();\n\n    for (i = 0; i < ctrl->nconsoles; i++) {\n        if ((ctrl->consoles[i].epollFd = epoll_create1(EPOLL_CLOEXEC)) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to create epoll fd\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].epollWatch = virEventAddHandle(ctrl->consoles[i].epollFd,\n                                                              VIR_EVENT_HANDLE_READABLE,\n                                                              virLXCControllerConsoleEPoll,\n                                                              &(ctrl->consoles[i]),\n                                                              NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch epoll FD\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].hostWatch = virEventAddHandle(ctrl->consoles[i].hostFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n\n        if ((ctrl->consoles[i].contWatch = virEventAddHandle(ctrl->consoles[i].contFd,\n                                                             VIR_EVENT_HANDLE_READABLE,\n                                                             virLXCControllerConsoleIO,\n                                                             &(ctrl->consoles[i]),\n                                                             NULL)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Unable to watch host console PTY\"));\n            goto cleanup;\n        }\n    }\n\n    virNetDaemonRun(ctrl->daemon);\n\n    if (virGetLastErrorCode() == VIR_ERR_OK)\n        rc = wantReboot ? 1 : 0;\n\n cleanup:\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n\n    return rc;\n}"
  },
  {
    "function_name": "virLXCControllerConsoleIO",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1215-1302",
    "snippet": "static void virLXCControllerConsoleIO(int watch, int fd, int events, void *opaque)\n{\n    virLXCControllerConsolePtr console = opaque;\n\n    virMutexLock(&lock);\n    VIR_DEBUG(\"IO event watch=%d fd=%d events=%d fromHost=%zu fromcont=%zu\",\n              watch, fd, events,\n              console->fromHostLen,\n              console->fromContLen);\n    if (events & VIR_EVENT_HANDLE_READABLE) {\n        char *buf;\n        size_t *len;\n        size_t avail;\n        ssize_t done;\n        if (watch == console->hostWatch) {\n            buf = console->fromHostBuf;\n            len = &console->fromHostLen;\n            avail = sizeof(console->fromHostBuf) - *len;\n        } else {\n            buf = console->fromContBuf;\n            len = &console->fromContLen;\n            avail = sizeof(console->fromContBuf) - *len;\n        }\n     reread:\n        done = read(fd, buf + *len, avail);\n        if (done == -1 && errno == EINTR)\n            goto reread;\n        if (done == -1 && errno != EAGAIN) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to read container pty\"));\n            goto error;\n        }\n        if (done > 0) {\n            *len += done;\n        } else {\n            VIR_DEBUG(\"Read fd %d done %d errno %d\", fd, (int)done, errno);\n        }\n    }\n\n    if (events & VIR_EVENT_HANDLE_WRITABLE) {\n        char *buf;\n        size_t *len;\n        ssize_t done;\n        if (watch == console->hostWatch) {\n            buf = console->fromContBuf;\n            len = &console->fromContLen;\n        } else {\n            buf = console->fromHostBuf;\n            len = &console->fromHostLen;\n        }\n\n     rewrite:\n        done = write(fd, buf, *len);\n        if (done == -1 && errno == EINTR)\n            goto rewrite;\n        if (done == -1 && errno != EAGAIN) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to write to container pty\"));\n            goto error;\n        }\n        if (done > 0) {\n            memmove(buf, buf + done, (*len - done));\n            *len -= done;\n        } else {\n            VIR_DEBUG(\"Write fd %d done %d errno %d\", fd, (int)done, errno);\n        }\n    }\n\n    if (events & VIR_EVENT_HANDLE_HANGUP) {\n        if (watch == console->hostWatch) {\n            console->hostClosed = true;\n        } else {\n            console->contClosed = true;\n        }\n        VIR_DEBUG(\"Got EOF on %d %d\", watch, fd);\n    }\n\n    virLXCControllerConsoleUpdateWatch(console);\n    virMutexUnlock(&lock);\n    return;\n\n error:\n    virEventRemoveHandle(console->contWatch);\n    virEventRemoveHandle(console->hostWatch);\n    console->contWatch = console->hostWatch = -1;\n    virNetDaemonQuit(console->daemon);\n    virMutexUnlock(&lock);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex lock = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lock"
          ],
          "line": 1301
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "console->daemon"
          ],
          "line": 1300
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virEventRemoveHandle",
          "args": [
            "console->hostWatch"
          ],
          "line": 1298
        },
        "resolved": true,
        "details": {
          "function_name": "virEventRemoveHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "116-123",
          "snippet": "int\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventRemoveHandleFunc removeHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventRemoveHandleFunc removeHandleImpl;\n\nint\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerConsoleUpdateWatch",
          "args": [
            "console"
          ],
          "line": 1292
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerConsoleUpdateWatch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1063-1165",
          "snippet": "static void virLXCControllerConsoleUpdateWatch(virLXCControllerConsolePtr console)\n{\n    int hostEvents = 0;\n    int contEvents = 0;\n\n    /* If host console is open, then we can look to read/write */\n    if (!console->hostClosed) {\n        if (console->fromHostLen < sizeof(console->fromHostBuf))\n            hostEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromContLen)\n            hostEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    /* If cont console is open, then we can look to read/write */\n    if (!console->contClosed) {\n        if (console->fromContLen < sizeof(console->fromContBuf))\n            contEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromHostLen)\n            contEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    VIR_DEBUG(\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\",\n              console->contWatch, contEvents, console->contClosed,\n              console->hostWatch, hostEvents, console->hostClosed);\n    virEventUpdateHandle(console->contWatch, contEvents);\n    virEventUpdateHandle(console->hostWatch, hostEvents);\n\n    if (console->hostClosed) {\n        /* Must setup an epoll to detect when host becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromContLen)\n            events |= EPOLLOUT;\n\n        if (events != console->hostEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->hostEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n\n            event.events = events;\n            event.data.fd = console->hostFd;\n            if (epoll_ctl(console->epollFd, action, console->hostFd, &event) < 0) {\n                VIR_DEBUG(\":fail\");\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->hostEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n        }\n    } else if (console->hostEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->hostEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->hostFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->hostEpoll = 0;\n    }\n\n    if (console->contClosed) {\n        /* Must setup an epoll to detect when guest becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromHostLen)\n            events |= EPOLLOUT;\n\n        if (events != console->contEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->contEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newContEvents=%x oldContEvents=%x\", events, console->contEpoll);\n\n            event.events = events;\n            event.data.fd = console->contFd;\n            if (epoll_ctl(console->epollFd, action, console->contFd, &event) < 0) {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                VIR_DEBUG(\":fail\");\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->contEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->contEpoll);\n        }\n    } else if (console->contEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->contEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->contFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->contEpoll = 0;\n    }\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerConsoleUpdateWatch(virLXCControllerConsolePtr console)\n{\n    int hostEvents = 0;\n    int contEvents = 0;\n\n    /* If host console is open, then we can look to read/write */\n    if (!console->hostClosed) {\n        if (console->fromHostLen < sizeof(console->fromHostBuf))\n            hostEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromContLen)\n            hostEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    /* If cont console is open, then we can look to read/write */\n    if (!console->contClosed) {\n        if (console->fromContLen < sizeof(console->fromContBuf))\n            contEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromHostLen)\n            contEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    VIR_DEBUG(\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\",\n              console->contWatch, contEvents, console->contClosed,\n              console->hostWatch, hostEvents, console->hostClosed);\n    virEventUpdateHandle(console->contWatch, contEvents);\n    virEventUpdateHandle(console->hostWatch, hostEvents);\n\n    if (console->hostClosed) {\n        /* Must setup an epoll to detect when host becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromContLen)\n            events |= EPOLLOUT;\n\n        if (events != console->hostEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->hostEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n\n            event.events = events;\n            event.data.fd = console->hostFd;\n            if (epoll_ctl(console->epollFd, action, console->hostFd, &event) < 0) {\n                VIR_DEBUG(\":fail\");\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->hostEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n        }\n    } else if (console->hostEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->hostEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->hostFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->hostEpoll = 0;\n    }\n\n    if (console->contClosed) {\n        /* Must setup an epoll to detect when guest becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromHostLen)\n            events |= EPOLLOUT;\n\n        if (events != console->contEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->contEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newContEvents=%x oldContEvents=%x\", events, console->contEpoll);\n\n            event.events = events;\n            event.data.fd = console->contFd;\n            if (epoll_ctl(console->epollFd, action, console->contFd, &event) < 0) {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                VIR_DEBUG(\":fail\");\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->contEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->contEpoll);\n        }\n    } else if (console->contEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->contEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->contFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->contEpoll = 0;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got EOF on %d %d\"",
            "watch",
            "fd"
          ],
          "line": 1289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Write fd %d done %d errno %d\"",
            "fd",
            "(int)done",
            "errno"
          ],
          "line": 1279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memmove",
          "args": [
            "buf",
            "buf + done",
            "(*len - done)"
          ],
          "line": 1276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to write to container pty\")"
          ],
          "line": 1271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to write to container pty\""
          ],
          "line": 1272
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "fd",
            "buf",
            "*len"
          ],
          "line": 1267
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Read fd %d done %d errno %d\"",
            "fd",
            "(int)done",
            "errno"
          ],
          "line": 1250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to read container pty\")"
          ],
          "line": 1243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "buf + *len",
            "avail"
          ],
          "line": 1239
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDelIOThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "7811-7841",
          "snippet": "int\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"IO event watch=%d fd=%d events=%d fromHost=%zu fromcont=%zu\"",
            "watch",
            "fd",
            "events",
            "console->fromHostLen",
            "console->fromContLen"
          ],
          "line": 1220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lock"
          ],
          "line": 1219
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic void virLXCControllerConsoleIO(int watch, int fd, int events, void *opaque)\n{\n    virLXCControllerConsolePtr console = opaque;\n\n    virMutexLock(&lock);\n    VIR_DEBUG(\"IO event watch=%d fd=%d events=%d fromHost=%zu fromcont=%zu\",\n              watch, fd, events,\n              console->fromHostLen,\n              console->fromContLen);\n    if (events & VIR_EVENT_HANDLE_READABLE) {\n        char *buf;\n        size_t *len;\n        size_t avail;\n        ssize_t done;\n        if (watch == console->hostWatch) {\n            buf = console->fromHostBuf;\n            len = &console->fromHostLen;\n            avail = sizeof(console->fromHostBuf) - *len;\n        } else {\n            buf = console->fromContBuf;\n            len = &console->fromContLen;\n            avail = sizeof(console->fromContBuf) - *len;\n        }\n     reread:\n        done = read(fd, buf + *len, avail);\n        if (done == -1 && errno == EINTR)\n            goto reread;\n        if (done == -1 && errno != EAGAIN) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to read container pty\"));\n            goto error;\n        }\n        if (done > 0) {\n            *len += done;\n        } else {\n            VIR_DEBUG(\"Read fd %d done %d errno %d\", fd, (int)done, errno);\n        }\n    }\n\n    if (events & VIR_EVENT_HANDLE_WRITABLE) {\n        char *buf;\n        size_t *len;\n        ssize_t done;\n        if (watch == console->hostWatch) {\n            buf = console->fromContBuf;\n            len = &console->fromContLen;\n        } else {\n            buf = console->fromHostBuf;\n            len = &console->fromHostLen;\n        }\n\n     rewrite:\n        done = write(fd, buf, *len);\n        if (done == -1 && errno == EINTR)\n            goto rewrite;\n        if (done == -1 && errno != EAGAIN) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to write to container pty\"));\n            goto error;\n        }\n        if (done > 0) {\n            memmove(buf, buf + done, (*len - done));\n            *len -= done;\n        } else {\n            VIR_DEBUG(\"Write fd %d done %d errno %d\", fd, (int)done, errno);\n        }\n    }\n\n    if (events & VIR_EVENT_HANDLE_HANGUP) {\n        if (watch == console->hostWatch) {\n            console->hostClosed = true;\n        } else {\n            console->contClosed = true;\n        }\n        VIR_DEBUG(\"Got EOF on %d %d\", watch, fd);\n    }\n\n    virLXCControllerConsoleUpdateWatch(console);\n    virMutexUnlock(&lock);\n    return;\n\n error:\n    virEventRemoveHandle(console->contWatch);\n    virEventRemoveHandle(console->hostWatch);\n    console->contWatch = console->hostWatch = -1;\n    virNetDaemonQuit(console->daemon);\n    virMutexUnlock(&lock);\n}"
  },
  {
    "function_name": "virLXCControllerConsoleEPoll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1168-1213",
    "snippet": "static void virLXCControllerConsoleEPoll(int watch, int fd, int events, void *opaque)\n{\n    virLXCControllerConsolePtr console = opaque;\n\n    virMutexLock(&lock);\n    VIR_DEBUG(\"IO event watch=%d fd=%d events=%d fromHost=%zu fromcont=%zu\",\n              watch, fd, events,\n              console->fromHostLen,\n              console->fromContLen);\n\n    while (1) {\n        struct epoll_event event;\n        int ret;\n        ret = epoll_wait(console->epollFd, &event, 1, 0);\n        if (ret < 0) {\n            if (errno == EINTR)\n                continue;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to wait on epoll\"));\n            virNetDaemonQuit(console->daemon);\n            goto cleanup;\n        }\n\n        if (ret == 0)\n            break;\n\n        VIR_DEBUG(\"fd=%d hostFd=%d contFd=%d hostEpoll=%x contEpoll=%x\",\n                  event.data.fd, console->hostFd, console->contFd,\n                  console->hostEpoll, console->contEpoll);\n\n        /* If we get HUP+dead PID, we just re-enable the main loop\n         * which will see the PID has died and exit */\n        if ((event.events & (EPOLLIN|EPOLLOUT))) {\n            if (event.data.fd == console->hostFd) {\n                console->hostClosed = false;\n            } else {\n                console->contClosed = false;\n            }\n            virLXCControllerConsoleUpdateWatch(console);\n            break;\n        }\n    }\n\n cleanup:\n    virMutexUnlock(&lock);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex lock = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lock"
          ],
          "line": 1212
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerConsoleUpdateWatch",
          "args": [
            "console"
          ],
          "line": 1206
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerConsoleUpdateWatch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "1063-1165",
          "snippet": "static void virLXCControllerConsoleUpdateWatch(virLXCControllerConsolePtr console)\n{\n    int hostEvents = 0;\n    int contEvents = 0;\n\n    /* If host console is open, then we can look to read/write */\n    if (!console->hostClosed) {\n        if (console->fromHostLen < sizeof(console->fromHostBuf))\n            hostEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromContLen)\n            hostEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    /* If cont console is open, then we can look to read/write */\n    if (!console->contClosed) {\n        if (console->fromContLen < sizeof(console->fromContBuf))\n            contEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromHostLen)\n            contEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    VIR_DEBUG(\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\",\n              console->contWatch, contEvents, console->contClosed,\n              console->hostWatch, hostEvents, console->hostClosed);\n    virEventUpdateHandle(console->contWatch, contEvents);\n    virEventUpdateHandle(console->hostWatch, hostEvents);\n\n    if (console->hostClosed) {\n        /* Must setup an epoll to detect when host becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromContLen)\n            events |= EPOLLOUT;\n\n        if (events != console->hostEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->hostEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n\n            event.events = events;\n            event.data.fd = console->hostFd;\n            if (epoll_ctl(console->epollFd, action, console->hostFd, &event) < 0) {\n                VIR_DEBUG(\":fail\");\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->hostEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n        }\n    } else if (console->hostEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->hostEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->hostFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->hostEpoll = 0;\n    }\n\n    if (console->contClosed) {\n        /* Must setup an epoll to detect when guest becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromHostLen)\n            events |= EPOLLOUT;\n\n        if (events != console->contEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->contEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newContEvents=%x oldContEvents=%x\", events, console->contEpoll);\n\n            event.events = events;\n            event.data.fd = console->contFd;\n            if (epoll_ctl(console->epollFd, action, console->contFd, &event) < 0) {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                VIR_DEBUG(\":fail\");\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->contEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->contEpoll);\n        }\n    } else if (console->contEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->contEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->contFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->contEpoll = 0;\n    }\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerConsoleUpdateWatch(virLXCControllerConsolePtr console)\n{\n    int hostEvents = 0;\n    int contEvents = 0;\n\n    /* If host console is open, then we can look to read/write */\n    if (!console->hostClosed) {\n        if (console->fromHostLen < sizeof(console->fromHostBuf))\n            hostEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromContLen)\n            hostEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    /* If cont console is open, then we can look to read/write */\n    if (!console->contClosed) {\n        if (console->fromContLen < sizeof(console->fromContBuf))\n            contEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromHostLen)\n            contEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    VIR_DEBUG(\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\",\n              console->contWatch, contEvents, console->contClosed,\n              console->hostWatch, hostEvents, console->hostClosed);\n    virEventUpdateHandle(console->contWatch, contEvents);\n    virEventUpdateHandle(console->hostWatch, hostEvents);\n\n    if (console->hostClosed) {\n        /* Must setup an epoll to detect when host becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromContLen)\n            events |= EPOLLOUT;\n\n        if (events != console->hostEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->hostEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n\n            event.events = events;\n            event.data.fd = console->hostFd;\n            if (epoll_ctl(console->epollFd, action, console->hostFd, &event) < 0) {\n                VIR_DEBUG(\":fail\");\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->hostEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n        }\n    } else if (console->hostEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->hostEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->hostFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->hostEpoll = 0;\n    }\n\n    if (console->contClosed) {\n        /* Must setup an epoll to detect when guest becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromHostLen)\n            events |= EPOLLOUT;\n\n        if (events != console->contEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->contEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newContEvents=%x oldContEvents=%x\", events, console->contEpoll);\n\n            event.events = events;\n            event.data.fd = console->contFd;\n            if (epoll_ctl(console->epollFd, action, console->contFd, &event) < 0) {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                VIR_DEBUG(\":fail\");\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->contEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->contEpoll);\n        }\n    } else if (console->contEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->contEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->contFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->contEpoll = 0;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"fd=%d hostFd=%d contFd=%d hostEpoll=%x contEpoll=%x\"",
            "event.data.fd",
            "console->hostFd",
            "console->contFd",
            "console->hostEpoll",
            "console->contEpoll"
          ],
          "line": 1194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "console->daemon"
          ],
          "line": 1187
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to wait on epoll\")"
          ],
          "line": 1185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to wait on epoll\""
          ],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "epoll_wait",
          "args": [
            "console->epollFd",
            "&event",
            "1",
            "0"
          ],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"IO event watch=%d fd=%d events=%d fromHost=%zu fromcont=%zu\"",
            "watch",
            "fd",
            "events",
            "console->fromHostLen",
            "console->fromContLen"
          ],
          "line": 1173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lock"
          ],
          "line": 1172
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic void virLXCControllerConsoleEPoll(int watch, int fd, int events, void *opaque)\n{\n    virLXCControllerConsolePtr console = opaque;\n\n    virMutexLock(&lock);\n    VIR_DEBUG(\"IO event watch=%d fd=%d events=%d fromHost=%zu fromcont=%zu\",\n              watch, fd, events,\n              console->fromHostLen,\n              console->fromContLen);\n\n    while (1) {\n        struct epoll_event event;\n        int ret;\n        ret = epoll_wait(console->epollFd, &event, 1, 0);\n        if (ret < 0) {\n            if (errno == EINTR)\n                continue;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to wait on epoll\"));\n            virNetDaemonQuit(console->daemon);\n            goto cleanup;\n        }\n\n        if (ret == 0)\n            break;\n\n        VIR_DEBUG(\"fd=%d hostFd=%d contFd=%d hostEpoll=%x contEpoll=%x\",\n                  event.data.fd, console->hostFd, console->contFd,\n                  console->hostEpoll, console->contEpoll);\n\n        /* If we get HUP+dead PID, we just re-enable the main loop\n         * which will see the PID has died and exit */\n        if ((event.events & (EPOLLIN|EPOLLOUT))) {\n            if (event.data.fd == console->hostFd) {\n                console->hostClosed = false;\n            } else {\n                console->contClosed = false;\n            }\n            virLXCControllerConsoleUpdateWatch(console);\n            break;\n        }\n    }\n\n cleanup:\n    virMutexUnlock(&lock);\n}"
  },
  {
    "function_name": "virLXCControllerConsoleUpdateWatch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1063-1165",
    "snippet": "static void virLXCControllerConsoleUpdateWatch(virLXCControllerConsolePtr console)\n{\n    int hostEvents = 0;\n    int contEvents = 0;\n\n    /* If host console is open, then we can look to read/write */\n    if (!console->hostClosed) {\n        if (console->fromHostLen < sizeof(console->fromHostBuf))\n            hostEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromContLen)\n            hostEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    /* If cont console is open, then we can look to read/write */\n    if (!console->contClosed) {\n        if (console->fromContLen < sizeof(console->fromContBuf))\n            contEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromHostLen)\n            contEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    VIR_DEBUG(\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\",\n              console->contWatch, contEvents, console->contClosed,\n              console->hostWatch, hostEvents, console->hostClosed);\n    virEventUpdateHandle(console->contWatch, contEvents);\n    virEventUpdateHandle(console->hostWatch, hostEvents);\n\n    if (console->hostClosed) {\n        /* Must setup an epoll to detect when host becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromContLen)\n            events |= EPOLLOUT;\n\n        if (events != console->hostEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->hostEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n\n            event.events = events;\n            event.data.fd = console->hostFd;\n            if (epoll_ctl(console->epollFd, action, console->hostFd, &event) < 0) {\n                VIR_DEBUG(\":fail\");\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->hostEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n        }\n    } else if (console->hostEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->hostEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->hostFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->hostEpoll = 0;\n    }\n\n    if (console->contClosed) {\n        /* Must setup an epoll to detect when guest becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromHostLen)\n            events |= EPOLLOUT;\n\n        if (events != console->contEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->contEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newContEvents=%x oldContEvents=%x\", events, console->contEpoll);\n\n            event.events = events;\n            event.data.fd = console->contFd;\n            if (epoll_ctl(console->epollFd, action, console->contFd, &event) < 0) {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                VIR_DEBUG(\":fail\");\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->contEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->contEpoll);\n        }\n    } else if (console->contEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->contEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->contFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->contEpoll = 0;\n    }\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "console->daemon"
          ],
          "line": 1160
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\":fail\""
          ],
          "line": 1159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to remove epoll fd\")"
          ],
          "line": 1157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to remove epoll fd\""
          ],
          "line": 1158
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "console->epollFd",
            "EPOLL_CTL_DEL",
            "console->contFd",
            "NULL"
          ],
          "line": 1156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Stop epoll oldContEvents=%x\"",
            "console->contEpoll"
          ],
          "line": 1155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"newHostEvents=%x oldHostEvents=%x\"",
            "events",
            "console->contEpoll"
          ],
          "line": 1152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\":fail\""
          ],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to add epoll fd\")"
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "console->epollFd",
            "action",
            "console->contFd",
            "&event"
          ],
          "line": 1144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"newContEvents=%x oldContEvents=%x\"",
            "events",
            "console->contEpoll"
          ],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\":fail\""
          ],
          "line": 1121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to remove epoll fd\")"
          ],
          "line": 1119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "console->epollFd",
            "EPOLL_CTL_DEL",
            "console->hostFd",
            "NULL"
          ],
          "line": 1118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Stop epoll oldContEvents=%x\"",
            "console->hostEpoll"
          ],
          "line": 1117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"newHostEvents=%x oldHostEvents=%x\"",
            "events",
            "console->hostEpoll"
          ],
          "line": 1114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to add epoll fd\")"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\":fail\""
          ],
          "line": 1107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "epoll_ctl",
          "args": [
            "console->epollFd",
            "action",
            "console->hostFd",
            "&event"
          ],
          "line": 1106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"newHostEvents=%x oldHostEvents=%x\"",
            "events",
            "console->hostEpoll"
          ],
          "line": 1102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virEventUpdateHandle",
          "args": [
            "console->hostWatch",
            "hostEvents"
          ],
          "line": 1088
        },
        "resolved": true,
        "details": {
          "function_name": "virEventUpdateHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "98-103",
          "snippet": "void\nvirEventUpdateHandle(int watch, int events)\n{\n    if (updateHandleImpl)\n        updateHandleImpl(watch, events);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventUpdateHandleFunc updateHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventUpdateHandleFunc updateHandleImpl;\n\nvoid\nvirEventUpdateHandle(int watch, int events)\n{\n    if (updateHandleImpl)\n        updateHandleImpl(watch, events);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\"",
            "console->contWatch",
            "contEvents",
            "console->contClosed",
            "console->hostWatch",
            "hostEvents",
            "console->hostClosed"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerConsoleUpdateWatch(virLXCControllerConsolePtr console)\n{\n    int hostEvents = 0;\n    int contEvents = 0;\n\n    /* If host console is open, then we can look to read/write */\n    if (!console->hostClosed) {\n        if (console->fromHostLen < sizeof(console->fromHostBuf))\n            hostEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromContLen)\n            hostEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    /* If cont console is open, then we can look to read/write */\n    if (!console->contClosed) {\n        if (console->fromContLen < sizeof(console->fromContBuf))\n            contEvents |= VIR_EVENT_HANDLE_READABLE;\n        if (console->fromHostLen)\n            contEvents |= VIR_EVENT_HANDLE_WRITABLE;\n    }\n\n    VIR_DEBUG(\"Container watch=%d, events=%d closed=%d; host watch=%d events=%d closed=%d\",\n              console->contWatch, contEvents, console->contClosed,\n              console->hostWatch, hostEvents, console->hostClosed);\n    virEventUpdateHandle(console->contWatch, contEvents);\n    virEventUpdateHandle(console->hostWatch, hostEvents);\n\n    if (console->hostClosed) {\n        /* Must setup an epoll to detect when host becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromContLen)\n            events |= EPOLLOUT;\n\n        if (events != console->hostEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->hostEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n\n            event.events = events;\n            event.data.fd = console->hostFd;\n            if (epoll_ctl(console->epollFd, action, console->hostFd, &event) < 0) {\n                VIR_DEBUG(\":fail\");\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->hostEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->hostEpoll);\n        }\n    } else if (console->hostEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->hostEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->hostFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->hostEpoll = 0;\n    }\n\n    if (console->contClosed) {\n        /* Must setup an epoll to detect when guest becomes accessible again */\n        int events = EPOLLIN | EPOLLET;\n        if (console->fromHostLen)\n            events |= EPOLLOUT;\n\n        if (events != console->contEpoll) {\n            struct epoll_event event;\n            int action = EPOLL_CTL_ADD;\n            if (console->contEpoll)\n                action = EPOLL_CTL_MOD;\n\n            VIR_DEBUG(\"newContEvents=%x oldContEvents=%x\", events, console->contEpoll);\n\n            event.events = events;\n            event.data.fd = console->contFd;\n            if (epoll_ctl(console->epollFd, action, console->contFd, &event) < 0) {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to add epoll fd\"));\n                VIR_DEBUG(\":fail\");\n                virNetDaemonQuit(console->daemon);\n                return;\n            }\n            console->contEpoll = events;\n            VIR_DEBUG(\"newHostEvents=%x oldHostEvents=%x\", events, console->contEpoll);\n        }\n    } else if (console->contEpoll) {\n        VIR_DEBUG(\"Stop epoll oldContEvents=%x\", console->contEpoll);\n        if (epoll_ctl(console->epollFd, EPOLL_CTL_DEL, console->contFd, NULL) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to remove epoll fd\"));\n            VIR_DEBUG(\":fail\");\n            virNetDaemonQuit(console->daemon);\n            return;\n        }\n        console->contEpoll = 0;\n    }\n}"
  },
  {
    "function_name": "virLXCControllerSignalChildIO",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1040-1060",
    "snippet": "static void virLXCControllerSignalChildIO(virNetDaemonPtr dmn,\n                                          siginfo_t *info G_GNUC_UNUSED,\n                                          void *opaque)\n{\n    virLXCControllerPtr ctrl = opaque;\n    int ret;\n    int status;\n\n    ret = waitpid(-1, &status, WNOHANG);\n    VIR_DEBUG(\"Got sig child %d vs %lld\", ret, (long long)ctrl->initpid);\n    if (ret == ctrl->initpid) {\n        virNetDaemonQuit(dmn);\n        virMutexLock(&lock);\n        if (WIFSIGNALED(status) &&\n            WTERMSIG(status) == SIGHUP) {\n            VIR_DEBUG(\"Status indicates reboot\");\n            wantReboot = true;\n        }\n        virMutexUnlock(&lock);\n    }\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);",
      "static bool wantReboot;",
      "static virMutex lock = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lock"
          ],
          "line": 1058
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Status indicates reboot\""
          ],
          "line": 1055
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WTERMSIG",
          "args": [
            "status"
          ],
          "line": 1054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WIFSIGNALED",
          "args": [
            "status"
          ],
          "line": 1053
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lock"
          ],
          "line": 1052
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "dmn"
          ],
          "line": 1051
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got sig child %d vs %lld\"",
            "ret",
            "(long long)ctrl->initpid"
          ],
          "line": 1049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "-1",
            "&status",
            "WNOHANG"
          ],
          "line": 1048
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\nstatic bool wantReboot;\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic void virLXCControllerSignalChildIO(virNetDaemonPtr dmn,\n                                          siginfo_t *info G_GNUC_UNUSED,\n                                          void *opaque)\n{\n    virLXCControllerPtr ctrl = opaque;\n    int ret;\n    int status;\n\n    ret = waitpid(-1, &status, WNOHANG);\n    VIR_DEBUG(\"Got sig child %d vs %lld\", ret, (long long)ctrl->initpid);\n    if (ret == ctrl->initpid) {\n        virNetDaemonQuit(dmn);\n        virMutexLock(&lock);\n        if (WIFSIGNALED(status) &&\n            WTERMSIG(status) == SIGHUP) {\n            VIR_DEBUG(\"Status indicates reboot\");\n            wantReboot = true;\n        }\n        virMutexUnlock(&lock);\n    }\n}"
  },
  {
    "function_name": "lxcControllerClearCapabilities",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "1018-1034",
    "snippet": "static int lxcControllerClearCapabilities(void)\n{\n#if WITH_CAPNG\n    int ret;\n\n    capng_clear(CAPNG_SELECT_BOTH);\n\n    if ((ret = capng_apply(CAPNG_SELECT_BOTH)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to apply capabilities: %d\"), ret);\n        return -1;\n    }\n#else\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n#endif\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"libcap-ng support not compiled in, unable to clear capabilities\""
          ],
          "line": 1031
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"failed to apply capabilities: %d\")",
            "ret"
          ],
          "line": 1026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to apply capabilities: %d\""
          ],
          "line": 1027
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "capng_apply",
          "args": [
            "CAPNG_SELECT_BOTH"
          ],
          "line": 1025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "capng_clear",
          "args": [
            "CAPNG_SELECT_BOTH"
          ],
          "line": 1023
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int lxcControllerClearCapabilities(void)\n{\n#if WITH_CAPNG\n    int ret;\n\n    capng_clear(CAPNG_SELECT_BOTH);\n\n    if ((ret = capng_apply(CAPNG_SELECT_BOTH)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to apply capabilities: %d\"), ret);\n        return -1;\n    }\n#else\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n#endif\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupServer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "956-1015",
    "snippet": "static int virLXCControllerSetupServer(virLXCControllerPtr ctrl)\n{\n    virNetServerPtr srv = NULL;\n    virNetServerServicePtr svc = NULL;\n    char *sockpath;\n\n    sockpath = g_strdup_printf(\"%s/%s.sock\", LXC_STATE_DIR, ctrl->name);\n\n    if (!(srv = virNetServerNew(\"LXC\", 1,\n                                0, 0, 0, 1,\n                                0, -1, 0,\n                                virLXCControllerClientPrivateNew,\n                                NULL,\n                                virLXCControllerClientPrivateFree,\n                                ctrl)))\n        goto error;\n\n    if (virSecurityManagerSetSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (!(svc = virNetServerServiceNewUNIX(sockpath,\n                                           0700,\n                                           0,\n                                           0,\n                                           NULL,\n                                           false,\n                                           0,\n                                           5)))\n        goto error;\n\n    if (virSecurityManagerClearSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (virNetServerAddService(srv, svc) < 0)\n        goto error;\n    virObjectUnref(svc);\n    svc = NULL;\n\n    if (!(ctrl->prog = virNetServerProgramNew(VIR_LXC_MONITOR_PROGRAM,\n                                              VIR_LXC_MONITOR_PROGRAM_VERSION,\n                                              virLXCMonitorProcs,\n                                              virLXCMonitorNProcs)))\n        goto error;\n\n    if (!(ctrl->daemon = virNetDaemonNew()) ||\n        virNetDaemonAddServer(ctrl->daemon, srv) < 0)\n        goto error;\n\n    virNetDaemonUpdateServices(ctrl->daemon, true);\n    VIR_FREE(sockpath);\n    return 0;\n\n error:\n    VIR_FREE(sockpath);\n    virObjectUnref(srv);\n    virObjectUnref(ctrl->daemon);\n    ctrl->daemon = NULL;\n    virObjectUnref(svc);\n    return -1;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "svc"
          ],
          "line": 1013
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sockpath"
          ],
          "line": 1009
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sockpath"
          ],
          "line": 1005
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDaemonUpdateServices",
          "args": [
            "ctrl->daemon",
            "true"
          ],
          "line": 1004
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonUpdateServices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "779-786",
          "snippet": "void\nvirNetDaemonUpdateServices(virNetDaemonPtr dmn,\n                           bool enabled)\n{\n    virObjectLock(dmn);\n    virHashForEach(dmn->servers, daemonServerUpdateServices, &enabled);\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonUpdateServices(virNetDaemonPtr dmn,\n                           bool enabled)\n{\n    virObjectLock(dmn);\n    virHashForEach(dmn->servers, daemonServerUpdateServices, &enabled);\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonAddServer",
          "args": [
            "ctrl->daemon",
            "srv"
          ],
          "line": 1001
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonAddServer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "161-179",
          "snippet": "int\nvirNetDaemonAddServer(virNetDaemonPtr dmn,\n                      virNetServerPtr srv)\n{\n    int ret = -1;\n    const char *serverName = virNetServerGetName(srv);\n\n    virObjectLock(dmn);\n\n    if (virHashAddEntry(dmn->servers, serverName, srv) < 0)\n        goto cleanup;\n\n    virObjectRef(srv);\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(dmn);\n    return ret;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNetDaemonAddServer(virNetDaemonPtr dmn,\n                      virNetServerPtr srv)\n{\n    int ret = -1;\n    const char *serverName = virNetServerGetName(srv);\n\n    virObjectLock(dmn);\n\n    if (virHashAddEntry(dmn->servers, serverName, srv) < 0)\n        goto cleanup;\n\n    virObjectRef(srv);\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(dmn);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonNew",
          "args": [],
          "line": 1000
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "120-158",
          "snippet": "virNetDaemonPtr\nvirNetDaemonNew(void)\n{\n    virNetDaemonPtr dmn;\n#ifndef WIN32\n    struct sigaction sig_action;\n#endif /* !WIN32 */\n\n    if (virNetDaemonInitialize() < 0)\n        return NULL;\n\n    if (!(dmn = virObjectLockableNew(virNetDaemonClass)))\n        return NULL;\n\n    if (!(dmn->servers = virHashCreate(5, virObjectFreeHashData)))\n        goto error;\n\n#ifndef WIN32\n    dmn->sigwrite = dmn->sigread = -1;\n#endif /* !WIN32 */\n\n    dmn->privileged = geteuid() == 0;\n    dmn->autoShutdownInhibitFd = -1;\n\n    if (virEventRegisterDefaultImpl() < 0)\n        goto error;\n\n#ifndef WIN32\n    memset(&sig_action, 0, sizeof(sig_action));\n    sig_action.sa_handler = SIG_IGN;\n    sigaction(SIGPIPE, &sig_action, NULL);\n#endif /* !WIN32 */\n\n    return dmn;\n\n error:\n    virObjectUnref(dmn);\n    return NULL;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNetDaemonClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virClassPtr virNetDaemonClass;\n\nvirNetDaemonPtr\nvirNetDaemonNew(void)\n{\n    virNetDaemonPtr dmn;\n#ifndef WIN32\n    struct sigaction sig_action;\n#endif /* !WIN32 */\n\n    if (virNetDaemonInitialize() < 0)\n        return NULL;\n\n    if (!(dmn = virObjectLockableNew(virNetDaemonClass)))\n        return NULL;\n\n    if (!(dmn->servers = virHashCreate(5, virObjectFreeHashData)))\n        goto error;\n\n#ifndef WIN32\n    dmn->sigwrite = dmn->sigread = -1;\n#endif /* !WIN32 */\n\n    dmn->privileged = geteuid() == 0;\n    dmn->autoShutdownInhibitFd = -1;\n\n    if (virEventRegisterDefaultImpl() < 0)\n        goto error;\n\n#ifndef WIN32\n    memset(&sig_action, 0, sizeof(sig_action));\n    sig_action.sa_handler = SIG_IGN;\n    sigaction(SIGPIPE, &sig_action, NULL);\n#endif /* !WIN32 */\n\n    return dmn;\n\n error:\n    virObjectUnref(dmn);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerProgramNew",
          "args": [
            "VIR_LXC_MONITOR_PROGRAM",
            "VIR_LXC_MONITOR_PROGRAM_VERSION",
            "virLXCMonitorProcs",
            "virLXCMonitorNProcs"
          ],
          "line": 994
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerProgramNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverprogram.c",
          "lines": "61-82",
          "snippet": "virNetServerProgramPtr virNetServerProgramNew(unsigned program,\n                                              unsigned version,\n                                              virNetServerProgramProcPtr procs,\n                                              size_t nprocs)\n{\n    virNetServerProgramPtr prog;\n\n    if (virNetServerProgramInitialize() < 0)\n        return NULL;\n\n    if (!(prog = virObjectNew(virNetServerProgramClass)))\n        return NULL;\n\n    prog->program = program;\n    prog->version = version;\n    prog->procs = procs;\n    prog->nprocs = nprocs;\n\n    VIR_DEBUG(\"prog=%p\", prog);\n\n    return prog;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserverprogram.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNetServerProgramClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserverprogram.h\"\n#include <config.h>\n\nstatic virClassPtr virNetServerProgramClass;\n\nvirNetServerProgramPtr virNetServerProgramNew(unsigned program,\n                                              unsigned version,\n                                              virNetServerProgramProcPtr procs,\n                                              size_t nprocs)\n{\n    virNetServerProgramPtr prog;\n\n    if (virNetServerProgramInitialize() < 0)\n        return NULL;\n\n    if (!(prog = virObjectNew(virNetServerProgramClass)))\n        return NULL;\n\n    prog->program = program;\n    prog->version = version;\n    prog->procs = procs;\n    prog->nprocs = nprocs;\n\n    VIR_DEBUG(\"prog=%p\", prog);\n\n    return prog;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerAddService",
          "args": [
            "srv",
            "svc"
          ],
          "line": 989
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerAddService",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserver.c",
          "lines": "653-673",
          "snippet": "int virNetServerAddService(virNetServerPtr srv,\n                           virNetServerServicePtr svc)\n{\n    virObjectLock(srv);\n\n    if (VIR_EXPAND_N(srv->services, srv->nservices, 1) < 0)\n        goto error;\n\n    srv->services[srv->nservices-1] = virObjectRef(svc);\n\n    virNetServerServiceSetDispatcher(svc,\n                                     virNetServerDispatchNewClient,\n                                     srv);\n\n    virObjectUnlock(srv);\n    return 0;\n\n error:\n    virObjectUnlock(srv);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserver.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);",
            "static inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetserver.h\"\n#include <config.h>\n\nstatic inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);\nstatic inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);\n\nint virNetServerAddService(virNetServerPtr srv,\n                           virNetServerServicePtr svc)\n{\n    virObjectLock(srv);\n\n    if (VIR_EXPAND_N(srv->services, srv->nservices, 1) < 0)\n        goto error;\n\n    srv->services[srv->nservices-1] = virObjectRef(svc);\n\n    virNetServerServiceSetDispatcher(svc,\n                                     virNetServerDispatchNewClient,\n                                     srv);\n\n    virObjectUnlock(srv);\n    return 0;\n\n error:\n    virObjectUnlock(srv);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerClearSocketLabel",
          "args": [
            "ctrl->securityManager",
            "ctrl->def"
          ],
          "line": 986
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerClearSocketLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "515-529",
          "snippet": "int\nvirSecurityManagerClearSocketLabel(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm)\n{\n    if (mgr->drv->domainClearSecuritySocketLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainClearSecuritySocketLabel(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerClearSocketLabel(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm)\n{\n    if (mgr->drv->domainClearSecuritySocketLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainClearSecuritySocketLabel(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerServiceNewUNIX",
          "args": [
            "sockpath",
            "0700",
            "0",
            "0",
            "NULL",
            "false",
            "0",
            "5"
          ],
          "line": 976
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerServiceNewUNIX",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverservice.c",
          "lines": "186-218",
          "snippet": "virNetServerServicePtr virNetServerServiceNewUNIX(const char *path,\n                                                  mode_t mask,\n                                                  gid_t grp,\n                                                  int auth,\n                                                  virNetTLSContextPtr tls,\n                                                  bool readonly,\n                                                  size_t max_queued_clients,\n                                                  size_t nrequests_client_max)\n{\n    virNetServerServicePtr svc;\n    virNetSocketPtr sock;\n\n    VIR_DEBUG(\"Creating new UNIX server path='%s' mask=%o gid=%u\",\n              path, mask, grp);\n    if (virNetSocketNewListenUNIX(path,\n                                  mask,\n                                  -1,\n                                  grp,\n                                  &sock) < 0)\n        return NULL;\n\n    svc = virNetServerServiceNewSocket(&sock,\n                                       1,\n                                       auth,\n                                       tls,\n                                       readonly,\n                                       max_queued_clients,\n                                       nrequests_client_max);\n\n    virObjectUnref(sock);\n\n    return svc;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <unistd.h>",
            "#include \"virnetserverservice.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <unistd.h>\n#include \"virnetserverservice.h\"\n#include <config.h>\n\nvirNetServerServicePtr virNetServerServiceNewUNIX(const char *path,\n                                                  mode_t mask,\n                                                  gid_t grp,\n                                                  int auth,\n                                                  virNetTLSContextPtr tls,\n                                                  bool readonly,\n                                                  size_t max_queued_clients,\n                                                  size_t nrequests_client_max)\n{\n    virNetServerServicePtr svc;\n    virNetSocketPtr sock;\n\n    VIR_DEBUG(\"Creating new UNIX server path='%s' mask=%o gid=%u\",\n              path, mask, grp);\n    if (virNetSocketNewListenUNIX(path,\n                                  mask,\n                                  -1,\n                                  grp,\n                                  &sock) < 0)\n        return NULL;\n\n    svc = virNetServerServiceNewSocket(&sock,\n                                       1,\n                                       auth,\n                                       tls,\n                                       readonly,\n                                       max_queued_clients,\n                                       nrequests_client_max);\n\n    virObjectUnref(sock);\n\n    return svc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetSocketLabel",
          "args": [
            "ctrl->securityManager",
            "ctrl->def"
          ],
          "line": 973
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetSocketLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "498-512",
          "snippet": "int\nvirSecurityManagerSetSocketLabel(virSecurityManagerPtr mgr,\n                                 virDomainDefPtr vm)\n{\n    if (mgr->drv->domainSetSecuritySocketLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecuritySocketLabel(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetSocketLabel(virSecurityManagerPtr mgr,\n                                 virDomainDefPtr vm)\n{\n    if (mgr->drv->domainSetSecuritySocketLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecuritySocketLabel(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerNew",
          "args": [
            "\"LXC\"",
            "1",
            "0",
            "0",
            "0",
            "1",
            "0",
            "-1",
            "0",
            "virLXCControllerClientPrivateNew",
            "NULL",
            "virLXCControllerClientPrivateFree",
            "ctrl"
          ],
          "line": 964
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserver.c",
          "lines": "349-394",
          "snippet": "virNetServerPtr virNetServerNew(const char *name,\n                                unsigned long long next_client_id,\n                                size_t min_workers,\n                                size_t max_workers,\n                                size_t priority_workers,\n                                size_t max_clients,\n                                size_t max_anonymous_clients,\n                                int keepaliveInterval,\n                                unsigned int keepaliveCount,\n                                virNetServerClientPrivNew clientPrivNew,\n                                virNetServerClientPrivPreExecRestart clientPrivPreExecRestart,\n                                virFreeCallback clientPrivFree,\n                                void *clientPrivOpaque)\n{\n    virNetServerPtr srv;\n\n    if (virNetServerInitialize() < 0)\n        return NULL;\n\n    if (!(srv = virObjectLockableNew(virNetServerClass)))\n        return NULL;\n\n    if (!(srv->workers = virThreadPoolNewFull(min_workers, max_workers,\n                                              priority_workers,\n                                              virNetServerHandleJob,\n                                              \"rpc-worker\",\n                                              srv)))\n        goto error;\n\n    srv->name = g_strdup(name);\n\n    srv->next_client_id = next_client_id;\n    srv->nclients_max = max_clients;\n    srv->nclients_unauth_max = max_anonymous_clients;\n    srv->keepaliveInterval = keepaliveInterval;\n    srv->keepaliveCount = keepaliveCount;\n    srv->clientPrivNew = clientPrivNew;\n    srv->clientPrivPreExecRestart = clientPrivPreExecRestart;\n    srv->clientPrivFree = clientPrivFree;\n    srv->clientPrivOpaque = clientPrivOpaque;\n\n    return srv;\n error:\n    virObjectUnref(srv);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserver.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNetServerClass;",
            "static inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);",
            "static inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetserver.h\"\n#include <config.h>\n\nstatic virClassPtr virNetServerClass;\nstatic inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);\nstatic inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);\n\nvirNetServerPtr virNetServerNew(const char *name,\n                                unsigned long long next_client_id,\n                                size_t min_workers,\n                                size_t max_workers,\n                                size_t priority_workers,\n                                size_t max_clients,\n                                size_t max_anonymous_clients,\n                                int keepaliveInterval,\n                                unsigned int keepaliveCount,\n                                virNetServerClientPrivNew clientPrivNew,\n                                virNetServerClientPrivPreExecRestart clientPrivPreExecRestart,\n                                virFreeCallback clientPrivFree,\n                                void *clientPrivOpaque)\n{\n    virNetServerPtr srv;\n\n    if (virNetServerInitialize() < 0)\n        return NULL;\n\n    if (!(srv = virObjectLockableNew(virNetServerClass)))\n        return NULL;\n\n    if (!(srv->workers = virThreadPoolNewFull(min_workers, max_workers,\n                                              priority_workers,\n                                              virNetServerHandleJob,\n                                              \"rpc-worker\",\n                                              srv)))\n        goto error;\n\n    srv->name = g_strdup(name);\n\n    srv->next_client_id = next_client_id;\n    srv->nclients_max = max_clients;\n    srv->nclients_unauth_max = max_anonymous_clients;\n    srv->keepaliveInterval = keepaliveInterval;\n    srv->keepaliveCount = keepaliveCount;\n    srv->clientPrivNew = clientPrivNew;\n    srv->clientPrivPreExecRestart = clientPrivPreExecRestart;\n    srv->clientPrivFree = clientPrivFree;\n    srv->clientPrivOpaque = clientPrivOpaque;\n\n    return srv;\n error:\n    virObjectUnref(srv);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s.sock\"",
            "LXC_STATE_DIR",
            "ctrl->name"
          ],
          "line": 962
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupServer(virLXCControllerPtr ctrl)\n{\n    virNetServerPtr srv = NULL;\n    virNetServerServicePtr svc = NULL;\n    char *sockpath;\n\n    sockpath = g_strdup_printf(\"%s/%s.sock\", LXC_STATE_DIR, ctrl->name);\n\n    if (!(srv = virNetServerNew(\"LXC\", 1,\n                                0, 0, 0, 1,\n                                0, -1, 0,\n                                virLXCControllerClientPrivateNew,\n                                NULL,\n                                virLXCControllerClientPrivateFree,\n                                ctrl)))\n        goto error;\n\n    if (virSecurityManagerSetSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (!(svc = virNetServerServiceNewUNIX(sockpath,\n                                           0700,\n                                           0,\n                                           0,\n                                           NULL,\n                                           false,\n                                           0,\n                                           5)))\n        goto error;\n\n    if (virSecurityManagerClearSocketLabel(ctrl->securityManager, ctrl->def) < 0)\n        goto error;\n\n    if (virNetServerAddService(srv, svc) < 0)\n        goto error;\n    virObjectUnref(svc);\n    svc = NULL;\n\n    if (!(ctrl->prog = virNetServerProgramNew(VIR_LXC_MONITOR_PROGRAM,\n                                              VIR_LXC_MONITOR_PROGRAM_VERSION,\n                                              virLXCMonitorProcs,\n                                              virLXCMonitorNProcs)))\n        goto error;\n\n    if (!(ctrl->daemon = virNetDaemonNew()) ||\n        virNetDaemonAddServer(ctrl->daemon, srv) < 0)\n        goto error;\n\n    virNetDaemonUpdateServices(ctrl->daemon, true);\n    VIR_FREE(sockpath);\n    return 0;\n\n error:\n    VIR_FREE(sockpath);\n    virObjectUnref(srv);\n    virObjectUnref(ctrl->daemon);\n    ctrl->daemon = NULL;\n    virObjectUnref(svc);\n    return -1;\n}"
  },
  {
    "function_name": "virLXCControllerClientPrivateNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "939-953",
    "snippet": "static void *virLXCControllerClientPrivateNew(virNetServerClientPtr client,\n                                              void *opaque)\n{\n    virLXCControllerPtr ctrl = opaque;\n\n    virNetServerClientSetCloseHook(client, virLXCControllerClientCloseHook);\n    VIR_DEBUG(\"Got new client %p\", client);\n    ctrl->client = client;\n\n    if (ctrl->initpid && ctrl->firstClient)\n        virLXCControllerEventSendInit(ctrl, ctrl->initpid);\n    ctrl->firstClient = false;\n\n    return ctrl;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerEventSendInit",
          "args": [
            "ctrl",
            "ctrl->initpid"
          ],
          "line": 949
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerEventSendInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "2338-2353",
          "snippet": "static int\nvirLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                              pid_t initpid)\n{\n    virLXCMonitorInitEventMsg msg;\n\n    VIR_DEBUG(\"Init pid %lld\", (long long)initpid);\n    memset(&msg, 0, sizeof(msg));\n    msg.initpid = initpid;\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_INIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorInitEventMsg,\n                              (void*)&msg);\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int\nvirLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                              pid_t initpid)\n{\n    virLXCMonitorInitEventMsg msg;\n\n    VIR_DEBUG(\"Init pid %lld\", (long long)initpid);\n    memset(&msg, 0, sizeof(msg));\n    msg.initpid = initpid;\n\n    virLXCControllerEventSend(ctrl,\n                              VIR_LXC_MONITOR_PROC_INIT_EVENT,\n                              (xdrproc_t)xdr_virLXCMonitorInitEventMsg,\n                              (void*)&msg);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got new client %p\"",
            "client"
          ],
          "line": 945
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetServerClientSetCloseHook",
          "args": [
            "client",
            "virLXCControllerClientCloseHook"
          ],
          "line": 944
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerClientSetCloseHook",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverclient.c",
          "lines": "922-928",
          "snippet": "void virNetServerClientSetCloseHook(virNetServerClientPtr client,\n                                    virNetServerClientCloseFunc cf)\n{\n    virObjectLock(client);\n    client->privateDataCloseFunc = cf;\n    virObjectUnlock(client);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virkeepalive.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserver.h\"",
            "# include <sasl/sasl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virNetServerClientUpdateEvent(virNetServerClientPtr client);",
            "static virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virkeepalive.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserver.h\"\n# include <sasl/sasl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic void virNetServerClientUpdateEvent(virNetServerClientPtr client);\nstatic virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);\n\nvoid virNetServerClientSetCloseHook(virNetServerClientPtr client,\n                                    virNetServerClientCloseFunc cf)\n{\n    virObjectLock(client);\n    client->privateDataCloseFunc = cf;\n    virObjectUnlock(client);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic void *virLXCControllerClientPrivateNew(virNetServerClientPtr client,\n                                              void *opaque)\n{\n    virLXCControllerPtr ctrl = opaque;\n\n    virNetServerClientSetCloseHook(client, virLXCControllerClientCloseHook);\n    VIR_DEBUG(\"Got new client %p\", client);\n    ctrl->client = client;\n\n    if (ctrl->initpid && ctrl->firstClient)\n        virLXCControllerEventSendInit(ctrl, ctrl->initpid);\n    ctrl->firstClient = false;\n\n    return ctrl;\n}"
  },
  {
    "function_name": "virLXCControllerClientPrivateFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "933-937",
    "snippet": "static void virLXCControllerClientPrivateFree(void *data)\n{\n    virLXCControllerPtr ctrl = data;\n    VIR_DEBUG(\"Got private data free %p\", ctrl);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got private data free %p\"",
            "ctrl"
          ],
          "line": 936
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void virLXCControllerClientPrivateFree(void *data)\n{\n    virLXCControllerPtr ctrl = data;\n    VIR_DEBUG(\"Got private data free %p\", ctrl);\n}"
  },
  {
    "function_name": "virLXCControllerClientCloseHook",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "920-931",
    "snippet": "static void virLXCControllerClientCloseHook(virNetServerClientPtr client)\n{\n    virLXCControllerPtr ctrl = virNetServerClientGetPrivateData(client);\n\n    VIR_DEBUG(\"Client %p has closed\", client);\n    if (ctrl->client == client)\n        ctrl->client = NULL;\n    if (ctrl->inShutdown) {\n        VIR_DEBUG(\"Arm timer to quit event loop\");\n        virEventUpdateTimeout(ctrl->timerShutdown, 0);\n    }\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virEventUpdateTimeout",
          "args": [
            "ctrl->timerShutdown",
            "0"
          ],
          "line": 929
        },
        "resolved": true,
        "details": {
          "function_name": "virEventUpdateTimeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "170-175",
          "snippet": "void\nvirEventUpdateTimeout(int timer, int timeout)\n{\n    if (updateTimeoutImpl)\n        updateTimeoutImpl(timer, timeout);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventUpdateTimeoutFunc updateTimeoutImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventUpdateTimeoutFunc updateTimeoutImpl;\n\nvoid\nvirEventUpdateTimeout(int timer, int timeout)\n{\n    if (updateTimeoutImpl)\n        updateTimeoutImpl(timer, timeout);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Arm timer to quit event loop\""
          ],
          "line": 928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Client %p has closed\"",
            "client"
          ],
          "line": 924
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetServerClientGetPrivateData",
          "args": [
            "client"
          ],
          "line": 922
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerClientGetPrivateData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverclient.c",
          "lines": "912-919",
          "snippet": "void *virNetServerClientGetPrivateData(virNetServerClientPtr client)\n{\n    void *data;\n    virObjectLock(client);\n    data = client->privateData;\n    virObjectUnlock(client);\n    return data;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virkeepalive.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserver.h\"",
            "# include <sasl/sasl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virNetServerClientUpdateEvent(virNetServerClientPtr client);",
            "static virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virkeepalive.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserver.h\"\n# include <sasl/sasl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic void virNetServerClientUpdateEvent(virNetServerClientPtr client);\nstatic virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);\n\nvoid *virNetServerClientGetPrivateData(virNetServerClientPtr client)\n{\n    void *data;\n    virObjectLock(client);\n    data = client->privateData;\n    virObjectUnlock(client);\n    return data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void virLXCControllerClientCloseHook(virNetServerClientPtr client)\n{\n    virLXCControllerPtr ctrl = virNetServerClientGetPrivateData(client);\n\n    VIR_DEBUG(\"Client %p has closed\", client);\n    if (ctrl->client == client)\n        ctrl->client = NULL;\n    if (ctrl->inShutdown) {\n        VIR_DEBUG(\"Arm timer to quit event loop\");\n        virEventUpdateTimeout(ctrl->timerShutdown, 0);\n    }\n}"
  },
  {
    "function_name": "virLXCControllerSetupCgroupLimits",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "881-917",
    "snippet": "static int virLXCControllerSetupCgroupLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    size_t i;\n\n    VIR_DEBUG(\"Setting up cgroup resource limits\");\n\n    if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n        goto cleanup;\n\n    nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n    if (!(ctrl->cgroup = virLXCCgroupCreate(ctrl->def,\n                                            ctrl->initpid,\n                                            ctrl->nnicindexes,\n                                            ctrl->nicindexes)))\n        goto cleanup;\n\n    if (virCgroupAddMachineProcess(ctrl->cgroup, getpid()) < 0)\n        goto cleanup;\n\n    /* Add all qemu-nbd tasks to the cgroup */\n    for (i = 0; i < ctrl->nnbdpids; i++) {\n        if (virCgroupAddMachineProcess(ctrl->cgroup, ctrl->nbdpids[i]) < 0)\n            goto cleanup;\n    }\n\n    if (virLXCCgroupSetup(ctrl->def, ctrl->cgroup, nodeset) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBitmapFree",
          "args": [
            "auto_nodeset"
          ],
          "line": 915
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "128-135",
          "snippet": "void\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCCgroupSetup",
          "args": [
            "ctrl->def",
            "ctrl->cgroup",
            "nodeset"
          ],
          "line": 910
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCCgroupSetup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_cgroup.c",
          "lines": "434-454",
          "snippet": "int virLXCCgroupSetup(virDomainDefPtr def,\n                      virCgroupPtr cgroup,\n                      virBitmapPtr nodemask)\n{\n    if (virLXCCgroupSetupCpuTune(def, cgroup) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupCpusetTune(def, cgroup, nodemask) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupBlkioTune(def, cgroup) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupMemTune(def, cgroup) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupDeviceACL(def, cgroup) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"domain_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_cgroup.h\"\n#include <config.h>\n\nint virLXCCgroupSetup(virDomainDefPtr def,\n                      virCgroupPtr cgroup,\n                      virBitmapPtr nodemask)\n{\n    if (virLXCCgroupSetupCpuTune(def, cgroup) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupCpusetTune(def, cgroup, nodemask) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupBlkioTune(def, cgroup) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupMemTune(def, cgroup) < 0)\n        return -1;\n\n    if (virLXCCgroupSetupDeviceACL(def, cgroup) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupAddMachineProcess",
          "args": [
            "ctrl->cgroup",
            "ctrl->nbdpids[i]"
          ],
          "line": 906
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupAddMachineProcess",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "2929-2936",
          "snippet": "int\nvirCgroupAddMachineProcess(virCgroupPtr group G_GNUC_UNUSED,\n                           pid_t pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nint\nvirCgroupAddMachineProcess(virCgroupPtr group G_GNUC_UNUSED,\n                           pid_t pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCCgroupCreate",
          "args": [
            "ctrl->def",
            "ctrl->initpid",
            "ctrl->nnicindexes",
            "ctrl->nicindexes"
          ],
          "line": 895
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCCgroupCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_cgroup.c",
          "lines": "384-431",
          "snippet": "virCgroupPtr virLXCCgroupCreate(virDomainDefPtr def,\n                                pid_t initpid,\n                                size_t nnicindexes,\n                                int *nicindexes)\n{\n    virCgroupPtr cgroup = NULL;\n    char *machineName = virLXCDomainGetMachineName(def, 0);\n\n    if (!machineName)\n        goto cleanup;\n\n    if (def->resource->partition[0] != '/') {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Resource partition '%s' must start with '/'\"),\n                       def->resource->partition);\n        goto cleanup;\n    }\n\n    if (virCgroupNewMachine(machineName,\n                            \"lxc\",\n                            def->uuid,\n                            NULL,\n                            initpid,\n                            true,\n                            nnicindexes, nicindexes,\n                            def->resource->partition,\n                            -1,\n                            0,\n                            &cgroup) < 0)\n        goto cleanup;\n\n    /* setup control group permissions for user namespace */\n    if (def->idmap.uidmap) {\n        if (virCgroupSetOwner(cgroup,\n                              def->idmap.uidmap[0].target,\n                              def->idmap.gidmap[0].target,\n                              (1 << VIR_CGROUP_CONTROLLER_SYSTEMD)) < 0) {\n            virCgroupFree(&cgroup);\n            cgroup = NULL;\n            goto cleanup;\n        }\n    }\n\n cleanup:\n    VIR_FREE(machineName);\n\n    return cgroup;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"domain_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_cgroup.h\"\n#include <config.h>\n\nvirCgroupPtr virLXCCgroupCreate(virDomainDefPtr def,\n                                pid_t initpid,\n                                size_t nnicindexes,\n                                int *nicindexes)\n{\n    virCgroupPtr cgroup = NULL;\n    char *machineName = virLXCDomainGetMachineName(def, 0);\n\n    if (!machineName)\n        goto cleanup;\n\n    if (def->resource->partition[0] != '/') {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Resource partition '%s' must start with '/'\"),\n                       def->resource->partition);\n        goto cleanup;\n    }\n\n    if (virCgroupNewMachine(machineName,\n                            \"lxc\",\n                            def->uuid,\n                            NULL,\n                            initpid,\n                            true,\n                            nnicindexes, nicindexes,\n                            def->resource->partition,\n                            -1,\n                            0,\n                            &cgroup) < 0)\n        goto cleanup;\n\n    /* setup control group permissions for user namespace */\n    if (def->idmap.uidmap) {\n        if (virCgroupSetOwner(cgroup,\n                              def->idmap.uidmap[0].target,\n                              def->idmap.gidmap[0].target,\n                              (1 << VIR_CGROUP_CONTROLLER_SYSTEMD)) < 0) {\n            virCgroupFree(&cgroup);\n            cgroup = NULL;\n            goto cleanup;\n        }\n    }\n\n cleanup:\n    VIR_FREE(machineName);\n\n    return cgroup;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainNumatuneGetNodeset",
          "args": [
            "ctrl->def->numa",
            "auto_nodeset",
            "-1"
          ],
          "line": 893
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainNumatuneGetNodeset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/numa_conf.c",
          "lines": "411-430",
          "snippet": "virBitmapPtr\nvirDomainNumatuneGetNodeset(virDomainNumaPtr numatune,\n                            virBitmapPtr auto_nodeset,\n                            int cellid)\n{\n    if (!numatune)\n        return NULL;\n\n    if (numatune->memory.specified &&\n        numatune->memory.placement == VIR_DOMAIN_NUMATUNE_PLACEMENT_AUTO)\n        return auto_nodeset;\n\n    if (virDomainNumatuneNodeSpecified(numatune, cellid))\n        return numatune->mem_nodes[cellid].nodeset;\n\n    if (!numatune->memory.specified)\n        return NULL;\n\n    return numatune->memory.nodeset;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_conf.h\"",
            "#include \"numa_conf.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"viralloc.h\"\n#include \"domain_conf.h\"\n#include \"numa_conf.h\"\n#include <config.h>\n\nvirBitmapPtr\nvirDomainNumatuneGetNodeset(virDomainNumaPtr numatune,\n                            virBitmapPtr auto_nodeset,\n                            int cellid)\n{\n    if (!numatune)\n        return NULL;\n\n    if (numatune->memory.specified &&\n        numatune->memory.placement == VIR_DOMAIN_NUMATUNE_PLACEMENT_AUTO)\n        return auto_nodeset;\n\n    if (virDomainNumatuneNodeSpecified(numatune, cellid))\n        return numatune->mem_nodes[cellid].nodeset;\n\n    if (!numatune->memory.specified)\n        return NULL;\n\n    return numatune->memory.nodeset;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerGetNumadAdvice",
          "args": [
            "ctrl",
            "&auto_nodeset"
          ],
          "line": 890
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerGetNumadAdvice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "802-826",
          "snippet": "static int virLXCControllerGetNumadAdvice(virLXCControllerPtr ctrl,\n                                          virBitmapPtr *mask)\n{\n    virBitmapPtr nodemask = NULL;\n    g_autofree char *nodeset = NULL;\n\n    /* Get the advisory nodeset from numad if 'placement' of\n     * either <vcpu> or <numatune> is 'auto'.\n     */\n    if (virDomainDefNeedsPlacementAdvice(ctrl->def)) {\n        nodeset = virNumaGetAutoPlacementAdvice(virDomainDefGetVcpus(ctrl->def),\n                                                ctrl->def->mem.cur_balloon);\n        if (!nodeset)\n            return -1;\n\n        VIR_DEBUG(\"Nodeset returned from numad: %s\", nodeset);\n\n        if (virBitmapParse(nodeset, &nodemask, VIR_DOMAIN_CPUMASK_LEN) < 0)\n            return -1;\n    }\n\n    *mask = nodemask;\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerGetNumadAdvice(virLXCControllerPtr ctrl,\n                                          virBitmapPtr *mask)\n{\n    virBitmapPtr nodemask = NULL;\n    g_autofree char *nodeset = NULL;\n\n    /* Get the advisory nodeset from numad if 'placement' of\n     * either <vcpu> or <numatune> is 'auto'.\n     */\n    if (virDomainDefNeedsPlacementAdvice(ctrl->def)) {\n        nodeset = virNumaGetAutoPlacementAdvice(virDomainDefGetVcpus(ctrl->def),\n                                                ctrl->def->mem.cur_balloon);\n        if (!nodeset)\n            return -1;\n\n        VIR_DEBUG(\"Nodeset returned from numad: %s\", nodeset);\n\n        if (virBitmapParse(nodeset, &nodemask, VIR_DOMAIN_CPUMASK_LEN) < 0)\n            return -1;\n    }\n\n    *mask = nodemask;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up cgroup resource limits\""
          ],
          "line": 888
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic int virLXCControllerSetupCgroupLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    size_t i;\n\n    VIR_DEBUG(\"Setting up cgroup resource limits\");\n\n    if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n        goto cleanup;\n\n    nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n    if (!(ctrl->cgroup = virLXCCgroupCreate(ctrl->def,\n                                            ctrl->initpid,\n                                            ctrl->nnicindexes,\n                                            ctrl->nicindexes)))\n        goto cleanup;\n\n    if (virCgroupAddMachineProcess(ctrl->cgroup, getpid()) < 0)\n        goto cleanup;\n\n    /* Add all qemu-nbd tasks to the cgroup */\n    for (i = 0; i < ctrl->nnbdpids; i++) {\n        if (virCgroupAddMachineProcess(ctrl->cgroup, ctrl->nbdpids[i]) < 0)\n            goto cleanup;\n    }\n\n    if (virLXCCgroupSetup(ctrl->def, ctrl->cgroup, nodeset) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerSetupResourceLimits",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "839-874",
    "snippet": "static int virLXCControllerSetupResourceLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    virDomainNumatuneMemMode mode;\n\n    if (virDomainNumatuneGetMode(ctrl->def->numa, -1, &mode) == 0) {\n        if (mode == VIR_DOMAIN_NUMATUNE_MEM_STRICT &&\n            virCgroupControllerAvailable(VIR_CGROUP_CONTROLLER_CPUSET)) {\n            /* Use virNuma* API iff necessary. Once set and child is exec()-ed,\n             * there's no way for us to change it. Rely on cgroups (if available\n             * and enabled in the config) rather than virNuma*. */\n            VIR_DEBUG(\"Relying on CGroups for memory binding\");\n        } else {\n\n            VIR_DEBUG(\"Setting up process resource limits\");\n\n            if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n                goto cleanup;\n\n            nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n            if (virNumaSetupMemoryPolicy(mode, nodeset) < 0)\n                goto cleanup;\n        }\n    }\n\n    if (virLXCControllerSetupCpuAffinity(ctrl) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBitmapFree",
          "args": [
            "auto_nodeset"
          ],
          "line": 872
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "128-135",
          "snippet": "void\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupCpuAffinity",
          "args": [
            "ctrl"
          ],
          "line": 867
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupCpuAffinity",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "757-799",
          "snippet": "static int virLXCControllerSetupCpuAffinity(virLXCControllerPtr ctrl)\n{\n    int hostcpus, maxcpu = CPU_SETSIZE;\n    virBitmapPtr cpumap, cpumapToSet;\n\n    VIR_DEBUG(\"Setting CPU affinity\");\n\n    /* setaffinity fails if you set bits for CPUs which\n     * aren't present, so we have to limit ourselves */\n    if ((hostcpus = virHostCPUGetCount()) < 0)\n        return -1;\n\n    if (maxcpu > hostcpus)\n        maxcpu = hostcpus;\n\n    cpumap = virBitmapNew(maxcpu);\n    if (!cpumap)\n        return -1;\n\n    cpumapToSet = cpumap;\n\n    if (ctrl->def->cpumask) {\n        cpumapToSet = ctrl->def->cpumask;\n    } else {\n        /* You may think this is redundant, but we can't assume libvirtd\n         * itself is running on all pCPUs, so we need to explicitly set\n         * the spawned LXC instance to all pCPUs if no map is given in\n         * its config file */\n        virBitmapSetAll(cpumap);\n    }\n\n    /* We are presuming we are running between fork/exec of LXC\n     * so use '0' to indicate our own process ID. No threads are\n     * running at this point\n     */\n    if (virProcessSetAffinity(0 /* Self */, cpumapToSet) < 0) {\n        virBitmapFree(cpumap);\n        return -1;\n    }\n    virBitmapFree(cpumap);\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupCpuAffinity(virLXCControllerPtr ctrl)\n{\n    int hostcpus, maxcpu = CPU_SETSIZE;\n    virBitmapPtr cpumap, cpumapToSet;\n\n    VIR_DEBUG(\"Setting CPU affinity\");\n\n    /* setaffinity fails if you set bits for CPUs which\n     * aren't present, so we have to limit ourselves */\n    if ((hostcpus = virHostCPUGetCount()) < 0)\n        return -1;\n\n    if (maxcpu > hostcpus)\n        maxcpu = hostcpus;\n\n    cpumap = virBitmapNew(maxcpu);\n    if (!cpumap)\n        return -1;\n\n    cpumapToSet = cpumap;\n\n    if (ctrl->def->cpumask) {\n        cpumapToSet = ctrl->def->cpumask;\n    } else {\n        /* You may think this is redundant, but we can't assume libvirtd\n         * itself is running on all pCPUs, so we need to explicitly set\n         * the spawned LXC instance to all pCPUs if no map is given in\n         * its config file */\n        virBitmapSetAll(cpumap);\n    }\n\n    /* We are presuming we are running between fork/exec of LXC\n     * so use '0' to indicate our own process ID. No threads are\n     * running at this point\n     */\n    if (virProcessSetAffinity(0 /* Self */, cpumapToSet) < 0) {\n        virBitmapFree(cpumap);\n        return -1;\n    }\n    virBitmapFree(cpumap);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNumaSetupMemoryPolicy",
          "args": [
            "mode",
            "nodeset"
          ],
          "line": 862
        },
        "resolved": true,
        "details": {
          "function_name": "virNumaSetupMemoryPolicy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnuma.c",
          "lines": "345-353",
          "snippet": "int\nvirNumaSetupMemoryPolicy(virDomainNumatuneMemMode mode G_GNUC_UNUSED,\n                         virBitmapPtr nodeset)\n{\n    if (!virNumaNodesetIsAvailable(nodeset))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnuma.h\"",
            "#include <dirent.h>",
            "#include <sys/types.h>",
            "# include <numa.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virhostmem.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virnuma.h\"\n#include <dirent.h>\n#include <sys/types.h>\n# include <numa.h>\n#include <config.h>\n\nint\nvirNumaSetupMemoryPolicy(virDomainNumatuneMemMode mode G_GNUC_UNUSED,\n                         virBitmapPtr nodeset)\n{\n    if (!virNumaNodesetIsAvailable(nodeset))\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainNumatuneGetNodeset",
          "args": [
            "ctrl->def->numa",
            "auto_nodeset",
            "-1"
          ],
          "line": 860
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainNumatuneGetNodeset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/numa_conf.c",
          "lines": "411-430",
          "snippet": "virBitmapPtr\nvirDomainNumatuneGetNodeset(virDomainNumaPtr numatune,\n                            virBitmapPtr auto_nodeset,\n                            int cellid)\n{\n    if (!numatune)\n        return NULL;\n\n    if (numatune->memory.specified &&\n        numatune->memory.placement == VIR_DOMAIN_NUMATUNE_PLACEMENT_AUTO)\n        return auto_nodeset;\n\n    if (virDomainNumatuneNodeSpecified(numatune, cellid))\n        return numatune->mem_nodes[cellid].nodeset;\n\n    if (!numatune->memory.specified)\n        return NULL;\n\n    return numatune->memory.nodeset;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_conf.h\"",
            "#include \"numa_conf.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"viralloc.h\"\n#include \"domain_conf.h\"\n#include \"numa_conf.h\"\n#include <config.h>\n\nvirBitmapPtr\nvirDomainNumatuneGetNodeset(virDomainNumaPtr numatune,\n                            virBitmapPtr auto_nodeset,\n                            int cellid)\n{\n    if (!numatune)\n        return NULL;\n\n    if (numatune->memory.specified &&\n        numatune->memory.placement == VIR_DOMAIN_NUMATUNE_PLACEMENT_AUTO)\n        return auto_nodeset;\n\n    if (virDomainNumatuneNodeSpecified(numatune, cellid))\n        return numatune->mem_nodes[cellid].nodeset;\n\n    if (!numatune->memory.specified)\n        return NULL;\n\n    return numatune->memory.nodeset;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerGetNumadAdvice",
          "args": [
            "ctrl",
            "&auto_nodeset"
          ],
          "line": 857
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerGetNumadAdvice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "802-826",
          "snippet": "static int virLXCControllerGetNumadAdvice(virLXCControllerPtr ctrl,\n                                          virBitmapPtr *mask)\n{\n    virBitmapPtr nodemask = NULL;\n    g_autofree char *nodeset = NULL;\n\n    /* Get the advisory nodeset from numad if 'placement' of\n     * either <vcpu> or <numatune> is 'auto'.\n     */\n    if (virDomainDefNeedsPlacementAdvice(ctrl->def)) {\n        nodeset = virNumaGetAutoPlacementAdvice(virDomainDefGetVcpus(ctrl->def),\n                                                ctrl->def->mem.cur_balloon);\n        if (!nodeset)\n            return -1;\n\n        VIR_DEBUG(\"Nodeset returned from numad: %s\", nodeset);\n\n        if (virBitmapParse(nodeset, &nodemask, VIR_DOMAIN_CPUMASK_LEN) < 0)\n            return -1;\n    }\n\n    *mask = nodemask;\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerGetNumadAdvice(virLXCControllerPtr ctrl,\n                                          virBitmapPtr *mask)\n{\n    virBitmapPtr nodemask = NULL;\n    g_autofree char *nodeset = NULL;\n\n    /* Get the advisory nodeset from numad if 'placement' of\n     * either <vcpu> or <numatune> is 'auto'.\n     */\n    if (virDomainDefNeedsPlacementAdvice(ctrl->def)) {\n        nodeset = virNumaGetAutoPlacementAdvice(virDomainDefGetVcpus(ctrl->def),\n                                                ctrl->def->mem.cur_balloon);\n        if (!nodeset)\n            return -1;\n\n        VIR_DEBUG(\"Nodeset returned from numad: %s\", nodeset);\n\n        if (virBitmapParse(nodeset, &nodemask, VIR_DOMAIN_CPUMASK_LEN) < 0)\n            return -1;\n    }\n\n    *mask = nodemask;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up process resource limits\""
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Relying on CGroups for memory binding\""
          ],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCgroupControllerAvailable",
          "args": [
            "VIR_CGROUP_CONTROLLER_CPUSET"
          ],
          "line": 848
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupControllerAvailable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "3531-3535",
          "snippet": "bool\nvirCgroupControllerAvailable(int controller G_GNUC_UNUSED)\n{\n    return false;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nbool\nvirCgroupControllerAvailable(int controller G_GNUC_UNUSED)\n{\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainNumatuneGetMode",
          "args": [
            "ctrl->def->numa",
            "-1",
            "&mode"
          ],
          "line": 846
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainNumatuneGetMode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/numa_conf.c",
          "lines": "389-409",
          "snippet": "int virDomainNumatuneGetMode(virDomainNumaPtr numatune,\n                             int cellid,\n                             virDomainNumatuneMemMode *mode)\n{\n    virDomainNumatuneMemMode tmp_mode;\n\n    if (!numatune)\n        return -1;\n\n    if (virDomainNumatuneNodeSpecified(numatune, cellid))\n        tmp_mode = numatune->mem_nodes[cellid].mode;\n    else if (numatune->memory.specified)\n        tmp_mode = numatune->memory.mode;\n    else\n        return -1;\n\n    if (mode)\n        *mode = tmp_mode;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_conf.h\"",
            "#include \"numa_conf.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"viralloc.h\"\n#include \"domain_conf.h\"\n#include \"numa_conf.h\"\n#include <config.h>\n\nint virDomainNumatuneGetMode(virDomainNumaPtr numatune,\n                             int cellid,\n                             virDomainNumatuneMemMode *mode)\n{\n    virDomainNumatuneMemMode tmp_mode;\n\n    if (!numatune)\n        return -1;\n\n    if (virDomainNumatuneNodeSpecified(numatune, cellid))\n        tmp_mode = numatune->mem_nodes[cellid].mode;\n    else if (numatune->memory.specified)\n        tmp_mode = numatune->memory.mode;\n    else\n        return -1;\n\n    if (mode)\n        *mode = tmp_mode;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupResourceLimits(virLXCControllerPtr ctrl)\n{\n    virBitmapPtr auto_nodeset = NULL;\n    int ret = -1;\n    virBitmapPtr nodeset = NULL;\n    virDomainNumatuneMemMode mode;\n\n    if (virDomainNumatuneGetMode(ctrl->def->numa, -1, &mode) == 0) {\n        if (mode == VIR_DOMAIN_NUMATUNE_MEM_STRICT &&\n            virCgroupControllerAvailable(VIR_CGROUP_CONTROLLER_CPUSET)) {\n            /* Use virNuma* API iff necessary. Once set and child is exec()-ed,\n             * there's no way for us to change it. Rely on cgroups (if available\n             * and enabled in the config) rather than virNuma*. */\n            VIR_DEBUG(\"Relying on CGroups for memory binding\");\n        } else {\n\n            VIR_DEBUG(\"Setting up process resource limits\");\n\n            if (virLXCControllerGetNumadAdvice(ctrl, &auto_nodeset) < 0)\n                goto cleanup;\n\n            nodeset = virDomainNumatuneGetNodeset(ctrl->def->numa, auto_nodeset, -1);\n\n            if (virNumaSetupMemoryPolicy(mode, nodeset) < 0)\n                goto cleanup;\n        }\n    }\n\n    if (virLXCControllerSetupCpuAffinity(ctrl) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virBitmapFree(auto_nodeset);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerGetNumadAdvice",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "802-826",
    "snippet": "static int virLXCControllerGetNumadAdvice(virLXCControllerPtr ctrl,\n                                          virBitmapPtr *mask)\n{\n    virBitmapPtr nodemask = NULL;\n    g_autofree char *nodeset = NULL;\n\n    /* Get the advisory nodeset from numad if 'placement' of\n     * either <vcpu> or <numatune> is 'auto'.\n     */\n    if (virDomainDefNeedsPlacementAdvice(ctrl->def)) {\n        nodeset = virNumaGetAutoPlacementAdvice(virDomainDefGetVcpus(ctrl->def),\n                                                ctrl->def->mem.cur_balloon);\n        if (!nodeset)\n            return -1;\n\n        VIR_DEBUG(\"Nodeset returned from numad: %s\", nodeset);\n\n        if (virBitmapParse(nodeset, &nodemask, VIR_DOMAIN_CPUMASK_LEN) < 0)\n            return -1;\n    }\n\n    *mask = nodemask;\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBitmapParse",
          "args": [
            "nodeset",
            "&nodemask",
            "VIR_DOMAIN_CPUMASK_LEN"
          ],
          "line": 819
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapParse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "581-587",
          "snippet": "int\nvirBitmapParse(const char *str,\n               virBitmapPtr *bitmap,\n               size_t bitmapSize)\n{\n    return virBitmapParseSeparator(str, '\\0', bitmap, bitmapSize);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirBitmapParse(const char *str,\n               virBitmapPtr *bitmap,\n               size_t bitmapSize)\n{\n    return virBitmapParseSeparator(str, '\\0', bitmap, bitmapSize);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Nodeset returned from numad: %s\"",
            "nodeset"
          ],
          "line": 817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNumaGetAutoPlacementAdvice",
          "args": [
            "virDomainDefGetVcpus(ctrl->def)",
            "ctrl->def->mem.cur_balloon"
          ],
          "line": 812
        },
        "resolved": true,
        "details": {
          "function_name": "virNumaGetAutoPlacementAdvice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnuma.c",
          "lines": "80-87",
          "snippet": "char *\nvirNumaGetAutoPlacementAdvice(unsigned short vcpus G_GNUC_UNUSED,\n                              unsigned long long balloon G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                   _(\"numad is not available on this host\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnuma.h\"",
            "#include <dirent.h>",
            "#include <sys/types.h>",
            "# include <numa.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virhostmem.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virnuma.h\"\n#include <dirent.h>\n#include <sys/types.h>\n# include <numa.h>\n#include <config.h>\n\nchar *\nvirNumaGetAutoPlacementAdvice(unsigned short vcpus G_GNUC_UNUSED,\n                              unsigned long long balloon G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                   _(\"numad is not available on this host\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetVcpus",
          "args": [
            "ctrl->def"
          ],
          "line": 812
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetVcpus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "1912-1924",
          "snippet": "unsigned int\nvirDomainDefGetVcpus(const virDomainDef *def)\n{\n    size_t i;\n    unsigned int ret = 0;\n\n    for (i = 0; i < def->maxvcpus; i++) {\n        if (def->vcpus[i]->online)\n            ret++;\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nunsigned int\nvirDomainDefGetVcpus(const virDomainDef *def)\n{\n    size_t i;\n    unsigned int ret = 0;\n\n    for (i = 0; i < def->maxvcpus; i++) {\n        if (def->vcpus[i]->online)\n            ret++;\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefNeedsPlacementAdvice",
          "args": [
            "ctrl->def"
          ],
          "line": 811
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefNeedsPlacementAdvice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30844-30854",
          "snippet": "bool\nvirDomainDefNeedsPlacementAdvice(virDomainDefPtr def)\n{\n    if (def->placement_mode == VIR_DOMAIN_CPU_PLACEMENT_MODE_AUTO)\n        return true;\n\n    if (virDomainNumatuneHasPlacementAuto(def->numa))\n        return true;\n\n    return false;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nbool\nvirDomainDefNeedsPlacementAdvice(virDomainDefPtr def)\n{\n    if (def->placement_mode == VIR_DOMAIN_CPU_PLACEMENT_MODE_AUTO)\n        return true;\n\n    if (virDomainNumatuneHasPlacementAuto(def->numa))\n        return true;\n\n    return false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerGetNumadAdvice(virLXCControllerPtr ctrl,\n                                          virBitmapPtr *mask)\n{\n    virBitmapPtr nodemask = NULL;\n    g_autofree char *nodeset = NULL;\n\n    /* Get the advisory nodeset from numad if 'placement' of\n     * either <vcpu> or <numatune> is 'auto'.\n     */\n    if (virDomainDefNeedsPlacementAdvice(ctrl->def)) {\n        nodeset = virNumaGetAutoPlacementAdvice(virDomainDefGetVcpus(ctrl->def),\n                                                ctrl->def->mem.cur_balloon);\n        if (!nodeset)\n            return -1;\n\n        VIR_DEBUG(\"Nodeset returned from numad: %s\", nodeset);\n\n        if (virBitmapParse(nodeset, &nodemask, VIR_DOMAIN_CPUMASK_LEN) < 0)\n            return -1;\n    }\n\n    *mask = nodemask;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupCpuAffinity",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "757-799",
    "snippet": "static int virLXCControllerSetupCpuAffinity(virLXCControllerPtr ctrl)\n{\n    int hostcpus, maxcpu = CPU_SETSIZE;\n    virBitmapPtr cpumap, cpumapToSet;\n\n    VIR_DEBUG(\"Setting CPU affinity\");\n\n    /* setaffinity fails if you set bits for CPUs which\n     * aren't present, so we have to limit ourselves */\n    if ((hostcpus = virHostCPUGetCount()) < 0)\n        return -1;\n\n    if (maxcpu > hostcpus)\n        maxcpu = hostcpus;\n\n    cpumap = virBitmapNew(maxcpu);\n    if (!cpumap)\n        return -1;\n\n    cpumapToSet = cpumap;\n\n    if (ctrl->def->cpumask) {\n        cpumapToSet = ctrl->def->cpumask;\n    } else {\n        /* You may think this is redundant, but we can't assume libvirtd\n         * itself is running on all pCPUs, so we need to explicitly set\n         * the spawned LXC instance to all pCPUs if no map is given in\n         * its config file */\n        virBitmapSetAll(cpumap);\n    }\n\n    /* We are presuming we are running between fork/exec of LXC\n     * so use '0' to indicate our own process ID. No threads are\n     * running at this point\n     */\n    if (virProcessSetAffinity(0 /* Self */, cpumapToSet) < 0) {\n        virBitmapFree(cpumap);\n        return -1;\n    }\n    virBitmapFree(cpumap);\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBitmapFree",
          "args": [
            "cpumap"
          ],
          "line": 796
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "128-135",
          "snippet": "void\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virProcessSetAffinity",
          "args": [
            "0/* Self */",
            "cpumapToSet"
          ],
          "line": 792
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessSetAffinity",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "583-589",
          "snippet": "int virProcessSetAffinity(pid_t pid G_GNUC_UNUSED,\n                          virBitmapPtr map G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Process CPU affinity is not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virProcessSetAffinity(pid_t pid G_GNUC_UNUSED,\n                          virBitmapPtr map G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Process CPU affinity is not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapSetAll",
          "args": [
            "cpumap"
          ],
          "line": 785
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapSetAll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "895-906",
          "snippet": "void virBitmapSetAll(virBitmapPtr bitmap)\n{\n    int tail = bitmap->nbits % VIR_BITMAP_BITS_PER_UNIT;\n\n    memset(bitmap->map, 0xff,\n           bitmap->map_len * (VIR_BITMAP_BITS_PER_UNIT / CHAR_BIT));\n\n    /* Ensure tail bits are clear.  */\n    if (tail)\n        bitmap->map[bitmap->map_len - 1] &=\n            -1UL >> (VIR_BITMAP_BITS_PER_UNIT - tail);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_BITMAP_BITS_PER_UNIT  ((int) sizeof(unsigned long) * CHAR_BIT)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\n#define VIR_BITMAP_BITS_PER_UNIT  ((int) sizeof(unsigned long) * CHAR_BIT)\n\nvoid virBitmapSetAll(virBitmapPtr bitmap)\n{\n    int tail = bitmap->nbits % VIR_BITMAP_BITS_PER_UNIT;\n\n    memset(bitmap->map, 0xff,\n           bitmap->map_len * (VIR_BITMAP_BITS_PER_UNIT / CHAR_BIT));\n\n    /* Ensure tail bits are clear.  */\n    if (tail)\n        bitmap->map[bitmap->map_len - 1] &=\n            -1UL >> (VIR_BITMAP_BITS_PER_UNIT - tail);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapNew",
          "args": [
            "maxcpu"
          ],
          "line": 772
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapNewString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "1144-1168",
          "snippet": "virBitmapPtr\nvirBitmapNewString(const char *string)\n{\n    virBitmapPtr bitmap;\n    size_t i = 0;\n    size_t len = strlen(string);\n\n    if (strspn(string, \"0123456789abcdefABCDEF\") != len) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Invalid hexadecimal string '%s'\"), string);\n        return NULL;\n    }\n\n    bitmap = virBitmapNew(len * 4);\n    if (!bitmap)\n        return NULL;\n\n    for (i = 0; i < len; i++) {\n        unsigned long nibble = g_ascii_xdigit_value(string[len - i - 1]);\n        nibble <<= VIR_BITMAP_BIT_OFFSET(i * 4);\n        bitmap->map[VIR_BITMAP_UNIT_OFFSET(i * 4)] |= nibble;\n    }\n\n    return bitmap;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirBitmapPtr\nvirBitmapNewString(const char *string)\n{\n    virBitmapPtr bitmap;\n    size_t i = 0;\n    size_t len = strlen(string);\n\n    if (strspn(string, \"0123456789abcdefABCDEF\") != len) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Invalid hexadecimal string '%s'\"), string);\n        return NULL;\n    }\n\n    bitmap = virBitmapNew(len * 4);\n    if (!bitmap)\n        return NULL;\n\n    for (i = 0; i < len; i++) {\n        unsigned long nibble = g_ascii_xdigit_value(string[len - i - 1]);\n        nibble <<= VIR_BITMAP_BIT_OFFSET(i * 4);\n        bitmap->map[VIR_BITMAP_UNIT_OFFSET(i * 4)] |= nibble;\n    }\n\n    return bitmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHostCPUGetCount",
          "args": [],
          "line": 766
        },
        "resolved": true,
        "details": {
          "function_name": "virHostCPUGetCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostcpu.c",
          "lines": "1030-1042",
          "snippet": "int\nvirHostCPUGetCount(void)\n{\n#if defined(__linux__)\n    return virHostCPUParseCountLinux();\n#elif defined(__FreeBSD__) || defined(__APPLE__)\n    return virHostCPUGetCountAppleFreeBSD();\n#else\n    virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                   _(\"host cpu counting not implemented on this platform\"));\n    return -1;\n#endif\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virnuma.h\"",
            "#include \"virstring.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virfile.h\"",
            "#include \"virarch.h\"",
            "#include \"virerror.h\"",
            "#include \"virhostcpupriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/resource.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/types.h>",
            "# include <sys/time.h>",
            "# include <linux/kvm.h>",
            "#include <unistd.h>",
            "# include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virnuma.h\"\n#include \"virstring.h\"\n#include \"virtypedparam.h\"\n#include \"virfile.h\"\n#include \"virarch.h\"\n#include \"virerror.h\"\n#include \"virhostcpupriv.h\"\n#include \"viralloc.h\"\n# include <sys/resource.h>\n# include <sys/sysctl.h>\n# include <sys/types.h>\n# include <sys/time.h>\n# include <linux/kvm.h>\n#include <unistd.h>\n# include <sys/ioctl.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirHostCPUGetCount(void)\n{\n#if defined(__linux__)\n    return virHostCPUParseCountLinux();\n#elif defined(__FreeBSD__) || defined(__APPLE__)\n    return virHostCPUGetCountAppleFreeBSD();\n#else\n    virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                   _(\"host cpu counting not implemented on this platform\"));\n    return -1;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting CPU affinity\""
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupCpuAffinity(virLXCControllerPtr ctrl)\n{\n    int hostcpus, maxcpu = CPU_SETSIZE;\n    virBitmapPtr cpumap, cpumapToSet;\n\n    VIR_DEBUG(\"Setting CPU affinity\");\n\n    /* setaffinity fails if you set bits for CPUs which\n     * aren't present, so we have to limit ourselves */\n    if ((hostcpus = virHostCPUGetCount()) < 0)\n        return -1;\n\n    if (maxcpu > hostcpus)\n        maxcpu = hostcpus;\n\n    cpumap = virBitmapNew(maxcpu);\n    if (!cpumap)\n        return -1;\n\n    cpumapToSet = cpumap;\n\n    if (ctrl->def->cpumask) {\n        cpumapToSet = ctrl->def->cpumask;\n    } else {\n        /* You may think this is redundant, but we can't assume libvirtd\n         * itself is running on all pCPUs, so we need to explicitly set\n         * the spawned LXC instance to all pCPUs if no map is given in\n         * its config file */\n        virBitmapSetAll(cpumap);\n    }\n\n    /* We are presuming we are running between fork/exec of LXC\n     * so use '0' to indicate our own process ID. No threads are\n     * running at this point\n     */\n    if (virProcessSetAffinity(0 /* Self */, cpumapToSet) < 0) {\n        virBitmapFree(cpumap);\n        return -1;\n    }\n    virBitmapFree(cpumap);\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupLoopDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "626-751",
    "snippet": "static int virLXCControllerSetupLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Setting up loop devices for filesystems\");\n\n    for (i = 0; i < ctrl->def->nfss; i++) {\n        virDomainFSDefPtr fs = ctrl->def->fss[i];\n        int fd;\n\n        if (fs->type != VIR_DOMAIN_FS_TYPE_FILE)\n            continue;\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_DEFAULT) {\n            if (fs->format == VIR_STORAGE_FILE_RAW ||\n                fs->format == VIR_STORAGE_FILE_NONE)\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_LOOP;\n            else\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_NBD;\n        }\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_LOOP) {\n            if (fs->format != VIR_STORAGE_FILE_RAW &&\n                fs->format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"fs format %s is not supported\"),\n                               virStorageFileFormatTypeToString(fs->format));\n                return -1;\n            }\n\n            fd = virLXCControllerSetupLoopDeviceFS(fs);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_NBD) {\n            if (virLXCControllerSetupNBDDeviceFS(fs) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, fs->src->path) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"fs driver %s is not supported\"),\n                           virDomainFSDriverTypeToString(fs->fsdriver));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setting up loop devices for disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        virDomainDiskDefPtr disk = ctrl->def->disks[i];\n        int fd;\n        const char *driver = virDomainDiskGetDriver(disk);\n        int format = virDomainDiskGetFormat(disk);\n\n        if (virDomainDiskGetType(disk) != VIR_STORAGE_TYPE_FILE)\n            continue;\n\n        /* If no driverName is set, we prefer 'loop' for\n         * dealing with raw or undefined formats, otherwise\n         * we use 'nbd'.\n         */\n        if (STREQ_NULLABLE(driver, \"loop\") ||\n            (!driver &&\n             (format == VIR_STORAGE_FILE_RAW ||\n              format == VIR_STORAGE_FILE_NONE))) {\n            if (format != VIR_STORAGE_FILE_RAW &&\n                format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"disk format %s is not supported\"),\n                               virStorageFileFormatTypeToString(format));\n                return -1;\n            }\n\n            /* We treat 'none' as meaning 'raw' since we\n             * don't want to go into the auto-probing\n             * business for security reasons\n             */\n            fd = virLXCControllerSetupLoopDeviceDisk(disk);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (!driver || STREQ(driver, \"nbd\")) {\n            if (disk->cachemode != VIR_DOMAIN_DISK_CACHE_DEFAULT &&\n                disk->cachemode != VIR_DOMAIN_DISK_CACHE_DISABLE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"Disk cache mode %s is not supported\"),\n                               virDomainDiskCacheTypeToString(disk->cachemode));\n                return -1;\n            }\n            if (virLXCControllerSetupNBDDeviceDisk(disk) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, virDomainDiskGetSource(disk)) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk driver %s is not supported\"),\n                           driver);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all loop devices\");\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setup all loop devices\""
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"disk driver %s is not supported\")",
            "driver"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"disk driver %s is not supported\""
          ],
          "line": 742
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerAppendNBDPids",
          "args": [
            "ctrl",
            "virDomainDiskGetSource(disk)"
          ],
          "line": 738
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerAppendNBDPids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "577-624",
          "snippet": "static int virLXCControllerAppendNBDPids(virLXCControllerPtr ctrl,\n                                         const char *dev)\n{\n    char *pidpath = NULL;\n    pid_t *pids = NULL;\n    size_t npids = 0;\n    size_t i;\n    int ret = -1;\n    size_t loops = 0;\n    pid_t pid;\n\n    if (!STRPREFIX(dev, \"/dev/\"))\n        goto cleanup;\n\n    pidpath = g_strdup_printf(\"/sys/devices/virtual/block/%s/pid\", dev + 5);\n\n    /* Wait for the pid file to appear */\n    while (!virFileExists(pidpath)) {\n        /* wait for 100ms before checking again, but don't do it for ever */\n        if (errno == ENOENT && loops < 10) {\n            g_usleep(100 * 1000);\n            loops++;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Cannot check NBD device %s pid\"),\n                                 dev + 5);\n            goto cleanup;\n        }\n    }\n\n    if (virPidFileReadPath(pidpath, &pid) < 0)\n        goto cleanup;\n\n    if (virProcessGetPids(pid, &npids, &pids) < 0)\n        goto cleanup;\n\n    for (i = 0; i < npids; i++) {\n        if (VIR_APPEND_ELEMENT(ctrl->nbdpids, ctrl->nnbdpids, pids[i]) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(pids);\n    VIR_FREE(pidpath);\n    return ret;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerAppendNBDPids(virLXCControllerPtr ctrl,\n                                         const char *dev)\n{\n    char *pidpath = NULL;\n    pid_t *pids = NULL;\n    size_t npids = 0;\n    size_t i;\n    int ret = -1;\n    size_t loops = 0;\n    pid_t pid;\n\n    if (!STRPREFIX(dev, \"/dev/\"))\n        goto cleanup;\n\n    pidpath = g_strdup_printf(\"/sys/devices/virtual/block/%s/pid\", dev + 5);\n\n    /* Wait for the pid file to appear */\n    while (!virFileExists(pidpath)) {\n        /* wait for 100ms before checking again, but don't do it for ever */\n        if (errno == ENOENT && loops < 10) {\n            g_usleep(100 * 1000);\n            loops++;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Cannot check NBD device %s pid\"),\n                                 dev + 5);\n            goto cleanup;\n        }\n    }\n\n    if (virPidFileReadPath(pidpath, &pid) < 0)\n        goto cleanup;\n\n    if (virProcessGetPids(pid, &npids, &pids) < 0)\n        goto cleanup;\n\n    for (i = 0; i < npids; i++) {\n        if (VIR_APPEND_ELEMENT(ctrl->nbdpids, ctrl->nnbdpids, pids[i]) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(pids);\n    VIR_FREE(pidpath);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetSource",
          "args": [
            "disk"
          ],
          "line": 738
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2155-2159",
          "snippet": "const char *\nvirDomainDiskGetSource(virDomainDiskDef const *def)\n{\n    return def->src->path;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirDomainDiskGetSource(virDomainDiskDef const *def)\n{\n    return def->src->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupNBDDeviceDisk",
          "args": [
            "disk"
          ],
          "line": 732
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupNBDDeviceDisk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "543-575",
          "snippet": "static int virLXCControllerSetupNBDDeviceDisk(virDomainDiskDefPtr disk)\n{\n    char *dev;\n    const char *src = virDomainDiskGetSource(disk);\n    int format = virDomainDiskGetFormat(disk);\n\n    if (format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(src,\n                                  format,\n                                  disk->src->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, dev) < 0) {\n        VIR_FREE(dev);\n        return -1;\n    }\n    VIR_FREE(dev);\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupNBDDeviceDisk(virDomainDiskDefPtr disk)\n{\n    char *dev;\n    const char *src = virDomainDiskGetSource(disk);\n    int format = virDomainDiskGetFormat(disk);\n\n    if (format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(src,\n                                  format,\n                                  disk->src->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, dev) < 0) {\n        VIR_FREE(dev);\n        return -1;\n    }\n    VIR_FREE(dev);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Disk cache mode %s is not supported\")",
            "virDomainDiskCacheTypeToString(disk->cachemode)"
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDiskCacheTypeToString",
          "args": [
            "disk->cachemode"
          ],
          "line": 729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "driver",
            "\"nbd\""
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "ctrl->loopDevFds",
            "ctrl->nloopDevs",
            "1"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Saving loop fd %d\"",
            "fd"
          ],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupLoopDeviceDisk",
          "args": [
            "disk"
          ],
          "line": 714
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupLoopDeviceDisk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "480-510",
          "snippet": "static int virLXCControllerSetupLoopDeviceDisk(virDomainDiskDefPtr disk)\n{\n    int lofd;\n    char *loname = NULL;\n    const char *src = virDomainDiskGetSource(disk);\n    int ret = -1;\n\n    if ((lofd = virFileLoopDeviceAssociate(src, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, loname);\n\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, loname) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(loname);\n    if (ret < 0)\n        VIR_FORCE_CLOSE(lofd);\n\n    return lofd;\n\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupLoopDeviceDisk(virDomainDiskDefPtr disk)\n{\n    int lofd;\n    char *loname = NULL;\n    const char *src = virDomainDiskGetSource(disk);\n    int ret = -1;\n\n    if ((lofd = virFileLoopDeviceAssociate(src, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, loname);\n\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, loname) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(loname);\n    if (ret < 0)\n        VIR_FORCE_CLOSE(lofd);\n\n    return lofd;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"disk format %s is not supported\")",
            "virStorageFileFormatTypeToString(format)"
          ],
          "line": 704
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageFileFormatTypeToString",
          "args": [
            "format"
          ],
          "line": 706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "driver",
            "\"loop\""
          ],
          "line": 698
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetType",
          "args": [
            "disk"
          ],
          "line": 691
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2141-2145",
          "snippet": "int\nvirDomainDiskGetType(virDomainDiskDefPtr def)\n{\n    return def->src->type;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirDomainDiskGetType(virDomainDiskDefPtr def)\n{\n    return def->src->type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetFormat",
          "args": [
            "disk"
          ],
          "line": 689
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2202-2206",
          "snippet": "int\nvirDomainDiskGetFormat(virDomainDiskDefPtr def)\n{\n    return def->src->format;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirDomainDiskGetFormat(virDomainDiskDefPtr def)\n{\n    return def->src->format;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetDriver",
          "args": [
            "disk"
          ],
          "line": 688
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetDriver",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2185-2189",
          "snippet": "const char *\nvirDomainDiskGetDriver(const virDomainDiskDef *def)\n{\n    return def->driverName;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirDomainDiskGetDriver(const virDomainDiskDef *def)\n{\n    return def->driverName;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up loop devices for disks\""
          ],
          "line": 683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"fs driver %s is not supported\")",
            "virDomainFSDriverTypeToString(fs->fsdriver)"
          ],
          "line": 676
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainFSDriverTypeToString",
          "args": [
            "fs->fsdriver"
          ],
          "line": 678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupNBDDeviceFS",
          "args": [
            "fs"
          ],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupNBDDeviceFS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "513-540",
          "snippet": "static int virLXCControllerSetupNBDDeviceFS(virDomainFSDefPtr fs)\n{\n    char *dev;\n\n    if (fs->format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(fs->src->path,\n                                  fs->format,\n                                  fs->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = dev;\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupNBDDeviceFS(virDomainFSDefPtr fs)\n{\n    char *dev;\n\n    if (fs->format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(fs->src->path,\n                                  fs->format,\n                                  fs->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = dev;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "ctrl->loopDevFds",
            "ctrl->nloopDevs",
            "1"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Saving loop fd %d\"",
            "fd"
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerSetupLoopDeviceFS",
          "args": [
            "fs"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerSetupLoopDeviceFS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "457-477",
          "snippet": "static int virLXCControllerSetupLoopDeviceFS(virDomainFSDefPtr fs)\n{\n    int lofd;\n    char *loname = NULL;\n\n    if ((lofd = virFileLoopDeviceAssociate(fs->src->path, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, loname);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = loname;\n    loname = NULL;\n\n    return lofd;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupLoopDeviceFS(virDomainFSDefPtr fs)\n{\n    int lofd;\n    char *loname = NULL;\n\n    if ((lofd = virFileLoopDeviceAssociate(fs->src->path, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, loname);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = loname;\n    loname = NULL;\n\n    return lofd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"fs format %s is not supported\")",
            "virStorageFileFormatTypeToString(fs->format)"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageFileFormatTypeToString",
          "args": [
            "fs->format"
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up loop devices for filesystems\""
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerSetupLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Setting up loop devices for filesystems\");\n\n    for (i = 0; i < ctrl->def->nfss; i++) {\n        virDomainFSDefPtr fs = ctrl->def->fss[i];\n        int fd;\n\n        if (fs->type != VIR_DOMAIN_FS_TYPE_FILE)\n            continue;\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_DEFAULT) {\n            if (fs->format == VIR_STORAGE_FILE_RAW ||\n                fs->format == VIR_STORAGE_FILE_NONE)\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_LOOP;\n            else\n                fs->fsdriver = VIR_DOMAIN_FS_DRIVER_TYPE_NBD;\n        }\n\n        if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_LOOP) {\n            if (fs->format != VIR_STORAGE_FILE_RAW &&\n                fs->format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"fs format %s is not supported\"),\n                               virStorageFileFormatTypeToString(fs->format));\n                return -1;\n            }\n\n            fd = virLXCControllerSetupLoopDeviceFS(fs);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (fs->fsdriver == VIR_DOMAIN_FS_DRIVER_TYPE_NBD) {\n            if (virLXCControllerSetupNBDDeviceFS(fs) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, fs->src->path) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"fs driver %s is not supported\"),\n                           virDomainFSDriverTypeToString(fs->fsdriver));\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setting up loop devices for disks\");\n\n    for (i = 0; i < ctrl->def->ndisks; i++) {\n        virDomainDiskDefPtr disk = ctrl->def->disks[i];\n        int fd;\n        const char *driver = virDomainDiskGetDriver(disk);\n        int format = virDomainDiskGetFormat(disk);\n\n        if (virDomainDiskGetType(disk) != VIR_STORAGE_TYPE_FILE)\n            continue;\n\n        /* If no driverName is set, we prefer 'loop' for\n         * dealing with raw or undefined formats, otherwise\n         * we use 'nbd'.\n         */\n        if (STREQ_NULLABLE(driver, \"loop\") ||\n            (!driver &&\n             (format == VIR_STORAGE_FILE_RAW ||\n              format == VIR_STORAGE_FILE_NONE))) {\n            if (format != VIR_STORAGE_FILE_RAW &&\n                format != VIR_STORAGE_FILE_NONE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"disk format %s is not supported\"),\n                               virStorageFileFormatTypeToString(format));\n                return -1;\n            }\n\n            /* We treat 'none' as meaning 'raw' since we\n             * don't want to go into the auto-probing\n             * business for security reasons\n             */\n            fd = virLXCControllerSetupLoopDeviceDisk(disk);\n            if (fd < 0)\n                return -1;\n\n            VIR_DEBUG(\"Saving loop fd %d\", fd);\n            if (VIR_EXPAND_N(ctrl->loopDevFds, ctrl->nloopDevs, 1) < 0) {\n                VIR_FORCE_CLOSE(fd);\n                return -1;\n            }\n            ctrl->loopDevFds[ctrl->nloopDevs - 1] = fd;\n        } else if (!driver || STREQ(driver, \"nbd\")) {\n            if (disk->cachemode != VIR_DOMAIN_DISK_CACHE_DEFAULT &&\n                disk->cachemode != VIR_DOMAIN_DISK_CACHE_DISABLE) {\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                               _(\"Disk cache mode %s is not supported\"),\n                               virDomainDiskCacheTypeToString(disk->cachemode));\n                return -1;\n            }\n            if (virLXCControllerSetupNBDDeviceDisk(disk) < 0)\n                return -1;\n\n            /* The NBD device will be cleaned up while the cgroup will end.\n             * For this we need to remember the qemu-nbd pid and add it to\n             * the cgroup */\n            if (virLXCControllerAppendNBDPids(ctrl, virDomainDiskGetSource(disk)) < 0)\n                return -1;\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk driver %s is not supported\"),\n                           driver);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Setup all loop devices\");\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerAppendNBDPids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "577-624",
    "snippet": "static int virLXCControllerAppendNBDPids(virLXCControllerPtr ctrl,\n                                         const char *dev)\n{\n    char *pidpath = NULL;\n    pid_t *pids = NULL;\n    size_t npids = 0;\n    size_t i;\n    int ret = -1;\n    size_t loops = 0;\n    pid_t pid;\n\n    if (!STRPREFIX(dev, \"/dev/\"))\n        goto cleanup;\n\n    pidpath = g_strdup_printf(\"/sys/devices/virtual/block/%s/pid\", dev + 5);\n\n    /* Wait for the pid file to appear */\n    while (!virFileExists(pidpath)) {\n        /* wait for 100ms before checking again, but don't do it for ever */\n        if (errno == ENOENT && loops < 10) {\n            g_usleep(100 * 1000);\n            loops++;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Cannot check NBD device %s pid\"),\n                                 dev + 5);\n            goto cleanup;\n        }\n    }\n\n    if (virPidFileReadPath(pidpath, &pid) < 0)\n        goto cleanup;\n\n    if (virProcessGetPids(pid, &npids, &pids) < 0)\n        goto cleanup;\n\n    for (i = 0; i < npids; i++) {\n        if (VIR_APPEND_ELEMENT(ctrl->nbdpids, ctrl->nnbdpids, pids[i]) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(pids);\n    VIR_FREE(pidpath);\n    return ret;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pidpath"
          ],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pids"
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "ctrl->nbdpids",
            "ctrl->nnbdpids",
            "pids[i]"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virProcessGetPids",
          "args": [
            "pid",
            "&npids",
            "&pids"
          ],
          "line": 610
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessGetPids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "601-639",
          "snippet": "int virProcessGetPids(pid_t pid, size_t *npids, pid_t **pids)\n{\n    int ret = -1;\n    DIR *dir = NULL;\n    int value;\n    struct dirent *ent;\n    g_autofree char *taskPath = NULL;\n\n    *npids = 0;\n    *pids = NULL;\n\n    taskPath = g_strdup_printf(\"/proc/%llu/task\", (long long)pid);\n\n    if (virDirOpen(&dir, taskPath) < 0)\n        goto cleanup;\n\n    while ((value = virDirRead(dir, &ent, taskPath)) > 0) {\n        long long tmp;\n        pid_t tmp_pid;\n\n        if (virStrToLong_ll(ent->d_name, NULL, 10, &tmp) < 0)\n            goto cleanup;\n        tmp_pid = tmp;\n\n        if (VIR_APPEND_ELEMENT(*pids, *npids, tmp_pid) < 0)\n            goto cleanup;\n    }\n\n    if (value < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (ret < 0)\n        VIR_FREE(*pids);\n    return ret;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virProcessGetPids(pid_t pid, size_t *npids, pid_t **pids)\n{\n    int ret = -1;\n    DIR *dir = NULL;\n    int value;\n    struct dirent *ent;\n    g_autofree char *taskPath = NULL;\n\n    *npids = 0;\n    *pids = NULL;\n\n    taskPath = g_strdup_printf(\"/proc/%llu/task\", (long long)pid);\n\n    if (virDirOpen(&dir, taskPath) < 0)\n        goto cleanup;\n\n    while ((value = virDirRead(dir, &ent, taskPath)) > 0) {\n        long long tmp;\n        pid_t tmp_pid;\n\n        if (virStrToLong_ll(ent->d_name, NULL, 10, &tmp) < 0)\n            goto cleanup;\n        tmp_pid = tmp;\n\n        if (VIR_APPEND_ELEMENT(*pids, *npids, tmp_pid) < 0)\n            goto cleanup;\n    }\n\n    if (value < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (ret < 0)\n        VIR_FREE(*pids);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPidFileReadPath",
          "args": [
            "pidpath",
            "&pid"
          ],
          "line": 607
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileReadPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "105-145",
          "snippet": "int virPidFileReadPath(const char *path,\n                       pid_t *pid)\n{\n    int fd;\n    int rc;\n    ssize_t bytes;\n    long long pid_value = 0;\n    char pidstr[VIR_INT64_STR_BUFLEN];\n    char *endptr = NULL;\n\n    *pid = 0;\n\n    if ((fd = open(path, O_RDONLY)) < 0) {\n        rc = -errno;\n        goto cleanup;\n    }\n\n    bytes = saferead(fd, pidstr, sizeof(pidstr));\n    if (bytes < 0) {\n        rc = -errno;\n        VIR_FORCE_CLOSE(fd);\n        goto cleanup;\n    }\n    pidstr[bytes] = '\\0';\n\n    if (virStrToLong_ll(pidstr, &endptr, 10, &pid_value) < 0 ||\n        !(*endptr == '\\0' || g_ascii_isspace(*endptr)) ||\n        (pid_t) pid_value != pid_value) {\n        rc = -EINVAL;\n        goto cleanup;\n    }\n\n    *pid = pid_value;\n    rc = 0;\n\n cleanup:\n    if (VIR_CLOSE(fd) < 0)\n        rc = -errno;\n\n    return rc;\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileReadPath(const char *path,\n                       pid_t *pid)\n{\n    int fd;\n    int rc;\n    ssize_t bytes;\n    long long pid_value = 0;\n    char pidstr[VIR_INT64_STR_BUFLEN];\n    char *endptr = NULL;\n\n    *pid = 0;\n\n    if ((fd = open(path, O_RDONLY)) < 0) {\n        rc = -errno;\n        goto cleanup;\n    }\n\n    bytes = saferead(fd, pidstr, sizeof(pidstr));\n    if (bytes < 0) {\n        rc = -errno;\n        VIR_FORCE_CLOSE(fd);\n        goto cleanup;\n    }\n    pidstr[bytes] = '\\0';\n\n    if (virStrToLong_ll(pidstr, &endptr, 10, &pid_value) < 0 ||\n        !(*endptr == '\\0' || g_ascii_isspace(*endptr)) ||\n        (pid_t) pid_value != pid_value) {\n        rc = -EINVAL;\n        goto cleanup;\n    }\n\n    *pid = pid_value;\n    rc = 0;\n\n cleanup:\n    if (VIR_CLOSE(fd) < 0)\n        rc = -errno;\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Cannot check NBD device %s pid\")",
            "dev + 5"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot check NBD device %s pid\""
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_usleep",
          "args": [
            "100 * 1000"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "pidpath"
          ],
          "line": 594
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/sys/devices/virtual/block/%s/pid\"",
            "dev + 5"
          ],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "dev",
            "\"/dev/\""
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerAppendNBDPids(virLXCControllerPtr ctrl,\n                                         const char *dev)\n{\n    char *pidpath = NULL;\n    pid_t *pids = NULL;\n    size_t npids = 0;\n    size_t i;\n    int ret = -1;\n    size_t loops = 0;\n    pid_t pid;\n\n    if (!STRPREFIX(dev, \"/dev/\"))\n        goto cleanup;\n\n    pidpath = g_strdup_printf(\"/sys/devices/virtual/block/%s/pid\", dev + 5);\n\n    /* Wait for the pid file to appear */\n    while (!virFileExists(pidpath)) {\n        /* wait for 100ms before checking again, but don't do it for ever */\n        if (errno == ENOENT && loops < 10) {\n            g_usleep(100 * 1000);\n            loops++;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Cannot check NBD device %s pid\"),\n                                 dev + 5);\n            goto cleanup;\n        }\n    }\n\n    if (virPidFileReadPath(pidpath, &pid) < 0)\n        goto cleanup;\n\n    if (virProcessGetPids(pid, &npids, &pids) < 0)\n        goto cleanup;\n\n    for (i = 0; i < npids; i++) {\n        if (VIR_APPEND_ELEMENT(ctrl->nbdpids, ctrl->nnbdpids, pids[i]) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(pids);\n    VIR_FREE(pidpath);\n    return ret;\n}"
  },
  {
    "function_name": "virLXCControllerSetupNBDDeviceDisk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "543-575",
    "snippet": "static int virLXCControllerSetupNBDDeviceDisk(virDomainDiskDefPtr disk)\n{\n    char *dev;\n    const char *src = virDomainDiskGetSource(disk);\n    int format = virDomainDiskGetFormat(disk);\n\n    if (format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(src,\n                                  format,\n                                  disk->src->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, dev) < 0) {\n        VIR_FREE(dev);\n        return -1;\n    }\n    VIR_FREE(dev);\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev"
          ],
          "line": 569
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDiskSetSource",
          "args": [
            "disk",
            "dev"
          ],
          "line": 568
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskSetSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2162-2169",
          "snippet": "int\nvirDomainDiskSetSource(virDomainDiskDefPtr def, const char *src)\n{\n    char *tmp = g_strdup(src);\n    g_free(def->src->path);\n    def->src->path = tmp;\n    return 0;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirDomainDiskSetSource(virDomainDiskDefPtr def, const char *src)\n{\n    char *tmp = g_strdup(src);\n    g_free(def->src->path);\n    def->src->path = tmp;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskSetType",
          "args": [
            "disk",
            "VIR_STORAGE_TYPE_BLOCK"
          ],
          "line": 567
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskSetType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2148-2152",
          "snippet": "void\nvirDomainDiskSetType(virDomainDiskDefPtr def, int type)\n{\n    def->src->type = type;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirDomainDiskSetType(virDomainDiskDefPtr def, int type)\n{\n    def->src->type = type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Changing disk %s to use type=block for dev %s\"",
            "src",
            "dev"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileNBDDeviceAssociate",
          "args": [
            "src",
            "format",
            "disk->src->readonly",
            "&dev"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "virFileNBDDeviceAssociate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "983-992",
          "snippet": "int virFileNBDDeviceAssociate(const char *file,\n                              virStorageFileFormat fmt G_GNUC_UNUSED,\n                              bool readonly G_GNUC_UNUSED,\n                              char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with NBD device\"),\n                         file);\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileNBDDeviceAssociate(const char *file,\n                              virStorageFileFormat fmt G_GNUC_UNUSED,\n                              bool readonly G_GNUC_UNUSED,\n                              char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with NBD device\"),\n                         file);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"An explicit disk format must be specified\")"
          ],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"An explicit disk format must be specified\""
          ],
          "line": 551
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetFormat",
          "args": [
            "disk"
          ],
          "line": 547
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2202-2206",
          "snippet": "int\nvirDomainDiskGetFormat(virDomainDiskDefPtr def)\n{\n    return def->src->format;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirDomainDiskGetFormat(virDomainDiskDefPtr def)\n{\n    return def->src->format;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetSource",
          "args": [
            "disk"
          ],
          "line": 546
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2155-2159",
          "snippet": "const char *\nvirDomainDiskGetSource(virDomainDiskDef const *def)\n{\n    return def->src->path;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirDomainDiskGetSource(virDomainDiskDef const *def)\n{\n    return def->src->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupNBDDeviceDisk(virDomainDiskDefPtr disk)\n{\n    char *dev;\n    const char *src = virDomainDiskGetSource(disk);\n    int format = virDomainDiskGetFormat(disk);\n\n    if (format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(src,\n                                  format,\n                                  disk->src->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, dev) < 0) {\n        VIR_FREE(dev);\n        return -1;\n    }\n    VIR_FREE(dev);\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupNBDDeviceFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "513-540",
    "snippet": "static int virLXCControllerSetupNBDDeviceFS(virDomainFSDefPtr fs)\n{\n    char *dev;\n\n    if (fs->format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(fs->src->path,\n                                  fs->format,\n                                  fs->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = dev;\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "fs->src->path"
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Changing fs %s to use type=block for dev %s\"",
            "fs->src->path",
            "dev"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileNBDDeviceAssociate",
          "args": [
            "fs->src->path",
            "fs->format",
            "fs->readonly",
            "&dev"
          ],
          "line": 523
        },
        "resolved": true,
        "details": {
          "function_name": "virFileNBDDeviceAssociate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "983-992",
          "snippet": "int virFileNBDDeviceAssociate(const char *file,\n                              virStorageFileFormat fmt G_GNUC_UNUSED,\n                              bool readonly G_GNUC_UNUSED,\n                              char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with NBD device\"),\n                         file);\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileNBDDeviceAssociate(const char *file,\n                              virStorageFileFormat fmt G_GNUC_UNUSED,\n                              bool readonly G_GNUC_UNUSED,\n                              char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with NBD device\"),\n                         file);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"An explicit disk format must be specified\")"
          ],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"An explicit disk format must be specified\""
          ],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupNBDDeviceFS(virDomainFSDefPtr fs)\n{\n    char *dev;\n\n    if (fs->format <= VIR_STORAGE_FILE_NONE) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"An explicit disk format must be specified\"));\n        return -1;\n    }\n\n    if (virFileNBDDeviceAssociate(fs->src->path,\n                                  fs->format,\n                                  fs->readonly,\n                                  &dev) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, dev);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = dev;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerSetupLoopDeviceDisk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "480-510",
    "snippet": "static int virLXCControllerSetupLoopDeviceDisk(virDomainDiskDefPtr disk)\n{\n    int lofd;\n    char *loname = NULL;\n    const char *src = virDomainDiskGetSource(disk);\n    int ret = -1;\n\n    if ((lofd = virFileLoopDeviceAssociate(src, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, loname);\n\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, loname) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(loname);\n    if (ret < 0)\n        VIR_FORCE_CLOSE(lofd);\n\n    return lofd;\n\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "lofd"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "loname"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDiskSetSource",
          "args": [
            "disk",
            "loname"
          ],
          "line": 498
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskSetSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2162-2169",
          "snippet": "int\nvirDomainDiskSetSource(virDomainDiskDefPtr def, const char *src)\n{\n    char *tmp = g_strdup(src);\n    g_free(def->src->path);\n    def->src->path = tmp;\n    return 0;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirDomainDiskSetSource(virDomainDiskDefPtr def, const char *src)\n{\n    char *tmp = g_strdup(src);\n    g_free(def->src->path);\n    def->src->path = tmp;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskSetType",
          "args": [
            "disk",
            "VIR_STORAGE_TYPE_BLOCK"
          ],
          "line": 497
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskSetType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2148-2152",
          "snippet": "void\nvirDomainDiskSetType(virDomainDiskDefPtr def, int type)\n{\n    def->src->type = type;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirDomainDiskSetType(virDomainDiskDefPtr def, int type)\n{\n    def->src->type = type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Changing disk %s to use type=block for dev %s\"",
            "src",
            "loname"
          ],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileLoopDeviceAssociate",
          "args": [
            "src",
            "&loname"
          ],
          "line": 487
        },
        "resolved": true,
        "details": {
          "function_name": "virFileLoopDeviceAssociate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "973-981",
          "snippet": "int virFileLoopDeviceAssociate(const char *file,\n                               char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with loop device\"),\n                         file);\n    *dev = NULL;\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileLoopDeviceAssociate(const char *file,\n                               char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with loop device\"),\n                         file);\n    *dev = NULL;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskGetSource",
          "args": [
            "disk"
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskGetSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "2155-2159",
          "snippet": "const char *\nvirDomainDiskGetSource(virDomainDiskDef const *def)\n{\n    return def->src->path;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirDomainDiskGetSource(virDomainDiskDef const *def)\n{\n    return def->src->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupLoopDeviceDisk(virDomainDiskDefPtr disk)\n{\n    int lofd;\n    char *loname = NULL;\n    const char *src = virDomainDiskGetSource(disk);\n    int ret = -1;\n\n    if ((lofd = virFileLoopDeviceAssociate(src, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing disk %s to use type=block for dev %s\",\n              src, loname);\n\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    virDomainDiskSetType(disk, VIR_STORAGE_TYPE_BLOCK);\n    if (virDomainDiskSetSource(disk, loname) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(loname);\n    if (ret < 0)\n        VIR_FORCE_CLOSE(lofd);\n\n    return lofd;\n\n}"
  },
  {
    "function_name": "virLXCControllerSetupLoopDeviceFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "457-477",
    "snippet": "static int virLXCControllerSetupLoopDeviceFS(virDomainFSDefPtr fs)\n{\n    int lofd;\n    char *loname = NULL;\n\n    if ((lofd = virFileLoopDeviceAssociate(fs->src->path, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, loname);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = loname;\n    loname = NULL;\n\n    return lofd;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "fs->src->path"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Changing fs %s to use type=block for dev %s\"",
            "fs->src->path",
            "loname"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileLoopDeviceAssociate",
          "args": [
            "fs->src->path",
            "&loname"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "virFileLoopDeviceAssociate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "973-981",
          "snippet": "int virFileLoopDeviceAssociate(const char *file,\n                               char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with loop device\"),\n                         file);\n    *dev = NULL;\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileLoopDeviceAssociate(const char *file,\n                               char **dev G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to associate file %s with loop device\"),\n                         file);\n    *dev = NULL;\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerSetupLoopDeviceFS(virDomainFSDefPtr fs)\n{\n    int lofd;\n    char *loname = NULL;\n\n    if ((lofd = virFileLoopDeviceAssociate(fs->src->path, &loname)) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Changing fs %s to use type=block for dev %s\",\n              fs->src->path, loname);\n    /*\n     * We now change it into a block device type, so that\n     * the rest of container setup 'just works'\n     */\n    fs->type = VIR_DOMAIN_FS_TYPE_BLOCK;\n    VIR_FREE(fs->src->path);\n    fs->src->path = loname;\n    loname = NULL;\n\n    return lofd;\n}"
  },
  {
    "function_name": "virLXCControllerValidateConsoles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "444-454",
    "snippet": "static int virLXCControllerValidateConsoles(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nconsoles != ctrl->nconsoles) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu consoles, but got %zu tty file handlers\"),\n                       ctrl->def->nconsoles, ctrl->nconsoles);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"expecting %zu consoles, but got %zu tty file handlers\")",
            "ctrl->def->nconsoles",
            "ctrl->nconsoles"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"expecting %zu consoles, but got %zu tty file handlers\""
          ],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerValidateConsoles(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nconsoles != ctrl->nconsoles) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu consoles, but got %zu tty file handlers\"),\n                       ctrl->def->nconsoles, ctrl->nconsoles);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerGetNICIndexes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "381-441",
    "snippet": "static int virLXCControllerGetNICIndexes(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    /* Gather the ifindexes of the \"parent\" veths for all interfaces\n     * implemented with a veth pair. These will be used when calling\n     * virCgroupNewMachine (and eventually the dbus method\n     * CreateMachineWithNetwork). ifindexes for the child veths, and\n     * for macvlan interfaces, *should not* be in this list, as they\n     * will be moved into the container. Only the interfaces that will\n     * remain outside the container, but are used for communication\n     * with the container, should be added to the list.\n     */\n\n    VIR_DEBUG(\"Getting nic indexes\");\n    for (i = 0; i < ctrl->def->nnets; i++) {\n        int nicindex = -1;\n        virDomainNetType actualType = virDomainNetGetActualType(ctrl->def->nets[i]);\n\n        switch (actualType) {\n        case VIR_DOMAIN_NET_TYPE_BRIDGE:\n        case VIR_DOMAIN_NET_TYPE_NETWORK:\n        case VIR_DOMAIN_NET_TYPE_ETHERNET:\n            if (ctrl->def->nets[i]->ifname == NULL)\n                continue;\n            if (virNetDevGetIndex(ctrl->def->nets[i]->ifname,\n                                  &nicindex) < 0)\n                return -1;\n            if (VIR_EXPAND_N(ctrl->nicindexes,\n                             ctrl->nnicindexes,\n                             1) < 0)\n                return -1;\n            VIR_DEBUG(\"Index %d for %s\", nicindex,\n                      ctrl->def->nets[i]->ifname);\n            ctrl->nicindexes[ctrl->nnicindexes-1] = nicindex;\n            break;\n\n        case VIR_DOMAIN_NET_TYPE_DIRECT:\n           break;\n\n        case VIR_DOMAIN_NET_TYPE_USER:\n        case VIR_DOMAIN_NET_TYPE_VHOSTUSER:\n        case VIR_DOMAIN_NET_TYPE_SERVER:\n        case VIR_DOMAIN_NET_TYPE_CLIENT:\n        case VIR_DOMAIN_NET_TYPE_MCAST:\n        case VIR_DOMAIN_NET_TYPE_UDP:\n        case VIR_DOMAIN_NET_TYPE_INTERNAL:\n        case VIR_DOMAIN_NET_TYPE_HOSTDEV:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported net type %s\"),\n                           virDomainNetTypeToString(actualType));\n            return -1;\n        case VIR_DOMAIN_NET_TYPE_LAST:\n        default:\n            virReportEnumRangeError(virDomainNetType, actualType);\n            return -1;\n        }\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportEnumRangeError",
          "args": [
            "virDomainNetType",
            "actualType"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Unsupported net type %s\")",
            "virDomainNetTypeToString(actualType)"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainNetTypeToString",
          "args": [
            "actualType"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unsupported net type %s\""
          ],
          "line": 430
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Index %d for %s\"",
            "nicindex",
            "ctrl->def->nets[i]->ifname"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "ctrl->nicindexes",
            "ctrl->nnicindexes",
            "1"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevGetIndex",
          "args": [
            "ctrl->def->nets[i]->ifname",
            "&nicindex"
          ],
          "line": 406
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevGetIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "893-899",
          "snippet": "int virNetDevGetIndex(const char *ifname G_GNUC_UNUSED,\n                      int *ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to get interface index on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevGetIndex(const char *ifname G_GNUC_UNUSED,\n                      int *ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to get interface index on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainNetGetActualType",
          "args": [
            "ctrl->def->nets[i]"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainNetGetActualType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30154-30162",
          "snippet": "virDomainNetType\nvirDomainNetGetActualType(const virDomainNetDef *iface)\n{\n    if (iface->type != VIR_DOMAIN_NET_TYPE_NETWORK)\n        return iface->type;\n    if (!iface->data.network.actual)\n        return iface->type;\n    return iface->data.network.actual->type;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirDomainNetType\nvirDomainNetGetActualType(const virDomainNetDef *iface)\n{\n    if (iface->type != VIR_DOMAIN_NET_TYPE_NETWORK)\n        return iface->type;\n    if (!iface->data.network.actual)\n        return iface->type;\n    return iface->data.network.actual->type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Getting nic indexes\""
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerGetNICIndexes(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    /* Gather the ifindexes of the \"parent\" veths for all interfaces\n     * implemented with a veth pair. These will be used when calling\n     * virCgroupNewMachine (and eventually the dbus method\n     * CreateMachineWithNetwork). ifindexes for the child veths, and\n     * for macvlan interfaces, *should not* be in this list, as they\n     * will be moved into the container. Only the interfaces that will\n     * remain outside the container, but are used for communication\n     * with the container, should be added to the list.\n     */\n\n    VIR_DEBUG(\"Getting nic indexes\");\n    for (i = 0; i < ctrl->def->nnets; i++) {\n        int nicindex = -1;\n        virDomainNetType actualType = virDomainNetGetActualType(ctrl->def->nets[i]);\n\n        switch (actualType) {\n        case VIR_DOMAIN_NET_TYPE_BRIDGE:\n        case VIR_DOMAIN_NET_TYPE_NETWORK:\n        case VIR_DOMAIN_NET_TYPE_ETHERNET:\n            if (ctrl->def->nets[i]->ifname == NULL)\n                continue;\n            if (virNetDevGetIndex(ctrl->def->nets[i]->ifname,\n                                  &nicindex) < 0)\n                return -1;\n            if (VIR_EXPAND_N(ctrl->nicindexes,\n                             ctrl->nnicindexes,\n                             1) < 0)\n                return -1;\n            VIR_DEBUG(\"Index %d for %s\", nicindex,\n                      ctrl->def->nets[i]->ifname);\n            ctrl->nicindexes[ctrl->nnicindexes-1] = nicindex;\n            break;\n\n        case VIR_DOMAIN_NET_TYPE_DIRECT:\n           break;\n\n        case VIR_DOMAIN_NET_TYPE_USER:\n        case VIR_DOMAIN_NET_TYPE_VHOSTUSER:\n        case VIR_DOMAIN_NET_TYPE_SERVER:\n        case VIR_DOMAIN_NET_TYPE_CLIENT:\n        case VIR_DOMAIN_NET_TYPE_MCAST:\n        case VIR_DOMAIN_NET_TYPE_UDP:\n        case VIR_DOMAIN_NET_TYPE_INTERNAL:\n        case VIR_DOMAIN_NET_TYPE_HOSTDEV:\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"Unsupported net type %s\"),\n                           virDomainNetTypeToString(actualType));\n            return -1;\n        case VIR_DOMAIN_NET_TYPE_LAST:\n        default:\n            virReportEnumRangeError(virDomainNetType, actualType);\n            return -1;\n        }\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerValidateNICs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "368-378",
    "snippet": "static int virLXCControllerValidateNICs(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nnets != ctrl->nveths) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu veths, but got %zu\"),\n                       ctrl->def->nnets, ctrl->nveths);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"expecting %zu veths, but got %zu\")",
            "ctrl->def->nnets",
            "ctrl->nveths"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"expecting %zu veths, but got %zu\""
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerValidateNICs(virLXCControllerPtr ctrl)\n{\n    if (ctrl->def->nnets != ctrl->nveths) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"expecting %zu veths, but got %zu\"),\n                       ctrl->def->nnets, ctrl->nveths);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerDaemonHandshake",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "356-365",
    "snippet": "static int virLXCControllerDaemonHandshake(virLXCControllerPtr ctrl)\n{\n    if (lxcContainerSendContinue(ctrl->handshakeFd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error sending continue signal to daemon\"));\n        return -1;\n    }\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ctrl->handshakeFd"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"error sending continue signal to daemon\")"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"error sending continue signal to daemon\""
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSendContinue",
          "args": [
            "ctrl->handshakeFd"
          ],
          "line": 358
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSendContinue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "381-392",
          "snippet": "int lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LXC_CONTINUE_MSG 'c'"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerDaemonHandshake(virLXCControllerPtr ctrl)\n{\n    if (lxcContainerSendContinue(ctrl->handshakeFd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"error sending continue signal to daemon\"));\n        return -1;\n    }\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerConsoleSetNonblocking",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "343-353",
    "snippet": "static int virLXCControllerConsoleSetNonblocking(virLXCControllerConsolePtr console)\n{\n    if (virSetBlocking(console->hostFd, false) < 0 ||\n        virSetBlocking(console->contFd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set console file descriptor non-blocking\"));\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to set console file descriptor non-blocking\")"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to set console file descriptor non-blocking\""
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetBlocking",
          "args": [
            "console->contFd",
            "false"
          ],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "virSetBlocking",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "113-121",
          "snippet": "int virSetBlocking(int fd, bool blocking)\n{\n    unsigned long arg = blocking ? 0 : 1;\n\n    if (ioctlsocket(fd, FIONBIO, &arg) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetBlocking(int fd, bool blocking)\n{\n    unsigned long arg = blocking ? 0 : 1;\n\n    if (ioctlsocket(fd, FIONBIO, &arg) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic int virLXCControllerConsoleSetNonblocking(virLXCControllerConsolePtr console)\n{\n    if (virSetBlocking(console->hostFd, false) < 0 ||\n        virSetBlocking(console->contFd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set console file descriptor non-blocking\"));\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerAddConsole",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "325-340",
    "snippet": "static int virLXCControllerAddConsole(virLXCControllerPtr ctrl,\n                                      int hostFd)\n{\n    if (VIR_EXPAND_N(ctrl->consoles, ctrl->nconsoles, 1) < 0)\n        return -1;\n    ctrl->consoles[ctrl->nconsoles-1].daemon = ctrl->daemon;\n    ctrl->consoles[ctrl->nconsoles-1].hostFd = hostFd;\n    ctrl->consoles[ctrl->nconsoles-1].hostWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].contFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].contWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].epollFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].epollWatch = -1;\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "ctrl->consoles",
            "ctrl->nconsoles",
            "1"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerAddConsole(virLXCControllerPtr ctrl,\n                                      int hostFd)\n{\n    if (VIR_EXPAND_N(ctrl->consoles, ctrl->nconsoles, 1) < 0)\n        return -1;\n    ctrl->consoles[ctrl->nconsoles-1].daemon = ctrl->daemon;\n    ctrl->consoles[ctrl->nconsoles-1].hostFd = hostFd;\n    ctrl->consoles[ctrl->nconsoles-1].hostWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].contFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].contWatch = -1;\n\n    ctrl->consoles[ctrl->nconsoles-1].epollFd = -1;\n    ctrl->consoles[ctrl->nconsoles-1].epollWatch = -1;\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "279-322",
    "snippet": "static void virLXCControllerFree(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    if (!ctrl)\n        return;\n\n    virLXCControllerStopInit(ctrl);\n\n    virObjectUnref(ctrl->securityManager);\n\n    for (i = 0; i < ctrl->nveths; i++)\n        VIR_FREE(ctrl->veths[i]);\n    VIR_FREE(ctrl->veths);\n    VIR_FREE(ctrl->nicindexes);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n    VIR_FREE(ctrl->passFDs);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n    VIR_FREE(ctrl->consoles);\n\n    VIR_FREE(ctrl->devptmx);\n\n    virDomainObjEndAPI(&ctrl->vm);\n    VIR_FREE(ctrl->name);\n\n    if (ctrl->timerShutdown != -1)\n        virEventRemoveTimeout(ctrl->timerShutdown);\n\n    virObjectUnref(ctrl->daemon);\n    virLXCControllerFreeFuse(ctrl);\n\n    VIR_FREE(ctrl->nbdpids);\n\n    VIR_FREE(ctrl->nsFDs);\n    virCgroupFree(&ctrl->cgroup);\n\n    /* This must always be the last thing to be closed */\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    VIR_FREE(ctrl);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ctrl->handshakeFd"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCgroupFree",
          "args": [
            "&ctrl->cgroup"
          ],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "3544-3563",
          "snippet": "void\nvirCgroupFree(virCgroupPtr *group)\n{\n    size_t i;\n\n    if (*group == NULL)\n        return;\n\n    for (i = 0; i < VIR_CGROUP_CONTROLLER_LAST; i++) {\n        VIR_FREE((*group)->legacy[i].mountPoint);\n        VIR_FREE((*group)->legacy[i].linkPoint);\n        VIR_FREE((*group)->legacy[i].placement);\n    }\n\n    VIR_FREE((*group)->unified.mountPoint);\n    VIR_FREE((*group)->unified.placement);\n\n    VIR_FREE((*group)->path);\n    VIR_FREE(*group);\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nvoid\nvirCgroupFree(virCgroupPtr *group)\n{\n    size_t i;\n\n    if (*group == NULL)\n        return;\n\n    for (i = 0; i < VIR_CGROUP_CONTROLLER_LAST; i++) {\n        VIR_FREE((*group)->legacy[i].mountPoint);\n        VIR_FREE((*group)->legacy[i].linkPoint);\n        VIR_FREE((*group)->legacy[i].placement);\n    }\n\n    VIR_FREE((*group)->unified.mountPoint);\n    VIR_FREE((*group)->unified.placement);\n\n    VIR_FREE((*group)->path);\n    VIR_FREE(*group);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->nsFDs"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->nbdpids"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerFreeFuse",
          "args": [
            "ctrl"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerFreeFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "272-276",
          "snippet": "static void\nvirLXCControllerFreeFuse(virLXCControllerPtr ctrl)\n{\n    return lxcFreeFuse(&ctrl->fuse);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void\nvirLXCControllerFreeFuse(virLXCControllerPtr ctrl)\n{\n    return lxcFreeFuse(&ctrl->fuse);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "ctrl->daemon"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virEventRemoveTimeout",
          "args": [
            "ctrl->timerShutdown"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "virEventRemoveTimeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "188-195",
          "snippet": "int\nvirEventRemoveTimeout(int timer)\n{\n    if (!removeTimeoutImpl)\n        return -1;\n\n    return removeTimeoutImpl(timer);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventRemoveTimeoutFunc removeTimeoutImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventRemoveTimeoutFunc removeTimeoutImpl;\n\nint\nvirEventRemoveTimeout(int timer)\n{\n    if (!removeTimeoutImpl)\n        return -1;\n\n    return removeTimeoutImpl(timer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->name"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainObjEndAPI",
          "args": [
            "&ctrl->vm"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "3640-3649",
          "snippet": "void\nvirDomainObjEndAPI(virDomainObjPtr *vm)\n{\n    if (!*vm)\n        return;\n\n    virObjectUnlock(*vm);\n    virObjectUnref(*vm);\n    *vm = NULL;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirDomainObjEndAPI(virDomainObjPtr *vm)\n{\n    if (!*vm)\n        return;\n\n    virObjectUnlock(*vm);\n    virObjectUnref(*vm);\n    *vm = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->devptmx"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->consoles"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerConsoleClose",
          "args": [
            "&(ctrl->consoles[i])"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerConsoleClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "256-269",
          "snippet": "static void virLXCControllerConsoleClose(virLXCControllerConsolePtr console)\n{\n    if (console->hostWatch != -1)\n        virEventRemoveHandle(console->hostWatch);\n    VIR_FORCE_CLOSE(console->hostFd);\n\n    if (console->contWatch != -1)\n        virEventRemoveHandle(console->contWatch);\n    VIR_FORCE_CLOSE(console->contFd);\n\n    if (console->epollWatch != -1)\n        virEventRemoveHandle(console->epollWatch);\n    VIR_FORCE_CLOSE(console->epollFd);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerConsoleClose(virLXCControllerConsolePtr console)\n{\n    if (console->hostWatch != -1)\n        virEventRemoveHandle(console->hostWatch);\n    VIR_FORCE_CLOSE(console->hostFd);\n\n    if (console->contWatch != -1)\n        virEventRemoveHandle(console->contWatch);\n    VIR_FORCE_CLOSE(console->contFd);\n\n    if (console->epollWatch != -1)\n        virEventRemoveHandle(console->epollWatch);\n    VIR_FORCE_CLOSE(console->epollFd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->passFDs"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ctrl->passFDs[i]"
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->nicindexes"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->veths"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ctrl->veths[i]"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCControllerStopInit",
          "args": [
            "ctrl"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerStopInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "245-253",
          "snippet": "static void virLXCControllerStopInit(virLXCControllerPtr ctrl)\n{\n    if (ctrl->initpid == 0)\n        return;\n\n    virLXCControllerCloseLoopDevices(ctrl);\n    virProcessAbort(ctrl->initpid);\n    ctrl->initpid = 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
            "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic void virLXCControllerStopInit(virLXCControllerPtr ctrl)\n{\n    if (ctrl->initpid == 0)\n        return;\n\n    virLXCControllerCloseLoopDevices(ctrl);\n    virProcessAbort(ctrl->initpid);\n    ctrl->initpid = 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    if (!ctrl)\n        return;\n\n    virLXCControllerStopInit(ctrl);\n\n    virObjectUnref(ctrl->securityManager);\n\n    for (i = 0; i < ctrl->nveths; i++)\n        VIR_FREE(ctrl->veths[i]);\n    VIR_FREE(ctrl->veths);\n    VIR_FREE(ctrl->nicindexes);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n    VIR_FREE(ctrl->passFDs);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n    VIR_FREE(ctrl->consoles);\n\n    VIR_FREE(ctrl->devptmx);\n\n    virDomainObjEndAPI(&ctrl->vm);\n    VIR_FREE(ctrl->name);\n\n    if (ctrl->timerShutdown != -1)\n        virEventRemoveTimeout(ctrl->timerShutdown);\n\n    virObjectUnref(ctrl->daemon);\n    virLXCControllerFreeFuse(ctrl);\n\n    VIR_FREE(ctrl->nbdpids);\n\n    VIR_FREE(ctrl->nsFDs);\n    virCgroupFree(&ctrl->cgroup);\n\n    /* This must always be the last thing to be closed */\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    VIR_FREE(ctrl);\n}"
  },
  {
    "function_name": "virLXCControllerFreeFuse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "272-276",
    "snippet": "static void\nvirLXCControllerFreeFuse(virLXCControllerPtr ctrl)\n{\n    return lxcFreeFuse(&ctrl->fuse);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcFreeFuse",
          "args": [
            "&ctrl->fuse"
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "lxcFreeFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_fuse.c",
          "lines": "375-377",
          "snippet": "void lxcFreeFuse(virLXCFusePtr *f G_GNUC_UNUSED)\n{\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_fuse.h\"",
            "#include <unistd.h>",
            "#include <mntent.h>",
            "#include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_fuse.h\"\n#include <unistd.h>\n#include <mntent.h>\n#include <sys/mount.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid lxcFreeFuse(virLXCFusePtr *f G_GNUC_UNUSED)\n{\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void\nvirLXCControllerFreeFuse(virLXCControllerPtr ctrl)\n{\n    return lxcFreeFuse(&ctrl->fuse);\n}"
  },
  {
    "function_name": "virLXCControllerConsoleClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "256-269",
    "snippet": "static void virLXCControllerConsoleClose(virLXCControllerConsolePtr console)\n{\n    if (console->hostWatch != -1)\n        virEventRemoveHandle(console->hostWatch);\n    VIR_FORCE_CLOSE(console->hostFd);\n\n    if (console->contWatch != -1)\n        virEventRemoveHandle(console->contWatch);\n    VIR_FORCE_CLOSE(console->contFd);\n\n    if (console->epollWatch != -1)\n        virEventRemoveHandle(console->epollWatch);\n    VIR_FORCE_CLOSE(console->epollFd);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "console->epollFd"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virEventRemoveHandle",
          "args": [
            "console->epollWatch"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "virEventRemoveHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "116-123",
          "snippet": "int\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventRemoveHandleFunc removeHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventRemoveHandleFunc removeHandleImpl;\n\nint\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "console->contFd"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "console->hostFd"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerConsoleClose(virLXCControllerConsolePtr console)\n{\n    if (console->hostWatch != -1)\n        virEventRemoveHandle(console->hostWatch);\n    VIR_FORCE_CLOSE(console->hostFd);\n\n    if (console->contWatch != -1)\n        virEventRemoveHandle(console->contWatch);\n    VIR_FORCE_CLOSE(console->contFd);\n\n    if (console->epollWatch != -1)\n        virEventRemoveHandle(console->epollWatch);\n    VIR_FORCE_CLOSE(console->epollFd);\n}"
  },
  {
    "function_name": "virLXCControllerStopInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "245-253",
    "snippet": "static void virLXCControllerStopInit(virLXCControllerPtr ctrl)\n{\n    if (ctrl->initpid == 0)\n        return;\n\n    virLXCControllerCloseLoopDevices(ctrl);\n    virProcessAbort(ctrl->initpid);\n    ctrl->initpid = 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);",
      "static int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virProcessAbort",
          "args": [
            "ctrl->initpid"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "288-293",
          "snippet": "void\nvirProcessAbort(pid_t pid)\n{\n    /* Not yet ported to mingw.  Any volunteers?  */\n    VIR_DEBUG(\"failed to reap child %lld, abandoning it\", (long long)pid);\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirProcessAbort(pid_t pid)\n{\n    /* Not yet ported to mingw.  Any volunteers?  */\n    VIR_DEBUG(\"failed to reap child %lld, abandoning it\", (long long)pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerCloseLoopDevices",
          "args": [
            "ctrl"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerCloseLoopDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "234-242",
          "snippet": "static int virLXCControllerCloseLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    for (i = 0; i < ctrl->nloopDevs; i++)\n        VIR_FORCE_CLOSE(ctrl->loopDevFds[i]);\n\n    return 0;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerCloseLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    for (i = 0; i < ctrl->nloopDevs; i++)\n        VIR_FORCE_CLOSE(ctrl->loopDevFds[i]);\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\nstatic int virLXCControllerEventSendInit(virLXCControllerPtr ctrl,\n                                         pid_t initpid);\n\nstatic void virLXCControllerStopInit(virLXCControllerPtr ctrl)\n{\n    if (ctrl->initpid == 0)\n        return;\n\n    virLXCControllerCloseLoopDevices(ctrl);\n    virProcessAbort(ctrl->initpid);\n    ctrl->initpid = 0;\n}"
  },
  {
    "function_name": "virLXCControllerCloseLoopDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "234-242",
    "snippet": "static int virLXCControllerCloseLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    for (i = 0; i < ctrl->nloopDevs; i++)\n        VIR_FORCE_CLOSE(ctrl->loopDevFds[i]);\n\n    return 0;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ctrl->loopDevFds[i]"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic int virLXCControllerCloseLoopDevices(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    for (i = 0; i < ctrl->nloopDevs; i++)\n        VIR_FORCE_CLOSE(ctrl->loopDevFds[i]);\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCControllerNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "190-231",
    "snippet": "static virLXCControllerPtr virLXCControllerNew(const char *name)\n{\n    virLXCControllerPtr ctrl = NULL;\n    virLXCDriverPtr driver = NULL;\n    char *configFile = NULL;\n\n    if (VIR_ALLOC(ctrl) < 0)\n        goto error;\n\n    ctrl->timerShutdown = -1;\n    ctrl->firstClient = true;\n\n    ctrl->name = g_strdup(name);\n\n    if (!(driver = virLXCControllerDriverNew()))\n        goto error;\n\n    if ((configFile = virDomainConfigFile(LXC_STATE_DIR,\n                                          ctrl->name)) == NULL)\n        goto error;\n\n    if ((ctrl->vm = virDomainObjParseFile(configFile,\n                                          driver->xmlopt,\n                                          0)) == NULL)\n        goto error;\n    ctrl->def = ctrl->vm->def;\n\n    if ((ctrl->timerShutdown = virEventAddTimeout(-1,\n                                                  virLXCControllerQuitTimer, ctrl,\n                                                  NULL)) < 0)\n        goto error;\n\n cleanup:\n    VIR_FREE(configFile);\n    virLXCControllerDriverFree(driver);\n    return ctrl;\n\n error:\n    virLXCControllerFree(ctrl);\n    ctrl = NULL;\n    goto cleanup;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLXCControllerFree",
          "args": [
            "ctrl"
          ],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "279-322",
          "snippet": "static void virLXCControllerFree(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    if (!ctrl)\n        return;\n\n    virLXCControllerStopInit(ctrl);\n\n    virObjectUnref(ctrl->securityManager);\n\n    for (i = 0; i < ctrl->nveths; i++)\n        VIR_FREE(ctrl->veths[i]);\n    VIR_FREE(ctrl->veths);\n    VIR_FREE(ctrl->nicindexes);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n    VIR_FREE(ctrl->passFDs);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n    VIR_FREE(ctrl->consoles);\n\n    VIR_FREE(ctrl->devptmx);\n\n    virDomainObjEndAPI(&ctrl->vm);\n    VIR_FREE(ctrl->name);\n\n    if (ctrl->timerShutdown != -1)\n        virEventRemoveTimeout(ctrl->timerShutdown);\n\n    virObjectUnref(ctrl->daemon);\n    virLXCControllerFreeFuse(ctrl);\n\n    VIR_FREE(ctrl->nbdpids);\n\n    VIR_FREE(ctrl->nsFDs);\n    virCgroupFree(&ctrl->cgroup);\n\n    /* This must always be the last thing to be closed */\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    VIR_FREE(ctrl);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl)\n{\n    size_t i;\n\n    if (!ctrl)\n        return;\n\n    virLXCControllerStopInit(ctrl);\n\n    virObjectUnref(ctrl->securityManager);\n\n    for (i = 0; i < ctrl->nveths; i++)\n        VIR_FREE(ctrl->veths[i]);\n    VIR_FREE(ctrl->veths);\n    VIR_FREE(ctrl->nicindexes);\n\n    for (i = 0; i < ctrl->npassFDs; i++)\n        VIR_FORCE_CLOSE(ctrl->passFDs[i]);\n    VIR_FREE(ctrl->passFDs);\n\n    for (i = 0; i < ctrl->nconsoles; i++)\n        virLXCControllerConsoleClose(&(ctrl->consoles[i]));\n    VIR_FREE(ctrl->consoles);\n\n    VIR_FREE(ctrl->devptmx);\n\n    virDomainObjEndAPI(&ctrl->vm);\n    VIR_FREE(ctrl->name);\n\n    if (ctrl->timerShutdown != -1)\n        virEventRemoveTimeout(ctrl->timerShutdown);\n\n    virObjectUnref(ctrl->daemon);\n    virLXCControllerFreeFuse(ctrl);\n\n    VIR_FREE(ctrl->nbdpids);\n\n    VIR_FREE(ctrl->nsFDs);\n    virCgroupFree(&ctrl->cgroup);\n\n    /* This must always be the last thing to be closed */\n    VIR_FORCE_CLOSE(ctrl->handshakeFd);\n    VIR_FREE(ctrl);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerDriverFree",
          "args": [
            "driver"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerDriverFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "178-187",
          "snippet": "static void\nvirLXCControllerDriverFree(virLXCDriverPtr driver)\n{\n    if (!driver)\n        return;\n    virObjectUnref(driver->xmlopt);\n    virObjectUnref(driver->caps);\n    virMutexDestroy(&driver->lock);\n    g_free(driver);\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex lock = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic void\nvirLXCControllerDriverFree(virLXCDriverPtr driver)\n{\n    if (!driver)\n        return;\n    virObjectUnref(driver->xmlopt);\n    virObjectUnref(driver->caps);\n    virMutexDestroy(&driver->lock);\n    g_free(driver);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "configFile"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virEventAddTimeout",
          "args": [
            "-1",
            "virLXCControllerQuitTimer",
            "ctrl",
            "NULL"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "virEventAddTimeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "143-153",
          "snippet": "int\nvirEventAddTimeout(int timeout,\n                   virEventTimeoutCallback cb,\n                   void *opaque,\n                   virFreeCallback ff)\n{\n    if (!addTimeoutImpl)\n        return -1;\n\n    return addTimeoutImpl(timeout, cb, opaque, ff);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventAddTimeoutFunc addTimeoutImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventAddTimeoutFunc addTimeoutImpl;\n\nint\nvirEventAddTimeout(int timeout,\n                   virEventTimeoutCallback cb,\n                   void *opaque,\n                   virFreeCallback ff)\n{\n    if (!addTimeoutImpl)\n        return -1;\n\n    return addTimeoutImpl(timeout, cb, opaque, ff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainObjParseFile",
          "args": [
            "configFile",
            "driver->xmlopt",
            "0"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainObjParseFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "22207-22224",
          "snippet": "virDomainObjPtr\nvirDomainObjParseFile(const char *filename,\n                      virDomainXMLOptionPtr xmlopt,\n                      unsigned int flags)\n{\n    xmlDocPtr xml;\n    virDomainObjPtr obj = NULL;\n    int keepBlanksDefault = xmlKeepBlanksDefault(0);\n\n    if ((xml = virXMLParseFile(filename))) {\n        obj = virDomainObjParseNode(xml, xmlDocGetRootElement(xml),\n                                    xmlopt, flags);\n        xmlFreeDoc(xml);\n    }\n\n    xmlKeepBlanksDefault(keepBlanksDefault);\n    return obj;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virDomainObjDispose(void *obj);",
            "static void virDomainXMLOptionDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void virDomainObjDispose(void *obj);\nstatic void virDomainXMLOptionDispose(void *obj);\n\nvirDomainObjPtr\nvirDomainObjParseFile(const char *filename,\n                      virDomainXMLOptionPtr xmlopt,\n                      unsigned int flags)\n{\n    xmlDocPtr xml;\n    virDomainObjPtr obj = NULL;\n    int keepBlanksDefault = xmlKeepBlanksDefault(0);\n\n    if ((xml = virXMLParseFile(filename))) {\n        obj = virDomainObjParseNode(xml, xmlDocGetRootElement(xml),\n                                    xmlopt, flags);\n        xmlFreeDoc(xml);\n    }\n\n    xmlKeepBlanksDefault(keepBlanksDefault);\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainConfigFile",
          "args": [
            "LXC_STATE_DIR",
            "ctrl->name"
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainConfigFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "29755-29763",
          "snippet": "char\n*virDomainConfigFile(const char *dir,\n                     const char *name)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%s/%s.xml\", dir, name);\n    return ret;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nchar\n*virDomainConfigFile(const char *dir,\n                     const char *name)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%s/%s.xml\", dir, name);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCControllerDriverNew",
          "args": [],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCControllerDriverNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
          "lines": "159-175",
          "snippet": "static virLXCDriverPtr\nvirLXCControllerDriverNew(void)\n{\n    virLXCDriverPtr driver = g_new0(virLXCDriver, 1);\n\n    if (virMutexInit(&driver->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"cannot initialize mutex\"));\n        g_free(driver);\n        return NULL;\n    }\n\n    driver->caps = virLXCDriverCapsInit(NULL);\n    driver->xmlopt = lxcDomainXMLConfInit(driver);\n\n    return driver;\n}",
          "includes": [
            "#include \"lxc_controller_dispatch.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnuma.h\"",
            "#include \"virprocess.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"vircommand.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"virnetdev.h\"",
            "#include \"lxc_fuse.h\"",
            "#include \"lxc_monitor_protocol.h\"",
            "#include \"lxc_cgroup.h\"",
            "#include \"lxc_container.h\"",
            "#include \"lxc_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <cap-ng.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <grp.h>",
            "#include <sys/mount.h>",
            "#include <getopt.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/personality.h>",
            "# include <sys/sysmacros.h>",
            "#include <sys/wait.h>",
            "#include <sys/epoll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex lock = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic virLXCDriverPtr\nvirLXCControllerDriverNew(void)\n{\n    virLXCDriverPtr driver = g_new0(virLXCDriver, 1);\n\n    if (virMutexInit(&driver->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"cannot initialize mutex\"));\n        g_free(driver);\n        return NULL;\n    }\n\n    driver->caps = virLXCDriverCapsInit(NULL);\n    driver->xmlopt = lxcDomainXMLConfInit(driver);\n\n    return driver;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "name"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "ctrl"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic virLXCControllerPtr virLXCControllerNew(const char *name)\n{\n    virLXCControllerPtr ctrl = NULL;\n    virLXCDriverPtr driver = NULL;\n    char *configFile = NULL;\n\n    if (VIR_ALLOC(ctrl) < 0)\n        goto error;\n\n    ctrl->timerShutdown = -1;\n    ctrl->firstClient = true;\n\n    ctrl->name = g_strdup(name);\n\n    if (!(driver = virLXCControllerDriverNew()))\n        goto error;\n\n    if ((configFile = virDomainConfigFile(LXC_STATE_DIR,\n                                          ctrl->name)) == NULL)\n        goto error;\n\n    if ((ctrl->vm = virDomainObjParseFile(configFile,\n                                          driver->xmlopt,\n                                          0)) == NULL)\n        goto error;\n    ctrl->def = ctrl->vm->def;\n\n    if ((ctrl->timerShutdown = virEventAddTimeout(-1,\n                                                  virLXCControllerQuitTimer, ctrl,\n                                                  NULL)) < 0)\n        goto error;\n\n cleanup:\n    VIR_FREE(configFile);\n    virLXCControllerDriverFree(driver);\n    return ctrl;\n\n error:\n    virLXCControllerFree(ctrl);\n    ctrl = NULL;\n    goto cleanup;\n}"
  },
  {
    "function_name": "virLXCControllerDriverFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "178-187",
    "snippet": "static void\nvirLXCControllerDriverFree(virLXCDriverPtr driver)\n{\n    if (!driver)\n        return;\n    virObjectUnref(driver->xmlopt);\n    virObjectUnref(driver->caps);\n    virMutexDestroy(&driver->lock);\n    g_free(driver);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex lock = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "driver"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&driver->lock"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "driver->caps"
          ],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic void\nvirLXCControllerDriverFree(virLXCDriverPtr driver)\n{\n    if (!driver)\n        return;\n    virObjectUnref(driver->xmlopt);\n    virObjectUnref(driver->caps);\n    virMutexDestroy(&driver->lock);\n    g_free(driver);\n}"
  },
  {
    "function_name": "virLXCControllerDriverNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "159-175",
    "snippet": "static virLXCDriverPtr\nvirLXCControllerDriverNew(void)\n{\n    virLXCDriverPtr driver = g_new0(virLXCDriver, 1);\n\n    if (virMutexInit(&driver->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"cannot initialize mutex\"));\n        g_free(driver);\n        return NULL;\n    }\n\n    driver->caps = virLXCDriverCapsInit(NULL);\n    driver->xmlopt = lxcDomainXMLConfInit(driver);\n\n    return driver;\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex lock = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcDomainXMLConfInit",
          "args": [
            "driver"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "lxcDomainXMLConfInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_conf.c",
          "lines": "216-224",
          "snippet": "virDomainXMLOptionPtr\nlxcDomainXMLConfInit(virLXCDriverPtr driver)\n{\n    virLXCDriverDomainDefParserConfig.priv = driver;\n    return virDomainXMLOptionNew(&virLXCDriverDomainDefParserConfig,\n                                 &virLXCDriverPrivateDataCallbacks,\n                                 &virLXCDriverDomainXMLNamespace,\n                                 NULL, NULL);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"lxc_container.h\"",
            "#include \"configmake.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virerror.h\"",
            "#include \"lxc_domain.h\"",
            "#include \"lxc_conf.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virnodesuspend.h\"\n#include \"lxc_container.h\"\n#include \"configmake.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virerror.h\"\n#include \"lxc_domain.h\"\n#include \"lxc_conf.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirDomainXMLOptionPtr\nlxcDomainXMLConfInit(virLXCDriverPtr driver)\n{\n    virLXCDriverDomainDefParserConfig.priv = driver;\n    return virDomainXMLOptionNew(&virLXCDriverDomainDefParserConfig,\n                                 &virLXCDriverPrivateDataCallbacks,\n                                 &virLXCDriverDomainXMLNamespace,\n                                 NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCDriverCapsInit",
          "args": [
            "NULL"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCDriverCapsInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_conf.c",
          "lines": "60-173",
          "snippet": "virCapsPtr virLXCDriverCapsInit(virLXCDriverPtr driver)\n{\n    virCapsPtr caps;\n    virCapsGuestPtr guest;\n    virArch altArch;\n    char *lxc_path = NULL;\n\n    if ((caps = virCapabilitiesNew(virArchFromHost(),\n                                   false, false)) == NULL)\n        goto error;\n\n    /* Some machines have problematic NUMA topology causing\n     * unexpected failures. We don't want to break the lxc\n     * driver in this scenario, so log errors & carry on\n     */\n    if (!(caps->host.numa = virCapabilitiesHostNUMANewHost()))\n        goto error;\n\n    if (virCapabilitiesInitCaches(caps) < 0)\n        VIR_WARN(\"Failed to get host CPU cache info\");\n\n    /* Only probe for power management capabilities in the driver,\n     * not in the emulator */\n    if (driver && virNodeSuspendGetTargetMask(&caps->host.powerMgmt) < 0)\n        VIR_WARN(\"Failed to get host power management capabilities\");\n\n    /* Add huge pages info */\n    if (virCapabilitiesInitPages(caps) < 0)\n        VIR_WARN(\"Failed to get pages info\");\n\n    if (virGetHostUUID(caps->host.host_uuid)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"cannot get the host uuid\"));\n        goto error;\n    }\n\n    if (!(lxc_path = virFileFindResource(\"libvirt_lxc\",\n                                         abs_top_builddir \"/src\",\n                                         LIBEXECDIR)))\n        goto error;\n\n    if ((guest = virCapabilitiesAddGuest(caps,\n                                         VIR_DOMAIN_OSTYPE_EXE,\n                                         caps->host.arch,\n                                         lxc_path,\n                                         NULL,\n                                         0,\n                                         NULL)) == NULL)\n        goto error;\n\n    if (virCapabilitiesAddGuestDomain(guest,\n                                      VIR_DOMAIN_VIRT_LXC,\n                                      NULL,\n                                      NULL,\n                                      0,\n                                      NULL) == NULL)\n        goto error;\n\n    /* On 64-bit hosts, we can use personality() to request a 32bit process */\n    if ((altArch = lxcContainerGetAlt32bitArch(caps->host.arch)) != VIR_ARCH_NONE) {\n        if ((guest = virCapabilitiesAddGuest(caps,\n                                             VIR_DOMAIN_OSTYPE_EXE,\n                                             altArch,\n                                             lxc_path,\n                                             NULL,\n                                             0,\n                                             NULL)) == NULL)\n            goto error;\n\n        if (virCapabilitiesAddGuestDomain(guest,\n                                          VIR_DOMAIN_VIRT_LXC,\n                                          NULL,\n                                          NULL,\n                                          0,\n                                          NULL) == NULL)\n            goto error;\n    }\n\n    VIR_FREE(lxc_path);\n\n    if (driver) {\n        /* Security driver data */\n        const char *doi, *model, *label, *type;\n\n        doi = virSecurityManagerGetDOI(driver->securityManager);\n        model = virSecurityManagerGetModel(driver->securityManager);\n        label = virSecurityManagerGetBaseLabel(driver->securityManager,\n                                               VIR_DOMAIN_VIRT_LXC);\n        type = virDomainVirtTypeToString(VIR_DOMAIN_VIRT_LXC);\n        /* Allocate the primary security driver for LXC. */\n        if (VIR_ALLOC(caps->host.secModels) < 0)\n            goto error;\n        caps->host.nsecModels = 1;\n        caps->host.secModels[0].model = g_strdup(model);\n        caps->host.secModels[0].doi = g_strdup(doi);\n        if (label &&\n            virCapabilitiesHostSecModelAddBaseLabel(&caps->host.secModels[0],\n                                                    type,\n                                                    label) < 0)\n            goto error;\n\n        VIR_DEBUG(\"Initialized caps for security driver \\\"%s\\\" with \"\n                  \"DOI \\\"%s\\\"\", model, doi);\n    } else {\n        VIR_INFO(\"No driver, not initializing security driver\");\n    }\n\n    return caps;\n\n error:\n    VIR_FREE(lxc_path);\n    virObjectUnref(caps);\n    return NULL;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"lxc_container.h\"",
            "#include \"configmake.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virerror.h\"",
            "#include \"lxc_domain.h\"",
            "#include \"lxc_conf.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virnodesuspend.h\"\n#include \"lxc_container.h\"\n#include \"configmake.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virerror.h\"\n#include \"lxc_domain.h\"\n#include \"lxc_conf.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirCapsPtr virLXCDriverCapsInit(virLXCDriverPtr driver)\n{\n    virCapsPtr caps;\n    virCapsGuestPtr guest;\n    virArch altArch;\n    char *lxc_path = NULL;\n\n    if ((caps = virCapabilitiesNew(virArchFromHost(),\n                                   false, false)) == NULL)\n        goto error;\n\n    /* Some machines have problematic NUMA topology causing\n     * unexpected failures. We don't want to break the lxc\n     * driver in this scenario, so log errors & carry on\n     */\n    if (!(caps->host.numa = virCapabilitiesHostNUMANewHost()))\n        goto error;\n\n    if (virCapabilitiesInitCaches(caps) < 0)\n        VIR_WARN(\"Failed to get host CPU cache info\");\n\n    /* Only probe for power management capabilities in the driver,\n     * not in the emulator */\n    if (driver && virNodeSuspendGetTargetMask(&caps->host.powerMgmt) < 0)\n        VIR_WARN(\"Failed to get host power management capabilities\");\n\n    /* Add huge pages info */\n    if (virCapabilitiesInitPages(caps) < 0)\n        VIR_WARN(\"Failed to get pages info\");\n\n    if (virGetHostUUID(caps->host.host_uuid)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"cannot get the host uuid\"));\n        goto error;\n    }\n\n    if (!(lxc_path = virFileFindResource(\"libvirt_lxc\",\n                                         abs_top_builddir \"/src\",\n                                         LIBEXECDIR)))\n        goto error;\n\n    if ((guest = virCapabilitiesAddGuest(caps,\n                                         VIR_DOMAIN_OSTYPE_EXE,\n                                         caps->host.arch,\n                                         lxc_path,\n                                         NULL,\n                                         0,\n                                         NULL)) == NULL)\n        goto error;\n\n    if (virCapabilitiesAddGuestDomain(guest,\n                                      VIR_DOMAIN_VIRT_LXC,\n                                      NULL,\n                                      NULL,\n                                      0,\n                                      NULL) == NULL)\n        goto error;\n\n    /* On 64-bit hosts, we can use personality() to request a 32bit process */\n    if ((altArch = lxcContainerGetAlt32bitArch(caps->host.arch)) != VIR_ARCH_NONE) {\n        if ((guest = virCapabilitiesAddGuest(caps,\n                                             VIR_DOMAIN_OSTYPE_EXE,\n                                             altArch,\n                                             lxc_path,\n                                             NULL,\n                                             0,\n                                             NULL)) == NULL)\n            goto error;\n\n        if (virCapabilitiesAddGuestDomain(guest,\n                                          VIR_DOMAIN_VIRT_LXC,\n                                          NULL,\n                                          NULL,\n                                          0,\n                                          NULL) == NULL)\n            goto error;\n    }\n\n    VIR_FREE(lxc_path);\n\n    if (driver) {\n        /* Security driver data */\n        const char *doi, *model, *label, *type;\n\n        doi = virSecurityManagerGetDOI(driver->securityManager);\n        model = virSecurityManagerGetModel(driver->securityManager);\n        label = virSecurityManagerGetBaseLabel(driver->securityManager,\n                                               VIR_DOMAIN_VIRT_LXC);\n        type = virDomainVirtTypeToString(VIR_DOMAIN_VIRT_LXC);\n        /* Allocate the primary security driver for LXC. */\n        if (VIR_ALLOC(caps->host.secModels) < 0)\n            goto error;\n        caps->host.nsecModels = 1;\n        caps->host.secModels[0].model = g_strdup(model);\n        caps->host.secModels[0].doi = g_strdup(doi);\n        if (label &&\n            virCapabilitiesHostSecModelAddBaseLabel(&caps->host.secModels[0],\n                                                    type,\n                                                    label) < 0)\n            goto error;\n\n        VIR_DEBUG(\"Initialized caps for security driver \\\"%s\\\" with \"\n                  \"DOI \\\"%s\\\"\", model, doi);\n    } else {\n        VIR_INFO(\"No driver, not initializing security driver\");\n    }\n\n    return caps;\n\n error:\n    VIR_FREE(lxc_path);\n    virObjectUnref(caps);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "driver"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"cannot initialize mutex\")"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot initialize mutex\""
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&driver->lock"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "virLXCDriver",
            "1"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic virMutex lock = VIR_MUTEX_INITIALIZER;\n\nstatic virLXCDriverPtr\nvirLXCControllerDriverNew(void)\n{\n    virLXCDriverPtr driver = g_new0(virLXCDriver, 1);\n\n    if (virMutexInit(&driver->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"cannot initialize mutex\"));\n        g_free(driver);\n        return NULL;\n    }\n\n    driver->caps = virLXCDriverCapsInit(NULL);\n    driver->xmlopt = lxcDomainXMLConfInit(driver);\n\n    return driver;\n}"
  },
  {
    "function_name": "virLXCControllerQuitTimer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_controller.c",
    "lines": "150-156",
    "snippet": "static void virLXCControllerQuitTimer(int timer G_GNUC_UNUSED, void *opaque)\n{\n    virLXCControllerPtr ctrl = opaque;\n\n    VIR_DEBUG(\"Triggering event loop quit\");\n    virNetDaemonQuit(ctrl->daemon);\n}",
    "includes": [
      "#include \"lxc_controller_dispatch.h\"",
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virdbus.h\"",
      "#include \"virnuma.h\"",
      "#include \"virprocess.h\"",
      "#include \"virrandom.h\"",
      "#include \"virhostcpu.h\"",
      "#include \"vircommand.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"virnetdev.h\"",
      "#include \"lxc_fuse.h\"",
      "#include \"lxc_monitor_protocol.h\"",
      "#include \"lxc_cgroup.h\"",
      "#include \"lxc_container.h\"",
      "#include \"lxc_conf.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <cap-ng.h>",
      "#include <time.h>",
      "#include <sys/stat.h>",
      "#include <grp.h>",
      "#include <sys/mount.h>",
      "#include <getopt.h>",
      "#include <signal.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/personality.h>",
      "# include <sys/sysmacros.h>",
      "#include <sys/wait.h>",
      "#include <sys/epoll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLXCControllerFree(virLXCControllerPtr ctrl);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "ctrl->daemon"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Triggering event loop quit\""
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxc_controller_dispatch.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virdbus.h\"\n#include \"virnuma.h\"\n#include \"virprocess.h\"\n#include \"virrandom.h\"\n#include \"virhostcpu.h\"\n#include \"vircommand.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include \"virnetdev.h\"\n#include \"lxc_fuse.h\"\n#include \"lxc_monitor_protocol.h\"\n#include \"lxc_cgroup.h\"\n#include \"lxc_container.h\"\n#include \"lxc_conf.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <cap-ng.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <grp.h>\n#include <sys/mount.h>\n#include <getopt.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/personality.h>\n# include <sys/sysmacros.h>\n#include <sys/wait.h>\n#include <sys/epoll.h>\n#include <config.h>\n\nstatic void virLXCControllerFree(virLXCControllerPtr ctrl);\n\nstatic void virLXCControllerQuitTimer(int timer G_GNUC_UNUSED, void *opaque)\n{\n    virLXCControllerPtr ctrl = opaque;\n\n    VIR_DEBUG(\"Triggering event loop quit\");\n    virNetDaemonQuit(ctrl->daemon);\n}"
  }
]