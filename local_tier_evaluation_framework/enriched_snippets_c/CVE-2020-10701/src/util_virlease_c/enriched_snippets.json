[
  {
    "function_name": "virLeaseNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlease.c",
    "lines": "202-261",
    "snippet": "int\nvirLeaseNew(virJSONValuePtr *lease_ret,\n            const char *mac,\n            const char *clientid,\n            const char *ip,\n            const char *hostname,\n            const char *iaid,\n            const char *server_duid)\n{\n    g_autoptr(virJSONValue) lease_new = NULL;\n    const char *exptime_tmp = getenv(\"DNSMASQ_LEASE_EXPIRES\");\n    long long expirytime = 0;\n    g_autofree char *exptime = NULL;\n\n    /* In case hostname is still unknown, use the last known one */\n    if (!hostname)\n        hostname = getenv(\"DNSMASQ_OLD_HOSTNAME\");\n\n    if (!mac)\n        return 0;\n\n    if (exptime_tmp) {\n        exptime = g_strdup(exptime_tmp);\n\n        /* Removed extraneous trailing space in DNSMASQ_LEASE_EXPIRES\n         * (dnsmasq < 2.52) */\n        if (exptime[strlen(exptime) - 1] == ' ')\n            exptime[strlen(exptime) - 1] = '\\0';\n    }\n\n    if (!exptime ||\n        virStrToLong_ll(exptime, NULL, 10, &expirytime) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to convert lease expiry time to long long: %s\"),\n                       NULLSTR(exptime));\n        return -1;\n    }\n\n    /* Create new lease */\n    lease_new = virJSONValueNewObject();\n\n    if (iaid && virJSONValueObjectAppendString(lease_new, \"iaid\", iaid) < 0)\n        return -1;\n    if (ip && virJSONValueObjectAppendString(lease_new, \"ip-address\", ip) < 0)\n        return -1;\n    if (mac && virJSONValueObjectAppendString(lease_new, \"mac-address\", mac) < 0)\n        return -1;\n    if (hostname && virJSONValueObjectAppendString(lease_new, \"hostname\", hostname) < 0)\n        return -1;\n    if (clientid && virJSONValueObjectAppendString(lease_new, \"client-id\", clientid) < 0)\n        return -1;\n    if (server_duid && virJSONValueObjectAppendString(lease_new, \"server-duid\", server_duid) < 0)\n        return -1;\n    if (expirytime && virJSONValueObjectAppendNumberLong(lease_new, \"expiry-time\", expirytime) < 0)\n        return -1;\n\n    *lease_ret = lease_new;\n    lease_new = NULL;\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include <time.h>",
      "#include \"virlease.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendNumberLong",
          "args": [
            "lease_new",
            "\"expiry-time\"",
            "expirytime"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendNumberLong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "693-706",
          "snippet": "int\nvirJSONValueObjectAppendNumberLong(virJSONValuePtr object,\n                                   const char *key,\n                                   long long number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberLong(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendNumberLong(virJSONValuePtr object,\n                                   const char *key,\n                                   long long number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberLong(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendString",
          "args": [
            "lease_new",
            "\"server-duid\"",
            "server_duid"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "643-649",
          "snippet": "int\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unable to convert lease expiry time to long long: %s\")",
            "NULLSTR(exptime)"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "exptime"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to convert lease expiry time to long long: %s\""
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToLong_ll",
          "args": [
            "exptime",
            "NULL",
            "10",
            "&expirytime"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_ll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "526-542",
          "snippet": "int\nvirStrToLong_ll(char const *s, char **end_ptr, int base, long long *result)\n{\n    long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoll(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_ll(char const *s, char **end_ptr, int base, long long *result)\n{\n    long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoll(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "exptime"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "exptime"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"DNSMASQ_OLD_HOSTNAME\""
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"DNSMASQ_LEASE_EXPIRES\""
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include <time.h>\n#include \"virlease.h\"\n#include <config.h>\n\nint\nvirLeaseNew(virJSONValuePtr *lease_ret,\n            const char *mac,\n            const char *clientid,\n            const char *ip,\n            const char *hostname,\n            const char *iaid,\n            const char *server_duid)\n{\n    g_autoptr(virJSONValue) lease_new = NULL;\n    const char *exptime_tmp = getenv(\"DNSMASQ_LEASE_EXPIRES\");\n    long long expirytime = 0;\n    g_autofree char *exptime = NULL;\n\n    /* In case hostname is still unknown, use the last known one */\n    if (!hostname)\n        hostname = getenv(\"DNSMASQ_OLD_HOSTNAME\");\n\n    if (!mac)\n        return 0;\n\n    if (exptime_tmp) {\n        exptime = g_strdup(exptime_tmp);\n\n        /* Removed extraneous trailing space in DNSMASQ_LEASE_EXPIRES\n         * (dnsmasq < 2.52) */\n        if (exptime[strlen(exptime) - 1] == ' ')\n            exptime[strlen(exptime) - 1] = '\\0';\n    }\n\n    if (!exptime ||\n        virStrToLong_ll(exptime, NULL, 10, &expirytime) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to convert lease expiry time to long long: %s\"),\n                       NULLSTR(exptime));\n        return -1;\n    }\n\n    /* Create new lease */\n    lease_new = virJSONValueNewObject();\n\n    if (iaid && virJSONValueObjectAppendString(lease_new, \"iaid\", iaid) < 0)\n        return -1;\n    if (ip && virJSONValueObjectAppendString(lease_new, \"ip-address\", ip) < 0)\n        return -1;\n    if (mac && virJSONValueObjectAppendString(lease_new, \"mac-address\", mac) < 0)\n        return -1;\n    if (hostname && virJSONValueObjectAppendString(lease_new, \"hostname\", hostname) < 0)\n        return -1;\n    if (clientid && virJSONValueObjectAppendString(lease_new, \"client-id\", clientid) < 0)\n        return -1;\n    if (server_duid && virJSONValueObjectAppendString(lease_new, \"server-duid\", server_duid) < 0)\n        return -1;\n    if (expirytime && virJSONValueObjectAppendNumberLong(lease_new, \"expiry-time\", expirytime) < 0)\n        return -1;\n\n    *lease_ret = lease_new;\n    lease_new = NULL;\n    return 0;\n}"
  },
  {
    "function_name": "virLeasePrintLeases",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlease.c",
    "lines": "134-199",
    "snippet": "int\nvirLeasePrintLeases(virJSONValuePtr leases_array_new,\n                    const char *server_duid)\n{\n    virJSONValuePtr lease_tmp = NULL;\n    const char *ip_tmp = NULL;\n    long long expirytime = 0;\n    size_t i;\n\n    /* Man page of dnsmasq says: the script (helper program, in our case)\n     * should write the saved state of the lease database, in dnsmasq\n     * leasefile format, to stdout and exit with zero exit code, when\n     * called with argument init. Format:\n     * $expirytime $mac $ip $hostname $clientid # For all ipv4 leases\n     * duid $server-duid # If DHCPv6 is present\n     * $expirytime $iaid $ip $hostname $clientduid # For all ipv6 leases */\n\n    /* Traversing the ipv4 leases */\n    for (i = 0; i < virJSONValueArraySize(leases_array_new); i++) {\n        lease_tmp = virJSONValueArrayGet(leases_array_new, i);\n        if (!(ip_tmp = virJSONValueObjectGetString(lease_tmp, \"ip-address\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to parse json\"));\n            return -1;\n        }\n        if (!strchr(ip_tmp, ':')) {\n            if (virJSONValueObjectGetNumberLong(lease_tmp, \"expiry-time\",\n                                                &expirytime) < 0)\n                continue;\n\n            printf(\"%lld %s %s %s %s\\n\",\n                   expirytime,\n                   virJSONValueObjectGetString(lease_tmp, \"mac-address\"),\n                   virJSONValueObjectGetString(lease_tmp, \"ip-address\"),\n                   NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"hostname\")),\n                   NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"client-id\")));\n        }\n    }\n\n    /* Traversing the ipv6 leases */\n    if (server_duid) {\n        printf(\"duid %s\\n\", server_duid);\n        for (i = 0; i < virJSONValueArraySize(leases_array_new); i++) {\n            lease_tmp = virJSONValueArrayGet(leases_array_new, i);\n            if (!(ip_tmp = virJSONValueObjectGetString(lease_tmp, \"ip-address\"))) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"failed to parse json\"));\n                return -1;\n            }\n            if (strchr(ip_tmp, ':')) {\n                if (virJSONValueObjectGetNumberLong(lease_tmp, \"expiry-time\",\n                                                    &expirytime) < 0)\n                    continue;\n\n                printf(\"%lld %s %s %s %s\\n\",\n                       expirytime,\n                       virJSONValueObjectGetString(lease_tmp, \"iaid\"),\n                       virJSONValueObjectGetString(lease_tmp, \"ip-address\"),\n                       NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"hostname\")),\n                       NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"client-id\")));\n            }\n        }\n    }\n\n    return  0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include <time.h>",
      "#include \"virlease.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%lld %s %s %s %s\\n\"",
            "expirytime",
            "virJSONValueObjectGetString(lease_tmp, \"iaid\")",
            "virJSONValueObjectGetString(lease_tmp, \"ip-address\")",
            "NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"hostname\"))",
            "NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"client-id\"))"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR_STAR",
          "args": [
            "virJSONValueObjectGetString(lease_tmp, \"client-id\")"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "lease_tmp",
            "\"client-id\""
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR_STAR",
          "args": [
            "virJSONValueObjectGetString(lease_tmp, \"hostname\")"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberLong",
          "args": [
            "lease_tmp",
            "\"expiry-time\"",
            "&expirytime"
          ],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberLong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1359-1370",
          "snippet": "int\nvirJSONValueObjectGetNumberLong(virJSONValuePtr object,\n                                const char *key,\n                                long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberLong(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberLong(virJSONValuePtr object,\n                                const char *key,\n                                long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberLong(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "ip_tmp",
            "':'"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed to parse json\")"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "leases_array_new",
            "i"
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "leases_array_new"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"duid %s\\n\"",
            "server_duid"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_vprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "205-213",
          "snippet": "char *\nvir_g_strdup_vprintf(const char *msg, va_list args)\n{\n    char *ret;\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_vprintf(const char *msg, va_list args)\n{\n    char *ret;\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR_STAR",
          "args": [
            "virJSONValueObjectGetString(lease_tmp, \"client-id\")"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR_STAR",
          "args": [
            "virJSONValueObjectGetString(lease_tmp, \"hostname\")"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "ip_tmp",
            "':'"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed to parse json\")"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include <time.h>\n#include \"virlease.h\"\n#include <config.h>\n\nint\nvirLeasePrintLeases(virJSONValuePtr leases_array_new,\n                    const char *server_duid)\n{\n    virJSONValuePtr lease_tmp = NULL;\n    const char *ip_tmp = NULL;\n    long long expirytime = 0;\n    size_t i;\n\n    /* Man page of dnsmasq says: the script (helper program, in our case)\n     * should write the saved state of the lease database, in dnsmasq\n     * leasefile format, to stdout and exit with zero exit code, when\n     * called with argument init. Format:\n     * $expirytime $mac $ip $hostname $clientid # For all ipv4 leases\n     * duid $server-duid # If DHCPv6 is present\n     * $expirytime $iaid $ip $hostname $clientduid # For all ipv6 leases */\n\n    /* Traversing the ipv4 leases */\n    for (i = 0; i < virJSONValueArraySize(leases_array_new); i++) {\n        lease_tmp = virJSONValueArrayGet(leases_array_new, i);\n        if (!(ip_tmp = virJSONValueObjectGetString(lease_tmp, \"ip-address\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to parse json\"));\n            return -1;\n        }\n        if (!strchr(ip_tmp, ':')) {\n            if (virJSONValueObjectGetNumberLong(lease_tmp, \"expiry-time\",\n                                                &expirytime) < 0)\n                continue;\n\n            printf(\"%lld %s %s %s %s\\n\",\n                   expirytime,\n                   virJSONValueObjectGetString(lease_tmp, \"mac-address\"),\n                   virJSONValueObjectGetString(lease_tmp, \"ip-address\"),\n                   NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"hostname\")),\n                   NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"client-id\")));\n        }\n    }\n\n    /* Traversing the ipv6 leases */\n    if (server_duid) {\n        printf(\"duid %s\\n\", server_duid);\n        for (i = 0; i < virJSONValueArraySize(leases_array_new); i++) {\n            lease_tmp = virJSONValueArrayGet(leases_array_new, i);\n            if (!(ip_tmp = virJSONValueObjectGetString(lease_tmp, \"ip-address\"))) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"failed to parse json\"));\n                return -1;\n            }\n            if (strchr(ip_tmp, ':')) {\n                if (virJSONValueObjectGetNumberLong(lease_tmp, \"expiry-time\",\n                                                    &expirytime) < 0)\n                    continue;\n\n                printf(\"%lld %s %s %s %s\\n\",\n                       expirytime,\n                       virJSONValueObjectGetString(lease_tmp, \"iaid\"),\n                       virJSONValueObjectGetString(lease_tmp, \"ip-address\"),\n                       NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"hostname\")),\n                       NULLSTR_STAR(virJSONValueObjectGetString(lease_tmp, \"client-id\")));\n            }\n        }\n    }\n\n    return  0;\n}"
  },
  {
    "function_name": "virLeaseReadCustomLeaseFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlease.c",
    "lines": "45-131",
    "snippet": "int\nvirLeaseReadCustomLeaseFile(virJSONValuePtr leases_array_new,\n                            const char *custom_lease_file,\n                            const char *ip_to_delete,\n                            char **server_duid)\n{\n    g_autofree char *lease_entries = NULL;\n    g_autoptr(virJSONValue) leases_array = NULL;\n    long long expirytime;\n    int custom_lease_file_len = 0;\n    virJSONValuePtr lease_tmp = NULL;\n    const char *ip_tmp = NULL;\n    const char *server_duid_tmp = NULL;\n    size_t i;\n\n    /* Read entire contents */\n    if ((custom_lease_file_len = virFileReadAll(custom_lease_file,\n                                                VIR_NETWORK_DHCP_LEASE_FILE_SIZE_MAX,\n                                                &lease_entries)) < 0) {\n        return -1;\n    }\n\n    /* Check for previous leases */\n    if (custom_lease_file_len == 0)\n        return 0;\n\n    if (!(leases_array = virJSONValueFromString(lease_entries))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid json in file: %s, rewriting it\"),\n                       custom_lease_file);\n        return 0;\n    }\n\n    if (!virJSONValueIsArray(leases_array)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"couldn't fetch array of leases\"));\n        return -1;\n    }\n\n    i = 0;\n    while (i < virJSONValueArraySize(leases_array)) {\n        if (!(lease_tmp = virJSONValueArrayGet(leases_array, i))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to parse json\"));\n            return -1;\n        }\n\n        if (!(ip_tmp = virJSONValueObjectGetString(lease_tmp, \"ip-address\")) ||\n            (virJSONValueObjectGetNumberLong(lease_tmp, \"expiry-time\", &expirytime) < 0)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to parse json\"));\n            return -1;\n        }\n\n        /* Check whether lease has to be included or not */\n        if (ip_to_delete && STREQ(ip_tmp, ip_to_delete)) {\n            i++;\n            continue;\n        }\n\n        if (server_duid && strchr(ip_tmp, ':')) {\n            /* This is an ipv6 lease */\n            if ((server_duid_tmp\n                 = virJSONValueObjectGetString(lease_tmp, \"server-duid\"))) {\n                if (!*server_duid)\n                    *server_duid = g_strdup(server_duid_tmp);\n            } else {\n                /* Inject server-duid into those ipv6 leases which\n                 * didn't have it previously, for example, those\n                 * created by leaseshelper from libvirt 1.2.6 */\n                if (virJSONValueObjectAppendString(lease_tmp, \"server-duid\", *server_duid) < 0)\n                    return -1;\n            }\n        }\n\n        /* Move old lease to new array */\n        if (virJSONValueArrayAppend(leases_array_new, lease_tmp) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to create json\"));\n            return -1;\n        }\n\n        ignore_value(virJSONValueArraySteal(leases_array, i));\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include <time.h>",
      "#include \"virlease.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_NETWORK_DHCP_LEASE_FILE_SIZE_MAX (32 * 1024 * 1024)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virJSONValueArraySteal(leases_array, i)"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySteal",
          "args": [
            "leases_array",
            "i"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1038-1057",
          "snippet": "virJSONValuePtr\nvirJSONValueArraySteal(virJSONValuePtr array,\n                       unsigned int element)\n{\n    virJSONValuePtr ret = NULL;\n\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    ret = array->data.array.values[element];\n\n    VIR_DELETE_ELEMENT(array->data.array.values,\n                       element,\n                       array->data.array.nvalues);\n\n    return ret;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArraySteal(virJSONValuePtr array,\n                       unsigned int element)\n{\n    virJSONValuePtr ret = NULL;\n\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    ret = array->data.array.values[element];\n\n    VIR_DELETE_ELEMENT(array->data.array.values,\n                       element,\n                       array->data.array.nvalues);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed to create json\")"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to create json\""
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayAppend",
          "args": [
            "leases_array_new",
            "lease_tmp"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "792-804",
          "snippet": "int\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendString",
          "args": [
            "lease_tmp",
            "\"server-duid\"",
            "*server_duid"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "643-649",
          "snippet": "int\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "lease_tmp",
            "\"server-duid\""
          ],
          "line": 108
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "ip_tmp",
            "':'"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "ip_tmp",
            "ip_to_delete"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed to parse json\")"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberLong",
          "args": [
            "lease_tmp",
            "\"expiry-time\"",
            "&expirytime"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberLong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1359-1370",
          "snippet": "int\nvirJSONValueObjectGetNumberLong(virJSONValuePtr object,\n                                const char *key,\n                                long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberLong(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberLong(virJSONValuePtr object,\n                                const char *key,\n                                long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberLong(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed to parse json\")"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "leases_array",
            "i"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "leases_array"
          ],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"couldn't fetch array of leases\")"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "leases_array"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"invalid json in file: %s, rewriting it\")",
            "custom_lease_file"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueFromString",
          "args": [
            "lease_entries"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFromString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1993-1999",
          "snippet": "virJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "custom_lease_file",
            "VIR_NETWORK_DHCP_LEASE_FILE_SIZE_MAX",
            "&lease_entries"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include <time.h>\n#include \"virlease.h\"\n#include <config.h>\n\n#define VIR_NETWORK_DHCP_LEASE_FILE_SIZE_MAX (32 * 1024 * 1024)\n\nint\nvirLeaseReadCustomLeaseFile(virJSONValuePtr leases_array_new,\n                            const char *custom_lease_file,\n                            const char *ip_to_delete,\n                            char **server_duid)\n{\n    g_autofree char *lease_entries = NULL;\n    g_autoptr(virJSONValue) leases_array = NULL;\n    long long expirytime;\n    int custom_lease_file_len = 0;\n    virJSONValuePtr lease_tmp = NULL;\n    const char *ip_tmp = NULL;\n    const char *server_duid_tmp = NULL;\n    size_t i;\n\n    /* Read entire contents */\n    if ((custom_lease_file_len = virFileReadAll(custom_lease_file,\n                                                VIR_NETWORK_DHCP_LEASE_FILE_SIZE_MAX,\n                                                &lease_entries)) < 0) {\n        return -1;\n    }\n\n    /* Check for previous leases */\n    if (custom_lease_file_len == 0)\n        return 0;\n\n    if (!(leases_array = virJSONValueFromString(lease_entries))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid json in file: %s, rewriting it\"),\n                       custom_lease_file);\n        return 0;\n    }\n\n    if (!virJSONValueIsArray(leases_array)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"couldn't fetch array of leases\"));\n        return -1;\n    }\n\n    i = 0;\n    while (i < virJSONValueArraySize(leases_array)) {\n        if (!(lease_tmp = virJSONValueArrayGet(leases_array, i))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to parse json\"));\n            return -1;\n        }\n\n        if (!(ip_tmp = virJSONValueObjectGetString(lease_tmp, \"ip-address\")) ||\n            (virJSONValueObjectGetNumberLong(lease_tmp, \"expiry-time\", &expirytime) < 0)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to parse json\"));\n            return -1;\n        }\n\n        /* Check whether lease has to be included or not */\n        if (ip_to_delete && STREQ(ip_tmp, ip_to_delete)) {\n            i++;\n            continue;\n        }\n\n        if (server_duid && strchr(ip_tmp, ':')) {\n            /* This is an ipv6 lease */\n            if ((server_duid_tmp\n                 = virJSONValueObjectGetString(lease_tmp, \"server-duid\"))) {\n                if (!*server_duid)\n                    *server_duid = g_strdup(server_duid_tmp);\n            } else {\n                /* Inject server-duid into those ipv6 leases which\n                 * didn't have it previously, for example, those\n                 * created by leaseshelper from libvirt 1.2.6 */\n                if (virJSONValueObjectAppendString(lease_tmp, \"server-duid\", *server_duid) < 0)\n                    return -1;\n            }\n        }\n\n        /* Move old lease to new array */\n        if (virJSONValueArrayAppend(leases_array_new, lease_tmp) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to create json\"));\n            return -1;\n        }\n\n        ignore_value(virJSONValueArraySteal(leases_array, i));\n    }\n\n    return 0;\n}"
  }
]