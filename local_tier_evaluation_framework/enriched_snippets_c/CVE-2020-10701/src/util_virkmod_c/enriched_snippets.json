[
  {
    "function_name": "virKModIsBlacklisted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
    "lines": "145-166",
    "snippet": "bool\nvirKModIsBlacklisted(const char *module)\n{\n    size_t i;\n    g_autofree char *drvblklst = NULL;\n    g_autofree char *outbuf = NULL;\n\n    drvblklst = g_strdup_printf(\"blacklist %s\\n\", module);\n\n    /* modprobe will convert all '-' into '_', so we need to as well */\n    for (i = 0; i < drvblklst[i]; i++)\n        if (drvblklst[i] == '-')\n            drvblklst[i] = '_';\n\n    if (doModprobe(\"-c\", NULL, &outbuf, NULL) < 0)\n        return false;\n\n    if (strstr(outbuf, drvblklst))\n        return true;\n\n    return false;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "outbuf",
            "drvblklst"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "doModprobe",
          "args": [
            "\"-c\"",
            "NULL",
            "&outbuf",
            "NULL"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "doModprobe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
          "lines": "28-47",
          "snippet": "static int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"blacklist %s\\n\"",
            "module"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nbool\nvirKModIsBlacklisted(const char *module)\n{\n    size_t i;\n    g_autofree char *drvblklst = NULL;\n    g_autofree char *outbuf = NULL;\n\n    drvblklst = g_strdup_printf(\"blacklist %s\\n\", module);\n\n    /* modprobe will convert all '-' into '_', so we need to as well */\n    for (i = 0; i < drvblklst[i]; i++)\n        if (drvblklst[i] == '-')\n            drvblklst[i] = '_';\n\n    if (doModprobe(\"-c\", NULL, &outbuf, NULL) < 0)\n        return false;\n\n    if (strstr(outbuf, drvblklst))\n        return true;\n\n    return false;\n}"
  },
  {
    "function_name": "virKModUnload",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
    "lines": "123-133",
    "snippet": "char *\nvirKModUnload(const char *module)\n{\n    char *errbuf = NULL;\n\n    if (doRmmod(module, &errbuf) < 0)\n        return errbuf;\n\n    VIR_FREE(errbuf);\n    return NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "errbuf"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "doRmmod",
          "args": [
            "module",
            "&errbuf"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "doRmmod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
          "lines": "49-61",
          "snippet": "static int\ndoRmmod(const char *module, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(RMMOD, module, NULL);\n    virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ndoRmmod(const char *module, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(RMMOD, module, NULL);\n    virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nchar *\nvirKModUnload(const char *module)\n{\n    char *errbuf = NULL;\n\n    if (doRmmod(module, &errbuf) < 0)\n        return errbuf;\n\n    VIR_FREE(errbuf);\n    return NULL;\n}"
  },
  {
    "function_name": "virKModLoad",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
    "lines": "94-104",
    "snippet": "char *\nvirKModLoad(const char *module, bool useBlacklist)\n{\n    char *errbuf = NULL;\n\n    if (doModprobe(useBlacklist ? \"-b\" : NULL, module, NULL, &errbuf) < 0)\n        return errbuf;\n\n    VIR_FREE(errbuf);\n    return NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "errbuf"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "doModprobe",
          "args": [
            "useBlacklist ? \"-b\" : NULL",
            "module",
            "NULL",
            "&errbuf"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "doModprobe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
          "lines": "28-47",
          "snippet": "static int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nchar *\nvirKModLoad(const char *module, bool useBlacklist)\n{\n    char *errbuf = NULL;\n\n    if (doModprobe(useBlacklist ? \"-b\" : NULL, module, NULL, &errbuf) < 0)\n        return errbuf;\n\n    VIR_FREE(errbuf);\n    return NULL;\n}"
  },
  {
    "function_name": "virKModConfig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
    "lines": "71-80",
    "snippet": "char *\nvirKModConfig(void)\n{\n    char *outbuf = NULL;\n\n    if (doModprobe(\"-c\", NULL, &outbuf, NULL) < 0)\n        return NULL;\n\n    return outbuf;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "doModprobe",
          "args": [
            "\"-c\"",
            "NULL",
            "&outbuf",
            "NULL"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "doModprobe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
          "lines": "28-47",
          "snippet": "static int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nchar *\nvirKModConfig(void)\n{\n    char *outbuf = NULL;\n\n    if (doModprobe(\"-c\", NULL, &outbuf, NULL) < 0)\n        return NULL;\n\n    return outbuf;\n}"
  },
  {
    "function_name": "doRmmod",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
    "lines": "49-61",
    "snippet": "static int\ndoRmmod(const char *module, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(RMMOD, module, NULL);\n    virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorBuffer",
          "args": [
            "cmd",
            "errbuf"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1903-1918",
          "snippet": "void\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "RMMOD",
            "module",
            "NULL"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ndoRmmod(const char *module, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(RMMOD, module, NULL);\n    virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "doModprobe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virkmod.c",
    "lines": "28-47",
    "snippet": "static int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorBuffer",
          "args": [
            "cmd",
            "errbuf"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1903-1918",
          "snippet": "void\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetOutputBuffer",
          "args": [
            "cmd",
            "outbuf"
          ],
          "line": 39
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetOutputBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1869-1884",
          "snippet": "void\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "cmd",
            "module"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "MODPROBE"
          ],
          "line": 33
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ndoModprobe(const char *opts, const char *module, char **outbuf, char **errbuf)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(MODPROBE);\n    if (opts)\n        virCommandAddArg(cmd, opts);\n    if (module)\n        virCommandAddArg(cmd, module);\n    if (outbuf)\n        virCommandSetOutputBuffer(cmd, outbuf);\n    if (errbuf)\n        virCommandSetErrorBuffer(cmd, errbuf);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
  }
]