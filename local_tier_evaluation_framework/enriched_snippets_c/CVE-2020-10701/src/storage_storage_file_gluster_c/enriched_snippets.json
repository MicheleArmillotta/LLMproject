[
  {
    "function_name": "virStorageFileGlusterRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "353-360",
    "snippet": "int\nvirStorageFileGlusterRegister(void)\n{\n    if (virStorageFileBackendRegister(&virStorageFileBackendGluster) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageFileBackend virStorageFileBackendGluster = {\n    .type = VIR_STORAGE_TYPE_NETWORK,\n    .protocol = VIR_STORAGE_NET_PROTOCOL_GLUSTER,\n\n    .backendInit = virStorageFileBackendGlusterInit,\n    .backendDeinit = virStorageFileBackendGlusterDeinit,\n\n    .storageFileCreate = virStorageFileBackendGlusterCreate,\n    .storageFileUnlink = virStorageFileBackendGlusterUnlink,\n    .storageFileStat = virStorageFileBackendGlusterStat,\n    .storageFileRead = virStorageFileBackendGlusterRead,\n    .storageFileAccess = virStorageFileBackendGlusterAccess,\n    .storageFileChown = virStorageFileBackendGlusterChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendGlusterGetUniqueIdentifier,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageFileBackendRegister",
          "args": [
            "&virStorageFileBackendGluster"
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageFileBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefilebackend.c",
          "lines": "88-106",
          "snippet": "int\nvirStorageFileBackendRegister(virStorageFileBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage file backend '%s' protocol '%s'\",\n              virStorageTypeToString(backend->type),\n              virStorageNetProtocolTypeToString(backend->protocol));\n\n    if (virStorageFileBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage file \"\n                         \"backend '%s'\"),\n                       virStorageTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageFileBackends[virStorageFileBackendsCount] = backend;\n    virStorageFileBackendsCount++;\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virstoragefilebackend.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageFileBackendPtr virStorageFileBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageFileBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virstoragefilebackend.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageFileBackendPtr virStorageFileBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageFileBackendsCount;\n\nint\nvirStorageFileBackendRegister(virStorageFileBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage file backend '%s' protocol '%s'\",\n              virStorageTypeToString(backend->type),\n              virStorageNetProtocolTypeToString(backend->protocol));\n\n    if (virStorageFileBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage file \"\n                         \"backend '%s'\"),\n                       virStorageTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageFileBackends[virStorageFileBackendsCount] = backend;\n    virStorageFileBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nvirStorageFileBackend virStorageFileBackendGluster = {\n    .type = VIR_STORAGE_TYPE_NETWORK,\n    .protocol = VIR_STORAGE_NET_PROTOCOL_GLUSTER,\n\n    .backendInit = virStorageFileBackendGlusterInit,\n    .backendDeinit = virStorageFileBackendGlusterDeinit,\n\n    .storageFileCreate = virStorageFileBackendGlusterCreate,\n    .storageFileUnlink = virStorageFileBackendGlusterUnlink,\n    .storageFileStat = virStorageFileBackendGlusterStat,\n    .storageFileRead = virStorageFileBackendGlusterRead,\n    .storageFileAccess = virStorageFileBackendGlusterAccess,\n    .storageFileChown = virStorageFileBackendGlusterChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendGlusterGetUniqueIdentifier,\n};\n\nint\nvirStorageFileGlusterRegister(void)\n{\n    if (virStorageFileBackendRegister(&virStorageFileBackendGluster) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterChown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "324-332",
    "snippet": "static int\nvirStorageFileBackendGlusterChown(const virStorageSource *src,\n                                  uid_t uid,\n                                  gid_t gid)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_chown(priv->vol, src->path, uid, gid);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "glfs_chown",
          "args": [
            "priv->vol",
            "src->path",
            "uid",
            "gid"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterChown(const virStorageSource *src,\n                                  uid_t uid,\n                                  gid_t gid)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_chown(priv->vol, src->path, uid, gid);\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterGetUniqueIdentifier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "300-321",
    "snippet": "static const char *\nvirStorageFileBackendGlusterGetUniqueIdentifier(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n    g_autofree char *filePath = NULL;\n\n    if (priv->canonpath)\n        return priv->canonpath;\n\n    if (!(filePath = virStorageFileCanonicalizePath(src->path,\n                                                    virStorageFileBackendGlusterReadlinkCallback,\n                                                    priv)))\n        return NULL;\n\n    priv->canonpath = g_strdup_printf(\"gluster://%s:%u/%s/%s\",\n                                      src->hosts->name,\n                                      src->hosts->port,\n                                      src->volume,\n                                      filePath);\n\n    return priv->canonpath;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"gluster://%s:%u/%s/%s\"",
            "src->hosts->name",
            "src->hosts->port",
            "src->volume",
            "filePath"
          ],
          "line": 314
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageFileCanonicalizePath",
          "args": [
            "src->path",
            "virStorageFileBackendGlusterReadlinkCallback",
            "priv"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageFileCanonicalizePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefile.c",
          "lines": "4282-4428",
          "snippet": "char *\nvirStorageFileCanonicalizePath(const char *path,\n                               virStorageFileSimplifyPathReadlinkCallback cb,\n                               void *cbdata)\n{\n    virHashTablePtr cycle = NULL;\n    bool beginSlash = false;\n    bool beginDoubleSlash = false;\n    char **components = NULL;\n    size_t ncomponents = 0;\n    size_t i = 0;\n    size_t j = 0;\n    int rc;\n    char *ret = NULL;\n    g_autofree char *linkpath = NULL;\n    g_autofree char *currentpath = NULL;\n\n    if (path[0] == '/') {\n        beginSlash = true;\n\n        if (path[1] == '/' && path[2] != '/')\n            beginDoubleSlash = true;\n    }\n\n    if (!(cycle = virHashCreate(10, NULL)))\n        goto cleanup;\n\n    if (!(components = virStringSplitCount(path, \"/\", 0, &ncomponents)))\n        goto cleanup;\n\n    j = 0;\n    while (j < ncomponents) {\n        /* skip slashes */\n        if (STREQ(components[j], \"\")) {\n            VIR_FREE(components[j]);\n            VIR_DELETE_ELEMENT(components, j, ncomponents);\n            continue;\n        }\n        j++;\n    }\n\n    while (i < ncomponents) {\n        /* skip '.'s unless it's the last one remaining */\n        if (STREQ(components[i], \".\") &&\n            (beginSlash || ncomponents  > 1)) {\n            VIR_FREE(components[i]);\n            VIR_DELETE_ELEMENT(components, i, ncomponents);\n            continue;\n        }\n\n        /* resolve changes to parent directory */\n        if (STREQ(components[i], \"..\")) {\n            if (!beginSlash &&\n                (i == 0 || STREQ(components[i - 1], \"..\"))) {\n                i++;\n                continue;\n            }\n\n            VIR_FREE(components[i]);\n            VIR_DELETE_ELEMENT(components, i, ncomponents);\n\n            if (i != 0) {\n                VIR_FREE(components[i - 1]);\n                VIR_DELETE_ELEMENT(components, i - 1, ncomponents);\n                i--;\n            }\n\n            continue;\n        }\n\n        /* check if the actual path isn't resulting into a symlink */\n        if (!(currentpath = virStorageFileCanonicalizeFormatPath(components,\n                                                                 i + 1,\n                                                                 beginSlash,\n                                                                 beginDoubleSlash)))\n            goto cleanup;\n\n        if ((rc = cb(currentpath, &linkpath, cbdata)) < 0)\n            goto cleanup;\n\n        if (rc == 0) {\n            if (virHashLookup(cycle, currentpath)) {\n                virReportSystemError(ELOOP,\n                                     _(\"Failed to canonicalize path '%s'\"), path);\n                goto cleanup;\n            }\n\n            if (virHashAddEntry(cycle, currentpath, (void *) 1) < 0)\n                goto cleanup;\n\n            if (linkpath[0] == '/') {\n                /* kill everything from the beginning including the actual component */\n                i++;\n                while (i--) {\n                    VIR_FREE(components[0]);\n                    VIR_DELETE_ELEMENT(components, 0, ncomponents);\n                }\n                beginSlash = true;\n\n                if (linkpath[1] == '/' && linkpath[2] != '/')\n                    beginDoubleSlash = true;\n                else\n                    beginDoubleSlash = false;\n\n                i = 0;\n            } else {\n                VIR_FREE(components[i]);\n                VIR_DELETE_ELEMENT(components, i, ncomponents);\n            }\n\n            if (virStorageFileCanonicalizeInjectSymlink(linkpath,\n                                                        i,\n                                                        &components,\n                                                        &ncomponents) < 0)\n                goto cleanup;\n\n            j = 0;\n            while (j < ncomponents) {\n                /* skip slashes */\n                if (STREQ(components[j], \"\")) {\n                    VIR_FREE(components[j]);\n                    VIR_DELETE_ELEMENT(components, j, ncomponents);\n                    continue;\n                }\n                j++;\n            }\n\n            VIR_FREE(linkpath);\n            VIR_FREE(currentpath);\n\n            continue;\n        }\n\n        VIR_FREE(currentpath);\n\n        i++;\n    }\n\n    ret = virStorageFileCanonicalizeFormatPath(components, ncomponents,\n                                               beginSlash, beginDoubleSlash);\n\n cleanup:\n    virHashFree(cycle);\n    virStringListFreeCount(components, ncomponents);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsecret.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"virjson.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruri.h\"",
            "#include \"virstring.h\"",
            "#include \"virendian.h\"",
            "#include \"virhash.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virstoragefilebackend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int cowGetBackingStore(char **, int *,\n                              const char *, size_t);",
            "static int qcowXGetBackingStore(char **, int *,\n                                const char *, size_t);",
            "static int vmdk4GetBackingStore(char **, int *,\n                                const char *, size_t);",
            "static int\nqedGetBackingStore(char **, int *, const char *, size_t);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsecret.h\"\n#include \"virstorageencryption.h\"\n#include \"virjson.h\"\n#include \"virbuffer.h\"\n#include \"viruri.h\"\n#include \"virstring.h\"\n#include \"virendian.h\"\n#include \"virhash.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virstoragefilebackend.h\"\n#include <config.h>\n\nstatic int cowGetBackingStore(char **, int *,\n                              const char *, size_t);\nstatic int qcowXGetBackingStore(char **, int *,\n                                const char *, size_t);\nstatic int vmdk4GetBackingStore(char **, int *,\n                                const char *, size_t);\nstatic int\nqedGetBackingStore(char **, int *, const char *, size_t);\n\nchar *\nvirStorageFileCanonicalizePath(const char *path,\n                               virStorageFileSimplifyPathReadlinkCallback cb,\n                               void *cbdata)\n{\n    virHashTablePtr cycle = NULL;\n    bool beginSlash = false;\n    bool beginDoubleSlash = false;\n    char **components = NULL;\n    size_t ncomponents = 0;\n    size_t i = 0;\n    size_t j = 0;\n    int rc;\n    char *ret = NULL;\n    g_autofree char *linkpath = NULL;\n    g_autofree char *currentpath = NULL;\n\n    if (path[0] == '/') {\n        beginSlash = true;\n\n        if (path[1] == '/' && path[2] != '/')\n            beginDoubleSlash = true;\n    }\n\n    if (!(cycle = virHashCreate(10, NULL)))\n        goto cleanup;\n\n    if (!(components = virStringSplitCount(path, \"/\", 0, &ncomponents)))\n        goto cleanup;\n\n    j = 0;\n    while (j < ncomponents) {\n        /* skip slashes */\n        if (STREQ(components[j], \"\")) {\n            VIR_FREE(components[j]);\n            VIR_DELETE_ELEMENT(components, j, ncomponents);\n            continue;\n        }\n        j++;\n    }\n\n    while (i < ncomponents) {\n        /* skip '.'s unless it's the last one remaining */\n        if (STREQ(components[i], \".\") &&\n            (beginSlash || ncomponents  > 1)) {\n            VIR_FREE(components[i]);\n            VIR_DELETE_ELEMENT(components, i, ncomponents);\n            continue;\n        }\n\n        /* resolve changes to parent directory */\n        if (STREQ(components[i], \"..\")) {\n            if (!beginSlash &&\n                (i == 0 || STREQ(components[i - 1], \"..\"))) {\n                i++;\n                continue;\n            }\n\n            VIR_FREE(components[i]);\n            VIR_DELETE_ELEMENT(components, i, ncomponents);\n\n            if (i != 0) {\n                VIR_FREE(components[i - 1]);\n                VIR_DELETE_ELEMENT(components, i - 1, ncomponents);\n                i--;\n            }\n\n            continue;\n        }\n\n        /* check if the actual path isn't resulting into a symlink */\n        if (!(currentpath = virStorageFileCanonicalizeFormatPath(components,\n                                                                 i + 1,\n                                                                 beginSlash,\n                                                                 beginDoubleSlash)))\n            goto cleanup;\n\n        if ((rc = cb(currentpath, &linkpath, cbdata)) < 0)\n            goto cleanup;\n\n        if (rc == 0) {\n            if (virHashLookup(cycle, currentpath)) {\n                virReportSystemError(ELOOP,\n                                     _(\"Failed to canonicalize path '%s'\"), path);\n                goto cleanup;\n            }\n\n            if (virHashAddEntry(cycle, currentpath, (void *) 1) < 0)\n                goto cleanup;\n\n            if (linkpath[0] == '/') {\n                /* kill everything from the beginning including the actual component */\n                i++;\n                while (i--) {\n                    VIR_FREE(components[0]);\n                    VIR_DELETE_ELEMENT(components, 0, ncomponents);\n                }\n                beginSlash = true;\n\n                if (linkpath[1] == '/' && linkpath[2] != '/')\n                    beginDoubleSlash = true;\n                else\n                    beginDoubleSlash = false;\n\n                i = 0;\n            } else {\n                VIR_FREE(components[i]);\n                VIR_DELETE_ELEMENT(components, i, ncomponents);\n            }\n\n            if (virStorageFileCanonicalizeInjectSymlink(linkpath,\n                                                        i,\n                                                        &components,\n                                                        &ncomponents) < 0)\n                goto cleanup;\n\n            j = 0;\n            while (j < ncomponents) {\n                /* skip slashes */\n                if (STREQ(components[j], \"\")) {\n                    VIR_FREE(components[j]);\n                    VIR_DELETE_ELEMENT(components, j, ncomponents);\n                    continue;\n                }\n                j++;\n            }\n\n            VIR_FREE(linkpath);\n            VIR_FREE(currentpath);\n\n            continue;\n        }\n\n        VIR_FREE(currentpath);\n\n        i++;\n    }\n\n    ret = virStorageFileCanonicalizeFormatPath(components, ncomponents,\n                                               beginSlash, beginDoubleSlash);\n\n cleanup:\n    virHashFree(cycle);\n    virStringListFreeCount(components, ncomponents);\n\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic const char *\nvirStorageFileBackendGlusterGetUniqueIdentifier(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n    g_autofree char *filePath = NULL;\n\n    if (priv->canonpath)\n        return priv->canonpath;\n\n    if (!(filePath = virStorageFileCanonicalizePath(src->path,\n                                                    virStorageFileBackendGlusterReadlinkCallback,\n                                                    priv)))\n        return NULL;\n\n    priv->canonpath = g_strdup_printf(\"gluster://%s:%u/%s/%s\",\n                                      src->hosts->name,\n                                      src->hosts->port,\n                                      src->volume,\n                                      filePath);\n\n    return priv->canonpath;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterReadlinkCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "255-297",
    "snippet": "static int\nvirStorageFileBackendGlusterReadlinkCallback(const char *path,\n                                             char **linkpath,\n                                             void *data)\n{\n    virStorageFileBackendGlusterPrivPtr priv = data;\n    size_t bufsiz = 0;\n    ssize_t ret;\n    struct stat st;\n    g_autofree char *buf = NULL;\n\n    *linkpath = NULL;\n\n    if (glfs_stat(priv->vol, path, &st) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to stat gluster path '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (!S_ISLNK(st.st_mode))\n        return 1;\n\n realloc:\n    if (VIR_EXPAND_N(buf, bufsiz, 256) < 0)\n        return -1;\n\n    if ((ret = glfs_readlink(priv->vol, path, buf, bufsiz)) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to read link of gluster file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (ret == bufsiz)\n        goto realloc;\n\n    buf[ret] = '\\0';\n\n    *linkpath = g_steal_pointer(&buf);\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&buf"
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to read link of gluster file '%s'\")",
            "path"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to read link of gluster file '%s'\""
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "glfs_readlink",
          "args": [
            "priv->vol",
            "path",
            "buf",
            "bufsiz"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "buf",
            "bufsiz",
            "256"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISLNK",
          "args": [
            "st.st_mode"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to stat gluster path '%s'\")",
            "path"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_stat",
          "args": [
            "priv->vol",
            "path",
            "&st"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterReadlinkCallback(const char *path,\n                                             char **linkpath,\n                                             void *data)\n{\n    virStorageFileBackendGlusterPrivPtr priv = data;\n    size_t bufsiz = 0;\n    ssize_t ret;\n    struct stat st;\n    g_autofree char *buf = NULL;\n\n    *linkpath = NULL;\n\n    if (glfs_stat(priv->vol, path, &st) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to stat gluster path '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (!S_ISLNK(st.st_mode))\n        return 1;\n\n realloc:\n    if (VIR_EXPAND_N(buf, bufsiz, 256) < 0)\n        return -1;\n\n    if ((ret = glfs_readlink(priv->vol, path, buf, bufsiz)) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to read link of gluster file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (ret == bufsiz)\n        goto realloc;\n\n    buf[ret] = '\\0';\n\n    *linkpath = g_steal_pointer(&buf);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterAccess",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "246-253",
    "snippet": "static int\nvirStorageFileBackendGlusterAccess(virStorageSourcePtr src,\n                                   int mode)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_access(priv->vol, src->path, mode);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "glfs_access",
          "args": [
            "priv->vol",
            "src->path",
            "mode"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterAccess(virStorageSourcePtr src,\n                                   int mode)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_access(priv->vol, src->path, mode);\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterRead",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "188-243",
    "snippet": "static ssize_t\nvirStorageFileBackendGlusterRead(virStorageSourcePtr src,\n                                 size_t offset,\n                                 size_t len,\n                                 char **buf)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n    glfs_fd_t *fd = NULL;\n    ssize_t ret = -1;\n    char *s;\n    size_t nread = 0;\n\n    *buf = NULL;\n\n    if (!(fd = glfs_open(priv->vol, src->path, O_RDONLY))) {\n        virReportSystemError(errno, _(\"Failed to open file '%s'\"),\n                             src->path);\n        return -1;\n    }\n\n    if (offset > 0) {\n        if (glfs_lseek(fd, offset, SEEK_SET) == (off_t) -1) {\n            virReportSystemError(errno, _(\"cannot seek into '%s'\"), src->path);\n            goto cleanup;\n        }\n    }\n\n\n    if (VIR_ALLOC_N(*buf, len) < 0)\n        return -1;\n\n    s = *buf;\n    while (len) {\n        ssize_t r = glfs_read(fd, s, len, 0);\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0) {\n            VIR_FREE(*buf);\n            virReportSystemError(errno, _(\"unable to read '%s'\"), src->path);\n            return r;\n        }\n        if (r == 0)\n            return nread;\n        s += r;\n        len -= r;\n        nread += r;\n    }\n\n    ret = nread;\n\n cleanup:\n    if (fd)\n        glfs_close(fd);\n\n    return ret;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "glfs_close",
          "args": [
            "fd"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to read '%s'\")",
            "src->path"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable to read '%s'\""
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*buf"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_read",
          "args": [
            "fd",
            "s",
            "len",
            "0"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "*buf",
            "len"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot seek into '%s'\")",
            "src->path"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_lseek",
          "args": [
            "fd",
            "offset",
            "SEEK_SET"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to open file '%s'\")",
            "src->path"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_open",
          "args": [
            "priv->vol",
            "src->path",
            "O_RDONLY"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic ssize_t\nvirStorageFileBackendGlusterRead(virStorageSourcePtr src,\n                                 size_t offset,\n                                 size_t len,\n                                 char **buf)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n    glfs_fd_t *fd = NULL;\n    ssize_t ret = -1;\n    char *s;\n    size_t nread = 0;\n\n    *buf = NULL;\n\n    if (!(fd = glfs_open(priv->vol, src->path, O_RDONLY))) {\n        virReportSystemError(errno, _(\"Failed to open file '%s'\"),\n                             src->path);\n        return -1;\n    }\n\n    if (offset > 0) {\n        if (glfs_lseek(fd, offset, SEEK_SET) == (off_t) -1) {\n            virReportSystemError(errno, _(\"cannot seek into '%s'\"), src->path);\n            goto cleanup;\n        }\n    }\n\n\n    if (VIR_ALLOC_N(*buf, len) < 0)\n        return -1;\n\n    s = *buf;\n    while (len) {\n        ssize_t r = glfs_read(fd, s, len, 0);\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0) {\n            VIR_FREE(*buf);\n            virReportSystemError(errno, _(\"unable to read '%s'\"), src->path);\n            return r;\n        }\n        if (r == 0)\n            return nread;\n        s += r;\n        len -= r;\n        nread += r;\n    }\n\n    ret = nread;\n\n cleanup:\n    if (fd)\n        glfs_close(fd);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterStat",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "178-185",
    "snippet": "static int\nvirStorageFileBackendGlusterStat(virStorageSourcePtr src,\n                                 struct stat *st)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_stat(priv->vol, src->path, st);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "glfs_stat",
          "args": [
            "priv->vol",
            "src->path",
            "st"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterStat(virStorageSourcePtr src,\n                                 struct stat *st)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_stat(priv->vol, src->path, st);\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterUnlink",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "169-175",
    "snippet": "static int\nvirStorageFileBackendGlusterUnlink(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_unlink(priv->vol, src->path);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "glfs_unlink",
          "args": [
            "priv->vol",
            "src->path"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterUnlink(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    return glfs_unlink(priv->vol, src->path);\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "150-166",
    "snippet": "static int\nvirStorageFileBackendGlusterCreate(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n    glfs_fd_t *fd = NULL;\n    mode_t mode = S_IRUSR;\n\n    if (!src->readonly)\n        mode |= S_IWUSR;\n\n    if (!(fd = glfs_creat(priv->vol, src->path,\n                          O_CREAT | O_TRUNC | O_WRONLY, mode)))\n        return -1;\n\n    ignore_value(glfs_close(fd));\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "glfs_close(fd)"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_close",
          "args": [
            "fd"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_creat",
          "args": [
            "priv->vol",
            "src->path",
            "O_CREAT | O_TRUNC | O_WRONLY",
            "mode"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterCreate(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n    glfs_fd_t *fd = NULL;\n    mode_t mode = S_IRUSR;\n\n    if (!src->readonly)\n        mode |= S_IWUSR;\n\n    if (!(fd = glfs_creat(priv->vol, src->path,\n                          O_CREAT | O_TRUNC | O_WRONLY, mode)))\n        return -1;\n\n    ignore_value(glfs_close(fd));\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "99-147",
    "snippet": "static int\nvirStorageFileBackendGlusterInit(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = NULL;\n    size_t i;\n\n    if (!src->volume) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"missing gluster volume name for path '%s'\"),\n                       src->path);\n        return -1;\n    }\n\n    if (VIR_ALLOC(priv) < 0)\n        return -1;\n\n    VIR_DEBUG(\"initializing gluster storage file %p \"\n              \"(priv='%p' volume='%s' path='%s') as [%u:%u]\",\n              src, priv, src->volume, src->path,\n              (unsigned int)src->drv->uid, (unsigned int)src->drv->gid);\n\n    if (!(priv->vol = glfs_new(src->volume))) {\n        virReportOOMError();\n        goto error;\n    }\n\n    for (i = 0; i < src->nhosts; i++) {\n        if (virStorageFileBackendGlusterInitServer(priv, src->hosts + i) < 0)\n            goto error;\n    }\n\n    if (glfs_init(priv->vol) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to initialize gluster connection \"\n                               \"(src=%p priv=%p)\"), src, priv);\n        goto error;\n    }\n\n    src->drv->priv = priv;\n\n    return 0;\n\n error:\n    if (priv->vol)\n        glfs_fini(priv->vol);\n    VIR_FREE(priv);\n\n    return -1;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_fini",
          "args": [
            "priv->vol"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to initialize gluster connection \"\n                               \"(src=%p priv=%p)\")",
            "src",
            "priv"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to initialize gluster connection \"\n                               \"(src=%p priv=%p)\""
          ],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "glfs_init",
          "args": [
            "priv->vol"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageFileBackendGlusterInitServer",
          "args": [
            "priv",
            "src->hosts + i"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageFileBackendGlusterInitServer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
          "lines": "62-96",
          "snippet": "static int\nvirStorageFileBackendGlusterInitServer(virStorageFileBackendGlusterPrivPtr priv,\n                                       virStorageNetHostDefPtr host)\n{\n    const char *transport = virStorageNetHostTransportTypeToString(host->transport);\n    const char *hoststr = NULL;\n    int port = 0;\n\n    switch ((virStorageNetHostTransport) host->transport) {\n    case VIR_STORAGE_NET_HOST_TRANS_RDMA:\n    case VIR_STORAGE_NET_HOST_TRANS_TCP:\n        hoststr = host->name;\n        port = host->port;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_UNIX:\n        hoststr = host->socket;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_LAST:\n        break;\n    }\n\n    VIR_DEBUG(\"adding gluster host for %p: transport=%s host=%s port=%d\",\n              priv, transport, hoststr, port);\n\n    if (glfs_set_volfile_server(priv->vol, transport, hoststr, port) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to set gluster volfile server '%s'\"),\n                             hoststr);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virstoragefilebackend.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_file_gluster.h\"",
            "#include <glusterfs/api/glfs.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterInitServer(virStorageFileBackendGlusterPrivPtr priv,\n                                       virStorageNetHostDefPtr host)\n{\n    const char *transport = virStorageNetHostTransportTypeToString(host->transport);\n    const char *hoststr = NULL;\n    int port = 0;\n\n    switch ((virStorageNetHostTransport) host->transport) {\n    case VIR_STORAGE_NET_HOST_TRANS_RDMA:\n    case VIR_STORAGE_NET_HOST_TRANS_TCP:\n        hoststr = host->name;\n        port = host->port;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_UNIX:\n        hoststr = host->socket;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_LAST:\n        break;\n    }\n\n    VIR_DEBUG(\"adding gluster host for %p: transport=%s host=%s port=%d\",\n              priv, transport, hoststr, port);\n\n    if (glfs_set_volfile_server(priv->vol, transport, hoststr, port) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to set gluster volfile server '%s'\"),\n                             hoststr);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportOOMError",
          "args": [],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_new",
          "args": [
            "src->volume"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"initializing gluster storage file %p \"\n              \"(priv='%p' volume='%s' path='%s') as [%u:%u]\"",
            "src",
            "priv",
            "src->volume",
            "src->path",
            "(unsigned int)src->drv->uid",
            "(unsigned int)src->drv->gid"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "priv"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"missing gluster volume name for path '%s'\")",
            "src->path"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterInit(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = NULL;\n    size_t i;\n\n    if (!src->volume) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"missing gluster volume name for path '%s'\"),\n                       src->path);\n        return -1;\n    }\n\n    if (VIR_ALLOC(priv) < 0)\n        return -1;\n\n    VIR_DEBUG(\"initializing gluster storage file %p \"\n              \"(priv='%p' volume='%s' path='%s') as [%u:%u]\",\n              src, priv, src->volume, src->path,\n              (unsigned int)src->drv->uid, (unsigned int)src->drv->gid);\n\n    if (!(priv->vol = glfs_new(src->volume))) {\n        virReportOOMError();\n        goto error;\n    }\n\n    for (i = 0; i < src->nhosts; i++) {\n        if (virStorageFileBackendGlusterInitServer(priv, src->hosts + i) < 0)\n            goto error;\n    }\n\n    if (glfs_init(priv->vol) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to initialize gluster connection \"\n                               \"(src=%p priv=%p)\"), src, priv);\n        goto error;\n    }\n\n    src->drv->priv = priv;\n\n    return 0;\n\n error:\n    if (priv->vol)\n        glfs_fini(priv->vol);\n    VIR_FREE(priv);\n\n    return -1;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterInitServer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "62-96",
    "snippet": "static int\nvirStorageFileBackendGlusterInitServer(virStorageFileBackendGlusterPrivPtr priv,\n                                       virStorageNetHostDefPtr host)\n{\n    const char *transport = virStorageNetHostTransportTypeToString(host->transport);\n    const char *hoststr = NULL;\n    int port = 0;\n\n    switch ((virStorageNetHostTransport) host->transport) {\n    case VIR_STORAGE_NET_HOST_TRANS_RDMA:\n    case VIR_STORAGE_NET_HOST_TRANS_TCP:\n        hoststr = host->name;\n        port = host->port;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_UNIX:\n        hoststr = host->socket;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_LAST:\n        break;\n    }\n\n    VIR_DEBUG(\"adding gluster host for %p: transport=%s host=%s port=%d\",\n              priv, transport, hoststr, port);\n\n    if (glfs_set_volfile_server(priv->vol, transport, hoststr, port) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to set gluster volfile server '%s'\"),\n                             hoststr);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to set gluster volfile server '%s'\")",
            "hoststr"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to set gluster volfile server '%s'\""
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "glfs_set_volfile_server",
          "args": [
            "priv->vol",
            "transport",
            "hoststr",
            "port"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"adding gluster host for %p: transport=%s host=%s port=%d\"",
            "priv",
            "transport",
            "hoststr",
            "port"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageNetHostTransportTypeToString",
          "args": [
            "host->transport"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendGlusterInitServer(virStorageFileBackendGlusterPrivPtr priv,\n                                       virStorageNetHostDefPtr host)\n{\n    const char *transport = virStorageNetHostTransportTypeToString(host->transport);\n    const char *hoststr = NULL;\n    int port = 0;\n\n    switch ((virStorageNetHostTransport) host->transport) {\n    case VIR_STORAGE_NET_HOST_TRANS_RDMA:\n    case VIR_STORAGE_NET_HOST_TRANS_TCP:\n        hoststr = host->name;\n        port = host->port;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_UNIX:\n        hoststr = host->socket;\n        break;\n\n    case VIR_STORAGE_NET_HOST_TRANS_LAST:\n        break;\n    }\n\n    VIR_DEBUG(\"adding gluster host for %p: transport=%s host=%s port=%d\",\n              priv, transport, hoststr, port);\n\n    if (glfs_set_volfile_server(priv->vol, transport, hoststr, port) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to set gluster volfile server '%s'\"),\n                             hoststr);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendGlusterDeinit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_gluster.c",
    "lines": "46-60",
    "snippet": "static void\nvirStorageFileBackendGlusterDeinit(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    VIR_DEBUG(\"deinitializing gluster storage file %p (gluster://%s:%u/%s%s)\",\n              src, src->hosts->name, src->hosts->port, src->volume, src->path);\n\n    if (priv->vol)\n        glfs_fini(priv->vol);\n    VIR_FREE(priv->canonpath);\n\n    VIR_FREE(priv);\n    src->drv->priv = NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_file_gluster.h\"",
      "#include <glusterfs/api/glfs.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv->canonpath"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glfs_fini",
          "args": [
            "priv->vol"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"deinitializing gluster storage file %p (gluster://%s:%u/%s%s)\"",
            "src",
            "src->hosts->name",
            "src->hosts->port",
            "src->volume",
            "src->path"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virstoragefilebackend.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"storage_file_gluster.h\"\n#include <glusterfs/api/glfs.h>\n#include <config.h>\n\nstatic void\nvirStorageFileBackendGlusterDeinit(virStorageSourcePtr src)\n{\n    virStorageFileBackendGlusterPrivPtr priv = src->drv->priv;\n\n    VIR_DEBUG(\"deinitializing gluster storage file %p (gluster://%s:%u/%s%s)\",\n              src, src->hosts->name, src->hosts->port, src->volume, src->path);\n\n    if (priv->vol)\n        glfs_fini(priv->vol);\n    VIR_FREE(priv->canonpath);\n\n    VIR_FREE(priv);\n    src->drv->priv = NULL;\n}"
  }
]