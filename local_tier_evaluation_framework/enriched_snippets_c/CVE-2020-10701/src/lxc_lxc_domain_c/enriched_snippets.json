[
  {
    "function_name": "virLXCDomainSetRunlevel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "459-501",
    "snippet": "int\nvirLXCDomainSetRunlevel(virDomainObjPtr vm,\n                        int runlevel)\n{\n    virLXCDomainObjPrivatePtr priv = vm->privateData;\n    lxcDomainInitctlCallbackData data;\n    size_t nfifos = 0;\n    size_t i;\n    int ret = -1;\n\n    memset(&data, 0, sizeof(data));\n\n    data.runlevel = runlevel;\n\n    for (nfifos = 0; virInitctlFifos[nfifos]; nfifos++)\n        ;\n\n    if (VIR_ALLOC_N(data.st, nfifos) < 0 ||\n        VIR_ALLOC_N(data.st_valid, nfifos) < 0)\n        goto cleanup;\n\n    for (i = 0; virInitctlFifos[i]; i++) {\n        const char *fifo = virInitctlFifos[i];\n\n        if (stat(fifo, &(data.st[i])) < 0) {\n            if (errno == ENOENT)\n                continue;\n\n            virReportSystemError(errno, _(\"Unable to stat %s\"), fifo);\n            goto cleanup;\n        }\n\n        data.st_valid[i] = true;\n    }\n\n    ret = virProcessRunInMountNamespace(priv->initpid,\n                                        lxcDomainInitctlCallback,\n                                        &data);\n cleanup:\n    VIR_FREE(data.st);\n    VIR_FREE(data.st_valid);\n    return ret;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "data.st_valid"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "data.st"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virProcessRunInMountNamespace",
          "args": [
            "priv->initpid",
            "lxcDomainInitctlCallback",
            "&data"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessRunInMountNamespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "1115-1123",
          "snippet": "int\nvirProcessRunInMountNamespace(pid_t pid G_GNUC_UNUSED,\n                              virProcessNamespaceCallback cb G_GNUC_UNUSED,\n                              void *opaque G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Namespaces are not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirProcessRunInMountNamespace(pid_t pid G_GNUC_UNUSED,\n                              virProcessNamespaceCallback cb G_GNUC_UNUSED,\n                              void *opaque G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Namespaces are not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to stat %s\")",
            "fifo"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to stat %s\""
          ],
          "line": 487
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "fifo",
            "&(data.st[i])"
          ],
          "line": 483
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "data.st_valid",
            "nfifos"
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "data.st",
            "nfifos"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&data",
            "0",
            "sizeof(data)"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nint\nvirLXCDomainSetRunlevel(virDomainObjPtr vm,\n                        int runlevel)\n{\n    virLXCDomainObjPrivatePtr priv = vm->privateData;\n    lxcDomainInitctlCallbackData data;\n    size_t nfifos = 0;\n    size_t i;\n    int ret = -1;\n\n    memset(&data, 0, sizeof(data));\n\n    data.runlevel = runlevel;\n\n    for (nfifos = 0; virInitctlFifos[nfifos]; nfifos++)\n        ;\n\n    if (VIR_ALLOC_N(data.st, nfifos) < 0 ||\n        VIR_ALLOC_N(data.st_valid, nfifos) < 0)\n        goto cleanup;\n\n    for (i = 0; virInitctlFifos[i]; i++) {\n        const char *fifo = virInitctlFifos[i];\n\n        if (stat(fifo, &(data.st[i])) < 0) {\n            if (errno == ENOENT)\n                continue;\n\n            virReportSystemError(errno, _(\"Unable to stat %s\"), fifo);\n            goto cleanup;\n        }\n\n        data.st_valid[i] = true;\n    }\n\n    ret = virProcessRunInMountNamespace(priv->initpid,\n                                        lxcDomainInitctlCallback,\n                                        &data);\n cleanup:\n    VIR_FREE(data.st);\n    VIR_FREE(data.st_valid);\n    return ret;\n}"
  },
  {
    "function_name": "lxcDomainInitctlCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "423-456",
    "snippet": "static int\nlxcDomainInitctlCallback(pid_t pid G_GNUC_UNUSED,\n                         void *opaque)\n{\n    lxcDomainInitctlCallbackData *data = opaque;\n    size_t i;\n\n    for (i = 0; virInitctlFifos[i]; i++) {\n        const char *fifo = virInitctlFifos[i];\n        struct stat cont_sb;\n\n        if (stat(fifo, &cont_sb) < 0) {\n            if (errno == ENOENT)\n                continue;\n\n            virReportSystemError(errno, _(\"Unable to stat %s\"), fifo);\n            return -1;\n        }\n\n        /* Check if the init fifo is not the very one that's on\n         * the host. We don't want to change the host's runlevel.\n         */\n        if (data->st_valid[i] &&\n            data->st[i].st_dev == cont_sb.st_dev &&\n            data->st[i].st_ino == cont_sb.st_ino)\n            continue;\n\n        return virInitctlSetRunLevel(fifo, data->runlevel);\n    }\n\n    /* If no usable fifo was found then declare success. Caller\n     * will try killing the domain with signal. */\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virInitctlSetRunLevel",
          "args": [
            "fifo",
            "data->runlevel"
          ],
          "line": 450
        },
        "resolved": true,
        "details": {
          "function_name": "virInitctlSetRunLevel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virinitctl.c",
          "lines": "192-197",
          "snippet": "int virInitctlSetRunLevel(const char *fifo G_GNUC_UNUSED,\n                          virInitctlRunLevel level G_GNUC_UNUSED)\n{\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"virinitctl.h\"",
            "#include \"internal.h\"",
            "#include <fcntl.h>",
            "#include <sys/param.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"virinitctl.h\"\n#include \"internal.h\"\n#include <fcntl.h>\n#include <sys/param.h>\n#include <config.h>\n\nint virInitctlSetRunLevel(const char *fifo G_GNUC_UNUSED,\n                          virInitctlRunLevel level G_GNUC_UNUSED)\n{\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to stat %s\")",
            "fifo"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to stat %s\""
          ],
          "line": 438
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "fifo",
            "&cont_sb"
          ],
          "line": 434
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nlxcDomainInitctlCallback(pid_t pid G_GNUC_UNUSED,\n                         void *opaque)\n{\n    lxcDomainInitctlCallbackData *data = opaque;\n    size_t i;\n\n    for (i = 0; virInitctlFifos[i]; i++) {\n        const char *fifo = virInitctlFifos[i];\n        struct stat cont_sb;\n\n        if (stat(fifo, &cont_sb) < 0) {\n            if (errno == ENOENT)\n                continue;\n\n            virReportSystemError(errno, _(\"Unable to stat %s\"), fifo);\n            return -1;\n        }\n\n        /* Check if the init fifo is not the very one that's on\n         * the host. We don't want to change the host's runlevel.\n         */\n        if (data->st_valid[i] &&\n            data->st[i].st_dev == cont_sb.st_dev &&\n            data->st[i].st_ino == cont_sb.st_ino)\n            continue;\n\n        return virInitctlSetRunLevel(fifo, data->runlevel);\n    }\n\n    /* If no usable fifo was found then declare success. Caller\n     * will try killing the domain with signal. */\n    return 0;\n}"
  },
  {
    "function_name": "virLXCDomainGetMachineName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "397-412",
    "snippet": "char *\nvirLXCDomainGetMachineName(virDomainDefPtr def, pid_t pid)\n{\n    char *ret = NULL;\n\n    if (pid) {\n        ret = virSystemdGetMachineNameByPID(pid);\n        if (!ret)\n            virResetLastError();\n    }\n\n    if (!ret)\n        ret = virDomainGenerateMachineName(\"lxc\", NULL, def->id, def->name, true);\n\n    return ret;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainGenerateMachineName",
          "args": [
            "\"lxc\"",
            "NULL",
            "def->id",
            "def->name",
            "true"
          ],
          "line": 409
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainGenerateMachineName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "31073-31108",
          "snippet": "char *\nvirDomainGenerateMachineName(const char *drivername,\n                             const char *root,\n                             int id,\n                             const char *name,\n                             bool privileged)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAsprintf(&buf, \"%s-\", drivername);\n\n    if (root) {\n        g_autofree char *hash = NULL;\n\n        /* When two embed drivers start two domains with the same @name and @id\n         * we would generate a non-unique name. Include parts of hashed @root\n         * which guarantees uniqueness. The first 8 characters of SHA256 ought\n         * to be enough for anybody. */\n        if (virCryptoHashString(VIR_CRYPTO_HASH_SHA256, root, &hash) < 0)\n            return NULL;\n\n        virBufferAsprintf(&buf, \"embed-%.8s-\", hash);\n    } else if (!privileged) {\n        g_autofree char *username = NULL;\n        if (!(username = virGetUserName(geteuid()))) {\n            virBufferFreeAndReset(&buf);\n            return NULL;\n        }\n        virBufferAsprintf(&buf, \"%s-\", username);\n    }\n\n    virBufferAsprintf(&buf, \"%d-\", id);\n    virDomainMachineNameAppendValid(&buf, name);\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nchar *\nvirDomainGenerateMachineName(const char *drivername,\n                             const char *root,\n                             int id,\n                             const char *name,\n                             bool privileged)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAsprintf(&buf, \"%s-\", drivername);\n\n    if (root) {\n        g_autofree char *hash = NULL;\n\n        /* When two embed drivers start two domains with the same @name and @id\n         * we would generate a non-unique name. Include parts of hashed @root\n         * which guarantees uniqueness. The first 8 characters of SHA256 ought\n         * to be enough for anybody. */\n        if (virCryptoHashString(VIR_CRYPTO_HASH_SHA256, root, &hash) < 0)\n            return NULL;\n\n        virBufferAsprintf(&buf, \"embed-%.8s-\", hash);\n    } else if (!privileged) {\n        g_autofree char *username = NULL;\n        if (!(username = virGetUserName(geteuid()))) {\n            virBufferFreeAndReset(&buf);\n            return NULL;\n        }\n        virBufferAsprintf(&buf, \"%s-\", username);\n    }\n\n    virBufferAsprintf(&buf, \"%d-\", id);\n    virDomainMachineNameAppendValid(&buf, name);\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 405
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdGetMachineNameByPID",
          "args": [
            "pid"
          ],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdGetMachineNameByPID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "197-248",
          "snippet": "char *\nvirSystemdGetMachineNameByPID(pid_t pid)\n{\n    DBusConnection *conn;\n    DBusMessage *reply = NULL;\n    char *name = NULL, *object = NULL;\n\n    if (virSystemdHasMachined() < 0)\n        goto cleanup;\n\n    if (!(conn = virDBusGetSystemBus()))\n        goto cleanup;\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          \"/org/freedesktop/machine1\",\n                          \"org.freedesktop.machine1.Manager\",\n                          \"GetMachineByPID\",\n                          \"u\", pid) < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"o\", &object) < 0)\n        goto cleanup;\n\n    virDBusMessageUnref(reply);\n    reply = NULL;\n\n    VIR_DEBUG(\"Domain with pid %lld has object path '%s'\",\n              (long long) pid, object);\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          object,\n                          \"org.freedesktop.DBus.Properties\",\n                          \"Get\",\n                          \"ss\",\n                          \"org.freedesktop.machine1.Machine\",\n                          \"Name\") < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"v\", \"s\", &name) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Domain with pid %lld has machine name '%s'\",\n              (long long) pid, name);\n\n cleanup:\n    VIR_FREE(object);\n    virDBusMessageUnref(reply);\n\n    return name;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nchar *\nvirSystemdGetMachineNameByPID(pid_t pid)\n{\n    DBusConnection *conn;\n    DBusMessage *reply = NULL;\n    char *name = NULL, *object = NULL;\n\n    if (virSystemdHasMachined() < 0)\n        goto cleanup;\n\n    if (!(conn = virDBusGetSystemBus()))\n        goto cleanup;\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          \"/org/freedesktop/machine1\",\n                          \"org.freedesktop.machine1.Manager\",\n                          \"GetMachineByPID\",\n                          \"u\", pid) < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"o\", &object) < 0)\n        goto cleanup;\n\n    virDBusMessageUnref(reply);\n    reply = NULL;\n\n    VIR_DEBUG(\"Domain with pid %lld has object path '%s'\",\n              (long long) pid, object);\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          object,\n                          \"org.freedesktop.DBus.Properties\",\n                          \"Get\",\n                          \"ss\",\n                          \"org.freedesktop.machine1.Machine\",\n                          \"Name\") < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"v\", \"s\", &name) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Domain with pid %lld has machine name '%s'\",\n              (long long) pid, name);\n\n cleanup:\n    VIR_FREE(object);\n    virDBusMessageUnref(reply);\n\n    return name;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nchar *\nvirLXCDomainGetMachineName(virDomainDefPtr def, pid_t pid)\n{\n    char *ret = NULL;\n\n    if (pid) {\n        ret = virSystemdGetMachineNameByPID(pid);\n        if (!ret)\n            virResetLastError();\n    }\n\n    if (!ret)\n        ret = virDomainGenerateMachineName(\"lxc\", NULL, def->id, def->name, true);\n\n    return ret;\n}"
  },
  {
    "function_name": "virLXCDomainDeviceDefPostParse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "375-388",
    "snippet": "static int\nvirLXCDomainDeviceDefPostParse(virDomainDeviceDefPtr dev,\n                               const virDomainDef *def G_GNUC_UNUSED,\n                               unsigned int parseFlags G_GNUC_UNUSED,\n                               void *opaque G_GNUC_UNUSED,\n                               void *parseOpaque G_GNUC_UNUSED)\n{\n    if (dev->type == VIR_DOMAIN_DEVICE_CHR &&\n        dev->data.chr->deviceType == VIR_DOMAIN_CHR_DEVICE_TYPE_CONSOLE &&\n        dev->data.chr->targetType == VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_NONE)\n        dev->data.chr->targetType = VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_LXC;\n\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nvirLXCDomainDeviceDefPostParse(virDomainDeviceDefPtr dev,\n                               const virDomainDef *def G_GNUC_UNUSED,\n                               unsigned int parseFlags G_GNUC_UNUSED,\n                               void *opaque G_GNUC_UNUSED,\n                               void *parseOpaque G_GNUC_UNUSED)\n{\n    if (dev->type == VIR_DOMAIN_DEVICE_CHR &&\n        dev->data.chr->deviceType == VIR_DOMAIN_CHR_DEVICE_TYPE_CONSOLE &&\n        dev->data.chr->targetType == VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_NONE)\n        dev->data.chr->targetType = VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_LXC;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCDomainDefPostParse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "351-372",
    "snippet": "static int\nvirLXCDomainDefPostParse(virDomainDefPtr def,\n                         unsigned int parseFlags G_GNUC_UNUSED,\n                         void *opaque,\n                         void *parseOpaque G_GNUC_UNUSED)\n{\n    virLXCDriverPtr driver = opaque;\n    g_autoptr(virCaps) caps = virLXCDriverGetCapabilities(driver, false);\n    if (!caps)\n        return -1;\n    if (!virCapabilitiesDomainSupported(caps, def->os.type,\n                                        def->os.arch,\n                                        def->virtType))\n        return -1;\n\n    /* check for emulator and create a default one if needed */\n    if (!def->emulator &&\n        !(def->emulator = virDomainDefGetDefaultEmulator(def, caps)))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainDefGetDefaultEmulator",
          "args": [
            "def",
            "caps"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetDefaultEmulator",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "18529-18543",
          "snippet": "char *\nvirDomainDefGetDefaultEmulator(virDomainDefPtr def,\n                               virCapsPtr caps)\n{\n    char *retemu;\n    g_autofree virCapsDomainDataPtr capsdata = NULL;\n\n    if (!(capsdata = virCapabilitiesDomainDataLookup(caps, def->os.type,\n            def->os.arch, def->virtType, NULL, NULL)))\n        return NULL;\n\n    retemu = g_strdup(capsdata->emulator);\n\n    return retemu;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nchar *\nvirDomainDefGetDefaultEmulator(virDomainDefPtr def,\n                               virCapsPtr caps)\n{\n    char *retemu;\n    g_autofree virCapsDomainDataPtr capsdata = NULL;\n\n    if (!(capsdata = virCapabilitiesDomainDataLookup(caps, def->os.type,\n            def->os.arch, def->virtType, NULL, NULL)))\n        return NULL;\n\n    retemu = g_strdup(capsdata->emulator);\n\n    return retemu;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCapabilitiesDomainSupported",
          "args": [
            "caps",
            "def->os.type",
            "def->os.arch",
            "def->virtType"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "virCapabilitiesDomainSupported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/capabilities.c",
          "lines": "787-801",
          "snippet": "bool\nvirCapabilitiesDomainSupported(virCapsPtr caps,\n                               int ostype,\n                               virArch arch,\n                               int virttype)\n{\n    g_autofree virCapsDomainDataPtr capsdata = NULL;\n\n    capsdata = virCapabilitiesDomainDataLookup(caps, ostype,\n                                               arch,\n                                               virttype,\n                                               NULL, NULL);\n\n    return capsdata != NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virenum.h\"",
            "#include \"viruuid.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"virlog.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virarch.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"capabilities.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virenum.h\"\n#include \"viruuid.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"virlog.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"virarch.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"capabilities.h\"\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirCapabilitiesDomainSupported(virCapsPtr caps,\n                               int ostype,\n                               virArch arch,\n                               int virttype)\n{\n    g_autofree virCapsDomainDataPtr capsdata = NULL;\n\n    capsdata = virCapabilitiesDomainDataLookup(caps, ostype,\n                                               arch,\n                                               virttype,\n                                               NULL, NULL);\n\n    return capsdata != NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCDriverGetCapabilities",
          "args": [
            "driver",
            "false"
          ],
          "line": 358
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCDriverGetCapabilities",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_conf.c",
          "lines": "187-213",
          "snippet": "virCapsPtr virLXCDriverGetCapabilities(virLXCDriverPtr driver,\n                                       bool refresh)\n{\n    virCapsPtr ret;\n    if (refresh) {\n        virCapsPtr caps = NULL;\n        if ((caps = virLXCDriverCapsInit(driver)) == NULL)\n            return NULL;\n\n        lxcDriverLock(driver);\n        virObjectUnref(driver->caps);\n        driver->caps = caps;\n    } else {\n        lxcDriverLock(driver);\n\n        if (driver->caps == NULL) {\n            VIR_DEBUG(\"Capabilities didn't detect any guests. Forcing a \"\n                      \"refresh.\");\n            lxcDriverUnlock(driver);\n            return virLXCDriverGetCapabilities(driver, true);\n        }\n    }\n\n    ret = virObjectRef(driver->caps);\n    lxcDriverUnlock(driver);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"lxc_container.h\"",
            "#include \"configmake.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virerror.h\"",
            "#include \"lxc_domain.h\"",
            "#include \"lxc_conf.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virnodesuspend.h\"\n#include \"lxc_container.h\"\n#include \"configmake.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virerror.h\"\n#include \"lxc_domain.h\"\n#include \"lxc_conf.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirCapsPtr virLXCDriverGetCapabilities(virLXCDriverPtr driver,\n                                       bool refresh)\n{\n    virCapsPtr ret;\n    if (refresh) {\n        virCapsPtr caps = NULL;\n        if ((caps = virLXCDriverCapsInit(driver)) == NULL)\n            return NULL;\n\n        lxcDriverLock(driver);\n        virObjectUnref(driver->caps);\n        driver->caps = caps;\n    } else {\n        lxcDriverLock(driver);\n\n        if (driver->caps == NULL) {\n            VIR_DEBUG(\"Capabilities didn't detect any guests. Forcing a \"\n                      \"refresh.\");\n            lxcDriverUnlock(driver);\n            return virLXCDriverGetCapabilities(driver, true);\n        }\n    }\n\n    ret = virObjectRef(driver->caps);\n    lxcDriverUnlock(driver);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nvirLXCDomainDefPostParse(virDomainDefPtr def,\n                         unsigned int parseFlags G_GNUC_UNUSED,\n                         void *opaque,\n                         void *parseOpaque G_GNUC_UNUSED)\n{\n    virLXCDriverPtr driver = opaque;\n    g_autoptr(virCaps) caps = virLXCDriverGetCapabilities(driver, false);\n    if (!caps)\n        return -1;\n    if (!virCapabilitiesDomainSupported(caps, def->os.type,\n                                        def->os.arch,\n                                        def->virtType))\n        return -1;\n\n    /* check for emulator and create a default one if needed */\n    if (!def->emulator &&\n        !(def->emulator = virDomainDefGetDefaultEmulator(def, caps)))\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCDomainObjPrivateXMLParse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "325-342",
    "snippet": "static int\nvirLXCDomainObjPrivateXMLParse(xmlXPathContextPtr ctxt,\n                               virDomainObjPtr vm,\n                               virDomainDefParserConfigPtr config G_GNUC_UNUSED)\n{\n    virLXCDomainObjPrivatePtr priv = vm->privateData;\n    long long thepid;\n\n    if (virXPathLongLong(\"string(./init[1]/@pid)\", ctxt, &thepid) < 0) {\n        VIR_WARN(\"Failed to load init pid from state %s\",\n                 virGetLastErrorMessage());\n        priv->initpid = 0;\n    } else {\n        priv->initpid = thepid;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to load init pid from state %s\"",
            "virGetLastErrorMessage()"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetLastErrorMessage",
          "args": [],
          "line": 335
        },
        "resolved": true,
        "details": {
          "function_name": "virGetLastErrorMessage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "316-325",
          "snippet": "const char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nconst char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXPathLongLong",
          "args": [
            "\"string(./init[1]/@pid)\"",
            "ctxt",
            "&thepid"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathLongLong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "444-476",
          "snippet": "int\nvirXPathLongLong(const char *xpath,\n                 xmlXPathContextPtr ctxt,\n                 long long *value)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret = 0;\n\n    if ((ctxt == NULL) || (xpath == NULL) || (value == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathLongLong()\"));\n        return -1;\n    }\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if ((obj != NULL) && (obj->type == XPATH_STRING) &&\n        (obj->stringval != NULL) && (obj->stringval[0] != 0)) {\n        if (virStrToLong_ll((char *) obj->stringval, NULL, 10, value) < 0)\n            ret = -2;\n    } else if ((obj != NULL) && (obj->type == XPATH_NUMBER) &&\n               (!(isnan(obj->floatval)))) {\n        *value = (long long) obj->floatval;\n        if (*value != obj->floatval)\n            ret = -2;\n    } else {\n        ret = -1;\n    }\n\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXPathLongLong(const char *xpath,\n                 xmlXPathContextPtr ctxt,\n                 long long *value)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret = 0;\n\n    if ((ctxt == NULL) || (xpath == NULL) || (value == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathLongLong()\"));\n        return -1;\n    }\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if ((obj != NULL) && (obj->type == XPATH_STRING) &&\n        (obj->stringval != NULL) && (obj->stringval[0] != 0)) {\n        if (virStrToLong_ll((char *) obj->stringval, NULL, 10, value) < 0)\n            ret = -2;\n    } else if ((obj != NULL) && (obj->type == XPATH_NUMBER) &&\n               (!(isnan(obj->floatval)))) {\n        *value = (long long) obj->floatval;\n        if (*value != obj->floatval)\n            ret = -2;\n    } else {\n        ret = -1;\n    }\n\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nvirLXCDomainObjPrivateXMLParse(xmlXPathContextPtr ctxt,\n                               virDomainObjPtr vm,\n                               virDomainDefParserConfigPtr config G_GNUC_UNUSED)\n{\n    virLXCDomainObjPrivatePtr priv = vm->privateData;\n    long long thepid;\n\n    if (virXPathLongLong(\"string(./init[1]/@pid)\", ctxt, &thepid) < 0) {\n        VIR_WARN(\"Failed to load init pid from state %s\",\n                 virGetLastErrorMessage());\n        priv->initpid = 0;\n    } else {\n        priv->initpid = thepid;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLXCDomainObjPrivateXMLFormat",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "313-323",
    "snippet": "static int\nvirLXCDomainObjPrivateXMLFormat(virBufferPtr buf,\n                                virDomainObjPtr vm)\n{\n    virLXCDomainObjPrivatePtr priv = vm->privateData;\n\n    virBufferAsprintf(buf, \"<init pid='%lld'/>\\n\",\n                      (long long)priv->initpid);\n\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "buf",
            "\"<init pid='%lld'/>\\n\"",
            "(long long)priv->initpid"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nvirLXCDomainObjPrivateXMLFormat(virBufferPtr buf,\n                                virDomainObjPtr vm)\n{\n    virLXCDomainObjPrivatePtr priv = vm->privateData;\n\n    virBufferAsprintf(buf, \"<init pid='%lld'/>\\n\",\n                      (long long)priv->initpid);\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcDomainDefNamespaceFormatXML",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "274-301",
    "snippet": "static int\nlxcDomainDefNamespaceFormatXML(virBufferPtr buf,\n                               void *nsdata)\n{\n    lxcDomainDefPtr lxcDef = nsdata;\n    size_t i;\n\n    if (!lxcDef)\n       return 0;\n\n    virBufferAddLit(buf, \"<lxc:namespace>\\n\");\n    virBufferAdjustIndent(buf, 2);\n\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++) {\n        if (lxcDef->ns_source[i] == VIR_LXC_DOMAIN_NAMESPACE_SOURCE_NONE)\n            continue;\n\n        virBufferAsprintf(buf, \"<lxc:%s type='%s' value='%s'/>\\n\",\n                          virLXCDomainNamespaceTypeToString(i),\n                          virLXCDomainNamespaceSourceTypeToString(\n                              lxcDef->ns_source[i]),\n                          lxcDef->ns_val[i]);\n    }\n\n    virBufferAdjustIndent(buf, -2);\n    virBufferAddLit(buf, \"</lxc:namespace>\\n\");\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "buf",
            "\"</lxc:namespace>\\n\""
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAdjustIndent",
          "args": [
            "buf",
            "-2"
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAdjustIndent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "43-62",
          "snippet": "void\nvirBufferAdjustIndent(virBufferPtr buf, int indent)\n{\n    if (!buf)\n        return;\n\n    if (indent > 0) {\n        if (INT_MAX - indent < buf->indent) {\n            buf->indent = INT_MAX;\n            return;\n        }\n    } else {\n        if (buf->indent < -indent) {\n            buf->indent = 0;\n            return;\n        }\n    }\n\n    buf->indent += indent;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAdjustIndent(virBufferPtr buf, int indent)\n{\n    if (!buf)\n        return;\n\n    if (indent > 0) {\n        if (INT_MAX - indent < buf->indent) {\n            buf->indent = INT_MAX;\n            return;\n        }\n    } else {\n        if (buf->indent < -indent) {\n            buf->indent = 0;\n            return;\n        }\n    }\n\n    buf->indent += indent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "buf",
            "\"<lxc:%s type='%s' value='%s'/>\\n\"",
            "virLXCDomainNamespaceTypeToString(i)",
            "virLXCDomainNamespaceSourceTypeToString(\n                              lxcDef->ns_source[i])",
            "lxcDef->ns_val[i]"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCDomainNamespaceSourceTypeToString",
          "args": [
            "lxcDef->ns_source[i]"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainNamespaceTypeToString",
          "args": [
            "i"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "buf",
            "\"<lxc:namespace>\\n\""
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nlxcDomainDefNamespaceFormatXML(virBufferPtr buf,\n                               void *nsdata)\n{\n    lxcDomainDefPtr lxcDef = nsdata;\n    size_t i;\n\n    if (!lxcDef)\n       return 0;\n\n    virBufferAddLit(buf, \"<lxc:namespace>\\n\");\n    virBufferAdjustIndent(buf, 2);\n\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++) {\n        if (lxcDef->ns_source[i] == VIR_LXC_DOMAIN_NAMESPACE_SOURCE_NONE)\n            continue;\n\n        virBufferAsprintf(buf, \"<lxc:%s type='%s' value='%s'/>\\n\",\n                          virLXCDomainNamespaceTypeToString(i),\n                          virLXCDomainNamespaceSourceTypeToString(\n                              lxcDef->ns_source[i]),\n                          lxcDef->ns_val[i]);\n    }\n\n    virBufferAdjustIndent(buf, -2);\n    virBufferAddLit(buf, \"</lxc:namespace>\\n\");\n    return 0;\n}"
  },
  {
    "function_name": "lxcDomainDefNamespaceParse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "206-271",
    "snippet": "static int\nlxcDomainDefNamespaceParse(xmlXPathContextPtr ctxt,\n                           void **data)\n{\n    lxcDomainDefPtr lxcDef = NULL;\n    xmlNodePtr *nodes = NULL;\n    bool uses_lxc_ns = false;\n    xmlNodePtr node;\n    int feature;\n    int n;\n    char *tmp = NULL;\n    size_t i;\n\n    if (VIR_ALLOC(lxcDef) < 0)\n        return -1;\n\n    node = ctxt->node;\n    if ((n = virXPathNodeSet(\"./lxc:namespace/*\", ctxt, &nodes)) < 0)\n        goto error;\n    uses_lxc_ns |= n > 0;\n\n    for (i = 0; i < n; i++) {\n        if ((feature = virLXCDomainNamespaceTypeFromString(\n                 (const char *)nodes[i]->name)) < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                            _(\"unsupported Namespace feature: %s\"),\n                            nodes[i]->name);\n            goto error;\n        }\n\n        ctxt->node = nodes[i];\n\n        if (!(tmp = virXMLPropString(nodes[i], \"type\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"No lxc environment type specified\"));\n            goto error;\n        }\n        if ((lxcDef->ns_source[feature] =\n             virLXCDomainNamespaceSourceTypeFromString(tmp)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Unknown LXC namespace source '%s'\"),\n                           tmp);\n            VIR_FREE(tmp);\n            goto error;\n        }\n        VIR_FREE(tmp);\n\n        if (!(lxcDef->ns_val[feature] =\n              virXMLPropString(nodes[i], \"value\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"No lxc environment type specified\"));\n            goto error;\n        }\n    }\n    VIR_FREE(nodes);\n    ctxt->node = node;\n    if (uses_lxc_ns)\n        *data = lxcDef;\n    else\n        VIR_FREE(lxcDef);\n    return 0;\n error:\n    VIR_FREE(nodes);\n    lxcDomainDefNamespaceFree(lxcDef);\n    return -1;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxcDomainDefNamespaceFree",
          "args": [
            "lxcDef"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "lxcDomainDefNamespaceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
          "lines": "196-204",
          "snippet": "static void\nlxcDomainDefNamespaceFree(void *nsdata)\n{\n    size_t i;\n    lxcDomainDefPtr lxcDef = nsdata;\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n        VIR_FREE(lxcDef->ns_val[i]);\n    VIR_FREE(nsdata);\n}",
          "includes": [
            "#include \"virinitctl.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nlxcDomainDefNamespaceFree(void *nsdata)\n{\n    size_t i;\n    lxcDomainDefPtr lxcDef = nsdata;\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n        VIR_FREE(lxcDef->ns_val[i]);\n    VIR_FREE(nsdata);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nodes"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lxcDef"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nodes"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"No lxc environment type specified\")"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"No lxc environment type specified\""
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXMLPropString",
          "args": [
            "nodes[i]",
            "\"value\""
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "virXMLPropString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "515-520",
          "snippet": "char *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unknown LXC namespace source '%s'\")",
            "tmp"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainNamespaceSourceTypeFromString",
          "args": [
            "tmp"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"No lxc environment type specified\")"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"unsupported Namespace feature: %s\")",
            "nodes[i]->name"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainNamespaceTypeFromString",
          "args": [
            "(const char *)nodes[i]->name"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virXPathNodeSet",
          "args": [
            "\"./lxc:namespace/*\"",
            "ctxt",
            "&nodes"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathNodeSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "647-694",
          "snippet": "int\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "lxcDef"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nlxcDomainDefNamespaceParse(xmlXPathContextPtr ctxt,\n                           void **data)\n{\n    lxcDomainDefPtr lxcDef = NULL;\n    xmlNodePtr *nodes = NULL;\n    bool uses_lxc_ns = false;\n    xmlNodePtr node;\n    int feature;\n    int n;\n    char *tmp = NULL;\n    size_t i;\n\n    if (VIR_ALLOC(lxcDef) < 0)\n        return -1;\n\n    node = ctxt->node;\n    if ((n = virXPathNodeSet(\"./lxc:namespace/*\", ctxt, &nodes)) < 0)\n        goto error;\n    uses_lxc_ns |= n > 0;\n\n    for (i = 0; i < n; i++) {\n        if ((feature = virLXCDomainNamespaceTypeFromString(\n                 (const char *)nodes[i]->name)) < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                            _(\"unsupported Namespace feature: %s\"),\n                            nodes[i]->name);\n            goto error;\n        }\n\n        ctxt->node = nodes[i];\n\n        if (!(tmp = virXMLPropString(nodes[i], \"type\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"No lxc environment type specified\"));\n            goto error;\n        }\n        if ((lxcDef->ns_source[feature] =\n             virLXCDomainNamespaceSourceTypeFromString(tmp)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Unknown LXC namespace source '%s'\"),\n                           tmp);\n            VIR_FREE(tmp);\n            goto error;\n        }\n        VIR_FREE(tmp);\n\n        if (!(lxcDef->ns_val[feature] =\n              virXMLPropString(nodes[i], \"value\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"No lxc environment type specified\"));\n            goto error;\n        }\n    }\n    VIR_FREE(nodes);\n    ctxt->node = node;\n    if (uses_lxc_ns)\n        *data = lxcDef;\n    else\n        VIR_FREE(lxcDef);\n    return 0;\n error:\n    VIR_FREE(nodes);\n    lxcDomainDefNamespaceFree(lxcDef);\n    return -1;\n}"
  },
  {
    "function_name": "lxcDomainDefNamespaceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "196-204",
    "snippet": "static void\nlxcDomainDefNamespaceFree(void *nsdata)\n{\n    size_t i;\n    lxcDomainDefPtr lxcDef = nsdata;\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n        VIR_FREE(lxcDef->ns_val[i]);\n    VIR_FREE(nsdata);\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nsdata"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lxcDef->ns_val[i]"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nlxcDomainDefNamespaceFree(void *nsdata)\n{\n    size_t i;\n    lxcDomainDefPtr lxcDef = nsdata;\n    for (i = 0; i < VIR_LXC_DOMAIN_NAMESPACE_LAST; i++)\n        VIR_FREE(lxcDef->ns_val[i]);\n    VIR_FREE(nsdata);\n}"
  },
  {
    "function_name": "virLXCDomainObjPrivateFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "169-177",
    "snippet": "static void\nvirLXCDomainObjPrivateFree(void *data)\n{\n    virLXCDomainObjPrivatePtr priv = data;\n\n    virCgroupFree(&priv->cgroup);\n    virLXCDomainObjFreeJob(priv);\n    VIR_FREE(priv);\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainObjFreeJob",
          "args": [
            "priv"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCDomainObjFreeJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
          "lines": "67-71",
          "snippet": "static void\nvirLXCDomainObjFreeJob(virLXCDomainObjPrivatePtr priv)\n{\n    ignore_value(virCondDestroy(&priv->job.cond));\n}",
          "includes": [
            "#include \"virinitctl.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nvirLXCDomainObjFreeJob(virLXCDomainObjPrivatePtr priv)\n{\n    ignore_value(virCondDestroy(&priv->job.cond));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupFree",
          "args": [
            "&priv->cgroup"
          ],
          "line": 174
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "3544-3563",
          "snippet": "void\nvirCgroupFree(virCgroupPtr *group)\n{\n    size_t i;\n\n    if (*group == NULL)\n        return;\n\n    for (i = 0; i < VIR_CGROUP_CONTROLLER_LAST; i++) {\n        VIR_FREE((*group)->legacy[i].mountPoint);\n        VIR_FREE((*group)->legacy[i].linkPoint);\n        VIR_FREE((*group)->legacy[i].placement);\n    }\n\n    VIR_FREE((*group)->unified.mountPoint);\n    VIR_FREE((*group)->unified.placement);\n\n    VIR_FREE((*group)->path);\n    VIR_FREE(*group);\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nvoid\nvirCgroupFree(virCgroupPtr *group)\n{\n    size_t i;\n\n    if (*group == NULL)\n        return;\n\n    for (i = 0; i < VIR_CGROUP_CONTROLLER_LAST; i++) {\n        VIR_FREE((*group)->legacy[i].mountPoint);\n        VIR_FREE((*group)->legacy[i].linkPoint);\n        VIR_FREE((*group)->legacy[i].placement);\n    }\n\n    VIR_FREE((*group)->unified.mountPoint);\n    VIR_FREE((*group)->unified.placement);\n\n    VIR_FREE((*group)->path);\n    VIR_FREE(*group);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nvirLXCDomainObjPrivateFree(void *data)\n{\n    virLXCDomainObjPrivatePtr priv = data;\n\n    virCgroupFree(&priv->cgroup);\n    virLXCDomainObjFreeJob(priv);\n    VIR_FREE(priv);\n}"
  },
  {
    "function_name": "virLXCDomainObjPrivateAlloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "152-166",
    "snippet": "static void *\nvirLXCDomainObjPrivateAlloc(void *opaque G_GNUC_UNUSED)\n{\n    virLXCDomainObjPrivatePtr priv;\n\n    if (VIR_ALLOC(priv) < 0)\n        return NULL;\n\n    if (virLXCDomainObjInitJob(priv) < 0) {\n        VIR_FREE(priv);\n        return NULL;\n    }\n\n    return priv;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainObjInitJob",
          "args": [
            "priv"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCDomainObjInitJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
          "lines": "47-56",
          "snippet": "static int\nvirLXCDomainObjInitJob(virLXCDomainObjPrivatePtr priv)\n{\n    memset(&priv->job, 0, sizeof(priv->job));\n\n    if (virCondInit(&priv->job.cond) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virinitctl.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nvirLXCDomainObjInitJob(virLXCDomainObjPrivatePtr priv)\n{\n    memset(&priv->job, 0, sizeof(priv->job));\n\n    if (virCondInit(&priv->job.cond) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "priv"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void *\nvirLXCDomainObjPrivateAlloc(void *opaque G_GNUC_UNUSED)\n{\n    virLXCDomainObjPrivatePtr priv;\n\n    if (VIR_ALLOC(priv) < 0)\n        return NULL;\n\n    if (virLXCDomainObjInitJob(priv) < 0) {\n        VIR_FREE(priv);\n        return NULL;\n    }\n\n    return priv;\n}"
  },
  {
    "function_name": "virLXCDomainObjEndJob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "137-149",
    "snippet": "void\nvirLXCDomainObjEndJob(virLXCDriverPtr driver G_GNUC_UNUSED,\n                     virDomainObjPtr obj)\n{\n    virLXCDomainObjPrivatePtr priv = obj->privateData;\n    enum virLXCDomainJob job = priv->job.active;\n\n    VIR_DEBUG(\"Stopping job: %s\",\n              virLXCDomainJobTypeToString(job));\n\n    virLXCDomainObjResetJob(priv);\n    virCondSignal(&priv->job.cond);\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCondSignal",
          "args": [
            "&priv->job.cond"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "virCondSignal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "170-173",
          "snippet": "void virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLXCDomainObjResetJob",
          "args": [
            "priv"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCDomainObjResetJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
          "lines": "58-65",
          "snippet": "static void\nvirLXCDomainObjResetJob(virLXCDomainObjPrivatePtr priv)\n{\n    struct virLXCDomainJobObj *job = &priv->job;\n\n    job->active = LXC_JOB_NONE;\n    job->owner = 0;\n}",
          "includes": [
            "#include \"virinitctl.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nvirLXCDomainObjResetJob(virLXCDomainObjPrivatePtr priv)\n{\n    struct virLXCDomainJobObj *job = &priv->job;\n\n    job->active = LXC_JOB_NONE;\n    job->owner = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Stopping job: %s\"",
            "virLXCDomainJobTypeToString(job)"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainJobTypeToString",
          "args": [
            "job"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nvoid\nvirLXCDomainObjEndJob(virLXCDriverPtr driver G_GNUC_UNUSED,\n                     virDomainObjPtr obj)\n{\n    virLXCDomainObjPrivatePtr priv = obj->privateData;\n    enum virLXCDomainJob job = priv->job.active;\n\n    VIR_DEBUG(\"Stopping job: %s\",\n              virLXCDomainJobTypeToString(job));\n\n    virLXCDomainObjResetJob(priv);\n    virCondSignal(&priv->job.cond);\n}"
  },
  {
    "function_name": "virLXCDomainObjBeginJob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "85-128",
    "snippet": "int\nvirLXCDomainObjBeginJob(virLXCDriverPtr driver G_GNUC_UNUSED,\n                       virDomainObjPtr obj,\n                       enum virLXCDomainJob job)\n{\n    virLXCDomainObjPrivatePtr priv = obj->privateData;\n    unsigned long long now;\n    unsigned long long then;\n\n    if (virTimeMillisNow(&now) < 0)\n        return -1;\n    then = now + LXC_JOB_WAIT_TIME;\n\n    while (priv->job.active) {\n        VIR_DEBUG(\"Wait normal job condition for starting job: %s\",\n                  virLXCDomainJobTypeToString(job));\n        if (virCondWaitUntil(&priv->job.cond, &obj->parent.lock, then) < 0)\n            goto error;\n    }\n\n    virLXCDomainObjResetJob(priv);\n\n    VIR_DEBUG(\"Starting job: %s\", virLXCDomainJobTypeToString(job));\n    priv->job.active = job;\n    priv->job.owner = virThreadSelfID();\n\n    return 0;\n\n error:\n    VIR_WARN(\"Cannot start job (%s) for domain %s;\"\n             \" current job is (%s) owned by (%d)\",\n             virLXCDomainJobTypeToString(job),\n             obj->def->name,\n             virLXCDomainJobTypeToString(priv->job.active),\n             priv->job.owner);\n\n    if (errno == ETIMEDOUT)\n        virReportError(VIR_ERR_OPERATION_TIMEOUT,\n                       \"%s\", _(\"cannot acquire state change lock\"));\n    else\n        virReportSystemError(errno,\n                             \"%s\", _(\"cannot acquire job mutex\"));\n    return -1;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define LXC_JOB_WAIT_TIME (1000ull * 30)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"cannot acquire job mutex\")"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot acquire job mutex\""
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_TIMEOUT",
            "\"%s\"",
            "_(\"cannot acquire state change lock\")"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Cannot start job (%s) for domain %s;\"\n             \" current job is (%s) owned by (%d)\"",
            "virLXCDomainJobTypeToString(job)",
            "obj->def->name",
            "virLXCDomainJobTypeToString(priv->job.active)",
            "priv->job.owner"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainJobTypeToString",
          "args": [
            "priv->job.active"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainJobTypeToString",
          "args": [
            "job"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virThreadSelfID",
          "args": [],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadSelfID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "298-311",
          "snippet": "unsigned long long virThreadSelfID(void)\n{\n#if defined(HAVE_SYS_SYSCALL_H) && defined(SYS_gettid) && defined(__linux__)\n    pid_t tid = syscall(SYS_gettid);\n    return tid;\n#else\n    union {\n        unsigned long long l;\n        pthread_t t;\n    } u;\n    u.t = pthread_self();\n    return u.l;\n#endif\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nunsigned long long virThreadSelfID(void)\n{\n#if defined(HAVE_SYS_SYSCALL_H) && defined(SYS_gettid) && defined(__linux__)\n    pid_t tid = syscall(SYS_gettid);\n    return tid;\n#else\n    union {\n        unsigned long long l;\n        pthread_t t;\n    } u;\n    u.t = pthread_self();\n    return u.l;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Starting job: %s\"",
            "virLXCDomainJobTypeToString(job)"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainJobTypeToString",
          "args": [
            "job"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainObjResetJob",
          "args": [
            "priv"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "virLXCDomainObjResetJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
          "lines": "58-65",
          "snippet": "static void\nvirLXCDomainObjResetJob(virLXCDomainObjPrivatePtr priv)\n{\n    struct virLXCDomainJobObj *job = &priv->job;\n\n    job->active = LXC_JOB_NONE;\n    job->owner = 0;\n}",
          "includes": [
            "#include \"virinitctl.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nvirLXCDomainObjResetJob(virLXCDomainObjPrivatePtr priv)\n{\n    struct virLXCDomainJobObj *job = &priv->job;\n\n    job->active = LXC_JOB_NONE;\n    job->owner = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondWaitUntil",
          "args": [
            "&priv->job.cond",
            "&obj->parent.lock",
            "then"
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "virCondWaitUntil",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "155-168",
          "snippet": "int virCondWaitUntil(virCondPtr c, virMutexPtr m, unsigned long long whenms)\n{\n    int ret;\n    struct timespec ts;\n\n    ts.tv_sec = whenms / 1000;\n    ts.tv_nsec = (whenms % 1000) * 1000000;\n\n    if ((ret = pthread_cond_timedwait(&c->cond, &m->lock, &ts)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondWaitUntil(virCondPtr c, virMutexPtr m, unsigned long long whenms)\n{\n    int ret;\n    struct timespec ts;\n\n    ts.tv_sec = whenms / 1000;\n    ts.tv_nsec = (whenms % 1000) * 1000000;\n\n    if ((ret = pthread_cond_timedwait(&c->cond, &m->lock, &ts)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Wait normal job condition for starting job: %s\"",
            "virLXCDomainJobTypeToString(job)"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLXCDomainJobTypeToString",
          "args": [
            "job"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virTimeMillisNow",
          "args": [
            "&now"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeMillisNow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "214-222",
          "snippet": "int virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\n#define LXC_JOB_WAIT_TIME (1000ull * 30)\n\nint\nvirLXCDomainObjBeginJob(virLXCDriverPtr driver G_GNUC_UNUSED,\n                       virDomainObjPtr obj,\n                       enum virLXCDomainJob job)\n{\n    virLXCDomainObjPrivatePtr priv = obj->privateData;\n    unsigned long long now;\n    unsigned long long then;\n\n    if (virTimeMillisNow(&now) < 0)\n        return -1;\n    then = now + LXC_JOB_WAIT_TIME;\n\n    while (priv->job.active) {\n        VIR_DEBUG(\"Wait normal job condition for starting job: %s\",\n                  virLXCDomainJobTypeToString(job));\n        if (virCondWaitUntil(&priv->job.cond, &obj->parent.lock, then) < 0)\n            goto error;\n    }\n\n    virLXCDomainObjResetJob(priv);\n\n    VIR_DEBUG(\"Starting job: %s\", virLXCDomainJobTypeToString(job));\n    priv->job.active = job;\n    priv->job.owner = virThreadSelfID();\n\n    return 0;\n\n error:\n    VIR_WARN(\"Cannot start job (%s) for domain %s;\"\n             \" current job is (%s) owned by (%d)\",\n             virLXCDomainJobTypeToString(job),\n             obj->def->name,\n             virLXCDomainJobTypeToString(priv->job.active),\n             priv->job.owner);\n\n    if (errno == ETIMEDOUT)\n        virReportError(VIR_ERR_OPERATION_TIMEOUT,\n                       \"%s\", _(\"cannot acquire state change lock\"));\n    else\n        virReportSystemError(errno,\n                             \"%s\", _(\"cannot acquire job mutex\"));\n    return -1;\n}"
  },
  {
    "function_name": "virLXCDomainObjFreeJob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "67-71",
    "snippet": "static void\nvirLXCDomainObjFreeJob(virLXCDomainObjPrivatePtr priv)\n{\n    ignore_value(virCondDestroy(&priv->job.cond));\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virCondDestroy(&priv->job.cond)"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCondDestroy",
          "args": [
            "&priv->job.cond"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "virCondDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "135-143",
          "snippet": "int virCondDestroy(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_destroy(&c->cond)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondDestroy(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_destroy(&c->cond)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nvirLXCDomainObjFreeJob(virLXCDomainObjPrivatePtr priv)\n{\n    ignore_value(virCondDestroy(&priv->job.cond));\n}"
  },
  {
    "function_name": "virLXCDomainObjResetJob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "58-65",
    "snippet": "static void\nvirLXCDomainObjResetJob(virLXCDomainObjPrivatePtr priv)\n{\n    struct virLXCDomainJobObj *job = &priv->job;\n\n    job->active = LXC_JOB_NONE;\n    job->owner = 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic void\nvirLXCDomainObjResetJob(virLXCDomainObjPrivatePtr priv)\n{\n    struct virLXCDomainJobObj *job = &priv->job;\n\n    job->active = LXC_JOB_NONE;\n    job->owner = 0;\n}"
  },
  {
    "function_name": "virLXCDomainObjInitJob",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_domain.c",
    "lines": "47-56",
    "snippet": "static int\nvirLXCDomainObjInitJob(virLXCDomainObjPrivatePtr priv)\n{\n    memset(&priv->job, 0, sizeof(priv->job));\n\n    if (virCondInit(&priv->job.cond) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virinitctl.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virtime.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCondInit",
          "args": [
            "&priv->job.cond"
          ],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "virCondInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "125-133",
          "snippet": "int virCondInit(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_init(&c->cond, NULL)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondInit(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_init(&c->cond, NULL)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&priv->job",
            "0",
            "sizeof(priv->job)"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virinitctl.h\"\n#include \"virsystemd.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"lxc_domain.h\"\n#include <config.h>\n\nstatic int\nvirLXCDomainObjInitJob(virLXCDomainObjPrivatePtr priv)\n{\n    memset(&priv->job, 0, sizeof(priv->job));\n\n    if (virCondInit(&priv->job.cond) < 0)\n        return -1;\n\n    return 0;\n}"
  }
]