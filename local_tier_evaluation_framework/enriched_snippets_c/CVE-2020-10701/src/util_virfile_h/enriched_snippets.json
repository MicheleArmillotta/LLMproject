[
  {
    "function_name": "virFileChownFiles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.h",
    "lines": "249-375",
    "snippet": "int virFileChownFiles(const char *name, uid_t uid, gid_t gid)\n    ATTRIBUTE_NONNULL(1) G_GNUC_WARN_UNUSED_RESULT;\n\nenum {\n    VIR_DIR_CREATE_NONE        = 0,\n    VIR_DIR_CREATE_AS_UID      = (1 << 0),\n    VIR_DIR_CREATE_ALLOW_EXIST = (1 << 1),\n};\nint virDirCreate(const char *path, mode_t mode, uid_t uid, gid_t gid,\n                 unsigned int flags) G_GNUC_WARN_UNUSED_RESULT;\nint virDirOpen(DIR **dirp, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nint virDirOpenIfExists(DIR **dirp, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nint virDirOpenQuiet(DIR **dirp, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nint virDirRead(DIR *dirp, struct dirent **ent, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nvoid virDirClose(DIR **dirp)\n    ATTRIBUTE_NONNULL(1);\n#define VIR_DIR_CLOSE(dir)  virDirClose(&(dir))\n\nint virFileMakePath(const char *path) G_GNUC_WARN_UNUSED_RESULT;\nint virFileMakePathWithMode(const char *path,\n                            mode_t mode) G_GNUC_WARN_UNUSED_RESULT;\nint virFileMakeParentPath(const char *path) G_GNUC_WARN_UNUSED_RESULT;\n\nchar *virFileBuildPath(const char *dir,\n                       const char *name,\n                       const char *ext) G_GNUC_WARN_UNUSED_RESULT;\n\n\nint virFileAbsPath(const char *path,\n                   char **abspath) G_GNUC_WARN_UNUSED_RESULT;\nvoid virFileRemoveLastComponent(char *path);\n\nint virFileOpenTty(int *ttymaster,\n                   char **ttyName,\n                   int rawmode);\n\nchar *virFileFindMountPoint(const char *type);\n\n/* NB: this should be combined with virFileBuildPath */\n#define virBuildPath(path, ...) \\\n    virBuildPathInternal(path, __VA_ARGS__, NULL)\nint virBuildPathInternal(char **path, ...) G_GNUC_NULL_TERMINATED;\n\ntypedef struct _virHugeTLBFS virHugeTLBFS;\ntypedef virHugeTLBFS *virHugeTLBFSPtr;\nstruct _virHugeTLBFS {\n    char *mnt_dir;                  /* Where the FS is mount to */\n    unsigned long long size;        /* page size in kibibytes */\n    bool deflt;                     /* is this the default huge page size */\n};\n\nint virFileGetHugepageSize(const char *path,\n                           unsigned long long *size);\nint virFileFindHugeTLBFS(virHugeTLBFSPtr *ret_fs,\n                         size_t *ret_nfs);\n\nvirHugeTLBFSPtr virFileGetDefaultHugepage(virHugeTLBFSPtr fs,\n                                          size_t nfs);\n\nint virFileSetupDev(const char *path,\n                    const char *mount_options);\n\nint virFileBindMountDevice(const char *src,\n                           const char *dst);\n\nint virFileMoveMount(const char *src,\n                     const char *dst);\n\nint virFileGetACLs(const char *file,\n                   void **acl);\n\nint virFileSetACLs(const char *file,\n                   void *acl);\n\nvoid virFileFreeACLs(void **acl);\n\nint virFileCopyACLs(const char *src,\n                    const char *dst);\n\nint virFileComparePaths(const char *p1, const char *p2);\n\nint virFileReadValueInt(int *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueUint(unsigned int *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueUllong(unsigned long long *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueBitmap(virBitmapPtr *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueScaledInt(unsigned long long *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueString(char **value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\n\nint virFileWaitForExists(const char *path, size_t ms, size_t tries);\n\n\nint virFileInData(int fd,\n                  int *inData,\n                  long long *length);\n\nG_DEFINE_AUTOPTR_CLEANUP_FUNC(virFileWrapperFd, virFileWrapperFdFree);\n\nint virFileGetXAttr(const char *path,\n                    const char *name,\n                    char **value)\n    G_GNUC_NO_INLINE;\n\nint virFileGetXAttrQuiet(const char *path,\n                         const char *name,\n                         char **value)\n    G_GNUC_NO_INLINE;\n\nint virFileSetXAttr(const char *path,\n                    const char *name,\n                    const char *value)\n    G_GNUC_NO_INLINE;\n\nint virFileRemoveXAttr(const char *path,\n                       const char *name)\n    G_GNUC_NO_INLINE;\n\nint virFileDataSync(int fd);",
    "includes": [
      "#include \"virstoragefile.h\"",
      "#include \"virbitmap.h\"",
      "#include \"internal.h\"",
      "#include <dirent.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "FILE *virFileFdopen(int *fdptr, const char *mode) G_GNUC_WARN_UNUSED_RESULT;",
      "int virFileTouch(const char *path, mode_t mode);",
      "int virFileDeleteTree(const char *dir);",
      "char *virFindFileInPath(const char *file);",
      "char *virFileFindResource(const char *filename,\n                          const char *builddir,\n                          const char *installdir)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) ATTRIBUTE_NONNULL(3);",
      "char *virFileFindResourceFull(const char *filename,\n                              const char *prefix,\n                              const char *suffix,\n                              const char *builddir,\n                              const char *installdir,\n                              const char *envname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(4) ATTRIBUTE_NONNULL(5);",
      "char *virFileSanitizePath(const char *path);",
      "char *virFileCanonicalizePath(const char *path) G_GNUC_NO_INLINE;",
      "int virFileRemove(const char *path, uid_t uid, gid_t gid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "G_DEFINE_AUTOPTR_CLEANUP_FUNC",
          "args": [
            "virFileWrapperFd",
            "virFileWrapperFdFree"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_GNUC_PRINTF",
          "args": [
            "2",
            "3"
          ],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "G_GNUC_PRINTF",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtypedparam.c",
          "lines": "751-796",
          "snippet": "static int G_GNUC_PRINTF(2, 0)\nvirTypedParamSetNameVPrintf(virTypedParameterPtr par,\n                            const char *fmt,\n                            va_list ap)\n{\n    if (g_vsnprintf(par->field, VIR_TYPED_PARAM_FIELD_LENGTH, fmt, ap) > VIR_TYPED_PARAM_FIELD_LENGTH) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\", _(\"Field name too long\"));\n        return -1;\n    }\n\n    return 0;\n}\n\n\nstatic virTypedParameterPtr\nvirTypedParamListExtend(virTypedParamListPtr list)\n{\n    if (VIR_RESIZE_N(list->par, list->par_alloc, list->npar, 1) < 0)\n        return NULL;\n\n    list->npar++;\n\n    return list->par + (list->npar - 1);\n}\n\n\nint\nvirTypedParamListAddInt(virTypedParamListPtr list,\n                        int value,\n                        const char *namefmt,\n                        ...)\n{\n    virTypedParameterPtr par;\n    va_list ap;\n    int ret;\n\n    if (!(par = virTypedParamListExtend(list)) ||\n        virTypedParameterAssignValue(par, true, VIR_TYPED_PARAM_INT, value) < 0)\n        return -1;\n\n    va_start(ap, namefmt);\n    ret = virTypedParamSetNameVPrintf(par, namefmt, ap);\n    va_end(ap);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <stdarg.h>",
            "#include \"virtypedparam.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <stdarg.h>\n#include \"virtypedparam.h\"\n#include <config.h>\n\nstatic int G_GNUC_PRINTF(2, 0)\nvirTypedParamSetNameVPrintf(virTypedParameterPtr par,\n                            const char *fmt,\n                            va_list ap)\n{\n    if (g_vsnprintf(par->field, VIR_TYPED_PARAM_FIELD_LENGTH, fmt, ap) > VIR_TYPED_PARAM_FIELD_LENGTH) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\", _(\"Field name too long\"));\n        return -1;\n    }\n\n    return 0;\n}\n\n\nstatic virTypedParameterPtr\nvirTypedParamListExtend(virTypedParamListPtr list)\n{\n    if (VIR_RESIZE_N(list->par, list->par_alloc, list->npar, 1) < 0)\n        return NULL;\n\n    list->npar++;\n\n    return list->par + (list->npar - 1);\n}\n\n\nint\nvirTypedParamListAddInt(virTypedParamListPtr list,\n                        int value,\n                        const char *namefmt,\n                        ...)\n{\n    virTypedParameterPtr par;\n    va_list ap;\n    int ret;\n\n    if (!(par = virTypedParamListExtend(list)) ||\n        virTypedParameterAssignValue(par, true, VIR_TYPED_PARAM_INT, value) < 0)\n        return -1;\n\n    va_start(ap, namefmt);\n    ret = virTypedParamSetNameVPrintf(par, namefmt, ap);\n    va_end(ap);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ATTRIBUTE_NONNULL",
          "args": [
            "1"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "ATTRIBUTE_NONNULL",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevbandwidth.c",
          "lines": "96-114",
          "snippet": "static int ATTRIBUTE_NONNULL(1)\nvirNetDevBandwidthManipulateFilter(const char *ifname,\n                                   const virMacAddr *ifmac_ptr,\n                                   unsigned int id,\n                                   const char *class_id,\n                                   bool remove_old,\n                                   bool create_new)\n{\n    int ret = -1;\n    char *filter_id = NULL;\n    virCommandPtr cmd = NULL;\n    unsigned char ifmac[VIR_MAC_BUFLEN];\n    char *mac[2] = {NULL, NULL};\n\n    if (!(remove_old || create_new)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"filter creation API error\"));\n        goto cleanup;\n    }",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnetdevbandwidth.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virnetdevbandwidth.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic int ATTRIBUTE_NONNULL(1)\nvirNetDevBandwidthManipulateFilter(const char *ifname,\n                                   const virMacAddr *ifmac_ptr,\n                                   unsigned int id,\n                                   const char *class_id,\n                                   bool remove_old,\n                                   bool create_new)\n{\n    int ret = -1;\n    char *filter_id = NULL;\n    virCommandPtr cmd = NULL;\n    unsigned char ifmac[VIR_MAC_BUFLEN];\n    char *mac[2] = {NULL, NULL};\n\n    if (!(remove_old || create_new)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"filter creation API error\"));\n        goto cleanup;\n    }"
        }
      }
    ],
    "contextual_snippet": "#include \"virstoragefile.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include <dirent.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode) G_GNUC_WARN_UNUSED_RESULT;\nint virFileTouch(const char *path, mode_t mode);\nint virFileDeleteTree(const char *dir);\nchar *virFindFileInPath(const char *file);\nchar *virFileFindResource(const char *filename,\n                          const char *builddir,\n                          const char *installdir)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) ATTRIBUTE_NONNULL(3);\nchar *virFileFindResourceFull(const char *filename,\n                              const char *prefix,\n                              const char *suffix,\n                              const char *builddir,\n                              const char *installdir,\n                              const char *envname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(4) ATTRIBUTE_NONNULL(5);\nchar *virFileSanitizePath(const char *path);\nchar *virFileCanonicalizePath(const char *path) G_GNUC_NO_INLINE;\nint virFileRemove(const char *path, uid_t uid, gid_t gid);\n\nint virFileChownFiles(const char *name, uid_t uid, gid_t gid)\n    ATTRIBUTE_NONNULL(1) G_GNUC_WARN_UNUSED_RESULT;\n\nenum {\n    VIR_DIR_CREATE_NONE        = 0,\n    VIR_DIR_CREATE_AS_UID      = (1 << 0),\n    VIR_DIR_CREATE_ALLOW_EXIST = (1 << 1),\n};\nint virDirCreate(const char *path, mode_t mode, uid_t uid, gid_t gid,\n                 unsigned int flags) G_GNUC_WARN_UNUSED_RESULT;\nint virDirOpen(DIR **dirp, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nint virDirOpenIfExists(DIR **dirp, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nint virDirOpenQuiet(DIR **dirp, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nint virDirRead(DIR *dirp, struct dirent **ent, const char *dirname)\n    ATTRIBUTE_NONNULL(1) ATTRIBUTE_NONNULL(2) G_GNUC_WARN_UNUSED_RESULT;\nvoid virDirClose(DIR **dirp)\n    ATTRIBUTE_NONNULL(1);\n#define VIR_DIR_CLOSE(dir)  virDirClose(&(dir))\n\nint virFileMakePath(const char *path) G_GNUC_WARN_UNUSED_RESULT;\nint virFileMakePathWithMode(const char *path,\n                            mode_t mode) G_GNUC_WARN_UNUSED_RESULT;\nint virFileMakeParentPath(const char *path) G_GNUC_WARN_UNUSED_RESULT;\n\nchar *virFileBuildPath(const char *dir,\n                       const char *name,\n                       const char *ext) G_GNUC_WARN_UNUSED_RESULT;\n\n\nint virFileAbsPath(const char *path,\n                   char **abspath) G_GNUC_WARN_UNUSED_RESULT;\nvoid virFileRemoveLastComponent(char *path);\n\nint virFileOpenTty(int *ttymaster,\n                   char **ttyName,\n                   int rawmode);\n\nchar *virFileFindMountPoint(const char *type);\n\n/* NB: this should be combined with virFileBuildPath */\n#define virBuildPath(path, ...) \\\n    virBuildPathInternal(path, __VA_ARGS__, NULL)\nint virBuildPathInternal(char **path, ...) G_GNUC_NULL_TERMINATED;\n\ntypedef struct _virHugeTLBFS virHugeTLBFS;\ntypedef virHugeTLBFS *virHugeTLBFSPtr;\nstruct _virHugeTLBFS {\n    char *mnt_dir;                  /* Where the FS is mount to */\n    unsigned long long size;        /* page size in kibibytes */\n    bool deflt;                     /* is this the default huge page size */\n};\n\nint virFileGetHugepageSize(const char *path,\n                           unsigned long long *size);\nint virFileFindHugeTLBFS(virHugeTLBFSPtr *ret_fs,\n                         size_t *ret_nfs);\n\nvirHugeTLBFSPtr virFileGetDefaultHugepage(virHugeTLBFSPtr fs,\n                                          size_t nfs);\n\nint virFileSetupDev(const char *path,\n                    const char *mount_options);\n\nint virFileBindMountDevice(const char *src,\n                           const char *dst);\n\nint virFileMoveMount(const char *src,\n                     const char *dst);\n\nint virFileGetACLs(const char *file,\n                   void **acl);\n\nint virFileSetACLs(const char *file,\n                   void *acl);\n\nvoid virFileFreeACLs(void **acl);\n\nint virFileCopyACLs(const char *src,\n                    const char *dst);\n\nint virFileComparePaths(const char *p1, const char *p2);\n\nint virFileReadValueInt(int *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueUint(unsigned int *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueUllong(unsigned long long *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueBitmap(virBitmapPtr *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueScaledInt(unsigned long long *value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\nint virFileReadValueString(char **value, const char *format, ...)\n G_GNUC_PRINTF(2, 3);\n\nint virFileWaitForExists(const char *path, size_t ms, size_t tries);\n\n\nint virFileInData(int fd,\n                  int *inData,\n                  long long *length);\n\nG_DEFINE_AUTOPTR_CLEANUP_FUNC(virFileWrapperFd, virFileWrapperFdFree);\n\nint virFileGetXAttr(const char *path,\n                    const char *name,\n                    char **value)\n    G_GNUC_NO_INLINE;\n\nint virFileGetXAttrQuiet(const char *path,\n                         const char *name,\n                         char **value)\n    G_GNUC_NO_INLINE;\n\nint virFileSetXAttr(const char *path,\n                    const char *name,\n                    const char *value)\n    G_GNUC_NO_INLINE;\n\nint virFileRemoveXAttr(const char *path,\n                       const char *name)\n    G_GNUC_NO_INLINE;\n\nint virFileDataSync(int fd);"
  },
  {
    "function_name": "virForceCloseHelper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.h",
    "lines": "53-56",
    "snippet": "static inline void virForceCloseHelper(int *fd)\n{\n    ignore_value(virFileClose(fd, VIR_FILE_CLOSE_PRESERVE_ERRNO));\n}",
    "includes": [
      "#include \"virstoragefile.h\"",
      "#include \"virbitmap.h\"",
      "#include \"internal.h\"",
      "#include <dirent.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virFileClose(fd, VIR_FILE_CLOSE_PRESERVE_ERRNO)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileClose",
          "args": [
            "fd",
            "VIR_FILE_CLOSE_PRESERVE_ERRNO"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "virFileClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "111-143",
          "snippet": "int virFileClose(int *fdptr, virFileCloseFlags flags)\n{\n    int saved_errno = 0;\n    int rc = 0;\n\n    if (*fdptr < 0)\n        return 0;\n\n    if (flags & VIR_FILE_CLOSE_PRESERVE_ERRNO)\n        saved_errno = errno;\n\n    rc = close(*fdptr);\n\n    if (!(flags & VIR_FILE_CLOSE_DONT_LOG)) {\n        if (rc < 0) {\n            if (errno == EBADF) {\n                if (!(flags & VIR_FILE_CLOSE_IGNORE_EBADF))\n                    VIR_WARN(\"Tried to close invalid fd %d\", *fdptr);\n            } else {\n                VIR_DEBUG(\"Failed to close fd %d: %s\",\n                          *fdptr, g_strerror(errno));\n            }\n        } else {\n            VIR_DEBUG(\"Closed fd %d\", *fdptr);\n        }\n    }\n    *fdptr = -1;\n\n    if (flags & VIR_FILE_CLOSE_PRESERVE_ERRNO)\n        errno = saved_errno;\n\n    return rc;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileClose(int *fdptr, virFileCloseFlags flags)\n{\n    int saved_errno = 0;\n    int rc = 0;\n\n    if (*fdptr < 0)\n        return 0;\n\n    if (flags & VIR_FILE_CLOSE_PRESERVE_ERRNO)\n        saved_errno = errno;\n\n    rc = close(*fdptr);\n\n    if (!(flags & VIR_FILE_CLOSE_DONT_LOG)) {\n        if (rc < 0) {\n            if (errno == EBADF) {\n                if (!(flags & VIR_FILE_CLOSE_IGNORE_EBADF))\n                    VIR_WARN(\"Tried to close invalid fd %d\", *fdptr);\n            } else {\n                VIR_DEBUG(\"Failed to close fd %d: %s\",\n                          *fdptr, g_strerror(errno));\n            }\n        } else {\n            VIR_DEBUG(\"Closed fd %d\", *fdptr);\n        }\n    }\n    *fdptr = -1;\n\n    if (flags & VIR_FILE_CLOSE_PRESERVE_ERRNO)\n        errno = saved_errno;\n\n    return rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstoragefile.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include <dirent.h>\n\nstatic inline void virForceCloseHelper(int *fd)\n{\n    ignore_value(virFileClose(fd, VIR_FILE_CLOSE_PRESERVE_ERRNO));\n}"
  }
]