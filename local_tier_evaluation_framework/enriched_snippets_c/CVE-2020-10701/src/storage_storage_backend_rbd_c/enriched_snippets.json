[
  {
    "function_name": "virStorageBackendRBDRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1488-1496",
    "snippet": "int\nvirStorageBackendRBDRegister(void)\n{\n    if (virStorageBackendRegister(&virStorageBackendRBD) < 0)\n        return -1;\n\n    return virStorageBackendNamespaceInit(VIR_STORAGE_POOL_RBD,\n                                          &virStoragePoolRBDXMLNamespace);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendNamespaceInit",
          "args": [
            "VIR_STORAGE_POOL_RBD",
            "&virStoragePoolRBDXMLNamespace"
          ],
          "line": 1494
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendNamespaceInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "93-98",
          "snippet": "int\nvirStorageBackendNamespaceInit(int poolType,\n                               virXMLNamespacePtr xmlns)\n{\n    return virStoragePoolOptionsPoolTypeSetXMLNamespace(poolType, xmlns);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendNamespaceInit(int poolType,\n                               virXMLNamespacePtr xmlns)\n{\n    return virStoragePoolOptionsPoolTypeSetXMLNamespace(poolType, xmlns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRegister",
          "args": [
            "&virStorageBackendRBD"
          ],
          "line": 1491
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend.c",
          "lines": "153-169",
          "snippet": "int\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}",
          "includes": [
            "# include \"storage_backend_vstorage.h\"",
            "# include \"storage_backend_zfs.h\"",
            "# include \"storage_backend_gluster.h\"",
            "# include \"storage_backend_sheepdog.h\"",
            "# include \"storage_backend_rbd.h\"",
            "# include \"storage_backend_fs.h\"",
            "# include \"storage_backend_disk.h\"",
            "# include \"storage_backend_mpath.h\"",
            "# include \"storage_backend_scsi.h\"",
            "# include \"storage_backend_iscsi_direct.h\"",
            "# include \"storage_backend_iscsi.h\"",
            "# include \"storage_backend_logical.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include \"storage_backend_vstorage.h\"\n# include \"storage_backend_zfs.h\"\n# include \"storage_backend_gluster.h\"\n# include \"storage_backend_sheepdog.h\"\n# include \"storage_backend_rbd.h\"\n# include \"storage_backend_fs.h\"\n# include \"storage_backend_disk.h\"\n# include \"storage_backend_mpath.h\"\n# include \"storage_backend_scsi.h\"\n# include \"storage_backend_iscsi_direct.h\"\n# include \"storage_backend_iscsi.h\"\n# include \"storage_backend_logical.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"virstoragefile.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageBackendsCount;\n\nint\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nint\nvirStorageBackendRBDRegister(void)\n{\n    if (virStorageBackendRegister(&virStorageBackendRBD) < 0)\n        return -1;\n\n    return virStorageBackendNamespaceInit(VIR_STORAGE_POOL_RBD,\n                                          &virStoragePoolRBDXMLNamespace);\n}"
  },
  {
    "function_name": "virStorageBackendRBDVolWipe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1378-1462",
    "snippet": "static int\nvirStorageBackendRBDVolWipe(virStoragePoolObjPtr pool,\n                            virStorageVolDefPtr vol,\n                            unsigned int algorithm,\n                            unsigned int flags)\n{\n    virStorageBackendRBDStatePtr ptr = NULL;\n    virStoragePoolDefPtr def;\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t stripe_count;\n    int rc = 0;\n    int ret = -1;\n\n    virCheckFlags(0, -1);\n\n    virObjectLock(pool);\n    def = virStoragePoolObjGetDef(pool);\n    VIR_DEBUG(\"Wiping RBD image %s/%s\", def->source.name, vol->name);\n    ptr = virStorageBackendRBDNewState(pool);\n    virObjectUnlock(pool);\n\n    if (!ptr)\n        goto cleanup;\n\n    if (rbd_open(ptr->ioctx, vol->name, &image, NULL) < 0) {\n        virReportSystemError(errno, _(\"failed to open the RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if (rbd_stat(image, &info, sizeof(info)) < 0) {\n        virReportSystemError(errno, _(\"failed to stat the RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if (rbd_get_stripe_count(image, &stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to get stripe count of RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Need to wipe %\"PRIu64\" bytes from RBD image %s/%s\",\n              info.size, def->source.name, vol->name);\n\n    switch ((virStorageVolWipeAlgorithm) algorithm) {\n    case VIR_STORAGE_VOL_WIPE_ALG_ZERO:\n        rc = virStorageBackendRBDVolWipeZero(image, vol->name,\n                                            &info, stripe_count);\n            break;\n    case VIR_STORAGE_VOL_WIPE_ALG_TRIM:\n        rc = virStorageBackendRBDVolWipeDiscard(image, vol->name,\n                                               &info, stripe_count);\n        break;\n    case VIR_STORAGE_VOL_WIPE_ALG_NNSA:\n    case VIR_STORAGE_VOL_WIPE_ALG_DOD:\n    case VIR_STORAGE_VOL_WIPE_ALG_BSI:\n    case VIR_STORAGE_VOL_WIPE_ALG_GUTMANN:\n    case VIR_STORAGE_VOL_WIPE_ALG_SCHNEIER:\n    case VIR_STORAGE_VOL_WIPE_ALG_PFITZNER7:\n    case VIR_STORAGE_VOL_WIPE_ALG_PFITZNER33:\n    case VIR_STORAGE_VOL_WIPE_ALG_RANDOM:\n    case VIR_STORAGE_VOL_WIPE_ALG_LAST:\n        virReportError(VIR_ERR_INVALID_ARG, _(\"unsupported algorithm %d\"),\n                       algorithm);\n        goto cleanup;\n    }\n\n    if (rc < 0) {\n        virReportSystemError(errno, _(\"failed to wipe RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n\n    virStorageBackendRBDFreeState(&ptr);\n\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 1459
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_close",
          "args": [
            "image"
          ],
          "line": 1457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to wipe RBD image %s\")",
            "vol->name"
          ],
          "line": 1448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to wipe RBD image %s\""
          ],
          "line": 1448
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "_(\"unsupported algorithm %d\")",
            "algorithm"
          ],
          "line": 1442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDVolWipeDiscard",
          "args": [
            "image",
            "vol->name",
            "&info",
            "stripe_count"
          ],
          "line": 1430
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDVolWipeDiscard",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "1348-1376",
          "snippet": "static int\nvirStorageBackendRBDVolWipeDiscard(rbd_image_t image,\n                                   char *imgname,\n                                   rbd_image_info_t *info,\n                                   uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n\n    VIR_DEBUG(\"Wiping RBD %s volume using discard)\", imgname);\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_discard(image, offset, length) < 0) {\n            virReportSystemError(errno, _(\"discarding %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                     length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Discarded %llu bytes of RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDVolWipeDiscard(rbd_image_t image,\n                                   char *imgname,\n                                   rbd_image_info_t *info,\n                                   uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n\n    VIR_DEBUG(\"Wiping RBD %s volume using discard)\", imgname);\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_discard(image, offset, length) < 0) {\n            virReportSystemError(errno, _(\"discarding %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                     length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Discarded %llu bytes of RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDVolWipeZero",
          "args": [
            "image",
            "vol->name",
            "&info",
            "stripe_count"
          ],
          "line": 1426
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDVolWipeZero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "1316-1346",
          "snippet": "static int\nvirStorageBackendRBDVolWipeZero(rbd_image_t image,\n                                char *imgname,\n                                rbd_image_info_t *info,\n                                uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n    g_autofree char *writebuf = NULL;\n\n    if (VIR_ALLOC_N(writebuf, info->obj_size * stripe_count) < 0)\n        return -1;\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_write(image, offset, length, writebuf) < 0) {\n            virReportSystemError(errno, _(\"writing %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                       length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Wrote %llu bytes to RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDVolWipeZero(rbd_image_t image,\n                                char *imgname,\n                                rbd_image_info_t *info,\n                                uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n    g_autofree char *writebuf = NULL;\n\n    if (VIR_ALLOC_N(writebuf, info->obj_size * stripe_count) < 0)\n        return -1;\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_write(image, offset, length, writebuf) < 0) {\n            virReportSystemError(errno, _(\"writing %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                       length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Wrote %llu bytes to RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Need to wipe %\"PRIu64\" bytes from RBD image %s/%s\"",
            "info.size",
            "def->source.name",
            "vol->name"
          ],
          "line": 1421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to get stripe count of RBD image %s\")",
            "vol->name"
          ],
          "line": 1416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_get_stripe_count",
          "args": [
            "image",
            "&stripe_count"
          ],
          "line": 1415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to stat the RBD image %s\")",
            "vol->name"
          ],
          "line": 1410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_stat",
          "args": [
            "image",
            "&info",
            "sizeof(info)"
          ],
          "line": 1409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to open the RBD image %s\")",
            "vol->name"
          ],
          "line": 1404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_open",
          "args": [
            "ptr->ioctx",
            "vol->name",
            "&image",
            "NULL"
          ],
          "line": 1403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pool"
          ],
          "line": 1398
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 1397
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Wiping RBD image %s/%s\"",
            "def->source.name",
            "vol->name"
          ],
          "line": 1396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 1395
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pool"
          ],
          "line": 1394
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 1392
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDVolWipe(virStoragePoolObjPtr pool,\n                            virStorageVolDefPtr vol,\n                            unsigned int algorithm,\n                            unsigned int flags)\n{\n    virStorageBackendRBDStatePtr ptr = NULL;\n    virStoragePoolDefPtr def;\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t stripe_count;\n    int rc = 0;\n    int ret = -1;\n\n    virCheckFlags(0, -1);\n\n    virObjectLock(pool);\n    def = virStoragePoolObjGetDef(pool);\n    VIR_DEBUG(\"Wiping RBD image %s/%s\", def->source.name, vol->name);\n    ptr = virStorageBackendRBDNewState(pool);\n    virObjectUnlock(pool);\n\n    if (!ptr)\n        goto cleanup;\n\n    if (rbd_open(ptr->ioctx, vol->name, &image, NULL) < 0) {\n        virReportSystemError(errno, _(\"failed to open the RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if (rbd_stat(image, &info, sizeof(info)) < 0) {\n        virReportSystemError(errno, _(\"failed to stat the RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if (rbd_get_stripe_count(image, &stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to get stripe count of RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Need to wipe %\"PRIu64\" bytes from RBD image %s/%s\",\n              info.size, def->source.name, vol->name);\n\n    switch ((virStorageVolWipeAlgorithm) algorithm) {\n    case VIR_STORAGE_VOL_WIPE_ALG_ZERO:\n        rc = virStorageBackendRBDVolWipeZero(image, vol->name,\n                                            &info, stripe_count);\n            break;\n    case VIR_STORAGE_VOL_WIPE_ALG_TRIM:\n        rc = virStorageBackendRBDVolWipeDiscard(image, vol->name,\n                                               &info, stripe_count);\n        break;\n    case VIR_STORAGE_VOL_WIPE_ALG_NNSA:\n    case VIR_STORAGE_VOL_WIPE_ALG_DOD:\n    case VIR_STORAGE_VOL_WIPE_ALG_BSI:\n    case VIR_STORAGE_VOL_WIPE_ALG_GUTMANN:\n    case VIR_STORAGE_VOL_WIPE_ALG_SCHNEIER:\n    case VIR_STORAGE_VOL_WIPE_ALG_PFITZNER7:\n    case VIR_STORAGE_VOL_WIPE_ALG_PFITZNER33:\n    case VIR_STORAGE_VOL_WIPE_ALG_RANDOM:\n    case VIR_STORAGE_VOL_WIPE_ALG_LAST:\n        virReportError(VIR_ERR_INVALID_ARG, _(\"unsupported algorithm %d\"),\n                       algorithm);\n        goto cleanup;\n    }\n\n    if (rc < 0) {\n        virReportSystemError(errno, _(\"failed to wipe RBD image %s\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n\n    virStorageBackendRBDFreeState(&ptr);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDVolWipeDiscard",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1348-1376",
    "snippet": "static int\nvirStorageBackendRBDVolWipeDiscard(rbd_image_t image,\n                                   char *imgname,\n                                   rbd_image_info_t *info,\n                                   uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n\n    VIR_DEBUG(\"Wiping RBD %s volume using discard)\", imgname);\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_discard(image, offset, length) < 0) {\n            virReportSystemError(errno, _(\"discarding %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                     length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Discarded %llu bytes of RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Discarded %llu bytes of RBD image %s at offset %llu\"",
            "length",
            "imgname",
            "offset"
          ],
          "line": 1369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"discarding %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\")",
            "length",
            "imgname",
            "offset"
          ],
          "line": 1363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"discarding %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\""
          ],
          "line": 1363
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_discard",
          "args": [
            "image",
            "offset",
            "length"
          ],
          "line": 1362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "(info->size - offset)",
            "(info->obj_size * stripe_count)"
          ],
          "line": 1360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Wiping RBD %s volume using discard)\"",
            "imgname"
          ],
          "line": 1357
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDVolWipeDiscard(rbd_image_t image,\n                                   char *imgname,\n                                   rbd_image_info_t *info,\n                                   uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n\n    VIR_DEBUG(\"Wiping RBD %s volume using discard)\", imgname);\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_discard(image, offset, length) < 0) {\n            virReportSystemError(errno, _(\"discarding %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                     length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Discarded %llu bytes of RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDVolWipeZero",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1316-1346",
    "snippet": "static int\nvirStorageBackendRBDVolWipeZero(rbd_image_t image,\n                                char *imgname,\n                                rbd_image_info_t *info,\n                                uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n    g_autofree char *writebuf = NULL;\n\n    if (VIR_ALLOC_N(writebuf, info->obj_size * stripe_count) < 0)\n        return -1;\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_write(image, offset, length, writebuf) < 0) {\n            virReportSystemError(errno, _(\"writing %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                       length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Wrote %llu bytes to RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Wrote %llu bytes to RBD image %s at offset %llu\"",
            "length",
            "imgname",
            "offset"
          ],
          "line": 1339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"writing %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\")",
            "length",
            "imgname",
            "offset"
          ],
          "line": 1333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"writing %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\""
          ],
          "line": 1333
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_write",
          "args": [
            "image",
            "offset",
            "length",
            "writebuf"
          ],
          "line": 1332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "(info->size - offset)",
            "(info->obj_size * stripe_count)"
          ],
          "line": 1330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "writebuf",
            "info->obj_size * stripe_count"
          ],
          "line": 1326
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDVolWipeZero(rbd_image_t image,\n                                char *imgname,\n                                rbd_image_info_t *info,\n                                uint64_t stripe_count)\n{\n    unsigned long long offset = 0;\n    unsigned long long length;\n    g_autofree char *writebuf = NULL;\n\n    if (VIR_ALLOC_N(writebuf, info->obj_size * stripe_count) < 0)\n        return -1;\n\n    while (offset < info->size) {\n        length = MIN((info->size - offset), (info->obj_size * stripe_count));\n\n        if (rbd_write(image, offset, length, writebuf) < 0) {\n            virReportSystemError(errno, _(\"writing %llu bytes failed on \"\n                                       \"RBD image %s at offset %llu\"),\n                                       length, imgname, offset);\n            return -1;\n        }\n\n        VIR_DEBUG(\"Wrote %llu bytes to RBD image %s at offset %llu\",\n                  length, imgname, offset);\n\n        offset += length;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDResizeVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1280-1314",
    "snippet": "static int\nvirStorageBackendRBDResizeVol(virStoragePoolObjPtr pool,\n                              virStorageVolDefPtr vol,\n                              unsigned long long capacity,\n                              unsigned int flags)\n{\n    virStorageBackendRBDStatePtr ptr = NULL;\n    rbd_image_t image = NULL;\n    int ret = -1;\n\n    virCheckFlags(0, -1);\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (rbd_open(ptr->ioctx, vol->name, &image, NULL) < 0) {\n       virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                            vol->name);\n       goto cleanup;\n    }\n\n    if (rbd_resize(image, capacity) < 0) {\n        virReportSystemError(errno, _(\"failed to resize the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (image != NULL)\n       rbd_close(image);\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 1312
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_close",
          "args": [
            "image"
          ],
          "line": 1311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to resize the RBD image '%s'\")",
            "vol->name"
          ],
          "line": 1302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to resize the RBD image '%s'\""
          ],
          "line": 1302
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_resize",
          "args": [
            "image",
            "capacity"
          ],
          "line": 1301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to open the RBD image '%s'\")",
            "vol->name"
          ],
          "line": 1296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_open",
          "args": [
            "ptr->ioctx",
            "vol->name",
            "&image",
            "NULL"
          ],
          "line": 1295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 1292
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 1290
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDResizeVol(virStoragePoolObjPtr pool,\n                              virStorageVolDefPtr vol,\n                              unsigned long long capacity,\n                              unsigned int flags)\n{\n    virStorageBackendRBDStatePtr ptr = NULL;\n    rbd_image_t image = NULL;\n    int ret = -1;\n\n    virCheckFlags(0, -1);\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (rbd_open(ptr->ioctx, vol->name, &image, NULL) < 0) {\n       virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                            vol->name);\n       goto cleanup;\n    }\n\n    if (rbd_resize(image, capacity) < 0) {\n        virReportSystemError(errno, _(\"failed to resize the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (image != NULL)\n       rbd_close(image);\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDRefreshVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1260-1278",
    "snippet": "static int\nvirStorageBackendRBDRefreshVol(virStoragePoolObjPtr pool,\n                               virStorageVolDefPtr vol)\n{\n    virStorageBackendRBDStatePtr ptr = NULL;\n    int ret = -1;\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (volStorageBackendRBDRefreshVolInfo(vol, pool, ptr) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 1276
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "volStorageBackendRBDRefreshVolInfo",
          "args": [
            "vol",
            "pool",
            "ptr"
          ],
          "line": 1270
        },
        "resolved": true,
        "details": {
          "function_name": "volStorageBackendRBDRefreshVolInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "509-581",
          "snippet": "static int\nvolStorageBackendRBDRefreshVolInfo(virStorageVolDefPtr vol,\n                                   virStoragePoolObjPtr pool,\n                                   virStorageBackendRBDStatePtr ptr)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t features;\n    uint64_t flags;\n\n    if ((rc = rbd_open_read_only(ptr->ioctx, vol->name, &image, NULL)) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = rbd_stat(image, &info, sizeof(info))) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to stat the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFeatures(image, vol->name, &features)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFlags(image, vol->name, &flags)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    vol->target.capacity = info.size;\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n    vol->target.format = VIR_STORAGE_FILE_RAW;\n\n    if (def->refresh &&\n        def->refresh->volume.allocation == VIR_STORAGE_VOL_DEF_REFRESH_ALLOCATION_DEFAULT &&\n        volStorageBackendRBDUseFastDiff(features, flags)) {\n        VIR_DEBUG(\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\",\n                  def->source.name, vol->name);\n\n        if ((rc = virStorageBackendRBDSetAllocation(vol, image, &info)) < 0) {\n            ret = rc;\n            goto cleanup;\n        }\n    } else {\n        vol->target.allocation = info.obj_size * info.num_objs;\n    }\n\n    VIR_DEBUG(\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\",\n              def->source.name, vol->name, vol->target.capacity,\n              vol->target.allocation, info.obj_size, info.num_objs);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDRefreshVolInfo(virStorageVolDefPtr vol,\n                                   virStoragePoolObjPtr pool,\n                                   virStorageBackendRBDStatePtr ptr)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t features;\n    uint64_t flags;\n\n    if ((rc = rbd_open_read_only(ptr->ioctx, vol->name, &image, NULL)) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = rbd_stat(image, &info, sizeof(info))) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to stat the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFeatures(image, vol->name, &features)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFlags(image, vol->name, &flags)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    vol->target.capacity = info.size;\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n    vol->target.format = VIR_STORAGE_FILE_RAW;\n\n    if (def->refresh &&\n        def->refresh->volume.allocation == VIR_STORAGE_VOL_DEF_REFRESH_ALLOCATION_DEFAULT &&\n        volStorageBackendRBDUseFastDiff(features, flags)) {\n        VIR_DEBUG(\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\",\n                  def->source.name, vol->name);\n\n        if ((rc = virStorageBackendRBDSetAllocation(vol, image, &info)) < 0) {\n            ret = rc;\n            goto cleanup;\n        }\n    } else {\n        vol->target.allocation = info.obj_size * info.num_objs;\n    }\n\n    VIR_DEBUG(\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\",\n              def->source.name, vol->name, vol->target.capacity,\n              vol->target.allocation, info.obj_size, info.num_objs);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 1267
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDRefreshVol(virStoragePoolObjPtr pool,\n                               virStorageVolDefPtr vol)\n{\n    virStorageBackendRBDStatePtr ptr = NULL;\n    int ret = -1;\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (volStorageBackendRBDRefreshVolInfo(vol, pool, ptr) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDBuildVolFrom",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1231-1258",
    "snippet": "static int\nvirStorageBackendRBDBuildVolFrom(virStoragePoolObjPtr pool,\n                                 virStorageVolDefPtr newvol,\n                                 virStorageVolDefPtr origvol,\n                                 unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Creating clone of RBD image %s/%s with name %s\",\n              def->source.name, origvol->name, newvol->name);\n\n    virCheckFlags(0, -1);\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if ((virStorageBackendRBDCloneImage(ptr->ioctx, origvol->name,\n                                        newvol->name)) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 1256
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDCloneImage",
          "args": [
            "ptr->ioctx",
            "origvol->name",
            "newvol->name"
          ],
          "line": 1249
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDCloneImage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "1144-1229",
          "snippet": "static int\nvirStorageBackendRBDCloneImage(rados_ioctx_t io,\n                               char *origvol,\n                               char *newvol)\n{\n    int ret = -1;\n    int order = 0;\n    uint64_t features;\n    uint64_t stripe_count;\n    uint64_t stripe_unit;\n    virBuffer snapname = VIR_BUFFER_INITIALIZER;\n    rbd_image_t image = NULL;\n    g_autofree char *snapname_buff = NULL;\n\n    if (rbd_open(io, origvol, &image, NULL) < 0) {\n        virReportSystemError(errno, _(\"failed to open the RBD image %s\"),\n                             origvol);\n        goto cleanup;\n    }\n\n    if ((virStorageBackendRBDImageInfo(image, origvol, &features, &stripe_unit,\n                                       &stripe_count)) < 0)\n        goto cleanup;\n\n    /*\n     * First we attempt to find a snapshot which has no differences between\n     * the current state of the RBD image.\n     *\n     * This prevents us from creating a new snapshot for every clone operation\n     * while it could be that the original volume has not changed\n     */\n    if (virStorageBackendRBDSnapshotFindNoDiff(image, origvol, &snapname) < 0)\n        goto cleanup;\n\n    /*\n     * the virBuffer snapname will contain a snapshot's name if one without\n     * deltas has been found.\n     *\n     * If it's NULL we have to create a new snapshot and clone from there\n     */\n    snapname_buff = virBufferContentAndReset(&snapname);\n\n    if (snapname_buff == NULL) {\n        VIR_DEBUG(\"No RBD snapshot with zero delta could be found for image %s\",\n                  origvol);\n\n        virBufferAsprintf(&snapname, \"libvirt-%d\", (int)virRandomInt(65534));\n\n        snapname_buff = virBufferContentAndReset(&snapname);\n\n        if (virStorageBackendRBDSnapshotCreate(image, origvol, snapname_buff) < 0)\n            goto cleanup;\n\n    }\n\n    VIR_DEBUG(\"Using snapshot name %s for cloning RBD image %s to %s\",\n              snapname_buff, origvol, newvol);\n\n    /*\n     * RBD snapshots have to be 'protected' before they can be used\n     * as a parent snapshot for a child image\n     */\n    if (virStorageBackendRBDSnapshotProtect(image, origvol, snapname_buff) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Performing RBD clone from %s to %s\", origvol, newvol);\n\n    if (rbd_clone2(io, origvol, snapname_buff, io, newvol, features,\n                   &order, stripe_unit, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to clone RBD volume %s to %s\"),\n                             origvol, newvol);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Cloned RBD image %s to %s\", origvol, newvol);\n\n    ret = 0;\n\n cleanup:\n    virBufferFreeAndReset(&snapname);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDCloneImage(rados_ioctx_t io,\n                               char *origvol,\n                               char *newvol)\n{\n    int ret = -1;\n    int order = 0;\n    uint64_t features;\n    uint64_t stripe_count;\n    uint64_t stripe_unit;\n    virBuffer snapname = VIR_BUFFER_INITIALIZER;\n    rbd_image_t image = NULL;\n    g_autofree char *snapname_buff = NULL;\n\n    if (rbd_open(io, origvol, &image, NULL) < 0) {\n        virReportSystemError(errno, _(\"failed to open the RBD image %s\"),\n                             origvol);\n        goto cleanup;\n    }\n\n    if ((virStorageBackendRBDImageInfo(image, origvol, &features, &stripe_unit,\n                                       &stripe_count)) < 0)\n        goto cleanup;\n\n    /*\n     * First we attempt to find a snapshot which has no differences between\n     * the current state of the RBD image.\n     *\n     * This prevents us from creating a new snapshot for every clone operation\n     * while it could be that the original volume has not changed\n     */\n    if (virStorageBackendRBDSnapshotFindNoDiff(image, origvol, &snapname) < 0)\n        goto cleanup;\n\n    /*\n     * the virBuffer snapname will contain a snapshot's name if one without\n     * deltas has been found.\n     *\n     * If it's NULL we have to create a new snapshot and clone from there\n     */\n    snapname_buff = virBufferContentAndReset(&snapname);\n\n    if (snapname_buff == NULL) {\n        VIR_DEBUG(\"No RBD snapshot with zero delta could be found for image %s\",\n                  origvol);\n\n        virBufferAsprintf(&snapname, \"libvirt-%d\", (int)virRandomInt(65534));\n\n        snapname_buff = virBufferContentAndReset(&snapname);\n\n        if (virStorageBackendRBDSnapshotCreate(image, origvol, snapname_buff) < 0)\n            goto cleanup;\n\n    }\n\n    VIR_DEBUG(\"Using snapshot name %s for cloning RBD image %s to %s\",\n              snapname_buff, origvol, newvol);\n\n    /*\n     * RBD snapshots have to be 'protected' before they can be used\n     * as a parent snapshot for a child image\n     */\n    if (virStorageBackendRBDSnapshotProtect(image, origvol, snapname_buff) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Performing RBD clone from %s to %s\", origvol, newvol);\n\n    if (rbd_clone2(io, origvol, snapname_buff, io, newvol, features,\n                   &order, stripe_unit, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to clone RBD volume %s to %s\"),\n                             origvol, newvol);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Cloned RBD image %s to %s\", origvol, newvol);\n\n    ret = 0;\n\n cleanup:\n    virBufferFreeAndReset(&snapname);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 1246
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 1244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating clone of RBD image %s/%s with name %s\"",
            "def->source.name",
            "origvol->name",
            "newvol->name"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 1237
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDBuildVolFrom(virStoragePoolObjPtr pool,\n                                 virStorageVolDefPtr newvol,\n                                 virStorageVolDefPtr origvol,\n                                 unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Creating clone of RBD image %s/%s with name %s\",\n              def->source.name, origvol->name, newvol->name);\n\n    virCheckFlags(0, -1);\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if ((virStorageBackendRBDCloneImage(ptr->ioctx, origvol->name,\n                                        newvol->name)) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDCloneImage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1144-1229",
    "snippet": "static int\nvirStorageBackendRBDCloneImage(rados_ioctx_t io,\n                               char *origvol,\n                               char *newvol)\n{\n    int ret = -1;\n    int order = 0;\n    uint64_t features;\n    uint64_t stripe_count;\n    uint64_t stripe_unit;\n    virBuffer snapname = VIR_BUFFER_INITIALIZER;\n    rbd_image_t image = NULL;\n    g_autofree char *snapname_buff = NULL;\n\n    if (rbd_open(io, origvol, &image, NULL) < 0) {\n        virReportSystemError(errno, _(\"failed to open the RBD image %s\"),\n                             origvol);\n        goto cleanup;\n    }\n\n    if ((virStorageBackendRBDImageInfo(image, origvol, &features, &stripe_unit,\n                                       &stripe_count)) < 0)\n        goto cleanup;\n\n    /*\n     * First we attempt to find a snapshot which has no differences between\n     * the current state of the RBD image.\n     *\n     * This prevents us from creating a new snapshot for every clone operation\n     * while it could be that the original volume has not changed\n     */\n    if (virStorageBackendRBDSnapshotFindNoDiff(image, origvol, &snapname) < 0)\n        goto cleanup;\n\n    /*\n     * the virBuffer snapname will contain a snapshot's name if one without\n     * deltas has been found.\n     *\n     * If it's NULL we have to create a new snapshot and clone from there\n     */\n    snapname_buff = virBufferContentAndReset(&snapname);\n\n    if (snapname_buff == NULL) {\n        VIR_DEBUG(\"No RBD snapshot with zero delta could be found for image %s\",\n                  origvol);\n\n        virBufferAsprintf(&snapname, \"libvirt-%d\", (int)virRandomInt(65534));\n\n        snapname_buff = virBufferContentAndReset(&snapname);\n\n        if (virStorageBackendRBDSnapshotCreate(image, origvol, snapname_buff) < 0)\n            goto cleanup;\n\n    }\n\n    VIR_DEBUG(\"Using snapshot name %s for cloning RBD image %s to %s\",\n              snapname_buff, origvol, newvol);\n\n    /*\n     * RBD snapshots have to be 'protected' before they can be used\n     * as a parent snapshot for a child image\n     */\n    if (virStorageBackendRBDSnapshotProtect(image, origvol, snapname_buff) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Performing RBD clone from %s to %s\", origvol, newvol);\n\n    if (rbd_clone2(io, origvol, snapname_buff, io, newvol, features,\n                   &order, stripe_unit, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to clone RBD volume %s to %s\"),\n                             origvol, newvol);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Cloned RBD image %s to %s\", origvol, newvol);\n\n    ret = 0;\n\n cleanup:\n    virBufferFreeAndReset(&snapname);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rbd_close",
          "args": [
            "image"
          ],
          "line": 1226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferFreeAndReset",
          "args": [
            "&snapname"
          ],
          "line": 1223
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferFreeAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "268-277",
          "snippet": "void virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Cloned RBD image %s to %s\"",
            "origvol",
            "newvol"
          ],
          "line": 1218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to clone RBD volume %s to %s\")",
            "origvol",
            "newvol"
          ],
          "line": 1213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to clone RBD volume %s to %s\""
          ],
          "line": 1213
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_clone2",
          "args": [
            "io",
            "origvol",
            "snapname_buff",
            "io",
            "newvol",
            "features",
            "&order",
            "stripe_unit",
            "stripe_count"
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Performing RBD clone from %s to %s\"",
            "origvol",
            "newvol"
          ],
          "line": 1209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDSnapshotProtect",
          "args": [
            "image",
            "origvol",
            "snapname_buff"
          ],
          "line": 1206
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDSnapshotProtect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "1113-1142",
          "snippet": "static int\nvirStorageBackendRBDSnapshotProtect(rbd_image_t image,\n                                    char *imgname,\n                                    char *snapname)\n{\n    int protected;\n\n    VIR_DEBUG(\"Querying if RBD snapshot %s@%s is protected\", imgname, snapname);\n\n    if (rbd_snap_is_protected(image, snapname, &protected) < 0) {\n        virReportSystemError(errno, _(\"failed to verify if RBD snapshot %s@%s \"\n                                   \"is protected\"), imgname, snapname);\n        return -1;\n    }\n\n    if (protected == 0) {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is not protected, protecting\",\n                  imgname, snapname);\n\n        if (rbd_snap_protect(image, snapname) < 0) {\n            virReportSystemError(errno, _(\"failed to protect RBD snapshot %s@%s\"),\n                                       imgname, snapname);\n            return -1;\n        }\n    } else {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is already protected\", imgname, snapname);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSnapshotProtect(rbd_image_t image,\n                                    char *imgname,\n                                    char *snapname)\n{\n    int protected;\n\n    VIR_DEBUG(\"Querying if RBD snapshot %s@%s is protected\", imgname, snapname);\n\n    if (rbd_snap_is_protected(image, snapname, &protected) < 0) {\n        virReportSystemError(errno, _(\"failed to verify if RBD snapshot %s@%s \"\n                                   \"is protected\"), imgname, snapname);\n        return -1;\n    }\n\n    if (protected == 0) {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is not protected, protecting\",\n                  imgname, snapname);\n\n        if (rbd_snap_protect(image, snapname) < 0) {\n            virReportSystemError(errno, _(\"failed to protect RBD snapshot %s@%s\"),\n                                       imgname, snapname);\n            return -1;\n        }\n    } else {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is already protected\", imgname, snapname);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Using snapshot name %s for cloning RBD image %s to %s\"",
            "snapname_buff",
            "origvol",
            "newvol"
          ],
          "line": 1199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDSnapshotCreate",
          "args": [
            "image",
            "origvol",
            "snapname_buff"
          ],
          "line": 1194
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDSnapshotCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "1097-1111",
          "snippet": "static int\nvirStorageBackendRBDSnapshotCreate(rbd_image_t image,\n                                   char *imgname,\n                                   char *snapname)\n{\n    VIR_DEBUG(\"Creating RBD snapshot %s@%s\", imgname, snapname);\n\n    if (rbd_snap_create(image, snapname) < 0) {\n        virReportSystemError(errno, _(\"failed to create RBD snapshot %s@%s\"),\n                                   imgname, snapname);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSnapshotCreate(rbd_image_t image,\n                                   char *imgname,\n                                   char *snapname)\n{\n    VIR_DEBUG(\"Creating RBD snapshot %s@%s\", imgname, snapname);\n\n    if (rbd_snap_create(image, snapname) < 0) {\n        virReportSystemError(errno, _(\"failed to create RBD snapshot %s@%s\"),\n                                   imgname, snapname);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&snapname"
          ],
          "line": 1192
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "&snapname",
            "\"libvirt-%d\"",
            "(int)virRandomInt(65534)"
          ],
          "line": 1190
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRandomInt",
          "args": [
            "65534"
          ],
          "line": 1190
        },
        "resolved": true,
        "details": {
          "function_name": "virRandomInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrandom.c",
          "lines": "90-97",
          "snippet": "uint32_t virRandomInt(uint32_t max)\n{\n    if ((max & (max - 1)) == 0)\n        return virRandomBits(__builtin_ffs(max) - 1);\n\n    double val = virRandom();\n    return val * max;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"virrandom.h\"",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <time.h>",
            "#include <math.h>",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virrandom.h\"\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <time.h>\n#include <math.h>\n#include <inttypes.h>\n#include <config.h>\n\nuint32_t virRandomInt(uint32_t max)\n{\n    if ((max & (max - 1)) == 0)\n        return virRandomBits(__builtin_ffs(max) - 1);\n\n    double val = virRandom();\n    return val * max;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No RBD snapshot with zero delta could be found for image %s\"",
            "origvol"
          ],
          "line": 1187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDSnapshotFindNoDiff",
          "args": [
            "image",
            "origvol",
            "&snapname"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDImageInfo",
          "args": [
            "image",
            "origvol",
            "&features",
            "&stripe_unit",
            "&stripe_count"
          ],
          "line": 1164
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDImageInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "952-991",
          "snippet": "static int\nvirStorageBackendRBDImageInfo(rbd_image_t image,\n                              char *volname,\n                              uint64_t *features,\n                              uint64_t *stripe_unit,\n                              uint64_t *stripe_count)\n{\n    uint8_t oldformat;\n\n    if (rbd_get_old_format(image, &oldformat) < 0) {\n        virReportSystemError(errno, _(\"failed to get the format of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (oldformat != 0) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED,\n                       _(\"RBD image %s is old format. Does not support \"\n                         \"extended features and striping\"),\n                       volname);\n        return -1;\n    }\n\n    if (volStorageBackendRBDGetFeatures(image, volname, features) < 0)\n        return -1;\n\n    if (rbd_get_stripe_unit(image, stripe_unit) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe unit of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (rbd_get_stripe_count(image, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe count of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDImageInfo(rbd_image_t image,\n                              char *volname,\n                              uint64_t *features,\n                              uint64_t *stripe_unit,\n                              uint64_t *stripe_count)\n{\n    uint8_t oldformat;\n\n    if (rbd_get_old_format(image, &oldformat) < 0) {\n        virReportSystemError(errno, _(\"failed to get the format of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (oldformat != 0) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED,\n                       _(\"RBD image %s is old format. Does not support \"\n                         \"extended features and striping\"),\n                       volname);\n        return -1;\n    }\n\n    if (volStorageBackendRBDGetFeatures(image, volname, features) < 0)\n        return -1;\n\n    if (rbd_get_stripe_unit(image, stripe_unit) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe unit of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (rbd_get_stripe_count(image, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe count of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to open the RBD image %s\")",
            "origvol"
          ],
          "line": 1159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_open",
          "args": [
            "io",
            "origvol",
            "&image",
            "NULL"
          ],
          "line": 1158
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDCloneImage(rados_ioctx_t io,\n                               char *origvol,\n                               char *newvol)\n{\n    int ret = -1;\n    int order = 0;\n    uint64_t features;\n    uint64_t stripe_count;\n    uint64_t stripe_unit;\n    virBuffer snapname = VIR_BUFFER_INITIALIZER;\n    rbd_image_t image = NULL;\n    g_autofree char *snapname_buff = NULL;\n\n    if (rbd_open(io, origvol, &image, NULL) < 0) {\n        virReportSystemError(errno, _(\"failed to open the RBD image %s\"),\n                             origvol);\n        goto cleanup;\n    }\n\n    if ((virStorageBackendRBDImageInfo(image, origvol, &features, &stripe_unit,\n                                       &stripe_count)) < 0)\n        goto cleanup;\n\n    /*\n     * First we attempt to find a snapshot which has no differences between\n     * the current state of the RBD image.\n     *\n     * This prevents us from creating a new snapshot for every clone operation\n     * while it could be that the original volume has not changed\n     */\n    if (virStorageBackendRBDSnapshotFindNoDiff(image, origvol, &snapname) < 0)\n        goto cleanup;\n\n    /*\n     * the virBuffer snapname will contain a snapshot's name if one without\n     * deltas has been found.\n     *\n     * If it's NULL we have to create a new snapshot and clone from there\n     */\n    snapname_buff = virBufferContentAndReset(&snapname);\n\n    if (snapname_buff == NULL) {\n        VIR_DEBUG(\"No RBD snapshot with zero delta could be found for image %s\",\n                  origvol);\n\n        virBufferAsprintf(&snapname, \"libvirt-%d\", (int)virRandomInt(65534));\n\n        snapname_buff = virBufferContentAndReset(&snapname);\n\n        if (virStorageBackendRBDSnapshotCreate(image, origvol, snapname_buff) < 0)\n            goto cleanup;\n\n    }\n\n    VIR_DEBUG(\"Using snapshot name %s for cloning RBD image %s to %s\",\n              snapname_buff, origvol, newvol);\n\n    /*\n     * RBD snapshots have to be 'protected' before they can be used\n     * as a parent snapshot for a child image\n     */\n    if (virStorageBackendRBDSnapshotProtect(image, origvol, snapname_buff) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Performing RBD clone from %s to %s\", origvol, newvol);\n\n    if (rbd_clone2(io, origvol, snapname_buff, io, newvol, features,\n                   &order, stripe_unit, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to clone RBD volume %s to %s\"),\n                             origvol, newvol);\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Cloned RBD image %s to %s\", origvol, newvol);\n\n    ret = 0;\n\n cleanup:\n    virBufferFreeAndReset(&snapname);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDSnapshotProtect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1113-1142",
    "snippet": "static int\nvirStorageBackendRBDSnapshotProtect(rbd_image_t image,\n                                    char *imgname,\n                                    char *snapname)\n{\n    int protected;\n\n    VIR_DEBUG(\"Querying if RBD snapshot %s@%s is protected\", imgname, snapname);\n\n    if (rbd_snap_is_protected(image, snapname, &protected) < 0) {\n        virReportSystemError(errno, _(\"failed to verify if RBD snapshot %s@%s \"\n                                   \"is protected\"), imgname, snapname);\n        return -1;\n    }\n\n    if (protected == 0) {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is not protected, protecting\",\n                  imgname, snapname);\n\n        if (rbd_snap_protect(image, snapname) < 0) {\n            virReportSystemError(errno, _(\"failed to protect RBD snapshot %s@%s\"),\n                                       imgname, snapname);\n            return -1;\n        }\n    } else {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is already protected\", imgname, snapname);\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"RBD Snapshot %s@%s is already protected\"",
            "imgname",
            "snapname"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to protect RBD snapshot %s@%s\")",
            "imgname",
            "snapname"
          ],
          "line": 1133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to protect RBD snapshot %s@%s\""
          ],
          "line": 1133
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_snap_protect",
          "args": [
            "image",
            "snapname"
          ],
          "line": 1132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"RBD Snapshot %s@%s is not protected, protecting\"",
            "imgname",
            "snapname"
          ],
          "line": 1129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to verify if RBD snapshot %s@%s \"\n                                   \"is protected\")",
            "imgname",
            "snapname"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_snap_is_protected",
          "args": [
            "image",
            "snapname",
            "&protected"
          ],
          "line": 1122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Querying if RBD snapshot %s@%s is protected\"",
            "imgname",
            "snapname"
          ],
          "line": 1120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSnapshotProtect(rbd_image_t image,\n                                    char *imgname,\n                                    char *snapname)\n{\n    int protected;\n\n    VIR_DEBUG(\"Querying if RBD snapshot %s@%s is protected\", imgname, snapname);\n\n    if (rbd_snap_is_protected(image, snapname, &protected) < 0) {\n        virReportSystemError(errno, _(\"failed to verify if RBD snapshot %s@%s \"\n                                   \"is protected\"), imgname, snapname);\n        return -1;\n    }\n\n    if (protected == 0) {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is not protected, protecting\",\n                  imgname, snapname);\n\n        if (rbd_snap_protect(image, snapname) < 0) {\n            virReportSystemError(errno, _(\"failed to protect RBD snapshot %s@%s\"),\n                                       imgname, snapname);\n            return -1;\n        }\n    } else {\n        VIR_DEBUG(\"RBD Snapshot %s@%s is already protected\", imgname, snapname);\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDSnapshotCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "1097-1111",
    "snippet": "static int\nvirStorageBackendRBDSnapshotCreate(rbd_image_t image,\n                                   char *imgname,\n                                   char *snapname)\n{\n    VIR_DEBUG(\"Creating RBD snapshot %s@%s\", imgname, snapname);\n\n    if (rbd_snap_create(image, snapname) < 0) {\n        virReportSystemError(errno, _(\"failed to create RBD snapshot %s@%s\"),\n                                   imgname, snapname);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to create RBD snapshot %s@%s\")",
            "imgname",
            "snapname"
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to create RBD snapshot %s@%s\""
          ],
          "line": 1105
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_snap_create",
          "args": [
            "image",
            "snapname"
          ],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating RBD snapshot %s@%s\"",
            "imgname",
            "snapname"
          ],
          "line": 1102
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSnapshotCreate(rbd_image_t image,\n                                   char *imgname,\n                                   char *snapname)\n{\n    VIR_DEBUG(\"Creating RBD snapshot %s@%s\", imgname, snapname);\n\n    if (rbd_snap_create(image, snapname) < 0) {\n        virReportSystemError(errno, _(\"failed to create RBD snapshot %s@%s\"),\n                                   imgname, snapname);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDIterateCb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "994-1010",
    "snippet": "static int\nvirStorageBackendRBDIterateCb(uint64_t offset G_GNUC_UNUSED,\n                              size_t length G_GNUC_UNUSED,\n                              int exists G_GNUC_UNUSED,\n                              void *arg)\n{\n    /*\n     * Just set that there is a diff for this snapshot, we do not care where\n     *\n     * When it returns a negative number the rbd_diff_iterate() function will stop\n     *\n     * That's why we return -1, meaning that there is a difference and we can stop\n     * searching any further.\n     */\n    *(int*) arg = 1;\n    return -1;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDIterateCb(uint64_t offset G_GNUC_UNUSED,\n                              size_t length G_GNUC_UNUSED,\n                              int exists G_GNUC_UNUSED,\n                              void *arg)\n{\n    /*\n     * Just set that there is a diff for this snapshot, we do not care where\n     *\n     * When it returns a negative number the rbd_diff_iterate() function will stop\n     *\n     * That's why we return -1, meaning that there is a difference and we can stop\n     * searching any further.\n     */\n    *(int*) arg = 1;\n    return -1;\n}"
  },
  {
    "function_name": "virStorageBackendRBDImageInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "952-991",
    "snippet": "static int\nvirStorageBackendRBDImageInfo(rbd_image_t image,\n                              char *volname,\n                              uint64_t *features,\n                              uint64_t *stripe_unit,\n                              uint64_t *stripe_count)\n{\n    uint8_t oldformat;\n\n    if (rbd_get_old_format(image, &oldformat) < 0) {\n        virReportSystemError(errno, _(\"failed to get the format of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (oldformat != 0) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED,\n                       _(\"RBD image %s is old format. Does not support \"\n                         \"extended features and striping\"),\n                       volname);\n        return -1;\n    }\n\n    if (volStorageBackendRBDGetFeatures(image, volname, features) < 0)\n        return -1;\n\n    if (rbd_get_stripe_unit(image, stripe_unit) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe unit of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (rbd_get_stripe_count(image, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe count of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to get the stripe count of RBD image %s\")",
            "volname"
          ],
          "line": 985
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to get the stripe count of RBD image %s\""
          ],
          "line": 985
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_get_stripe_count",
          "args": [
            "image",
            "stripe_count"
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to get the stripe unit of RBD image %s\")",
            "volname"
          ],
          "line": 979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_get_stripe_unit",
          "args": [
            "image",
            "stripe_unit"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "volStorageBackendRBDGetFeatures",
          "args": [
            "image",
            "volname",
            "features"
          ],
          "line": 975
        },
        "resolved": true,
        "details": {
          "function_name": "volStorageBackendRBDGetFeatures",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "405-419",
          "snippet": "static int\nvolStorageBackendRBDGetFeatures(rbd_image_t image,\n                                const char *volname,\n                                uint64_t *features)\n{\n    int rc;\n\n    if ((rc = rbd_get_features(image, features)) < 0) {\n        virReportSystemError(errno, _(\"failed to get the features of RBD image \"\n                                 \"%s\"), volname);\n        return rc;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDGetFeatures(rbd_image_t image,\n                                const char *volname,\n                                uint64_t *features)\n{\n    int rc;\n\n    if ((rc = rbd_get_features(image, features)) < 0) {\n        virReportSystemError(errno, _(\"failed to get the features of RBD image \"\n                                 \"%s\"), volname);\n        return rc;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_UNSUPPORTED",
            "_(\"RBD image %s is old format. Does not support \"\n                         \"extended features and striping\")",
            "volname"
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to get the format of RBD image %s\")",
            "volname"
          ],
          "line": 962
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_get_old_format",
          "args": [
            "image",
            "&oldformat"
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDImageInfo(rbd_image_t image,\n                              char *volname,\n                              uint64_t *features,\n                              uint64_t *stripe_unit,\n                              uint64_t *stripe_count)\n{\n    uint8_t oldformat;\n\n    if (rbd_get_old_format(image, &oldformat) < 0) {\n        virReportSystemError(errno, _(\"failed to get the format of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (oldformat != 0) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED,\n                       _(\"RBD image %s is old format. Does not support \"\n                         \"extended features and striping\"),\n                       volname);\n        return -1;\n    }\n\n    if (volStorageBackendRBDGetFeatures(image, volname, features) < 0)\n        return -1;\n\n    if (rbd_get_stripe_unit(image, stripe_unit) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe unit of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    if (rbd_get_stripe_count(image, stripe_count) < 0) {\n        virReportSystemError(errno, _(\"failed to get the stripe count of RBD image %s\"),\n                             volname);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDBuildVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "903-950",
    "snippet": "static int\nvirStorageBackendRBDBuildVol(virStoragePoolObjPtr pool,\n                             virStorageVolDefPtr vol,\n                             unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Creating RBD image %s/%s with size %llu\",\n              def->source.name, vol->name, vol->target.capacity);\n\n    virCheckFlags(0, -1);\n\n    if (!vol->target.capacity) {\n        virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                       _(\"volume capacity required for this storage pool\"));\n        goto cleanup;\n    }\n\n    if (vol->target.format != VIR_STORAGE_FILE_RAW) {\n        virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                       _(\"only RAW volumes are supported by this storage pool\"));\n        goto cleanup;\n    }\n\n    if (vol->target.encryption != NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"storage pool does not support encrypted volumes\"));\n        goto cleanup;\n    }\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (virStorageBackendRBDCreateImage(ptr->ioctx, vol->name,\n                                       vol->target.capacity) < 0) {\n        virReportSystemError(errno, _(\"failed to create volume '%s/%s'\"),\n                             def->source.name, vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 948
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to create volume '%s/%s'\")",
            "def->source.name",
            "vol->name"
          ],
          "line": 940
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to create volume '%s/%s'\""
          ],
          "line": 940
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDCreateImage",
          "args": [
            "ptr->ioctx",
            "vol->name",
            "vol->target.capacity"
          ],
          "line": 938
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDCreateImage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "896-901",
          "snippet": "static int virStorageBackendRBDCreateImage(rados_ioctx_t io,\n                                           char *name, long capacity)\n{\n    int order = 0;\n    return rbd_create(io, name, capacity, &order);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int virStorageBackendRBDCreateImage(rados_ioctx_t io,\n                                           char *name, long capacity)\n{\n    int order = 0;\n    return rbd_create(io, name, capacity, &order);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 935
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"storage pool does not support encrypted volumes\")"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_SUPPORT",
            "\"%s\"",
            "_(\"only RAW volumes are supported by this storage pool\")"
          ],
          "line": 924
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_SUPPORT",
            "\"%s\"",
            "_(\"volume capacity required for this storage pool\")"
          ],
          "line": 918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 915
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Creating RBD image %s/%s with size %llu\"",
            "def->source.name",
            "vol->name",
            "vol->target.capacity"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 908
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDBuildVol(virStoragePoolObjPtr pool,\n                             virStorageVolDefPtr vol,\n                             unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Creating RBD image %s/%s with size %llu\",\n              def->source.name, vol->name, vol->target.capacity);\n\n    virCheckFlags(0, -1);\n\n    if (!vol->target.capacity) {\n        virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                       _(\"volume capacity required for this storage pool\"));\n        goto cleanup;\n    }\n\n    if (vol->target.format != VIR_STORAGE_FILE_RAW) {\n        virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                       _(\"only RAW volumes are supported by this storage pool\"));\n        goto cleanup;\n    }\n\n    if (vol->target.encryption != NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"storage pool does not support encrypted volumes\"));\n        goto cleanup;\n    }\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (virStorageBackendRBDCreateImage(ptr->ioctx, vol->name,\n                                       vol->target.capacity) < 0) {\n        virReportSystemError(errno, _(\"failed to create volume '%s/%s'\"),\n                             def->source.name, vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDCreateImage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "896-901",
    "snippet": "static int virStorageBackendRBDCreateImage(rados_ioctx_t io,\n                                           char *name, long capacity)\n{\n    int order = 0;\n    return rbd_create(io, name, capacity, &order);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rbd_create",
          "args": [
            "io",
            "name",
            "capacity",
            "&order"
          ],
          "line": 900
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int virStorageBackendRBDCreateImage(rados_ioctx_t io,\n                                           char *name, long capacity)\n{\n    int order = 0;\n    return rbd_create(io, name, capacity, &order);\n}"
  },
  {
    "function_name": "virStorageBackendRBDCreateVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "873-894",
    "snippet": "static int\nvirStorageBackendRBDCreateVol(virStoragePoolObjPtr pool,\n                              virStorageVolDefPtr vol)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    if (vol->target.format != VIR_STORAGE_FILE_RAW) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"only RAW volumes are supported by this storage pool\"));\n        return -1;\n    }\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s\"",
            "def->source.name",
            "vol->name"
          ],
          "line": 891
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->key"
          ],
          "line": 890
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->target.path"
          ],
          "line": 887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"only RAW volumes are supported by this storage pool\")"
          ],
          "line": 882
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 877
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDCreateVol(virStoragePoolObjPtr pool,\n                              virStorageVolDefPtr vol)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    if (vol->target.format != VIR_STORAGE_FILE_RAW) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"only RAW volumes are supported by this storage pool\"));\n        return -1;\n    }\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDDeleteVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "830-870",
    "snippet": "static int\nvirStorageBackendRBDDeleteVol(virStoragePoolObjPtr pool,\n                              virStorageVolDefPtr vol,\n                              unsigned int flags)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n\n    virCheckFlags(VIR_STORAGE_VOL_DELETE_ZEROED |\n                  VIR_STORAGE_VOL_DELETE_WITH_SNAPSHOTS, -1);\n\n    VIR_DEBUG(\"Removing RBD image %s/%s\", def->source.name, vol->name);\n\n    if (flags & VIR_STORAGE_VOL_DELETE_ZEROED)\n        VIR_WARN(\"%s\", \"This storage backend does not support zeroed removal of volumes\");\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (flags & VIR_STORAGE_VOL_DELETE_WITH_SNAPSHOTS) {\n        if (virStorageBackendRBDCleanupSnapshots(ptr->ioctx, &def->source,\n                                                 vol) < 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Removing volume %s/%s\", def->source.name, vol->name);\n\n    rc = rbd_remove(ptr->ioctx, vol->name);\n    if (rc < 0 && (-rc) != ENOENT) {\n        virReportSystemError(errno, _(\"failed to remove volume '%s/%s'\"),\n                             def->source.name, vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to remove volume '%s/%s'\")",
            "def->source.name",
            "vol->name"
          ],
          "line": 860
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to remove volume '%s/%s'\""
          ],
          "line": 860
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_remove",
          "args": [
            "ptr->ioctx",
            "vol->name"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Removing volume %s/%s\"",
            "def->source.name",
            "vol->name"
          ],
          "line": 856
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDCleanupSnapshots",
          "args": [
            "ptr->ioctx",
            "&def->source",
            "vol"
          ],
          "line": 851
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDCleanupSnapshots",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "755-828",
          "snippet": "static int\nvirStorageBackendRBDCleanupSnapshots(rados_ioctx_t ioctx,\n                                     virStoragePoolSourcePtr source,\n                                     virStorageVolDefPtr vol)\n{\n    int ret = -1;\n    int max_snaps = 128;\n    int snap_count, protected;\n    size_t i;\n    rbd_image_t image = NULL;\n    g_autofree rbd_snap_info_t *snaps = NULL;\n\n    if (rbd_open(ioctx, vol->name, &image, NULL) < 0) {\n       virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                            vol->name);\n       goto cleanup;\n    }\n\n    do {\n        if (VIR_ALLOC_N(snaps, max_snaps))\n            goto cleanup;\n\n        snap_count = rbd_snap_list(image, snaps, &max_snaps);\n        if (snap_count <= 0)\n            VIR_FREE(snaps);\n\n    } while (snap_count == -ERANGE);\n\n    VIR_DEBUG(\"Found %d snapshots for volume %s/%s\", snap_count,\n              source->name, vol->name);\n\n    for (i = 0; i < snap_count; i++) {\n        if (rbd_snap_is_protected(image, snaps[i].name, &protected) < 0) {\n            virReportSystemError(errno, _(\"failed to verify if snapshot '%s/%s@%s' is protected\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n\n        if (protected == 1) {\n            VIR_DEBUG(\"Snapshot %s/%s@%s is protected needs to be \"\n                      \"unprotected\", source->name, vol->name,\n                      snaps[i].name);\n\n            if (rbd_snap_unprotect(image, snaps[i].name) < 0) {\n                virReportSystemError(errno, _(\"failed to unprotect snapshot '%s/%s@%s'\"),\n                                     source->name, vol->name,\n                                     snaps[i].name);\n                goto cleanup;\n            }\n        }\n\n        VIR_DEBUG(\"Removing snapshot %s/%s@%s\", source->name,\n                  vol->name, snaps[i].name);\n\n        if (rbd_snap_remove(image, snaps[i].name) < 0) {\n            virReportSystemError(errno, _(\"failed to remove snapshot '%s/%s@%s'\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    if (snaps)\n        rbd_snap_list_end(snaps);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDCleanupSnapshots(rados_ioctx_t ioctx,\n                                     virStoragePoolSourcePtr source,\n                                     virStorageVolDefPtr vol)\n{\n    int ret = -1;\n    int max_snaps = 128;\n    int snap_count, protected;\n    size_t i;\n    rbd_image_t image = NULL;\n    g_autofree rbd_snap_info_t *snaps = NULL;\n\n    if (rbd_open(ioctx, vol->name, &image, NULL) < 0) {\n       virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                            vol->name);\n       goto cleanup;\n    }\n\n    do {\n        if (VIR_ALLOC_N(snaps, max_snaps))\n            goto cleanup;\n\n        snap_count = rbd_snap_list(image, snaps, &max_snaps);\n        if (snap_count <= 0)\n            VIR_FREE(snaps);\n\n    } while (snap_count == -ERANGE);\n\n    VIR_DEBUG(\"Found %d snapshots for volume %s/%s\", snap_count,\n              source->name, vol->name);\n\n    for (i = 0; i < snap_count; i++) {\n        if (rbd_snap_is_protected(image, snaps[i].name, &protected) < 0) {\n            virReportSystemError(errno, _(\"failed to verify if snapshot '%s/%s@%s' is protected\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n\n        if (protected == 1) {\n            VIR_DEBUG(\"Snapshot %s/%s@%s is protected needs to be \"\n                      \"unprotected\", source->name, vol->name,\n                      snaps[i].name);\n\n            if (rbd_snap_unprotect(image, snaps[i].name) < 0) {\n                virReportSystemError(errno, _(\"failed to unprotect snapshot '%s/%s@%s'\"),\n                                     source->name, vol->name,\n                                     snaps[i].name);\n                goto cleanup;\n            }\n        }\n\n        VIR_DEBUG(\"Removing snapshot %s/%s@%s\", source->name,\n                  vol->name, snaps[i].name);\n\n        if (rbd_snap_remove(image, snaps[i].name) < 0) {\n            virReportSystemError(errno, _(\"failed to remove snapshot '%s/%s@%s'\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    if (snaps)\n        rbd_snap_list_end(snaps);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 847
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"%s\"",
            "\"This storage backend does not support zeroed removal of volumes\""
          ],
          "line": 845
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Removing RBD image %s/%s\"",
            "def->source.name",
            "vol->name"
          ],
          "line": 842
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_STORAGE_VOL_DELETE_ZEROED |\n                  VIR_STORAGE_VOL_DELETE_WITH_SNAPSHOTS",
            "-1"
          ],
          "line": 839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 836
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDDeleteVol(virStoragePoolObjPtr pool,\n                              virStorageVolDefPtr vol,\n                              unsigned int flags)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n\n    virCheckFlags(VIR_STORAGE_VOL_DELETE_ZEROED |\n                  VIR_STORAGE_VOL_DELETE_WITH_SNAPSHOTS, -1);\n\n    VIR_DEBUG(\"Removing RBD image %s/%s\", def->source.name, vol->name);\n\n    if (flags & VIR_STORAGE_VOL_DELETE_ZEROED)\n        VIR_WARN(\"%s\", \"This storage backend does not support zeroed removal of volumes\");\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (flags & VIR_STORAGE_VOL_DELETE_WITH_SNAPSHOTS) {\n        if (virStorageBackendRBDCleanupSnapshots(ptr->ioctx, &def->source,\n                                                 vol) < 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Removing volume %s/%s\", def->source.name, vol->name);\n\n    rc = rbd_remove(ptr->ioctx, vol->name);\n    if (rc < 0 && (-rc) != ENOENT) {\n        virReportSystemError(errno, _(\"failed to remove volume '%s/%s'\"),\n                             def->source.name, vol->name);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDCleanupSnapshots",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "755-828",
    "snippet": "static int\nvirStorageBackendRBDCleanupSnapshots(rados_ioctx_t ioctx,\n                                     virStoragePoolSourcePtr source,\n                                     virStorageVolDefPtr vol)\n{\n    int ret = -1;\n    int max_snaps = 128;\n    int snap_count, protected;\n    size_t i;\n    rbd_image_t image = NULL;\n    g_autofree rbd_snap_info_t *snaps = NULL;\n\n    if (rbd_open(ioctx, vol->name, &image, NULL) < 0) {\n       virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                            vol->name);\n       goto cleanup;\n    }\n\n    do {\n        if (VIR_ALLOC_N(snaps, max_snaps))\n            goto cleanup;\n\n        snap_count = rbd_snap_list(image, snaps, &max_snaps);\n        if (snap_count <= 0)\n            VIR_FREE(snaps);\n\n    } while (snap_count == -ERANGE);\n\n    VIR_DEBUG(\"Found %d snapshots for volume %s/%s\", snap_count,\n              source->name, vol->name);\n\n    for (i = 0; i < snap_count; i++) {\n        if (rbd_snap_is_protected(image, snaps[i].name, &protected) < 0) {\n            virReportSystemError(errno, _(\"failed to verify if snapshot '%s/%s@%s' is protected\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n\n        if (protected == 1) {\n            VIR_DEBUG(\"Snapshot %s/%s@%s is protected needs to be \"\n                      \"unprotected\", source->name, vol->name,\n                      snaps[i].name);\n\n            if (rbd_snap_unprotect(image, snaps[i].name) < 0) {\n                virReportSystemError(errno, _(\"failed to unprotect snapshot '%s/%s@%s'\"),\n                                     source->name, vol->name,\n                                     snaps[i].name);\n                goto cleanup;\n            }\n        }\n\n        VIR_DEBUG(\"Removing snapshot %s/%s@%s\", source->name,\n                  vol->name, snaps[i].name);\n\n        if (rbd_snap_remove(image, snaps[i].name) < 0) {\n            virReportSystemError(errno, _(\"failed to remove snapshot '%s/%s@%s'\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    if (snaps)\n        rbd_snap_list_end(snaps);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rbd_close",
          "args": [
            "image"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_snap_list_end",
          "args": [
            "snaps"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to remove snapshot '%s/%s@%s'\")",
            "source->name",
            "vol->name",
            "snaps[i].name"
          ],
          "line": 811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to remove snapshot '%s/%s@%s'\""
          ],
          "line": 811
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_snap_remove",
          "args": [
            "image",
            "snaps[i].name"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Removing snapshot %s/%s@%s\"",
            "source->name",
            "vol->name",
            "snaps[i].name"
          ],
          "line": 807
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to unprotect snapshot '%s/%s@%s'\")",
            "source->name",
            "vol->name",
            "snaps[i].name"
          ],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_snap_unprotect",
          "args": [
            "image",
            "snaps[i].name"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Snapshot %s/%s@%s is protected needs to be \"\n                      \"unprotected\"",
            "source->name",
            "vol->name",
            "snaps[i].name"
          ],
          "line": 795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to verify if snapshot '%s/%s@%s' is protected\")",
            "source->name",
            "vol->name",
            "snaps[i].name"
          ],
          "line": 788
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_snap_is_protected",
          "args": [
            "image",
            "snaps[i].name",
            "&protected"
          ],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Found %d snapshots for volume %s/%s\"",
            "snap_count",
            "source->name",
            "vol->name"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "snaps"
          ],
          "line": 779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_snap_list",
          "args": [
            "image",
            "snaps",
            "&max_snaps"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "snaps",
            "max_snaps"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to open the RBD image '%s'\")",
            "vol->name"
          ],
          "line": 768
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_open",
          "args": [
            "ioctx",
            "vol->name",
            "&image",
            "NULL"
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDCleanupSnapshots(rados_ioctx_t ioctx,\n                                     virStoragePoolSourcePtr source,\n                                     virStorageVolDefPtr vol)\n{\n    int ret = -1;\n    int max_snaps = 128;\n    int snap_count, protected;\n    size_t i;\n    rbd_image_t image = NULL;\n    g_autofree rbd_snap_info_t *snaps = NULL;\n\n    if (rbd_open(ioctx, vol->name, &image, NULL) < 0) {\n       virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                            vol->name);\n       goto cleanup;\n    }\n\n    do {\n        if (VIR_ALLOC_N(snaps, max_snaps))\n            goto cleanup;\n\n        snap_count = rbd_snap_list(image, snaps, &max_snaps);\n        if (snap_count <= 0)\n            VIR_FREE(snaps);\n\n    } while (snap_count == -ERANGE);\n\n    VIR_DEBUG(\"Found %d snapshots for volume %s/%s\", snap_count,\n              source->name, vol->name);\n\n    for (i = 0; i < snap_count; i++) {\n        if (rbd_snap_is_protected(image, snaps[i].name, &protected) < 0) {\n            virReportSystemError(errno, _(\"failed to verify if snapshot '%s/%s@%s' is protected\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n\n        if (protected == 1) {\n            VIR_DEBUG(\"Snapshot %s/%s@%s is protected needs to be \"\n                      \"unprotected\", source->name, vol->name,\n                      snaps[i].name);\n\n            if (rbd_snap_unprotect(image, snaps[i].name) < 0) {\n                virReportSystemError(errno, _(\"failed to unprotect snapshot '%s/%s@%s'\"),\n                                     source->name, vol->name,\n                                     snaps[i].name);\n                goto cleanup;\n            }\n        }\n\n        VIR_DEBUG(\"Removing snapshot %s/%s@%s\", source->name,\n                  vol->name, snaps[i].name);\n\n        if (rbd_snap_remove(image, snaps[i].name) < 0) {\n            virReportSystemError(errno, _(\"failed to remove snapshot '%s/%s@%s'\"),\n                                 source->name, vol->name,\n                                 snaps[i].name);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    if (snaps)\n        rbd_snap_list_end(snaps);\n\n    if (image)\n        rbd_close(image);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDRefreshPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "676-753",
    "snippet": "static int\nvirStorageBackendRBDRefreshPool(virStoragePoolObjPtr pool)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n    struct rados_cluster_stat_t clusterstat;\n    struct rados_pool_stat_t poolstat;\n    char **names = NULL;\n    size_t i;\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (rados_cluster_stat(ptr->cluster, &clusterstat) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to stat the RADOS cluster\"));\n        goto cleanup;\n    }\n\n    if (rados_ioctx_pool_stat(ptr->ioctx, &poolstat) < 0) {\n        virReportSystemError(errno, _(\"failed to stat the RADOS pool '%s'\"),\n                             def->source.name);\n        goto cleanup;\n    }\n\n    def->capacity = clusterstat.kb * 1024;\n    def->available = clusterstat.kb_avail * 1024;\n    def->allocation = poolstat.num_bytes;\n\n    VIR_DEBUG(\"Utilization of RBD pool %s: (kb: %\"PRIu64\" kb_avail: %\"PRIu64\n              \" num_bytes: %\"PRIu64\")\",\n              def->source.name, clusterstat.kb, clusterstat.kb_avail,\n              poolstat.num_bytes);\n\n    if (!(names = virStorageBackendRBDGetVolNames(ptr)))\n        goto cleanup;\n\n    for (i = 0; names[i] != NULL; i++) {\n        g_autoptr(virStorageVolDef) vol = NULL;\n\n        if (VIR_ALLOC(vol) < 0)\n            goto cleanup;\n\n        vol->name = g_steal_pointer(&names[i]);\n\n        rc = volStorageBackendRBDRefreshVolInfo(vol, pool, ptr);\n\n        /* It could be that a volume has been deleted through a different route\n         * then libvirt and that will cause a -ENOENT to be returned.\n         *\n         * Another possibility is that there is something wrong with the placement\n         * group (PG) that RBD image's header is in and that causes -ETIMEDOUT\n         * to be returned.\n         *\n         * Do not error out and simply ignore the volume\n         */\n        if (rc < 0) {\n            if (rc == -ENOENT || rc == -ETIMEDOUT)\n                continue;\n\n            goto cleanup;\n        }\n\n        if (virStoragePoolObjAddVol(pool, vol) < 0)\n            goto cleanup;\n        vol = NULL;\n    }\n\n    VIR_DEBUG(\"Found %zu images in RBD pool %s\",\n              virStoragePoolObjGetVolumesCount(pool), def->source.name);\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(names);\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 751
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringListFree",
          "args": [
            "names"
          ],
          "line": 750
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "306-314",
          "snippet": "void virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Found %zu images in RBD pool %s\"",
            "virStoragePoolObjGetVolumesCount(pool)",
            "def->source.name"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetVolumesCount",
          "args": [
            "pool"
          ],
          "line": 745
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetVolumesCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "711-721",
          "snippet": "size_t\nvirStoragePoolObjGetVolumesCount(virStoragePoolObjPtr obj)\n{\n    size_t nbElems;\n\n    virObjectRWLockRead(obj->volumes);\n    nbElems = virHashSize(obj->volumes->objsKey);\n    virObjectRWUnlock(obj->volumes);\n\n    return nbElems;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nsize_t\nvirStoragePoolObjGetVolumesCount(virStoragePoolObjPtr obj)\n{\n    size_t nbElems;\n\n    virObjectRWLockRead(obj->volumes);\n    nbElems = virHashSize(obj->volumes->objsKey);\n    virObjectRWUnlock(obj->volumes);\n\n    return nbElems;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjAddVol",
          "args": [
            "pool",
            "vol"
          ],
          "line": 739
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjAddVol",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "641-679",
          "snippet": "int\nvirStoragePoolObjAddVol(virStoragePoolObjPtr obj,\n                        virStorageVolDefPtr voldef)\n{\n    virStorageVolObjPtr volobj = NULL;\n    virStorageVolObjListPtr volumes = obj->volumes;\n\n    virObjectRWLockWrite(volumes);\n\n    if (!(volobj = virStorageVolObjNew()))\n        goto error;\n\n    if (virHashAddEntry(volumes->objsKey, voldef->key, volobj) < 0)\n        goto error;\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsName, voldef->name, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsPath, voldef->target.path, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        virHashRemoveEntry(volumes->objsName, voldef->name);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    volobj->voldef = voldef;\n    virObjectRWUnlock(volumes);\n    virStorageVolObjEndAPI(&volobj);\n    return 0;\n\n error:\n    virStorageVolObjEndAPI(&volobj);\n    virObjectRWUnlock(volumes);\n    return -1;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirStoragePoolObjAddVol(virStoragePoolObjPtr obj,\n                        virStorageVolDefPtr voldef)\n{\n    virStorageVolObjPtr volobj = NULL;\n    virStorageVolObjListPtr volumes = obj->volumes;\n\n    virObjectRWLockWrite(volumes);\n\n    if (!(volobj = virStorageVolObjNew()))\n        goto error;\n\n    if (virHashAddEntry(volumes->objsKey, voldef->key, volobj) < 0)\n        goto error;\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsName, voldef->name, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsPath, voldef->target.path, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        virHashRemoveEntry(volumes->objsName, voldef->name);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    volobj->voldef = voldef;\n    virObjectRWUnlock(volumes);\n    virStorageVolObjEndAPI(&volobj);\n    return 0;\n\n error:\n    virStorageVolObjEndAPI(&volobj);\n    virObjectRWUnlock(volumes);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "volStorageBackendRBDRefreshVolInfo",
          "args": [
            "vol",
            "pool",
            "ptr"
          ],
          "line": 721
        },
        "resolved": true,
        "details": {
          "function_name": "volStorageBackendRBDRefreshVolInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "509-581",
          "snippet": "static int\nvolStorageBackendRBDRefreshVolInfo(virStorageVolDefPtr vol,\n                                   virStoragePoolObjPtr pool,\n                                   virStorageBackendRBDStatePtr ptr)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t features;\n    uint64_t flags;\n\n    if ((rc = rbd_open_read_only(ptr->ioctx, vol->name, &image, NULL)) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = rbd_stat(image, &info, sizeof(info))) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to stat the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFeatures(image, vol->name, &features)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFlags(image, vol->name, &flags)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    vol->target.capacity = info.size;\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n    vol->target.format = VIR_STORAGE_FILE_RAW;\n\n    if (def->refresh &&\n        def->refresh->volume.allocation == VIR_STORAGE_VOL_DEF_REFRESH_ALLOCATION_DEFAULT &&\n        volStorageBackendRBDUseFastDiff(features, flags)) {\n        VIR_DEBUG(\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\",\n                  def->source.name, vol->name);\n\n        if ((rc = virStorageBackendRBDSetAllocation(vol, image, &info)) < 0) {\n            ret = rc;\n            goto cleanup;\n        }\n    } else {\n        vol->target.allocation = info.obj_size * info.num_objs;\n    }\n\n    VIR_DEBUG(\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\",\n              def->source.name, vol->name, vol->target.capacity,\n              vol->target.allocation, info.obj_size, info.num_objs);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDRefreshVolInfo(virStorageVolDefPtr vol,\n                                   virStoragePoolObjPtr pool,\n                                   virStorageBackendRBDStatePtr ptr)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t features;\n    uint64_t flags;\n\n    if ((rc = rbd_open_read_only(ptr->ioctx, vol->name, &image, NULL)) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = rbd_stat(image, &info, sizeof(info))) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to stat the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFeatures(image, vol->name, &features)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFlags(image, vol->name, &flags)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    vol->target.capacity = info.size;\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n    vol->target.format = VIR_STORAGE_FILE_RAW;\n\n    if (def->refresh &&\n        def->refresh->volume.allocation == VIR_STORAGE_VOL_DEF_REFRESH_ALLOCATION_DEFAULT &&\n        volStorageBackendRBDUseFastDiff(features, flags)) {\n        VIR_DEBUG(\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\",\n                  def->source.name, vol->name);\n\n        if ((rc = virStorageBackendRBDSetAllocation(vol, image, &info)) < 0) {\n            ret = rc;\n            goto cleanup;\n        }\n    } else {\n        vol->target.allocation = info.obj_size * info.num_objs;\n    }\n\n    VIR_DEBUG(\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\",\n              def->source.name, vol->name, vol->target.capacity,\n              vol->target.allocation, info.obj_size, info.num_objs);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&names[i]"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "vol"
          ],
          "line": 716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDGetVolNames",
          "args": [
            "ptr"
          ],
          "line": 710
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDGetVolNames",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "626-672",
          "snippet": "static char **\nvirStorageBackendRBDGetVolNames(virStorageBackendRBDStatePtr ptr)\n{\n    char **names = NULL;\n    size_t nnames = 0;\n    int rc;\n    size_t max_size = 1024;\n    g_autofree char *namebuf = NULL;\n    const char *name;\n\n    while (true) {\n        if (VIR_ALLOC_N(namebuf, max_size) < 0)\n            goto error;\n\n        rc = rbd_list(ptr->ioctx, namebuf, &max_size);\n        if (rc >= 0)\n            break;\n        if (rc != -ERANGE) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to list RBD images\"));\n            goto error;\n        }\n        VIR_FREE(namebuf);\n    }\n\n    for (name = namebuf; name < namebuf + max_size;) {\n        g_autofree char *namedup = NULL;\n\n        if (STREQ(name, \"\"))\n            break;\n\n        namedup = g_strdup(name);\n\n        if (VIR_APPEND_ELEMENT(names, nnames, namedup) < 0)\n            goto error;\n\n        name += strlen(name) + 1;\n    }\n\n    if (VIR_EXPAND_N(names, nnames, 1) < 0)\n        goto error;\n\n    return names;\n\n error:\n    virStringListFreeCount(names, nnames);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic char **\nvirStorageBackendRBDGetVolNames(virStorageBackendRBDStatePtr ptr)\n{\n    char **names = NULL;\n    size_t nnames = 0;\n    int rc;\n    size_t max_size = 1024;\n    g_autofree char *namebuf = NULL;\n    const char *name;\n\n    while (true) {\n        if (VIR_ALLOC_N(namebuf, max_size) < 0)\n            goto error;\n\n        rc = rbd_list(ptr->ioctx, namebuf, &max_size);\n        if (rc >= 0)\n            break;\n        if (rc != -ERANGE) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to list RBD images\"));\n            goto error;\n        }\n        VIR_FREE(namebuf);\n    }\n\n    for (name = namebuf; name < namebuf + max_size;) {\n        g_autofree char *namedup = NULL;\n\n        if (STREQ(name, \"\"))\n            break;\n\n        namedup = g_strdup(name);\n\n        if (VIR_APPEND_ELEMENT(names, nnames, namedup) < 0)\n            goto error;\n\n        name += strlen(name) + 1;\n    }\n\n    if (VIR_EXPAND_N(names, nnames, 1) < 0)\n        goto error;\n\n    return names;\n\n error:\n    virStringListFreeCount(names, nnames);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Utilization of RBD pool %s: (kb: %\"PRIu64\" kb_avail: %\"PRIu64\n              \" num_bytes: %\"PRIu64\")\"",
            "def->source.name",
            "clusterstat.kb",
            "clusterstat.kb_avail",
            "poolstat.num_bytes"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to stat the RADOS pool '%s'\")",
            "def->source.name"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to stat the RADOS pool '%s'\""
          ],
          "line": 696
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rados_ioctx_pool_stat",
          "args": [
            "ptr->ioctx",
            "&poolstat"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to stat the RADOS cluster\")"
          ],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rados_cluster_stat",
          "args": [
            "ptr->cluster",
            "&clusterstat"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDNewState",
          "args": [
            "pool"
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDNewState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "382-402",
          "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDRefreshPool(virStoragePoolObjPtr pool)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    virStorageBackendRBDStatePtr ptr = NULL;\n    struct rados_cluster_stat_t clusterstat;\n    struct rados_pool_stat_t poolstat;\n    char **names = NULL;\n    size_t i;\n\n    if (!(ptr = virStorageBackendRBDNewState(pool)))\n        goto cleanup;\n\n    if (rados_cluster_stat(ptr->cluster, &clusterstat) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to stat the RADOS cluster\"));\n        goto cleanup;\n    }\n\n    if (rados_ioctx_pool_stat(ptr->ioctx, &poolstat) < 0) {\n        virReportSystemError(errno, _(\"failed to stat the RADOS pool '%s'\"),\n                             def->source.name);\n        goto cleanup;\n    }\n\n    def->capacity = clusterstat.kb * 1024;\n    def->available = clusterstat.kb_avail * 1024;\n    def->allocation = poolstat.num_bytes;\n\n    VIR_DEBUG(\"Utilization of RBD pool %s: (kb: %\"PRIu64\" kb_avail: %\"PRIu64\n              \" num_bytes: %\"PRIu64\")\",\n              def->source.name, clusterstat.kb, clusterstat.kb_avail,\n              poolstat.num_bytes);\n\n    if (!(names = virStorageBackendRBDGetVolNames(ptr)))\n        goto cleanup;\n\n    for (i = 0; names[i] != NULL; i++) {\n        g_autoptr(virStorageVolDef) vol = NULL;\n\n        if (VIR_ALLOC(vol) < 0)\n            goto cleanup;\n\n        vol->name = g_steal_pointer(&names[i]);\n\n        rc = volStorageBackendRBDRefreshVolInfo(vol, pool, ptr);\n\n        /* It could be that a volume has been deleted through a different route\n         * then libvirt and that will cause a -ENOENT to be returned.\n         *\n         * Another possibility is that there is something wrong with the placement\n         * group (PG) that RBD image's header is in and that causes -ETIMEDOUT\n         * to be returned.\n         *\n         * Do not error out and simply ignore the volume\n         */\n        if (rc < 0) {\n            if (rc == -ENOENT || rc == -ETIMEDOUT)\n                continue;\n\n            goto cleanup;\n        }\n\n        if (virStoragePoolObjAddVol(pool, vol) < 0)\n            goto cleanup;\n        vol = NULL;\n    }\n\n    VIR_DEBUG(\"Found %zu images in RBD pool %s\",\n              virStoragePoolObjGetVolumesCount(pool), def->source.name);\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(names);\n    virStorageBackendRBDFreeState(&ptr);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDGetVolNames",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "626-672",
    "snippet": "static char **\nvirStorageBackendRBDGetVolNames(virStorageBackendRBDStatePtr ptr)\n{\n    char **names = NULL;\n    size_t nnames = 0;\n    int rc;\n    size_t max_size = 1024;\n    g_autofree char *namebuf = NULL;\n    const char *name;\n\n    while (true) {\n        if (VIR_ALLOC_N(namebuf, max_size) < 0)\n            goto error;\n\n        rc = rbd_list(ptr->ioctx, namebuf, &max_size);\n        if (rc >= 0)\n            break;\n        if (rc != -ERANGE) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to list RBD images\"));\n            goto error;\n        }\n        VIR_FREE(namebuf);\n    }\n\n    for (name = namebuf; name < namebuf + max_size;) {\n        g_autofree char *namedup = NULL;\n\n        if (STREQ(name, \"\"))\n            break;\n\n        namedup = g_strdup(name);\n\n        if (VIR_APPEND_ELEMENT(names, nnames, namedup) < 0)\n            goto error;\n\n        name += strlen(name) + 1;\n    }\n\n    if (VIR_EXPAND_N(names, nnames, 1) < 0)\n        goto error;\n\n    return names;\n\n error:\n    virStringListFreeCount(names, nnames);\n    return NULL;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStringListFreeCount",
          "args": [
            "names",
            "nnames"
          ],
          "line": 670
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFreeCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "334-347",
          "snippet": "void\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "names",
            "nnames",
            "1"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "names",
            "nnames",
            "namedup"
          ],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "name"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "name",
            "\"\""
          ],
          "line": 653
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "namebuf"
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to list RBD images\")"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_list",
          "args": [
            "ptr->ioctx",
            "namebuf",
            "&max_size"
          ],
          "line": 640
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "namebuf",
            "max_size"
          ],
          "line": 637
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic char **\nvirStorageBackendRBDGetVolNames(virStorageBackendRBDStatePtr ptr)\n{\n    char **names = NULL;\n    size_t nnames = 0;\n    int rc;\n    size_t max_size = 1024;\n    g_autofree char *namebuf = NULL;\n    const char *name;\n\n    while (true) {\n        if (VIR_ALLOC_N(namebuf, max_size) < 0)\n            goto error;\n\n        rc = rbd_list(ptr->ioctx, namebuf, &max_size);\n        if (rc >= 0)\n            break;\n        if (rc != -ERANGE) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to list RBD images\"));\n            goto error;\n        }\n        VIR_FREE(namebuf);\n    }\n\n    for (name = namebuf; name < namebuf + max_size;) {\n        g_autofree char *namedup = NULL;\n\n        if (STREQ(name, \"\"))\n            break;\n\n        namedup = g_strdup(name);\n\n        if (VIR_APPEND_ELEMENT(names, nnames, namedup) < 0)\n            goto error;\n\n        name += strlen(name) + 1;\n    }\n\n    if (VIR_EXPAND_N(names, nnames, 1) < 0)\n        goto error;\n\n    return names;\n\n error:\n    virStringListFreeCount(names, nnames);\n    return NULL;\n}"
  },
  {
    "function_name": "virStorageBackendRBDGetVolNames",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "585-622",
    "snippet": "static char **\nvirStorageBackendRBDGetVolNames(virStorageBackendRBDStatePtr ptr)\n{\n    char **names = NULL;\n    size_t nnames = 0;\n    int rc;\n    rbd_image_spec_t *images = NULL;\n    size_t nimages = 16;\n    size_t i;\n\n    while (true) {\n        if (VIR_REALLOC_N(images, nimages) < 0)\n            goto error;\n\n        rc = rbd_list2(ptr->ioctx, images, &nimages);\n        if (rc >= 0)\n            break;\n        if (rc != -ERANGE) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to list RBD images\"));\n            goto error;\n        }\n    }\n\n    if (VIR_ALLOC_N(names, nimages + 1) < 0)\n        goto error;\n    nnames = nimages;\n\n    for (i = 0; i < nimages; i++)\n        names[i] = g_steal_pointer(&images[i].name);\n\n    return names;\n\n error:\n    virStringListFreeCount(names, nnames);\n    rbd_image_spec_list_cleanup(images, nimages);\n    VIR_FREE(images);\n    return NULL;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "images"
          ],
          "line": 620
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_image_spec_list_cleanup",
          "args": [
            "images",
            "nimages"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStringListFreeCount",
          "args": [
            "names",
            "nnames"
          ],
          "line": 618
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFreeCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "334-347",
          "snippet": "void\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&images[i].name"
          ],
          "line": 613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "names",
            "nimages + 1"
          ],
          "line": 608
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to list RBD images\")"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to list RBD images\""
          ],
          "line": 603
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_list2",
          "args": [
            "ptr->ioctx",
            "images",
            "&nimages"
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_REALLOC_N",
          "args": [
            "images",
            "nimages"
          ],
          "line": 596
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic char **\nvirStorageBackendRBDGetVolNames(virStorageBackendRBDStatePtr ptr)\n{\n    char **names = NULL;\n    size_t nnames = 0;\n    int rc;\n    rbd_image_spec_t *images = NULL;\n    size_t nimages = 16;\n    size_t i;\n\n    while (true) {\n        if (VIR_REALLOC_N(images, nimages) < 0)\n            goto error;\n\n        rc = rbd_list2(ptr->ioctx, images, &nimages);\n        if (rc >= 0)\n            break;\n        if (rc != -ERANGE) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to list RBD images\"));\n            goto error;\n        }\n    }\n\n    if (VIR_ALLOC_N(names, nimages + 1) < 0)\n        goto error;\n    nnames = nimages;\n\n    for (i = 0; i < nimages; i++)\n        names[i] = g_steal_pointer(&images[i].name);\n\n    return names;\n\n error:\n    virStringListFreeCount(names, nnames);\n    rbd_image_spec_list_cleanup(images, nimages);\n    VIR_FREE(images);\n    return NULL;\n}"
  },
  {
    "function_name": "volStorageBackendRBDRefreshVolInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "509-581",
    "snippet": "static int\nvolStorageBackendRBDRefreshVolInfo(virStorageVolDefPtr vol,\n                                   virStoragePoolObjPtr pool,\n                                   virStorageBackendRBDStatePtr ptr)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t features;\n    uint64_t flags;\n\n    if ((rc = rbd_open_read_only(ptr->ioctx, vol->name, &image, NULL)) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = rbd_stat(image, &info, sizeof(info))) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to stat the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFeatures(image, vol->name, &features)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFlags(image, vol->name, &flags)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    vol->target.capacity = info.size;\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n    vol->target.format = VIR_STORAGE_FILE_RAW;\n\n    if (def->refresh &&\n        def->refresh->volume.allocation == VIR_STORAGE_VOL_DEF_REFRESH_ALLOCATION_DEFAULT &&\n        volStorageBackendRBDUseFastDiff(features, flags)) {\n        VIR_DEBUG(\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\",\n                  def->source.name, vol->name);\n\n        if ((rc = virStorageBackendRBDSetAllocation(vol, image, &info)) < 0) {\n            ret = rc;\n            goto cleanup;\n        }\n    } else {\n        vol->target.allocation = info.obj_size * info.num_objs;\n    }\n\n    VIR_DEBUG(\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\",\n              def->source.name, vol->name, vol->target.capacity,\n              vol->target.allocation, info.obj_size, info.num_objs);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rbd_close",
          "args": [
            "image"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s\"",
            "def->source.name",
            "vol->name"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->key"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->target.path"
          ],
          "line": 569
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\"",
            "def->source.name",
            "vol->name",
            "vol->target.capacity",
            "vol->target.allocation",
            "info.obj_size",
            "info.num_objs"
          ],
          "line": 564
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDSetAllocation",
          "args": [
            "vol",
            "image",
            "&info"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDSetAllocation",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "500-506",
          "snippet": "static int\nvirStorageBackendRBDSetAllocation(virStorageVolDefPtr vol G_GNUC_UNUSED,\n                                  rbd_image_t *image G_GNUC_UNUSED,\n                                  rbd_image_info_t *info G_GNUC_UNUSED)\n{\n    return false;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSetAllocation(virStorageVolDefPtr vol G_GNUC_UNUSED,\n                                  rbd_image_t *image G_GNUC_UNUSED,\n                                  rbd_image_info_t *info G_GNUC_UNUSED)\n{\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\"",
            "def->source.name",
            "vol->name"
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "volStorageBackendRBDUseFastDiff",
          "args": [
            "features",
            "flags"
          ],
          "line": 551
        },
        "resolved": true,
        "details": {
          "function_name": "volStorageBackendRBDUseFastDiff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "493-498",
          "snippet": "static int\nvolStorageBackendRBDUseFastDiff(uint64_t features G_GNUC_UNUSED,\n                                uint64_t feature_flags G_GNUC_UNUSED)\n{\n    return false;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDUseFastDiff(uint64_t features G_GNUC_UNUSED,\n                                uint64_t feature_flags G_GNUC_UNUSED)\n{\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "volStorageBackendRBDGetFlags",
          "args": [
            "image",
            "vol->name",
            "&flags"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "volStorageBackendRBDGetFlags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "484-491",
          "snippet": "static int\nvolStorageBackendRBDGetFlags(rbd_image_t image G_GNUC_UNUSED,\n                             const char *volname G_GNUC_UNUSED,\n                             uint64_t *flags)\n{\n    *flags = 0;\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDGetFlags(rbd_image_t image G_GNUC_UNUSED,\n                             const char *volname G_GNUC_UNUSED,\n                             uint64_t *flags)\n{\n    *flags = 0;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "volStorageBackendRBDGetFeatures",
          "args": [
            "image",
            "vol->name",
            "&features"
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "volStorageBackendRBDGetFeatures",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "405-419",
          "snippet": "static int\nvolStorageBackendRBDGetFeatures(rbd_image_t image,\n                                const char *volname,\n                                uint64_t *features)\n{\n    int rc;\n\n    if ((rc = rbd_get_features(image, features)) < 0) {\n        virReportSystemError(errno, _(\"failed to get the features of RBD image \"\n                                 \"%s\"), volname);\n        return rc;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDGetFeatures(rbd_image_t image,\n                                const char *volname,\n                                uint64_t *features)\n{\n    int rc;\n\n    if ((rc = rbd_get_features(image, features)) < 0) {\n        virReportSystemError(errno, _(\"failed to get the features of RBD image \"\n                                 \"%s\"), volname);\n        return rc;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to stat the RBD image '%s'\")",
            "vol->name"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_stat",
          "args": [
            "image",
            "&info",
            "sizeof(info)"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to open the RBD image '%s'\")",
            "vol->name"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbd_open_read_only",
          "args": [
            "ptr->ioctx",
            "vol->name",
            "&image",
            "NULL"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 515
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDRefreshVolInfo(virStorageVolDefPtr vol,\n                                   virStoragePoolObjPtr pool,\n                                   virStorageBackendRBDStatePtr ptr)\n{\n    int rc, ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    rbd_image_t image = NULL;\n    rbd_image_info_t info;\n    uint64_t features;\n    uint64_t flags;\n\n    if ((rc = rbd_open_read_only(ptr->ioctx, vol->name, &image, NULL)) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to open the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = rbd_stat(image, &info, sizeof(info))) < 0) {\n        ret = rc;\n        virReportSystemError(errno, _(\"failed to stat the RBD image '%s'\"),\n                             vol->name);\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFeatures(image, vol->name, &features)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    if ((rc = volStorageBackendRBDGetFlags(image, vol->name, &flags)) < 0) {\n        ret = rc;\n        goto cleanup;\n    }\n\n    vol->target.capacity = info.size;\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n    vol->target.format = VIR_STORAGE_FILE_RAW;\n\n    if (def->refresh &&\n        def->refresh->volume.allocation == VIR_STORAGE_VOL_DEF_REFRESH_ALLOCATION_DEFAULT &&\n        volStorageBackendRBDUseFastDiff(features, flags)) {\n        VIR_DEBUG(\"RBD image %s/%s has fast-diff feature enabled. \"\n                  \"Querying for actual allocation\",\n                  def->source.name, vol->name);\n\n        if ((rc = virStorageBackendRBDSetAllocation(vol, image, &info)) < 0) {\n            ret = rc;\n            goto cleanup;\n        }\n    } else {\n        vol->target.allocation = info.obj_size * info.num_objs;\n    }\n\n    VIR_DEBUG(\"Refreshed RBD image %s/%s (capacity: %llu allocation: %llu \"\n                      \"obj_size: %\"PRIu64\" num_objs: %\"PRIu64\")\",\n              def->source.name, vol->name, vol->target.capacity,\n              vol->target.allocation, info.obj_size, info.num_objs);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    ret = 0;\n\n cleanup:\n    if (image)\n        rbd_close(image);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDSetAllocation",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "500-506",
    "snippet": "static int\nvirStorageBackendRBDSetAllocation(virStorageVolDefPtr vol G_GNUC_UNUSED,\n                                  rbd_image_t *image G_GNUC_UNUSED,\n                                  rbd_image_info_t *info G_GNUC_UNUSED)\n{\n    return false;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSetAllocation(virStorageVolDefPtr vol G_GNUC_UNUSED,\n                                  rbd_image_t *image G_GNUC_UNUSED,\n                                  rbd_image_info_t *info G_GNUC_UNUSED)\n{\n    return false;\n}"
  },
  {
    "function_name": "volStorageBackendRBDUseFastDiff",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "493-498",
    "snippet": "static int\nvolStorageBackendRBDUseFastDiff(uint64_t features G_GNUC_UNUSED,\n                                uint64_t feature_flags G_GNUC_UNUSED)\n{\n    return false;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDUseFastDiff(uint64_t features G_GNUC_UNUSED,\n                                uint64_t feature_flags G_GNUC_UNUSED)\n{\n    return false;\n}"
  },
  {
    "function_name": "volStorageBackendRBDGetFlags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "484-491",
    "snippet": "static int\nvolStorageBackendRBDGetFlags(rbd_image_t image G_GNUC_UNUSED,\n                             const char *volname G_GNUC_UNUSED,\n                             uint64_t *flags)\n{\n    *flags = 0;\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDGetFlags(rbd_image_t image G_GNUC_UNUSED,\n                             const char *volname G_GNUC_UNUSED,\n                             uint64_t *flags)\n{\n    *flags = 0;\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDSetAllocation",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "459-481",
    "snippet": "static int\nvirStorageBackendRBDSetAllocation(virStorageVolDefPtr vol,\n                                  rbd_image_t *image,\n                                  rbd_image_info_t *info)\n{\n    int rc;\n    size_t allocation = 0;\n\n    if ((rc = rbd_diff_iterate2(image, NULL, 0, info->size, 0, 1,\n                               &virStorageBackendRBDRefreshVolInfoCb,\n                               &allocation)) < 0) {\n        virReportSystemError(errno, _(\"failed to iterate RBD image '%s'\"),\n                             vol->name);\n        return rc;\n    }\n\n    VIR_DEBUG(\"Found %zu bytes allocated for RBD image %s\",\n              allocation, vol->name);\n\n    vol->target.allocation = allocation;\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Found %zu bytes allocated for RBD image %s\"",
            "allocation",
            "vol->name"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to iterate RBD image '%s'\")",
            "vol->name"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to iterate RBD image '%s'\""
          ],
          "line": 470
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_diff_iterate2",
          "args": [
            "image",
            "NULL",
            "0",
            "info->size",
            "0",
            "1",
            "&virStorageBackendRBDRefreshVolInfoCb",
            "&allocation"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDSetAllocation(virStorageVolDefPtr vol,\n                                  rbd_image_t *image,\n                                  rbd_image_info_t *info)\n{\n    int rc;\n    size_t allocation = 0;\n\n    if ((rc = rbd_diff_iterate2(image, NULL, 0, info->size, 0, 1,\n                               &virStorageBackendRBDRefreshVolInfoCb,\n                               &allocation)) < 0) {\n        virReportSystemError(errno, _(\"failed to iterate RBD image '%s'\"),\n                             vol->name);\n        return rc;\n    }\n\n    VIR_DEBUG(\"Found %zu bytes allocated for RBD image %s\",\n              allocation, vol->name);\n\n    vol->target.allocation = allocation;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDRefreshVolInfoCb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "446-457",
    "snippet": "static int\nvirStorageBackendRBDRefreshVolInfoCb(uint64_t offset G_GNUC_UNUSED,\n                                     size_t len,\n                                     int exists,\n                                     void *arg)\n{\n    size_t *used_size = (size_t *)(arg);\n    if (exists)\n        (*used_size) += len;\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDRefreshVolInfoCb(uint64_t offset G_GNUC_UNUSED,\n                                     size_t len,\n                                     int exists,\n                                     void *arg)\n{\n    size_t *used_size = (size_t *)(arg);\n    if (exists)\n        (*used_size) += len;\n\n    return 0;\n}"
  },
  {
    "function_name": "volStorageBackendRBDUseFastDiff",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "439-444",
    "snippet": "static bool\nvolStorageBackendRBDUseFastDiff(uint64_t features, uint64_t flags)\n{\n    return (((features & RBD_FEATURE_FAST_DIFF) != 0ULL) &&\n            ((flags & RBD_FLAG_FAST_DIFF_INVALID) == 0ULL));\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic bool\nvolStorageBackendRBDUseFastDiff(uint64_t features, uint64_t flags)\n{\n    return (((features & RBD_FEATURE_FAST_DIFF) != 0ULL) &&\n            ((flags & RBD_FLAG_FAST_DIFF_INVALID) == 0ULL));\n}"
  },
  {
    "function_name": "volStorageBackendRBDGetFlags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "422-437",
    "snippet": "static int\nvolStorageBackendRBDGetFlags(rbd_image_t image,\n                             const char *volname,\n                             uint64_t *flags)\n{\n    int rc;\n\n    if ((rc = rbd_get_flags(image, flags)) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to get the flags of RBD image %s\"),\n                             volname);\n        return rc;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to get the flags of RBD image %s\")",
            "volname"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to get the flags of RBD image %s\""
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_get_flags",
          "args": [
            "image",
            "flags"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDGetFlags(rbd_image_t image,\n                             const char *volname,\n                             uint64_t *flags)\n{\n    int rc;\n\n    if ((rc = rbd_get_flags(image, flags)) < 0) {\n        virReportSystemError(errno,\n                             _(\"failed to get the flags of RBD image %s\"),\n                             volname);\n        return rc;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "volStorageBackendRBDGetFeatures",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "405-419",
    "snippet": "static int\nvolStorageBackendRBDGetFeatures(rbd_image_t image,\n                                const char *volname,\n                                uint64_t *features)\n{\n    int rc;\n\n    if ((rc = rbd_get_features(image, features)) < 0) {\n        virReportSystemError(errno, _(\"failed to get the features of RBD image \"\n                                 \"%s\"), volname);\n        return rc;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to get the features of RBD image \"\n                                 \"%s\")",
            "volname"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to get the features of RBD image \"\n                                 \"%s\""
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rbd_get_features",
          "args": [
            "image",
            "features"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvolStorageBackendRBDGetFeatures(rbd_image_t image,\n                                const char *volname,\n                                uint64_t *features)\n{\n    int rc;\n\n    if ((rc = rbd_get_features(image, features)) < 0) {\n        virReportSystemError(errno, _(\"failed to get the features of RBD image \"\n                                 \"%s\"), volname);\n        return rc;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendRBDNewState",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "382-402",
    "snippet": "static virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRBDFreeState",
          "args": [
            "&ptr"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDFreeState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "370-379",
          "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDOpenIoCTX",
          "args": [
            "ptr",
            "pool"
          ],
          "line": 394
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDOpenIoCTX",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "337-348",
          "snippet": "static int\nvirStorageBackendRBDOpenIoCTX(virStorageBackendRBDStatePtr ptr,\n                              virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc = rados_ioctx_create(ptr->cluster, def->source.name, &ptr->ioctx);\n    if (rc < 0) {\n        virReportSystemError(errno, _(\"failed to create the RBD IoCTX. Does the pool '%s' exist?\"),\n                             def->source.name);\n    }\n    return rc;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDOpenIoCTX(virStorageBackendRBDStatePtr ptr,\n                              virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc = rados_ioctx_create(ptr->cluster, def->source.name, &ptr->ioctx);\n    if (rc < 0) {\n        virReportSystemError(errno, _(\"failed to create the RBD IoCTX. Does the pool '%s' exist?\"),\n                             def->source.name);\n    }\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDOpenRADOSConn",
          "args": [
            "ptr",
            "def"
          ],
          "line": 391
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDOpenRADOSConn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "183-335",
          "snippet": "static int\nvirStorageBackendRBDOpenRADOSConn(virStorageBackendRBDStatePtr ptr,\n                                  virStoragePoolDefPtr def)\n{\n    int ret = -1;\n    virStoragePoolSourcePtr source = &def->source;\n    virStorageAuthDefPtr authdef = source->auth;\n    unsigned char *secret_value = NULL;\n    size_t secret_value_size = 0;\n    VIR_AUTODISPOSE_STR rados_key = NULL;\n    virBuffer mon_host = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    const char *client_mount_timeout = \"30\";\n    const char *mon_op_timeout = \"30\";\n    const char *osd_op_timeout = \"30\";\n    const char *rbd_default_format = \"2\";\n    virConnectPtr conn = NULL;\n    g_autofree char *mon_buff = NULL;\n\n    if (authdef) {\n        VIR_DEBUG(\"Using cephx authorization, username: %s\", authdef->username);\n\n        if (rados_create(&ptr->cluster, authdef->username) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"failed to initialize RADOS\"));\n            goto cleanup;\n        }\n\n        conn = virGetConnectSecret();\n        if (!conn)\n            return -1;\n\n        if (virSecretGetSecretString(conn, &authdef->seclookupdef,\n                                     VIR_SECRET_USAGE_TYPE_CEPH,\n                                     &secret_value, &secret_value_size) < 0)\n            goto cleanup;\n\n        rados_key = g_base64_encode(secret_value, secret_value_size);\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"key\", rados_key) < 0)\n            goto cleanup;\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"cephx\") < 0)\n            goto cleanup;\n    } else {\n        VIR_DEBUG(\"Not using cephx authorization\");\n        if (rados_create(&ptr->cluster, NULL) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to create the RADOS cluster\"));\n            goto cleanup;\n        }\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"none\") < 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Found %zu RADOS cluster monitors in the pool configuration\",\n              source->nhost);\n\n    /* combine host and port into portal */\n    for (i = 0; i < source->nhost; i++) {\n        if (source->hosts[i].name != NULL &&\n            !source->hosts[i].port) {\n            virBufferAsprintf(&mon_host, \"%s,\",\n                              source->hosts[i].name);\n        } else if (source->hosts[i].name != NULL &&\n            source->hosts[i].port) {\n            const char *incFormat;\n            if (virSocketAddrNumericFamily(source->hosts[i].name) == AF_INET6) {\n                /* IPv6 address must be escaped in brackets on the cmd line */\n                incFormat = \"[%s]:%d,\";\n            } else {\n                /* listenAddress is a hostname or IPv4 */\n                incFormat = \"%s:%d,\";\n            }\n            virBufferAsprintf(&mon_host, incFormat,\n                              source->hosts[i].name,\n                              source->hosts[i].port);\n        } else {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"received malformed monitor, check the XML definition\"));\n        }\n    }\n\n    mon_buff = virBufferContentAndReset(&mon_host);\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"mon_host\",\n                                         mon_buff) < 0)\n        goto cleanup;\n\n    /*\n     * Set timeout options for librados.\n     * In case the Ceph cluster is down libvirt won't block forever.\n     * Operations in librados will return -ETIMEDOUT when the timeout is reached.\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"client_mount_timeout\",\n                                         client_mount_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_mon_op_timeout\",\n                                         mon_op_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_osd_op_timeout\",\n                                         osd_op_timeout) < 0)\n        goto cleanup;\n\n    /*\n     * Librbd supports creating RBD format 2 images. We no longer have to invoke\n     * rbd_create3(), we can tell librbd to default to format 2.\n     * This leaves us to simply use rbd_create() and use the default behavior of librbd\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rbd_default_format\",\n                                         rbd_default_format) < 0)\n        goto cleanup;\n\n    if (def->namespaceData) {\n        virStoragePoolRBDConfigOptionsDefPtr cmdopts = def->namespaceData;\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        for (i = 0; i < cmdopts->noptions; i++) {\n            if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                                 cmdopts->names[i],\n                                                 cmdopts->values[i]) < 0)\n                goto cleanup;\n        }\n\n        virUUIDFormat(def->uuid, uuidstr);\n        VIR_WARN(\"Storage Pool name='%s' uuid='%s' is tainted by custom \"\n                 \"config_opts from XML\", def->name, uuidstr);\n    }\n\n    ptr->starttime = time(0);\n    if (rados_connect(ptr->cluster) < 0) {\n        virReportSystemError(errno, _(\"failed to connect to the RADOS monitor on: %s\"),\n                             mon_buff);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_DISPOSE_N(secret_value, secret_value_size);\n\n    virObjectUnref(conn);\n    virBufferFreeAndReset(&mon_host);\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDOpenRADOSConn(virStorageBackendRBDStatePtr ptr,\n                                  virStoragePoolDefPtr def)\n{\n    int ret = -1;\n    virStoragePoolSourcePtr source = &def->source;\n    virStorageAuthDefPtr authdef = source->auth;\n    unsigned char *secret_value = NULL;\n    size_t secret_value_size = 0;\n    VIR_AUTODISPOSE_STR rados_key = NULL;\n    virBuffer mon_host = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    const char *client_mount_timeout = \"30\";\n    const char *mon_op_timeout = \"30\";\n    const char *osd_op_timeout = \"30\";\n    const char *rbd_default_format = \"2\";\n    virConnectPtr conn = NULL;\n    g_autofree char *mon_buff = NULL;\n\n    if (authdef) {\n        VIR_DEBUG(\"Using cephx authorization, username: %s\", authdef->username);\n\n        if (rados_create(&ptr->cluster, authdef->username) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"failed to initialize RADOS\"));\n            goto cleanup;\n        }\n\n        conn = virGetConnectSecret();\n        if (!conn)\n            return -1;\n\n        if (virSecretGetSecretString(conn, &authdef->seclookupdef,\n                                     VIR_SECRET_USAGE_TYPE_CEPH,\n                                     &secret_value, &secret_value_size) < 0)\n            goto cleanup;\n\n        rados_key = g_base64_encode(secret_value, secret_value_size);\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"key\", rados_key) < 0)\n            goto cleanup;\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"cephx\") < 0)\n            goto cleanup;\n    } else {\n        VIR_DEBUG(\"Not using cephx authorization\");\n        if (rados_create(&ptr->cluster, NULL) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to create the RADOS cluster\"));\n            goto cleanup;\n        }\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"none\") < 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Found %zu RADOS cluster monitors in the pool configuration\",\n              source->nhost);\n\n    /* combine host and port into portal */\n    for (i = 0; i < source->nhost; i++) {\n        if (source->hosts[i].name != NULL &&\n            !source->hosts[i].port) {\n            virBufferAsprintf(&mon_host, \"%s,\",\n                              source->hosts[i].name);\n        } else if (source->hosts[i].name != NULL &&\n            source->hosts[i].port) {\n            const char *incFormat;\n            if (virSocketAddrNumericFamily(source->hosts[i].name) == AF_INET6) {\n                /* IPv6 address must be escaped in brackets on the cmd line */\n                incFormat = \"[%s]:%d,\";\n            } else {\n                /* listenAddress is a hostname or IPv4 */\n                incFormat = \"%s:%d,\";\n            }\n            virBufferAsprintf(&mon_host, incFormat,\n                              source->hosts[i].name,\n                              source->hosts[i].port);\n        } else {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"received malformed monitor, check the XML definition\"));\n        }\n    }\n\n    mon_buff = virBufferContentAndReset(&mon_host);\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"mon_host\",\n                                         mon_buff) < 0)\n        goto cleanup;\n\n    /*\n     * Set timeout options for librados.\n     * In case the Ceph cluster is down libvirt won't block forever.\n     * Operations in librados will return -ETIMEDOUT when the timeout is reached.\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"client_mount_timeout\",\n                                         client_mount_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_mon_op_timeout\",\n                                         mon_op_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_osd_op_timeout\",\n                                         osd_op_timeout) < 0)\n        goto cleanup;\n\n    /*\n     * Librbd supports creating RBD format 2 images. We no longer have to invoke\n     * rbd_create3(), we can tell librbd to default to format 2.\n     * This leaves us to simply use rbd_create() and use the default behavior of librbd\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rbd_default_format\",\n                                         rbd_default_format) < 0)\n        goto cleanup;\n\n    if (def->namespaceData) {\n        virStoragePoolRBDConfigOptionsDefPtr cmdopts = def->namespaceData;\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        for (i = 0; i < cmdopts->noptions; i++) {\n            if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                                 cmdopts->names[i],\n                                                 cmdopts->values[i]) < 0)\n                goto cleanup;\n        }\n\n        virUUIDFormat(def->uuid, uuidstr);\n        VIR_WARN(\"Storage Pool name='%s' uuid='%s' is tainted by custom \"\n                 \"config_opts from XML\", def->name, uuidstr);\n    }\n\n    ptr->starttime = time(0);\n    if (rados_connect(ptr->cluster) < 0) {\n        virReportSystemError(errno, _(\"failed to connect to the RADOS monitor on: %s\"),\n                             mon_buff);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_DISPOSE_N(secret_value, secret_value_size);\n\n    virObjectUnref(conn);\n    virBufferFreeAndReset(&mon_host);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "ptr"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 386
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic virStorageBackendRBDStatePtr\nvirStorageBackendRBDNewState(virStoragePoolObjPtr pool)\n{\n    virStorageBackendRBDStatePtr ptr;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (VIR_ALLOC(ptr) < 0)\n        return NULL;\n\n    if (virStorageBackendRBDOpenRADOSConn(ptr, def) < 0)\n        goto error;\n\n    if (virStorageBackendRBDOpenIoCTX(ptr, pool) < 0)\n        goto error;\n\n    return ptr;\n\n error:\n    virStorageBackendRBDFreeState(&ptr);\n    return NULL;\n}"
  },
  {
    "function_name": "virStorageBackendRBDFreeState",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "370-379",
    "snippet": "static void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*ptr"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDCloseRADOSConn",
          "args": [
            "*ptr"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDCloseRADOSConn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "350-367",
          "snippet": "static void\nvirStorageBackendRBDCloseRADOSConn(virStorageBackendRBDStatePtr ptr)\n{\n    if (ptr->ioctx != NULL) {\n        VIR_DEBUG(\"Closing RADOS IoCTX\");\n        rados_ioctx_destroy(ptr->ioctx);\n    }\n    ptr->ioctx = NULL;\n\n    if (ptr->cluster != NULL) {\n        VIR_DEBUG(\"Closing RADOS connection\");\n        rados_shutdown(ptr->cluster);\n    }\n    ptr->cluster = NULL;\n\n    VIR_DEBUG(\"RADOS connection existed for %ld seconds\",\n              time(0) - ptr->starttime);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDCloseRADOSConn(virStorageBackendRBDStatePtr ptr)\n{\n    if (ptr->ioctx != NULL) {\n        VIR_DEBUG(\"Closing RADOS IoCTX\");\n        rados_ioctx_destroy(ptr->ioctx);\n    }\n    ptr->ioctx = NULL;\n\n    if (ptr->cluster != NULL) {\n        VIR_DEBUG(\"Closing RADOS connection\");\n        rados_shutdown(ptr->cluster);\n    }\n    ptr->cluster = NULL;\n\n    VIR_DEBUG(\"RADOS connection existed for %ld seconds\",\n              time(0) - ptr->starttime);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDFreeState(virStorageBackendRBDStatePtr *ptr)\n{\n    if (!*ptr)\n        return;\n\n    virStorageBackendRBDCloseRADOSConn(*ptr);\n\n    VIR_FREE(*ptr);\n}"
  },
  {
    "function_name": "virStorageBackendRBDCloseRADOSConn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "350-367",
    "snippet": "static void\nvirStorageBackendRBDCloseRADOSConn(virStorageBackendRBDStatePtr ptr)\n{\n    if (ptr->ioctx != NULL) {\n        VIR_DEBUG(\"Closing RADOS IoCTX\");\n        rados_ioctx_destroy(ptr->ioctx);\n    }\n    ptr->ioctx = NULL;\n\n    if (ptr->cluster != NULL) {\n        VIR_DEBUG(\"Closing RADOS connection\");\n        rados_shutdown(ptr->cluster);\n    }\n    ptr->cluster = NULL;\n\n    VIR_DEBUG(\"RADOS connection existed for %ld seconds\",\n              time(0) - ptr->starttime);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"RADOS connection existed for %ld seconds\"",
            "time(0) - ptr->starttime"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 366
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "rados_shutdown",
          "args": [
            "ptr->cluster"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Closing RADOS connection\""
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rados_ioctx_destroy",
          "args": [
            "ptr->ioctx"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Closing RADOS IoCTX\""
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStorageBackendRBDCloseRADOSConn(virStorageBackendRBDStatePtr ptr)\n{\n    if (ptr->ioctx != NULL) {\n        VIR_DEBUG(\"Closing RADOS IoCTX\");\n        rados_ioctx_destroy(ptr->ioctx);\n    }\n    ptr->ioctx = NULL;\n\n    if (ptr->cluster != NULL) {\n        VIR_DEBUG(\"Closing RADOS connection\");\n        rados_shutdown(ptr->cluster);\n    }\n    ptr->cluster = NULL;\n\n    VIR_DEBUG(\"RADOS connection existed for %ld seconds\",\n              time(0) - ptr->starttime);\n}"
  },
  {
    "function_name": "virStorageBackendRBDOpenIoCTX",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "337-348",
    "snippet": "static int\nvirStorageBackendRBDOpenIoCTX(virStorageBackendRBDStatePtr ptr,\n                              virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc = rados_ioctx_create(ptr->cluster, def->source.name, &ptr->ioctx);\n    if (rc < 0) {\n        virReportSystemError(errno, _(\"failed to create the RBD IoCTX. Does the pool '%s' exist?\"),\n                             def->source.name);\n    }\n    return rc;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to create the RBD IoCTX. Does the pool '%s' exist?\")",
            "def->source.name"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to create the RBD IoCTX. Does the pool '%s' exist?\""
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rados_ioctx_create",
          "args": [
            "ptr->cluster",
            "def->source.name",
            "&ptr->ioctx"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 341
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDOpenIoCTX(virStorageBackendRBDStatePtr ptr,\n                              virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc = rados_ioctx_create(ptr->cluster, def->source.name, &ptr->ioctx);\n    if (rc < 0) {\n        virReportSystemError(errno, _(\"failed to create the RBD IoCTX. Does the pool '%s' exist?\"),\n                             def->source.name);\n    }\n    return rc;\n}"
  },
  {
    "function_name": "virStorageBackendRBDOpenRADOSConn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "183-335",
    "snippet": "static int\nvirStorageBackendRBDOpenRADOSConn(virStorageBackendRBDStatePtr ptr,\n                                  virStoragePoolDefPtr def)\n{\n    int ret = -1;\n    virStoragePoolSourcePtr source = &def->source;\n    virStorageAuthDefPtr authdef = source->auth;\n    unsigned char *secret_value = NULL;\n    size_t secret_value_size = 0;\n    VIR_AUTODISPOSE_STR rados_key = NULL;\n    virBuffer mon_host = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    const char *client_mount_timeout = \"30\";\n    const char *mon_op_timeout = \"30\";\n    const char *osd_op_timeout = \"30\";\n    const char *rbd_default_format = \"2\";\n    virConnectPtr conn = NULL;\n    g_autofree char *mon_buff = NULL;\n\n    if (authdef) {\n        VIR_DEBUG(\"Using cephx authorization, username: %s\", authdef->username);\n\n        if (rados_create(&ptr->cluster, authdef->username) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"failed to initialize RADOS\"));\n            goto cleanup;\n        }\n\n        conn = virGetConnectSecret();\n        if (!conn)\n            return -1;\n\n        if (virSecretGetSecretString(conn, &authdef->seclookupdef,\n                                     VIR_SECRET_USAGE_TYPE_CEPH,\n                                     &secret_value, &secret_value_size) < 0)\n            goto cleanup;\n\n        rados_key = g_base64_encode(secret_value, secret_value_size);\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"key\", rados_key) < 0)\n            goto cleanup;\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"cephx\") < 0)\n            goto cleanup;\n    } else {\n        VIR_DEBUG(\"Not using cephx authorization\");\n        if (rados_create(&ptr->cluster, NULL) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to create the RADOS cluster\"));\n            goto cleanup;\n        }\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"none\") < 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Found %zu RADOS cluster monitors in the pool configuration\",\n              source->nhost);\n\n    /* combine host and port into portal */\n    for (i = 0; i < source->nhost; i++) {\n        if (source->hosts[i].name != NULL &&\n            !source->hosts[i].port) {\n            virBufferAsprintf(&mon_host, \"%s,\",\n                              source->hosts[i].name);\n        } else if (source->hosts[i].name != NULL &&\n            source->hosts[i].port) {\n            const char *incFormat;\n            if (virSocketAddrNumericFamily(source->hosts[i].name) == AF_INET6) {\n                /* IPv6 address must be escaped in brackets on the cmd line */\n                incFormat = \"[%s]:%d,\";\n            } else {\n                /* listenAddress is a hostname or IPv4 */\n                incFormat = \"%s:%d,\";\n            }\n            virBufferAsprintf(&mon_host, incFormat,\n                              source->hosts[i].name,\n                              source->hosts[i].port);\n        } else {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"received malformed monitor, check the XML definition\"));\n        }\n    }\n\n    mon_buff = virBufferContentAndReset(&mon_host);\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"mon_host\",\n                                         mon_buff) < 0)\n        goto cleanup;\n\n    /*\n     * Set timeout options for librados.\n     * In case the Ceph cluster is down libvirt won't block forever.\n     * Operations in librados will return -ETIMEDOUT when the timeout is reached.\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"client_mount_timeout\",\n                                         client_mount_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_mon_op_timeout\",\n                                         mon_op_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_osd_op_timeout\",\n                                         osd_op_timeout) < 0)\n        goto cleanup;\n\n    /*\n     * Librbd supports creating RBD format 2 images. We no longer have to invoke\n     * rbd_create3(), we can tell librbd to default to format 2.\n     * This leaves us to simply use rbd_create() and use the default behavior of librbd\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rbd_default_format\",\n                                         rbd_default_format) < 0)\n        goto cleanup;\n\n    if (def->namespaceData) {\n        virStoragePoolRBDConfigOptionsDefPtr cmdopts = def->namespaceData;\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        for (i = 0; i < cmdopts->noptions; i++) {\n            if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                                 cmdopts->names[i],\n                                                 cmdopts->values[i]) < 0)\n                goto cleanup;\n        }\n\n        virUUIDFormat(def->uuid, uuidstr);\n        VIR_WARN(\"Storage Pool name='%s' uuid='%s' is tainted by custom \"\n                 \"config_opts from XML\", def->name, uuidstr);\n    }\n\n    ptr->starttime = time(0);\n    if (rados_connect(ptr->cluster) < 0) {\n        virReportSystemError(errno, _(\"failed to connect to the RADOS monitor on: %s\"),\n                             mon_buff);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_DISPOSE_N(secret_value, secret_value_size);\n\n    virObjectUnref(conn);\n    virBufferFreeAndReset(&mon_host);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferFreeAndReset",
          "args": [
            "&mon_host"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferFreeAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "268-277",
          "snippet": "void virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "conn"
          ],
          "line": 332
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DISPOSE_N",
          "args": [
            "secret_value",
            "secret_value_size"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to connect to the RADOS monitor on: %s\")",
            "mon_buff"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to connect to the RADOS monitor on: %s\""
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rados_connect",
          "args": [
            "ptr->cluster"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Storage Pool name='%s' uuid='%s' is tainted by custom \"\n                 \"config_opts from XML\"",
            "def->name",
            "uuidstr"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "def->uuid",
            "uuidstr"
          ],
          "line": 315
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRBDRADOSConfSet",
          "args": [
            "ptr->cluster",
            "cmdopts->names[i]",
            "cmdopts->values[i]"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRBDRADOSConfSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "166-181",
          "snippet": "static int\nvirStorageBackendRBDRADOSConfSet(rados_t cluster,\n                                 const char *option,\n                                 const char *value)\n{\n    VIR_DEBUG(\"Setting RADOS option '%s' to '%s'\",\n              option, value);\n    if (rados_conf_set(cluster, option, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to set RADOS option: %s\"),\n                       option);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDRADOSConfSet(rados_t cluster,\n                                 const char *option,\n                                 const char *value)\n{\n    VIR_DEBUG(\"Setting RADOS option '%s' to '%s'\",\n              option, value);\n    if (rados_conf_set(cluster, option, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to set RADOS option: %s\"),\n                       option);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&mon_host"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"received malformed monitor, check the XML definition\")"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "&mon_host",
            "incFormat",
            "source->hosts[i].name",
            "source->hosts[i].port"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSocketAddrNumericFamily",
          "args": [
            "source->hosts[i].name"
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrNumericFamily",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "1209-1221",
          "snippet": "int\nvirSocketAddrNumericFamily(const char *address)\n{\n    struct addrinfo *res;\n    unsigned short family;\n\n    if (virSocketAddrParseInternal(&res, address, AF_UNSPEC, AI_NUMERICHOST, false) < 0)\n        return -1;\n\n    family = res->ai_addr->sa_family;\n    freeaddrinfo(res);\n    return family;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nint\nvirSocketAddrNumericFamily(const char *address)\n{\n    struct addrinfo *res;\n    unsigned short family;\n\n    if (virSocketAddrParseInternal(&res, address, AF_UNSPEC, AI_NUMERICHOST, false) < 0)\n        return -1;\n\n    family = res->ai_addr->sa_family;\n    freeaddrinfo(res);\n    return family;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Found %zu RADOS cluster monitors in the pool configuration\"",
            "source->nhost"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed to create the RADOS cluster\")"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rados_create",
          "args": [
            "&ptr->cluster",
            "NULL"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Not using cephx authorization\""
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_base64_encode",
          "args": [
            "secret_value",
            "secret_value_size"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretGetSecretString",
          "args": [
            "conn",
            "&authdef->seclookupdef",
            "VIR_SECRET_USAGE_TYPE_CEPH",
            "&secret_value",
            "&secret_value_size"
          ],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretGetSecretString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsecret.c",
          "lines": "143-195",
          "snippet": "int\nvirSecretGetSecretString(virConnectPtr conn,\n                         virSecretLookupTypeDefPtr seclookupdef,\n                         virSecretUsageType secretUsageType,\n                         uint8_t **secret,\n                         size_t *secret_size)\n{\n    virSecretPtr sec = NULL;\n    int ret = -1;\n\n    switch (seclookupdef->type) {\n    case VIR_SECRET_LOOKUP_TYPE_UUID:\n        sec = conn->secretDriver->secretLookupByUUID(conn, seclookupdef->u.uuid);\n        break;\n\n    case VIR_SECRET_LOOKUP_TYPE_USAGE:\n        sec = conn->secretDriver->secretLookupByUsage(conn, secretUsageType,\n                                                      seclookupdef->u.usage);\n        break;\n    }\n\n    if (!sec)\n        goto cleanup;\n\n    /* NB: NONE is a byproduct of the qemuxml2argvtest test mocking\n     * for UUID lookups. Normal secret XML processing would fail if\n     * the usage type was NONE and since we have no way to set the\n     * expected usage in that environment, let's just accept NONE */\n    if (sec->usageType != VIR_SECRET_USAGE_TYPE_NONE &&\n        sec->usageType != secretUsageType) {\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        virUUIDFormat(seclookupdef->u.uuid, uuidstr);\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"secret with uuid %s is of type '%s' not \"\n                         \"expected '%s' type\"),\n                       uuidstr, virSecretUsageTypeToString(sec->usageType),\n                       virSecretUsageTypeToString(secretUsageType));\n        goto cleanup;\n    }\n\n    *secret = conn->secretDriver->secretGetValue(sec, secret_size, 0,\n                                                 VIR_SECRET_GET_VALUE_INTERNAL_CALL);\n\n    if (!*secret)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virObjectUnref(sec);\n    return ret;\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirSecretGetSecretString(virConnectPtr conn,\n                         virSecretLookupTypeDefPtr seclookupdef,\n                         virSecretUsageType secretUsageType,\n                         uint8_t **secret,\n                         size_t *secret_size)\n{\n    virSecretPtr sec = NULL;\n    int ret = -1;\n\n    switch (seclookupdef->type) {\n    case VIR_SECRET_LOOKUP_TYPE_UUID:\n        sec = conn->secretDriver->secretLookupByUUID(conn, seclookupdef->u.uuid);\n        break;\n\n    case VIR_SECRET_LOOKUP_TYPE_USAGE:\n        sec = conn->secretDriver->secretLookupByUsage(conn, secretUsageType,\n                                                      seclookupdef->u.usage);\n        break;\n    }\n\n    if (!sec)\n        goto cleanup;\n\n    /* NB: NONE is a byproduct of the qemuxml2argvtest test mocking\n     * for UUID lookups. Normal secret XML processing would fail if\n     * the usage type was NONE and since we have no way to set the\n     * expected usage in that environment, let's just accept NONE */\n    if (sec->usageType != VIR_SECRET_USAGE_TYPE_NONE &&\n        sec->usageType != secretUsageType) {\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        virUUIDFormat(seclookupdef->u.uuid, uuidstr);\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"secret with uuid %s is of type '%s' not \"\n                         \"expected '%s' type\"),\n                       uuidstr, virSecretUsageTypeToString(sec->usageType),\n                       virSecretUsageTypeToString(secretUsageType));\n        goto cleanup;\n    }\n\n    *secret = conn->secretDriver->secretGetValue(sec, secret_size, 0,\n                                                 VIR_SECRET_GET_VALUE_INTERNAL_CALL);\n\n    if (!*secret)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virObjectUnref(sec);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetConnectSecret",
          "args": [],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "184-187",
          "snippet": "virConnectPtr virGetConnectSecret(void)\n{\n    return virGetConnectGeneric(&connectSecret, \"secret\");\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal connectSecret;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectSecret;\n\nvirConnectPtr virGetConnectSecret(void)\n{\n    return virGetConnectGeneric(&connectSecret, \"secret\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to initialize RADOS\")"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rados_create",
          "args": [
            "&ptr->cluster",
            "authdef->username"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Using cephx authorization, username: %s\"",
            "authdef->username"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDOpenRADOSConn(virStorageBackendRBDStatePtr ptr,\n                                  virStoragePoolDefPtr def)\n{\n    int ret = -1;\n    virStoragePoolSourcePtr source = &def->source;\n    virStorageAuthDefPtr authdef = source->auth;\n    unsigned char *secret_value = NULL;\n    size_t secret_value_size = 0;\n    VIR_AUTODISPOSE_STR rados_key = NULL;\n    virBuffer mon_host = VIR_BUFFER_INITIALIZER;\n    size_t i;\n    const char *client_mount_timeout = \"30\";\n    const char *mon_op_timeout = \"30\";\n    const char *osd_op_timeout = \"30\";\n    const char *rbd_default_format = \"2\";\n    virConnectPtr conn = NULL;\n    g_autofree char *mon_buff = NULL;\n\n    if (authdef) {\n        VIR_DEBUG(\"Using cephx authorization, username: %s\", authdef->username);\n\n        if (rados_create(&ptr->cluster, authdef->username) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"failed to initialize RADOS\"));\n            goto cleanup;\n        }\n\n        conn = virGetConnectSecret();\n        if (!conn)\n            return -1;\n\n        if (virSecretGetSecretString(conn, &authdef->seclookupdef,\n                                     VIR_SECRET_USAGE_TYPE_CEPH,\n                                     &secret_value, &secret_value_size) < 0)\n            goto cleanup;\n\n        rados_key = g_base64_encode(secret_value, secret_value_size);\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"key\", rados_key) < 0)\n            goto cleanup;\n\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"cephx\") < 0)\n            goto cleanup;\n    } else {\n        VIR_DEBUG(\"Not using cephx authorization\");\n        if (rados_create(&ptr->cluster, NULL) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"failed to create the RADOS cluster\"));\n            goto cleanup;\n        }\n        if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                             \"auth_supported\", \"none\") < 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Found %zu RADOS cluster monitors in the pool configuration\",\n              source->nhost);\n\n    /* combine host and port into portal */\n    for (i = 0; i < source->nhost; i++) {\n        if (source->hosts[i].name != NULL &&\n            !source->hosts[i].port) {\n            virBufferAsprintf(&mon_host, \"%s,\",\n                              source->hosts[i].name);\n        } else if (source->hosts[i].name != NULL &&\n            source->hosts[i].port) {\n            const char *incFormat;\n            if (virSocketAddrNumericFamily(source->hosts[i].name) == AF_INET6) {\n                /* IPv6 address must be escaped in brackets on the cmd line */\n                incFormat = \"[%s]:%d,\";\n            } else {\n                /* listenAddress is a hostname or IPv4 */\n                incFormat = \"%s:%d,\";\n            }\n            virBufferAsprintf(&mon_host, incFormat,\n                              source->hosts[i].name,\n                              source->hosts[i].port);\n        } else {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"received malformed monitor, check the XML definition\"));\n        }\n    }\n\n    mon_buff = virBufferContentAndReset(&mon_host);\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"mon_host\",\n                                         mon_buff) < 0)\n        goto cleanup;\n\n    /*\n     * Set timeout options for librados.\n     * In case the Ceph cluster is down libvirt won't block forever.\n     * Operations in librados will return -ETIMEDOUT when the timeout is reached.\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"client_mount_timeout\",\n                                         client_mount_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_mon_op_timeout\",\n                                         mon_op_timeout) < 0)\n        goto cleanup;\n\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rados_osd_op_timeout\",\n                                         osd_op_timeout) < 0)\n        goto cleanup;\n\n    /*\n     * Librbd supports creating RBD format 2 images. We no longer have to invoke\n     * rbd_create3(), we can tell librbd to default to format 2.\n     * This leaves us to simply use rbd_create() and use the default behavior of librbd\n     */\n    if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                         \"rbd_default_format\",\n                                         rbd_default_format) < 0)\n        goto cleanup;\n\n    if (def->namespaceData) {\n        virStoragePoolRBDConfigOptionsDefPtr cmdopts = def->namespaceData;\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        for (i = 0; i < cmdopts->noptions; i++) {\n            if (virStorageBackendRBDRADOSConfSet(ptr->cluster,\n                                                 cmdopts->names[i],\n                                                 cmdopts->values[i]) < 0)\n                goto cleanup;\n        }\n\n        virUUIDFormat(def->uuid, uuidstr);\n        VIR_WARN(\"Storage Pool name='%s' uuid='%s' is tainted by custom \"\n                 \"config_opts from XML\", def->name, uuidstr);\n    }\n\n    ptr->starttime = time(0);\n    if (rados_connect(ptr->cluster) < 0) {\n        virReportSystemError(errno, _(\"failed to connect to the RADOS monitor on: %s\"),\n                             mon_buff);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_DISPOSE_N(secret_value, secret_value_size);\n\n    virObjectUnref(conn);\n    virBufferFreeAndReset(&mon_host);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendRBDRADOSConfSet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "166-181",
    "snippet": "static int\nvirStorageBackendRBDRADOSConfSet(rados_t cluster,\n                                 const char *option,\n                                 const char *value)\n{\n    VIR_DEBUG(\"Setting RADOS option '%s' to '%s'\",\n              option, value);\n    if (rados_conf_set(cluster, option, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to set RADOS option: %s\"),\n                       option);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"failed to set RADOS option: %s\")",
            "option"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to set RADOS option: %s\""
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rados_conf_set",
          "args": [
            "cluster",
            "option",
            "value"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting RADOS option '%s' to '%s'\"",
            "option",
            "value"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendRBDRADOSConfSet(rados_t cluster,\n                                 const char *option,\n                                 const char *value)\n{\n    VIR_DEBUG(\"Setting RADOS option '%s' to '%s'\",\n              option, value);\n    if (rados_conf_set(cluster, option, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"failed to set RADOS option: %s\"),\n                       option);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStoragePoolDefRBDNamespaceFormatXML",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "141-163",
    "snippet": "static int\nvirStoragePoolDefRBDNamespaceFormatXML(virBufferPtr buf,\n                                       void *nsdata)\n{\n    size_t i;\n    virStoragePoolRBDConfigOptionsDefPtr def = nsdata;\n\n    if (!def)\n        return 0;\n\n    virBufferAddLit(buf, \"<rbd:config_opts>\\n\");\n    virBufferAdjustIndent(buf, 2);\n\n    for (i = 0; i < def->noptions; i++) {\n        virBufferEscapeString(buf, \"<rbd:option name='%s' \", def->names[i]);\n        virBufferEscapeString(buf, \"value='%s'/>\\n\", def->values[i]);\n    }\n\n    virBufferAdjustIndent(buf, -2);\n    virBufferAddLit(buf, \"</rbd:config_opts>\\n\");\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "buf",
            "\"</rbd:config_opts>\\n\""
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAdjustIndent",
          "args": [
            "buf",
            "-2"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAdjustIndent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "43-62",
          "snippet": "void\nvirBufferAdjustIndent(virBufferPtr buf, int indent)\n{\n    if (!buf)\n        return;\n\n    if (indent > 0) {\n        if (INT_MAX - indent < buf->indent) {\n            buf->indent = INT_MAX;\n            return;\n        }\n    } else {\n        if (buf->indent < -indent) {\n            buf->indent = 0;\n            return;\n        }\n    }\n\n    buf->indent += indent;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAdjustIndent(virBufferPtr buf, int indent)\n{\n    if (!buf)\n        return;\n\n    if (indent > 0) {\n        if (INT_MAX - indent < buf->indent) {\n            buf->indent = INT_MAX;\n            return;\n        }\n    } else {\n        if (buf->indent < -indent) {\n            buf->indent = 0;\n            return;\n        }\n    }\n\n    buf->indent += indent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferEscapeString",
          "args": [
            "buf",
            "\"value='%s'/>\\n\"",
            "def->values[i]"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferEscapeString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "343-418",
          "snippet": "void\nvirBufferEscapeString(virBufferPtr buf, const char *format, const char *str)\n{\n    int len;\n    g_autofree char *escaped = NULL;\n    char *out;\n    const char *cur;\n    const char forbidden_characters[] = {\n        0x01,   0x02,   0x03,   0x04,   0x05,   0x06,   0x07,   0x08,\n        /*\\t*/  /*\\n*/  0x0B,   0x0C,   /*\\r*/  0x0E,   0x0F,   0x10,\n        0x11,   0x12,   0x13,   0x14,   0x15,   0x16,   0x17,   0x18,\n        0x19,   '\"',    '&',    '\\'',   '<',    '>',\n        '\\0'\n    };\n\n    if ((format == NULL) || (buf == NULL) || (str == NULL))\n        return;\n\n    len = strlen(str);\n    if (strcspn(str, forbidden_characters) == len) {\n        virBufferAsprintf(buf, format, str);\n        return;\n    }\n\n    escaped = g_malloc0_n(len + 1, 6);\n\n    cur = str;\n    out = escaped;\n    while (*cur != 0) {\n        if (*cur == '<') {\n            *out++ = '&';\n            *out++ = 'l';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '>') {\n            *out++ = '&';\n            *out++ = 'g';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '&') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'm';\n            *out++ = 'p';\n            *out++ = ';';\n        } else if (*cur == '\"') {\n            *out++ = '&';\n            *out++ = 'q';\n            *out++ = 'u';\n            *out++ = 'o';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '\\'') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'p';\n            *out++ = 'o';\n            *out++ = 's';\n            *out++ = ';';\n        } else if (!strchr(forbidden_characters, *cur)) {\n            /*\n             * default case, just copy !\n             * Note that character over 0x80 are likely to give problem\n             * with UTF-8 XML, but since our string don't have an encoding\n             * it's hard to handle properly we have to assume it's UTF-8 too\n             */\n            *out++ = *cur;\n        } else {\n            /* silently ignore control characters */\n        }\n        cur++;\n    }\n    *out = 0;\n\n    virBufferAsprintf(buf, format, escaped);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferEscapeString(virBufferPtr buf, const char *format, const char *str)\n{\n    int len;\n    g_autofree char *escaped = NULL;\n    char *out;\n    const char *cur;\n    const char forbidden_characters[] = {\n        0x01,   0x02,   0x03,   0x04,   0x05,   0x06,   0x07,   0x08,\n        /*\\t*/  /*\\n*/  0x0B,   0x0C,   /*\\r*/  0x0E,   0x0F,   0x10,\n        0x11,   0x12,   0x13,   0x14,   0x15,   0x16,   0x17,   0x18,\n        0x19,   '\"',    '&',    '\\'',   '<',    '>',\n        '\\0'\n    };\n\n    if ((format == NULL) || (buf == NULL) || (str == NULL))\n        return;\n\n    len = strlen(str);\n    if (strcspn(str, forbidden_characters) == len) {\n        virBufferAsprintf(buf, format, str);\n        return;\n    }\n\n    escaped = g_malloc0_n(len + 1, 6);\n\n    cur = str;\n    out = escaped;\n    while (*cur != 0) {\n        if (*cur == '<') {\n            *out++ = '&';\n            *out++ = 'l';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '>') {\n            *out++ = '&';\n            *out++ = 'g';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '&') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'm';\n            *out++ = 'p';\n            *out++ = ';';\n        } else if (*cur == '\"') {\n            *out++ = '&';\n            *out++ = 'q';\n            *out++ = 'u';\n            *out++ = 'o';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '\\'') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'p';\n            *out++ = 'o';\n            *out++ = 's';\n            *out++ = ';';\n        } else if (!strchr(forbidden_characters, *cur)) {\n            /*\n             * default case, just copy !\n             * Note that character over 0x80 are likely to give problem\n             * with UTF-8 XML, but since our string don't have an encoding\n             * it's hard to handle properly we have to assume it's UTF-8 too\n             */\n            *out++ = *cur;\n        } else {\n            /* silently ignore control characters */\n        }\n        cur++;\n    }\n    *out = 0;\n\n    virBufferAsprintf(buf, format, escaped);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "buf",
            "\"<rbd:config_opts>\\n\""
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStoragePoolDefRBDNamespaceFormatXML(virBufferPtr buf,\n                                       void *nsdata)\n{\n    size_t i;\n    virStoragePoolRBDConfigOptionsDefPtr def = nsdata;\n\n    if (!def)\n        return 0;\n\n    virBufferAddLit(buf, \"<rbd:config_opts>\\n\");\n    virBufferAdjustIndent(buf, 2);\n\n    for (i = 0; i < def->noptions; i++) {\n        virBufferEscapeString(buf, \"<rbd:option name='%s' \", def->names[i]);\n        virBufferEscapeString(buf, \"value='%s'/>\\n\", def->values[i]);\n    }\n\n    virBufferAdjustIndent(buf, -2);\n    virBufferAddLit(buf, \"</rbd:config_opts>\\n\");\n\n    return 0;\n}"
  },
  {
    "function_name": "virStoragePoolDefRBDNamespaceParse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "80-138",
    "snippet": "static int\nvirStoragePoolDefRBDNamespaceParse(xmlXPathContextPtr ctxt,\n                                   void **data)\n{\n    virStoragePoolRBDConfigOptionsDefPtr cmdopts = NULL;\n    int nnodes;\n    size_t i;\n    int ret = -1;\n    g_autofree xmlNodePtr *nodes = NULL;\n\n    nnodes = virXPathNodeSet(\"./rbd:config_opts/rbd:option\", ctxt, &nodes);\n    if (nnodes < 0)\n        return -1;\n\n    if (nnodes == 0)\n        return 0;\n\n    if (VIR_ALLOC(cmdopts) < 0)\n        goto cleanup;\n\n    if (VIR_ALLOC_N(cmdopts->names, nnodes) < 0 ||\n        VIR_ALLOC_N(cmdopts->values, nnodes) < 0)\n        goto cleanup;\n\n    for (i = 0; i < nnodes; i++) {\n        if (!(cmdopts->names[cmdopts->noptions] =\n              virXMLPropString(nodes[i], \"name\"))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"no rbd option name specified\"));\n            goto cleanup;\n        }\n        if (*cmdopts->names[cmdopts->noptions] == '\\0') {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"empty rbd option name specified\"));\n            goto cleanup;\n        }\n        if (!(cmdopts->values[cmdopts->noptions] =\n              virXMLPropString(nodes[i], \"value\"))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"no rbd option value specified for name '%s'\"),\n                           cmdopts->names[cmdopts->noptions]);\n            goto cleanup;\n        }\n        if (*cmdopts->values[cmdopts->noptions] == '\\0') {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"empty rbd option value specified for name '%s'\"),\n                           cmdopts->names[cmdopts->noptions]);\n            goto cleanup;\n        }\n        cmdopts->noptions++;\n    }\n\n    *data = g_steal_pointer(&cmdopts);\n    ret = 0;\n\n cleanup:\n    virStoragePoolDefRBDNamespaceFree(cmdopts);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStoragePoolDefRBDNamespaceFree",
          "args": [
            "cmdopts"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolDefRBDNamespaceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
          "lines": "60-77",
          "snippet": "static void\nvirStoragePoolDefRBDNamespaceFree(void *nsdata)\n{\n    virStoragePoolRBDConfigOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++) {\n        VIR_FREE(cmdopts->names[i]);\n        VIR_FREE(cmdopts->values[i]);\n    }\n    VIR_FREE(cmdopts->names);\n    VIR_FREE(cmdopts->values);\n\n    VIR_FREE(cmdopts);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virsecret.h\"",
            "#include \"rbd/librbd.h\"",
            "#include \"rados/librados.h\"",
            "#include \"virrandom.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_rbd.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <inttypes.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolDefRBDNamespaceFree(void *nsdata)\n{\n    virStoragePoolRBDConfigOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++) {\n        VIR_FREE(cmdopts->names[i]);\n        VIR_FREE(cmdopts->values[i]);\n    }\n    VIR_FREE(cmdopts->names);\n    VIR_FREE(cmdopts->values);\n\n    VIR_FREE(cmdopts);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&cmdopts"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "_(\"empty rbd option value specified for name '%s'\")",
            "cmdopts->names[cmdopts->noptions]"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"empty rbd option value specified for name '%s'\""
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "_(\"no rbd option value specified for name '%s'\")",
            "cmdopts->names[cmdopts->noptions]"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virXMLPropString",
          "args": [
            "nodes[i]",
            "\"value\""
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "virXMLPropString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "515-520",
          "snippet": "char *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "\"%s\"",
            "_(\"empty rbd option name specified\")"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "\"%s\"",
            "_(\"no rbd option name specified\")"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "cmdopts->values",
            "nnodes"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "cmdopts->names",
            "nnodes"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "cmdopts"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virXPathNodeSet",
          "args": [
            "\"./rbd:config_opts/rbd:option\"",
            "ctxt",
            "&nodes"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathNodeSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "647-694",
          "snippet": "int\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic int\nvirStoragePoolDefRBDNamespaceParse(xmlXPathContextPtr ctxt,\n                                   void **data)\n{\n    virStoragePoolRBDConfigOptionsDefPtr cmdopts = NULL;\n    int nnodes;\n    size_t i;\n    int ret = -1;\n    g_autofree xmlNodePtr *nodes = NULL;\n\n    nnodes = virXPathNodeSet(\"./rbd:config_opts/rbd:option\", ctxt, &nodes);\n    if (nnodes < 0)\n        return -1;\n\n    if (nnodes == 0)\n        return 0;\n\n    if (VIR_ALLOC(cmdopts) < 0)\n        goto cleanup;\n\n    if (VIR_ALLOC_N(cmdopts->names, nnodes) < 0 ||\n        VIR_ALLOC_N(cmdopts->values, nnodes) < 0)\n        goto cleanup;\n\n    for (i = 0; i < nnodes; i++) {\n        if (!(cmdopts->names[cmdopts->noptions] =\n              virXMLPropString(nodes[i], \"name\"))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"no rbd option name specified\"));\n            goto cleanup;\n        }\n        if (*cmdopts->names[cmdopts->noptions] == '\\0') {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"empty rbd option name specified\"));\n            goto cleanup;\n        }\n        if (!(cmdopts->values[cmdopts->noptions] =\n              virXMLPropString(nodes[i], \"value\"))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"no rbd option value specified for name '%s'\"),\n                           cmdopts->names[cmdopts->noptions]);\n            goto cleanup;\n        }\n        if (*cmdopts->values[cmdopts->noptions] == '\\0') {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"empty rbd option value specified for name '%s'\"),\n                           cmdopts->names[cmdopts->noptions]);\n            goto cleanup;\n        }\n        cmdopts->noptions++;\n    }\n\n    *data = g_steal_pointer(&cmdopts);\n    ret = 0;\n\n cleanup:\n    virStoragePoolDefRBDNamespaceFree(cmdopts);\n    return ret;\n}"
  },
  {
    "function_name": "virStoragePoolDefRBDNamespaceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_rbd.c",
    "lines": "60-77",
    "snippet": "static void\nvirStoragePoolDefRBDNamespaceFree(void *nsdata)\n{\n    virStoragePoolRBDConfigOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++) {\n        VIR_FREE(cmdopts->names[i]);\n        VIR_FREE(cmdopts->values[i]);\n    }\n    VIR_FREE(cmdopts->names);\n    VIR_FREE(cmdopts->values);\n\n    VIR_FREE(cmdopts);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virsecret.h\"",
      "#include \"rbd/librbd.h\"",
      "#include \"rados/librados.h\"",
      "#include \"virrandom.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_rbd.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include <inttypes.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts->values"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts->names"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts->values[i]"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts->names[i]"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virsecret.h\"\n#include \"rbd/librbd.h\"\n#include \"rados/librados.h\"\n#include \"virrandom.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_rbd.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <inttypes.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolDefRBDNamespaceFree(void *nsdata)\n{\n    virStoragePoolRBDConfigOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++) {\n        VIR_FREE(cmdopts->names[i]);\n        VIR_FREE(cmdopts->values[i]);\n    }\n    VIR_FREE(cmdopts->names);\n    VIR_FREE(cmdopts->values);\n\n    VIR_FREE(cmdopts);\n}"
  }
]