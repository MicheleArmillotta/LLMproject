[
  {
    "function_name": "virNetDevTapInterfaceStats",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "906-914",
    "snippet": "int\nvirNetDevTapInterfaceStats(const char *ifname G_GNUC_UNUSED,\n                           virDomainInterfaceStatsPtr stats G_GNUC_UNUSED,\n                           bool swapped G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                   _(\"interface stats not implemented on this platform\"));\n    return -1;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "\"%s\"",
            "_(\"interface stats not implemented on this platform\")"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"interface stats not implemented on this platform\""
          ],
          "line": 912
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapInterfaceStats(const char *ifname G_GNUC_UNUSED,\n                           virDomainInterfaceStatsPtr stats G_GNUC_UNUSED,\n                           bool swapped G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                   _(\"interface stats not implemented on this platform\"));\n    return -1;\n}"
  },
  {
    "function_name": "virNetDevTapInterfaceStats",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "835-904",
    "snippet": "int\nvirNetDevTapInterfaceStats(const char *ifname,\n                           virDomainInterfaceStatsPtr stats,\n                           bool swapped)\n{\n    struct ifaddrs *ifap, *ifa;\n    struct if_data *ifd;\n    int ret = -1;\n\n    if (!ifname) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Interface name not provided\"));\n        return -1;\n    }\n\n    if (getifaddrs(&ifap) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Could not get interface list\"));\n        return -1;\n    }\n\n    for (ifa = ifap; ifa; ifa = ifa->ifa_next) {\n        if (!ifa->ifa_addr)\n            continue;\n\n        if (ifa->ifa_addr->sa_family != AF_LINK)\n            continue;\n\n        if (STREQ(ifa->ifa_name, ifname)) {\n            ifd = (struct if_data *)ifa->ifa_data;\n            if (swapped) {\n                stats->tx_bytes = ifd->ifi_ibytes;\n                stats->tx_packets = ifd->ifi_ipackets;\n                stats->tx_errs = ifd->ifi_ierrors;\n                stats->tx_drop = ifd->ifi_iqdrops;\n                stats->rx_bytes = ifd->ifi_obytes;\n                stats->rx_packets = ifd->ifi_opackets;\n                stats->rx_errs = ifd->ifi_oerrors;\n# ifdef HAVE_STRUCT_IF_DATA_IFI_OQDROPS\n                stats->rx_drop = ifd->ifi_oqdrops;\n# else\n                stats->rx_drop = 0;\n# endif\n            } else {\n                stats->tx_bytes = ifd->ifi_obytes;\n                stats->tx_packets = ifd->ifi_opackets;\n                stats->tx_errs = ifd->ifi_oerrors;\n# ifdef HAVE_STRUCT_IF_DATA_IFI_OQDROPS\n                stats->tx_drop = ifd->ifi_oqdrops;\n# else\n                stats->tx_drop = 0;\n# endif\n                stats->rx_bytes = ifd->ifi_ibytes;\n                stats->rx_packets = ifd->ifi_ipackets;\n                stats->rx_errs = ifd->ifi_ierrors;\n                stats->rx_drop = ifd->ifi_iqdrops;\n            }\n\n            ret = 0;\n            break;\n        }\n    }\n\n    if (ret < 0)\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Interface not found\"));\n\n    freeifaddrs(ifap);\n    return ret;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "freeifaddrs",
          "args": [
            "ifap"
          ],
          "line": 902
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Interface not found\")"
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Interface not found\""
          ],
          "line": 900
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "ifa->ifa_name",
            "ifname"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Could not get interface list\")"
          ],
          "line": 851
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getifaddrs",
          "args": [
            "&ifap"
          ],
          "line": 850
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Interface name not provided\")"
          ],
          "line": 845
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapInterfaceStats(const char *ifname,\n                           virDomainInterfaceStatsPtr stats,\n                           bool swapped)\n{\n    struct ifaddrs *ifap, *ifa;\n    struct if_data *ifd;\n    int ret = -1;\n\n    if (!ifname) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Interface name not provided\"));\n        return -1;\n    }\n\n    if (getifaddrs(&ifap) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Could not get interface list\"));\n        return -1;\n    }\n\n    for (ifa = ifap; ifa; ifa = ifa->ifa_next) {\n        if (!ifa->ifa_addr)\n            continue;\n\n        if (ifa->ifa_addr->sa_family != AF_LINK)\n            continue;\n\n        if (STREQ(ifa->ifa_name, ifname)) {\n            ifd = (struct if_data *)ifa->ifa_data;\n            if (swapped) {\n                stats->tx_bytes = ifd->ifi_ibytes;\n                stats->tx_packets = ifd->ifi_ipackets;\n                stats->tx_errs = ifd->ifi_ierrors;\n                stats->tx_drop = ifd->ifi_iqdrops;\n                stats->rx_bytes = ifd->ifi_obytes;\n                stats->rx_packets = ifd->ifi_opackets;\n                stats->rx_errs = ifd->ifi_oerrors;\n# ifdef HAVE_STRUCT_IF_DATA_IFI_OQDROPS\n                stats->rx_drop = ifd->ifi_oqdrops;\n# else\n                stats->rx_drop = 0;\n# endif\n            } else {\n                stats->tx_bytes = ifd->ifi_obytes;\n                stats->tx_packets = ifd->ifi_opackets;\n                stats->tx_errs = ifd->ifi_oerrors;\n# ifdef HAVE_STRUCT_IF_DATA_IFI_OQDROPS\n                stats->tx_drop = ifd->ifi_oqdrops;\n# else\n                stats->tx_drop = 0;\n# endif\n                stats->rx_bytes = ifd->ifi_ibytes;\n                stats->rx_packets = ifd->ifi_ipackets;\n                stats->rx_errs = ifd->ifi_ierrors;\n                stats->rx_drop = ifd->ifi_iqdrops;\n            }\n\n            ret = 0;\n            break;\n        }\n    }\n\n    if (ret < 0)\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Interface not found\"));\n\n    freeifaddrs(ifap);\n    return ret;\n}"
  },
  {
    "function_name": "virNetDevTapInterfaceStats",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "752-833",
    "snippet": "int\nvirNetDevTapInterfaceStats(const char *ifname,\n                           virDomainInterfaceStatsPtr stats,\n                           bool swapped)\n{\n    int ifname_len;\n    FILE *fp;\n    char line[256], *colon;\n\n    if (!ifname) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Interface name not provided\"));\n        return -1;\n    }\n\n    fp = fopen(\"/proc/net/dev\", \"r\");\n    if (!fp) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Could not open /proc/net/dev\"));\n        return -1;\n    }\n\n    ifname_len = strlen(ifname);\n\n    while (fgets(line, sizeof(line), fp)) {\n        long long dummy;\n        long long rx_bytes;\n        long long rx_packets;\n        long long rx_errs;\n        long long rx_drop;\n        long long tx_bytes;\n        long long tx_packets;\n        long long tx_errs;\n        long long tx_drop;\n\n        /* The line looks like:\n         *   \"   eth0:...\"\n         * Split it at the colon.\n         */\n        colon = strchr(line, ':');\n        if (!colon) continue;\n        *colon = '\\0';\n        if (colon-ifname_len >= line &&\n            STREQ(colon-ifname_len, ifname)) {\n            if (sscanf(colon+1,\n                       \"%lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld\",\n                       &rx_bytes, &rx_packets, &rx_errs, &rx_drop,\n                       &dummy, &dummy, &dummy, &dummy,\n                       &tx_bytes, &tx_packets, &tx_errs, &tx_drop,\n                       &dummy, &dummy, &dummy, &dummy) != 16)\n                continue;\n\n            if (swapped) {\n                stats->rx_bytes = tx_bytes;\n                stats->rx_packets = tx_packets;\n                stats->rx_errs = tx_errs;\n                stats->rx_drop = tx_drop;\n                stats->tx_bytes = rx_bytes;\n                stats->tx_packets = rx_packets;\n                stats->tx_errs = rx_errs;\n                stats->tx_drop = rx_drop;\n            } else {\n                stats->rx_bytes = rx_bytes;\n                stats->rx_packets = rx_packets;\n                stats->rx_errs = rx_errs;\n                stats->rx_drop = rx_drop;\n                stats->tx_bytes = tx_bytes;\n                stats->tx_packets = tx_packets;\n                stats->tx_errs = tx_errs;\n                stats->tx_drop = tx_drop;\n            }\n\n            VIR_FORCE_FCLOSE(fp);\n            return 0;\n        }\n    }\n    VIR_FORCE_FCLOSE(fp);\n\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"/proc/net/dev: Interface not found\"));\n    return -1;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"/proc/net/dev: Interface not found\")"
          ],
          "line": 830
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"/proc/net/dev: Interface not found\""
          ],
          "line": 831
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "fp"
          ],
          "line": 828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "fp"
          ],
          "line": 824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "colon+1",
            "\"%lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld\"",
            "&rx_bytes",
            "&rx_packets",
            "&rx_errs",
            "&rx_drop",
            "&dummy",
            "&dummy",
            "&dummy",
            "&dummy",
            "&tx_bytes",
            "&tx_packets",
            "&tx_errs",
            "&tx_drop",
            "&dummy",
            "&dummy",
            "&dummy",
            "&dummy"
          ],
          "line": 796
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "colon-ifname_len",
            "ifname"
          ],
          "line": 795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "line",
            "':'"
          ],
          "line": 791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "line",
            "sizeof(line)",
            "fp"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ifname"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Could not open /proc/net/dev\")"
          ],
          "line": 769
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/proc/net/dev\"",
            "\"r\""
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Interface name not provided\")"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapInterfaceStats(const char *ifname,\n                           virDomainInterfaceStatsPtr stats,\n                           bool swapped)\n{\n    int ifname_len;\n    FILE *fp;\n    char line[256], *colon;\n\n    if (!ifname) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Interface name not provided\"));\n        return -1;\n    }\n\n    fp = fopen(\"/proc/net/dev\", \"r\");\n    if (!fp) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Could not open /proc/net/dev\"));\n        return -1;\n    }\n\n    ifname_len = strlen(ifname);\n\n    while (fgets(line, sizeof(line), fp)) {\n        long long dummy;\n        long long rx_bytes;\n        long long rx_packets;\n        long long rx_errs;\n        long long rx_drop;\n        long long tx_bytes;\n        long long tx_packets;\n        long long tx_errs;\n        long long tx_drop;\n\n        /* The line looks like:\n         *   \"   eth0:...\"\n         * Split it at the colon.\n         */\n        colon = strchr(line, ':');\n        if (!colon) continue;\n        *colon = '\\0';\n        if (colon-ifname_len >= line &&\n            STREQ(colon-ifname_len, ifname)) {\n            if (sscanf(colon+1,\n                       \"%lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld %lld\",\n                       &rx_bytes, &rx_packets, &rx_errs, &rx_drop,\n                       &dummy, &dummy, &dummy, &dummy,\n                       &tx_bytes, &tx_packets, &tx_errs, &tx_drop,\n                       &dummy, &dummy, &dummy, &dummy) != 16)\n                continue;\n\n            if (swapped) {\n                stats->rx_bytes = tx_bytes;\n                stats->rx_packets = tx_packets;\n                stats->rx_errs = tx_errs;\n                stats->rx_drop = tx_drop;\n                stats->tx_bytes = rx_bytes;\n                stats->tx_packets = rx_packets;\n                stats->tx_errs = rx_errs;\n                stats->tx_drop = rx_drop;\n            } else {\n                stats->rx_bytes = rx_bytes;\n                stats->rx_packets = rx_packets;\n                stats->rx_errs = rx_errs;\n                stats->rx_drop = rx_drop;\n                stats->tx_bytes = tx_bytes;\n                stats->tx_packets = tx_packets;\n                stats->tx_errs = tx_errs;\n                stats->tx_drop = tx_drop;\n            }\n\n            VIR_FORCE_FCLOSE(fp);\n            return 0;\n        }\n    }\n    VIR_FORCE_FCLOSE(fp);\n\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"/proc/net/dev: Interface not found\"));\n    return -1;\n}"
  },
  {
    "function_name": "virNetDevTapCreateInBridgePort",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "667-732",
    "snippet": "int virNetDevTapCreateInBridgePort(const char *brname,\n                                   char **ifname,\n                                   const virMacAddr *macaddr,\n                                   const unsigned char *vmuuid,\n                                   const char *tunpath,\n                                   int *tapfd,\n                                   size_t tapfdSize,\n                                   const virNetDevVPortProfile *virtPortProfile,\n                                   const virNetDevVlan *virtVlan,\n                                   virTristateBool isolatedPort,\n                                   virNetDevCoalescePtr coalesce,\n                                   unsigned int mtu,\n                                   unsigned int *actualMTU,\n                                   unsigned int flags)\n{\n    virMacAddr tapmac;\n    size_t i;\n\n    if (virNetDevTapCreate(ifname, tunpath, tapfd, tapfdSize, flags) < 0)\n        return -1;\n\n    /* We need to set the interface MAC before adding it\n     * to the bridge, because the bridge assumes the lowest\n     * MAC of all enslaved interfaces & we don't want it\n     * seeing the kernel allocate random MAC for the TAP\n     * device before we set our static MAC.\n     */\n    virMacAddrSet(&tapmac, macaddr);\n    if (!(flags & VIR_NETDEV_TAP_CREATE_USE_MAC_FOR_BRIDGE)) {\n        /* The tap device's MAC address cannot match the MAC address\n         * used by the guest. This results in \"received packet on\n         * vnetX with own address as source address\" error logs from\n         * the kernel. Making the tap address as high as possible\n         * discourages the bridge from using this tap's MAC as its own\n         * (a Linux host bridge will take on the lowest numbered MAC\n         * of all devices attached to it).\n         */\n        if (tapmac.addr[0] == 0xFE)\n            tapmac.addr[0] = 0xFA;\n        else\n            tapmac.addr[0] = 0xFE;\n    }\n\n    if (virNetDevSetMAC(*ifname, &tapmac) < 0)\n        goto error;\n\n    if (virNetDevTapAttachBridge(*ifname, brname, macaddr, vmuuid,\n                                 virtPortProfile, virtVlan,\n                                 isolatedPort, mtu, actualMTU) < 0) {\n        goto error;\n    }\n\n    if (virNetDevSetOnline(*ifname, !!(flags & VIR_NETDEV_TAP_CREATE_IFUP)) < 0)\n        goto error;\n\n    if (virNetDevSetCoalesce(*ifname, coalesce, false) < 0)\n        goto error;\n\n    return 0;\n\n error:\n    for (i = 0; i < tapfdSize && tapfd[i] >= 0; i++)\n        VIR_FORCE_CLOSE(tapfd[i]);\n\n    return -1;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "tapfd[i]"
          ],
          "line": 729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevSetCoalesce",
          "args": [
            "*ifname",
            "coalesce",
            "false"
          ],
          "line": 722
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetCoalesce",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "3425-3436",
          "snippet": "int virNetDevSetCoalesce(const char *ifname,\n                         virNetDevCoalescePtr coalesce,\n                         bool update)\n{\n    if (!coalesce && !update)\n        return 0;\n\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot set coalesce info on interface '%s'\"),\n                         ifname);\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevSetCoalesce(const char *ifname,\n                         virNetDevCoalescePtr coalesce,\n                         bool update)\n{\n    if (!coalesce && !update)\n        return 0;\n\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot set coalesce info on interface '%s'\"),\n                         ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevSetOnline",
          "args": [
            "*ifname",
            "!!(flags & VIR_NETDEV_TAP_CREATE_IFUP)"
          ],
          "line": 719
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetOnline",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "660-665",
          "snippet": "int\nvirNetDevSetOnline(const char *ifname,\n                   bool online)\n{\n    return virNetDevSetIFFlag(ifname, VIR_IFF_UP, online);\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint\nvirNetDevSetOnline(const char *ifname,\n                   bool online)\n{\n    return virNetDevSetIFFlag(ifname, VIR_IFF_UP, online);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevTapAttachBridge",
          "args": [
            "*ifname",
            "brname",
            "macaddr",
            "vmuuid",
            "virtPortProfile",
            "virtVlan",
            "isolatedPort",
            "mtu",
            "actualMTU"
          ],
          "line": 713
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevTapAttachBridge",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
          "lines": "501-562",
          "snippet": "int\nvirNetDevTapAttachBridge(const char *tapname,\n                         const char *brname,\n                         const virMacAddr *macaddr,\n                         const unsigned char *vmuuid,\n                         const virNetDevVPortProfile *virtPortProfile,\n                         const virNetDevVlan *virtVlan,\n                         virTristateBool isolatedPort,\n                         unsigned int mtu,\n                         unsigned int *actualMTU)\n{\n    /* If an MTU is specified for the new device, set it before\n     * attaching the device to the bridge, as it may affect the MTU of\n     * the bridge (in particular if it is the first device attached to\n     * the bridge, or if it is smaller than the current MTU of the\n     * bridge). If MTU isn't specified for the new device (i.e. 0),\n     * we need to set the interface MTU to the current MTU of the\n     * bridge (to avoid inadvertantly changing the bridge's MTU).\n     */\n    if (mtu > 0) {\n        if (virNetDevSetMTU(tapname, mtu) < 0)\n            return -1;\n    } else {\n        if (virNetDevSetMTUFromDevice(tapname, brname) < 0)\n            return -1;\n    }\n    if (actualMTU) {\n        int retMTU = virNetDevGetMTU(tapname);\n\n        if (retMTU < 0)\n            return -1;\n\n        *actualMTU = retMTU;\n    }\n\n\n    if (virtPortProfile) {\n        if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_MIDONET) {\n            if (virNetDevMidonetBindPort(tapname, virtPortProfile) < 0)\n                return -1;\n        } else if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_OPENVSWITCH) {\n            if (virNetDevOpenvswitchAddPort(brname, tapname, macaddr, vmuuid,\n                                            virtPortProfile, virtVlan) < 0)\n                return -1;\n        }\n    } else {\n        if (virNetDevBridgeAddPort(brname, tapname) < 0)\n            return -1;\n\n        if (isolatedPort == VIR_TRISTATE_BOOL_YES &&\n            virNetDevBridgePortSetIsolated(brname, tapname, true) < 0) {\n            virErrorPtr err;\n\n            virErrorPreserveLast(&err);\n            ignore_value(virNetDevBridgeRemovePort(brname, tapname));\n            virErrorRestore(&err);\n            return -1;\n        }\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <ifaddrs.h>",
            "# include <sys/sysctl.h>",
            "# include <net/if_mib.h>",
            "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
            "#include <fcntl.h>",
            "# include <net/if.h>",
            "# include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapAttachBridge(const char *tapname,\n                         const char *brname,\n                         const virMacAddr *macaddr,\n                         const unsigned char *vmuuid,\n                         const virNetDevVPortProfile *virtPortProfile,\n                         const virNetDevVlan *virtVlan,\n                         virTristateBool isolatedPort,\n                         unsigned int mtu,\n                         unsigned int *actualMTU)\n{\n    /* If an MTU is specified for the new device, set it before\n     * attaching the device to the bridge, as it may affect the MTU of\n     * the bridge (in particular if it is the first device attached to\n     * the bridge, or if it is smaller than the current MTU of the\n     * bridge). If MTU isn't specified for the new device (i.e. 0),\n     * we need to set the interface MTU to the current MTU of the\n     * bridge (to avoid inadvertantly changing the bridge's MTU).\n     */\n    if (mtu > 0) {\n        if (virNetDevSetMTU(tapname, mtu) < 0)\n            return -1;\n    } else {\n        if (virNetDevSetMTUFromDevice(tapname, brname) < 0)\n            return -1;\n    }\n    if (actualMTU) {\n        int retMTU = virNetDevGetMTU(tapname);\n\n        if (retMTU < 0)\n            return -1;\n\n        *actualMTU = retMTU;\n    }\n\n\n    if (virtPortProfile) {\n        if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_MIDONET) {\n            if (virNetDevMidonetBindPort(tapname, virtPortProfile) < 0)\n                return -1;\n        } else if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_OPENVSWITCH) {\n            if (virNetDevOpenvswitchAddPort(brname, tapname, macaddr, vmuuid,\n                                            virtPortProfile, virtVlan) < 0)\n                return -1;\n        }\n    } else {\n        if (virNetDevBridgeAddPort(brname, tapname) < 0)\n            return -1;\n\n        if (isolatedPort == VIR_TRISTATE_BOOL_YES &&\n            virNetDevBridgePortSetIsolated(brname, tapname, true) < 0) {\n            virErrorPtr err;\n\n            virErrorPreserveLast(&err);\n            ignore_value(virNetDevBridgeRemovePort(brname, tapname));\n            virErrorRestore(&err);\n            return -1;\n        }\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevSetMAC",
          "args": [
            "*ifname",
            "&tapmac"
          ],
          "line": 710
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetMAC",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "346-351",
          "snippet": "int\nvirNetDevSetMAC(const char *ifname,\n                const virMacAddr *macaddr)\n{\n    return virNetDevSetMACInternal(ifname, macaddr, false);\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint\nvirNetDevSetMAC(const char *ifname,\n                const virMacAddr *macaddr)\n{\n    return virNetDevSetMACInternal(ifname, macaddr, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMacAddrSet",
          "args": [
            "&tapmac",
            "macaddr"
          ],
          "line": 694
        },
        "resolved": true,
        "details": {
          "function_name": "virMacAddrSetRaw",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmacaddr.c",
          "lines": "113-117",
          "snippet": "void\nvirMacAddrSetRaw(virMacAddrPtr dst, const unsigned char src[VIR_MAC_BUFLEN])\n{\n    memcpy(dst->addr, src, VIR_MAC_BUFLEN);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virrandom.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virrandom.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nvoid\nvirMacAddrSetRaw(virMacAddrPtr dst, const unsigned char src[VIR_MAC_BUFLEN])\n{\n    memcpy(dst->addr, src, VIR_MAC_BUFLEN);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevTapCreate",
          "args": [
            "ifname",
            "tunpath",
            "tapfd",
            "tapfdSize",
            "flags"
          ],
          "line": 685
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevTapCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
          "lines": "466-475",
          "snippet": "int virNetDevTapCreate(char **ifname G_GNUC_UNUSED,\n                       const char *tunpath G_GNUC_UNUSED,\n                       int *tapfd G_GNUC_UNUSED,\n                       size_t tapfdSize G_GNUC_UNUSED,\n                       unsigned int flags G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to create TAP devices on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <ifaddrs.h>",
            "# include <sys/sysctl.h>",
            "# include <net/if_mib.h>",
            "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
            "#include <fcntl.h>",
            "# include <net/if.h>",
            "# include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapCreate(char **ifname G_GNUC_UNUSED,\n                       const char *tunpath G_GNUC_UNUSED,\n                       int *tapfd G_GNUC_UNUSED,\n                       size_t tapfdSize G_GNUC_UNUSED,\n                       unsigned int flags G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to create TAP devices on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapCreateInBridgePort(const char *brname,\n                                   char **ifname,\n                                   const virMacAddr *macaddr,\n                                   const unsigned char *vmuuid,\n                                   const char *tunpath,\n                                   int *tapfd,\n                                   size_t tapfdSize,\n                                   const virNetDevVPortProfile *virtPortProfile,\n                                   const virNetDevVlan *virtVlan,\n                                   virTristateBool isolatedPort,\n                                   virNetDevCoalescePtr coalesce,\n                                   unsigned int mtu,\n                                   unsigned int *actualMTU,\n                                   unsigned int flags)\n{\n    virMacAddr tapmac;\n    size_t i;\n\n    if (virNetDevTapCreate(ifname, tunpath, tapfd, tapfdSize, flags) < 0)\n        return -1;\n\n    /* We need to set the interface MAC before adding it\n     * to the bridge, because the bridge assumes the lowest\n     * MAC of all enslaved interfaces & we don't want it\n     * seeing the kernel allocate random MAC for the TAP\n     * device before we set our static MAC.\n     */\n    virMacAddrSet(&tapmac, macaddr);\n    if (!(flags & VIR_NETDEV_TAP_CREATE_USE_MAC_FOR_BRIDGE)) {\n        /* The tap device's MAC address cannot match the MAC address\n         * used by the guest. This results in \"received packet on\n         * vnetX with own address as source address\" error logs from\n         * the kernel. Making the tap address as high as possible\n         * discourages the bridge from using this tap's MAC as its own\n         * (a Linux host bridge will take on the lowest numbered MAC\n         * of all devices attached to it).\n         */\n        if (tapmac.addr[0] == 0xFE)\n            tapmac.addr[0] = 0xFA;\n        else\n            tapmac.addr[0] = 0xFE;\n    }\n\n    if (virNetDevSetMAC(*ifname, &tapmac) < 0)\n        goto error;\n\n    if (virNetDevTapAttachBridge(*ifname, brname, macaddr, vmuuid,\n                                 virtPortProfile, virtVlan,\n                                 isolatedPort, mtu, actualMTU) < 0) {\n        goto error;\n    }\n\n    if (virNetDevSetOnline(*ifname, !!(flags & VIR_NETDEV_TAP_CREATE_IFUP)) < 0)\n        goto error;\n\n    if (virNetDevSetCoalesce(*ifname, coalesce, false) < 0)\n        goto error;\n\n    return 0;\n\n error:\n    for (i = 0; i < tapfdSize && tapfd[i] >= 0; i++)\n        VIR_FORCE_CLOSE(tapfd[i]);\n\n    return -1;\n}"
  },
  {
    "function_name": "virNetDevTapReattachBridge",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "581-631",
    "snippet": "int\nvirNetDevTapReattachBridge(const char *tapname,\n                           const char *brname,\n                           const virMacAddr *macaddr,\n                           const unsigned char *vmuuid,\n                           const virNetDevVPortProfile *virtPortProfile,\n                           const virNetDevVlan *virtVlan,\n                           virTristateBool isolatedPort,\n                           unsigned int mtu,\n                           unsigned int *actualMTU)\n{\n    bool useOVS = false;\n    g_autofree char *master = NULL;\n\n    if (virNetDevGetMaster(tapname, &master) < 0)\n        return -1;\n\n    /* IFLA_MASTER for a tap on an OVS switch is always \"ovs-system\" */\n    if (STREQ_NULLABLE(master, \"ovs-system\")) {\n        useOVS = true;\n        if (virNetDevOpenvswitchInterfaceGetMaster(tapname, &master) < 0)\n            return -1;\n    }\n\n    /* Nothing more todo if we're on the right bridge already */\n    if (STREQ_NULLABLE(brname, master))\n        return 0;\n\n    /* disconnect from current (incorrect) bridge, if any  */\n    if (master) {\n        int ret;\n        VIR_INFO(\"Removing %s from %s\", tapname, master);\n        if (useOVS)\n            ret = virNetDevOpenvswitchRemovePort(master, tapname);\n        else\n            ret = virNetDevBridgeRemovePort(master, tapname);\n        if (ret < 0)\n            return -1;\n    }\n\n    VIR_INFO(\"Attaching %s to %s\", tapname, brname);\n    if (virNetDevTapAttachBridge(tapname, brname,\n                                 macaddr, vmuuid,\n                                 virtPortProfile,\n                                 virtVlan,\n                                 isolatedPort,\n                                 mtu, actualMTU) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDevTapAttachBridge",
          "args": [
            "tapname",
            "brname",
            "macaddr",
            "vmuuid",
            "virtPortProfile",
            "virtVlan",
            "isolatedPort",
            "mtu",
            "actualMTU"
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevTapAttachBridge",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
          "lines": "501-562",
          "snippet": "int\nvirNetDevTapAttachBridge(const char *tapname,\n                         const char *brname,\n                         const virMacAddr *macaddr,\n                         const unsigned char *vmuuid,\n                         const virNetDevVPortProfile *virtPortProfile,\n                         const virNetDevVlan *virtVlan,\n                         virTristateBool isolatedPort,\n                         unsigned int mtu,\n                         unsigned int *actualMTU)\n{\n    /* If an MTU is specified for the new device, set it before\n     * attaching the device to the bridge, as it may affect the MTU of\n     * the bridge (in particular if it is the first device attached to\n     * the bridge, or if it is smaller than the current MTU of the\n     * bridge). If MTU isn't specified for the new device (i.e. 0),\n     * we need to set the interface MTU to the current MTU of the\n     * bridge (to avoid inadvertantly changing the bridge's MTU).\n     */\n    if (mtu > 0) {\n        if (virNetDevSetMTU(tapname, mtu) < 0)\n            return -1;\n    } else {\n        if (virNetDevSetMTUFromDevice(tapname, brname) < 0)\n            return -1;\n    }\n    if (actualMTU) {\n        int retMTU = virNetDevGetMTU(tapname);\n\n        if (retMTU < 0)\n            return -1;\n\n        *actualMTU = retMTU;\n    }\n\n\n    if (virtPortProfile) {\n        if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_MIDONET) {\n            if (virNetDevMidonetBindPort(tapname, virtPortProfile) < 0)\n                return -1;\n        } else if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_OPENVSWITCH) {\n            if (virNetDevOpenvswitchAddPort(brname, tapname, macaddr, vmuuid,\n                                            virtPortProfile, virtVlan) < 0)\n                return -1;\n        }\n    } else {\n        if (virNetDevBridgeAddPort(brname, tapname) < 0)\n            return -1;\n\n        if (isolatedPort == VIR_TRISTATE_BOOL_YES &&\n            virNetDevBridgePortSetIsolated(brname, tapname, true) < 0) {\n            virErrorPtr err;\n\n            virErrorPreserveLast(&err);\n            ignore_value(virNetDevBridgeRemovePort(brname, tapname));\n            virErrorRestore(&err);\n            return -1;\n        }\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <ifaddrs.h>",
            "# include <sys/sysctl.h>",
            "# include <net/if_mib.h>",
            "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
            "#include <fcntl.h>",
            "# include <net/if.h>",
            "# include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapAttachBridge(const char *tapname,\n                         const char *brname,\n                         const virMacAddr *macaddr,\n                         const unsigned char *vmuuid,\n                         const virNetDevVPortProfile *virtPortProfile,\n                         const virNetDevVlan *virtVlan,\n                         virTristateBool isolatedPort,\n                         unsigned int mtu,\n                         unsigned int *actualMTU)\n{\n    /* If an MTU is specified for the new device, set it before\n     * attaching the device to the bridge, as it may affect the MTU of\n     * the bridge (in particular if it is the first device attached to\n     * the bridge, or if it is smaller than the current MTU of the\n     * bridge). If MTU isn't specified for the new device (i.e. 0),\n     * we need to set the interface MTU to the current MTU of the\n     * bridge (to avoid inadvertantly changing the bridge's MTU).\n     */\n    if (mtu > 0) {\n        if (virNetDevSetMTU(tapname, mtu) < 0)\n            return -1;\n    } else {\n        if (virNetDevSetMTUFromDevice(tapname, brname) < 0)\n            return -1;\n    }\n    if (actualMTU) {\n        int retMTU = virNetDevGetMTU(tapname);\n\n        if (retMTU < 0)\n            return -1;\n\n        *actualMTU = retMTU;\n    }\n\n\n    if (virtPortProfile) {\n        if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_MIDONET) {\n            if (virNetDevMidonetBindPort(tapname, virtPortProfile) < 0)\n                return -1;\n        } else if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_OPENVSWITCH) {\n            if (virNetDevOpenvswitchAddPort(brname, tapname, macaddr, vmuuid,\n                                            virtPortProfile, virtVlan) < 0)\n                return -1;\n        }\n    } else {\n        if (virNetDevBridgeAddPort(brname, tapname) < 0)\n            return -1;\n\n        if (isolatedPort == VIR_TRISTATE_BOOL_YES &&\n            virNetDevBridgePortSetIsolated(brname, tapname, true) < 0) {\n            virErrorPtr err;\n\n            virErrorPreserveLast(&err);\n            ignore_value(virNetDevBridgeRemovePort(brname, tapname));\n            virErrorRestore(&err);\n            return -1;\n        }\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Attaching %s to %s\"",
            "tapname",
            "brname"
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevBridgeRemovePort",
          "args": [
            "master",
            "tapname"
          ],
          "line": 616
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevBridgeRemovePort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevbridge.c",
          "lines": "727-733",
          "snippet": "int virNetDevBridgeRemovePort(const char *brname,\n                              const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to remove bridge %s port %s\"), brname, ifname);\n    return -1;\n}",
          "includes": [
            "# include <net/if_bridgevar.h>",
            "# include <net/ethernet.h>",
            "# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */",
            "# include <linux/in6.h>",
            "# include <linux/param.h>     /* HZ                 */",
            "# include <linux/sockios.h>",
            "#  include \"virnetlink.h\"",
            "# include <net/if.h>",
            "#include \"virsocket.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <net/if_bridgevar.h>\n# include <net/ethernet.h>\n# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */\n# include <linux/in6.h>\n# include <linux/param.h>     /* HZ                 */\n# include <linux/sockios.h>\n#  include \"virnetlink.h\"\n# include <net/if.h>\n#include \"virsocket.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevbridge.h\"\n#include <config.h>\n\nint virNetDevBridgeRemovePort(const char *brname,\n                              const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to remove bridge %s port %s\"), brname, ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevOpenvswitchRemovePort",
          "args": [
            "master",
            "tapname"
          ],
          "line": 614
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevOpenvswitchRemovePort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevopenvswitch.c",
          "lines": "205-220",
          "snippet": "int virNetDevOpenvswitchRemovePort(const char *brname G_GNUC_UNUSED, const char *ifname)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(OVSVSCTL);\n    virNetDevOpenvswitchAddTimeout(cmd);\n    virCommandAddArgList(cmd, \"--\", \"--if-exists\", \"del-port\", ifname, NULL);\n\n    if (virCommandRun(cmd, NULL) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to delete port %s from OVS\"), ifname);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virjson.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virjson.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virmacaddr.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virnetdevopenvswitch.h\"\n#include <config.h>\n\nint virNetDevOpenvswitchRemovePort(const char *brname G_GNUC_UNUSED, const char *ifname)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNew(OVSVSCTL);\n    virNetDevOpenvswitchAddTimeout(cmd);\n    virCommandAddArgList(cmd, \"--\", \"--if-exists\", \"del-port\", ifname, NULL);\n\n    if (virCommandRun(cmd, NULL) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to delete port %s from OVS\"), ifname);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Removing %s from %s\"",
            "tapname",
            "master"
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "brname",
            "master"
          ],
          "line": 606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevOpenvswitchInterfaceGetMaster",
          "args": [
            "tapname",
            "&master"
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevOpenvswitchInterfaceGetMaster",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevopenvswitch.c",
          "lines": "441-475",
          "snippet": "int\nvirNetDevOpenvswitchInterfaceGetMaster(const char *ifname, char **master)\n{\n    virCommandPtr cmd = NULL;\n    int exitstatus;\n\n    *master = NULL;\n\n    cmd = virCommandNew(OVSVSCTL);\n    virNetDevOpenvswitchAddTimeout(cmd);\n    virCommandAddArgList(cmd, \"iface-to-br\", ifname, NULL);\n    virCommandSetOutputBuffer(cmd, master);\n\n    if (virCommandRun(cmd, &exitstatus) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to run command to get OVS master for \"\n                         \"interface %s\"), ifname);\n        return -1;\n    }\n\n    /* non-0 exit code just means that the interface has no master in OVS */\n    if (exitstatus != 0)\n        VIR_FREE(*master);\n\n    if (*master) {\n        /* truncate at the first newline */\n        char *nl = strchr(*master, '\\n');\n        if (nl)\n            *nl = '\\0';\n    }\n\n    VIR_DEBUG(\"OVS master for %s is %s\", ifname, *master ? *master : \"(none)\");\n\n    return 0;\n}",
          "includes": [
            "#include \"virjson.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virjson.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virmacaddr.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virnetdevopenvswitch.h\"\n#include <config.h>\n\nint\nvirNetDevOpenvswitchInterfaceGetMaster(const char *ifname, char **master)\n{\n    virCommandPtr cmd = NULL;\n    int exitstatus;\n\n    *master = NULL;\n\n    cmd = virCommandNew(OVSVSCTL);\n    virNetDevOpenvswitchAddTimeout(cmd);\n    virCommandAddArgList(cmd, \"iface-to-br\", ifname, NULL);\n    virCommandSetOutputBuffer(cmd, master);\n\n    if (virCommandRun(cmd, &exitstatus) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to run command to get OVS master for \"\n                         \"interface %s\"), ifname);\n        return -1;\n    }\n\n    /* non-0 exit code just means that the interface has no master in OVS */\n    if (exitstatus != 0)\n        VIR_FREE(*master);\n\n    if (*master) {\n        /* truncate at the first newline */\n        char *nl = strchr(*master, '\\n');\n        if (nl)\n            *nl = '\\0';\n    }\n\n    VIR_DEBUG(\"OVS master for %s is %s\", ifname, *master ? *master : \"(none)\");\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "master",
            "\"ovs-system\""
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevGetMaster",
          "args": [
            "tapname",
            "&master"
          ],
          "line": 595
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevGetMaster",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "941-948",
          "snippet": "int\nvirNetDevGetMaster(const char *ifname G_GNUC_UNUSED,\n                   char **master G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"Unable to get device master from netlink on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint\nvirNetDevGetMaster(const char *ifname G_GNUC_UNUSED,\n                   char **master G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"Unable to get device master from netlink on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapReattachBridge(const char *tapname,\n                           const char *brname,\n                           const virMacAddr *macaddr,\n                           const unsigned char *vmuuid,\n                           const virNetDevVPortProfile *virtPortProfile,\n                           const virNetDevVlan *virtVlan,\n                           virTristateBool isolatedPort,\n                           unsigned int mtu,\n                           unsigned int *actualMTU)\n{\n    bool useOVS = false;\n    g_autofree char *master = NULL;\n\n    if (virNetDevGetMaster(tapname, &master) < 0)\n        return -1;\n\n    /* IFLA_MASTER for a tap on an OVS switch is always \"ovs-system\" */\n    if (STREQ_NULLABLE(master, \"ovs-system\")) {\n        useOVS = true;\n        if (virNetDevOpenvswitchInterfaceGetMaster(tapname, &master) < 0)\n            return -1;\n    }\n\n    /* Nothing more todo if we're on the right bridge already */\n    if (STREQ_NULLABLE(brname, master))\n        return 0;\n\n    /* disconnect from current (incorrect) bridge, if any  */\n    if (master) {\n        int ret;\n        VIR_INFO(\"Removing %s from %s\", tapname, master);\n        if (useOVS)\n            ret = virNetDevOpenvswitchRemovePort(master, tapname);\n        else\n            ret = virNetDevBridgeRemovePort(master, tapname);\n        if (ret < 0)\n            return -1;\n    }\n\n    VIR_INFO(\"Attaching %s to %s\", tapname, brname);\n    if (virNetDevTapAttachBridge(tapname, brname,\n                                 macaddr, vmuuid,\n                                 virtPortProfile,\n                                 virtVlan,\n                                 isolatedPort,\n                                 mtu, actualMTU) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virNetDevTapAttachBridge",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "501-562",
    "snippet": "int\nvirNetDevTapAttachBridge(const char *tapname,\n                         const char *brname,\n                         const virMacAddr *macaddr,\n                         const unsigned char *vmuuid,\n                         const virNetDevVPortProfile *virtPortProfile,\n                         const virNetDevVlan *virtVlan,\n                         virTristateBool isolatedPort,\n                         unsigned int mtu,\n                         unsigned int *actualMTU)\n{\n    /* If an MTU is specified for the new device, set it before\n     * attaching the device to the bridge, as it may affect the MTU of\n     * the bridge (in particular if it is the first device attached to\n     * the bridge, or if it is smaller than the current MTU of the\n     * bridge). If MTU isn't specified for the new device (i.e. 0),\n     * we need to set the interface MTU to the current MTU of the\n     * bridge (to avoid inadvertantly changing the bridge's MTU).\n     */\n    if (mtu > 0) {\n        if (virNetDevSetMTU(tapname, mtu) < 0)\n            return -1;\n    } else {\n        if (virNetDevSetMTUFromDevice(tapname, brname) < 0)\n            return -1;\n    }\n    if (actualMTU) {\n        int retMTU = virNetDevGetMTU(tapname);\n\n        if (retMTU < 0)\n            return -1;\n\n        *actualMTU = retMTU;\n    }\n\n\n    if (virtPortProfile) {\n        if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_MIDONET) {\n            if (virNetDevMidonetBindPort(tapname, virtPortProfile) < 0)\n                return -1;\n        } else if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_OPENVSWITCH) {\n            if (virNetDevOpenvswitchAddPort(brname, tapname, macaddr, vmuuid,\n                                            virtPortProfile, virtVlan) < 0)\n                return -1;\n        }\n    } else {\n        if (virNetDevBridgeAddPort(brname, tapname) < 0)\n            return -1;\n\n        if (isolatedPort == VIR_TRISTATE_BOOL_YES &&\n            virNetDevBridgePortSetIsolated(brname, tapname, true) < 0) {\n            virErrorPtr err;\n\n            virErrorPreserveLast(&err);\n            ignore_value(virNetDevBridgeRemovePort(brname, tapname));\n            virErrorRestore(&err);\n            return -1;\n        }\n    }\n\n    return 0;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virErrorRestore",
          "args": [
            "&err"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "445-457",
          "snippet": "void\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virNetDevBridgeRemovePort(brname, tapname)"
          ],
          "line": 555
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevBridgeRemovePort",
          "args": [
            "brname",
            "tapname"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevBridgeRemovePort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevbridge.c",
          "lines": "727-733",
          "snippet": "int virNetDevBridgeRemovePort(const char *brname,\n                              const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to remove bridge %s port %s\"), brname, ifname);\n    return -1;\n}",
          "includes": [
            "# include <net/if_bridgevar.h>",
            "# include <net/ethernet.h>",
            "# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */",
            "# include <linux/in6.h>",
            "# include <linux/param.h>     /* HZ                 */",
            "# include <linux/sockios.h>",
            "#  include \"virnetlink.h\"",
            "# include <net/if.h>",
            "#include \"virsocket.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <net/if_bridgevar.h>\n# include <net/ethernet.h>\n# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */\n# include <linux/in6.h>\n# include <linux/param.h>     /* HZ                 */\n# include <linux/sockios.h>\n#  include \"virnetlink.h\"\n# include <net/if.h>\n#include \"virsocket.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevbridge.h\"\n#include <config.h>\n\nint virNetDevBridgeRemovePort(const char *brname,\n                              const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to remove bridge %s port %s\"), brname, ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorPreserveLast",
          "args": [
            "&err"
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorPreserveLast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "424-436",
          "snippet": "void\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevBridgePortSetIsolated",
          "args": [
            "brname",
            "tapname",
            "true"
          ],
          "line": 551
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevBridgePortSetIsolated",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevbridge.c",
          "lines": "393-401",
          "snippet": "int\nvirNetDevBridgePortSetIsolated(const char *brname G_GNUC_UNUSED,\n                               const char *ifname G_GNUC_UNUSED,\n                               bool enable G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to set bridge port isolated on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <net/if_bridgevar.h>",
            "# include <net/ethernet.h>",
            "# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */",
            "# include <linux/in6.h>",
            "# include <linux/param.h>     /* HZ                 */",
            "# include <linux/sockios.h>",
            "#  include \"virnetlink.h\"",
            "# include <net/if.h>",
            "#include \"virsocket.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <net/if_bridgevar.h>\n# include <net/ethernet.h>\n# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */\n# include <linux/in6.h>\n# include <linux/param.h>     /* HZ                 */\n# include <linux/sockios.h>\n#  include \"virnetlink.h\"\n# include <net/if.h>\n#include \"virsocket.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevbridge.h\"\n#include <config.h>\n\nint\nvirNetDevBridgePortSetIsolated(const char *brname G_GNUC_UNUSED,\n                               const char *ifname G_GNUC_UNUSED,\n                               bool enable G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to set bridge port isolated on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevBridgeAddPort",
          "args": [
            "brname",
            "tapname"
          ],
          "line": 547
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevBridgeAddPort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevbridge.c",
          "lines": "661-667",
          "snippet": "int virNetDevBridgeAddPort(const char *brname,\n                           const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to add bridge %s port %s\"), brname, ifname);\n    return -1;\n}",
          "includes": [
            "# include <net/if_bridgevar.h>",
            "# include <net/ethernet.h>",
            "# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */",
            "# include <linux/in6.h>",
            "# include <linux/param.h>     /* HZ                 */",
            "# include <linux/sockios.h>",
            "#  include \"virnetlink.h\"",
            "# include <net/if.h>",
            "#include \"virsocket.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <net/if_bridgevar.h>\n# include <net/ethernet.h>\n# include <linux/if_bridge.h> /* SYSFS_BRIDGE_ATTR  */\n# include <linux/in6.h>\n# include <linux/param.h>     /* HZ                 */\n# include <linux/sockios.h>\n#  include \"virnetlink.h\"\n# include <net/if.h>\n#include \"virsocket.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevbridge.h\"\n#include <config.h>\n\nint virNetDevBridgeAddPort(const char *brname,\n                           const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to add bridge %s port %s\"), brname, ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevOpenvswitchAddPort",
          "args": [
            "brname",
            "tapname",
            "macaddr",
            "vmuuid",
            "virtPortProfile",
            "virtVlan"
          ],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevOpenvswitchAddPort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevopenvswitch.c",
          "lines": "132-195",
          "snippet": "int virNetDevOpenvswitchAddPort(const char *brname, const char *ifname,\n                                const virMacAddr *macaddr,\n                                const unsigned char *vmuuid,\n                                const virNetDevVPortProfile *ovsport,\n                                const virNetDevVlan *virtVlan)\n{\n    char macaddrstr[VIR_MAC_STRING_BUFLEN];\n    char ifuuidstr[VIR_UUID_STRING_BUFLEN];\n    char vmuuidstr[VIR_UUID_STRING_BUFLEN];\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *attachedmac_ex_id = NULL;\n    g_autofree char *ifaceid_ex_id = NULL;\n    g_autofree char *profile_ex_id = NULL;\n    g_autofree char *vmid_ex_id = NULL;\n\n    virMacAddrFormat(macaddr, macaddrstr);\n    virUUIDFormat(ovsport->interfaceID, ifuuidstr);\n    virUUIDFormat(vmuuid, vmuuidstr);\n\n    attachedmac_ex_id = g_strdup_printf(\"external-ids:attached-mac=\\\"%s\\\"\",\n                                        macaddrstr);\n    ifaceid_ex_id = g_strdup_printf(\"external-ids:iface-id=\\\"%s\\\"\", ifuuidstr);\n    vmid_ex_id = g_strdup_printf(\"external-ids:vm-id=\\\"%s\\\"\", vmuuidstr);\n    if (ovsport->profileID[0] != '\\0') {\n        profile_ex_id = g_strdup_printf(\"external-ids:port-profile=\\\"%s\\\"\",\n                                        ovsport->profileID);\n    }\n\n    cmd = virCommandNew(OVSVSCTL);\n    virNetDevOpenvswitchAddTimeout(cmd);\n    virCommandAddArgList(cmd, \"--\", \"--if-exists\", \"del-port\",\n                         ifname, \"--\", \"add-port\", brname, ifname, NULL);\n\n    if (virNetDevOpenvswitchConstructVlans(cmd, virtVlan) < 0)\n        return -1;\n\n    if (ovsport->profileID[0] == '\\0') {\n        virCommandAddArgList(cmd,\n                             \"--\", \"set\", \"Interface\", ifname, attachedmac_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, ifaceid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, vmid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname,\n                             \"external-ids:iface-status=active\",\n                             NULL);\n    } else {\n        virCommandAddArgList(cmd,\n                             \"--\", \"set\", \"Interface\", ifname, attachedmac_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, ifaceid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, vmid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, profile_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname,\n                             \"external-ids:iface-status=active\",\n                             NULL);\n    }\n\n    if (virCommandRun(cmd, NULL) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to add port %s to OVS bridge %s\"),\n                       ifname, brname);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virjson.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virjson.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virmacaddr.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virnetdevopenvswitch.h\"\n#include <config.h>\n\nint virNetDevOpenvswitchAddPort(const char *brname, const char *ifname,\n                                const virMacAddr *macaddr,\n                                const unsigned char *vmuuid,\n                                const virNetDevVPortProfile *ovsport,\n                                const virNetDevVlan *virtVlan)\n{\n    char macaddrstr[VIR_MAC_STRING_BUFLEN];\n    char ifuuidstr[VIR_UUID_STRING_BUFLEN];\n    char vmuuidstr[VIR_UUID_STRING_BUFLEN];\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *attachedmac_ex_id = NULL;\n    g_autofree char *ifaceid_ex_id = NULL;\n    g_autofree char *profile_ex_id = NULL;\n    g_autofree char *vmid_ex_id = NULL;\n\n    virMacAddrFormat(macaddr, macaddrstr);\n    virUUIDFormat(ovsport->interfaceID, ifuuidstr);\n    virUUIDFormat(vmuuid, vmuuidstr);\n\n    attachedmac_ex_id = g_strdup_printf(\"external-ids:attached-mac=\\\"%s\\\"\",\n                                        macaddrstr);\n    ifaceid_ex_id = g_strdup_printf(\"external-ids:iface-id=\\\"%s\\\"\", ifuuidstr);\n    vmid_ex_id = g_strdup_printf(\"external-ids:vm-id=\\\"%s\\\"\", vmuuidstr);\n    if (ovsport->profileID[0] != '\\0') {\n        profile_ex_id = g_strdup_printf(\"external-ids:port-profile=\\\"%s\\\"\",\n                                        ovsport->profileID);\n    }\n\n    cmd = virCommandNew(OVSVSCTL);\n    virNetDevOpenvswitchAddTimeout(cmd);\n    virCommandAddArgList(cmd, \"--\", \"--if-exists\", \"del-port\",\n                         ifname, \"--\", \"add-port\", brname, ifname, NULL);\n\n    if (virNetDevOpenvswitchConstructVlans(cmd, virtVlan) < 0)\n        return -1;\n\n    if (ovsport->profileID[0] == '\\0') {\n        virCommandAddArgList(cmd,\n                             \"--\", \"set\", \"Interface\", ifname, attachedmac_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, ifaceid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, vmid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname,\n                             \"external-ids:iface-status=active\",\n                             NULL);\n    } else {\n        virCommandAddArgList(cmd,\n                             \"--\", \"set\", \"Interface\", ifname, attachedmac_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, ifaceid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, vmid_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname, profile_ex_id,\n                             \"--\", \"set\", \"Interface\", ifname,\n                             \"external-ids:iface-status=active\",\n                             NULL);\n    }\n\n    if (virCommandRun(cmd, NULL) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to add port %s to OVS bridge %s\"),\n                       ifname, brname);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevMidonetBindPort",
          "args": [
            "tapname",
            "virtPortProfile"
          ],
          "line": 539
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevMidonetBindPort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevmidonet.c",
          "lines": "38-63",
          "snippet": "int\nvirNetDevMidonetBindPort(const char *ifname,\n                         const virNetDevVPortProfile *virtualport)\n{\n    int ret = -1;\n    virCommandPtr cmd = NULL;\n    char virtportuuid[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(virtualport->interfaceID, virtportuuid);\n\n    cmd = virCommandNew(MMCTL);\n\n    virCommandAddArgList(cmd, \"--bind-port\", virtportuuid, ifname, NULL);\n\n    if (virCommandRun(cmd, NULL) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to bind port %s to the virtual port %s\"),\n                       ifname, virtportuuid);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virnetdevmidonet.h\"\n#include <config.h>\n\nint\nvirNetDevMidonetBindPort(const char *ifname,\n                         const virNetDevVPortProfile *virtualport)\n{\n    int ret = -1;\n    virCommandPtr cmd = NULL;\n    char virtportuuid[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(virtualport->interfaceID, virtportuuid);\n\n    cmd = virCommandNew(MMCTL);\n\n    virCommandAddArgList(cmd, \"--bind-port\", virtportuuid, ifname, NULL);\n\n    if (virCommandRun(cmd, NULL) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to bind port %s to the virtual port %s\"),\n                       ifname, virtportuuid);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevGetMTU",
          "args": [
            "tapname"
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevGetMTU",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "423-429",
          "snippet": "int virNetDevGetMTU(const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot get interface MTU on '%s'\"),\n                         ifname);\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevGetMTU(const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot get interface MTU on '%s'\"),\n                         ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevSetMTUFromDevice",
          "args": [
            "tapname",
            "brname"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetMTUFromDevice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "483-492",
          "snippet": "int virNetDevSetMTUFromDevice(const char *ifname,\n                              const char *otherifname)\n{\n    int mtu = virNetDevGetMTU(otherifname);\n\n    if (mtu < 0)\n        return -1;\n\n    return virNetDevSetMTU(ifname, mtu);\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevSetMTUFromDevice(const char *ifname,\n                              const char *otherifname)\n{\n    int mtu = virNetDevGetMTU(otherifname);\n\n    if (mtu < 0)\n        return -1;\n\n    return virNetDevSetMTU(ifname, mtu);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapAttachBridge(const char *tapname,\n                         const char *brname,\n                         const virMacAddr *macaddr,\n                         const unsigned char *vmuuid,\n                         const virNetDevVPortProfile *virtPortProfile,\n                         const virNetDevVlan *virtVlan,\n                         virTristateBool isolatedPort,\n                         unsigned int mtu,\n                         unsigned int *actualMTU)\n{\n    /* If an MTU is specified for the new device, set it before\n     * attaching the device to the bridge, as it may affect the MTU of\n     * the bridge (in particular if it is the first device attached to\n     * the bridge, or if it is smaller than the current MTU of the\n     * bridge). If MTU isn't specified for the new device (i.e. 0),\n     * we need to set the interface MTU to the current MTU of the\n     * bridge (to avoid inadvertantly changing the bridge's MTU).\n     */\n    if (mtu > 0) {\n        if (virNetDevSetMTU(tapname, mtu) < 0)\n            return -1;\n    } else {\n        if (virNetDevSetMTUFromDevice(tapname, brname) < 0)\n            return -1;\n    }\n    if (actualMTU) {\n        int retMTU = virNetDevGetMTU(tapname);\n\n        if (retMTU < 0)\n            return -1;\n\n        *actualMTU = retMTU;\n    }\n\n\n    if (virtPortProfile) {\n        if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_MIDONET) {\n            if (virNetDevMidonetBindPort(tapname, virtPortProfile) < 0)\n                return -1;\n        } else if (virtPortProfile->virtPortType == VIR_NETDEV_VPORT_PROFILE_OPENVSWITCH) {\n            if (virNetDevOpenvswitchAddPort(brname, tapname, macaddr, vmuuid,\n                                            virtPortProfile, virtVlan) < 0)\n                return -1;\n        }\n    } else {\n        if (virNetDevBridgeAddPort(brname, tapname) < 0)\n            return -1;\n\n        if (isolatedPort == VIR_TRISTATE_BOOL_YES &&\n            virNetDevBridgePortSetIsolated(brname, tapname, true) < 0) {\n            virErrorPtr err;\n\n            virErrorPreserveLast(&err);\n            ignore_value(virNetDevBridgeRemovePort(brname, tapname));\n            virErrorRestore(&err);\n            return -1;\n        }\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virNetDevTapDelete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "476-482",
    "snippet": "int virNetDevTapDelete(const char *ifname G_GNUC_UNUSED,\n                       const char *tunpath G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to delete TAP devices on this platform\"));\n    return -1;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOSYS",
            "\"%s\"",
            "_(\"Unable to delete TAP devices on this platform\")"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to delete TAP devices on this platform\""
          ],
          "line": 480
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapDelete(const char *ifname G_GNUC_UNUSED,\n                       const char *tunpath G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to delete TAP devices on this platform\"));\n    return -1;\n}"
  },
  {
    "function_name": "virNetDevTapCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "466-475",
    "snippet": "int virNetDevTapCreate(char **ifname G_GNUC_UNUSED,\n                       const char *tunpath G_GNUC_UNUSED,\n                       int *tapfd G_GNUC_UNUSED,\n                       size_t tapfdSize G_GNUC_UNUSED,\n                       unsigned int flags G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to create TAP devices on this platform\"));\n    return -1;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOSYS",
            "\"%s\"",
            "_(\"Unable to create TAP devices on this platform\")"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create TAP devices on this platform\""
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapCreate(char **ifname G_GNUC_UNUSED,\n                       const char *tunpath G_GNUC_UNUSED,\n                       int *tapfd G_GNUC_UNUSED,\n                       size_t tapfdSize G_GNUC_UNUSED,\n                       unsigned int flags G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to create TAP devices on this platform\"));\n    return -1;\n}"
  },
  {
    "function_name": "virNetDevTapDelete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "442-463",
    "snippet": "int virNetDevTapDelete(const char *ifname,\n                       const char *tunpath G_GNUC_UNUSED)\n{\n    int s;\n    struct ifreq ifr;\n    int ret = -1;\n\n    if ((s = virNetDevSetupControl(ifname, &ifr)) < 0)\n        return -1;\n\n    if (ioctl(s, SIOCIFDESTROY, &ifr) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to remove tap device %s\"),\n                             ifname);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(s);\n    return ret;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "s"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to remove tap device %s\")",
            "ifname"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to remove tap device %s\""
          ],
          "line": 454
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "s",
            "SIOCIFDESTROY",
            "&ifr"
          ],
          "line": 452
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevSetupControl",
          "args": [
            "ifname",
            "&ifr"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetupControl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "177-185",
          "snippet": "int\nvirNetDevSetupControl(const char *ifname G_GNUC_UNUSED,\n                      void *ifr G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Network device configuration is not supported \"\n                           \"on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint\nvirNetDevSetupControl(const char *ifname G_GNUC_UNUSED,\n                      void *ifr G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Network device configuration is not supported \"\n                           \"on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapDelete(const char *ifname,\n                       const char *tunpath G_GNUC_UNUSED)\n{\n    int s;\n    struct ifreq ifr;\n    int ret = -1;\n\n    if ((s = virNetDevSetupControl(ifname, &ifr)) < 0)\n        return -1;\n\n    if (ioctl(s, SIOCIFDESTROY, &ifr) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to remove tap device %s\"),\n                             ifname);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(s);\n    return ret;\n}"
  },
  {
    "function_name": "virNetDevTapCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "361-440",
    "snippet": "int virNetDevTapCreate(char **ifname,\n                       const char *tunpath G_GNUC_UNUSED,\n                       int *tapfd,\n                       size_t tapfdSize,\n                       unsigned int flags G_GNUC_UNUSED)\n{\n    int s;\n    struct ifreq ifr;\n    int ret = -1;\n    char *newifname = NULL;\n\n    if (tapfdSize > 1) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Multiqueue devices are not supported on this system\"));\n        goto cleanup;\n    }\n\n    /* As FreeBSD determines interface type by name,\n     * we have to create 'tap' interface first and\n     * then rename it to 'vnet'\n     */\n    if ((s = virNetDevSetupControl(\"tap\", &ifr)) < 0)\n        return -1;\n\n    if (ioctl(s, SIOCIFCREATE2, &ifr) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to create tap device\"));\n        goto cleanup;\n    }\n\n    /* In case we were given exact interface name (e.g. 'vnetN'),\n     * we just rename to it. If we have format string like\n     * 'vnet%d', we need to find the first available name that\n     * matches this pattern\n     */\n    if (strstr(*ifname, \"%d\") != NULL) {\n        size_t i;\n        for (i = 0; i <= IF_MAXUNIT; i++) {\n            g_autofree char *newname = NULL;\n\n            newname = g_strdup_printf(*ifname, i);\n\n            if (virNetDevExists(newname) == 0) {\n                newifname = g_steal_pointer(&newname);\n                break;\n            }\n        }\n        if (newifname) {\n            VIR_FREE(*ifname);\n            *ifname = newifname;\n        } else {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to generate new name for interface %s\"),\n                           ifr.ifr_name);\n            goto cleanup;\n        }\n    }\n\n    if (tapfd) {\n        g_autofree char *dev_path = NULL;\n        dev_path = g_strdup_printf(\"/dev/%s\", ifr.ifr_name);\n\n        if ((*tapfd = open(dev_path, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open %s\"),\n                                 dev_path);\n            goto cleanup;\n        }\n    }\n\n    if (virNetDevSetName(ifr.ifr_name, *ifname) == -1)\n        goto cleanup;\n\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(s);\n\n    return ret;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "s"
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevSetName",
          "args": [
            "ifr.ifr_name",
            "*ifname"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "591-597",
          "snippet": "int virNetDevSetName(const char* ifname, const char *newifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot rename interface '%s' to '%s' on this platform\"),\n                         ifname, newifname);\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevSetName(const char* ifname, const char *newifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot rename interface '%s' to '%s' on this platform\"),\n                         ifname, newifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open %s\")",
            "dev_path"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to open %s\""
          ],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "dev_path",
            "O_RDWR"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to generate new name for interface %s\")",
            "ifr.ifr_name"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*ifname"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&newname"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevExists",
          "args": [
            "newname"
          ],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "218-223",
          "snippet": "int virNetDevExists(const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to check interface %s\"), ifname);\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevExists(const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to check interface %s\"), ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "*ifname",
            "\"%d\""
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to create tap device\")"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "s",
            "SIOCIFCREATE2",
            "&ifr"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevSetupControl",
          "args": [
            "\"tap\"",
            "&ifr"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetupControl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "177-185",
          "snippet": "int\nvirNetDevSetupControl(const char *ifname G_GNUC_UNUSED,\n                      void *ifr G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Network device configuration is not supported \"\n                           \"on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint\nvirNetDevSetupControl(const char *ifname G_GNUC_UNUSED,\n                      void *ifr G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Network device configuration is not supported \"\n                           \"on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Multiqueue devices are not supported on this system\")"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapCreate(char **ifname,\n                       const char *tunpath G_GNUC_UNUSED,\n                       int *tapfd,\n                       size_t tapfdSize,\n                       unsigned int flags G_GNUC_UNUSED)\n{\n    int s;\n    struct ifreq ifr;\n    int ret = -1;\n    char *newifname = NULL;\n\n    if (tapfdSize > 1) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Multiqueue devices are not supported on this system\"));\n        goto cleanup;\n    }\n\n    /* As FreeBSD determines interface type by name,\n     * we have to create 'tap' interface first and\n     * then rename it to 'vnet'\n     */\n    if ((s = virNetDevSetupControl(\"tap\", &ifr)) < 0)\n        return -1;\n\n    if (ioctl(s, SIOCIFCREATE2, &ifr) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to create tap device\"));\n        goto cleanup;\n    }\n\n    /* In case we were given exact interface name (e.g. 'vnetN'),\n     * we just rename to it. If we have format string like\n     * 'vnet%d', we need to find the first available name that\n     * matches this pattern\n     */\n    if (strstr(*ifname, \"%d\") != NULL) {\n        size_t i;\n        for (i = 0; i <= IF_MAXUNIT; i++) {\n            g_autofree char *newname = NULL;\n\n            newname = g_strdup_printf(*ifname, i);\n\n            if (virNetDevExists(newname) == 0) {\n                newifname = g_steal_pointer(&newname);\n                break;\n            }\n        }\n        if (newifname) {\n            VIR_FREE(*ifname);\n            *ifname = newifname;\n        } else {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to generate new name for interface %s\"),\n                           ifr.ifr_name);\n            goto cleanup;\n        }\n    }\n\n    if (tapfd) {\n        g_autofree char *dev_path = NULL;\n        dev_path = g_strdup_printf(\"/dev/%s\", ifr.ifr_name);\n\n        if ((*tapfd = open(dev_path, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open %s\"),\n                                 dev_path);\n            goto cleanup;\n        }\n    }\n\n    if (virNetDevSetName(ifr.ifr_name, *ifname) == -1)\n        goto cleanup;\n\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(s);\n\n    return ret;\n}"
  },
  {
    "function_name": "virNetDevTapDelete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "315-359",
    "snippet": "int virNetDevTapDelete(const char *ifname,\n                       const char *tunpath)\n{\n    struct ifreq try;\n    int fd;\n    int ret = -1;\n\n    if (!tunpath)\n        tunpath = \"/dev/net/tun\";\n\n    if ((fd = open(tunpath, O_RDWR)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open %s, is tun module loaded?\"),\n                             tunpath);\n        return -1;\n    }\n\n    memset(&try, 0, sizeof(struct ifreq));\n    try.ifr_flags = IFF_TAP|IFF_NO_PI;\n\n    if (virStrcpyStatic(try.ifr_name, ifname) < 0) {\n        virReportSystemError(ERANGE,\n                             _(\"Network interface name '%s' is too long\"),\n                             ifname);\n        goto cleanup;\n    }\n\n    if (ioctl(fd, TUNSETIFF, &try) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to associate TAP device\"));\n        goto cleanup;\n    }\n\n    if (ioctl(fd, TUNSETPERSIST, 0) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to make TAP device non-persistent\"));\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_CLOSE(fd);\n    return ret;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to make TAP device non-persistent\")"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to make TAP device non-persistent\""
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "fd",
            "TUNSETPERSIST",
            "0"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to associate TAP device\")"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ERANGE",
            "_(\"Network interface name '%s' is too long\")",
            "ifname"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrcpyStatic",
          "args": [
            "try.ifr_name",
            "ifname"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&try",
            "0",
            "sizeof(struct ifreq)"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open %s, is tun module loaded?\")",
            "tunpath"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "tunpath",
            "O_RDWR"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapDelete(const char *ifname,\n                       const char *tunpath)\n{\n    struct ifreq try;\n    int fd;\n    int ret = -1;\n\n    if (!tunpath)\n        tunpath = \"/dev/net/tun\";\n\n    if ((fd = open(tunpath, O_RDWR)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open %s, is tun module loaded?\"),\n                             tunpath);\n        return -1;\n    }\n\n    memset(&try, 0, sizeof(struct ifreq));\n    try.ifr_flags = IFF_TAP|IFF_NO_PI;\n\n    if (virStrcpyStatic(try.ifr_name, ifname) < 0) {\n        virReportSystemError(ERANGE,\n                             _(\"Network interface name '%s' is too long\"),\n                             ifname);\n        goto cleanup;\n    }\n\n    if (ioctl(fd, TUNSETIFF, &try) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to associate TAP device\"));\n        goto cleanup;\n    }\n\n    if (ioctl(fd, TUNSETPERSIST, 0) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to make TAP device non-persistent\"));\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_CLOSE(fd);\n    return ret;\n}"
  },
  {
    "function_name": "virNetDevTapCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "227-312",
    "snippet": "int virNetDevTapCreate(char **ifname,\n                       const char *tunpath,\n                       int *tapfd,\n                       size_t tapfdSize,\n                       unsigned int flags)\n{\n    size_t i;\n    struct ifreq ifr;\n    int ret = -1;\n    int fd;\n\n    if (!tunpath)\n        tunpath = \"/dev/net/tun\";\n\n    memset(&ifr, 0, sizeof(ifr));\n    for (i = 0; i < tapfdSize; i++) {\n        if ((fd = open(tunpath, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open %s, is tun module loaded?\"),\n                                 tunpath);\n            goto cleanup;\n        }\n\n        memset(&ifr, 0, sizeof(ifr));\n\n        ifr.ifr_flags = IFF_TAP | IFF_NO_PI;\n        /* If tapfdSize is greater than one, request multiqueue */\n        if (tapfdSize > 1) {\n# ifdef IFF_MULTI_QUEUE\n            ifr.ifr_flags |= IFF_MULTI_QUEUE;\n# else\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Multiqueue devices are not supported on this system\"));\n            goto cleanup;\n# endif\n        }\n\n# ifdef IFF_VNET_HDR\n        if ((flags &  VIR_NETDEV_TAP_CREATE_VNET_HDR) &&\n            virNetDevProbeVnetHdr(fd))\n            ifr.ifr_flags |= IFF_VNET_HDR;\n# endif\n\n        if (virStrcpyStatic(ifr.ifr_name, *ifname) < 0) {\n            virReportSystemError(ERANGE,\n                                 _(\"Network interface name '%s' is too long\"),\n                                 *ifname);\n            goto cleanup;\n\n        }\n\n        if (ioctl(fd, TUNSETIFF, &ifr) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to create tap device %s\"),\n                                 NULLSTR(*ifname));\n            goto cleanup;\n        }\n\n        if (i == 0) {\n            /* In case we are looping more than once, set other\n             * TAPs to have the same name */\n            VIR_FREE(*ifname);\n            *ifname = g_strdup(ifr.ifr_name);\n        }\n\n        if ((flags & VIR_NETDEV_TAP_CREATE_PERSIST) &&\n            ioctl(fd, TUNSETPERSIST, 1) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to set tap device %s to persistent\"),\n                                 NULLSTR(*ifname));\n            goto cleanup;\n        }\n        tapfd[i] = fd;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (ret < 0) {\n        VIR_FORCE_CLOSE(fd);\n        while (i--)\n            VIR_FORCE_CLOSE(tapfd[i]);\n    }\n\n    return ret;\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "tapfd[i]"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to set tap device %s to persistent\")",
            "NULLSTR(*ifname)"
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "*ifname"
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to set tap device %s to persistent\""
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "fd",
            "TUNSETPERSIST",
            "1"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*ifname"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create tap device %s\")",
            "NULLSTR(*ifname)"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "*ifname"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ERANGE",
            "_(\"Network interface name '%s' is too long\")",
            "*ifname"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrcpyStatic",
          "args": [
            "ifr.ifr_name",
            "*ifname"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevProbeVnetHdr",
          "args": [
            "fd"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevProbeVnetHdr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
          "lines": "166-202",
          "snippet": "static int\nvirNetDevProbeVnetHdr(int tapfd)\n{\n# if defined(IFF_VNET_HDR) && defined(TUNGETFEATURES) && defined(TUNGETIFF)\n    unsigned int features;\n    struct ifreq dummy;\n\n    if (ioctl(tapfd, TUNGETFEATURES, &features) != 0) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() not implemented\");\n        return 0;\n    }\n\n    if (!(features & IFF_VNET_HDR)) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() reports no IFF_VNET_HDR\");\n        return 0;\n    }\n\n    /* The kernel will always return -1 at this point.\n     * If TUNGETIFF is not implemented then errno == EBADFD.\n     */\n    if (ioctl(tapfd, TUNGETIFF, &dummy) != -1 || errno != EBADFD) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETIFF ioctl() not implemented\");\n        return 0;\n    }\n\n    VIR_INFO(\"Enabling IFF_VNET_HDR\");\n\n    return 1;\n# else\n    (void) tapfd;\n    VIR_INFO(\"Not enabling IFF_VNET_HDR; disabled at build time\");\n    return 0;\n# endif\n}",
          "includes": [
            "# include <ifaddrs.h>",
            "# include <sys/sysctl.h>",
            "# include <net/if_mib.h>",
            "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
            "#include <fcntl.h>",
            "# include <net/if.h>",
            "# include <sys/ioctl.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nstatic int\nvirNetDevProbeVnetHdr(int tapfd)\n{\n# if defined(IFF_VNET_HDR) && defined(TUNGETFEATURES) && defined(TUNGETIFF)\n    unsigned int features;\n    struct ifreq dummy;\n\n    if (ioctl(tapfd, TUNGETFEATURES, &features) != 0) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() not implemented\");\n        return 0;\n    }\n\n    if (!(features & IFF_VNET_HDR)) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() reports no IFF_VNET_HDR\");\n        return 0;\n    }\n\n    /* The kernel will always return -1 at this point.\n     * If TUNGETIFF is not implemented then errno == EBADFD.\n     */\n    if (ioctl(tapfd, TUNGETIFF, &dummy) != -1 || errno != EBADFD) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETIFF ioctl() not implemented\");\n        return 0;\n    }\n\n    VIR_INFO(\"Enabling IFF_VNET_HDR\");\n\n    return 1;\n# else\n    (void) tapfd;\n    VIR_INFO(\"Not enabling IFF_VNET_HDR; disabled at build time\");\n    return 0;\n# endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Multiqueue devices are not supported on this system\")"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ifr",
            "0",
            "sizeof(ifr)"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open %s, is tun module loaded?\")",
            "tunpath"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "tunpath",
            "O_RDWR"
          ],
          "line": 243
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ifr",
            "0",
            "sizeof(ifr)"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint virNetDevTapCreate(char **ifname,\n                       const char *tunpath,\n                       int *tapfd,\n                       size_t tapfdSize,\n                       unsigned int flags)\n{\n    size_t i;\n    struct ifreq ifr;\n    int ret = -1;\n    int fd;\n\n    if (!tunpath)\n        tunpath = \"/dev/net/tun\";\n\n    memset(&ifr, 0, sizeof(ifr));\n    for (i = 0; i < tapfdSize; i++) {\n        if ((fd = open(tunpath, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open %s, is tun module loaded?\"),\n                                 tunpath);\n            goto cleanup;\n        }\n\n        memset(&ifr, 0, sizeof(ifr));\n\n        ifr.ifr_flags = IFF_TAP | IFF_NO_PI;\n        /* If tapfdSize is greater than one, request multiqueue */\n        if (tapfdSize > 1) {\n# ifdef IFF_MULTI_QUEUE\n            ifr.ifr_flags |= IFF_MULTI_QUEUE;\n# else\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Multiqueue devices are not supported on this system\"));\n            goto cleanup;\n# endif\n        }\n\n# ifdef IFF_VNET_HDR\n        if ((flags &  VIR_NETDEV_TAP_CREATE_VNET_HDR) &&\n            virNetDevProbeVnetHdr(fd))\n            ifr.ifr_flags |= IFF_VNET_HDR;\n# endif\n\n        if (virStrcpyStatic(ifr.ifr_name, *ifname) < 0) {\n            virReportSystemError(ERANGE,\n                                 _(\"Network interface name '%s' is too long\"),\n                                 *ifname);\n            goto cleanup;\n\n        }\n\n        if (ioctl(fd, TUNSETIFF, &ifr) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to create tap device %s\"),\n                                 NULLSTR(*ifname));\n            goto cleanup;\n        }\n\n        if (i == 0) {\n            /* In case we are looping more than once, set other\n             * TAPs to have the same name */\n            VIR_FREE(*ifname);\n            *ifname = g_strdup(ifr.ifr_name);\n        }\n\n        if ((flags & VIR_NETDEV_TAP_CREATE_PERSIST) &&\n            ioctl(fd, TUNSETPERSIST, 1) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to set tap device %s to persistent\"),\n                                 NULLSTR(*ifname));\n            goto cleanup;\n        }\n        tapfd[i] = fd;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (ret < 0) {\n        VIR_FORCE_CLOSE(fd);\n        while (i--)\n            VIR_FORCE_CLOSE(tapfd[i]);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virNetDevProbeVnetHdr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "166-202",
    "snippet": "static int\nvirNetDevProbeVnetHdr(int tapfd)\n{\n# if defined(IFF_VNET_HDR) && defined(TUNGETFEATURES) && defined(TUNGETIFF)\n    unsigned int features;\n    struct ifreq dummy;\n\n    if (ioctl(tapfd, TUNGETFEATURES, &features) != 0) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() not implemented\");\n        return 0;\n    }\n\n    if (!(features & IFF_VNET_HDR)) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() reports no IFF_VNET_HDR\");\n        return 0;\n    }\n\n    /* The kernel will always return -1 at this point.\n     * If TUNGETIFF is not implemented then errno == EBADFD.\n     */\n    if (ioctl(tapfd, TUNGETIFF, &dummy) != -1 || errno != EBADFD) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETIFF ioctl() not implemented\");\n        return 0;\n    }\n\n    VIR_INFO(\"Enabling IFF_VNET_HDR\");\n\n    return 1;\n# else\n    (void) tapfd;\n    VIR_INFO(\"Not enabling IFF_VNET_HDR; disabled at build time\");\n    return 0;\n# endif\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Not enabling IFF_VNET_HDR; disabled at build time\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Enabling IFF_VNET_HDR\""
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETIFF ioctl() not implemented\""
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "tapfd",
            "TUNGETIFF",
            "&dummy"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() reports no IFF_VNET_HDR\""
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() not implemented\""
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nstatic int\nvirNetDevProbeVnetHdr(int tapfd)\n{\n# if defined(IFF_VNET_HDR) && defined(TUNGETFEATURES) && defined(TUNGETIFF)\n    unsigned int features;\n    struct ifreq dummy;\n\n    if (ioctl(tapfd, TUNGETFEATURES, &features) != 0) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() not implemented\");\n        return 0;\n    }\n\n    if (!(features & IFF_VNET_HDR)) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETFEATURES ioctl() reports no IFF_VNET_HDR\");\n        return 0;\n    }\n\n    /* The kernel will always return -1 at this point.\n     * If TUNGETIFF is not implemented then errno == EBADFD.\n     */\n    if (ioctl(tapfd, TUNGETIFF, &dummy) != -1 || errno != EBADFD) {\n        VIR_INFO(\"Not enabling IFF_VNET_HDR; \"\n                 \"TUNGETIFF ioctl() not implemented\");\n        return 0;\n    }\n\n    VIR_INFO(\"Enabling IFF_VNET_HDR\");\n\n    return 1;\n# else\n    (void) tapfd;\n    VIR_INFO(\"Not enabling IFF_VNET_HDR; disabled at build time\");\n    return 0;\n# endif\n}"
  },
  {
    "function_name": "virNetDevTapGetRealDeviceName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "98-143",
    "snippet": "char*\nvirNetDevTapGetRealDeviceName(char *ifname G_GNUC_UNUSED)\n{\n#ifdef IFDATA_DRIVERNAME\n    int ifindex = 0;\n    int name[6];\n    size_t len = 0;\n    char *ret = NULL;\n\n    if ((ifindex = if_nametoindex(ifname)) == 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to get interface index for '%s'\"),\n                             ifname);\n        return NULL;\n    }\n\n    name[0] = CTL_NET;\n    name[1] = PF_LINK;\n    name[2] = NETLINK_GENERIC;\n    name[3] = IFMIB_IFDATA;\n    name[4] = ifindex;\n    name[5] = IFDATA_DRIVERNAME;\n\n    if (sysctl(name, 6, NULL, &len, 0, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to get driver name for '%s'\"),\n                             ifname);\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(ret, len) < 0)\n        return NULL;\n\n    if (sysctl(name, 6, ret, &len, 0, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to get driver name for '%s'\"),\n                             ifname);\n        VIR_FREE(ret);\n        return NULL;\n    }\n\n    return ret;\n#else\n    return NULL;\n#endif\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ret"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to get driver name for '%s'\")",
            "ifname"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to get driver name for '%s'\""
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sysctl",
          "args": [
            "name",
            "6",
            "ret",
            "&len",
            "0",
            "0"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "ret",
            "len"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to get driver name for '%s'\")",
            "ifname"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysctl",
          "args": [
            "name",
            "6",
            "NULL",
            "&len",
            "0",
            "0"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to get interface index for '%s'\")",
            "ifname"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "if_nametoindex",
          "args": [
            "ifname"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nchar*\nvirNetDevTapGetRealDeviceName(char *ifname G_GNUC_UNUSED)\n{\n#ifdef IFDATA_DRIVERNAME\n    int ifindex = 0;\n    int name[6];\n    size_t len = 0;\n    char *ret = NULL;\n\n    if ((ifindex = if_nametoindex(ifname)) == 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to get interface index for '%s'\"),\n                             ifname);\n        return NULL;\n    }\n\n    name[0] = CTL_NET;\n    name[1] = PF_LINK;\n    name[2] = NETLINK_GENERIC;\n    name[3] = IFMIB_IFDATA;\n    name[4] = ifindex;\n    name[5] = IFDATA_DRIVERNAME;\n\n    if (sysctl(name, 6, NULL, &len, 0, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to get driver name for '%s'\"),\n                             ifname);\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(ret, len) < 0)\n        return NULL;\n\n    if (sysctl(name, 6, ret, &len, 0, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to get driver name for '%s'\"),\n                             ifname);\n        VIR_FREE(ret);\n        return NULL;\n    }\n\n    return ret;\n#else\n    return NULL;\n#endif\n}"
  },
  {
    "function_name": "virNetDevTapGetName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevtap.c",
    "lines": "67-84",
    "snippet": "int\nvirNetDevTapGetName(int tapfd G_GNUC_UNUSED, char **ifname G_GNUC_UNUSED)\n{\n#ifdef TUNGETIFF\n    struct ifreq ifr;\n\n    if (ioctl(tapfd, TUNGETIFF, &ifr) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to query tap interface name\"));\n        return -1;\n    }\n\n    *ifname = g_strdup(ifr.ifr_name);\n    return 0;\n#else\n    return -1;\n#endif\n}",
    "includes": [
      "# include <ifaddrs.h>",
      "# include <sys/sysctl.h>",
      "# include <net/if_mib.h>",
      "# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */",
      "#include <fcntl.h>",
      "# include <net/if.h>",
      "# include <sys/ioctl.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virnetdevopenvswitch.h\"",
      "#include \"virnetdevmidonet.h\"",
      "#include \"virnetdevbridge.h\"",
      "#include \"virnetdev.h\"",
      "#include \"virnetdevtap.h\"",
      "#include \"virmacaddr.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "ifr.ifr_name"
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to query tap interface name\")"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "tapfd",
            "TUNGETIFF",
            "&ifr"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <ifaddrs.h>\n# include <sys/sysctl.h>\n# include <net/if_mib.h>\n# include <linux/if_tun.h>    /* IFF_TUN, IFF_NO_PI */\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevtap.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirNetDevTapGetName(int tapfd G_GNUC_UNUSED, char **ifname G_GNUC_UNUSED)\n{\n#ifdef TUNGETIFF\n    struct ifreq ifr;\n\n    if (ioctl(tapfd, TUNGETIFF, &ifr) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to query tap interface name\"));\n        return -1;\n    }\n\n    *ifname = g_strdup(ifr.ifr_name);\n    return 0;\n#else\n    return -1;\n#endif\n}"
  }
]