[
  {
    "function_name": "virNWFilterIPAddrMapShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
    "lines": "159-164",
    "snippet": "void\nvirNWFilterIPAddrMapShutdown(void)\n{\n    virHashFree(ipAddressMap);\n    ipAddressMap = NULL;\n}",
    "includes": [
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_params.h\"",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virHashTablePtr ipAddressMap;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "ipAddressMap"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virHashTablePtr ipAddressMap;\n\nvoid\nvirNWFilterIPAddrMapShutdown(void)\n{\n    virHashFree(ipAddressMap);\n    ipAddressMap = NULL;\n}"
  },
  {
    "function_name": "virNWFilterIPAddrMapInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
    "lines": "149-157",
    "snippet": "int\nvirNWFilterIPAddrMapInit(void)\n{\n    ipAddressMap = virNWFilterHashTableCreate(0);\n    if (!ipAddressMap)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_params.h\"",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virHashTablePtr ipAddressMap;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterHashTableCreate",
          "args": [
            "0"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterHashTableCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "628-632",
          "snippet": "virHashTablePtr\nvirNWFilterHashTableCreate(int n)\n{\n    return virHashCreate(n, hashDataFree);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirHashTablePtr\nvirNWFilterHashTableCreate(int n)\n{\n    return virHashCreate(n, hashDataFree);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virHashTablePtr ipAddressMap;\n\nint\nvirNWFilterIPAddrMapInit(void)\n{\n    ipAddressMap = virNWFilterHashTableCreate(0);\n    if (!ipAddressMap)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterIPAddrMapGetIPAddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
    "lines": "135-147",
    "snippet": "virNWFilterVarValuePtr\nvirNWFilterIPAddrMapGetIPAddr(const char *ifname)\n{\n    virNWFilterVarValuePtr res;\n\n    virMutexLock(&ipAddressMapLock);\n\n    res = virHashLookup(ipAddressMap, ifname);\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return res;\n}",
    "includes": [
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_params.h\"",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;",
      "static virHashTablePtr ipAddressMap;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&ipAddressMapLock"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "ipAddressMap",
            "ifname"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&ipAddressMapLock"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;\nstatic virHashTablePtr ipAddressMap;\n\nvirNWFilterVarValuePtr\nvirNWFilterIPAddrMapGetIPAddr(const char *ifname)\n{\n    virNWFilterVarValuePtr res;\n\n    virMutexLock(&ipAddressMapLock);\n\n    res = virHashLookup(ipAddressMap, ifname);\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return res;\n}"
  },
  {
    "function_name": "virNWFilterIPAddrMapDelIPAddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
    "lines": "99-127",
    "snippet": "int\nvirNWFilterIPAddrMapDelIPAddr(const char *ifname, const char *ipaddr)\n{\n    int ret = -1;\n    virNWFilterVarValuePtr val = NULL;\n\n    virMutexLock(&ipAddressMapLock);\n\n    if (ipaddr != NULL) {\n        val = virHashLookup(ipAddressMap, ifname);\n        if (val) {\n            if (virNWFilterVarValueGetCardinality(val) == 1 &&\n                STREQ(ipaddr,\n                      virNWFilterVarValueGetNthValue(val, 0)))\n                goto remove_entry;\n            virNWFilterVarValueDelValue(val, ipaddr);\n            ret = virNWFilterVarValueGetCardinality(val);\n        }\n    } else {\n remove_entry:\n        /* remove whole entry */\n        virHashRemoveEntry(ipAddressMap, ifname);\n        ret = 0;\n    }\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return ret;\n}",
    "includes": [
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_params.h\"",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;",
      "static virHashTablePtr ipAddressMap;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&ipAddressMapLock"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "ipAddressMap",
            "ifname"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterVarValueGetCardinality",
          "args": [
            "val"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterVarValueGetCardinality",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "166-180",
          "snippet": "unsigned int\nvirNWFilterVarValueGetCardinality(const virNWFilterVarValue *val)\n{\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        return 1;\n        break;\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        return val->u.array.nValues;\n        break;\n    case NWFILTER_VALUE_TYPE_LAST:\n        return 0;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nunsigned int\nvirNWFilterVarValueGetCardinality(const virNWFilterVarValue *val)\n{\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        return 1;\n        break;\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        return val->u.array.nValues;\n        break;\n    case NWFILTER_VALUE_TYPE_LAST:\n        return 0;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterVarValueDelValue",
          "args": [
            "val",
            "ipaddr"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterVarValueDelValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "286-306",
          "snippet": "int\nvirNWFilterVarValueDelValue(virNWFilterVarValuePtr val, const char *value)\n{\n    size_t i;\n\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        return -1;\n\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        for (i = 0; i < val->u.array.nValues; i++)\n            if (STREQ(value, val->u.array.values[i]))\n                return virNWFilterVarValueDelNthValue(val, i);\n        break;\n\n    case NWFILTER_VALUE_TYPE_LAST:\n        break;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool isValidVarValue(const char *value);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool isValidVarValue(const char *value);\n\nint\nvirNWFilterVarValueDelValue(virNWFilterVarValuePtr val, const char *value)\n{\n    size_t i;\n\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        return -1;\n\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        for (i = 0; i < val->u.array.nValues; i++)\n            if (STREQ(value, val->u.array.values[i]))\n                return virNWFilterVarValueDelNthValue(val, i);\n        break;\n\n    case NWFILTER_VALUE_TYPE_LAST:\n        break;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "ipaddr",
            "virNWFilterVarValueGetNthValue(val, 0)"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterVarValueGetNthValue",
          "args": [
            "val",
            "0"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterVarValueGetNthValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "142-164",
          "snippet": "const char *\nvirNWFilterVarValueGetNthValue(const virNWFilterVarValue* val, unsigned int idx)\n{\n    const char *res = NULL;\n\n    if (!val)\n        return NULL;\n\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        if (idx == 0)\n            res = val->u.simple.value;\n        break;\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        if (idx < val->u.array.nValues)\n            res = val->u.array.values[idx];\n        break;\n    case NWFILTER_VALUE_TYPE_LAST:\n        break;\n    }\n\n    return res;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool isValidVarValue(const char *value);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool isValidVarValue(const char *value);\n\nconst char *\nvirNWFilterVarValueGetNthValue(const virNWFilterVarValue* val, unsigned int idx)\n{\n    const char *res = NULL;\n\n    if (!val)\n        return NULL;\n\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        if (idx == 0)\n            res = val->u.simple.value;\n        break;\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        if (idx < val->u.array.nValues)\n            res = val->u.array.values[idx];\n        break;\n    case NWFILTER_VALUE_TYPE_LAST:\n        break;\n    }\n\n    return res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "ipAddressMap",
            "ifname"
          ],
          "line": 108
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&ipAddressMapLock"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;\nstatic virHashTablePtr ipAddressMap;\n\nint\nvirNWFilterIPAddrMapDelIPAddr(const char *ifname, const char *ipaddr)\n{\n    int ret = -1;\n    virNWFilterVarValuePtr val = NULL;\n\n    virMutexLock(&ipAddressMapLock);\n\n    if (ipaddr != NULL) {\n        val = virHashLookup(ipAddressMap, ifname);\n        if (val) {\n            if (virNWFilterVarValueGetCardinality(val) == 1 &&\n                STREQ(ipaddr,\n                      virNWFilterVarValueGetNthValue(val, 0)))\n                goto remove_entry;\n            virNWFilterVarValueDelValue(val, ipaddr);\n            ret = virNWFilterVarValueGetCardinality(val);\n        }\n    } else {\n remove_entry:\n        /* remove whole entry */\n        virHashRemoveEntry(ipAddressMap, ifname);\n        ret = 0;\n    }\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virNWFilterIPAddrMapAddIPAddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
    "lines": "49-83",
    "snippet": "int\nvirNWFilterIPAddrMapAddIPAddr(const char *ifname, char *addr)\n{\n    int ret = -1;\n    char *addrCopy;\n    virNWFilterVarValuePtr val;\n\n    addrCopy = g_strdup(addr);\n\n    virMutexLock(&ipAddressMapLock);\n\n    val = virHashLookup(ipAddressMap, ifname);\n    if (!val) {\n        val = virNWFilterVarValueCreateSimple(addrCopy);\n        if (!val)\n            goto cleanup;\n        addrCopy = NULL;\n        ret = virHashUpdateEntry(ipAddressMap, ifname, val);\n        if (ret < 0)\n            virNWFilterVarValueFree(val);\n        goto cleanup;\n    } else {\n        if (virNWFilterVarValueAddValue(val, addrCopy) < 0)\n            goto cleanup;\n        addrCopy = NULL;\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&ipAddressMapLock);\n    VIR_FREE(addrCopy);\n\n    return ret;\n}",
    "includes": [
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_params.h\"",
      "#include \"datatypes.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;",
      "static virHashTablePtr ipAddressMap;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "addrCopy"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&ipAddressMapLock"
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterVarValueAddValue",
          "args": [
            "val",
            "addrCopy"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterVarValueAddValueCopy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "251-261",
          "snippet": "int\nvirNWFilterVarValueAddValueCopy(virNWFilterVarValuePtr val, const char *value)\n{\n    char *valdup;\n    valdup = g_strdup(value);\n    if (virNWFilterVarValueAddValue(val, valdup) < 0) {\n        VIR_FREE(valdup);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool isValidVarValue(const char *value);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool isValidVarValue(const char *value);\n\nint\nvirNWFilterVarValueAddValueCopy(virNWFilterVarValuePtr val, const char *value)\n{\n    char *valdup;\n    valdup = g_strdup(value);\n    if (virNWFilterVarValueAddValue(val, valdup) < 0) {\n        VIR_FREE(valdup);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterVarValueFree",
          "args": [
            "val"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterVarValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "43-64",
          "snippet": "void\nvirNWFilterVarValueFree(virNWFilterVarValuePtr val)\n{\n    size_t i;\n\n    if (!val)\n        return;\n\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        VIR_FREE(val->u.simple.value);\n        break;\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        for (i = 0; i < val->u.array.nValues; i++)\n            VIR_FREE(val->u.array.values[i]);\n        VIR_FREE(val->u.array.values);\n        break;\n    case NWFILTER_VALUE_TYPE_LAST:\n        break;\n    }\n    VIR_FREE(val);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool isValidVarValue(const char *value);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool isValidVarValue(const char *value);\n\nvoid\nvirNWFilterVarValueFree(virNWFilterVarValuePtr val)\n{\n    size_t i;\n\n    if (!val)\n        return;\n\n    switch (val->valType) {\n    case NWFILTER_VALUE_TYPE_SIMPLE:\n        VIR_FREE(val->u.simple.value);\n        break;\n    case NWFILTER_VALUE_TYPE_ARRAY:\n        for (i = 0; i < val->u.array.nValues; i++)\n            VIR_FREE(val->u.array.values[i]);\n        VIR_FREE(val->u.array.values);\n        break;\n    case NWFILTER_VALUE_TYPE_LAST:\n        break;\n    }\n    VIR_FREE(val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashUpdateEntry",
          "args": [
            "ipAddressMap",
            "ifname",
            "val"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "virHashUpdateEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "422-427",
          "snippet": "int\nvirHashUpdateEntry(virHashTablePtr table, const void *name,\n                   void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, true);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashUpdateEntry(virHashTablePtr table, const void *name,\n                   void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterVarValueCreateSimple",
          "args": [
            "addrCopy"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterVarValueCreateSimpleCopyValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_params.c",
          "lines": "121-132",
          "snippet": "virNWFilterVarValuePtr\nvirNWFilterVarValueCreateSimpleCopyValue(const char *value)\n{\n    char *val;\n    virNWFilterVarValuePtr ret;\n\n    val = g_strdup(value);\n    ret = virNWFilterVarValueCreateSimple(val);\n    if (!ret)\n        VIR_FREE(val);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool isValidVarValue(const char *value);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool isValidVarValue(const char *value);\n\nvirNWFilterVarValuePtr\nvirNWFilterVarValueCreateSimpleCopyValue(const char *value)\n{\n    char *val;\n    virNWFilterVarValuePtr ret;\n\n    val = g_strdup(value);\n    ret = virNWFilterVarValueCreateSimple(val);\n    if (!ret)\n        VIR_FREE(val);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "ipAddressMap",
            "ifname"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&ipAddressMapLock"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "addr"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;\nstatic virHashTablePtr ipAddressMap;\n\nint\nvirNWFilterIPAddrMapAddIPAddr(const char *ifname, char *addr)\n{\n    int ret = -1;\n    char *addrCopy;\n    virNWFilterVarValuePtr val;\n\n    addrCopy = g_strdup(addr);\n\n    virMutexLock(&ipAddressMapLock);\n\n    val = virHashLookup(ipAddressMap, ifname);\n    if (!val) {\n        val = virNWFilterVarValueCreateSimple(addrCopy);\n        if (!val)\n            goto cleanup;\n        addrCopy = NULL;\n        ret = virHashUpdateEntry(ipAddressMap, ifname, val);\n        if (ret < 0)\n            virNWFilterVarValueFree(val);\n        goto cleanup;\n    } else {\n        if (virNWFilterVarValueAddValue(val, addrCopy) < 0)\n            goto cleanup;\n        addrCopy = NULL;\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&ipAddressMapLock);\n    VIR_FREE(addrCopy);\n\n    return ret;\n}"
  }
]