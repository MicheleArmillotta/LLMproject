[
  {
    "function_name": "virPortAllocatorSetUsed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "283-308",
    "snippet": "int\nvirPortAllocatorSetUsed(unsigned short port)\n{\n    int ret = -1;\n    virPortAllocatorPtr pa = virPortAllocatorGet();\n\n    if (!pa)\n        return -1;\n\n    if (!port)\n        return 0;\n\n    virObjectLock(pa);\n\n    if (virBitmapIsBitSet(pa->bitmap, port) ||\n        virBitmapSetBit(pa->bitmap, port) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to reserve port %d\"), port);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(pa);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pa"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to reserve port %d\")",
            "port"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to reserve port %d\""
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapSetBit",
          "args": [
            "pa->bitmap",
            "port"
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapSetBitExpand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "222-231",
          "snippet": "int\nvirBitmapSetBitExpand(virBitmapPtr bitmap,\n                      size_t b)\n{\n    if (bitmap->nbits <= b && virBitmapExpand(bitmap, b) < 0)\n        return -1;\n\n    bitmap->map[VIR_BITMAP_UNIT_OFFSET(b)] |= VIR_BITMAP_BIT(b);\n    return 0;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirBitmapSetBitExpand(virBitmapPtr bitmap,\n                      size_t b)\n{\n    if (bitmap->nbits <= b && virBitmapExpand(bitmap, b) < 0)\n        return -1;\n\n    bitmap->map[VIR_BITMAP_UNIT_OFFSET(b)] |= VIR_BITMAP_BIT(b);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapIsBitSet",
          "args": [
            "pa->bitmap",
            "port"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapIsBitSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "298-306",
          "snippet": "bool\nvirBitmapIsBitSet(virBitmapPtr bitmap,\n                  size_t b)\n{\n    if (bitmap->nbits <= b)\n        return false;\n\n    return virBitmapIsSet(bitmap, b);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nbool\nvirBitmapIsBitSet(virBitmapPtr bitmap,\n                  size_t b)\n{\n    if (bitmap->nbits <= b)\n        return false;\n\n    return virBitmapIsSet(bitmap, b);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pa"
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPortAllocatorGet",
          "args": [],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "virPortAllocatorGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
          "lines": "200-207",
          "snippet": "static virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"virportallocator.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsocket.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virPortAllocatorPtr virPortAllocatorInstance;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virPortAllocatorPtr virPortAllocatorInstance;\n\nstatic virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPortAllocatorSetUsed(unsigned short port)\n{\n    int ret = -1;\n    virPortAllocatorPtr pa = virPortAllocatorGet();\n\n    if (!pa)\n        return -1;\n\n    if (!port)\n        return 0;\n\n    virObjectLock(pa);\n\n    if (virBitmapIsBitSet(pa->bitmap, port) ||\n        virBitmapSetBit(pa->bitmap, port) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to reserve port %d\"), port);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(pa);\n    return ret;\n}"
  },
  {
    "function_name": "virPortAllocatorRelease",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "256-281",
    "snippet": "int\nvirPortAllocatorRelease(unsigned short port)\n{\n    int ret = -1;\n    virPortAllocatorPtr pa = virPortAllocatorGet();\n\n    if (!pa)\n        return -1;\n\n    if (!port)\n        return 0;\n\n    virObjectLock(pa);\n\n    if (virBitmapClearBit(pa->bitmap, port) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to release port %d\"),\n                       port);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(pa);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pa"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to release port %d\")",
            "port"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to release port %d\""
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapClearBit",
          "args": [
            "pa->bitmap",
            "port"
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapClearBitExpand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "265-277",
          "snippet": "int\nvirBitmapClearBitExpand(virBitmapPtr bitmap,\n                        size_t b)\n{\n    if (bitmap->nbits <= b) {\n        if (virBitmapExpand(bitmap, b) < 0)\n            return -1;\n    } else {\n        bitmap->map[VIR_BITMAP_UNIT_OFFSET(b)] &= ~VIR_BITMAP_BIT(b);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirBitmapClearBitExpand(virBitmapPtr bitmap,\n                        size_t b)\n{\n    if (bitmap->nbits <= b) {\n        if (virBitmapExpand(bitmap, b) < 0)\n            return -1;\n    } else {\n        bitmap->map[VIR_BITMAP_UNIT_OFFSET(b)] &= ~VIR_BITMAP_BIT(b);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pa"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPortAllocatorGet",
          "args": [],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "virPortAllocatorGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
          "lines": "200-207",
          "snippet": "static virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"virportallocator.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsocket.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virPortAllocatorPtr virPortAllocatorInstance;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virPortAllocatorPtr virPortAllocatorInstance;\n\nstatic virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPortAllocatorRelease(unsigned short port)\n{\n    int ret = -1;\n    virPortAllocatorPtr pa = virPortAllocatorGet();\n\n    if (!pa)\n        return -1;\n\n    if (!port)\n        return 0;\n\n    virObjectLock(pa);\n\n    if (virBitmapClearBit(pa->bitmap, port) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to release port %d\"),\n                       port);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(pa);\n    return ret;\n}"
  },
  {
    "function_name": "virPortAllocatorAcquire",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "209-254",
    "snippet": "int\nvirPortAllocatorAcquire(const virPortAllocatorRange *range,\n                        unsigned short *port)\n{\n    int ret = -1;\n    size_t i;\n    virPortAllocatorPtr pa = virPortAllocatorGet();\n\n    *port = 0;\n\n    if (!pa)\n        return -1;\n\n    virObjectLock(pa);\n\n    for (i = range->start; i <= range->end && !*port; i++) {\n        bool used = false, v6used = false;\n\n        if (virBitmapIsBitSet(pa->bitmap, i))\n            continue;\n\n        if (virPortAllocatorBindToPort(&v6used, i, AF_INET6) < 0 ||\n            virPortAllocatorBindToPort(&used, i, AF_INET) < 0)\n            goto cleanup;\n\n        if (!used && !v6used) {\n            /* Add port to bitmap of reserved ports */\n            if (virBitmapSetBit(pa->bitmap, i) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to reserve port %zu\"), i);\n                goto cleanup;\n            }\n            *port = i;\n            ret = 0;\n        }\n    }\n\n    if (*port == 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to find an unused port in range '%s' (%d-%d)\"),\n                       range->name, range->start, range->end);\n    }\n cleanup:\n    virObjectUnlock(pa);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pa"
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unable to find an unused port in range '%s' (%d-%d)\")",
            "range->name",
            "range->start",
            "range->end"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to find an unused port in range '%s' (%d-%d)\""
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to reserve port %zu\")",
            "i"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBitmapSetBit",
          "args": [
            "pa->bitmap",
            "i"
          ],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapSetBitExpand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "222-231",
          "snippet": "int\nvirBitmapSetBitExpand(virBitmapPtr bitmap,\n                      size_t b)\n{\n    if (bitmap->nbits <= b && virBitmapExpand(bitmap, b) < 0)\n        return -1;\n\n    bitmap->map[VIR_BITMAP_UNIT_OFFSET(b)] |= VIR_BITMAP_BIT(b);\n    return 0;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirBitmapSetBitExpand(virBitmapPtr bitmap,\n                      size_t b)\n{\n    if (bitmap->nbits <= b && virBitmapExpand(bitmap, b) < 0)\n        return -1;\n\n    bitmap->map[VIR_BITMAP_UNIT_OFFSET(b)] |= VIR_BITMAP_BIT(b);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPortAllocatorBindToPort",
          "args": [
            "&used",
            "i",
            "AF_INET"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "virPortAllocatorBindToPort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
          "lines": "129-198",
          "snippet": "static int\nvirPortAllocatorBindToPort(bool *used,\n                           unsigned short port,\n                           int family)\n{\n    struct sockaddr_in6 addr6 = {\n        .sin6_family = AF_INET6,\n        .sin6_port = htons(port),\n        .sin6_addr = in6addr_any\n    };\n    struct sockaddr_in addr4 = {\n        .sin_family = AF_INET,\n        .sin_port = htons(port),\n        .sin_addr.s_addr = htonl(INADDR_ANY)\n    };\n    struct sockaddr* addr;\n    size_t addrlen;\n    int v6only = 1;\n    int ret = -1;\n    int fd = -1;\n    bool ipv6 = false;\n\n    if (family == AF_INET6) {\n        addr = (struct sockaddr*)&addr6;\n        addrlen = sizeof(addr6);\n        ipv6 = true;\n    } else if (family == AF_INET) {\n        addr = (struct sockaddr*)&addr4;\n        addrlen = sizeof(addr4);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Unknown family %d\"), family);\n        return -1;\n    }\n\n    *used = false;\n\n    fd = socket(family, SOCK_STREAM, 0);\n    if (fd < 0) {\n        if (errno == EAFNOSUPPORT)\n            return 0;\n        virReportSystemError(errno, \"%s\", _(\"Unable to open test socket\"));\n        goto cleanup;\n    }\n\n    if (virSetSockReuseAddr(fd, true) < 0)\n        goto cleanup;\n\n    if (ipv6 && setsockopt(fd, IPPROTO_IPV6, IPV6_V6ONLY, (void*)&v6only,\n                           sizeof(v6only)) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set IPV6_V6ONLY flag\"));\n        goto cleanup;\n    }\n\n    if (bind(fd, addr, addrlen) < 0) {\n        if (errno == EADDRINUSE) {\n            *used = true;\n            ret = 0;\n        } else {\n            virReportSystemError(errno, _(\"Unable to bind to port %d\"), port);\n        }\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    if (fd != -1)\n        closesocket(fd);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"virportallocator.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsocket.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirPortAllocatorBindToPort(bool *used,\n                           unsigned short port,\n                           int family)\n{\n    struct sockaddr_in6 addr6 = {\n        .sin6_family = AF_INET6,\n        .sin6_port = htons(port),\n        .sin6_addr = in6addr_any\n    };\n    struct sockaddr_in addr4 = {\n        .sin_family = AF_INET,\n        .sin_port = htons(port),\n        .sin_addr.s_addr = htonl(INADDR_ANY)\n    };\n    struct sockaddr* addr;\n    size_t addrlen;\n    int v6only = 1;\n    int ret = -1;\n    int fd = -1;\n    bool ipv6 = false;\n\n    if (family == AF_INET6) {\n        addr = (struct sockaddr*)&addr6;\n        addrlen = sizeof(addr6);\n        ipv6 = true;\n    } else if (family == AF_INET) {\n        addr = (struct sockaddr*)&addr4;\n        addrlen = sizeof(addr4);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Unknown family %d\"), family);\n        return -1;\n    }\n\n    *used = false;\n\n    fd = socket(family, SOCK_STREAM, 0);\n    if (fd < 0) {\n        if (errno == EAFNOSUPPORT)\n            return 0;\n        virReportSystemError(errno, \"%s\", _(\"Unable to open test socket\"));\n        goto cleanup;\n    }\n\n    if (virSetSockReuseAddr(fd, true) < 0)\n        goto cleanup;\n\n    if (ipv6 && setsockopt(fd, IPPROTO_IPV6, IPV6_V6ONLY, (void*)&v6only,\n                           sizeof(v6only)) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set IPV6_V6ONLY flag\"));\n        goto cleanup;\n    }\n\n    if (bind(fd, addr, addrlen) < 0) {\n        if (errno == EADDRINUSE) {\n            *used = true;\n            ret = 0;\n        } else {\n            virReportSystemError(errno, _(\"Unable to bind to port %d\"), port);\n        }\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    if (fd != -1)\n        closesocket(fd);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapIsBitSet",
          "args": [
            "pa->bitmap",
            "i"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapIsBitSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "298-306",
          "snippet": "bool\nvirBitmapIsBitSet(virBitmapPtr bitmap,\n                  size_t b)\n{\n    if (bitmap->nbits <= b)\n        return false;\n\n    return virBitmapIsSet(bitmap, b);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nbool\nvirBitmapIsBitSet(virBitmapPtr bitmap,\n                  size_t b)\n{\n    if (bitmap->nbits <= b)\n        return false;\n\n    return virBitmapIsSet(bitmap, b);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pa"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPortAllocatorGet",
          "args": [],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "virPortAllocatorGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
          "lines": "200-207",
          "snippet": "static virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"virportallocator.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsocket.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virPortAllocatorPtr virPortAllocatorInstance;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virPortAllocatorPtr virPortAllocatorInstance;\n\nstatic virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPortAllocatorAcquire(const virPortAllocatorRange *range,\n                        unsigned short *port)\n{\n    int ret = -1;\n    size_t i;\n    virPortAllocatorPtr pa = virPortAllocatorGet();\n\n    *port = 0;\n\n    if (!pa)\n        return -1;\n\n    virObjectLock(pa);\n\n    for (i = range->start; i <= range->end && !*port; i++) {\n        bool used = false, v6used = false;\n\n        if (virBitmapIsBitSet(pa->bitmap, i))\n            continue;\n\n        if (virPortAllocatorBindToPort(&v6used, i, AF_INET6) < 0 ||\n            virPortAllocatorBindToPort(&used, i, AF_INET) < 0)\n            goto cleanup;\n\n        if (!used && !v6used) {\n            /* Add port to bitmap of reserved ports */\n            if (virBitmapSetBit(pa->bitmap, i) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to reserve port %zu\"), i);\n                goto cleanup;\n            }\n            *port = i;\n            ret = 0;\n        }\n    }\n\n    if (*port == 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to find an unused port in range '%s' (%d-%d)\"),\n                       range->name, range->start, range->end);\n    }\n cleanup:\n    virObjectUnlock(pa);\n    return ret;\n}"
  },
  {
    "function_name": "virPortAllocatorGet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "200-207",
    "snippet": "static virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virPortAllocatorPtr virPortAllocatorInstance;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virPortAllocatorInitialize",
          "args": [],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virPortAllocatorPtr virPortAllocatorInstance;\n\nstatic virPortAllocatorPtr\nvirPortAllocatorGet(void)\n{\n    if (virPortAllocatorInitialize() < 0)\n        return NULL;\n\n    return virPortAllocatorInstance;\n}"
  },
  {
    "function_name": "virPortAllocatorBindToPort",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "129-198",
    "snippet": "static int\nvirPortAllocatorBindToPort(bool *used,\n                           unsigned short port,\n                           int family)\n{\n    struct sockaddr_in6 addr6 = {\n        .sin6_family = AF_INET6,\n        .sin6_port = htons(port),\n        .sin6_addr = in6addr_any\n    };\n    struct sockaddr_in addr4 = {\n        .sin_family = AF_INET,\n        .sin_port = htons(port),\n        .sin_addr.s_addr = htonl(INADDR_ANY)\n    };\n    struct sockaddr* addr;\n    size_t addrlen;\n    int v6only = 1;\n    int ret = -1;\n    int fd = -1;\n    bool ipv6 = false;\n\n    if (family == AF_INET6) {\n        addr = (struct sockaddr*)&addr6;\n        addrlen = sizeof(addr6);\n        ipv6 = true;\n    } else if (family == AF_INET) {\n        addr = (struct sockaddr*)&addr4;\n        addrlen = sizeof(addr4);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Unknown family %d\"), family);\n        return -1;\n    }\n\n    *used = false;\n\n    fd = socket(family, SOCK_STREAM, 0);\n    if (fd < 0) {\n        if (errno == EAFNOSUPPORT)\n            return 0;\n        virReportSystemError(errno, \"%s\", _(\"Unable to open test socket\"));\n        goto cleanup;\n    }\n\n    if (virSetSockReuseAddr(fd, true) < 0)\n        goto cleanup;\n\n    if (ipv6 && setsockopt(fd, IPPROTO_IPV6, IPV6_V6ONLY, (void*)&v6only,\n                           sizeof(v6only)) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set IPV6_V6ONLY flag\"));\n        goto cleanup;\n    }\n\n    if (bind(fd, addr, addrlen) < 0) {\n        if (errno == EADDRINUSE) {\n            *used = true;\n            ret = 0;\n        } else {\n            virReportSystemError(errno, _(\"Unable to bind to port %d\"), port);\n        }\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    if (fd != -1)\n        closesocket(fd);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "closesocket",
          "args": [
            "fd"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "vir_closesocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "197-213",
          "snippet": "int\nvir_closesocket(int fd)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (closesocket(sk) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_closesocket(int fd)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (closesocket(sk) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to bind to port %d\")",
            "port"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to bind to port %d\""
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bind",
          "args": [
            "fd",
            "addr",
            "addrlen"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "vir_bind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "178-194",
          "snippet": "int\nvir_bind(int fd, const struct sockaddr *addr, socklen_t addrlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (bind(sk, addr, addrlen) < 0)  {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_bind(int fd, const struct sockaddr *addr, socklen_t addrlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (bind(sk, addr, addrlen) < 0)  {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to set IPV6_V6ONLY flag\")"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "fd",
            "IPPROTO_IPV6",
            "IPV6_V6ONLY",
            "(void*)&v6only",
            "sizeof(v6only)"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "vir_setsockopt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "331-348",
          "snippet": "int\nvir_setsockopt(int fd, int level, int optname,\n               const void *optval, socklen_t optlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (setsockopt(sk, level, optname, optval, optlen) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_setsockopt(int fd, int level, int optname,\n               const void *optval, socklen_t optlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (setsockopt(sk, level, optname, optval, optlen) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetSockReuseAddr",
          "args": [
            "fd",
            "true"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "virSetSockReuseAddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "152-163",
          "snippet": "int virSetSockReuseAddr(int fd, bool fatal)\n{\n    int opt = 1;\n    int ret = setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n\n    if (ret < 0 && fatal) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set socket reuse addr flag\"));\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetSockReuseAddr(int fd, bool fatal)\n{\n    int opt = 1;\n    int ret = setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n\n    if (ret < 0 && fatal) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set socket reuse addr flag\"));\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to open test socket\")"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "family",
            "SOCK_STREAM",
            "0"
          ],
          "line": 165
        },
        "resolved": true,
        "details": {
          "function_name": "vir_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "351-367",
          "snippet": "int\nvir_socket(int domain, int type, int protocol)\n{\n    SOCKET sk;\n\n    /* We have to use WSASocket() instead of socket(), to create\n     * non-overlapped IO sockets. Overlapped IO sockets cannot\n     * be used with read/write.\n     */\n    sk = WSASocket(domain, type, protocol, NULL, 0, 0);\n    if (sk == INVALID_SOCKET) {\n        set_errno();\n        return -1;\n    }\n\n    return SK2FD(sk);\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_socket(int domain, int type, int protocol)\n{\n    SOCKET sk;\n\n    /* We have to use WSASocket() instead of socket(), to create\n     * non-overlapped IO sockets. Overlapped IO sockets cannot\n     * be used with read/write.\n     */\n    sk = WSASocket(domain, type, protocol, NULL, 0, 0);\n    if (sk == INVALID_SOCKET) {\n        set_errno();\n        return -1;\n    }\n\n    return SK2FD(sk);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unknown family %d\")",
            "family"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htonl",
          "args": [
            "INADDR_ANY"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "port"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "port"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirPortAllocatorBindToPort(bool *used,\n                           unsigned short port,\n                           int family)\n{\n    struct sockaddr_in6 addr6 = {\n        .sin6_family = AF_INET6,\n        .sin6_port = htons(port),\n        .sin6_addr = in6addr_any\n    };\n    struct sockaddr_in addr4 = {\n        .sin_family = AF_INET,\n        .sin_port = htons(port),\n        .sin_addr.s_addr = htonl(INADDR_ANY)\n    };\n    struct sockaddr* addr;\n    size_t addrlen;\n    int v6only = 1;\n    int ret = -1;\n    int fd = -1;\n    bool ipv6 = false;\n\n    if (family == AF_INET6) {\n        addr = (struct sockaddr*)&addr6;\n        addrlen = sizeof(addr6);\n        ipv6 = true;\n    } else if (family == AF_INET) {\n        addr = (struct sockaddr*)&addr4;\n        addrlen = sizeof(addr4);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Unknown family %d\"), family);\n        return -1;\n    }\n\n    *used = false;\n\n    fd = socket(family, SOCK_STREAM, 0);\n    if (fd < 0) {\n        if (errno == EAFNOSUPPORT)\n            return 0;\n        virReportSystemError(errno, \"%s\", _(\"Unable to open test socket\"));\n        goto cleanup;\n    }\n\n    if (virSetSockReuseAddr(fd, true) < 0)\n        goto cleanup;\n\n    if (ipv6 && setsockopt(fd, IPPROTO_IPV6, IPV6_V6ONLY, (void*)&v6only,\n                           sizeof(v6only)) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set IPV6_V6ONLY flag\"));\n        goto cleanup;\n    }\n\n    if (bind(fd, addr, addrlen) < 0) {\n        if (errno == EADDRINUSE) {\n            *used = true;\n            ret = 0;\n        } else {\n            virReportSystemError(errno, _(\"Unable to bind to port %d\"), port);\n        }\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    if (fd != -1)\n        closesocket(fd);\n    return ret;\n}"
  },
  {
    "function_name": "virPortAllocatorRangeFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "119-127",
    "snippet": "void\nvirPortAllocatorRangeFree(virPortAllocatorRangePtr range)\n{\n    if (!range)\n        return;\n\n    VIR_FREE(range->name);\n    VIR_FREE(range);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "range"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "range->name"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirPortAllocatorRangeFree(virPortAllocatorRangePtr range)\n{\n    if (!range)\n        return;\n\n    VIR_FREE(range->name);\n    VIR_FREE(range);\n}"
  },
  {
    "function_name": "virPortAllocatorRangeNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "96-117",
    "snippet": "virPortAllocatorRangePtr\nvirPortAllocatorRangeNew(const char *name,\n                         unsigned short start,\n                         unsigned short end)\n{\n    virPortAllocatorRangePtr range;\n\n    if (start >= end) {\n        virReportInvalidArg(start, \"start port %d must be less than end port %d\",\n                            start, end);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(range) < 0)\n        return NULL;\n\n    range->start = start;\n    range->end = end;\n    range->name = g_strdup(name);\n\n    return range;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "name"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "range"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportInvalidArg",
          "args": [
            "start",
            "\"start port %d must be less than end port %d\"",
            "start",
            "end"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirPortAllocatorRangePtr\nvirPortAllocatorRangeNew(const char *name,\n                         unsigned short start,\n                         unsigned short end)\n{\n    virPortAllocatorRangePtr range;\n\n    if (start >= end) {\n        virReportInvalidArg(start, \"start port %d must be less than end port %d\",\n                            start, end);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(range) < 0)\n        return NULL;\n\n    range->start = start;\n    range->end = end;\n    range->name = g_strdup(name);\n\n    return range;\n}"
  },
  {
    "function_name": "virPortAllocatorOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "82-92",
    "snippet": "static int\nvirPortAllocatorOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virPortAllocator, virClassForObjectLockable()))\n        return -1;\n\n    if (!(virPortAllocatorInstance = virPortAllocatorNew()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virPortAllocatorPtr virPortAllocatorInstance;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virPortAllocatorNew",
          "args": [],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "virPortAllocatorNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
          "lines": "65-80",
          "snippet": "static virPortAllocatorPtr\nvirPortAllocatorNew(void)\n{\n    virPortAllocatorPtr pa;\n\n    if (!(pa = virObjectLockableNew(virPortAllocatorClass)))\n        return NULL;\n\n    if (!(pa->bitmap = virBitmapNew(VIR_PORT_ALLOCATOR_NUM_PORTS)))\n        goto error;\n\n    return pa;\n error:\n    virObjectUnref(pa);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"virportallocator.h\"",
            "#include \"virbitmap.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsocket.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_PORT_ALLOCATOR_NUM_PORTS 65536"
          ],
          "globals_used": [
            "static virClassPtr virPortAllocatorClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\n#define VIR_PORT_ALLOCATOR_NUM_PORTS 65536\n\nstatic virClassPtr virPortAllocatorClass;\n\nstatic virPortAllocatorPtr\nvirPortAllocatorNew(void)\n{\n    virPortAllocatorPtr pa;\n\n    if (!(pa = virObjectLockableNew(virPortAllocatorClass)))\n        return NULL;\n\n    if (!(pa->bitmap = virBitmapNew(VIR_PORT_ALLOCATOR_NUM_PORTS)))\n        goto error;\n\n    return pa;\n error:\n    virObjectUnref(pa);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virPortAllocator",
            "virClassForObjectLockable()"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virPortAllocatorPtr virPortAllocatorInstance;\n\nstatic int\nvirPortAllocatorOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virPortAllocator, virClassForObjectLockable()))\n        return -1;\n\n    if (!(virPortAllocatorInstance = virPortAllocatorNew()))\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virPortAllocatorNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "65-80",
    "snippet": "static virPortAllocatorPtr\nvirPortAllocatorNew(void)\n{\n    virPortAllocatorPtr pa;\n\n    if (!(pa = virObjectLockableNew(virPortAllocatorClass)))\n        return NULL;\n\n    if (!(pa->bitmap = virBitmapNew(VIR_PORT_ALLOCATOR_NUM_PORTS)))\n        goto error;\n\n    return pa;\n error:\n    virObjectUnref(pa);\n    return NULL;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_PORT_ALLOCATOR_NUM_PORTS 65536"
    ],
    "globals_used": [
      "static virClassPtr virPortAllocatorClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "pa"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBitmapNew",
          "args": [
            "VIR_PORT_ALLOCATOR_NUM_PORTS"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapNewString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "1144-1168",
          "snippet": "virBitmapPtr\nvirBitmapNewString(const char *string)\n{\n    virBitmapPtr bitmap;\n    size_t i = 0;\n    size_t len = strlen(string);\n\n    if (strspn(string, \"0123456789abcdefABCDEF\") != len) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Invalid hexadecimal string '%s'\"), string);\n        return NULL;\n    }\n\n    bitmap = virBitmapNew(len * 4);\n    if (!bitmap)\n        return NULL;\n\n    for (i = 0; i < len; i++) {\n        unsigned long nibble = g_ascii_xdigit_value(string[len - i - 1]);\n        nibble <<= VIR_BITMAP_BIT_OFFSET(i * 4);\n        bitmap->map[VIR_BITMAP_UNIT_OFFSET(i * 4)] |= nibble;\n    }\n\n    return bitmap;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirBitmapPtr\nvirBitmapNewString(const char *string)\n{\n    virBitmapPtr bitmap;\n    size_t i = 0;\n    size_t len = strlen(string);\n\n    if (strspn(string, \"0123456789abcdefABCDEF\") != len) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Invalid hexadecimal string '%s'\"), string);\n        return NULL;\n    }\n\n    bitmap = virBitmapNew(len * 4);\n    if (!bitmap)\n        return NULL;\n\n    for (i = 0; i < len; i++) {\n        unsigned long nibble = g_ascii_xdigit_value(string[len - i - 1]);\n        nibble <<= VIR_BITMAP_BIT_OFFSET(i * 4);\n        bitmap->map[VIR_BITMAP_UNIT_OFFSET(i * 4)] |= nibble;\n    }\n\n    return bitmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "virPortAllocatorClass"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\n#define VIR_PORT_ALLOCATOR_NUM_PORTS 65536\n\nstatic virClassPtr virPortAllocatorClass;\n\nstatic virPortAllocatorPtr\nvirPortAllocatorNew(void)\n{\n    virPortAllocatorPtr pa;\n\n    if (!(pa = virObjectLockableNew(virPortAllocatorClass)))\n        return NULL;\n\n    if (!(pa->bitmap = virBitmapNew(VIR_PORT_ALLOCATOR_NUM_PORTS)))\n        goto error;\n\n    return pa;\n error:\n    virObjectUnref(pa);\n    return NULL;\n}"
  },
  {
    "function_name": "virPortAllocatorDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virportallocator.c",
    "lines": "57-63",
    "snippet": "static void\nvirPortAllocatorDispose(void *obj)\n{\n    virPortAllocatorPtr pa = obj;\n\n    virBitmapFree(pa->bitmap);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"virportallocator.h\"",
      "#include \"virbitmap.h\"",
      "#include \"viralloc.h\"",
      "#include \"virsocket.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBitmapFree",
          "args": [
            "pa->bitmap"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "virBitmapFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbitmap.c",
          "lines": "128-135",
          "snippet": "void\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbitmap.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virbitmap.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirBitmapFree(virBitmapPtr bitmap)\n{\n    if (bitmap) {\n        VIR_FREE(bitmap->map);\n        VIR_FREE(bitmap);\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"virportallocator.h\"\n#include \"virbitmap.h\"\n#include \"viralloc.h\"\n#include \"virsocket.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirPortAllocatorDispose(void *obj)\n{\n    virPortAllocatorPtr pa = obj;\n\n    virBitmapFree(pa->bitmap);\n}"
  }
]