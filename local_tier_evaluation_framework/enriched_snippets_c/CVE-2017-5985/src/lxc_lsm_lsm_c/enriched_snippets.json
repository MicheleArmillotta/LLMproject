[
  {
    "function_name": "lsm_process_label_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/lsm.c",
    "lines": "88-96",
    "snippet": "int lsm_process_label_set(const char *label, struct lxc_conf *conf,\n\t\tint use_default, int on_exec)\n{\n\tif (!drv) {\n\t\tERROR(\"LSM driver not inited\");\n\t\treturn -1;\n\t}\n\treturn drv->process_label_set(label, conf, use_default, on_exec);\n}",
    "includes": [
      "#include \"lsm/lsm.h\"",
      "#include \"log.h\"",
      "#include \"conf.h\"",
      "#include <sys/param.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "drv->process_label_set",
          "args": [
            "label",
            "conf",
            "use_default",
            "on_exec"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"LSM driver not inited\""
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include \"conf.h\"\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n\nint lsm_process_label_set(const char *label, struct lxc_conf *conf,\n\t\tint use_default, int on_exec)\n{\n\tif (!drv) {\n\t\tERROR(\"LSM driver not inited\");\n\t\treturn -1;\n\t}\n\treturn drv->process_label_set(label, conf, use_default, on_exec);\n}"
  },
  {
    "function_name": "lsm_process_label_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/lsm.c",
    "lines": "79-86",
    "snippet": "char *lsm_process_label_get(pid_t pid)\n{\n\tif (!drv) {\n\t\tERROR(\"LSM driver not inited\");\n\t\treturn NULL;\n\t}\n\treturn drv->process_label_get(pid);\n}",
    "includes": [
      "#include \"lsm/lsm.h\"",
      "#include \"log.h\"",
      "#include \"conf.h\"",
      "#include <sys/param.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "drv->process_label_get",
          "args": [
            "pid"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"LSM driver not inited\""
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include \"conf.h\"\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n\nchar *lsm_process_label_get(pid_t pid)\n{\n\tif (!drv) {\n\t\tERROR(\"LSM driver not inited\");\n\t\treturn NULL;\n\t}\n\treturn drv->process_label_get(pid);\n}"
  },
  {
    "function_name": "lsm_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/lsm.c",
    "lines": "72-77",
    "snippet": "const char *lsm_name(void)\n{\n\tif (drv)\n\t\treturn drv->name;\n\treturn \"none\";\n}",
    "includes": [
      "#include \"lsm/lsm.h\"",
      "#include \"log.h\"",
      "#include \"conf.h\"",
      "#include <sys/param.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include \"conf.h\"\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n\nconst char *lsm_name(void)\n{\n\tif (drv)\n\t\treturn drv->name;\n\treturn \"none\";\n}"
  },
  {
    "function_name": "lsm_enabled",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/lsm.c",
    "lines": "65-70",
    "snippet": "int lsm_enabled(void)\n{\n\tif (drv)\n\t\treturn drv->enabled();\n\treturn 0;\n}",
    "includes": [
      "#include \"lsm/lsm.h\"",
      "#include \"log.h\"",
      "#include \"conf.h\"",
      "#include <sys/param.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "drv->enabled",
          "args": [],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include \"conf.h\"\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n\nint lsm_enabled(void)\n{\n\tif (drv)\n\t\treturn drv->enabled();\n\treturn 0;\n}"
  },
  {
    "function_name": "lsm_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/lsm.c",
    "lines": "44-63",
    "snippet": "__attribute__((constructor))\nvoid lsm_init(void)\n{\n\tif (drv) {\n\t\tINFO(\"LSM security driver %s\", drv->name);\n\t\treturn;\n\t}\n\n\t#if HAVE_APPARMOR\n\tdrv = lsm_apparmor_drv_init();\n\t#endif\n\t#if HAVE_SELINUX\n\tif (!drv)\n\t\tdrv = lsm_selinux_drv_init();\n\t#endif\n\n\tif (!drv)\n\t\tdrv = lsm_nop_drv_init();\n\tINFO(\"Initialized LSM security driver %s\", drv->name);\n}",
    "includes": [
      "#include \"lsm/lsm.h\"",
      "#include \"log.h\"",
      "#include \"conf.h\"",
      "#include <sys/param.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "INFO",
          "args": [
            "\"Initialized LSM security driver %s\"",
            "drv->name"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lsm_nop_drv_init",
          "args": [],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "lsm_nop_drv_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/nop.c",
          "lines": "50-53",
          "snippet": "struct lsm_drv *lsm_nop_drv_init(void)\n{\n\treturn &nop_drv;\n}",
          "includes": [
            "#include \"lsm/lsm.h\"",
            "#include <stdlib.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct lsm_drv nop_drv = {\n\t.name = \"nop\",\n\t.enabled           = nop_enabled,\n\t.process_label_get = nop_process_label_get,\n\t.process_label_set = nop_process_label_set,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"lsm/lsm.h\"\n#include <stdlib.h>\n\nstatic struct lsm_drv nop_drv = {\n\t.name = \"nop\",\n\t.enabled           = nop_enabled,\n\t.process_label_get = nop_process_label_get,\n\t.process_label_set = nop_process_label_set,\n};\n\nstruct lsm_drv *lsm_nop_drv_init(void)\n{\n\treturn &nop_drv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lsm_selinux_drv_init",
          "args": [],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "lsm_selinux_drv_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/selinux.c",
          "lines": "110-115",
          "snippet": "struct lsm_drv *lsm_selinux_drv_init(void)\n{\n\tif (!is_selinux_enabled())\n\t\treturn NULL;\n\treturn &selinux_drv;\n}",
          "includes": [
            "#include \"conf.h\"",
            "#include \"lsm/lsm.h\"",
            "#include \"log.h\"",
            "#include <selinux/selinux.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct lsm_drv selinux_drv = {\n\t.name = \"SELinux\",\n\t.enabled           = is_selinux_enabled,\n\t.process_label_get = selinux_process_label_get,\n\t.process_label_set = selinux_process_label_set,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"conf.h\"\n#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include <selinux/selinux.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <stdlib.h>\n#include <errno.h>\n\nstatic struct lsm_drv selinux_drv = {\n\t.name = \"SELinux\",\n\t.enabled           = is_selinux_enabled,\n\t.process_label_get = selinux_process_label_get,\n\t.process_label_set = selinux_process_label_set,\n};\n\nstruct lsm_drv *lsm_selinux_drv_init(void)\n{\n\tif (!is_selinux_enabled())\n\t\treturn NULL;\n\treturn &selinux_drv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lsm_apparmor_drv_init",
          "args": [],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "lsm_apparmor_drv_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lsm/apparmor.c",
          "lines": "249-255",
          "snippet": "struct lsm_drv *lsm_apparmor_drv_init(void)\n{\n\tif (!apparmor_enabled())\n\t\treturn NULL;\n\taa_enabled = 1;\n\treturn &apparmor_drv;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"conf.h\"",
            "#include \"lsm/lsm.h\"",
            "#include \"log.h\"",
            "#include <sys/vfs.h>",
            "#include <sys/apparmor.h>",
            "#include <sys/mount.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int aa_enabled = 0;",
            "static struct lsm_drv apparmor_drv = {\n\t.name = \"AppArmor\",\n\t.enabled           = apparmor_enabled,\n\t.process_label_get = apparmor_process_label_get,\n\t.process_label_set = apparmor_process_label_set,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"conf.h\"\n#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include <sys/vfs.h>\n#include <sys/apparmor.h>\n#include <sys/mount.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic int aa_enabled = 0;\nstatic struct lsm_drv apparmor_drv = {\n\t.name = \"AppArmor\",\n\t.enabled           = apparmor_enabled,\n\t.process_label_get = apparmor_process_label_get,\n\t.process_label_set = apparmor_process_label_set,\n};\n\nstruct lsm_drv *lsm_apparmor_drv_init(void)\n{\n\tif (!apparmor_enabled())\n\t\treturn NULL;\n\taa_enabled = 1;\n\treturn &apparmor_drv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "INFO",
          "args": [
            "\"LSM security driver %s\"",
            "drv->name"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lsm/lsm.h\"\n#include \"log.h\"\n#include \"conf.h\"\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <errno.h>\n\n__attribute__((constructor))\nvoid lsm_init(void)\n{\n\tif (drv) {\n\t\tINFO(\"LSM security driver %s\", drv->name);\n\t\treturn;\n\t}\n\n\t#if HAVE_APPARMOR\n\tdrv = lsm_apparmor_drv_init();\n\t#endif\n\t#if HAVE_SELINUX\n\tif (!drv)\n\t\tdrv = lsm_selinux_drv_init();\n\t#endif\n\n\tif (!drv)\n\t\tdrv = lsm_nop_drv_init();\n\tINFO(\"Initialized LSM security driver %s\", drv->name);\n}"
  }
]