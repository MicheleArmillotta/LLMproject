[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "455-559",
    "snippet": "int main(int argc, char *argv[])\n{\n\tstruct lxc_epoll_descr descr;\n\tint ret, ct_print_cnt;\n\tchar in_char;\n\n\tret = EXIT_FAILURE;\n\tif (lxc_arguments_parse(&my_args, argc, argv))\n\t\tgoto out;\n\n\tct_print_cnt = stdin_tios_rows() - 3; /* 3 -> header and total */\n\tif (stdin_tios_setup() < 0) {\n\t\tERROR(\"failed to setup terminal\");\n\t\tgoto out;\n\t}\n\n\t/* ensure the terminal gets restored */\n\tatexit(stdin_tios_restore);\n\tsignal(SIGINT, sig_handler);\n\tsignal(SIGQUIT, sig_handler);\n\n\tif (lxc_mainloop_open(&descr)) {\n\t\tERROR(\"failed to create mainloop\");\n\t\tgoto out;\n\t}\n\n\tret = lxc_mainloop_add_handler(&descr, 0, stdin_handler, &in_char);\n\tif (ret) {\n\t\tERROR(\"failed to add stdin handler\");\n\t\tret = EXIT_FAILURE;\n\t\tgoto err1;\n\t}\n\n\tif (batch && !delay_set) {\n\t\tdelay = 300;\n\t}\n        if (batch) {\n\t\tprintf(\"time_ms,container,cpu_nanos,cpu_sys_userhz,cpu_user_userhz,blkio_bytes,blkio_iops,mem_used_bytes,kernel_mem_used_bytes\\n\");\n\t}\n\n\tfor(;;) {\n\t\tstruct lxc_container **active;\n\t\tint i, active_cnt;\n\t\tstruct stats total;\n\t\tchar total_name[30];\n\n\t\tactive_cnt = list_active_containers(my_args.lxcpath[0], NULL, &active);\n\t\tct_realloc(active_cnt);\n\n\t\tmemset(&total, 0, sizeof(total));\n\t\tfor (i = 0; i < active_cnt; i++)\n\t\t\tstats_get(active[i], &ct[i], &total);\n\n\t\tct_sort(active_cnt);\n\n\t\tif (!batch) {\n\t\t  printf(TERMCLEAR);\n\t\t  stats_print_header(&total);\n\t\t}\n\t\tfor (i = 0; i < active_cnt && i < ct_print_cnt; i++) {\n\t\t\tstats_print(ct[i].c->name, ct[i].stats, &total);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\t\tif (!batch) {\n\t\t\tsprintf(total_name, \"TOTAL %d of %d\", i, active_cnt);\n\t\t\tstats_print(total_name, &total, &total);\n\t\t}\n\t\tfflush(stdout);\n\n\t\tfor (i = 0; i < active_cnt; i++) {\n\t\t\tlxc_container_put(ct[i].c);\n\t\t\tct[i].c = NULL;\n\t\t}\n\n\t\tin_char = '\\0';\n\t\tif (!batch) {\n\t\t\tret = lxc_mainloop(&descr, 1000 * delay);\n\t\t\tif (ret != 0 || in_char == 'q')\n\t\t\t\tbreak;\n\t\t\tswitch(in_char) {\n\t\t\tcase 'r':\n\t\t\t\tsort_reverse ^= 1;\n\t\t\t\tbreak;\n\t\t\tcase 'n':\n\t\t\tcase 'c':\n\t\t\tcase 'b':\n\t\t\tcase 'm':\n\t\t\tcase 'k':\n\t\t\t\tif (sort_by == in_char)\n\t\t\t\t\tsort_reverse ^= 1;\n\t\t\t\telse\n\t\t\t\t\tsort_reverse = 0;\n\t\t\t\tsort_by = in_char;\n\t\t\t}\n\t\t} else {\n\t\t\tsleep(delay);\n\t\t}\n\t}\n\tret = EXIT_SUCCESS;\n\nerr1:\n\tlxc_mainloop_close(&descr);\nout:\n\texit(EXIT_FAILURE);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define TERMCLEAR ESC \"[H\" ESC \"[J\""
    ],
    "globals_used": [
      "static int batch = 0;",
      "static int delay_set = 0;",
      "static int delay = 3;",
      "static char sort_by = 'n';",
      "static int sort_reverse = 0;",
      "static struct ct *ct = NULL;",
      "static struct lxc_arguments my_args = {\n\t.progname = \"lxc-top\",\n\t.help     = \"\\\n\\n\\\n\\n\\\nlxc-top monitors the state of the active containers\\n\\\n\\n\\\nOptions :\\n\\\n  -d, --delay     delay in seconds between refreshes (default: 3.0)\\n\\\n  -b, --batch     output designed to capture to a file\\n\\\n  -s, --sort      sort by [n,c,b,m] (default: n) where\\n\\\n                  n = Name\\n\\\n                  c = CPU use\\n\\\n                  b = Block I/O use\\n\\\n                  m = Memory use\\n\\\n                  k = Kernel memory use\\n\\\n  -r, --reverse   sort in reverse (descending) order\\n\",\n\t.name     = \".*\",\n\t.options  = my_longopts,\n\t.parser   = my_parser,\n\t.checker  = NULL,\n\t.lxcpath_additional = -1,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 558
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_mainloop_close",
          "args": [
            "&descr"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_mainloop_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/mainloop.c",
          "lines": "148-163",
          "snippet": "int lxc_mainloop_close(struct lxc_epoll_descr *descr)\n{\n\tstruct lxc_list *iterator, *next;\n\n\titerator = descr->handlers.next;\n\twhile (iterator != &descr->handlers) {\n\t\tnext = iterator->next;\n\n\t\tlxc_list_del(iterator);\n\t\tfree(iterator->elem);\n\t\tfree(iterator);\n\t\titerator = next;\n\t}\n\n\treturn close(descr->epfd);\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n\nint lxc_mainloop_close(struct lxc_epoll_descr *descr)\n{\n\tstruct lxc_list *iterator, *next;\n\n\titerator = descr->handlers.next;\n\twhile (iterator != &descr->handlers) {\n\t\tnext = iterator->next;\n\n\t\tlxc_list_del(iterator);\n\t\tfree(iterator->elem);\n\t\tfree(iterator);\n\t\titerator = next;\n\t}\n\n\treturn close(descr->epfd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "delay"
          ],
          "line": 550
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_util_usleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lua-lxc/core.c",
          "lines": "564-567",
          "snippet": "static int lxc_util_usleep(lua_State *L) {\n    usleep((useconds_t)luaL_checkunsigned(L, 1));\n    return 0;\n}",
          "includes": [
            "#include \"lxc/commands.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <libgen.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <assert.h>",
            "#include <lauxlib.h>",
            "#include <lua.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"lxc/commands.h\"\n#include <lxc/lxccontainer.h>\n#include <libgen.h>\n#include <unistd.h>\n#include <string.h>\n#include <assert.h>\n#include <lauxlib.h>\n#include <lua.h>\n\nstatic int lxc_util_usleep(lua_State *L) {\n    usleep((useconds_t)luaL_checkunsigned(L, 1));\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_mainloop",
          "args": [
            "&descr",
            "1000 * delay"
          ],
          "line": 531
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_mainloop_del_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/mainloop.c",
          "lines": "109-130",
          "snippet": "int lxc_mainloop_del_handler(struct lxc_epoll_descr *descr, int fd)\n{\n\tstruct mainloop_handler *handler;\n\tstruct lxc_list *iterator;\n\n\tlxc_list_for_each(iterator, &descr->handlers) {\n\t\thandler = iterator->elem;\n\n\t\tif (handler->fd == fd) {\n\t\t\t/* found */\n\t\t\tif (epoll_ctl(descr->epfd, EPOLL_CTL_DEL, fd, NULL))\n\t\t\t\treturn -1;\n\n\t\t\tlxc_list_del(iterator);\n\t\t\tfree(iterator->elem);\n\t\t\tfree(iterator);\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\treturn -1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n\nint lxc_mainloop_del_handler(struct lxc_epoll_descr *descr, int fd)\n{\n\tstruct mainloop_handler *handler;\n\tstruct lxc_list *iterator;\n\n\tlxc_list_for_each(iterator, &descr->handlers) {\n\t\thandler = iterator->elem;\n\n\t\tif (handler->fd == fd) {\n\t\t\t/* found */\n\t\t\tif (epoll_ctl(descr->epfd, EPOLL_CTL_DEL, fd, NULL))\n\t\t\t\treturn -1;\n\n\t\t\tlxc_list_del(iterator);\n\t\t\tfree(iterator->elem);\n\t\t\tfree(iterator);\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_container_put",
          "args": [
            "ct[i].c"
          ],
          "line": 525
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_container_put",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lxccontainer.c",
          "lines": "312-325",
          "snippet": "int lxc_container_put(struct lxc_container *c)\n{\n\tif (!c)\n\t\treturn -1;\n\tif (container_mem_lock(c))\n\t\treturn -1;\n\tif (--c->numthreads < 1) {\n\t\tcontainer_mem_unlock(c);\n\t\tlxc_container_free(c);\n\t\treturn 1;\n\t}\n\tcontainer_mem_unlock(c);\n\treturn 0;\n}",
          "includes": [
            "#include <mntent.h>",
            "#include <../include/lxcmntent.h>",
            "#include <../include/ifaddrs.h>",
            "#include <ifaddrs.h>",
            "#    include <sys/sysmacros.h>",
            "#    include <sys/mkdev.h>",
            "#include \"version.h\"",
            "#include \"utils.h\"",
            "#include \"state.h\"",
            "#include \"sync.h\"",
            "#include \"network.h\"",
            "#include \"namespace.h\"",
            "#include \"monitor.h\"",
            "#include \"lxclock.h\"",
            "#include \"lxccontainer.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"criu.h\"",
            "#include \"console.h\"",
            "#include \"confile.h\"",
            "#include \"commands.h\"",
            "#include \"config.h\"",
            "#include \"conf.h\"",
            "#include \"cgroup.h\"",
            "#include \"lxcbtrfs.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"bdev.h\"",
            "#include \"attach.h\"",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <arpa/inet.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <sched.h>",
            "#include <pthread.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool do_lxcapi_destroy(struct lxc_container *c);",
            "static const char *lxcapi_get_config_path(struct lxc_container *c);",
            "static bool container_destroy(struct lxc_container *c);",
            "static bool lxcapi_snapshot_destroy_all(struct lxc_container *c);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <mntent.h>\n#include <../include/lxcmntent.h>\n#include <../include/ifaddrs.h>\n#include <ifaddrs.h>\n#    include <sys/sysmacros.h>\n#    include <sys/mkdev.h>\n#include \"version.h\"\n#include \"utils.h\"\n#include \"state.h\"\n#include \"sync.h\"\n#include \"network.h\"\n#include \"namespace.h\"\n#include \"monitor.h\"\n#include \"lxclock.h\"\n#include \"lxccontainer.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"criu.h\"\n#include \"console.h\"\n#include \"confile.h\"\n#include \"commands.h\"\n#include \"config.h\"\n#include \"conf.h\"\n#include \"cgroup.h\"\n#include \"lxcbtrfs.h\"\n#include \"lxcoverlay.h\"\n#include \"bdev.h\"\n#include \"attach.h\"\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <sched.h>\n#include <pthread.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n\nstatic bool do_lxcapi_destroy(struct lxc_container *c);\nstatic const char *lxcapi_get_config_path(struct lxc_container *c);\nstatic bool container_destroy(struct lxc_container *c);\nstatic bool lxcapi_snapshot_destroy_all(struct lxc_container *c);\n\nint lxc_container_put(struct lxc_container *c)\n{\n\tif (!c)\n\t\treturn -1;\n\tif (container_mem_lock(c))\n\t\treturn -1;\n\tif (--c->numthreads < 1) {\n\t\tcontainer_mem_unlock(c);\n\t\tlxc_container_free(c);\n\t\treturn 1;\n\t}\n\tcontainer_mem_unlock(c);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "stdout"
          ],
          "line": 522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stats_print",
          "args": [
            "total_name",
            "&total",
            "&total"
          ],
          "line": 520
        },
        "resolved": true,
        "details": {
          "function_name": "stats_print",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "316-352",
          "snippet": "static void stats_print(const char *name, const struct stats *stats,\n\t\t\tconst struct stats *total)\n{\n\tchar blkio_str[20];\n\tchar mem_used_str[20];\n\tchar kmem_used_str[20];\n\tstruct timeval time_val;\n\tunsigned long long time_ms;\n\n\tif (!batch) {\n\t\tsize_humanize(stats->blkio, blkio_str, sizeof(blkio_str));\n\t\tsize_humanize(stats->mem_used, mem_used_str, sizeof(mem_used_str));\n\n\t\tprintf(\"%-18.18s %12.2f %12.2f %12.2f %14s %10s\",\n\t\t       name,\n\t\t       (float)stats->cpu_use_nanos / 1000000000,\n\t\t       (float)stats->cpu_use_sys  / USER_HZ,\n\t\t       (float)stats->cpu_use_user / USER_HZ,\n\t\t       blkio_str,\n\t\t       mem_used_str);\n\t\tif (total->kmem_used > 0) {\n\t\t\tsize_humanize(stats->kmem_used, kmem_used_str, sizeof(kmem_used_str));\n\t\t\tprintf(\" %10s\", kmem_used_str);\n\t\t}\n\t} else {\n\t\tgettimeofday(&time_val, NULL);\n\t\ttime_ms = (unsigned long long) (time_val.tv_sec) * 1000 + (unsigned long long) (time_val.tv_usec) / 1000;\n\t\tprintf(\"%\" PRIu64 \",%s,%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64\n\t\t       \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64,\n\t\t       (uint64_t)time_ms, name, (uint64_t)stats->cpu_use_nanos,\n\t\t       (uint64_t)stats->cpu_use_sys,\n\t\t       (uint64_t)stats->cpu_use_user, (uint64_t)stats->blkio,\n\t\t       (uint64_t)stats->blkio_iops, (uint64_t)stats->mem_used,\n\t\t       (uint64_t)stats->kmem_used);\n\t}\n\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define USER_HZ   100"
          ],
          "globals_used": [
            "static int batch = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\n#define USER_HZ   100\n\nstatic int batch = 0;\n\nstatic void stats_print(const char *name, const struct stats *stats,\n\t\t\tconst struct stats *total)\n{\n\tchar blkio_str[20];\n\tchar mem_used_str[20];\n\tchar kmem_used_str[20];\n\tstruct timeval time_val;\n\tunsigned long long time_ms;\n\n\tif (!batch) {\n\t\tsize_humanize(stats->blkio, blkio_str, sizeof(blkio_str));\n\t\tsize_humanize(stats->mem_used, mem_used_str, sizeof(mem_used_str));\n\n\t\tprintf(\"%-18.18s %12.2f %12.2f %12.2f %14s %10s\",\n\t\t       name,\n\t\t       (float)stats->cpu_use_nanos / 1000000000,\n\t\t       (float)stats->cpu_use_sys  / USER_HZ,\n\t\t       (float)stats->cpu_use_user / USER_HZ,\n\t\t       blkio_str,\n\t\t       mem_used_str);\n\t\tif (total->kmem_used > 0) {\n\t\t\tsize_humanize(stats->kmem_used, kmem_used_str, sizeof(kmem_used_str));\n\t\t\tprintf(\" %10s\", kmem_used_str);\n\t\t}\n\t} else {\n\t\tgettimeofday(&time_val, NULL);\n\t\ttime_ms = (unsigned long long) (time_val.tv_sec) * 1000 + (unsigned long long) (time_val.tv_usec) / 1000;\n\t\tprintf(\"%\" PRIu64 \",%s,%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64\n\t\t       \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64,\n\t\t       (uint64_t)time_ms, name, (uint64_t)stats->cpu_use_nanos,\n\t\t       (uint64_t)stats->cpu_use_sys,\n\t\t       (uint64_t)stats->cpu_use_user, (uint64_t)stats->blkio,\n\t\t       (uint64_t)stats->blkio_iops, (uint64_t)stats->mem_used,\n\t\t       (uint64_t)stats->kmem_used);\n\t}\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "total_name",
            "\"TOTAL %d of %d\"",
            "i",
            "active_cnt"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stats_print_header",
          "args": [
            "&total"
          ],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "stats_print_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "301-314",
          "snippet": "static void stats_print_header(struct stats *stats)\n{\n\tprintf(TERMRVRS TERMBOLD);\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Container\", \"CPU\",  \"CPU\",  \"CPU\",  \"BlkIO\", \"Mem\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"KMem\");\n\tprintf(\"\\n\");\n\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Name\",      \"Used\", \"Sys\",  \"User\", \"Total\", \"Used\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"Used\");\n\tprintf(\"\\n\");\n\tprintf(TERMNORM);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define TERMRVRS  ESC \"[7m\"",
            "#define TERMBOLD  ESC \"[1m\"",
            "#define TERMNORM  ESC \"[0m\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\n#define TERMRVRS  ESC \"[7m\"\n#define TERMBOLD  ESC \"[1m\"\n#define TERMNORM  ESC \"[0m\"\n\nstatic void stats_print_header(struct stats *stats)\n{\n\tprintf(TERMRVRS TERMBOLD);\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Container\", \"CPU\",  \"CPU\",  \"CPU\",  \"BlkIO\", \"Mem\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"KMem\");\n\tprintf(\"\\n\");\n\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Name\",      \"Used\", \"Sys\",  \"User\", \"Total\", \"Used\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"Used\");\n\tprintf(\"\\n\");\n\tprintf(TERMNORM);\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "TERMCLEAR"
          ],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ct_sort",
          "args": [
            "active_cnt"
          ],
          "line": 508
        },
        "resolved": true,
        "details": {
          "function_name": "ct_sort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "404-417",
          "snippet": "static void ct_sort(int active)\n{\n\tint (*cmp_func)(const void *, const void *);\n\n\tswitch(sort_by) {\n\tdefault:\n\tcase 'n': cmp_func = cmp_name; break;\n\tcase 'c': cmp_func = cmp_cpuuse; break;\n\tcase 'b': cmp_func = cmp_blkio; break;\n\tcase 'm': cmp_func = cmp_memory; break;\n\tcase 'k': cmp_func = cmp_kmemory; break;\n\t}\n\tqsort(ct, active, sizeof(*ct), (int (*)(const void *,const void *))cmp_func);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char sort_by = 'n';",
            "static struct ct *ct = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic char sort_by = 'n';\nstatic struct ct *ct = NULL;\n\nstatic void ct_sort(int active)\n{\n\tint (*cmp_func)(const void *, const void *);\n\n\tswitch(sort_by) {\n\tdefault:\n\tcase 'n': cmp_func = cmp_name; break;\n\tcase 'c': cmp_func = cmp_cpuuse; break;\n\tcase 'b': cmp_func = cmp_blkio; break;\n\tcase 'm': cmp_func = cmp_memory; break;\n\tcase 'k': cmp_func = cmp_kmemory; break;\n\t}\n\tqsort(ct, active, sizeof(*ct), (int (*)(const void *,const void *))cmp_func);\n}"
        }
      },
      {
        "call_info": {
          "callee": "stats_get",
          "args": [
            "active[i]",
            "&ct[i]",
            "&total"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "stats_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "276-299",
          "snippet": "static void stats_get(struct lxc_container *c, struct ct *ct, struct stats *total)\n{\n\tct->c = c;\n\tct->stats->mem_used      = stat_get_int(c, \"memory.usage_in_bytes\");\n\tct->stats->mem_limit     = stat_get_int(c, \"memory.limit_in_bytes\");\n\tct->stats->kmem_used     = stat_get_int(c, \"memory.kmem.usage_in_bytes\");\n\tct->stats->kmem_limit    = stat_get_int(c, \"memory.kmem.limit_in_bytes\");\n\tct->stats->cpu_use_nanos = stat_get_int(c, \"cpuacct.usage\");\n\tct->stats->cpu_use_user  = stat_match_get_int(c, \"cpuacct.stat\", \"user\", 1);\n\tct->stats->cpu_use_sys   = stat_match_get_int(c, \"cpuacct.stat\", \"system\", 1);\n\tct->stats->blkio         = stat_match_get_int(c, \"blkio.throttle.io_service_bytes\", \"Total\", 1);\n\tct->stats->blkio_iops    = stat_match_get_int(c, \"blkio.throttle.io_serviced\", \"Total\", 1);\n\n\tif (total) {\n\t\ttotal->mem_used      = total->mem_used      + ct->stats->mem_used;\n\t\ttotal->mem_limit     = total->mem_limit     + ct->stats->mem_limit;\n\t\ttotal->kmem_used     = total->kmem_used     + ct->stats->kmem_used;\n\t\ttotal->kmem_limit    = total->kmem_limit    + ct->stats->kmem_limit;\n\t\ttotal->cpu_use_nanos = total->cpu_use_nanos + ct->stats->cpu_use_nanos;\n\t\ttotal->cpu_use_user  = total->cpu_use_user  + ct->stats->cpu_use_user;\n\t\ttotal->cpu_use_sys   = total->cpu_use_sys   + ct->stats->cpu_use_sys;\n\t\ttotal->blkio         = total->blkio         + ct->stats->blkio;\n\t}\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct ct *ct = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct ct *ct = NULL;\n\nstatic void stats_get(struct lxc_container *c, struct ct *ct, struct stats *total)\n{\n\tct->c = c;\n\tct->stats->mem_used      = stat_get_int(c, \"memory.usage_in_bytes\");\n\tct->stats->mem_limit     = stat_get_int(c, \"memory.limit_in_bytes\");\n\tct->stats->kmem_used     = stat_get_int(c, \"memory.kmem.usage_in_bytes\");\n\tct->stats->kmem_limit    = stat_get_int(c, \"memory.kmem.limit_in_bytes\");\n\tct->stats->cpu_use_nanos = stat_get_int(c, \"cpuacct.usage\");\n\tct->stats->cpu_use_user  = stat_match_get_int(c, \"cpuacct.stat\", \"user\", 1);\n\tct->stats->cpu_use_sys   = stat_match_get_int(c, \"cpuacct.stat\", \"system\", 1);\n\tct->stats->blkio         = stat_match_get_int(c, \"blkio.throttle.io_service_bytes\", \"Total\", 1);\n\tct->stats->blkio_iops    = stat_match_get_int(c, \"blkio.throttle.io_serviced\", \"Total\", 1);\n\n\tif (total) {\n\t\ttotal->mem_used      = total->mem_used      + ct->stats->mem_used;\n\t\ttotal->mem_limit     = total->mem_limit     + ct->stats->mem_limit;\n\t\ttotal->kmem_used     = total->kmem_used     + ct->stats->kmem_used;\n\t\ttotal->kmem_limit    = total->kmem_limit    + ct->stats->kmem_limit;\n\t\ttotal->cpu_use_nanos = total->cpu_use_nanos + ct->stats->cpu_use_nanos;\n\t\ttotal->cpu_use_user  = total->cpu_use_user  + ct->stats->cpu_use_user;\n\t\ttotal->cpu_use_sys   = total->cpu_use_sys   + ct->stats->cpu_use_sys;\n\t\ttotal->blkio         = total->blkio         + ct->stats->blkio;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&total",
            "0",
            "sizeof(total)"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ct_realloc",
          "args": [
            "active_cnt"
          ],
          "line": 502
        },
        "resolved": true,
        "details": {
          "function_name": "ct_realloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "433-453",
          "snippet": "static void ct_realloc(int active_cnt)\n{\n\tint i;\n\n\tif (active_cnt > ct_alloc_cnt) {\n\t\tct_free();\n\t\tct = realloc(ct, sizeof(*ct) * active_cnt);\n\t\tif (!ct) {\n\t\t\tERROR(\"cannot alloc mem\");\n\t\t\texit(EXIT_FAILURE);\n\t\t}\n\t\tfor (i = 0; i < active_cnt; i++) {\n\t\t\tct[i].stats = malloc(sizeof(*ct[0].stats));\n\t\t\tif (!ct[i].stats) {\n\t\t\t\tERROR(\"cannot alloc mem\");\n\t\t\t\texit(EXIT_FAILURE);\n\t\t\t}\n\t\t}\n\t\tct_alloc_cnt = active_cnt;\n\t}\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct ct *ct = NULL;",
            "static int ct_alloc_cnt = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct ct *ct = NULL;\nstatic int ct_alloc_cnt = 0;\n\nstatic void ct_realloc(int active_cnt)\n{\n\tint i;\n\n\tif (active_cnt > ct_alloc_cnt) {\n\t\tct_free();\n\t\tct = realloc(ct, sizeof(*ct) * active_cnt);\n\t\tif (!ct) {\n\t\t\tERROR(\"cannot alloc mem\");\n\t\t\texit(EXIT_FAILURE);\n\t\t}\n\t\tfor (i = 0; i < active_cnt; i++) {\n\t\t\tct[i].stats = malloc(sizeof(*ct[0].stats));\n\t\t\tif (!ct[i].stats) {\n\t\t\t\tERROR(\"cannot alloc mem\");\n\t\t\t\texit(EXIT_FAILURE);\n\t\t\t}\n\t\t}\n\t\tct_alloc_cnt = active_cnt;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_active_containers",
          "args": [
            "my_args.lxcpath[0]",
            "NULL",
            "&active"
          ],
          "line": 501
        },
        "resolved": true,
        "details": {
          "function_name": "list_active_containers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lxccontainer.c",
          "lines": "4321-4444",
          "snippet": "int list_active_containers(const char *lxcpath, char ***nret,\n\t\t\t   struct lxc_container ***cret)\n{\n\tint i, ret = -1, cret_cnt = 0, ct_name_cnt = 0;\n\tint lxcpath_len;\n\tchar *line = NULL;\n\tchar **ct_name = NULL;\n\tsize_t len = 0;\n\tstruct lxc_container *c = NULL;\n\tbool is_hashed;\n\n\tif (!lxcpath)\n\t\tlxcpath = lxc_global_config_value(\"lxc.lxcpath\");\n\tlxcpath_len = strlen(lxcpath);\n\n\tif (cret)\n\t\t*cret = NULL;\n\tif (nret)\n\t\t*nret = NULL;\n\n\tFILE *f = fopen(\"/proc/net/unix\", \"r\");\n\tif (!f)\n\t\treturn -1;\n\n\twhile (getline(&line, &len, f) != -1) {\n\n\t\tchar *p = strrchr(line, ' '), *p2;\n\t\tif (!p)\n\t\t\tcontinue;\n\t\tp++;\n\t\tif (*p != 0x40)\n\t\t\tcontinue;\n\t\tp++;\n\n\t\tis_hashed = false;\n\t\tif (strncmp(p, lxcpath, lxcpath_len) == 0) {\n\t\t\tp += lxcpath_len;\n\t\t} else if (strncmp(p, \"lxc/\", 4) == 0) {\n\t\t\tp += 4;\n\t\t\tis_hashed = true;\n\t\t} else {\n\t\t\tcontinue;\n\t\t}\n\n\t\twhile (*p == '/')\n\t\t\tp++;\n\n\t\t// Now p is the start of lxc_name\n\t\tp2 = strchr(p, '/');\n\t\tif (!p2 || strncmp(p2, \"/command\", 8) != 0)\n\t\t\tcontinue;\n\t\t*p2 = '\\0';\n\n\t\tif (is_hashed) {\n\t\t\tif (strncmp(lxcpath, lxc_cmd_get_lxcpath(p), lxcpath_len) != 0)\n\t\t\t\tcontinue;\n\t\t\tp = lxc_cmd_get_name(p);\n\t\t}\n\n\t\tif (array_contains(&ct_name, p, ct_name_cnt))\n\t\t\tcontinue;\n\n\t\tif (!add_to_array(&ct_name, p, ct_name_cnt))\n\t\t\tgoto free_cret_list;\n\n\t\tct_name_cnt++;\n\n\t\tif (!cret)\n\t\t\tcontinue;\n\n\t\tc = lxc_container_new(p, lxcpath);\n\t\tif (!c) {\n\t\t\tINFO(\"Container %s:%s is running but could not be loaded\",\n\t\t\t\tlxcpath, p);\n\t\t\tremove_from_array(&ct_name, p, ct_name_cnt--);\n\t\t\tcontinue;\n\t\t}\n\n\t\t/*\n\t\t * If this is an anonymous container, then is_defined *can*\n\t\t * return false.  So we don't do that check.  Count on the\n\t\t * fact that the command socket exists.\n\t\t */\n\n\t\tif (!add_to_clist(cret, c, cret_cnt, true)) {\n\t\t\tlxc_container_put(c);\n\t\t\tgoto free_cret_list;\n\t\t}\n\t\tcret_cnt++;\n\t}\n\n\tif (nret && cret && cret_cnt != ct_name_cnt) {\n\t\tif (c)\n\t\t\tlxc_container_put(c);\n\t\tgoto free_cret_list;\n\t}\n\n\tret = ct_name_cnt;\n\tif (nret)\n\t\t*nret = ct_name;\n\telse\n\t\tgoto free_ct_name;\n\tgoto out;\n\nfree_cret_list:\n\tif (cret && *cret) {\n\t\tfor (i = 0; i < cret_cnt; i++)\n\t\t\tlxc_container_put((*cret)[i]);\n\t\tfree(*cret);\n\t}\n\nfree_ct_name:\n\tif (ct_name) {\n\t\tfor (i = 0; i < ct_name_cnt; i++)\n\t\t\tfree(ct_name[i]);\n\t\tfree(ct_name);\n\t}\n\nout:\n\tfree(line);\n\n\tfclose(f);\n\treturn ret;\n}",
          "includes": [
            "#include <mntent.h>",
            "#include <../include/lxcmntent.h>",
            "#include <../include/ifaddrs.h>",
            "#include <ifaddrs.h>",
            "#    include <sys/sysmacros.h>",
            "#    include <sys/mkdev.h>",
            "#include \"version.h\"",
            "#include \"utils.h\"",
            "#include \"state.h\"",
            "#include \"sync.h\"",
            "#include \"network.h\"",
            "#include \"namespace.h\"",
            "#include \"monitor.h\"",
            "#include \"lxclock.h\"",
            "#include \"lxccontainer.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"criu.h\"",
            "#include \"console.h\"",
            "#include \"confile.h\"",
            "#include \"commands.h\"",
            "#include \"config.h\"",
            "#include \"conf.h\"",
            "#include \"cgroup.h\"",
            "#include \"lxcbtrfs.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"bdev.h\"",
            "#include \"attach.h\"",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <arpa/inet.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <sched.h>",
            "#include <pthread.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool do_lxcapi_destroy(struct lxc_container *c);",
            "static const char *lxcapi_get_config_path(struct lxc_container *c);",
            "static bool container_destroy(struct lxc_container *c);",
            "static bool lxcapi_snapshot_destroy_all(struct lxc_container *c);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <mntent.h>\n#include <../include/lxcmntent.h>\n#include <../include/ifaddrs.h>\n#include <ifaddrs.h>\n#    include <sys/sysmacros.h>\n#    include <sys/mkdev.h>\n#include \"version.h\"\n#include \"utils.h\"\n#include \"state.h\"\n#include \"sync.h\"\n#include \"network.h\"\n#include \"namespace.h\"\n#include \"monitor.h\"\n#include \"lxclock.h\"\n#include \"lxccontainer.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"criu.h\"\n#include \"console.h\"\n#include \"confile.h\"\n#include \"commands.h\"\n#include \"config.h\"\n#include \"conf.h\"\n#include \"cgroup.h\"\n#include \"lxcbtrfs.h\"\n#include \"lxcoverlay.h\"\n#include \"bdev.h\"\n#include \"attach.h\"\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <sched.h>\n#include <pthread.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n\nstatic bool do_lxcapi_destroy(struct lxc_container *c);\nstatic const char *lxcapi_get_config_path(struct lxc_container *c);\nstatic bool container_destroy(struct lxc_container *c);\nstatic bool lxcapi_snapshot_destroy_all(struct lxc_container *c);\n\nint list_active_containers(const char *lxcpath, char ***nret,\n\t\t\t   struct lxc_container ***cret)\n{\n\tint i, ret = -1, cret_cnt = 0, ct_name_cnt = 0;\n\tint lxcpath_len;\n\tchar *line = NULL;\n\tchar **ct_name = NULL;\n\tsize_t len = 0;\n\tstruct lxc_container *c = NULL;\n\tbool is_hashed;\n\n\tif (!lxcpath)\n\t\tlxcpath = lxc_global_config_value(\"lxc.lxcpath\");\n\tlxcpath_len = strlen(lxcpath);\n\n\tif (cret)\n\t\t*cret = NULL;\n\tif (nret)\n\t\t*nret = NULL;\n\n\tFILE *f = fopen(\"/proc/net/unix\", \"r\");\n\tif (!f)\n\t\treturn -1;\n\n\twhile (getline(&line, &len, f) != -1) {\n\n\t\tchar *p = strrchr(line, ' '), *p2;\n\t\tif (!p)\n\t\t\tcontinue;\n\t\tp++;\n\t\tif (*p != 0x40)\n\t\t\tcontinue;\n\t\tp++;\n\n\t\tis_hashed = false;\n\t\tif (strncmp(p, lxcpath, lxcpath_len) == 0) {\n\t\t\tp += lxcpath_len;\n\t\t} else if (strncmp(p, \"lxc/\", 4) == 0) {\n\t\t\tp += 4;\n\t\t\tis_hashed = true;\n\t\t} else {\n\t\t\tcontinue;\n\t\t}\n\n\t\twhile (*p == '/')\n\t\t\tp++;\n\n\t\t// Now p is the start of lxc_name\n\t\tp2 = strchr(p, '/');\n\t\tif (!p2 || strncmp(p2, \"/command\", 8) != 0)\n\t\t\tcontinue;\n\t\t*p2 = '\\0';\n\n\t\tif (is_hashed) {\n\t\t\tif (strncmp(lxcpath, lxc_cmd_get_lxcpath(p), lxcpath_len) != 0)\n\t\t\t\tcontinue;\n\t\t\tp = lxc_cmd_get_name(p);\n\t\t}\n\n\t\tif (array_contains(&ct_name, p, ct_name_cnt))\n\t\t\tcontinue;\n\n\t\tif (!add_to_array(&ct_name, p, ct_name_cnt))\n\t\t\tgoto free_cret_list;\n\n\t\tct_name_cnt++;\n\n\t\tif (!cret)\n\t\t\tcontinue;\n\n\t\tc = lxc_container_new(p, lxcpath);\n\t\tif (!c) {\n\t\t\tINFO(\"Container %s:%s is running but could not be loaded\",\n\t\t\t\tlxcpath, p);\n\t\t\tremove_from_array(&ct_name, p, ct_name_cnt--);\n\t\t\tcontinue;\n\t\t}\n\n\t\t/*\n\t\t * If this is an anonymous container, then is_defined *can*\n\t\t * return false.  So we don't do that check.  Count on the\n\t\t * fact that the command socket exists.\n\t\t */\n\n\t\tif (!add_to_clist(cret, c, cret_cnt, true)) {\n\t\t\tlxc_container_put(c);\n\t\t\tgoto free_cret_list;\n\t\t}\n\t\tcret_cnt++;\n\t}\n\n\tif (nret && cret && cret_cnt != ct_name_cnt) {\n\t\tif (c)\n\t\t\tlxc_container_put(c);\n\t\tgoto free_cret_list;\n\t}\n\n\tret = ct_name_cnt;\n\tif (nret)\n\t\t*nret = ct_name;\n\telse\n\t\tgoto free_ct_name;\n\tgoto out;\n\nfree_cret_list:\n\tif (cret && *cret) {\n\t\tfor (i = 0; i < cret_cnt; i++)\n\t\t\tlxc_container_put((*cret)[i]);\n\t\tfree(*cret);\n\t}\n\nfree_ct_name:\n\tif (ct_name) {\n\t\tfor (i = 0; i < ct_name_cnt; i++)\n\t\t\tfree(ct_name[i]);\n\t\tfree(ct_name);\n\t}\n\nout:\n\tfree(line);\n\n\tfclose(f);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"time_ms,container,cpu_nanos,cpu_sys_userhz,cpu_user_userhz,blkio_bytes,blkio_iops,mem_used_bytes,kernel_mem_used_bytes\\n\""
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"failed to add stdin handler\""
          ],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_mainloop_add_handler",
          "args": [
            "&descr",
            "0",
            "stdin_handler",
            "&in_char"
          ],
          "line": 481
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_mainloop_add_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/mainloop.c",
          "lines": "75-107",
          "snippet": "int lxc_mainloop_add_handler(struct lxc_epoll_descr *descr, int fd,\n\t\t\t     lxc_mainloop_callback_t callback, void *data)\n{\n\tstruct epoll_event ev;\n\tstruct mainloop_handler *handler;\n\tstruct lxc_list *item;\n\n\thandler = malloc(sizeof(*handler));\n\tif (!handler)\n\t\treturn -1;\n\n\thandler->callback = callback;\n\thandler->fd = fd;\n\thandler->data = data;\n\n\tev.events = EPOLLIN;\n\tev.data.ptr = handler;\n\n\tif (epoll_ctl(descr->epfd, EPOLL_CTL_ADD, fd, &ev) < 0)\n\t\tgoto out_free_handler;\n\n\titem = malloc(sizeof(*item));\n\tif (!item)\n\t\tgoto out_free_handler;\n\n\titem->elem = handler;\n\tlxc_list_add(&descr->handlers, item);\n\treturn 0;\n\nout_free_handler:\n\tfree(handler);\n\treturn -1;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n\nint lxc_mainloop_add_handler(struct lxc_epoll_descr *descr, int fd,\n\t\t\t     lxc_mainloop_callback_t callback, void *data)\n{\n\tstruct epoll_event ev;\n\tstruct mainloop_handler *handler;\n\tstruct lxc_list *item;\n\n\thandler = malloc(sizeof(*handler));\n\tif (!handler)\n\t\treturn -1;\n\n\thandler->callback = callback;\n\thandler->fd = fd;\n\thandler->data = data;\n\n\tev.events = EPOLLIN;\n\tev.data.ptr = handler;\n\n\tif (epoll_ctl(descr->epfd, EPOLL_CTL_ADD, fd, &ev) < 0)\n\t\tgoto out_free_handler;\n\n\titem = malloc(sizeof(*item));\n\tif (!item)\n\t\tgoto out_free_handler;\n\n\titem->elem = handler;\n\tlxc_list_add(&descr->handlers, item);\n\treturn 0;\n\nout_free_handler:\n\tfree(handler);\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"failed to create mainloop\""
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_mainloop_open",
          "args": [
            "&descr"
          ],
          "line": 476
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_mainloop_open",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/mainloop.c",
          "lines": "132-146",
          "snippet": "int lxc_mainloop_open(struct lxc_epoll_descr *descr)\n{\n\t/* hint value passed to epoll create */\n\tdescr->epfd = epoll_create(2);\n\tif (descr->epfd < 0)\n\t\treturn -1;\n\n\tif (fcntl(descr->epfd, F_SETFD, FD_CLOEXEC)) {\n\t\tclose(descr->epfd);\n\t\treturn -1;\n\t}\n\n\tlxc_list_init(&descr->handlers);\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n\nint lxc_mainloop_open(struct lxc_epoll_descr *descr)\n{\n\t/* hint value passed to epoll create */\n\tdescr->epfd = epoll_create(2);\n\tif (descr->epfd < 0)\n\t\treturn -1;\n\n\tif (fcntl(descr->epfd, F_SETFD, FD_CLOEXEC)) {\n\t\tclose(descr->epfd);\n\t\treturn -1;\n\t}\n\n\tlxc_list_init(&descr->handlers);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGQUIT",
            "sig_handler"
          ],
          "line": 474
        },
        "resolved": true,
        "details": {
          "function_name": "task_blocking_signal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "1893-1925",
          "snippet": "bool task_blocking_signal(pid_t pid, int signal)\n{\n\tbool bret = false;\n\tchar *line = NULL;\n\tlong unsigned int sigblk = 0;\n\tsize_t n = 0;\n\tint ret;\n\tFILE *f;\n\n\tchar status[__PROC_STATUS_LEN];\n\n\tret = snprintf(status, __PROC_STATUS_LEN, \"/proc/%d/status\", pid);\n\tif (ret < 0 || ret >= __PROC_STATUS_LEN)\n\t\treturn bret;\n\n\tf = fopen(status, \"r\");\n\tif (!f)\n\t\treturn bret;\n\n\twhile (getline(&line, &n, f) != -1) {\n\t\tif (!strncmp(line, \"SigBlk:\\t\", 8))\n\t\t\tif (sscanf(line + 8, \"%lx\", &sigblk) != 1)\n\t\t\t\tgoto out;\n\t}\n\n\tif (sigblk & signal)\n\t\tbret = true;\n\nout:\n\tfree(line);\n\tfclose(f);\n\treturn bret;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define __PROC_STATUS_LEN (5 + (LXC_NUMSTRLEN64) + 7 + 1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\n#define __PROC_STATUS_LEN (5 + (LXC_NUMSTRLEN64) + 7 + 1)\n\nbool task_blocking_signal(pid_t pid, int signal)\n{\n\tbool bret = false;\n\tchar *line = NULL;\n\tlong unsigned int sigblk = 0;\n\tsize_t n = 0;\n\tint ret;\n\tFILE *f;\n\n\tchar status[__PROC_STATUS_LEN];\n\n\tret = snprintf(status, __PROC_STATUS_LEN, \"/proc/%d/status\", pid);\n\tif (ret < 0 || ret >= __PROC_STATUS_LEN)\n\t\treturn bret;\n\n\tf = fopen(status, \"r\");\n\tif (!f)\n\t\treturn bret;\n\n\twhile (getline(&line, &n, f) != -1) {\n\t\tif (!strncmp(line, \"SigBlk:\\t\", 8))\n\t\t\tif (sscanf(line + 8, \"%lx\", &sigblk) != 1)\n\t\t\t\tgoto out;\n\t}\n\n\tif (sigblk & signal)\n\t\tbret = true;\n\nout:\n\tfree(line);\n\tfclose(f);\n\treturn bret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "atexit",
          "args": [
            "stdin_tios_restore"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"failed to setup terminal\""
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stdin_tios_setup",
          "args": [],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "stdin_tios_setup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "138-167",
          "snippet": "static int stdin_tios_setup(void)\n{\n\tstruct termios newtios;\n\n\tif (!isatty(0)) {\n\t\tERROR(\"stdin is not a tty\");\n\t\treturn -1;\n\t}\n\n\tif (tcgetattr(0, &oldtios)) {\n\t\tSYSERROR(\"failed to get current terminal settings\");\n\t\treturn -1;\n\t}\n\n\tnewtios = oldtios;\n\n\t/* turn off echo and line buffering */\n\tnewtios.c_iflag &= ~IGNBRK;\n\tnewtios.c_iflag &= BRKINT;\n\tnewtios.c_lflag &= ~(ECHO|ICANON);\n\tnewtios.c_cc[VMIN] = 1;\n\tnewtios.c_cc[VTIME] = 0;\n\n\tif (tcsetattr(0, TCSAFLUSH, &newtios)) {\n\t\tERROR(\"failed to set new terminal settings\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct termios oldtios;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct termios oldtios;\n\nstatic int stdin_tios_setup(void)\n{\n\tstruct termios newtios;\n\n\tif (!isatty(0)) {\n\t\tERROR(\"stdin is not a tty\");\n\t\treturn -1;\n\t}\n\n\tif (tcgetattr(0, &oldtios)) {\n\t\tSYSERROR(\"failed to get current terminal settings\");\n\t\treturn -1;\n\t}\n\n\tnewtios = oldtios;\n\n\t/* turn off echo and line buffering */\n\tnewtios.c_iflag &= ~IGNBRK;\n\tnewtios.c_iflag &= BRKINT;\n\tnewtios.c_lflag &= ~(ECHO|ICANON);\n\tnewtios.c_cc[VMIN] = 1;\n\tnewtios.c_cc[VTIME] = 0;\n\n\tif (tcsetattr(0, TCSAFLUSH, &newtios)) {\n\t\tERROR(\"failed to set new terminal settings\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "stdin_tios_rows",
          "args": [],
          "line": 465
        },
        "resolved": true,
        "details": {
          "function_name": "stdin_tios_rows",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "169-175",
          "snippet": "static int stdin_tios_rows(void)\n{\n\tstruct winsize wsz;\n\tif (isatty(0) && ioctl(0, TIOCGWINSZ, &wsz) == 0)\n\t\treturn wsz.ws_row;\n\treturn 25;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int stdin_tios_rows(void)\n{\n\tstruct winsize wsz;\n\tif (isatty(0) && ioctl(0, TIOCGWINSZ, &wsz) == 0)\n\t\treturn wsz.ws_row;\n\treturn 25;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_arguments_parse",
          "args": [
            "&my_args",
            "argc",
            "argv"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_arguments_parse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/arguments.c",
          "lines": "182-252",
          "snippet": "extern int lxc_arguments_parse(struct lxc_arguments *args,\n\t\t\t       int argc, char * const argv[])\n{\n\tchar shortopts[256];\n\tint  ret = 0;\n\n\tret = build_shortopts(args->options, shortopts, sizeof(shortopts));\n\tif (ret < 0) {\n\t\tlxc_error(args, \"build_shortopts() failed : %s\",\n\t\t\t  strerror(errno));\n\t\treturn ret;\n\t}\n\n\twhile (1)  {\n\t\tint c, index = 0;\n\n\t\tc = getopt_long(argc, argv, shortopts, args->options, &index);\n\t\tif (c == -1)\n\t\t\tbreak;\n\t\tswitch (c) {\n\t\tcase 'n': \targs->name = optarg; break;\n\t\tcase 'o':\targs->log_file = optarg; break;\n\t\tcase 'l':\targs->log_priority = optarg; break;\n\t\tcase 'q':\targs->quiet = 1; break;\n\t\tcase OPT_RCFILE: args->rcfile = optarg; break;\n\t\tcase 'P':\n\t\t\tremove_trailing_slashes(optarg);\n\t\t\tret = lxc_arguments_lxcpath_add(args, optarg);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t\tbreak;\n\t\tcase OPT_USAGE: print_usage(args->options, args);\n\t\tcase OPT_VERSION: print_version();\n\t\tcase '?':\tprint_help(args, 1);\n\t\tcase 'h': \tprint_help(args, 0);\n\t\tdefault:\n\t\t\tif (args->parser) {\n\t\t\t\tret = args->parser(args, c, optarg);\n\t\t\t\tif (ret)\n\t\t\t\t\tgoto error;\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * Reclaim the remaining command arguments\n\t */\n\targs->argv = &argv[optind];\n\targs->argc = argc - optind;\n\n\t/* If no lxcpaths were given, use default */\n\tif (!args->lxcpath_cnt) {\n\t\tret = lxc_arguments_lxcpath_add(args, lxc_global_config_value(\"lxc.lxcpath\"));\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\t/* Check the command options */\n\n\tif (!args->name && strcmp(args->progname, \"lxc-autostart\") != 0) {\n\t\tlxc_error(args, \"missing container name, use --name option\");\n\t\treturn -1;\n\t}\n\n\tif (args->checker)\n\t\tret = args->checker(args);\nerror:\n\tif (ret)\n\t\tlxc_error(args, \"could not parse command line\");\n\treturn ret;\n}",
          "includes": [
            "#include \"version.h\"",
            "#include \"utils.h\"",
            "#include \"arguments.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <errno.h>",
            "#include <ctype.h>\t\t/* for isprint() */",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"utils.h\"\n#include \"arguments.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <errno.h>\n#include <ctype.h>\t\t/* for isprint() */\n#include <string.h>\n#include <limits.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nextern int lxc_arguments_parse(struct lxc_arguments *args,\n\t\t\t       int argc, char * const argv[])\n{\n\tchar shortopts[256];\n\tint  ret = 0;\n\n\tret = build_shortopts(args->options, shortopts, sizeof(shortopts));\n\tif (ret < 0) {\n\t\tlxc_error(args, \"build_shortopts() failed : %s\",\n\t\t\t  strerror(errno));\n\t\treturn ret;\n\t}\n\n\twhile (1)  {\n\t\tint c, index = 0;\n\n\t\tc = getopt_long(argc, argv, shortopts, args->options, &index);\n\t\tif (c == -1)\n\t\t\tbreak;\n\t\tswitch (c) {\n\t\tcase 'n': \targs->name = optarg; break;\n\t\tcase 'o':\targs->log_file = optarg; break;\n\t\tcase 'l':\targs->log_priority = optarg; break;\n\t\tcase 'q':\targs->quiet = 1; break;\n\t\tcase OPT_RCFILE: args->rcfile = optarg; break;\n\t\tcase 'P':\n\t\t\tremove_trailing_slashes(optarg);\n\t\t\tret = lxc_arguments_lxcpath_add(args, optarg);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t\tbreak;\n\t\tcase OPT_USAGE: print_usage(args->options, args);\n\t\tcase OPT_VERSION: print_version();\n\t\tcase '?':\tprint_help(args, 1);\n\t\tcase 'h': \tprint_help(args, 0);\n\t\tdefault:\n\t\t\tif (args->parser) {\n\t\t\t\tret = args->parser(args, c, optarg);\n\t\t\t\tif (ret)\n\t\t\t\t\tgoto error;\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * Reclaim the remaining command arguments\n\t */\n\targs->argv = &argv[optind];\n\targs->argc = argc - optind;\n\n\t/* If no lxcpaths were given, use default */\n\tif (!args->lxcpath_cnt) {\n\t\tret = lxc_arguments_lxcpath_add(args, lxc_global_config_value(\"lxc.lxcpath\"));\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\t/* Check the command options */\n\n\tif (!args->name && strcmp(args->progname, \"lxc-autostart\") != 0) {\n\t\tlxc_error(args, \"missing container name, use --name option\");\n\t\treturn -1;\n\t}\n\n\tif (args->checker)\n\t\tret = args->checker(args);\nerror:\n\tif (ret)\n\t\tlxc_error(args, \"could not parse command line\");\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\n#define TERMCLEAR ESC \"[H\" ESC \"[J\"\n\nstatic int batch = 0;\nstatic int delay_set = 0;\nstatic int delay = 3;\nstatic char sort_by = 'n';\nstatic int sort_reverse = 0;\nstatic struct ct *ct = NULL;\nstatic struct lxc_arguments my_args = {\n\t.progname = \"lxc-top\",\n\t.help     = \"\\\n\\n\\\n\\n\\\nlxc-top monitors the state of the active containers\\n\\\n\\n\\\nOptions :\\n\\\n  -d, --delay     delay in seconds between refreshes (default: 3.0)\\n\\\n  -b, --batch     output designed to capture to a file\\n\\\n  -s, --sort      sort by [n,c,b,m] (default: n) where\\n\\\n                  n = Name\\n\\\n                  c = CPU use\\n\\\n                  b = Block I/O use\\n\\\n                  m = Memory use\\n\\\n                  k = Kernel memory use\\n\\\n  -r, --reverse   sort in reverse (descending) order\\n\",\n\t.name     = \".*\",\n\t.options  = my_longopts,\n\t.parser   = my_parser,\n\t.checker  = NULL,\n\t.lxcpath_additional = -1,\n};\n\nint main(int argc, char *argv[])\n{\n\tstruct lxc_epoll_descr descr;\n\tint ret, ct_print_cnt;\n\tchar in_char;\n\n\tret = EXIT_FAILURE;\n\tif (lxc_arguments_parse(&my_args, argc, argv))\n\t\tgoto out;\n\n\tct_print_cnt = stdin_tios_rows() - 3; /* 3 -> header and total */\n\tif (stdin_tios_setup() < 0) {\n\t\tERROR(\"failed to setup terminal\");\n\t\tgoto out;\n\t}\n\n\t/* ensure the terminal gets restored */\n\tatexit(stdin_tios_restore);\n\tsignal(SIGINT, sig_handler);\n\tsignal(SIGQUIT, sig_handler);\n\n\tif (lxc_mainloop_open(&descr)) {\n\t\tERROR(\"failed to create mainloop\");\n\t\tgoto out;\n\t}\n\n\tret = lxc_mainloop_add_handler(&descr, 0, stdin_handler, &in_char);\n\tif (ret) {\n\t\tERROR(\"failed to add stdin handler\");\n\t\tret = EXIT_FAILURE;\n\t\tgoto err1;\n\t}\n\n\tif (batch && !delay_set) {\n\t\tdelay = 300;\n\t}\n        if (batch) {\n\t\tprintf(\"time_ms,container,cpu_nanos,cpu_sys_userhz,cpu_user_userhz,blkio_bytes,blkio_iops,mem_used_bytes,kernel_mem_used_bytes\\n\");\n\t}\n\n\tfor(;;) {\n\t\tstruct lxc_container **active;\n\t\tint i, active_cnt;\n\t\tstruct stats total;\n\t\tchar total_name[30];\n\n\t\tactive_cnt = list_active_containers(my_args.lxcpath[0], NULL, &active);\n\t\tct_realloc(active_cnt);\n\n\t\tmemset(&total, 0, sizeof(total));\n\t\tfor (i = 0; i < active_cnt; i++)\n\t\t\tstats_get(active[i], &ct[i], &total);\n\n\t\tct_sort(active_cnt);\n\n\t\tif (!batch) {\n\t\t  printf(TERMCLEAR);\n\t\t  stats_print_header(&total);\n\t\t}\n\t\tfor (i = 0; i < active_cnt && i < ct_print_cnt; i++) {\n\t\t\tstats_print(ct[i].c->name, ct[i].stats, &total);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\t\tif (!batch) {\n\t\t\tsprintf(total_name, \"TOTAL %d of %d\", i, active_cnt);\n\t\t\tstats_print(total_name, &total, &total);\n\t\t}\n\t\tfflush(stdout);\n\n\t\tfor (i = 0; i < active_cnt; i++) {\n\t\t\tlxc_container_put(ct[i].c);\n\t\t\tct[i].c = NULL;\n\t\t}\n\n\t\tin_char = '\\0';\n\t\tif (!batch) {\n\t\t\tret = lxc_mainloop(&descr, 1000 * delay);\n\t\t\tif (ret != 0 || in_char == 'q')\n\t\t\t\tbreak;\n\t\t\tswitch(in_char) {\n\t\t\tcase 'r':\n\t\t\t\tsort_reverse ^= 1;\n\t\t\t\tbreak;\n\t\t\tcase 'n':\n\t\t\tcase 'c':\n\t\t\tcase 'b':\n\t\t\tcase 'm':\n\t\t\tcase 'k':\n\t\t\t\tif (sort_by == in_char)\n\t\t\t\t\tsort_reverse ^= 1;\n\t\t\t\telse\n\t\t\t\t\tsort_reverse = 0;\n\t\t\t\tsort_by = in_char;\n\t\t\t}\n\t\t} else {\n\t\t\tsleep(delay);\n\t\t}\n\t}\n\tret = EXIT_SUCCESS;\n\nerr1:\n\tlxc_mainloop_close(&descr);\nout:\n\texit(EXIT_FAILURE);\n}"
  },
  {
    "function_name": "ct_realloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "433-453",
    "snippet": "static void ct_realloc(int active_cnt)\n{\n\tint i;\n\n\tif (active_cnt > ct_alloc_cnt) {\n\t\tct_free();\n\t\tct = realloc(ct, sizeof(*ct) * active_cnt);\n\t\tif (!ct) {\n\t\t\tERROR(\"cannot alloc mem\");\n\t\t\texit(EXIT_FAILURE);\n\t\t}\n\t\tfor (i = 0; i < active_cnt; i++) {\n\t\t\tct[i].stats = malloc(sizeof(*ct[0].stats));\n\t\t\tif (!ct[i].stats) {\n\t\t\t\tERROR(\"cannot alloc mem\");\n\t\t\t\texit(EXIT_FAILURE);\n\t\t\t}\n\t\t}\n\t\tct_alloc_cnt = active_cnt;\n\t}\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct ct *ct = NULL;",
      "static int ct_alloc_cnt = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"cannot alloc mem\""
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(*ct[0].stats)"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"cannot alloc mem\""
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "ct",
            "sizeof(*ct) * active_cnt"
          ],
          "line": 439
        },
        "resolved": true,
        "details": {
          "function_name": "must_realloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/cgroups/cgfsng.c",
          "lines": "116-124",
          "snippet": "static void *must_realloc(void *orig, size_t sz)\n{\n\tvoid *ret;\n\n\tdo {\n\t\tret = realloc(orig, sz);\n\t} while (!ret);\n\treturn ret;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"log.h\"",
            "#include \"commands.h\"",
            "#include \"cgroup.h\"",
            "#include \"bdev.h\"",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <grp.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include <ctype.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"log.h\"\n#include \"commands.h\"\n#include \"cgroup.h\"\n#include \"bdev.h\"\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <grp.h>\n#include <errno.h>\n#include <dirent.h>\n#include <ctype.h>\n#include \"config.h\"\n\nstatic void *must_realloc(void *orig, size_t sz)\n{\n\tvoid *ret;\n\n\tdo {\n\t\tret = realloc(orig, sz);\n\t} while (!ret);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ct_free",
          "args": [],
          "line": 438
        },
        "resolved": true,
        "details": {
          "function_name": "ct_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "419-431",
          "snippet": "static void ct_free(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ct_alloc_cnt; i++) {\n\t\tif (ct[i].c) {\n\t\t\tlxc_container_put(ct[i].c);\n\t\t\tct[i].c = NULL;\n\t\t}\n\t\tfree(ct[i].stats);\n\t\tct[i].stats = NULL;\n\t}\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct ct *ct = NULL;",
            "static int ct_alloc_cnt = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct ct *ct = NULL;\nstatic int ct_alloc_cnt = 0;\n\nstatic void ct_free(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ct_alloc_cnt; i++) {\n\t\tif (ct[i].c) {\n\t\t\tlxc_container_put(ct[i].c);\n\t\t\tct[i].c = NULL;\n\t\t}\n\t\tfree(ct[i].stats);\n\t\tct[i].stats = NULL;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct ct *ct = NULL;\nstatic int ct_alloc_cnt = 0;\n\nstatic void ct_realloc(int active_cnt)\n{\n\tint i;\n\n\tif (active_cnt > ct_alloc_cnt) {\n\t\tct_free();\n\t\tct = realloc(ct, sizeof(*ct) * active_cnt);\n\t\tif (!ct) {\n\t\t\tERROR(\"cannot alloc mem\");\n\t\t\texit(EXIT_FAILURE);\n\t\t}\n\t\tfor (i = 0; i < active_cnt; i++) {\n\t\t\tct[i].stats = malloc(sizeof(*ct[0].stats));\n\t\t\tif (!ct[i].stats) {\n\t\t\t\tERROR(\"cannot alloc mem\");\n\t\t\t\texit(EXIT_FAILURE);\n\t\t\t}\n\t\t}\n\t\tct_alloc_cnt = active_cnt;\n\t}\n}"
  },
  {
    "function_name": "ct_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "419-431",
    "snippet": "static void ct_free(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ct_alloc_cnt; i++) {\n\t\tif (ct[i].c) {\n\t\t\tlxc_container_put(ct[i].c);\n\t\t\tct[i].c = NULL;\n\t\t}\n\t\tfree(ct[i].stats);\n\t\tct[i].stats = NULL;\n\t}\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct ct *ct = NULL;",
      "static int ct_alloc_cnt = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ct[i].stats"
          ],
          "line": 428
        },
        "resolved": true,
        "details": {
          "function_name": "free_mnts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_copy.c",
          "lines": "539-554",
          "snippet": "static void free_mnts()\n{\n\tunsigned int i;\n\tstruct mnts *n = NULL;\n\n\tfor (i = 0, n = mnt_table; i < mnt_table_size; i++, n++) {\n\t\tfree(n->src);\n\t\tfree(n->dest);\n\t\tfree(n->options);\n\t\tfree(n->upper);\n\t\tfree(n->workdir);\n\t}\n\tfree(mnt_table);\n\tmnt_table = NULL;\n\tmnt_table_size = 0;\n}",
          "includes": [
            "#include <../include/getsubopt.h>",
            "#include \"utils.h\"",
            "#include \"state.h\"",
            "#include \"conf.h\"",
            "#include \"lxc.h\"",
            "#include \"arguments.h\"",
            "#include \"confile.h\"",
            "#include \"log.h\"",
            "#include \"bdev.h\"",
            "#include \"attach.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <stdbool.h>",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <sys/wait.h>",
            "#include <stdint.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <getopt.h>",
            "#include <unistd.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static unsigned int mnt_table_size = 0;",
            "static struct mnts *mnt_table = NULL;",
            "static void free_mnts(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <../include/getsubopt.h>\n#include \"utils.h\"\n#include \"state.h\"\n#include \"conf.h\"\n#include \"lxc.h\"\n#include \"arguments.h\"\n#include \"confile.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include \"attach.h\"\n#include <lxc/lxccontainer.h>\n#include <stdbool.h>\n#include <time.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <sys/wait.h>\n#include <stdint.h>\n#include <sys/types.h>\n#include <stdio.h>\n#include <signal.h>\n#include <getopt.h>\n#include <unistd.h>\n#include \"config.h\"\n\nstatic unsigned int mnt_table_size = 0;\nstatic struct mnts *mnt_table = NULL;\nstatic void free_mnts(void);\n\nstatic void free_mnts()\n{\n\tunsigned int i;\n\tstruct mnts *n = NULL;\n\n\tfor (i = 0, n = mnt_table; i < mnt_table_size; i++, n++) {\n\t\tfree(n->src);\n\t\tfree(n->dest);\n\t\tfree(n->options);\n\t\tfree(n->upper);\n\t\tfree(n->workdir);\n\t}\n\tfree(mnt_table);\n\tmnt_table = NULL;\n\tmnt_table_size = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_container_put",
          "args": [
            "ct[i].c"
          ],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_container_put",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lxccontainer.c",
          "lines": "312-325",
          "snippet": "int lxc_container_put(struct lxc_container *c)\n{\n\tif (!c)\n\t\treturn -1;\n\tif (container_mem_lock(c))\n\t\treturn -1;\n\tif (--c->numthreads < 1) {\n\t\tcontainer_mem_unlock(c);\n\t\tlxc_container_free(c);\n\t\treturn 1;\n\t}\n\tcontainer_mem_unlock(c);\n\treturn 0;\n}",
          "includes": [
            "#include <mntent.h>",
            "#include <../include/lxcmntent.h>",
            "#include <../include/ifaddrs.h>",
            "#include <ifaddrs.h>",
            "#    include <sys/sysmacros.h>",
            "#    include <sys/mkdev.h>",
            "#include \"version.h\"",
            "#include \"utils.h\"",
            "#include \"state.h\"",
            "#include \"sync.h\"",
            "#include \"network.h\"",
            "#include \"namespace.h\"",
            "#include \"monitor.h\"",
            "#include \"lxclock.h\"",
            "#include \"lxccontainer.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"criu.h\"",
            "#include \"console.h\"",
            "#include \"confile.h\"",
            "#include \"commands.h\"",
            "#include \"config.h\"",
            "#include \"conf.h\"",
            "#include \"cgroup.h\"",
            "#include \"lxcbtrfs.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"bdev.h\"",
            "#include \"attach.h\"",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <arpa/inet.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <sched.h>",
            "#include <pthread.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool do_lxcapi_destroy(struct lxc_container *c);",
            "static const char *lxcapi_get_config_path(struct lxc_container *c);",
            "static bool container_destroy(struct lxc_container *c);",
            "static bool lxcapi_snapshot_destroy_all(struct lxc_container *c);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <mntent.h>\n#include <../include/lxcmntent.h>\n#include <../include/ifaddrs.h>\n#include <ifaddrs.h>\n#    include <sys/sysmacros.h>\n#    include <sys/mkdev.h>\n#include \"version.h\"\n#include \"utils.h\"\n#include \"state.h\"\n#include \"sync.h\"\n#include \"network.h\"\n#include \"namespace.h\"\n#include \"monitor.h\"\n#include \"lxclock.h\"\n#include \"lxccontainer.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"criu.h\"\n#include \"console.h\"\n#include \"confile.h\"\n#include \"commands.h\"\n#include \"config.h\"\n#include \"conf.h\"\n#include \"cgroup.h\"\n#include \"lxcbtrfs.h\"\n#include \"lxcoverlay.h\"\n#include \"bdev.h\"\n#include \"attach.h\"\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <sched.h>\n#include <pthread.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n\nstatic bool do_lxcapi_destroy(struct lxc_container *c);\nstatic const char *lxcapi_get_config_path(struct lxc_container *c);\nstatic bool container_destroy(struct lxc_container *c);\nstatic bool lxcapi_snapshot_destroy_all(struct lxc_container *c);\n\nint lxc_container_put(struct lxc_container *c)\n{\n\tif (!c)\n\t\treturn -1;\n\tif (container_mem_lock(c))\n\t\treturn -1;\n\tif (--c->numthreads < 1) {\n\t\tcontainer_mem_unlock(c);\n\t\tlxc_container_free(c);\n\t\treturn 1;\n\t}\n\tcontainer_mem_unlock(c);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct ct *ct = NULL;\nstatic int ct_alloc_cnt = 0;\n\nstatic void ct_free(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ct_alloc_cnt; i++) {\n\t\tif (ct[i].c) {\n\t\t\tlxc_container_put(ct[i].c);\n\t\t\tct[i].c = NULL;\n\t\t}\n\t\tfree(ct[i].stats);\n\t\tct[i].stats = NULL;\n\t}\n}"
  },
  {
    "function_name": "ct_sort",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "404-417",
    "snippet": "static void ct_sort(int active)\n{\n\tint (*cmp_func)(const void *, const void *);\n\n\tswitch(sort_by) {\n\tdefault:\n\tcase 'n': cmp_func = cmp_name; break;\n\tcase 'c': cmp_func = cmp_cpuuse; break;\n\tcase 'b': cmp_func = cmp_blkio; break;\n\tcase 'm': cmp_func = cmp_memory; break;\n\tcase 'k': cmp_func = cmp_kmemory; break;\n\t}\n\tqsort(ct, active, sizeof(*ct), (int (*)(const void *,const void *))cmp_func);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char sort_by = 'n';",
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "qsort",
          "args": [
            "ct",
            "active",
            "sizeof(*ct)",
            "(int (*)(const void *,const void *))cmp_func"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic char sort_by = 'n';\nstatic struct ct *ct = NULL;\n\nstatic void ct_sort(int active)\n{\n\tint (*cmp_func)(const void *, const void *);\n\n\tswitch(sort_by) {\n\tdefault:\n\tcase 'n': cmp_func = cmp_name; break;\n\tcase 'c': cmp_func = cmp_cpuuse; break;\n\tcase 'b': cmp_func = cmp_blkio; break;\n\tcase 'm': cmp_func = cmp_memory; break;\n\tcase 'k': cmp_func = cmp_kmemory; break;\n\t}\n\tqsort(ct, active, sizeof(*ct), (int (*)(const void *,const void *))cmp_func);\n}"
  },
  {
    "function_name": "cmp_kmemory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "394-402",
    "snippet": "static int cmp_kmemory(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->kmem_used < ct1->stats->kmem_used;\n\treturn ct1->stats->kmem_used < ct2->stats->kmem_used;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int sort_reverse = 0;",
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int sort_reverse = 0;\nstatic struct ct *ct = NULL;\n\nstatic int cmp_kmemory(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->kmem_used < ct1->stats->kmem_used;\n\treturn ct1->stats->kmem_used < ct2->stats->kmem_used;\n}"
  },
  {
    "function_name": "cmp_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "384-392",
    "snippet": "static int cmp_memory(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->mem_used < ct1->stats->mem_used;\n\treturn ct1->stats->mem_used < ct2->stats->mem_used;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int sort_reverse = 0;",
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int sort_reverse = 0;\nstatic struct ct *ct = NULL;\n\nstatic int cmp_memory(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->mem_used < ct1->stats->mem_used;\n\treturn ct1->stats->mem_used < ct2->stats->mem_used;\n}"
  },
  {
    "function_name": "cmp_blkio",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "374-382",
    "snippet": "static int cmp_blkio(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->blkio < ct1->stats->blkio;\n\treturn ct1->stats->blkio < ct2->stats->blkio;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int sort_reverse = 0;",
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int sort_reverse = 0;\nstatic struct ct *ct = NULL;\n\nstatic int cmp_blkio(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->blkio < ct1->stats->blkio;\n\treturn ct1->stats->blkio < ct2->stats->blkio;\n}"
  },
  {
    "function_name": "cmp_cpuuse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "364-372",
    "snippet": "static int cmp_cpuuse(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->cpu_use_nanos < ct1->stats->cpu_use_nanos;\n\treturn ct1->stats->cpu_use_nanos < ct2->stats->cpu_use_nanos;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int sort_reverse = 0;",
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int sort_reverse = 0;\nstatic struct ct *ct = NULL;\n\nstatic int cmp_cpuuse(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn ct2->stats->cpu_use_nanos < ct1->stats->cpu_use_nanos;\n\treturn ct1->stats->cpu_use_nanos < ct2->stats->cpu_use_nanos;\n}"
  },
  {
    "function_name": "cmp_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "354-362",
    "snippet": "static int cmp_name(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn strcmp(ct2->c->name, ct1->c->name);\n\treturn strcmp(ct1->c->name, ct2->c->name);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int sort_reverse = 0;",
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "ct1->c->name",
            "ct2->c->name"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "ct2->c->name",
            "ct1->c->name"
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int sort_reverse = 0;\nstatic struct ct *ct = NULL;\n\nstatic int cmp_name(const void *sct1, const void *sct2)\n{\n\tconst struct ct *ct1 = sct1;\n\tconst struct ct *ct2 = sct2;\n\n\tif (sort_reverse)\n\t\treturn strcmp(ct2->c->name, ct1->c->name);\n\treturn strcmp(ct1->c->name, ct2->c->name);\n}"
  },
  {
    "function_name": "stats_print",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "316-352",
    "snippet": "static void stats_print(const char *name, const struct stats *stats,\n\t\t\tconst struct stats *total)\n{\n\tchar blkio_str[20];\n\tchar mem_used_str[20];\n\tchar kmem_used_str[20];\n\tstruct timeval time_val;\n\tunsigned long long time_ms;\n\n\tif (!batch) {\n\t\tsize_humanize(stats->blkio, blkio_str, sizeof(blkio_str));\n\t\tsize_humanize(stats->mem_used, mem_used_str, sizeof(mem_used_str));\n\n\t\tprintf(\"%-18.18s %12.2f %12.2f %12.2f %14s %10s\",\n\t\t       name,\n\t\t       (float)stats->cpu_use_nanos / 1000000000,\n\t\t       (float)stats->cpu_use_sys  / USER_HZ,\n\t\t       (float)stats->cpu_use_user / USER_HZ,\n\t\t       blkio_str,\n\t\t       mem_used_str);\n\t\tif (total->kmem_used > 0) {\n\t\t\tsize_humanize(stats->kmem_used, kmem_used_str, sizeof(kmem_used_str));\n\t\t\tprintf(\" %10s\", kmem_used_str);\n\t\t}\n\t} else {\n\t\tgettimeofday(&time_val, NULL);\n\t\ttime_ms = (unsigned long long) (time_val.tv_sec) * 1000 + (unsigned long long) (time_val.tv_usec) / 1000;\n\t\tprintf(\"%\" PRIu64 \",%s,%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64\n\t\t       \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64,\n\t\t       (uint64_t)time_ms, name, (uint64_t)stats->cpu_use_nanos,\n\t\t       (uint64_t)stats->cpu_use_sys,\n\t\t       (uint64_t)stats->cpu_use_user, (uint64_t)stats->blkio,\n\t\t       (uint64_t)stats->blkio_iops, (uint64_t)stats->mem_used,\n\t\t       (uint64_t)stats->kmem_used);\n\t}\n\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define USER_HZ   100"
    ],
    "globals_used": [
      "static int batch = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%\" PRIu64 \",%s,%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64\n\t\t       \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64",
            "(uint64_t)time_ms",
            "name",
            "(uint64_t)stats->cpu_use_nanos",
            "(uint64_t)stats->cpu_use_sys",
            "(uint64_t)stats->cpu_use_user",
            "(uint64_t)stats->blkio",
            "(uint64_t)stats->blkio_iops",
            "(uint64_t)stats->mem_used",
            "(uint64_t)stats->kmem_used"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gettimeofday",
          "args": [
            "&time_val",
            "NULL"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" %10s\"",
            "kmem_used_str"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "size_humanize",
          "args": [
            "stats->kmem_used",
            "kmem_used_str",
            "sizeof(kmem_used_str)"
          ],
          "line": 337
        },
        "resolved": true,
        "details": {
          "function_name": "size_humanize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "200-217",
          "snippet": "static void size_humanize(unsigned long long val, char *buf, size_t bufsz)\n{\n\tif (val > 1 << 30) {\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u GB\",\n\t\t\t    (int)(val >> 30),\n\t\t\t    (int)(val & ((1 << 30) - 1)) / 10737419);\n\t} else if (val > 1 << 20) {\n\t\tint x = val + 5243;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u MB\",\n\t\t\t    x >> 20, ((x & ((1 << 20) - 1)) * 100) >> 20);\n\t} else if (val > 1 << 10) {\n\t\tint x = val + 5;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u KB\",\n\t\t\t    x >> 10, ((x & ((1 << 10) - 1)) * 100) >> 10);\n\t} else {\n\t\tsnprintf(buf, bufsz, \"%3u.00   \", (int)val);\n\t}\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic void size_humanize(unsigned long long val, char *buf, size_t bufsz)\n{\n\tif (val > 1 << 30) {\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u GB\",\n\t\t\t    (int)(val >> 30),\n\t\t\t    (int)(val & ((1 << 30) - 1)) / 10737419);\n\t} else if (val > 1 << 20) {\n\t\tint x = val + 5243;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u MB\",\n\t\t\t    x >> 20, ((x & ((1 << 20) - 1)) * 100) >> 20);\n\t} else if (val > 1 << 10) {\n\t\tint x = val + 5;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u KB\",\n\t\t\t    x >> 10, ((x & ((1 << 10) - 1)) * 100) >> 10);\n\t} else {\n\t\tsnprintf(buf, bufsz, \"%3u.00   \", (int)val);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%-18.18s %12.2f %12.2f %12.2f %14s %10s\"",
            "name",
            "(float)stats->cpu_use_nanos / 1000000000",
            "(float)stats->cpu_use_sys  / USER_HZ",
            "(float)stats->cpu_use_user / USER_HZ",
            "blkio_str",
            "mem_used_str"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\n#define USER_HZ   100\n\nstatic int batch = 0;\n\nstatic void stats_print(const char *name, const struct stats *stats,\n\t\t\tconst struct stats *total)\n{\n\tchar blkio_str[20];\n\tchar mem_used_str[20];\n\tchar kmem_used_str[20];\n\tstruct timeval time_val;\n\tunsigned long long time_ms;\n\n\tif (!batch) {\n\t\tsize_humanize(stats->blkio, blkio_str, sizeof(blkio_str));\n\t\tsize_humanize(stats->mem_used, mem_used_str, sizeof(mem_used_str));\n\n\t\tprintf(\"%-18.18s %12.2f %12.2f %12.2f %14s %10s\",\n\t\t       name,\n\t\t       (float)stats->cpu_use_nanos / 1000000000,\n\t\t       (float)stats->cpu_use_sys  / USER_HZ,\n\t\t       (float)stats->cpu_use_user / USER_HZ,\n\t\t       blkio_str,\n\t\t       mem_used_str);\n\t\tif (total->kmem_used > 0) {\n\t\t\tsize_humanize(stats->kmem_used, kmem_used_str, sizeof(kmem_used_str));\n\t\t\tprintf(\" %10s\", kmem_used_str);\n\t\t}\n\t} else {\n\t\tgettimeofday(&time_val, NULL);\n\t\ttime_ms = (unsigned long long) (time_val.tv_sec) * 1000 + (unsigned long long) (time_val.tv_usec) / 1000;\n\t\tprintf(\"%\" PRIu64 \",%s,%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64\n\t\t       \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64 \",%\" PRIu64,\n\t\t       (uint64_t)time_ms, name, (uint64_t)stats->cpu_use_nanos,\n\t\t       (uint64_t)stats->cpu_use_sys,\n\t\t       (uint64_t)stats->cpu_use_user, (uint64_t)stats->blkio,\n\t\t       (uint64_t)stats->blkio_iops, (uint64_t)stats->mem_used,\n\t\t       (uint64_t)stats->kmem_used);\n\t}\n\n}"
  },
  {
    "function_name": "stats_print_header",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "301-314",
    "snippet": "static void stats_print_header(struct stats *stats)\n{\n\tprintf(TERMRVRS TERMBOLD);\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Container\", \"CPU\",  \"CPU\",  \"CPU\",  \"BlkIO\", \"Mem\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"KMem\");\n\tprintf(\"\\n\");\n\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Name\",      \"Used\", \"Sys\",  \"User\", \"Total\", \"Used\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"Used\");\n\tprintf(\"\\n\");\n\tprintf(TERMNORM);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define TERMRVRS  ESC \"[7m\"",
      "#define TERMBOLD  ESC \"[1m\"",
      "#define TERMNORM  ESC \"[0m\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "TERMNORM"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" %10s\"",
            "\"Used\""
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%-18s %12s %12s %12s %14s %10s\"",
            "\"Name\"",
            "\"Used\"",
            "\"Sys\"",
            "\"User\"",
            "\"Total\"",
            "\"Used\""
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" %10s\"",
            "\"KMem\""
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%-18s %12s %12s %12s %14s %10s\"",
            "\"Container\"",
            "\"CPU\"",
            "\"CPU\"",
            "\"CPU\"",
            "\"BlkIO\"",
            "\"Mem\""
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\n#define TERMRVRS  ESC \"[7m\"\n#define TERMBOLD  ESC \"[1m\"\n#define TERMNORM  ESC \"[0m\"\n\nstatic void stats_print_header(struct stats *stats)\n{\n\tprintf(TERMRVRS TERMBOLD);\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Container\", \"CPU\",  \"CPU\",  \"CPU\",  \"BlkIO\", \"Mem\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"KMem\");\n\tprintf(\"\\n\");\n\n\tprintf(\"%-18s %12s %12s %12s %14s %10s\", \"Name\",      \"Used\", \"Sys\",  \"User\", \"Total\", \"Used\");\n\tif (stats->kmem_used > 0)\n\t\tprintf(\" %10s\", \"Used\");\n\tprintf(\"\\n\");\n\tprintf(TERMNORM);\n}"
  },
  {
    "function_name": "stats_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "276-299",
    "snippet": "static void stats_get(struct lxc_container *c, struct ct *ct, struct stats *total)\n{\n\tct->c = c;\n\tct->stats->mem_used      = stat_get_int(c, \"memory.usage_in_bytes\");\n\tct->stats->mem_limit     = stat_get_int(c, \"memory.limit_in_bytes\");\n\tct->stats->kmem_used     = stat_get_int(c, \"memory.kmem.usage_in_bytes\");\n\tct->stats->kmem_limit    = stat_get_int(c, \"memory.kmem.limit_in_bytes\");\n\tct->stats->cpu_use_nanos = stat_get_int(c, \"cpuacct.usage\");\n\tct->stats->cpu_use_user  = stat_match_get_int(c, \"cpuacct.stat\", \"user\", 1);\n\tct->stats->cpu_use_sys   = stat_match_get_int(c, \"cpuacct.stat\", \"system\", 1);\n\tct->stats->blkio         = stat_match_get_int(c, \"blkio.throttle.io_service_bytes\", \"Total\", 1);\n\tct->stats->blkio_iops    = stat_match_get_int(c, \"blkio.throttle.io_serviced\", \"Total\", 1);\n\n\tif (total) {\n\t\ttotal->mem_used      = total->mem_used      + ct->stats->mem_used;\n\t\ttotal->mem_limit     = total->mem_limit     + ct->stats->mem_limit;\n\t\ttotal->kmem_used     = total->kmem_used     + ct->stats->kmem_used;\n\t\ttotal->kmem_limit    = total->kmem_limit    + ct->stats->kmem_limit;\n\t\ttotal->cpu_use_nanos = total->cpu_use_nanos + ct->stats->cpu_use_nanos;\n\t\ttotal->cpu_use_user  = total->cpu_use_user  + ct->stats->cpu_use_user;\n\t\ttotal->cpu_use_sys   = total->cpu_use_sys   + ct->stats->cpu_use_sys;\n\t\ttotal->blkio         = total->blkio         + ct->stats->blkio;\n\t}\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct ct *ct = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "stat_match_get_int",
          "args": [
            "c",
            "\"blkio.throttle.io_serviced\"",
            "\"Total\"",
            "1"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "stat_match_get_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "235-274",
          "snippet": "static uint64_t stat_match_get_int(struct lxc_container *c, const char *item,\n\t\t\t\t   const char *match, int column)\n{\n\tchar buf[4096];\n\tint i,j,len;\n\tuint64_t val = 0;\n\tchar **lines, **cols;\n\tsize_t matchlen;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\tgoto out;\n\t}\n\n\tlines = lxc_string_split_and_trim(buf, '\\n');\n\tif (!lines)\n\t\tgoto out;\n\n\tmatchlen = strlen(match);\n\tfor (i = 0; lines[i]; i++) {\n\t\tif (strncmp(lines[i], match, matchlen) == 0) {\n\t\t\tcols = lxc_string_split_and_trim(lines[i], ' ');\n\t\t\tif (!cols)\n\t\t\t\tgoto err1;\n\t\t\tfor (j = 0; cols[j]; j++) {\n\t\t\t\tif (j == column) {\n\t\t\t\t\tval = strtoull(cols[j], NULL, 0);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlxc_free_array((void **)cols, free);\n\t\t\tbreak;\n\t\t}\n\t}\nerr1:\n\tlxc_free_array((void **)lines, free);\nout:\n\treturn val;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic uint64_t stat_match_get_int(struct lxc_container *c, const char *item,\n\t\t\t\t   const char *match, int column)\n{\n\tchar buf[4096];\n\tint i,j,len;\n\tuint64_t val = 0;\n\tchar **lines, **cols;\n\tsize_t matchlen;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\tgoto out;\n\t}\n\n\tlines = lxc_string_split_and_trim(buf, '\\n');\n\tif (!lines)\n\t\tgoto out;\n\n\tmatchlen = strlen(match);\n\tfor (i = 0; lines[i]; i++) {\n\t\tif (strncmp(lines[i], match, matchlen) == 0) {\n\t\t\tcols = lxc_string_split_and_trim(lines[i], ' ');\n\t\t\tif (!cols)\n\t\t\t\tgoto err1;\n\t\t\tfor (j = 0; cols[j]; j++) {\n\t\t\t\tif (j == column) {\n\t\t\t\t\tval = strtoull(cols[j], NULL, 0);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlxc_free_array((void **)cols, free);\n\t\t\tbreak;\n\t\t}\n\t}\nerr1:\n\tlxc_free_array((void **)lines, free);\nout:\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "stat_get_int",
          "args": [
            "c",
            "\"cpuacct.usage\""
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "stat_get_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
          "lines": "219-233",
          "snippet": "static uint64_t stat_get_int(struct lxc_container *c, const char *item)\n{\n\tchar buf[80];\n\tint len;\n\tuint64_t val;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\treturn 0;\n\t}\n\n\tval = strtoull(buf, NULL, 0);\n\treturn val;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"mainloop.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"arguments.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/epoll.h>",
            "#include <unistd.h>",
            "#include <termios.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdbool.h>",
            "#include <signal.h>",
            "#include <inttypes.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic uint64_t stat_get_int(struct lxc_container *c, const char *item)\n{\n\tchar buf[80];\n\tint len;\n\tuint64_t val;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\treturn 0;\n\t}\n\n\tval = strtoull(buf, NULL, 0);\n\treturn val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct ct *ct = NULL;\n\nstatic void stats_get(struct lxc_container *c, struct ct *ct, struct stats *total)\n{\n\tct->c = c;\n\tct->stats->mem_used      = stat_get_int(c, \"memory.usage_in_bytes\");\n\tct->stats->mem_limit     = stat_get_int(c, \"memory.limit_in_bytes\");\n\tct->stats->kmem_used     = stat_get_int(c, \"memory.kmem.usage_in_bytes\");\n\tct->stats->kmem_limit    = stat_get_int(c, \"memory.kmem.limit_in_bytes\");\n\tct->stats->cpu_use_nanos = stat_get_int(c, \"cpuacct.usage\");\n\tct->stats->cpu_use_user  = stat_match_get_int(c, \"cpuacct.stat\", \"user\", 1);\n\tct->stats->cpu_use_sys   = stat_match_get_int(c, \"cpuacct.stat\", \"system\", 1);\n\tct->stats->blkio         = stat_match_get_int(c, \"blkio.throttle.io_service_bytes\", \"Total\", 1);\n\tct->stats->blkio_iops    = stat_match_get_int(c, \"blkio.throttle.io_serviced\", \"Total\", 1);\n\n\tif (total) {\n\t\ttotal->mem_used      = total->mem_used      + ct->stats->mem_used;\n\t\ttotal->mem_limit     = total->mem_limit     + ct->stats->mem_limit;\n\t\ttotal->kmem_used     = total->kmem_used     + ct->stats->kmem_used;\n\t\ttotal->kmem_limit    = total->kmem_limit    + ct->stats->kmem_limit;\n\t\ttotal->cpu_use_nanos = total->cpu_use_nanos + ct->stats->cpu_use_nanos;\n\t\ttotal->cpu_use_user  = total->cpu_use_user  + ct->stats->cpu_use_user;\n\t\ttotal->cpu_use_sys   = total->cpu_use_sys   + ct->stats->cpu_use_sys;\n\t\ttotal->blkio         = total->blkio         + ct->stats->blkio;\n\t}\n}"
  },
  {
    "function_name": "stat_match_get_int",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "235-274",
    "snippet": "static uint64_t stat_match_get_int(struct lxc_container *c, const char *item,\n\t\t\t\t   const char *match, int column)\n{\n\tchar buf[4096];\n\tint i,j,len;\n\tuint64_t val = 0;\n\tchar **lines, **cols;\n\tsize_t matchlen;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\tgoto out;\n\t}\n\n\tlines = lxc_string_split_and_trim(buf, '\\n');\n\tif (!lines)\n\t\tgoto out;\n\n\tmatchlen = strlen(match);\n\tfor (i = 0; lines[i]; i++) {\n\t\tif (strncmp(lines[i], match, matchlen) == 0) {\n\t\t\tcols = lxc_string_split_and_trim(lines[i], ' ');\n\t\t\tif (!cols)\n\t\t\t\tgoto err1;\n\t\t\tfor (j = 0; cols[j]; j++) {\n\t\t\t\tif (j == column) {\n\t\t\t\t\tval = strtoull(cols[j], NULL, 0);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlxc_free_array((void **)cols, free);\n\t\t\tbreak;\n\t\t}\n\t}\nerr1:\n\tlxc_free_array((void **)lines, free);\nout:\n\treturn val;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_free_array",
          "args": [
            "(void **)lines",
            "free"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_free_array",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "886-892",
          "snippet": "void lxc_free_array(void **array, lxc_free_fn element_free_fn)\n{\n\tvoid **p;\n\tfor (p = array; p && *p; p++)\n\t\telement_free_fn(*p);\n\tfree((void*)array);\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nvoid lxc_free_array(void **array, lxc_free_fn element_free_fn)\n{\n\tvoid **p;\n\tfor (p = array; p && *p; p++)\n\t\telement_free_fn(*p);\n\tfree((void*)array);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strtoull",
          "args": [
            "cols[j]",
            "NULL",
            "0"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_string_split_and_trim",
          "args": [
            "lines[i]",
            "' '"
          ],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_string_split_and_trim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "845-884",
          "snippet": "char **lxc_string_split_and_trim(const char *string, char _sep)\n{\n\tchar *token, *str, *saveptr = NULL;\n\tchar sep[2] = { _sep, '\\0' };\n\tchar **result = NULL;\n\tsize_t result_capacity = 0;\n\tsize_t result_count = 0;\n\tint r, saved_errno;\n\tsize_t i = 0;\n\n\tif (!string)\n\t\treturn calloc(1, sizeof(char *));\n\n\tstr = alloca(strlen(string)+1);\n\tstrcpy(str, string);\n\tfor (; (token = strtok_r(str, sep, &saveptr)); str = NULL) {\n\t\twhile (token[0] == ' ' || token[0] == '\\t')\n\t\t\ttoken++;\n\t\ti = strlen(token);\n\t\twhile (i > 0 && (token[i - 1] == ' ' || token[i - 1] == '\\t')) {\n\t\t\ttoken[i - 1] = '\\0';\n\t\t\ti--;\n\t\t}\n\t\tr = lxc_grow_array((void ***)&result, &result_capacity, result_count + 1, 16);\n\t\tif (r < 0)\n\t\t\tgoto error_out;\n\t\tresult[result_count] = strdup(token);\n\t\tif (!result[result_count])\n\t\t\tgoto error_out;\n\t\tresult_count++;\n\t}\n\n\t/* if we allocated too much, reduce it */\n\treturn realloc(result, (result_count + 1) * sizeof(char *));\nerror_out:\n\tsaved_errno = errno;\n\tlxc_free_array((void **)result, free);\n\terrno = saved_errno;\n\treturn NULL;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nchar **lxc_string_split_and_trim(const char *string, char _sep)\n{\n\tchar *token, *str, *saveptr = NULL;\n\tchar sep[2] = { _sep, '\\0' };\n\tchar **result = NULL;\n\tsize_t result_capacity = 0;\n\tsize_t result_count = 0;\n\tint r, saved_errno;\n\tsize_t i = 0;\n\n\tif (!string)\n\t\treturn calloc(1, sizeof(char *));\n\n\tstr = alloca(strlen(string)+1);\n\tstrcpy(str, string);\n\tfor (; (token = strtok_r(str, sep, &saveptr)); str = NULL) {\n\t\twhile (token[0] == ' ' || token[0] == '\\t')\n\t\t\ttoken++;\n\t\ti = strlen(token);\n\t\twhile (i > 0 && (token[i - 1] == ' ' || token[i - 1] == '\\t')) {\n\t\t\ttoken[i - 1] = '\\0';\n\t\t\ti--;\n\t\t}\n\t\tr = lxc_grow_array((void ***)&result, &result_capacity, result_count + 1, 16);\n\t\tif (r < 0)\n\t\t\tgoto error_out;\n\t\tresult[result_count] = strdup(token);\n\t\tif (!result[result_count])\n\t\t\tgoto error_out;\n\t\tresult_count++;\n\t}\n\n\t/* if we allocated too much, reduce it */\n\treturn realloc(result, (result_count + 1) * sizeof(char *));\nerror_out:\n\tsaved_errno = errno;\n\tlxc_free_array((void **)result, free);\n\terrno = saved_errno;\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "lines[i]",
            "match",
            "matchlen"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "match"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"unable to read cgroup item %s\"",
            "item"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_cgroup_item",
          "args": [
            "c",
            "item",
            "buf",
            "sizeof(buf)"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic uint64_t stat_match_get_int(struct lxc_container *c, const char *item,\n\t\t\t\t   const char *match, int column)\n{\n\tchar buf[4096];\n\tint i,j,len;\n\tuint64_t val = 0;\n\tchar **lines, **cols;\n\tsize_t matchlen;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\tgoto out;\n\t}\n\n\tlines = lxc_string_split_and_trim(buf, '\\n');\n\tif (!lines)\n\t\tgoto out;\n\n\tmatchlen = strlen(match);\n\tfor (i = 0; lines[i]; i++) {\n\t\tif (strncmp(lines[i], match, matchlen) == 0) {\n\t\t\tcols = lxc_string_split_and_trim(lines[i], ' ');\n\t\t\tif (!cols)\n\t\t\t\tgoto err1;\n\t\t\tfor (j = 0; cols[j]; j++) {\n\t\t\t\tif (j == column) {\n\t\t\t\t\tval = strtoull(cols[j], NULL, 0);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlxc_free_array((void **)cols, free);\n\t\t\tbreak;\n\t\t}\n\t}\nerr1:\n\tlxc_free_array((void **)lines, free);\nout:\n\treturn val;\n}"
  },
  {
    "function_name": "stat_get_int",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "219-233",
    "snippet": "static uint64_t stat_get_int(struct lxc_container *c, const char *item)\n{\n\tchar buf[80];\n\tint len;\n\tuint64_t val;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\treturn 0;\n\t}\n\n\tval = strtoull(buf, NULL, 0);\n\treturn val;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strtoull",
          "args": [
            "buf",
            "NULL",
            "0"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"unable to read cgroup item %s\"",
            "item"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_cgroup_item",
          "args": [
            "c",
            "item",
            "buf",
            "sizeof(buf)"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic uint64_t stat_get_int(struct lxc_container *c, const char *item)\n{\n\tchar buf[80];\n\tint len;\n\tuint64_t val;\n\n\tlen = c->get_cgroup_item(c, item, buf, sizeof(buf));\n\tif (len <= 0) {\n\t\tERROR(\"unable to read cgroup item %s\", item);\n\t\treturn 0;\n\t}\n\n\tval = strtoull(buf, NULL, 0);\n\treturn val;\n}"
  },
  {
    "function_name": "size_humanize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "200-217",
    "snippet": "static void size_humanize(unsigned long long val, char *buf, size_t bufsz)\n{\n\tif (val > 1 << 30) {\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u GB\",\n\t\t\t    (int)(val >> 30),\n\t\t\t    (int)(val & ((1 << 30) - 1)) / 10737419);\n\t} else if (val > 1 << 20) {\n\t\tint x = val + 5243;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u MB\",\n\t\t\t    x >> 20, ((x & ((1 << 20) - 1)) * 100) >> 20);\n\t} else if (val > 1 << 10) {\n\t\tint x = val + 5;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u KB\",\n\t\t\t    x >> 10, ((x & ((1 << 10) - 1)) * 100) >> 10);\n\t} else {\n\t\tsnprintf(buf, bufsz, \"%3u.00   \", (int)val);\n\t}\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "bufsz",
            "\"%3u.00   \"",
            "(int)val"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "bufsz",
            "\"%u.%2.2u KB\"",
            "x >> 10",
            "((x & ((1 << 10) - 1)) * 100) >> 10"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "bufsz",
            "\"%u.%2.2u MB\"",
            "x >> 20",
            "((x & ((1 << 20) - 1)) * 100) >> 20"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "bufsz",
            "\"%u.%2.2u GB\"",
            "(int)(val >> 30)",
            "(int)(val & ((1 << 30) - 1)) / 10737419"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic void size_humanize(unsigned long long val, char *buf, size_t bufsz)\n{\n\tif (val > 1 << 30) {\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u GB\",\n\t\t\t    (int)(val >> 30),\n\t\t\t    (int)(val & ((1 << 30) - 1)) / 10737419);\n\t} else if (val > 1 << 20) {\n\t\tint x = val + 5243;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u MB\",\n\t\t\t    x >> 20, ((x & ((1 << 20) - 1)) * 100) >> 20);\n\t} else if (val > 1 << 10) {\n\t\tint x = val + 5;  /* for rounding */\n\t\tsnprintf(buf, bufsz, \"%u.%2.2u KB\",\n\t\t\t    x >> 10, ((x & ((1 << 10) - 1)) * 100) >> 10);\n\t} else {\n\t\tsnprintf(buf, bufsz, \"%3u.00   \", (int)val);\n\t}\n}"
  },
  {
    "function_name": "sig_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "195-198",
    "snippet": "static void sig_handler(int sig)\n{\n\texit(EXIT_SUCCESS);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic void sig_handler(int sig)\n{\n\texit(EXIT_SUCCESS);\n}"
  },
  {
    "function_name": "stdin_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "177-193",
    "snippet": "static int stdin_handler(int fd, uint32_t events, void *data,\n\t\t\t struct lxc_epoll_descr *descr)\n{\n\tchar *in_char = data;\n\n\tif (events & EPOLLIN) {\n\t\tint rc;\n\n\t\trc = read(fd, in_char, sizeof(*in_char));\n\t\tif (rc <= 0)\n\t\t\t*in_char = '\\0';\n\t}\n\n\tif (events & EPOLLHUP)\n\t\t*in_char = 'q';\n\treturn 1;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "in_char",
            "sizeof(*in_char)"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "read_default_map",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_usernsexec.c",
          "lines": "201-251",
          "snippet": "static int read_default_map(char *fnam, int which, char *username)\n{\n\tFILE *fin;\n\tchar *line = NULL;\n\tsize_t sz = 0;\n\tstruct id_map *newmap;\n\tstruct lxc_list *tmp = NULL;\n\tchar *p1, *p2;\n\n\tfin = fopen(fnam, \"r\");\n\tif (!fin)\n\t\treturn -1;\n\twhile (getline(&line, &sz, fin) != -1) {\n\t\tif (sz <= strlen(username) ||\n\t\t    strncmp(line, username, strlen(username)) != 0 ||\n\t\t    line[strlen(username)] != ':')\n\t\t\tcontinue;\n\t\tp1 = strchr(line, ':');\n\t\tif (!p1)\n\t\t\tcontinue;\n\t\tp2 = strchr(p1+1, ':');\n\t\tif (!p2)\n\t\t\tcontinue;\n\t\tnewmap = malloc(sizeof(*newmap));\n\t\tif (!newmap)  {\n\t\t\tfclose(fin);\n\t\t\tfree(line);\n\t\t\treturn -1;\n\t\t}\n\t\tnewmap->hostid = atol(p1+1);\n\t\tnewmap->range = atol(p2+1);\n\t\tnewmap->nsid = 0;\n\t\tnewmap->idtype = which;\n\n\t\ttmp = malloc(sizeof(*tmp));\n\t\tif (!tmp) {\n\t\t\tfclose(fin);\n\t\t\tfree(line);\n\t\t\tfree(newmap);\n\t\t\treturn -1;\n\t\t}\n\n\t\ttmp->elem = newmap;\n\t\tlxc_list_add_tail(&active_map, tmp);\n\t\tbreak;\n\t}\n\n\tfree(line);\n\tfclose(fin);\n\treturn 0;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"conf.h\"",
            "#include <grp.h>",
            "#include <pwd.h>",
            "#include <sched.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <libgen.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <signal.h>",
            "#include <sys/syscall.h>",
            "#include <sched.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct lxc_list active_map;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"namespace.h\"\n#include \"conf.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <sched.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <libgen.h>\n#include <errno.h>\n#include <string.h>\n#include <signal.h>\n#include <sys/syscall.h>\n#include <sched.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic struct lxc_list active_map;\n\nstatic int read_default_map(char *fnam, int which, char *username)\n{\n\tFILE *fin;\n\tchar *line = NULL;\n\tsize_t sz = 0;\n\tstruct id_map *newmap;\n\tstruct lxc_list *tmp = NULL;\n\tchar *p1, *p2;\n\n\tfin = fopen(fnam, \"r\");\n\tif (!fin)\n\t\treturn -1;\n\twhile (getline(&line, &sz, fin) != -1) {\n\t\tif (sz <= strlen(username) ||\n\t\t    strncmp(line, username, strlen(username)) != 0 ||\n\t\t    line[strlen(username)] != ':')\n\t\t\tcontinue;\n\t\tp1 = strchr(line, ':');\n\t\tif (!p1)\n\t\t\tcontinue;\n\t\tp2 = strchr(p1+1, ':');\n\t\tif (!p2)\n\t\t\tcontinue;\n\t\tnewmap = malloc(sizeof(*newmap));\n\t\tif (!newmap)  {\n\t\t\tfclose(fin);\n\t\t\tfree(line);\n\t\t\treturn -1;\n\t\t}\n\t\tnewmap->hostid = atol(p1+1);\n\t\tnewmap->range = atol(p2+1);\n\t\tnewmap->nsid = 0;\n\t\tnewmap->idtype = which;\n\n\t\ttmp = malloc(sizeof(*tmp));\n\t\tif (!tmp) {\n\t\t\tfclose(fin);\n\t\t\tfree(line);\n\t\t\tfree(newmap);\n\t\t\treturn -1;\n\t\t}\n\n\t\ttmp->elem = newmap;\n\t\tlxc_list_add_tail(&active_map, tmp);\n\t\tbreak;\n\t}\n\n\tfree(line);\n\tfclose(fin);\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int stdin_handler(int fd, uint32_t events, void *data,\n\t\t\t struct lxc_epoll_descr *descr)\n{\n\tchar *in_char = data;\n\n\tif (events & EPOLLIN) {\n\t\tint rc;\n\n\t\trc = read(fd, in_char, sizeof(*in_char));\n\t\tif (rc <= 0)\n\t\t\t*in_char = '\\0';\n\t}\n\n\tif (events & EPOLLHUP)\n\t\t*in_char = 'q';\n\treturn 1;\n}"
  },
  {
    "function_name": "stdin_tios_rows",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "169-175",
    "snippet": "static int stdin_tios_rows(void)\n{\n\tstruct winsize wsz;\n\tif (isatty(0) && ioctl(0, TIOCGWINSZ, &wsz) == 0)\n\t\treturn wsz.ws_row;\n\treturn 25;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "0",
            "TIOCGWINSZ",
            "&wsz"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isatty",
          "args": [
            "0"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int stdin_tios_rows(void)\n{\n\tstruct winsize wsz;\n\tif (isatty(0) && ioctl(0, TIOCGWINSZ, &wsz) == 0)\n\t\treturn wsz.ws_row;\n\treturn 25;\n}"
  },
  {
    "function_name": "stdin_tios_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "138-167",
    "snippet": "static int stdin_tios_setup(void)\n{\n\tstruct termios newtios;\n\n\tif (!isatty(0)) {\n\t\tERROR(\"stdin is not a tty\");\n\t\treturn -1;\n\t}\n\n\tif (tcgetattr(0, &oldtios)) {\n\t\tSYSERROR(\"failed to get current terminal settings\");\n\t\treturn -1;\n\t}\n\n\tnewtios = oldtios;\n\n\t/* turn off echo and line buffering */\n\tnewtios.c_iflag &= ~IGNBRK;\n\tnewtios.c_iflag &= BRKINT;\n\tnewtios.c_lflag &= ~(ECHO|ICANON);\n\tnewtios.c_cc[VMIN] = 1;\n\tnewtios.c_cc[VTIME] = 0;\n\n\tif (tcsetattr(0, TCSAFLUSH, &newtios)) {\n\t\tERROR(\"failed to set new terminal settings\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct termios oldtios;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"failed to set new terminal settings\""
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcsetattr",
          "args": [
            "0",
            "TCSAFLUSH",
            "&newtios"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SYSERROR",
          "args": [
            "\"failed to get current terminal settings\""
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcgetattr",
          "args": [
            "0",
            "&oldtios"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"stdin is not a tty\""
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isatty",
          "args": [
            "0"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct termios oldtios;\n\nstatic int stdin_tios_setup(void)\n{\n\tstruct termios newtios;\n\n\tif (!isatty(0)) {\n\t\tERROR(\"stdin is not a tty\");\n\t\treturn -1;\n\t}\n\n\tif (tcgetattr(0, &oldtios)) {\n\t\tSYSERROR(\"failed to get current terminal settings\");\n\t\treturn -1;\n\t}\n\n\tnewtios = oldtios;\n\n\t/* turn off echo and line buffering */\n\tnewtios.c_iflag &= ~IGNBRK;\n\tnewtios.c_iflag &= BRKINT;\n\tnewtios.c_lflag &= ~(ECHO|ICANON);\n\tnewtios.c_cc[VMIN] = 1;\n\tnewtios.c_cc[VTIME] = 0;\n\n\tif (tcsetattr(0, TCSAFLUSH, &newtios)) {\n\t\tERROR(\"failed to set new terminal settings\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "stdin_tios_restore",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "132-136",
    "snippet": "static void stdin_tios_restore(void)\n{\n\ttcsetattr(0, TCSAFLUSH, &oldtios);\n\tfprintf(stderr, \"\\n\");\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct termios oldtios;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\n\""
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcsetattr",
          "args": [
            "0",
            "TCSAFLUSH",
            "&oldtios"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic struct termios oldtios;\n\nstatic void stdin_tios_restore(void)\n{\n\ttcsetattr(0, TCSAFLUSH, &oldtios);\n\tfprintf(stderr, \"\\n\");\n}"
  },
  {
    "function_name": "my_parser",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/tools/lxc_top.c",
    "lines": "79-98",
    "snippet": "static int my_parser(struct lxc_arguments* args, int c, char* arg)\n{\n\tswitch (c) {\n\tcase 'd':\n\t\tdelay_set = 1;\n\t\tif (lxc_safe_int(arg, &delay) < 0)\n\t\t\treturn -1;\n\t\tbreak;\n\tcase 'b':\n\t\tbatch=1;\n\t\tbreak;\n\tcase 's':\n\t\tsort_by = arg[0];\n\t\tbreak;\n\tcase 'r':\n\t\tsort_reverse = 1;\n\t\tbreak;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"mainloop.h\"",
      "#include \"lxc.h\"",
      "#include \"log.h\"",
      "#include \"arguments.h\"",
      "#include <lxc/lxccontainer.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/epoll.h>",
      "#include <unistd.h>",
      "#include <termios.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <stdbool.h>",
      "#include <signal.h>",
      "#include <inttypes.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int batch = 0;",
      "static int delay_set = 0;",
      "static int delay = 3;",
      "static char sort_by = 'n';",
      "static int sort_reverse = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_safe_int",
          "args": [
            "arg",
            "&delay"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_safe_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "2005-2023",
          "snippet": "int lxc_safe_int(const char *numstr, int *converted)\n{\n\tchar *err = NULL;\n\tsigned long int sli;\n\n\terrno = 0;\n\tsli = strtol(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (sli > INT_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = (int)sli;\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_safe_int(const char *numstr, int *converted)\n{\n\tchar *err = NULL;\n\tsigned long int sli;\n\n\terrno = 0;\n\tsli = strtol(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (sli > INT_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = (int)sli;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"mainloop.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"arguments.h\"\n#include <lxc/lxccontainer.h>\n#include <sys/ioctl.h>\n#include <sys/epoll.h>\n#include <unistd.h>\n#include <termios.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdbool.h>\n#include <signal.h>\n#include <inttypes.h>\n#include <errno.h>\n\nstatic int batch = 0;\nstatic int delay_set = 0;\nstatic int delay = 3;\nstatic char sort_by = 'n';\nstatic int sort_reverse = 0;\n\nstatic int my_parser(struct lxc_arguments* args, int c, char* arg)\n{\n\tswitch (c) {\n\tcase 'd':\n\t\tdelay_set = 1;\n\t\tif (lxc_safe_int(arg, &delay) < 0)\n\t\t\treturn -1;\n\t\tbreak;\n\tcase 'b':\n\t\tbatch=1;\n\t\tbreak;\n\tcase 's':\n\t\tsort_by = arg[0];\n\t\tbreak;\n\tcase 'r':\n\t\tsort_reverse = 1;\n\t\tbreak;\n\t}\n\treturn 0;\n}"
  }
]