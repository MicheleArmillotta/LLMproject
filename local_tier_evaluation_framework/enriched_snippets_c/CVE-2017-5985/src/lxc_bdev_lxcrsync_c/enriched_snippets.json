[
  {
    "function_name": "rsync_rootfs_wrapper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
    "lines": "137-141",
    "snippet": "int rsync_rootfs_wrapper(void *data)\n{\n\tstruct rsync_data *arg = data;\n\treturn rsync_rootfs(arg);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxcrsync.h\"",
      "#include \"log.h\"",
      "#include \"bdev.h\"",
      "#include <sys/mount.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <grp.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rsync_rootfs",
          "args": [
            "arg"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "rsync_rootfs_wrapper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
          "lines": "137-141",
          "snippet": "int rsync_rootfs_wrapper(void *data)\n{\n\tstruct rsync_data *arg = data;\n\treturn rsync_rootfs(arg);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint rsync_rootfs_wrapper(void *data)\n{\n\tstruct rsync_data *arg = data;\n\treturn rsync_rootfs(arg);\n}"
  },
  {
    "function_name": "rsync_rootfs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
    "lines": "94-135",
    "snippet": "int rsync_rootfs(struct rsync_data *data)\n{\n\tstruct bdev *orig = data->orig,\n\t\t    *new = data->new;\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tSYSERROR(\"unshare CLONE_NEWNS\");\n\t\treturn -1;\n\t}\n\tif (detect_shared_rootfs()) {\n\t\tif (mount(NULL, \"/\", NULL, MS_SLAVE|MS_REC, NULL)) {\n\t\t\tSYSERROR(\"Failed to make / rslave\");\n\t\t\tERROR(\"Continuing...\");\n\t\t}\n\t}\n\n\t// If not a snapshot, copy the fs.\n\tif (orig->ops->mount(orig) < 0) {\n\t\tERROR(\"failed mounting %s onto %s\", orig->src, orig->dest);\n\t\treturn -1;\n\t}\n\tif (new->ops->mount(new) < 0) {\n\t\tERROR(\"failed mounting %s onto %s\", new->src, new->dest);\n\t\treturn -1;\n\t}\n\tif (setgid(0) < 0) {\n\t\tERROR(\"Failed to setgid to 0\");\n\t\treturn -1;\n\t}\n\tif (setgroups(0, NULL) < 0)\n\t\tWARN(\"Failed to clear groups\");\n\tif (setuid(0) < 0) {\n\t\tERROR(\"Failed to setuid to 0\");\n\t\treturn -1;\n\t}\n\tif (do_rsync(orig->dest, new->dest) < 0) {\n\t\tERROR(\"rsyncing %s to %s\", orig->src, new->src);\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxcrsync.h\"",
      "#include \"log.h\"",
      "#include \"bdev.h\"",
      "#include <sys/mount.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <grp.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"rsyncing %s to %s\"",
            "orig->src",
            "new->src"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "do_rsync",
          "args": [
            "orig->dest",
            "new->dest"
          ],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "do_rsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
          "lines": "43-66",
          "snippet": "int do_rsync(const char *src, const char *dest)\n{\n\t// call out to rsync\n\tpid_t pid;\n\tchar *s;\n\tsize_t l;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn -1;\n\tif (pid > 0)\n\t\treturn wait_for_pid(pid);\n\n\tl = strlen(src) + 2;\n\ts = malloc(l);\n\tif (!s)\n\t\texit(1);\n\tstrcpy(s, src);\n\ts[l-2] = '/';\n\ts[l-1] = '\\0';\n\n\texeclp(\"rsync\", \"rsync\", \"-aHXS\", \"--delete\", s, dest, (char *)NULL);\n\texit(1);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxcrsync.h\"",
            "#include \"log.h\"",
            "#include \"bdev.h\"",
            "#include <sys/mount.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <grp.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint do_rsync(const char *src, const char *dest)\n{\n\t// call out to rsync\n\tpid_t pid;\n\tchar *s;\n\tsize_t l;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn -1;\n\tif (pid > 0)\n\t\treturn wait_for_pid(pid);\n\n\tl = strlen(src) + 2;\n\ts = malloc(l);\n\tif (!s)\n\t\texit(1);\n\tstrcpy(s, src);\n\ts[l-2] = '/';\n\ts[l-1] = '\\0';\n\n\texeclp(\"rsync\", \"rsync\", \"-aHXS\", \"--delete\", s, dest, (char *)NULL);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Failed to setuid to 0\""
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setuid",
          "args": [
            "0"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN",
          "args": [
            "\"Failed to clear groups\""
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "0",
            "NULL"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_setgroups",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "2063-2072",
          "snippet": "int lxc_setgroups(int size, gid_t list[])\n{\n\tif (setgroups(size, list) < 0) {\n\t\tSYSERROR(\"Failed to setgroups().\");\n\t\treturn -errno;\n\t}\n\tNOTICE(\"Dropped additional groups.\");\n\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_setgroups(int size, gid_t list[])\n{\n\tif (setgroups(size, list) < 0) {\n\t\tSYSERROR(\"Failed to setgroups().\");\n\t\treturn -errno;\n\t}\n\tNOTICE(\"Dropped additional groups.\");\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Failed to setgid to 0\""
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgid",
          "args": [
            "0"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"failed mounting %s onto %s\"",
            "new->src",
            "new->dest"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new->ops->mount",
          "args": [
            "new"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"failed mounting %s onto %s\"",
            "orig->src",
            "orig->dest"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "orig->ops->mount",
          "args": [
            "orig"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Continuing...\""
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SYSERROR",
          "args": [
            "\"Failed to make / rslave\""
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "NULL",
            "\"/\"",
            "NULL",
            "MS_SLAVE|MS_REC",
            "NULL"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "ovl_remount_on_enodev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcoverlay.c",
          "lines": "664-676",
          "snippet": "static int ovl_remount_on_enodev(const char *lower, const char *target,\n\t\t\t\t const char *name, unsigned long mountflags,\n\t\t\t\t const void *options)\n{\n        int ret;\n        ret = mount(lower, target, ovl_name, MS_MGC_VAL | mountflags, options);\n        if (ret < 0 && errno == ENODEV) /* Try other module name. */\n\t\tret = mount(lower, target,\n\t\t\t    ovl_name == ovl_version[0] ? ovl_version[1]\n\t\t\t\t\t\t       : ovl_version[0],\n\t\t\t    MS_MGC_VAL | mountflags, options);\n        return ret;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxcrsync.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"lxccontainer.h\"",
            "#include \"log.h\"",
            "#include \"confile.h\"",
            "#include \"conf.h\"",
            "#include \"bdev.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *ovl_name;",
            "static char *ovl_version[] = {\"overlay\", \"overlayfs\"};",
            "static int ovl_remount_on_enodev(const char *lower, const char *target,\n\t\t\t\t const char *name, unsigned long mountflags,\n\t\t\t\t const void *options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"lxcoverlay.h\"\n#include \"lxccontainer.h\"\n#include \"log.h\"\n#include \"confile.h\"\n#include \"conf.h\"\n#include \"bdev.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n\nstatic char *ovl_name;\nstatic char *ovl_version[] = {\"overlay\", \"overlayfs\"};\nstatic int ovl_remount_on_enodev(const char *lower, const char *target,\n\t\t\t\t const char *name, unsigned long mountflags,\n\t\t\t\t const void *options);\n\nstatic int ovl_remount_on_enodev(const char *lower, const char *target,\n\t\t\t\t const char *name, unsigned long mountflags,\n\t\t\t\t const void *options)\n{\n        int ret;\n        ret = mount(lower, target, ovl_name, MS_MGC_VAL | mountflags, options);\n        if (ret < 0 && errno == ENODEV) /* Try other module name. */\n\t\tret = mount(lower, target,\n\t\t\t    ovl_name == ovl_version[0] ? ovl_version[1]\n\t\t\t\t\t\t       : ovl_version[0],\n\t\t\t    MS_MGC_VAL | mountflags, options);\n        return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "detect_shared_rootfs",
          "args": [],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "detect_shared_rootfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "1102-1132",
          "snippet": "int detect_shared_rootfs(void)\n{\n\tchar buf[LXC_LINELEN], *p;\n\tFILE *f;\n\tint i;\n\tchar *p2;\n\n\tf = fopen(\"/proc/self/mountinfo\", \"r\");\n\tif (!f)\n\t\treturn 0;\n\twhile (fgets(buf, LXC_LINELEN, f)) {\n\t\tfor (p = buf, i = 0; p && i < 4; i++)\n\t\t\tp = strchr(p + 1, ' ');\n\t\tif (!p)\n\t\t\tcontinue;\n\t\tp2 = strchr(p + 1, ' ');\n\t\tif (!p2)\n\t\t\tcontinue;\n\t\t*p2 = '\\0';\n\t\tif (strcmp(p + 1, \"/\") == 0) {\n\t\t\t// this is '/'.  is it shared?\n\t\t\tp = strchr(p2 + 1, ' ');\n\t\t\tif (p && strstr(p, \"shared:\")) {\n\t\t\t\tfclose(f);\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\t}\n\tfclose(f);\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint detect_shared_rootfs(void)\n{\n\tchar buf[LXC_LINELEN], *p;\n\tFILE *f;\n\tint i;\n\tchar *p2;\n\n\tf = fopen(\"/proc/self/mountinfo\", \"r\");\n\tif (!f)\n\t\treturn 0;\n\twhile (fgets(buf, LXC_LINELEN, f)) {\n\t\tfor (p = buf, i = 0; p && i < 4; i++)\n\t\t\tp = strchr(p + 1, ' ');\n\t\tif (!p)\n\t\t\tcontinue;\n\t\tp2 = strchr(p + 1, ' ');\n\t\tif (!p2)\n\t\t\tcontinue;\n\t\t*p2 = '\\0';\n\t\tif (strcmp(p + 1, \"/\") == 0) {\n\t\t\t// this is '/'.  is it shared?\n\t\t\tp = strchr(p2 + 1, ' ');\n\t\t\tif (p && strstr(p, \"shared:\")) {\n\t\t\t\tfclose(f);\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\t}\n\tfclose(f);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SYSERROR",
          "args": [
            "\"unshare CLONE_NEWNS\""
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unshare",
          "args": [
            "CLONE_NEWNS"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "unshare",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.h",
          "lines": "73-81",
          "snippet": "static inline int unshare(int flags)\n{\n#ifdef __NR_unshare\n\treturn syscall(__NR_unshare, flags);\n#else\n\terrno = ENOSYS;\n\treturn -1;\n#endif\n}",
          "includes": [
            "#include <stdint.h>",
            "#  include <sys/signalfd.h>",
            "#include <../include/getline.h>",
            "#include \"initutils.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#  include <sys/signalfd.h>\n#include <../include/getline.h>\n#include \"initutils.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <errno.h>\n#include \"config.h\"\n\nstatic inline int unshare(int flags)\n{\n#ifdef __NR_unshare\n\treturn syscall(__NR_unshare, flags);\n#else\n\terrno = ENOSYS;\n\treturn -1;\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint rsync_rootfs(struct rsync_data *data)\n{\n\tstruct bdev *orig = data->orig,\n\t\t    *new = data->new;\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tSYSERROR(\"unshare CLONE_NEWNS\");\n\t\treturn -1;\n\t}\n\tif (detect_shared_rootfs()) {\n\t\tif (mount(NULL, \"/\", NULL, MS_SLAVE|MS_REC, NULL)) {\n\t\t\tSYSERROR(\"Failed to make / rslave\");\n\t\t\tERROR(\"Continuing...\");\n\t\t}\n\t}\n\n\t// If not a snapshot, copy the fs.\n\tif (orig->ops->mount(orig) < 0) {\n\t\tERROR(\"failed mounting %s onto %s\", orig->src, orig->dest);\n\t\treturn -1;\n\t}\n\tif (new->ops->mount(new) < 0) {\n\t\tERROR(\"failed mounting %s onto %s\", new->src, new->dest);\n\t\treturn -1;\n\t}\n\tif (setgid(0) < 0) {\n\t\tERROR(\"Failed to setgid to 0\");\n\t\treturn -1;\n\t}\n\tif (setgroups(0, NULL) < 0)\n\t\tWARN(\"Failed to clear groups\");\n\tif (setuid(0) < 0) {\n\t\tERROR(\"Failed to setuid to 0\");\n\t\treturn -1;\n\t}\n\tif (do_rsync(orig->dest, new->dest) < 0) {\n\t\tERROR(\"rsyncing %s to %s\", orig->src, new->src);\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "rsync_delta_wrapper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
    "lines": "88-92",
    "snippet": "int rsync_delta_wrapper(void *data)\n{\n\tstruct rsync_data_char *arg = data;\n\treturn rsync_delta(arg);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxcrsync.h\"",
      "#include \"log.h\"",
      "#include \"bdev.h\"",
      "#include <sys/mount.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <grp.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rsync_delta",
          "args": [
            "arg"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "rsync_delta_wrapper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
          "lines": "88-92",
          "snippet": "int rsync_delta_wrapper(void *data)\n{\n\tstruct rsync_data_char *arg = data;\n\treturn rsync_delta(arg);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint rsync_delta_wrapper(void *data)\n{\n\tstruct rsync_data_char *arg = data;\n\treturn rsync_delta(arg);\n}"
  },
  {
    "function_name": "rsync_delta",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
    "lines": "68-86",
    "snippet": "int rsync_delta(struct rsync_data_char *data)\n{\n\tif (setgid(0) < 0) {\n\t\tERROR(\"Failed to setgid to 0\");\n\t\treturn -1;\n\t}\n\tif (setgroups(0, NULL) < 0)\n\t\tWARN(\"Failed to clear groups\");\n\tif (setuid(0) < 0) {\n\t\tERROR(\"Failed to setuid to 0\");\n\t\treturn -1;\n\t}\n\tif (do_rsync(data->src, data->dest) < 0) {\n\t\tERROR(\"rsyncing %s to %s\", data->src, data->dest);\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxcrsync.h\"",
      "#include \"log.h\"",
      "#include \"bdev.h\"",
      "#include <sys/mount.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <grp.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"rsyncing %s to %s\"",
            "data->src",
            "data->dest"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "do_rsync",
          "args": [
            "data->src",
            "data->dest"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "do_rsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
          "lines": "43-66",
          "snippet": "int do_rsync(const char *src, const char *dest)\n{\n\t// call out to rsync\n\tpid_t pid;\n\tchar *s;\n\tsize_t l;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn -1;\n\tif (pid > 0)\n\t\treturn wait_for_pid(pid);\n\n\tl = strlen(src) + 2;\n\ts = malloc(l);\n\tif (!s)\n\t\texit(1);\n\tstrcpy(s, src);\n\ts[l-2] = '/';\n\ts[l-1] = '\\0';\n\n\texeclp(\"rsync\", \"rsync\", \"-aHXS\", \"--delete\", s, dest, (char *)NULL);\n\texit(1);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxcrsync.h\"",
            "#include \"log.h\"",
            "#include \"bdev.h\"",
            "#include <sys/mount.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdint.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <grp.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint do_rsync(const char *src, const char *dest)\n{\n\t// call out to rsync\n\tpid_t pid;\n\tchar *s;\n\tsize_t l;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn -1;\n\tif (pid > 0)\n\t\treturn wait_for_pid(pid);\n\n\tl = strlen(src) + 2;\n\ts = malloc(l);\n\tif (!s)\n\t\texit(1);\n\tstrcpy(s, src);\n\ts[l-2] = '/';\n\ts[l-1] = '\\0';\n\n\texeclp(\"rsync\", \"rsync\", \"-aHXS\", \"--delete\", s, dest, (char *)NULL);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Failed to setuid to 0\""
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setuid",
          "args": [
            "0"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN",
          "args": [
            "\"Failed to clear groups\""
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "0",
            "NULL"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_setgroups",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "2063-2072",
          "snippet": "int lxc_setgroups(int size, gid_t list[])\n{\n\tif (setgroups(size, list) < 0) {\n\t\tSYSERROR(\"Failed to setgroups().\");\n\t\treturn -errno;\n\t}\n\tNOTICE(\"Dropped additional groups.\");\n\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_setgroups(int size, gid_t list[])\n{\n\tif (setgroups(size, list) < 0) {\n\t\tSYSERROR(\"Failed to setgroups().\");\n\t\treturn -errno;\n\t}\n\tNOTICE(\"Dropped additional groups.\");\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Failed to setgid to 0\""
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgid",
          "args": [
            "0"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint rsync_delta(struct rsync_data_char *data)\n{\n\tif (setgid(0) < 0) {\n\t\tERROR(\"Failed to setgid to 0\");\n\t\treturn -1;\n\t}\n\tif (setgroups(0, NULL) < 0)\n\t\tWARN(\"Failed to clear groups\");\n\tif (setuid(0) < 0) {\n\t\tERROR(\"Failed to setuid to 0\");\n\t\treturn -1;\n\t}\n\tif (do_rsync(data->src, data->dest) < 0) {\n\t\tERROR(\"rsyncing %s to %s\", data->src, data->dest);\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "do_rsync",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/bdev/lxcrsync.c",
    "lines": "43-66",
    "snippet": "int do_rsync(const char *src, const char *dest)\n{\n\t// call out to rsync\n\tpid_t pid;\n\tchar *s;\n\tsize_t l;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn -1;\n\tif (pid > 0)\n\t\treturn wait_for_pid(pid);\n\n\tl = strlen(src) + 2;\n\ts = malloc(l);\n\tif (!s)\n\t\texit(1);\n\tstrcpy(s, src);\n\ts[l-2] = '/';\n\ts[l-1] = '\\0';\n\n\texeclp(\"rsync\", \"rsync\", \"-aHXS\", \"--delete\", s, dest, (char *)NULL);\n\texit(1);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxcrsync.h\"",
      "#include \"log.h\"",
      "#include \"bdev.h\"",
      "#include <sys/mount.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdint.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <grp.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "execlp",
          "args": [
            "\"rsync\"",
            "\"rsync\"",
            "\"-aHXS\"",
            "\"--delete\"",
            "s",
            "dest",
            "(char *)NULL"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "s",
            "src"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "l"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "src"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wait_for_pid",
          "args": [
            "pid"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_wait_for_pid_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/python-lxc/lxc.c",
          "lines": "67-81",
          "snippet": "static int lxc_wait_for_pid_status(pid_t pid)\n{\n    int status, ret;\n\nagain:\n    ret = waitpid(pid, &status, 0);\n    if (ret == -1) {\n        if (errno == EINTR)\n            goto again;\n        return -1;\n    }\n    if (ret != pid)\n        goto again;\n    return status;\n}",
          "includes": [
            "#include <sched.h>",
            "#include <sys/wait.h>",
            "#include <stdio.h>",
            "#include <lxc/lxccontainer.h>",
            "#include \"structmember.h\"",
            "#include <Python.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sched.h>\n#include <sys/wait.h>\n#include <stdio.h>\n#include <lxc/lxccontainer.h>\n#include \"structmember.h\"\n#include <Python.h>\n\nstatic int lxc_wait_for_pid_status(pid_t pid)\n{\n    int status, ret;\n\nagain:\n    ret = waitpid(pid, &status, 0);\n    if (ret == -1) {\n        if (errno == EINTR)\n            goto again;\n        return -1;\n    }\n    if (ret != pid)\n        goto again;\n    return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 50
        },
        "resolved": true,
        "details": {
          "function_name": "process_lock_setup_atfork",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lxclock.c",
          "lines": "335-339",
          "snippet": "__attribute__((constructor))\nstatic void process_lock_setup_atfork(void)\n{\n\tpthread_atfork(process_lock, process_unlock, process_unlock);\n}",
          "includes": [
            "#include <execinfo.h>",
            "#include \"log.h\"",
            "#include \"utils.h\"",
            "#include <lxc/lxccontainer.h>",
            "#include <pthread.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <malloc.h>",
            "#include \"lxclock.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n#include \"log.h\"\n#include \"utils.h\"\n#include <lxc/lxccontainer.h>\n#include <pthread.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <malloc.h>\n#include \"lxclock.h\"\n\n__attribute__((constructor))\nstatic void process_lock_setup_atfork(void)\n{\n\tpthread_atfork(process_lock, process_unlock, process_unlock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxcrsync.h\"\n#include \"log.h\"\n#include \"bdev.h\"\n#include <sys/mount.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdint.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <grp.h>\n\nint do_rsync(const char *src, const char *dest)\n{\n\t// call out to rsync\n\tpid_t pid;\n\tchar *s;\n\tsize_t l;\n\n\tpid = fork();\n\tif (pid < 0)\n\t\treturn -1;\n\tif (pid > 0)\n\t\treturn wait_for_pid(pid);\n\n\tl = strlen(src) + 2;\n\ts = malloc(l);\n\tif (!s)\n\t\texit(1);\n\tstrcpy(s, src);\n\ts[l-2] = '/';\n\ts[l-1] = '\\0';\n\n\texeclp(\"rsync\", \"rsync\", \"-aHXS\", \"--delete\", s, dest, (char *)NULL);\n\texit(1);\n}"
  }
]