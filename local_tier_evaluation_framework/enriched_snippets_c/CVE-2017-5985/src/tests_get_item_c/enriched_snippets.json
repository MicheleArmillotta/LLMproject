[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/get_item.c",
    "lines": "35-336",
    "snippet": "int main(int argc, char *argv[])\n{\n\tint ret = EXIT_FAILURE;\n\tstruct lxc_container *c;\n\tchar v1[2], v2[256], v3[2048];\n\n\tif ((c = lxc_container_new(\"testxyz\", NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\texit(EXIT_FAILURE);\n\t}\n\n\t/* EXPECT SUCCESS: lxc.syslog with valid value. */\n\tif (!c->set_config_item(c, \"lxc.syslog\", \"local0\")) {\n\t\tlxc_error(\"%s\\n\", \"Failed to set lxc.syslog.\\n\");\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.syslog\", v2, 255);\n\tif (ret < 0) {\n\t\tlxc_error(\"Failed to retrieve lxc.syslog: %d.\\n\", ret);\n\t\tgoto out;\n\t}\n\tif (strcmp(v2, \"local0\") != 0) {\n\t\tlxc_error(\"Expected: local0 == %s.\\n\", v2);\n\t\tgoto out;\n\t}\n\tlxc_debug(\"Retrieving value for lxc.syslog correctly returned: %s.\\n\", v2);\n\n\t/* EXPECT FAILURE: lxc.syslog with invalid value. */\n\tif (c->set_config_item(c, \"lxc.syslog\", \"NONSENSE\")) {\n\t\tlxc_error(\"%s\\n\", \"Succeeded int setting lxc.syslog to invalid value \\\"NONSENSE\\\".\\n\");\n\t\tgoto out;\n\t}\n\tlxc_debug(\"%s\\n\", \"Successfully failed to set lxc.syslog to invalid value.\\n\");\n\n\tif (!c->set_config_item(c, \"lxc.hook.pre-start\", \"hi there\")) {\n\t\tfprintf(stderr, \"%d: failed to set hook.pre-start\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.hook.pre-start\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.hook.pre-start) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tfprintf(stderr, \"lxc.hook.pre-start returned %d %s\\n\", ret, v2);\n\n\tret = c->get_config_item(c, \"lxc.network\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tfprintf(stderr, \"%d: get_config_item(lxc.network) returned %d %s\\n\", __LINE__, ret, v2);\n\tif (!c->set_config_item(c, \"lxc.tty\", \"4\")) {\n\t\tfprintf(stderr, \"%d: failed to set tty\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.tty\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.tty) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tfprintf(stderr, \"lxc.tty returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.arch\", \"x86\")) {\n\t\tfprintf(stderr, \"%d: failed to set arch\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.arch\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.arch) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.arch returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.init_uid\", \"100\")) {\n\t\tfprintf(stderr, \"%d: failed to set init_uid\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.init_uid\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.init_uid) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.init_uid returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.init_gid\", \"100\")) {\n\t\tfprintf(stderr, \"%d: failed to set init_gid\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.init_gid\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.init_gid) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.init_gid returned %d %s\\n\", ret, v2);\n\n#define HNAME \"hostname1\"\n\t// demonstrate proper usage:\n\tchar *alloced;\n\tif (!c->set_config_item(c, \"lxc.utsname\", HNAME)) {\n\t\tfprintf(stderr, \"%d: failed to set utsname\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\n\tint len;\n\tlen = c->get_config_item(c, \"lxc.utsname\", NULL, 0);  // query the size of the string\n\tif (len < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.utsname) returned %d\\n\", __LINE__, len);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.utsname returned %d\\n\", len);\n\n\t// allocate the length of string + 1 for trailing \\0\n\talloced = malloc(len+1);\n\tif (!alloced) {\n\t\tfprintf(stderr, \"%d: failed to allocate %d bytes for utsname\\n\", __LINE__, len);\n\t\tgoto out;\n\t}\n\t// now pass in the malloc'd array, and pass in length of string + 1: again\n\t// because we need room for the trailing \\0\n\tret = c->get_config_item(c, \"lxc.utsname\", alloced, len+1);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.utsname) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tif (strcmp(alloced, HNAME) != 0 || ret != len) {\n\t\tfprintf(stderr, \"lxc.utsname returned wrong value: %d %s not %d %s\\n\", ret, alloced, len, HNAME);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.utsname returned %d %s\\n\", len, alloced);\n\tfree(alloced);\n\n\tif (!c->set_config_item(c, \"lxc.mount.entry\", \"hi there\")) {\n\t\tfprintf(stderr, \"%d: failed to set mount.entry\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.mount.entry\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.mount.entry) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.mount.entry returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.aa_profile\", \"unconfined\")) {\n\t\tfprintf(stderr, \"%d: failed to set aa_profile\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.aa_profile\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.aa_profile) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.aa_profile returned %d %s\\n\", ret, v2);\n\n\tlxc_container_put(c);\n\n\t// new test with real container\n\tif ((c = lxc_container_new(MYNAME, NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\tgoto out;\n\t}\n\tc->destroy(c);\n\tlxc_container_put(c);\n\n\tif ((c = lxc_container_new(MYNAME, NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\tgoto out;\n\t}\n\tif (!c->createl(c, \"busybox\", NULL, NULL, 0, NULL)) {\n\t\tfprintf(stderr, \"%d: failed to create a trusty container\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tlxc_container_put(c);\n\n\t/* XXX TODO load_config needs to clear out any old config first */\n\tif ((c = lxc_container_new(MYNAME, NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.cap.drop\", NULL, 300);\n\tif (ret < 5 || ret > 255) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.cap.drop) with NULL returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.cap.drop\", v1, 1);\n\tif (ret < 5 || ret > 255) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.cap.drop) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.cap.drop\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.cap.drop) returned %d %s\\n\", __LINE__, ret, v2);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item(lxc.cap.drop) returned %d %s\\n\", __LINE__, ret, v2);\n\tret = c->get_config_item(c, \"lxc.network\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item(lxc.network) returned %d %s\\n\", __LINE__, ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.network.ipv4\", \"10.2.3.4\")) {\n\t\tfprintf(stderr, \"%d: failed to set ipv4\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4\", v2, 255);\n\tif (ret <= 0) {\n\t\tfprintf(stderr, \"%d: lxc.network.0.ipv4 returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.network.0.ipv4\")) {\n\t\tfprintf(stderr, \"%d: failed clearing all ipv4 entries\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4\", v2, 255);\n\tif (ret != 0) {\n\t\tfprintf(stderr, \"%d: after clearing ipv4 entries get_item(lxc.network.0.ipv4 returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\n\tif (!c->set_config_item(c, \"lxc.network.ipv4.gateway\", \"10.2.3.254\")) {\n\t\tfprintf(stderr, \"%d: failed to set ipv4.gateway\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4.gateway\", v2, 255);\n\tif (ret <= 0) {\n\t\tfprintf(stderr, \"%d: lxc.network.0.ipv4.gateway returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tif (!c->set_config_item(c, \"lxc.network.0.ipv4.gateway\", \"\")) {\n\t\tfprintf(stderr, \"%d: failed clearing ipv4.gateway\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4.gateway\", v2, 255);\n\tif (ret != 0) {\n\t\tfprintf(stderr, \"%d: after clearing ipv4.gateway get_item(lxc.network.0.ipv4.gateway returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.network.0.link\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (link) returned %d %s\\n\", __LINE__, ret, v2);\n\tret = c->get_config_item(c, \"lxc.network.0.name\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (name) returned %d %s\\n\", __LINE__, ret, v2);\n\n\tif (!c->clear_config_item(c, \"lxc.network\")) {\n\t\tfprintf(stderr, \"%d: clear_config_item failed\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.network\", v2, 255);\n\tif (ret != 0) {\n\t\tfprintf(stderr, \"%d: network was not actually cleared (get_network returned %d)\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.cgroup\", v3, 2047);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(cgroup.devices) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (cgroup.devices) returned %d %s\\n\", __LINE__, ret, v3);\n\n\tret = c->get_config_item(c, \"lxc.cgroup.devices.allow\", v3, 2047);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(cgroup.devices.devices.allow) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (cgroup.devices.devices.allow) returned %d %s\\n\", __LINE__, ret, v3);\n\n\tif (!c->clear_config_item(c, \"lxc.cgroup\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.cgroup\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.cap.drop\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.cap.drop\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.mount.entry\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.mount.entry\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.hook\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.hook\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tprintf(\"All get_item tests passed\\n\");\n\tret = EXIT_SUCCESS;\nout:\n\tc->destroy(c);\n\tlxc_container_put(c);\n\texit(ret);\n}",
    "includes": [
      "#include \"lxctest.h\"",
      "#include \"lxc/state.h\"",
      "#include <string.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <unistd.h>",
      "#include <lxc/lxccontainer.h>"
    ],
    "macros_used": [
      "#define HNAME \"hostname1\"",
      "#define MYNAME \"lxctest1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "ret"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_container_put",
          "args": [
            "c"
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_container_put",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lxccontainer.c",
          "lines": "312-325",
          "snippet": "int lxc_container_put(struct lxc_container *c)\n{\n\tif (!c)\n\t\treturn -1;\n\tif (container_mem_lock(c))\n\t\treturn -1;\n\tif (--c->numthreads < 1) {\n\t\tcontainer_mem_unlock(c);\n\t\tlxc_container_free(c);\n\t\treturn 1;\n\t}\n\tcontainer_mem_unlock(c);\n\treturn 0;\n}",
          "includes": [
            "#include <mntent.h>",
            "#include <../include/lxcmntent.h>",
            "#include <../include/ifaddrs.h>",
            "#include <ifaddrs.h>",
            "#    include <sys/sysmacros.h>",
            "#    include <sys/mkdev.h>",
            "#include \"version.h\"",
            "#include \"utils.h\"",
            "#include \"state.h\"",
            "#include \"sync.h\"",
            "#include \"network.h\"",
            "#include \"namespace.h\"",
            "#include \"monitor.h\"",
            "#include \"lxclock.h\"",
            "#include \"lxccontainer.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"criu.h\"",
            "#include \"console.h\"",
            "#include \"confile.h\"",
            "#include \"commands.h\"",
            "#include \"config.h\"",
            "#include \"conf.h\"",
            "#include \"cgroup.h\"",
            "#include \"lxcbtrfs.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"bdev.h\"",
            "#include \"attach.h\"",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <arpa/inet.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <sched.h>",
            "#include <pthread.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool do_lxcapi_destroy(struct lxc_container *c);",
            "static const char *lxcapi_get_config_path(struct lxc_container *c);",
            "static bool container_destroy(struct lxc_container *c);",
            "static bool lxcapi_snapshot_destroy_all(struct lxc_container *c);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <mntent.h>\n#include <../include/lxcmntent.h>\n#include <../include/ifaddrs.h>\n#include <ifaddrs.h>\n#    include <sys/sysmacros.h>\n#    include <sys/mkdev.h>\n#include \"version.h\"\n#include \"utils.h\"\n#include \"state.h\"\n#include \"sync.h\"\n#include \"network.h\"\n#include \"namespace.h\"\n#include \"monitor.h\"\n#include \"lxclock.h\"\n#include \"lxccontainer.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"criu.h\"\n#include \"console.h\"\n#include \"confile.h\"\n#include \"commands.h\"\n#include \"config.h\"\n#include \"conf.h\"\n#include \"cgroup.h\"\n#include \"lxcbtrfs.h\"\n#include \"lxcoverlay.h\"\n#include \"bdev.h\"\n#include \"attach.h\"\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <sched.h>\n#include <pthread.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n\nstatic bool do_lxcapi_destroy(struct lxc_container *c);\nstatic const char *lxcapi_get_config_path(struct lxc_container *c);\nstatic bool container_destroy(struct lxc_container *c);\nstatic bool lxcapi_snapshot_destroy_all(struct lxc_container *c);\n\nint lxc_container_put(struct lxc_container *c)\n{\n\tif (!c)\n\t\treturn -1;\n\tif (container_mem_lock(c))\n\t\treturn -1;\n\tif (--c->numthreads < 1) {\n\t\tcontainer_mem_unlock(c);\n\t\tlxc_container_free(c);\n\t\treturn 1;\n\t}\n\tcontainer_mem_unlock(c);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "c->destroy",
          "args": [
            "c"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"All get_item tests passed\\n\""
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed clearing lxc.hook\\n\"",
            "__LINE__"
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->clear_config_item",
          "args": [
            "c",
            "\"lxc.hook\""
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed clearing lxc.mount.entry\\n\"",
            "__LINE__"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->clear_config_item",
          "args": [
            "c",
            "\"lxc.mount.entry\""
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed clearing lxc.cap.drop\\n\"",
            "__LINE__"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->clear_config_item",
          "args": [
            "c",
            "\"lxc.cap.drop\""
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed clearing lxc.cgroup\\n\"",
            "__LINE__"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->clear_config_item",
          "args": [
            "c",
            "\"lxc.cgroup\""
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%d: get_config_item (cgroup.devices.devices.allow) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v3"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(cgroup.devices.devices.allow) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.cgroup.devices.allow\"",
            "v3",
            "2047"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%d: get_config_item (cgroup.devices) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v3"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(cgroup.devices) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.cgroup\"",
            "v3",
            "2047"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: network was not actually cleared (get_network returned %d)\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network\"",
            "v2",
            "255"
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: clear_config_item failed\\n\"",
            "__LINE__"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->clear_config_item",
          "args": [
            "c",
            "\"lxc.network\""
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%d: get_config_item (name) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v2"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network.0.name\"",
            "v2",
            "255"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%d: get_config_item (link) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v2"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network.0.link\"",
            "v2",
            "255"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: after clearing ipv4.gateway get_item(lxc.network.0.ipv4.gateway returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network.0.ipv4.gateway\"",
            "v2",
            "255"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed clearing ipv4.gateway\\n\"",
            "__LINE__"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.network.0.ipv4.gateway\"",
            "\"\""
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: lxc.network.0.ipv4.gateway returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network.0.ipv4.gateway\"",
            "v2",
            "255"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set ipv4.gateway\\n\"",
            "__LINE__"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.network.ipv4.gateway\"",
            "\"10.2.3.254\""
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: after clearing ipv4 entries get_item(lxc.network.0.ipv4 returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network.0.ipv4\"",
            "v2",
            "255"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed clearing all ipv4 entries\\n\"",
            "__LINE__"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->clear_config_item",
          "args": [
            "c",
            "\"lxc.network.0.ipv4\""
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: lxc.network.0.ipv4 returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network.0.ipv4\"",
            "v2",
            "255"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set ipv4\\n\"",
            "__LINE__"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.network.ipv4\"",
            "\"10.2.3.4\""
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%d: get_config_item(lxc.network) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v2"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network\"",
            "v2",
            "255"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%d: get_config_item(lxc.cap.drop) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v2"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.cap.drop) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v2"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.cap.drop\"",
            "v2",
            "255"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.cap.drop) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.cap.drop\"",
            "v1",
            "1"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.cap.drop) with NULL returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.cap.drop\"",
            "NULL",
            "300"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: error opening lxc_container %s\\n\"",
            "__LINE__",
            "MYNAME"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_container_new",
          "args": [
            "MYNAME",
            "NULL"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_container_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/lxccontainer.c",
          "lines": "4099-4218",
          "snippet": "struct lxc_container *lxc_container_new(const char *name, const char *configpath)\n{\n\tstruct lxc_container *c;\n\n\tif (!name)\n\t\treturn NULL;\n\n\tc = malloc(sizeof(*c));\n\tif (!c) {\n\t\tfprintf(stderr, \"failed to malloc lxc_container\\n\");\n\t\treturn NULL;\n\t}\n\tmemset(c, 0, sizeof(*c));\n\n\tif (configpath)\n\t\tc->config_path = strdup(configpath);\n\telse\n\t\tc->config_path = strdup(lxc_global_config_value(\"lxc.lxcpath\"));\n\n\tif (!c->config_path) {\n\t\tfprintf(stderr, \"Out of memory\\n\");\n\t\tgoto err;\n\t}\n\n\tremove_trailing_slashes(c->config_path);\n\tc->name = malloc(strlen(name)+1);\n\tif (!c->name) {\n\t\tfprintf(stderr, \"Error allocating lxc_container name\\n\");\n\t\tgoto err;\n\t}\n\tstrcpy(c->name, name);\n\n\tc->numthreads = 1;\n\tif (!(c->slock = lxc_newlock(c->config_path, name))) {\n\t\tfprintf(stderr, \"failed to create lock\\n\");\n\t\tgoto err;\n\t}\n\n\tif (!(c->privlock = lxc_newlock(NULL, NULL))) {\n\t\tfprintf(stderr, \"failed to alloc privlock\\n\");\n\t\tgoto err;\n\t}\n\n\tif (!set_config_filename(c)) {\n\t\tfprintf(stderr, \"Error allocating config file pathname\\n\");\n\t\tgoto err;\n\t}\n\n\tif (file_exists(c->configfile) && !lxcapi_load_config(c, NULL))\n\t\tgoto err;\n\n\tif (ongoing_create(c) == 2) {\n\t\tERROR(\"Error: %s creation was not completed\", c->name);\n\t\tcontainer_destroy(c);\n\t\tlxcapi_clear_config(c);\n\t}\n\tc->daemonize = true;\n\tc->pidfile = NULL;\n\n\t// assign the member functions\n\tc->is_defined = lxcapi_is_defined;\n\tc->state = lxcapi_state;\n\tc->is_running = lxcapi_is_running;\n\tc->freeze = lxcapi_freeze;\n\tc->unfreeze = lxcapi_unfreeze;\n\tc->console = lxcapi_console;\n\tc->console_getfd = lxcapi_console_getfd;\n\tc->init_pid = lxcapi_init_pid;\n\tc->load_config = lxcapi_load_config;\n\tc->want_daemonize = lxcapi_want_daemonize;\n\tc->want_close_all_fds = lxcapi_want_close_all_fds;\n\tc->start = lxcapi_start;\n\tc->startl = lxcapi_startl;\n\tc->stop = lxcapi_stop;\n\tc->config_file_name = lxcapi_config_file_name;\n\tc->wait = lxcapi_wait;\n\tc->set_config_item = lxcapi_set_config_item;\n\tc->destroy = lxcapi_destroy;\n\tc->destroy_with_snapshots = lxcapi_destroy_with_snapshots;\n\tc->rename = lxcapi_rename;\n\tc->save_config = lxcapi_save_config;\n\tc->get_keys = lxcapi_get_keys;\n\tc->create = lxcapi_create;\n\tc->createl = lxcapi_createl;\n\tc->shutdown = lxcapi_shutdown;\n\tc->reboot = lxcapi_reboot;\n\tc->clear_config = lxcapi_clear_config;\n\tc->clear_config_item = lxcapi_clear_config_item;\n\tc->get_config_item = lxcapi_get_config_item;\n\tc->get_running_config_item = lxcapi_get_running_config_item;\n\tc->get_cgroup_item = lxcapi_get_cgroup_item;\n\tc->set_cgroup_item = lxcapi_set_cgroup_item;\n\tc->get_config_path = lxcapi_get_config_path;\n\tc->set_config_path = lxcapi_set_config_path;\n\tc->clone = lxcapi_clone;\n\tc->get_interfaces = lxcapi_get_interfaces;\n\tc->get_ips = lxcapi_get_ips;\n\tc->attach = lxcapi_attach;\n\tc->attach_run_wait = lxcapi_attach_run_wait;\n\tc->attach_run_waitl = lxcapi_attach_run_waitl;\n\tc->snapshot = lxcapi_snapshot;\n\tc->snapshot_list = lxcapi_snapshot_list;\n\tc->snapshot_restore = lxcapi_snapshot_restore;\n\tc->snapshot_destroy = lxcapi_snapshot_destroy;\n\tc->snapshot_destroy_all = lxcapi_snapshot_destroy_all;\n\tc->may_control = lxcapi_may_control;\n\tc->add_device_node = lxcapi_add_device_node;\n\tc->remove_device_node = lxcapi_remove_device_node;\n\tc->attach_interface = lxcapi_attach_interface;\n\tc->detach_interface = lxcapi_detach_interface;\n\tc->checkpoint = lxcapi_checkpoint;\n\tc->restore = lxcapi_restore;\n\tc->migrate = lxcapi_migrate;\n\n\treturn c;\n\nerr:\n\tlxc_container_free(c);\n\treturn NULL;\n}",
          "includes": [
            "#include <mntent.h>",
            "#include <../include/lxcmntent.h>",
            "#include <../include/ifaddrs.h>",
            "#include <ifaddrs.h>",
            "#    include <sys/sysmacros.h>",
            "#    include <sys/mkdev.h>",
            "#include \"version.h\"",
            "#include \"utils.h\"",
            "#include \"state.h\"",
            "#include \"sync.h\"",
            "#include \"network.h\"",
            "#include \"namespace.h\"",
            "#include \"monitor.h\"",
            "#include \"lxclock.h\"",
            "#include \"lxccontainer.h\"",
            "#include \"lxc.h\"",
            "#include \"log.h\"",
            "#include \"criu.h\"",
            "#include \"console.h\"",
            "#include \"confile.h\"",
            "#include \"commands.h\"",
            "#include \"config.h\"",
            "#include \"conf.h\"",
            "#include \"cgroup.h\"",
            "#include \"lxcbtrfs.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"bdev.h\"",
            "#include \"attach.h\"",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <arpa/inet.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <sched.h>",
            "#include <pthread.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool do_lxcapi_destroy(struct lxc_container *c);",
            "static const char *lxcapi_get_config_path(struct lxc_container *c);",
            "static bool container_destroy(struct lxc_container *c);",
            "static bool lxcapi_snapshot_destroy_all(struct lxc_container *c);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <mntent.h>\n#include <../include/lxcmntent.h>\n#include <../include/ifaddrs.h>\n#include <ifaddrs.h>\n#    include <sys/sysmacros.h>\n#    include <sys/mkdev.h>\n#include \"version.h\"\n#include \"utils.h\"\n#include \"state.h\"\n#include \"sync.h\"\n#include \"network.h\"\n#include \"namespace.h\"\n#include \"monitor.h\"\n#include \"lxclock.h\"\n#include \"lxccontainer.h\"\n#include \"lxc.h\"\n#include \"log.h\"\n#include \"criu.h\"\n#include \"console.h\"\n#include \"confile.h\"\n#include \"commands.h\"\n#include \"config.h\"\n#include \"conf.h\"\n#include \"cgroup.h\"\n#include \"lxcbtrfs.h\"\n#include \"lxcoverlay.h\"\n#include \"bdev.h\"\n#include \"attach.h\"\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <sched.h>\n#include <pthread.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n\nstatic bool do_lxcapi_destroy(struct lxc_container *c);\nstatic const char *lxcapi_get_config_path(struct lxc_container *c);\nstatic bool container_destroy(struct lxc_container *c);\nstatic bool lxcapi_snapshot_destroy_all(struct lxc_container *c);\n\nstruct lxc_container *lxc_container_new(const char *name, const char *configpath)\n{\n\tstruct lxc_container *c;\n\n\tif (!name)\n\t\treturn NULL;\n\n\tc = malloc(sizeof(*c));\n\tif (!c) {\n\t\tfprintf(stderr, \"failed to malloc lxc_container\\n\");\n\t\treturn NULL;\n\t}\n\tmemset(c, 0, sizeof(*c));\n\n\tif (configpath)\n\t\tc->config_path = strdup(configpath);\n\telse\n\t\tc->config_path = strdup(lxc_global_config_value(\"lxc.lxcpath\"));\n\n\tif (!c->config_path) {\n\t\tfprintf(stderr, \"Out of memory\\n\");\n\t\tgoto err;\n\t}\n\n\tremove_trailing_slashes(c->config_path);\n\tc->name = malloc(strlen(name)+1);\n\tif (!c->name) {\n\t\tfprintf(stderr, \"Error allocating lxc_container name\\n\");\n\t\tgoto err;\n\t}\n\tstrcpy(c->name, name);\n\n\tc->numthreads = 1;\n\tif (!(c->slock = lxc_newlock(c->config_path, name))) {\n\t\tfprintf(stderr, \"failed to create lock\\n\");\n\t\tgoto err;\n\t}\n\n\tif (!(c->privlock = lxc_newlock(NULL, NULL))) {\n\t\tfprintf(stderr, \"failed to alloc privlock\\n\");\n\t\tgoto err;\n\t}\n\n\tif (!set_config_filename(c)) {\n\t\tfprintf(stderr, \"Error allocating config file pathname\\n\");\n\t\tgoto err;\n\t}\n\n\tif (file_exists(c->configfile) && !lxcapi_load_config(c, NULL))\n\t\tgoto err;\n\n\tif (ongoing_create(c) == 2) {\n\t\tERROR(\"Error: %s creation was not completed\", c->name);\n\t\tcontainer_destroy(c);\n\t\tlxcapi_clear_config(c);\n\t}\n\tc->daemonize = true;\n\tc->pidfile = NULL;\n\n\t// assign the member functions\n\tc->is_defined = lxcapi_is_defined;\n\tc->state = lxcapi_state;\n\tc->is_running = lxcapi_is_running;\n\tc->freeze = lxcapi_freeze;\n\tc->unfreeze = lxcapi_unfreeze;\n\tc->console = lxcapi_console;\n\tc->console_getfd = lxcapi_console_getfd;\n\tc->init_pid = lxcapi_init_pid;\n\tc->load_config = lxcapi_load_config;\n\tc->want_daemonize = lxcapi_want_daemonize;\n\tc->want_close_all_fds = lxcapi_want_close_all_fds;\n\tc->start = lxcapi_start;\n\tc->startl = lxcapi_startl;\n\tc->stop = lxcapi_stop;\n\tc->config_file_name = lxcapi_config_file_name;\n\tc->wait = lxcapi_wait;\n\tc->set_config_item = lxcapi_set_config_item;\n\tc->destroy = lxcapi_destroy;\n\tc->destroy_with_snapshots = lxcapi_destroy_with_snapshots;\n\tc->rename = lxcapi_rename;\n\tc->save_config = lxcapi_save_config;\n\tc->get_keys = lxcapi_get_keys;\n\tc->create = lxcapi_create;\n\tc->createl = lxcapi_createl;\n\tc->shutdown = lxcapi_shutdown;\n\tc->reboot = lxcapi_reboot;\n\tc->clear_config = lxcapi_clear_config;\n\tc->clear_config_item = lxcapi_clear_config_item;\n\tc->get_config_item = lxcapi_get_config_item;\n\tc->get_running_config_item = lxcapi_get_running_config_item;\n\tc->get_cgroup_item = lxcapi_get_cgroup_item;\n\tc->set_cgroup_item = lxcapi_set_cgroup_item;\n\tc->get_config_path = lxcapi_get_config_path;\n\tc->set_config_path = lxcapi_set_config_path;\n\tc->clone = lxcapi_clone;\n\tc->get_interfaces = lxcapi_get_interfaces;\n\tc->get_ips = lxcapi_get_ips;\n\tc->attach = lxcapi_attach;\n\tc->attach_run_wait = lxcapi_attach_run_wait;\n\tc->attach_run_waitl = lxcapi_attach_run_waitl;\n\tc->snapshot = lxcapi_snapshot;\n\tc->snapshot_list = lxcapi_snapshot_list;\n\tc->snapshot_restore = lxcapi_snapshot_restore;\n\tc->snapshot_destroy = lxcapi_snapshot_destroy;\n\tc->snapshot_destroy_all = lxcapi_snapshot_destroy_all;\n\tc->may_control = lxcapi_may_control;\n\tc->add_device_node = lxcapi_add_device_node;\n\tc->remove_device_node = lxcapi_remove_device_node;\n\tc->attach_interface = lxcapi_attach_interface;\n\tc->detach_interface = lxcapi_detach_interface;\n\tc->checkpoint = lxcapi_checkpoint;\n\tc->restore = lxcapi_restore;\n\tc->migrate = lxcapi_migrate;\n\n\treturn c;\n\nerr:\n\tlxc_container_free(c);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to create a trusty container\\n\"",
            "__LINE__"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->createl",
          "args": [
            "c",
            "\"busybox\"",
            "NULL",
            "NULL",
            "0",
            "NULL"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: error opening lxc_container %s\\n\"",
            "__LINE__",
            "MYNAME"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->destroy",
          "args": [
            "c"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: error opening lxc_container %s\\n\"",
            "__LINE__",
            "MYNAME"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.aa_profile returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.aa_profile) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.aa_profile\"",
            "v2",
            "255"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set aa_profile\\n\"",
            "__LINE__"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.aa_profile\"",
            "\"unconfined\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.mount.entry returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.mount.entry) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.mount.entry\"",
            "v2",
            "255"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set mount.entry\\n\"",
            "__LINE__"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.mount.entry\"",
            "\"hi there\""
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "alloced"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "freeifaddrs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/include/ifaddrs.c",
          "lines": "590-599",
          "snippet": "void freeifaddrs(struct ifaddrs *ifa)\n{\n    struct ifaddrs *l_cur;\n    while(ifa)\n    {\n        l_cur = ifa;\n        ifa = ifa->ifa_next;\n        free(l_cur);\n    }\n}",
          "includes": [
            "#include <linux/rtnetlink.h>",
            "#include <linux/netlink.h>",
            "#include <netinet/in.h>",
            "#include <net/if_arp.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include \"ifaddrs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <netinet/in.h>\n#include <net/if_arp.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include \"ifaddrs.h\"\n\nvoid freeifaddrs(struct ifaddrs *ifa)\n{\n    struct ifaddrs *l_cur;\n    while(ifa)\n    {\n        l_cur = ifa;\n        ifa = ifa->ifa_next;\n        free(l_cur);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.utsname returned %d %s\\n\"",
            "len",
            "alloced"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"lxc.utsname returned wrong value: %d %s not %d %s\\n\"",
            "ret",
            "alloced",
            "len",
            "HNAME"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "alloced",
            "HNAME"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.utsname) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.utsname\"",
            "alloced",
            "len+1"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to allocate %d bytes for utsname\\n\"",
            "__LINE__",
            "len"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "len+1"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.utsname returned %d\\n\"",
            "len"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.utsname) returned %d\\n\"",
            "__LINE__",
            "len"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.utsname\"",
            "NULL",
            "0"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set utsname\\n\"",
            "__LINE__"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.utsname\"",
            "HNAME"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.init_gid returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.init_gid) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.init_gid\"",
            "v2",
            "255"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set init_gid\\n\"",
            "__LINE__"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.init_gid\"",
            "\"100\""
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.init_uid returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.init_uid) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.init_uid\"",
            "v2",
            "255"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set init_uid\\n\"",
            "__LINE__"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.init_uid\"",
            "\"100\""
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"lxc.arch returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.arch) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.arch\"",
            "v2",
            "255"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set arch\\n\"",
            "__LINE__"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.arch\"",
            "\"x86\""
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"lxc.tty returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.tty) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.tty\"",
            "v2",
            "255"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set tty\\n\"",
            "__LINE__"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.tty\"",
            "\"4\""
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.network) returned %d %s\\n\"",
            "__LINE__",
            "ret",
            "v2"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.network\"",
            "v2",
            "255"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"lxc.hook.pre-start returned %d %s\\n\"",
            "ret",
            "v2"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: get_config_item(lxc.hook.pre-start) returned %d\\n\"",
            "__LINE__",
            "ret"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.hook.pre-start\"",
            "v2",
            "255"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: failed to set hook.pre-start\\n\"",
            "__LINE__"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.hook.pre-start\"",
            "\"hi there\""
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_debug",
          "args": [
            "\"%s\\n\"",
            "\"Successfully failed to set lxc.syslog to invalid value.\\n\""
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_error",
          "args": [
            "\"%s\\n\"",
            "\"Succeeded int setting lxc.syslog to invalid value \\\"NONSENSE\\\".\\n\""
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_error_set_and_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/error.c",
          "lines": "42-58",
          "snippet": "extern int  lxc_error_set_and_log(int pid, int status)\n{\n\tint ret = 0;\n\n\tif (WIFEXITED(status)) {\n\t\tret = WEXITSTATUS(status);\n\t\tif (ret)\n\t\t\tINFO(\"Child <%d> ended on error (%d).\", pid, ret);\n\t}\n\n\tif (WIFSIGNALED(status)) {\n\t\tint signal = WTERMSIG(status);\n\t\tINFO(\"Child <%d> ended on signal (%d).\", pid, signal);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"error.h\"\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nextern int  lxc_error_set_and_log(int pid, int status)\n{\n\tint ret = 0;\n\n\tif (WIFEXITED(status)) {\n\t\tret = WEXITSTATUS(status);\n\t\tif (ret)\n\t\t\tINFO(\"Child <%d> ended on error (%d).\", pid, ret);\n\t}\n\n\tif (WIFSIGNALED(status)) {\n\t\tint signal = WTERMSIG(status);\n\t\tINFO(\"Child <%d> ended on signal (%d).\", pid, signal);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.syslog\"",
            "\"NONSENSE\""
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_debug",
          "args": [
            "\"Retrieving value for lxc.syslog correctly returned: %s.\\n\"",
            "v2"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "v2",
            "\"local0\""
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->get_config_item",
          "args": [
            "c",
            "\"lxc.syslog\"",
            "v2",
            "255"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c->set_config_item",
          "args": [
            "c",
            "\"lxc.syslog\"",
            "\"local0\""
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%d: error opening lxc_container %s\\n\"",
            "__LINE__",
            "MYNAME"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"lxctest.h\"\n#include \"lxc/state.h\"\n#include <string.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <stdio.h>\n#include <signal.h>\n#include <unistd.h>\n#include <lxc/lxccontainer.h>\n\n#define HNAME \"hostname1\"\n#define MYNAME \"lxctest1\"\n\nint main(int argc, char *argv[])\n{\n\tint ret = EXIT_FAILURE;\n\tstruct lxc_container *c;\n\tchar v1[2], v2[256], v3[2048];\n\n\tif ((c = lxc_container_new(\"testxyz\", NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\texit(EXIT_FAILURE);\n\t}\n\n\t/* EXPECT SUCCESS: lxc.syslog with valid value. */\n\tif (!c->set_config_item(c, \"lxc.syslog\", \"local0\")) {\n\t\tlxc_error(\"%s\\n\", \"Failed to set lxc.syslog.\\n\");\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.syslog\", v2, 255);\n\tif (ret < 0) {\n\t\tlxc_error(\"Failed to retrieve lxc.syslog: %d.\\n\", ret);\n\t\tgoto out;\n\t}\n\tif (strcmp(v2, \"local0\") != 0) {\n\t\tlxc_error(\"Expected: local0 == %s.\\n\", v2);\n\t\tgoto out;\n\t}\n\tlxc_debug(\"Retrieving value for lxc.syslog correctly returned: %s.\\n\", v2);\n\n\t/* EXPECT FAILURE: lxc.syslog with invalid value. */\n\tif (c->set_config_item(c, \"lxc.syslog\", \"NONSENSE\")) {\n\t\tlxc_error(\"%s\\n\", \"Succeeded int setting lxc.syslog to invalid value \\\"NONSENSE\\\".\\n\");\n\t\tgoto out;\n\t}\n\tlxc_debug(\"%s\\n\", \"Successfully failed to set lxc.syslog to invalid value.\\n\");\n\n\tif (!c->set_config_item(c, \"lxc.hook.pre-start\", \"hi there\")) {\n\t\tfprintf(stderr, \"%d: failed to set hook.pre-start\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.hook.pre-start\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.hook.pre-start) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tfprintf(stderr, \"lxc.hook.pre-start returned %d %s\\n\", ret, v2);\n\n\tret = c->get_config_item(c, \"lxc.network\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tfprintf(stderr, \"%d: get_config_item(lxc.network) returned %d %s\\n\", __LINE__, ret, v2);\n\tif (!c->set_config_item(c, \"lxc.tty\", \"4\")) {\n\t\tfprintf(stderr, \"%d: failed to set tty\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.tty\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.tty) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tfprintf(stderr, \"lxc.tty returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.arch\", \"x86\")) {\n\t\tfprintf(stderr, \"%d: failed to set arch\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.arch\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.arch) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.arch returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.init_uid\", \"100\")) {\n\t\tfprintf(stderr, \"%d: failed to set init_uid\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.init_uid\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.init_uid) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.init_uid returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.init_gid\", \"100\")) {\n\t\tfprintf(stderr, \"%d: failed to set init_gid\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.init_gid\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.init_gid) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.init_gid returned %d %s\\n\", ret, v2);\n\n#define HNAME \"hostname1\"\n\t// demonstrate proper usage:\n\tchar *alloced;\n\tif (!c->set_config_item(c, \"lxc.utsname\", HNAME)) {\n\t\tfprintf(stderr, \"%d: failed to set utsname\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\n\tint len;\n\tlen = c->get_config_item(c, \"lxc.utsname\", NULL, 0);  // query the size of the string\n\tif (len < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.utsname) returned %d\\n\", __LINE__, len);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.utsname returned %d\\n\", len);\n\n\t// allocate the length of string + 1 for trailing \\0\n\talloced = malloc(len+1);\n\tif (!alloced) {\n\t\tfprintf(stderr, \"%d: failed to allocate %d bytes for utsname\\n\", __LINE__, len);\n\t\tgoto out;\n\t}\n\t// now pass in the malloc'd array, and pass in length of string + 1: again\n\t// because we need room for the trailing \\0\n\tret = c->get_config_item(c, \"lxc.utsname\", alloced, len+1);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.utsname) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tif (strcmp(alloced, HNAME) != 0 || ret != len) {\n\t\tfprintf(stderr, \"lxc.utsname returned wrong value: %d %s not %d %s\\n\", ret, alloced, len, HNAME);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.utsname returned %d %s\\n\", len, alloced);\n\tfree(alloced);\n\n\tif (!c->set_config_item(c, \"lxc.mount.entry\", \"hi there\")) {\n\t\tfprintf(stderr, \"%d: failed to set mount.entry\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.mount.entry\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.mount.entry) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.mount.entry returned %d %s\\n\", ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.aa_profile\", \"unconfined\")) {\n\t\tfprintf(stderr, \"%d: failed to set aa_profile\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.aa_profile\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.aa_profile) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"lxc.aa_profile returned %d %s\\n\", ret, v2);\n\n\tlxc_container_put(c);\n\n\t// new test with real container\n\tif ((c = lxc_container_new(MYNAME, NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\tgoto out;\n\t}\n\tc->destroy(c);\n\tlxc_container_put(c);\n\n\tif ((c = lxc_container_new(MYNAME, NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\tgoto out;\n\t}\n\tif (!c->createl(c, \"busybox\", NULL, NULL, 0, NULL)) {\n\t\tfprintf(stderr, \"%d: failed to create a trusty container\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tlxc_container_put(c);\n\n\t/* XXX TODO load_config needs to clear out any old config first */\n\tif ((c = lxc_container_new(MYNAME, NULL)) == NULL) {\n\t\tfprintf(stderr, \"%d: error opening lxc_container %s\\n\", __LINE__, MYNAME);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.cap.drop\", NULL, 300);\n\tif (ret < 5 || ret > 255) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.cap.drop) with NULL returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.cap.drop\", v1, 1);\n\tif (ret < 5 || ret > 255) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.cap.drop) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.cap.drop\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(lxc.cap.drop) returned %d %s\\n\", __LINE__, ret, v2);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item(lxc.cap.drop) returned %d %s\\n\", __LINE__, ret, v2);\n\tret = c->get_config_item(c, \"lxc.network\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item(lxc.network) returned %d %s\\n\", __LINE__, ret, v2);\n\n\tif (!c->set_config_item(c, \"lxc.network.ipv4\", \"10.2.3.4\")) {\n\t\tfprintf(stderr, \"%d: failed to set ipv4\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4\", v2, 255);\n\tif (ret <= 0) {\n\t\tfprintf(stderr, \"%d: lxc.network.0.ipv4 returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.network.0.ipv4\")) {\n\t\tfprintf(stderr, \"%d: failed clearing all ipv4 entries\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4\", v2, 255);\n\tif (ret != 0) {\n\t\tfprintf(stderr, \"%d: after clearing ipv4 entries get_item(lxc.network.0.ipv4 returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\n\tif (!c->set_config_item(c, \"lxc.network.ipv4.gateway\", \"10.2.3.254\")) {\n\t\tfprintf(stderr, \"%d: failed to set ipv4.gateway\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4.gateway\", v2, 255);\n\tif (ret <= 0) {\n\t\tfprintf(stderr, \"%d: lxc.network.0.ipv4.gateway returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tif (!c->set_config_item(c, \"lxc.network.0.ipv4.gateway\", \"\")) {\n\t\tfprintf(stderr, \"%d: failed clearing ipv4.gateway\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.network.0.ipv4.gateway\", v2, 255);\n\tif (ret != 0) {\n\t\tfprintf(stderr, \"%d: after clearing ipv4.gateway get_item(lxc.network.0.ipv4.gateway returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.network.0.link\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (link) returned %d %s\\n\", __LINE__, ret, v2);\n\tret = c->get_config_item(c, \"lxc.network.0.name\", v2, 255);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (name) returned %d %s\\n\", __LINE__, ret, v2);\n\n\tif (!c->clear_config_item(c, \"lxc.network\")) {\n\t\tfprintf(stderr, \"%d: clear_config_item failed\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tret = c->get_config_item(c, \"lxc.network\", v2, 255);\n\tif (ret != 0) {\n\t\tfprintf(stderr, \"%d: network was not actually cleared (get_network returned %d)\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\n\tret = c->get_config_item(c, \"lxc.cgroup\", v3, 2047);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(cgroup.devices) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (cgroup.devices) returned %d %s\\n\", __LINE__, ret, v3);\n\n\tret = c->get_config_item(c, \"lxc.cgroup.devices.allow\", v3, 2047);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"%d: get_config_item(cgroup.devices.devices.allow) returned %d\\n\", __LINE__, ret);\n\t\tgoto out;\n\t}\n\tprintf(\"%d: get_config_item (cgroup.devices.devices.allow) returned %d %s\\n\", __LINE__, ret, v3);\n\n\tif (!c->clear_config_item(c, \"lxc.cgroup\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.cgroup\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.cap.drop\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.cap.drop\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.mount.entry\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.mount.entry\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tif (!c->clear_config_item(c, \"lxc.hook\")) {\n\t\tfprintf(stderr, \"%d: failed clearing lxc.hook\\n\", __LINE__);\n\t\tgoto out;\n\t}\n\tprintf(\"All get_item tests passed\\n\");\n\tret = EXIT_SUCCESS;\nout:\n\tc->destroy(c);\n\tlxc_container_put(c);\n\texit(ret);\n}"
  }
]