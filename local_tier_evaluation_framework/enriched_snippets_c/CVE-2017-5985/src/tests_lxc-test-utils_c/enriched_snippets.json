[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "342-353",
    "snippet": "int main(int argc, char *argv[])\n{\n\ttest_lxc_string_replace();\n\ttest_lxc_string_in_array();\n\ttest_lxc_deslashify();\n\ttest_detect_ramfs_rootfs();\n\ttest_lxc_safe_uint();\n\ttest_lxc_safe_int();\n\ttest_lxc_safe_long();\n\n\texit(EXIT_SUCCESS);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "test_lxc_safe_long",
          "args": [],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "test_lxc_safe_long",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "269-288",
          "snippet": "void test_lxc_safe_long(void)\n{\n\tsigned long int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_safe_long(void)\n{\n\tsigned long int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_lxc_safe_int",
          "args": [],
          "line": 349
        },
        "resolved": true,
        "details": {
          "function_name": "test_lxc_safe_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "248-267",
          "snippet": "void test_lxc_safe_int(void)\n{\n\tsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_safe_int(void)\n{\n\tsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_lxc_safe_uint",
          "args": [],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "test_lxc_safe_uint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "229-246",
          "snippet": "void test_lxc_safe_uint(void)\n{\n\tunsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_safe_uint(void)\n{\n\tunsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_detect_ramfs_rootfs",
          "args": [],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "test_detect_ramfs_rootfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "75-227",
          "snippet": "void test_detect_ramfs_rootfs(void)\n{\n\tsize_t i;\n\tint ret;\n\tint fret = EXIT_FAILURE;\n\tchar path[__MNTNS_LEN];\n\tint init_ns = -1;\n\tchar tmpf1[] = \"lxc-test-utils-XXXXXX\";\n\tchar tmpf2[] = \"lxc-test-utils-XXXXXX\";\n\tint fd1 = -1, fd2 = -1;\n\tFILE *fp1 = NULL, *fp2 = NULL;\n\tchar *mountinfo[] = {\n\t\t\"18 24 0:17 / /sys rw,nosuid,nodev,noexec,relatime shared:7 - sysfs sysfs rw\",\n\t\t\"19 24 0:4 / /proc rw,nosuid,nodev,noexec,relatime shared:13 - proc proc rw\",\n\t\t\"20 24 0:6 / /dev rw,nosuid,relatime shared:2 - devtmpfs udev rw,size=4019884k,nr_inodes=1004971,mode=755\",\n\t\t\"21 20 0:14 / /dev/pts rw,nosuid,noexec,relatime shared:3 - devpts devpts rw,gid=5,mode=620,ptmxmode=000\",\n\t\t\"22 24 0:18 / /run rw,nosuid,noexec,relatime shared:5 - tmpfs tmpfs rw,size=807912k,mode=755\",\n\n\t\t/* This is what we care about. */\n\t\t\"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\",\n\n\t\t\"25 18 0:12 / /sys/kernel/security rw,nosuid,nodev,noexec,relatime shared:8 - securityfs securityfs rw\",\n\t\t\"26 20 0:20 / /dev/shm rw,nosuid,nodev shared:4 - tmpfs tmpfs rw\",\n\t\t\"27 22 0:21 / /run/lock rw,nosuid,nodev,noexec,relatime shared:6 - tmpfs tmpfs rw,size=5120k\",\n\t\t\"28 18 0:22 / /sys/fs/cgroup ro,nosuid,nodev,noexec shared:9 - tmpfs tmpfs ro,mode=755\",\n\t\t\"29 28 0:23 / /sys/fs/cgroup/systemd rw,nosuid,nodev,noexec,relatime shared:10 - cgroup cgroup rw,xattr,release_agent=/lib/systemd/systemd-cgroups-agent,name=systemd\",\n\t\t\"30 18 0:24 / /sys/fs/pstore rw,nosuid,nodev,noexec,relatime shared:11 - pstore pstore rw\",\n\t\t\"31 18 0:25 / /sys/firmware/efi/efivars rw,nosuid,nodev,noexec,relatime shared:12 - efivarfs efivarfs rw\",\n\t\t\"32 28 0:26 / /sys/fs/cgroup/cpu,cpuacct rw,nosuid,nodev,noexec,relatime shared:14 - cgroup cgroup rw,cpu,cpuacct\",\n\t\t\"33 28 0:27 / /sys/fs/cgroup/net_cls,net_prio rw,nosuid,nodev,noexec,relatime shared:15 - cgroup cgroup rw,net_cls,net_prio\",\n\t\t\"34 28 0:28 / /sys/fs/cgroup/blkio rw,nosuid,nodev,noexec,relatime shared:16 - cgroup cgroup rw,blkio\",\n\t\t\"35 28 0:29 / /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime shared:17 - cgroup cgroup rw,freezer\",\n\t\t\"36 28 0:30 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime shared:18 - cgroup cgroup rw,memory\",\n\t\t\"37 28 0:31 / /sys/fs/cgroup/hugetlb rw,nosuid,nodev,noexec,relatime shared:19 - cgroup cgroup rw,hugetlb\",\n\t\t\"38 28 0:32 / /sys/fs/cgroup/cpuset rw,nosuid,nodev,noexec,relatime shared:20 - cgroup cgroup rw,cpuset\",\n\t\t\"39 28 0:33 / /sys/fs/cgroup/devices rw,nosuid,nodev,noexec,relatime shared:21 - cgroup cgroup rw,devices\",\n\t\t\"40 28 0:34 / /sys/fs/cgroup/pids rw,nosuid,nodev,noexec,relatime shared:22 - cgroup cgroup rw,pids\",\n\t\t\"41 28 0:35 / /sys/fs/cgroup/perf_event rw,nosuid,nodev,noexec,relatime shared:23 - cgroup cgroup rw,perf_event\",\n\t\t\"42 19 0:36 / /proc/sys/fs/binfmt_misc rw,relatime shared:24 - autofs systemd-1 rw,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct\",\n\t\t\"43 18 0:7 / /sys/kernel/debug rw,relatime shared:25 - debugfs debugfs rw\",\n\t\t\"44 20 0:37 / /dev/hugepages rw,relatime shared:26 - hugetlbfs hugetlbfs rw\",\n\t\t\"45 20 0:16 / /dev/mqueue rw,relatime shared:27 - mqueue mqueue rw\",\n\t\t\"46 43 0:9 / /sys/kernel/debug/tracing rw,relatime shared:28 - tracefs tracefs rw\",\n\t\t\"76 18 0:38 / /sys/fs/fuse/connections rw,relatime shared:29 - fusectl fusectl rw\",\n\t\t\"78 24 8:1 / /boot/efi rw,relatime shared:30 - vfat /dev/sda1 rw,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro\",\n\t};\n\n\tret = snprintf(path, __MNTNS_LEN, \"/proc/self/ns/mnt\");\n\tif (ret < 0 || (size_t)ret >= __MNTNS_LEN) {\n\t\tlxc_error(\"%s\\n\", \"Failed to create path with snprintf().\");\n\t\tgoto non_test_error;\n\t}\n\n\tinit_ns = open(path, O_RDONLY | O_CLOEXEC);\n\tif (init_ns < 0) {\n\t\tlxc_error(\"%s\\n\", \"Failed to open initial mount namespace.\");\n\t\tgoto non_test_error;\n\t}\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not unshare mount namespace.\");\n\t\tclose(init_ns);\n\t\tinit_ns = -1;\n\t\tgoto non_test_error;\n\t}\n\n\tif (mount(NULL, \"/\", NULL, MS_REC | MS_PRIVATE, 0) < 0) {\n\t\tlxc_error(\"Failed to remount / private: %s.\\n\", strerror(errno));\n\t\tgoto non_test_error;\n\t}\n\n\tfd1 = mkstemp(tmpf1);\n\tif (fd1 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfd2 = mkstemp(tmpf2);\n\tif (fd2 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp1 = fdopen(fd1, \"r+\");\n\tif (!fp1) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp2 = fdopen(fd2, \"r+\");\n\tif (!fp2) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\t/* Test if it correctly detects - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (fprintf(fp1, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp1);\n\tfp1 = NULL;\n\n\t/* Test if it correctly fails to detect when no - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (strcmp(mountinfo[i], \"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\") == 0)\n\t\t\tcontinue;\n\t\tif (fprintf(fp2, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp2);\n\tfp2 = NULL;\n\n\tif (mount(tmpf1, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(detect_ramfs_rootfs());\n\n\tif (mount(tmpf2, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(!detect_ramfs_rootfs());\n\tfret = EXIT_SUCCESS;\n\nnon_test_error:\n\tif (fp1)\n\t\tfclose(fp1);\n\telse if (fd1 > 0)\n\t\tclose(fd1);\n\tif (fp2)\n\t\tfclose(fp2);\n\telse if (fd2 > 0)\n\t\tclose(fd2);\n\n\tif (init_ns > 0) {\n\t\tif (setns(init_ns, 0) < 0) {\n\t\t\tlxc_error(\"Failed to switch back to initial mount namespace: %s.\\n\", strerror(errno));\n\t\t\tfret = EXIT_FAILURE;\n\t\t}\n\t\tclose(init_ns);\n\t}\n\tif (fret == EXIT_SUCCESS)\n\t\treturn;\n\texit(fret);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define __MNTNS_LEN (5 + (LXC_NUMSTRLEN64) + 7 + 1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define __MNTNS_LEN (5 + (LXC_NUMSTRLEN64) + 7 + 1)\n\nvoid test_detect_ramfs_rootfs(void)\n{\n\tsize_t i;\n\tint ret;\n\tint fret = EXIT_FAILURE;\n\tchar path[__MNTNS_LEN];\n\tint init_ns = -1;\n\tchar tmpf1[] = \"lxc-test-utils-XXXXXX\";\n\tchar tmpf2[] = \"lxc-test-utils-XXXXXX\";\n\tint fd1 = -1, fd2 = -1;\n\tFILE *fp1 = NULL, *fp2 = NULL;\n\tchar *mountinfo[] = {\n\t\t\"18 24 0:17 / /sys rw,nosuid,nodev,noexec,relatime shared:7 - sysfs sysfs rw\",\n\t\t\"19 24 0:4 / /proc rw,nosuid,nodev,noexec,relatime shared:13 - proc proc rw\",\n\t\t\"20 24 0:6 / /dev rw,nosuid,relatime shared:2 - devtmpfs udev rw,size=4019884k,nr_inodes=1004971,mode=755\",\n\t\t\"21 20 0:14 / /dev/pts rw,nosuid,noexec,relatime shared:3 - devpts devpts rw,gid=5,mode=620,ptmxmode=000\",\n\t\t\"22 24 0:18 / /run rw,nosuid,noexec,relatime shared:5 - tmpfs tmpfs rw,size=807912k,mode=755\",\n\n\t\t/* This is what we care about. */\n\t\t\"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\",\n\n\t\t\"25 18 0:12 / /sys/kernel/security rw,nosuid,nodev,noexec,relatime shared:8 - securityfs securityfs rw\",\n\t\t\"26 20 0:20 / /dev/shm rw,nosuid,nodev shared:4 - tmpfs tmpfs rw\",\n\t\t\"27 22 0:21 / /run/lock rw,nosuid,nodev,noexec,relatime shared:6 - tmpfs tmpfs rw,size=5120k\",\n\t\t\"28 18 0:22 / /sys/fs/cgroup ro,nosuid,nodev,noexec shared:9 - tmpfs tmpfs ro,mode=755\",\n\t\t\"29 28 0:23 / /sys/fs/cgroup/systemd rw,nosuid,nodev,noexec,relatime shared:10 - cgroup cgroup rw,xattr,release_agent=/lib/systemd/systemd-cgroups-agent,name=systemd\",\n\t\t\"30 18 0:24 / /sys/fs/pstore rw,nosuid,nodev,noexec,relatime shared:11 - pstore pstore rw\",\n\t\t\"31 18 0:25 / /sys/firmware/efi/efivars rw,nosuid,nodev,noexec,relatime shared:12 - efivarfs efivarfs rw\",\n\t\t\"32 28 0:26 / /sys/fs/cgroup/cpu,cpuacct rw,nosuid,nodev,noexec,relatime shared:14 - cgroup cgroup rw,cpu,cpuacct\",\n\t\t\"33 28 0:27 / /sys/fs/cgroup/net_cls,net_prio rw,nosuid,nodev,noexec,relatime shared:15 - cgroup cgroup rw,net_cls,net_prio\",\n\t\t\"34 28 0:28 / /sys/fs/cgroup/blkio rw,nosuid,nodev,noexec,relatime shared:16 - cgroup cgroup rw,blkio\",\n\t\t\"35 28 0:29 / /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime shared:17 - cgroup cgroup rw,freezer\",\n\t\t\"36 28 0:30 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime shared:18 - cgroup cgroup rw,memory\",\n\t\t\"37 28 0:31 / /sys/fs/cgroup/hugetlb rw,nosuid,nodev,noexec,relatime shared:19 - cgroup cgroup rw,hugetlb\",\n\t\t\"38 28 0:32 / /sys/fs/cgroup/cpuset rw,nosuid,nodev,noexec,relatime shared:20 - cgroup cgroup rw,cpuset\",\n\t\t\"39 28 0:33 / /sys/fs/cgroup/devices rw,nosuid,nodev,noexec,relatime shared:21 - cgroup cgroup rw,devices\",\n\t\t\"40 28 0:34 / /sys/fs/cgroup/pids rw,nosuid,nodev,noexec,relatime shared:22 - cgroup cgroup rw,pids\",\n\t\t\"41 28 0:35 / /sys/fs/cgroup/perf_event rw,nosuid,nodev,noexec,relatime shared:23 - cgroup cgroup rw,perf_event\",\n\t\t\"42 19 0:36 / /proc/sys/fs/binfmt_misc rw,relatime shared:24 - autofs systemd-1 rw,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct\",\n\t\t\"43 18 0:7 / /sys/kernel/debug rw,relatime shared:25 - debugfs debugfs rw\",\n\t\t\"44 20 0:37 / /dev/hugepages rw,relatime shared:26 - hugetlbfs hugetlbfs rw\",\n\t\t\"45 20 0:16 / /dev/mqueue rw,relatime shared:27 - mqueue mqueue rw\",\n\t\t\"46 43 0:9 / /sys/kernel/debug/tracing rw,relatime shared:28 - tracefs tracefs rw\",\n\t\t\"76 18 0:38 / /sys/fs/fuse/connections rw,relatime shared:29 - fusectl fusectl rw\",\n\t\t\"78 24 8:1 / /boot/efi rw,relatime shared:30 - vfat /dev/sda1 rw,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro\",\n\t};\n\n\tret = snprintf(path, __MNTNS_LEN, \"/proc/self/ns/mnt\");\n\tif (ret < 0 || (size_t)ret >= __MNTNS_LEN) {\n\t\tlxc_error(\"%s\\n\", \"Failed to create path with snprintf().\");\n\t\tgoto non_test_error;\n\t}\n\n\tinit_ns = open(path, O_RDONLY | O_CLOEXEC);\n\tif (init_ns < 0) {\n\t\tlxc_error(\"%s\\n\", \"Failed to open initial mount namespace.\");\n\t\tgoto non_test_error;\n\t}\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not unshare mount namespace.\");\n\t\tclose(init_ns);\n\t\tinit_ns = -1;\n\t\tgoto non_test_error;\n\t}\n\n\tif (mount(NULL, \"/\", NULL, MS_REC | MS_PRIVATE, 0) < 0) {\n\t\tlxc_error(\"Failed to remount / private: %s.\\n\", strerror(errno));\n\t\tgoto non_test_error;\n\t}\n\n\tfd1 = mkstemp(tmpf1);\n\tif (fd1 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfd2 = mkstemp(tmpf2);\n\tif (fd2 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp1 = fdopen(fd1, \"r+\");\n\tif (!fp1) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp2 = fdopen(fd2, \"r+\");\n\tif (!fp2) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\t/* Test if it correctly detects - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (fprintf(fp1, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp1);\n\tfp1 = NULL;\n\n\t/* Test if it correctly fails to detect when no - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (strcmp(mountinfo[i], \"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\") == 0)\n\t\t\tcontinue;\n\t\tif (fprintf(fp2, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp2);\n\tfp2 = NULL;\n\n\tif (mount(tmpf1, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(detect_ramfs_rootfs());\n\n\tif (mount(tmpf2, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(!detect_ramfs_rootfs());\n\tfret = EXIT_SUCCESS;\n\nnon_test_error:\n\tif (fp1)\n\t\tfclose(fp1);\n\telse if (fd1 > 0)\n\t\tclose(fd1);\n\tif (fp2)\n\t\tfclose(fp2);\n\telse if (fd2 > 0)\n\t\tclose(fd2);\n\n\tif (init_ns > 0) {\n\t\tif (setns(init_ns, 0) < 0) {\n\t\t\tlxc_error(\"Failed to switch back to initial mount namespace: %s.\\n\", strerror(errno));\n\t\t\tfret = EXIT_FAILURE;\n\t\t}\n\t\tclose(init_ns);\n\t}\n\tif (fret == EXIT_SUCCESS)\n\t\treturn;\n\texit(fret);\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_lxc_deslashify",
          "args": [],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "test_lxc_deslashify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "42-71",
          "snippet": "void test_lxc_deslashify(void)\n{\n\tchar *s = strdup(\"/A///B//C/D/E/\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A/B/C/D/E\") == 0);\n\tfree(s);\n\n\ts = strdup(\"/A\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A\") == 0);\n\tfree(s);\n\n\ts = strdup(\"\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"\") == 0);\n\tfree(s);\n\n\ts = strdup(\"//\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/\") == 0);\n\tfree(s);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_deslashify(void)\n{\n\tchar *s = strdup(\"/A///B//C/D/E/\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A/B/C/D/E\") == 0);\n\tfree(s);\n\n\ts = strdup(\"/A\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A\") == 0);\n\tfree(s);\n\n\ts = strdup(\"\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"\") == 0);\n\tfree(s);\n\n\ts = strdup(\"//\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/\") == 0);\n\tfree(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_lxc_string_in_array",
          "args": [],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "test_lxc_string_in_array",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "327-340",
          "snippet": "void test_lxc_string_in_array(void)\n{\n\tlxc_test_assert_abort(lxc_string_in_array(\"\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"A\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"AAA\", (const char *[]){\"\", \"3472\", \"jshH\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", \"B\", \"C\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"B\", \"A\", \"C\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"ABC\", (const char *[]){\"ASD\", \"ATR\", \"ABC\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"GHJ\", (const char *[]){\"AZIU\", \"WRT567B\", \"879C\", \"GHJ\", \"IUZ89\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"XYZ\", (const char *[]){\"BERTA\", \"ARQWE(9\", \"C8Zhkd\", \"7U\", \"XYZ\", \"UOIZ9\", \"=)()\", NULL}));\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_string_in_array(void)\n{\n\tlxc_test_assert_abort(lxc_string_in_array(\"\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"A\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"AAA\", (const char *[]){\"\", \"3472\", \"jshH\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", \"B\", \"C\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"B\", \"A\", \"C\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"ABC\", (const char *[]){\"ASD\", \"ATR\", \"ABC\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"GHJ\", (const char *[]){\"AZIU\", \"WRT567B\", \"879C\", \"GHJ\", \"IUZ89\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"XYZ\", (const char *[]){\"BERTA\", \"ARQWE(9\", \"C8Zhkd\", \"7U\", \"XYZ\", \"UOIZ9\", \"=)()\", NULL}));\n}"
        }
      },
      {
        "call_info": {
          "callee": "test_lxc_string_replace",
          "args": [],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "test_lxc_string_replace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "290-325",
          "snippet": "void test_lxc_string_replace(void)\n{\n\tchar *s;\n\n\ts = lxc_string_replace(\"A\", \"A\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"AA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BA\");\n\tlxc_test_assert_abort(strcmp(s, \"BAA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"AA\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAA\");\n\tlxc_test_assert_abort(strcmp(s, \"BA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"\\\"A\\\"A\", \"\\\"A\\\"\", \"B\\\"A\\\"AB\");\n\tlxc_test_assert_abort(strcmp(s, \"B\\\"A\\\"B\") == 0);\n\tfree(s);\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"lxctest.h\"",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_string_replace(void)\n{\n\tchar *s;\n\n\ts = lxc_string_replace(\"A\", \"A\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"AA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BA\");\n\tlxc_test_assert_abort(strcmp(s, \"BAA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"AA\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAA\");\n\tlxc_test_assert_abort(strcmp(s, \"BA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"\\\"A\\\"A\", \"\\\"A\\\"\", \"B\\\"A\\\"AB\");\n\tlxc_test_assert_abort(strcmp(s, \"B\\\"A\\\"B\") == 0);\n\tfree(s);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nint main(int argc, char *argv[])\n{\n\ttest_lxc_string_replace();\n\ttest_lxc_string_in_array();\n\ttest_lxc_deslashify();\n\ttest_detect_ramfs_rootfs();\n\ttest_lxc_safe_uint();\n\ttest_lxc_safe_int();\n\ttest_lxc_safe_long();\n\n\texit(EXIT_SUCCESS);\n}"
  },
  {
    "function_name": "test_lxc_string_in_array",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "327-340",
    "snippet": "void test_lxc_string_in_array(void)\n{\n\tlxc_test_assert_abort(lxc_string_in_array(\"\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"A\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"AAA\", (const char *[]){\"\", \"3472\", \"jshH\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", \"B\", \"C\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"B\", \"A\", \"C\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"ABC\", (const char *[]){\"ASD\", \"ATR\", \"ABC\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"GHJ\", (const char *[]){\"AZIU\", \"WRT567B\", \"879C\", \"GHJ\", \"IUZ89\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"XYZ\", (const char *[]){\"BERTA\", \"ARQWE(9\", \"C8Zhkd\", \"7U\", \"XYZ\", \"UOIZ9\", \"=)()\", NULL}));\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"XYZ\", (const char *[]){\"BERTA\", \"ARQWE(9\", \"C8Zhkd\", \"7U\", \"XYZ\", \"UOIZ9\", \"=)()\", NULL})"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_string_in_array",
          "args": [
            "\"XYZ\"",
            "(const char *[]){\"BERTA\", \"ARQWE(9\", \"C8Zhkd\", \"7U\", \"XYZ\", \"UOIZ9\", \"=)()\", NULL}"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_string_in_array",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "656-662",
          "snippet": "bool lxc_string_in_array(const char *needle, const char **haystack)\n{\n\tfor (; haystack && *haystack; haystack++)\n\t\tif (!strcmp(needle, *haystack))\n\t\t\treturn true;\n\treturn false;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nbool lxc_string_in_array(const char *needle, const char **haystack)\n{\n\tfor (; haystack && *haystack; haystack++)\n\t\tif (!strcmp(needle, *haystack))\n\t\t\treturn true;\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"GHJ\", (const char *[]){\"AZIU\", \"WRT567B\", \"879C\", \"GHJ\", \"IUZ89\", NULL})"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"ABC\", (const char *[]){\"ASD\", \"ATR\", \"ABC\", NULL})"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"A\", (const char *[]){\"B\", \"A\", \"C\", NULL})"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"A\", (const char *[]){\"A\", \"B\", \"C\", NULL})"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"A\", (const char *[]){\"A\", NULL})"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "!lxc_string_in_array(\"AAA\", (const char *[]){\"\", \"3472\", \"jshH\", NULL})"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "!lxc_string_in_array(\"A\", (const char *[]){\"\", NULL})"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_string_in_array(\"\", (const char *[]){\"\", NULL})"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_string_in_array(void)\n{\n\tlxc_test_assert_abort(lxc_string_in_array(\"\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"A\", (const char *[]){\"\", NULL}));\n\tlxc_test_assert_abort(!lxc_string_in_array(\"AAA\", (const char *[]){\"\", \"3472\", \"jshH\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"A\", \"B\", \"C\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"A\", (const char *[]){\"B\", \"A\", \"C\", NULL}));\n\n\tlxc_test_assert_abort(lxc_string_in_array(\"ABC\", (const char *[]){\"ASD\", \"ATR\", \"ABC\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"GHJ\", (const char *[]){\"AZIU\", \"WRT567B\", \"879C\", \"GHJ\", \"IUZ89\", NULL}));\n\tlxc_test_assert_abort(lxc_string_in_array(\"XYZ\", (const char *[]){\"BERTA\", \"ARQWE(9\", \"C8Zhkd\", \"7U\", \"XYZ\", \"UOIZ9\", \"=)()\", NULL}));\n}"
  },
  {
    "function_name": "test_lxc_string_replace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "290-325",
    "snippet": "void test_lxc_string_replace(void)\n{\n\tchar *s;\n\n\ts = lxc_string_replace(\"A\", \"A\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"AA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BA\");\n\tlxc_test_assert_abort(strcmp(s, \"BAA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"AA\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAA\");\n\tlxc_test_assert_abort(strcmp(s, \"BA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"\\\"A\\\"A\", \"\\\"A\\\"\", \"B\\\"A\\\"AB\");\n\tlxc_test_assert_abort(strcmp(s, \"B\\\"A\\\"B\") == 0);\n\tfree(s);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "s"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "freeifaddrs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/include/ifaddrs.c",
          "lines": "590-599",
          "snippet": "void freeifaddrs(struct ifaddrs *ifa)\n{\n    struct ifaddrs *l_cur;\n    while(ifa)\n    {\n        l_cur = ifa;\n        ifa = ifa->ifa_next;\n        free(l_cur);\n    }\n}",
          "includes": [
            "#include <linux/rtnetlink.h>",
            "#include <linux/netlink.h>",
            "#include <netinet/in.h>",
            "#include <net/if_arp.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include \"ifaddrs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <netinet/in.h>\n#include <net/if_arp.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include \"ifaddrs.h\"\n\nvoid freeifaddrs(struct ifaddrs *ifa)\n{\n    struct ifaddrs *l_cur;\n    while(ifa)\n    {\n        l_cur = ifa;\n        ifa = ifa->ifa_next;\n        free(l_cur);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"B\\\"A\\\"B\") == 0"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"B\\\"A\\\"B\""
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_string_replace",
          "args": [
            "\"\\\"A\\\"A\"",
            "\"\\\"A\\\"\"",
            "\"B\\\"A\\\"AB\""
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_string_replace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "601-654",
          "snippet": "char *lxc_string_replace(const char *needle, const char *replacement, const char *haystack)\n{\n\tssize_t len = -1, saved_len = -1;\n\tchar *result = NULL;\n\tsize_t replacement_len = strlen(replacement);\n\tsize_t needle_len = strlen(needle);\n\n\t/* should be executed exactly twice */\n\twhile (len == -1 || result == NULL) {\n\t\tchar *p;\n\t\tchar *last_p;\n\t\tssize_t part_len;\n\n\t\tif (len != -1) {\n\t\t\tresult = calloc(1, len + 1);\n\t\t\tif (!result)\n\t\t\t\treturn NULL;\n\t\t\tsaved_len = len;\n\t\t}\n\n\t\tlen = 0;\n\n\t\tfor (last_p = (char *)haystack, p = strstr(last_p, needle); p; last_p = p, p = strstr(last_p, needle)) {\n\t\t\tpart_len = (ssize_t)(p - last_p);\n\t\t\tif (result && part_len > 0)\n\t\t\t\tmemcpy(&result[len], last_p, part_len);\n\t\t\tlen += part_len;\n\t\t\tif (result && replacement_len > 0)\n\t\t\t\tmemcpy(&result[len], replacement, replacement_len);\n\t\t\tlen += replacement_len;\n\t\t\tp += needle_len;\n\t\t}\n\t\tpart_len = strlen(last_p);\n\t\tif (result && part_len > 0)\n\t\t\tmemcpy(&result[len], last_p, part_len);\n\t\tlen += part_len;\n\t}\n\n\t/* make sure we did the same thing twice,\n\t * once for calculating length, the other\n\t * time for copying data */\n\tif (saved_len != len) {\n\t\tfree(result);\n\t\treturn NULL;\n\t}\n\t/* make sure we didn't overwrite any buffer,\n\t * due to calloc the string should be 0-terminated */\n\tif (result[len] != '\\0') {\n\t\tfree(result);\n\t\treturn NULL;\n\t}\n\n\treturn result;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nchar *lxc_string_replace(const char *needle, const char *replacement, const char *haystack)\n{\n\tssize_t len = -1, saved_len = -1;\n\tchar *result = NULL;\n\tsize_t replacement_len = strlen(replacement);\n\tsize_t needle_len = strlen(needle);\n\n\t/* should be executed exactly twice */\n\twhile (len == -1 || result == NULL) {\n\t\tchar *p;\n\t\tchar *last_p;\n\t\tssize_t part_len;\n\n\t\tif (len != -1) {\n\t\t\tresult = calloc(1, len + 1);\n\t\t\tif (!result)\n\t\t\t\treturn NULL;\n\t\t\tsaved_len = len;\n\t\t}\n\n\t\tlen = 0;\n\n\t\tfor (last_p = (char *)haystack, p = strstr(last_p, needle); p; last_p = p, p = strstr(last_p, needle)) {\n\t\t\tpart_len = (ssize_t)(p - last_p);\n\t\t\tif (result && part_len > 0)\n\t\t\t\tmemcpy(&result[len], last_p, part_len);\n\t\t\tlen += part_len;\n\t\t\tif (result && replacement_len > 0)\n\t\t\t\tmemcpy(&result[len], replacement, replacement_len);\n\t\t\tlen += replacement_len;\n\t\t\tp += needle_len;\n\t\t}\n\t\tpart_len = strlen(last_p);\n\t\tif (result && part_len > 0)\n\t\t\tmemcpy(&result[len], last_p, part_len);\n\t\tlen += part_len;\n\t}\n\n\t/* make sure we did the same thing twice,\n\t * once for calculating length, the other\n\t * time for copying data */\n\tif (saved_len != len) {\n\t\tfree(result);\n\t\treturn NULL;\n\t}\n\t/* make sure we didn't overwrite any buffer,\n\t * due to calloc the string should be 0-terminated */\n\tif (result[len] != '\\0') {\n\t\tfree(result);\n\t\treturn NULL;\n\t}\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"BAB\") == 0"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"BAB\""
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"BA\") == 0"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"BA\""
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"A\") == 0"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"A\""
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"BAAB\") == 0"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"BAAB\""
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"BAA\") == 0"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"BAA\""
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"AA\") == 0"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"AA\""
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"A\") == 0"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"A\""
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_string_replace(void)\n{\n\tchar *s;\n\n\ts = lxc_string_replace(\"A\", \"A\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"A\");\n\tlxc_test_assert_abort(strcmp(s, \"AA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BA\");\n\tlxc_test_assert_abort(strcmp(s, \"BAA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"A\", \"AA\", \"BAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"AA\");\n\tlxc_test_assert_abort(strcmp(s, \"A\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAA\");\n\tlxc_test_assert_abort(strcmp(s, \"BA\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"AA\", \"A\", \"BAAB\");\n\tlxc_test_assert_abort(strcmp(s, \"BAB\") == 0);\n\tfree(s);\n\n\ts = lxc_string_replace(\"\\\"A\\\"A\", \"\\\"A\\\"\", \"B\\\"A\\\"AB\");\n\tlxc_test_assert_abort(strcmp(s, \"B\\\"A\\\"B\") == 0);\n\tfree(s);\n}"
  },
  {
    "function_name": "test_lxc_safe_long",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "269-288",
    "snippet": "void test_lxc_safe_long(void)\n{\n\tsigned long int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"   g345\", &n))"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_safe_long",
          "args": [
            "\"   g345\"",
            "&n"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_safe_long",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "2025-2043",
          "snippet": "int lxc_safe_long(const char *numstr, long int *converted)\n{\n\tchar *err = NULL;\n\tsigned long int sli;\n\n\terrno = 0;\n\tsli = strtol(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (sli > LONG_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = sli;\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_safe_long(const char *numstr, long int *converted)\n{\n\tchar *err = NULL;\n\tsigned long int sli;\n\n\terrno = 0;\n\tsli = strtol(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (sli > LONG_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = sli;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"g\", &n))"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"345g   \", &n))"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"3g45   \", &n))"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"g345   \", &n))"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"345g\", &n))"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"3g45\", &n))"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"g345\", &n))"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"   345g\", &n))"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"   3g45\", &n))"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_long(\"   g345\", &n))"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_long(\"   -345\", &n)) && n == -345"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_long(\"-1234345\", &n)) && n == -1234345"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_long(\"   345\", &n)) && n == 345"
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_long(\"1234345\", &n)) && n == 1234345"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_safe_long(void)\n{\n\tsigned long int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_long(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_long(\"   g345\", &n)));\n}"
  },
  {
    "function_name": "test_lxc_safe_int",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "248-267",
    "snippet": "void test_lxc_safe_int(void)\n{\n\tsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"   g345\", &n))"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_safe_int",
          "args": [
            "\"   g345\"",
            "&n"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_safe_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "2005-2023",
          "snippet": "int lxc_safe_int(const char *numstr, int *converted)\n{\n\tchar *err = NULL;\n\tsigned long int sli;\n\n\terrno = 0;\n\tsli = strtol(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (sli > INT_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = (int)sli;\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_safe_int(const char *numstr, int *converted)\n{\n\tchar *err = NULL;\n\tsigned long int sli;\n\n\terrno = 0;\n\tsli = strtol(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (sli > INT_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = (int)sli;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"g\", &n))"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"345g   \", &n))"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"3g45   \", &n))"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"g345   \", &n))"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"345g\", &n))"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"3g45\", &n))"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"g345\", &n))"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"   345g\", &n))"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"   3g45\", &n))"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_int(\"   g345\", &n))"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_int(\"   -345\", &n)) && n == -345"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_int(\"-1234345\", &n)) && n == -1234345"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_int(\"   345\", &n)) && n == 345"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_int(\"1234345\", &n)) && n == 1234345"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_safe_int(void)\n{\n\tsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"-1234345\", &n)) && n == -1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_int(\"   -345\", &n)) && n == -345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_int(\"   g345\", &n)));\n}"
  },
  {
    "function_name": "test_lxc_safe_uint",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "229-246",
    "snippet": "void test_lxc_safe_uint(void)\n{\n\tunsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"   g345\", &n))"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_safe_uint",
          "args": [
            "\"   g345\"",
            "&n"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_safe_uint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "1985-2003",
          "snippet": "int lxc_safe_uint(const char *numstr, unsigned int *converted)\n{\n\tchar *err = NULL;\n\tunsigned long int uli;\n\n\terrno = 0;\n\tuli = strtoul(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (uli > UINT_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = (unsigned int)uli;\n\treturn 0;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_safe_uint(const char *numstr, unsigned int *converted)\n{\n\tchar *err = NULL;\n\tunsigned long int uli;\n\n\terrno = 0;\n\tuli = strtoul(numstr, &err, 0);\n\tif (errno > 0)\n\t\treturn -errno;\n\n\tif (!err || err == numstr || *err != '\\0')\n\t\treturn -EINVAL;\n\n\tif (uli > UINT_MAX)\n\t\treturn -ERANGE;\n\n\t*converted = (unsigned int)uli;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"g\", &n))"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"345g   \", &n))"
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"3g45   \", &n))"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"g345   \", &n))"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"345g\", &n))"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"3g45\", &n))"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"g345\", &n))"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"   345g\", &n))"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"   3g45\", &n))"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(-EINVAL == lxc_safe_uint(\"   g345\", &n))"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_uint(\"   345\", &n)) && n == 345"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "(0 == lxc_safe_uint(\"1234345\", &n)) && n == 1234345"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_safe_uint(void)\n{\n\tunsigned int n;\n\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"1234345\", &n)) && n == 1234345);\n\tlxc_test_assert_abort((0 == lxc_safe_uint(\"   345\", &n)) && n == 345);\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g345   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"3g45   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"345g   \", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"g\", &n)));\n\tlxc_test_assert_abort((-EINVAL == lxc_safe_uint(\"   g345\", &n)));\n}"
  },
  {
    "function_name": "test_detect_ramfs_rootfs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "75-227",
    "snippet": "void test_detect_ramfs_rootfs(void)\n{\n\tsize_t i;\n\tint ret;\n\tint fret = EXIT_FAILURE;\n\tchar path[__MNTNS_LEN];\n\tint init_ns = -1;\n\tchar tmpf1[] = \"lxc-test-utils-XXXXXX\";\n\tchar tmpf2[] = \"lxc-test-utils-XXXXXX\";\n\tint fd1 = -1, fd2 = -1;\n\tFILE *fp1 = NULL, *fp2 = NULL;\n\tchar *mountinfo[] = {\n\t\t\"18 24 0:17 / /sys rw,nosuid,nodev,noexec,relatime shared:7 - sysfs sysfs rw\",\n\t\t\"19 24 0:4 / /proc rw,nosuid,nodev,noexec,relatime shared:13 - proc proc rw\",\n\t\t\"20 24 0:6 / /dev rw,nosuid,relatime shared:2 - devtmpfs udev rw,size=4019884k,nr_inodes=1004971,mode=755\",\n\t\t\"21 20 0:14 / /dev/pts rw,nosuid,noexec,relatime shared:3 - devpts devpts rw,gid=5,mode=620,ptmxmode=000\",\n\t\t\"22 24 0:18 / /run rw,nosuid,noexec,relatime shared:5 - tmpfs tmpfs rw,size=807912k,mode=755\",\n\n\t\t/* This is what we care about. */\n\t\t\"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\",\n\n\t\t\"25 18 0:12 / /sys/kernel/security rw,nosuid,nodev,noexec,relatime shared:8 - securityfs securityfs rw\",\n\t\t\"26 20 0:20 / /dev/shm rw,nosuid,nodev shared:4 - tmpfs tmpfs rw\",\n\t\t\"27 22 0:21 / /run/lock rw,nosuid,nodev,noexec,relatime shared:6 - tmpfs tmpfs rw,size=5120k\",\n\t\t\"28 18 0:22 / /sys/fs/cgroup ro,nosuid,nodev,noexec shared:9 - tmpfs tmpfs ro,mode=755\",\n\t\t\"29 28 0:23 / /sys/fs/cgroup/systemd rw,nosuid,nodev,noexec,relatime shared:10 - cgroup cgroup rw,xattr,release_agent=/lib/systemd/systemd-cgroups-agent,name=systemd\",\n\t\t\"30 18 0:24 / /sys/fs/pstore rw,nosuid,nodev,noexec,relatime shared:11 - pstore pstore rw\",\n\t\t\"31 18 0:25 / /sys/firmware/efi/efivars rw,nosuid,nodev,noexec,relatime shared:12 - efivarfs efivarfs rw\",\n\t\t\"32 28 0:26 / /sys/fs/cgroup/cpu,cpuacct rw,nosuid,nodev,noexec,relatime shared:14 - cgroup cgroup rw,cpu,cpuacct\",\n\t\t\"33 28 0:27 / /sys/fs/cgroup/net_cls,net_prio rw,nosuid,nodev,noexec,relatime shared:15 - cgroup cgroup rw,net_cls,net_prio\",\n\t\t\"34 28 0:28 / /sys/fs/cgroup/blkio rw,nosuid,nodev,noexec,relatime shared:16 - cgroup cgroup rw,blkio\",\n\t\t\"35 28 0:29 / /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime shared:17 - cgroup cgroup rw,freezer\",\n\t\t\"36 28 0:30 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime shared:18 - cgroup cgroup rw,memory\",\n\t\t\"37 28 0:31 / /sys/fs/cgroup/hugetlb rw,nosuid,nodev,noexec,relatime shared:19 - cgroup cgroup rw,hugetlb\",\n\t\t\"38 28 0:32 / /sys/fs/cgroup/cpuset rw,nosuid,nodev,noexec,relatime shared:20 - cgroup cgroup rw,cpuset\",\n\t\t\"39 28 0:33 / /sys/fs/cgroup/devices rw,nosuid,nodev,noexec,relatime shared:21 - cgroup cgroup rw,devices\",\n\t\t\"40 28 0:34 / /sys/fs/cgroup/pids rw,nosuid,nodev,noexec,relatime shared:22 - cgroup cgroup rw,pids\",\n\t\t\"41 28 0:35 / /sys/fs/cgroup/perf_event rw,nosuid,nodev,noexec,relatime shared:23 - cgroup cgroup rw,perf_event\",\n\t\t\"42 19 0:36 / /proc/sys/fs/binfmt_misc rw,relatime shared:24 - autofs systemd-1 rw,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct\",\n\t\t\"43 18 0:7 / /sys/kernel/debug rw,relatime shared:25 - debugfs debugfs rw\",\n\t\t\"44 20 0:37 / /dev/hugepages rw,relatime shared:26 - hugetlbfs hugetlbfs rw\",\n\t\t\"45 20 0:16 / /dev/mqueue rw,relatime shared:27 - mqueue mqueue rw\",\n\t\t\"46 43 0:9 / /sys/kernel/debug/tracing rw,relatime shared:28 - tracefs tracefs rw\",\n\t\t\"76 18 0:38 / /sys/fs/fuse/connections rw,relatime shared:29 - fusectl fusectl rw\",\n\t\t\"78 24 8:1 / /boot/efi rw,relatime shared:30 - vfat /dev/sda1 rw,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro\",\n\t};\n\n\tret = snprintf(path, __MNTNS_LEN, \"/proc/self/ns/mnt\");\n\tif (ret < 0 || (size_t)ret >= __MNTNS_LEN) {\n\t\tlxc_error(\"%s\\n\", \"Failed to create path with snprintf().\");\n\t\tgoto non_test_error;\n\t}\n\n\tinit_ns = open(path, O_RDONLY | O_CLOEXEC);\n\tif (init_ns < 0) {\n\t\tlxc_error(\"%s\\n\", \"Failed to open initial mount namespace.\");\n\t\tgoto non_test_error;\n\t}\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not unshare mount namespace.\");\n\t\tclose(init_ns);\n\t\tinit_ns = -1;\n\t\tgoto non_test_error;\n\t}\n\n\tif (mount(NULL, \"/\", NULL, MS_REC | MS_PRIVATE, 0) < 0) {\n\t\tlxc_error(\"Failed to remount / private: %s.\\n\", strerror(errno));\n\t\tgoto non_test_error;\n\t}\n\n\tfd1 = mkstemp(tmpf1);\n\tif (fd1 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfd2 = mkstemp(tmpf2);\n\tif (fd2 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp1 = fdopen(fd1, \"r+\");\n\tif (!fp1) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp2 = fdopen(fd2, \"r+\");\n\tif (!fp2) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\t/* Test if it correctly detects - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (fprintf(fp1, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp1);\n\tfp1 = NULL;\n\n\t/* Test if it correctly fails to detect when no - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (strcmp(mountinfo[i], \"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\") == 0)\n\t\t\tcontinue;\n\t\tif (fprintf(fp2, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp2);\n\tfp2 = NULL;\n\n\tif (mount(tmpf1, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(detect_ramfs_rootfs());\n\n\tif (mount(tmpf2, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(!detect_ramfs_rootfs());\n\tfret = EXIT_SUCCESS;\n\nnon_test_error:\n\tif (fp1)\n\t\tfclose(fp1);\n\telse if (fd1 > 0)\n\t\tclose(fd1);\n\tif (fp2)\n\t\tfclose(fp2);\n\telse if (fd2 > 0)\n\t\tclose(fd2);\n\n\tif (init_ns > 0) {\n\t\tif (setns(init_ns, 0) < 0) {\n\t\t\tlxc_error(\"Failed to switch back to initial mount namespace: %s.\\n\", strerror(errno));\n\t\t\tfret = EXIT_FAILURE;\n\t\t}\n\t\tclose(init_ns);\n\t}\n\tif (fret == EXIT_SUCCESS)\n\t\treturn;\n\texit(fret);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define __MNTNS_LEN (5 + (LXC_NUMSTRLEN64) + 7 + 1)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "fret"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "init_ns"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_abstract_unix_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/af_unix.c",
          "lines": "84-96",
          "snippet": "int lxc_abstract_unix_close(int fd)\n{\n\tstruct sockaddr_un addr;\n\tsocklen_t addrlen = sizeof(addr);\n\n\tif (!getsockname(fd, (struct sockaddr *)&addr, &addrlen) &&\n\t\t\taddr.sun_path[0])\n\t\tunlink(addr.sun_path);\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stddef.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <string.h>\n#include <stddef.h>\n#include \"config.h\"\n\nint lxc_abstract_unix_close(int fd)\n{\n\tstruct sockaddr_un addr;\n\tsocklen_t addrlen = sizeof(addr);\n\n\tif (!getsockname(fd, (struct sockaddr *)&addr, &addrlen) &&\n\t\t\taddr.sun_path[0])\n\t\tunlink(addr.sun_path);\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_error",
          "args": [
            "\"Failed to switch back to initial mount namespace: %s.\\n\"",
            "strerror(errno)"
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_error_set_and_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/error.c",
          "lines": "42-58",
          "snippet": "extern int  lxc_error_set_and_log(int pid, int status)\n{\n\tint ret = 0;\n\n\tif (WIFEXITED(status)) {\n\t\tret = WEXITSTATUS(status);\n\t\tif (ret)\n\t\t\tINFO(\"Child <%d> ended on error (%d).\", pid, ret);\n\t}\n\n\tif (WIFSIGNALED(status)) {\n\t\tint signal = WTERMSIG(status);\n\t\tINFO(\"Child <%d> ended on signal (%d).\", pid, signal);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"error.h\"\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nextern int  lxc_error_set_and_log(int pid, int status)\n{\n\tint ret = 0;\n\n\tif (WIFEXITED(status)) {\n\t\tret = WEXITSTATUS(status);\n\t\tif (ret)\n\t\t\tINFO(\"Child <%d> ended on error (%d).\", pid, ret);\n\t}\n\n\tif (WIFSIGNALED(status)) {\n\t\tint signal = WTERMSIG(status);\n\t\tINFO(\"Child <%d> ended on signal (%d).\", pid, signal);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setns",
          "args": [
            "init_ns",
            "0"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "setns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.h",
          "lines": "58-68",
          "snippet": "static inline int setns(int fd, int nstype)\n{\n#ifdef __NR_setns\n\treturn syscall(__NR_setns, fd, nstype);\n#elif defined(__NR_set_ns)\n\treturn syscall(__NR_set_ns, fd, nstype);\n#else\n\terrno = ENOSYS;\n\treturn -1;\n#endif\n}",
          "includes": [
            "#include <stdint.h>",
            "#  include <sys/signalfd.h>",
            "#include <../include/getline.h>",
            "#include \"initutils.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#  include <sys/signalfd.h>\n#include <../include/getline.h>\n#include \"initutils.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <errno.h>\n#include \"config.h\"\n\nstatic inline int setns(int fd, int nstype)\n{\n#ifdef __NR_setns\n\treturn syscall(__NR_setns, fd, nstype);\n#elif defined(__NR_set_ns)\n\treturn syscall(__NR_set_ns, fd, nstype);\n#else\n\terrno = ENOSYS;\n\treturn -1;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp2"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp1"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "!detect_ramfs_rootfs()"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "detect_ramfs_rootfs",
          "args": [],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "test_detect_ramfs_rootfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
          "lines": "75-227",
          "snippet": "void test_detect_ramfs_rootfs(void)\n{\n\tsize_t i;\n\tint ret;\n\tint fret = EXIT_FAILURE;\n\tchar path[__MNTNS_LEN];\n\tint init_ns = -1;\n\tchar tmpf1[] = \"lxc-test-utils-XXXXXX\";\n\tchar tmpf2[] = \"lxc-test-utils-XXXXXX\";\n\tint fd1 = -1, fd2 = -1;\n\tFILE *fp1 = NULL, *fp2 = NULL;\n\tchar *mountinfo[] = {\n\t\t\"18 24 0:17 / /sys rw,nosuid,nodev,noexec,relatime shared:7 - sysfs sysfs rw\",\n\t\t\"19 24 0:4 / /proc rw,nosuid,nodev,noexec,relatime shared:13 - proc proc rw\",\n\t\t\"20 24 0:6 / /dev rw,nosuid,relatime shared:2 - devtmpfs udev rw,size=4019884k,nr_inodes=1004971,mode=755\",\n\t\t\"21 20 0:14 / /dev/pts rw,nosuid,noexec,relatime shared:3 - devpts devpts rw,gid=5,mode=620,ptmxmode=000\",\n\t\t\"22 24 0:18 / /run rw,nosuid,noexec,relatime shared:5 - tmpfs tmpfs rw,size=807912k,mode=755\",\n\n\t\t/* This is what we care about. */\n\t\t\"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\",\n\n\t\t\"25 18 0:12 / /sys/kernel/security rw,nosuid,nodev,noexec,relatime shared:8 - securityfs securityfs rw\",\n\t\t\"26 20 0:20 / /dev/shm rw,nosuid,nodev shared:4 - tmpfs tmpfs rw\",\n\t\t\"27 22 0:21 / /run/lock rw,nosuid,nodev,noexec,relatime shared:6 - tmpfs tmpfs rw,size=5120k\",\n\t\t\"28 18 0:22 / /sys/fs/cgroup ro,nosuid,nodev,noexec shared:9 - tmpfs tmpfs ro,mode=755\",\n\t\t\"29 28 0:23 / /sys/fs/cgroup/systemd rw,nosuid,nodev,noexec,relatime shared:10 - cgroup cgroup rw,xattr,release_agent=/lib/systemd/systemd-cgroups-agent,name=systemd\",\n\t\t\"30 18 0:24 / /sys/fs/pstore rw,nosuid,nodev,noexec,relatime shared:11 - pstore pstore rw\",\n\t\t\"31 18 0:25 / /sys/firmware/efi/efivars rw,nosuid,nodev,noexec,relatime shared:12 - efivarfs efivarfs rw\",\n\t\t\"32 28 0:26 / /sys/fs/cgroup/cpu,cpuacct rw,nosuid,nodev,noexec,relatime shared:14 - cgroup cgroup rw,cpu,cpuacct\",\n\t\t\"33 28 0:27 / /sys/fs/cgroup/net_cls,net_prio rw,nosuid,nodev,noexec,relatime shared:15 - cgroup cgroup rw,net_cls,net_prio\",\n\t\t\"34 28 0:28 / /sys/fs/cgroup/blkio rw,nosuid,nodev,noexec,relatime shared:16 - cgroup cgroup rw,blkio\",\n\t\t\"35 28 0:29 / /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime shared:17 - cgroup cgroup rw,freezer\",\n\t\t\"36 28 0:30 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime shared:18 - cgroup cgroup rw,memory\",\n\t\t\"37 28 0:31 / /sys/fs/cgroup/hugetlb rw,nosuid,nodev,noexec,relatime shared:19 - cgroup cgroup rw,hugetlb\",\n\t\t\"38 28 0:32 / /sys/fs/cgroup/cpuset rw,nosuid,nodev,noexec,relatime shared:20 - cgroup cgroup rw,cpuset\",\n\t\t\"39 28 0:33 / /sys/fs/cgroup/devices rw,nosuid,nodev,noexec,relatime shared:21 - cgroup cgroup rw,devices\",\n\t\t\"40 28 0:34 / /sys/fs/cgroup/pids rw,nosuid,nodev,noexec,relatime shared:22 - cgroup cgroup rw,pids\",\n\t\t\"41 28 0:35 / /sys/fs/cgroup/perf_event rw,nosuid,nodev,noexec,relatime shared:23 - cgroup cgroup rw,perf_event\",\n\t\t\"42 19 0:36 / /proc/sys/fs/binfmt_misc rw,relatime shared:24 - autofs systemd-1 rw,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct\",\n\t\t\"43 18 0:7 / /sys/kernel/debug rw,relatime shared:25 - debugfs debugfs rw\",\n\t\t\"44 20 0:37 / /dev/hugepages rw,relatime shared:26 - hugetlbfs hugetlbfs rw\",\n\t\t\"45 20 0:16 / /dev/mqueue rw,relatime shared:27 - mqueue mqueue rw\",\n\t\t\"46 43 0:9 / /sys/kernel/debug/tracing rw,relatime shared:28 - tracefs tracefs rw\",\n\t\t\"76 18 0:38 / /sys/fs/fuse/connections rw,relatime shared:29 - fusectl fusectl rw\",\n\t\t\"78 24 8:1 / /boot/efi rw,relatime shared:30 - vfat /dev/sda1 rw,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro\",\n\t};\n\n\tret = snprintf(path, __MNTNS_LEN, \"/proc/self/ns/mnt\");\n\tif (ret < 0 || (size_t)ret >= __MNTNS_LEN) {\n\t\tlxc_error(\"%s\\n\", \"Failed to create path with snprintf().\");\n\t\tgoto non_test_error;\n\t}\n\n\tinit_ns = open(path, O_RDONLY | O_CLOEXEC);\n\tif (init_ns < 0) {\n\t\tlxc_error(\"%s\\n\", \"Failed to open initial mount namespace.\");\n\t\tgoto non_test_error;\n\t}\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not unshare mount namespace.\");\n\t\tclose(init_ns);\n\t\tinit_ns = -1;\n\t\tgoto non_test_error;\n\t}\n\n\tif (mount(NULL, \"/\", NULL, MS_REC | MS_PRIVATE, 0) < 0) {\n\t\tlxc_error(\"Failed to remount / private: %s.\\n\", strerror(errno));\n\t\tgoto non_test_error;\n\t}\n\n\tfd1 = mkstemp(tmpf1);\n\tif (fd1 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfd2 = mkstemp(tmpf2);\n\tif (fd2 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp1 = fdopen(fd1, \"r+\");\n\tif (!fp1) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp2 = fdopen(fd2, \"r+\");\n\tif (!fp2) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\t/* Test if it correctly detects - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (fprintf(fp1, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp1);\n\tfp1 = NULL;\n\n\t/* Test if it correctly fails to detect when no - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (strcmp(mountinfo[i], \"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\") == 0)\n\t\t\tcontinue;\n\t\tif (fprintf(fp2, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp2);\n\tfp2 = NULL;\n\n\tif (mount(tmpf1, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(detect_ramfs_rootfs());\n\n\tif (mount(tmpf2, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(!detect_ramfs_rootfs());\n\tfret = EXIT_SUCCESS;\n\nnon_test_error:\n\tif (fp1)\n\t\tfclose(fp1);\n\telse if (fd1 > 0)\n\t\tclose(fd1);\n\tif (fp2)\n\t\tfclose(fp2);\n\telse if (fd2 > 0)\n\t\tclose(fd2);\n\n\tif (init_ns > 0) {\n\t\tif (setns(init_ns, 0) < 0) {\n\t\t\tlxc_error(\"Failed to switch back to initial mount namespace: %s.\\n\", strerror(errno));\n\t\t\tfret = EXIT_FAILURE;\n\t\t}\n\t\tclose(init_ns);\n\t}\n\tif (fret == EXIT_SUCCESS)\n\t\treturn;\n\texit(fret);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "tmpf2",
            "\"/proc/self/mountinfo\"",
            "NULL",
            "MS_BIND",
            "0"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "mount_entry_on_generic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/conf.c",
          "lines": "1838-1869",
          "snippet": "static inline int mount_entry_on_generic(struct mntent *mntent,\n                 const char* path, const struct lxc_rootfs *rootfs,\n\t\t const char *lxc_name, const char *lxc_path)\n{\n\tunsigned long mntflags;\n\tchar *mntdata;\n\tint ret;\n\tbool optional = hasmntopt(mntent, \"optional\") != NULL;\n\tbool dev = hasmntopt(mntent, \"dev\") != NULL;\n\n\tchar *rootfs_path = NULL;\n\tif (rootfs && rootfs->path)\n\t\trootfs_path = rootfs->mount;\n\n\tret = mount_entry_create_dir_file(mntent, path, rootfs, lxc_name, lxc_path);\n\n\tif (ret < 0)\n\t\treturn optional ? 0 : -1;\n\n\tcull_mntent_opt(mntent);\n\n\tif (parse_mntopts(mntent->mnt_opts, &mntflags, &mntdata) < 0) {\n\t\tfree(mntdata);\n\t\treturn -1;\n\t}\n\n\tret = mount_entry(mntent->mnt_fsname, path, mntent->mnt_type, mntflags,\n\t\t\t  mntdata, optional, dev, rootfs_path);\n\n\tfree(mntdata);\n\treturn ret;\n}",
          "includes": [
            "#include <mntent.h>",
            "#include <../include/lxcmntent.h>",
            "#include <sys/personality.h>",
            "#include <sys/capability.h>",
            "#include \"lsm/lsm.h\"",
            "#include \"utils.h\"",
            "#include \"parse.h\"",
            "#include \"network.h\"",
            "#include \"namespace.h\"",
            "#include \"lxcseccomp.h\"",
            "#include \"lxcoverlay.h\"",
            "#include \"lxclock.h\"",
            "#include \"lxcaufs.h\"",
            "#include \"log.h\"",
            "#include \"error.h\"",
            "#include \"conf.h\"",
            "#include \"cgroup.h\"",
            "#include \"caps.h\"       /* for lxc_caps_last_cap() */",
            "#include \"bdev.h\"",
            "#include \"af_unix.h\"",
            "#include <linux/memfd.h>",
            "#include <../include/openpty.h>",
            "#include <pty.h>",
            "#include <sys/statvfs.h>",
            "#    include <sys/sysmacros.h>",
            "#    include <sys/mkdev.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <sys/socket.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <netinet/in.h>",
            "#include <net/if.h>",
            "#include <linux/loop.h>",
            "#include <arpa/inet.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <pwd.h>",
            "#include <libgen.h>",
            "#include <inttypes.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <mntent.h>\n#include <../include/lxcmntent.h>\n#include <sys/personality.h>\n#include <sys/capability.h>\n#include \"lsm/lsm.h\"\n#include \"utils.h\"\n#include \"parse.h\"\n#include \"network.h\"\n#include \"namespace.h\"\n#include \"lxcseccomp.h\"\n#include \"lxcoverlay.h\"\n#include \"lxclock.h\"\n#include \"lxcaufs.h\"\n#include \"log.h\"\n#include \"error.h\"\n#include \"conf.h\"\n#include \"cgroup.h\"\n#include \"caps.h\"       /* for lxc_caps_last_cap() */\n#include \"bdev.h\"\n#include \"af_unix.h\"\n#include <linux/memfd.h>\n#include <../include/openpty.h>\n#include <pty.h>\n#include <sys/statvfs.h>\n#    include <sys/sysmacros.h>\n#    include <sys/mkdev.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <sys/socket.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <netinet/in.h>\n#include <net/if.h>\n#include <linux/loop.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <pwd.h>\n#include <libgen.h>\n#include <inttypes.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nstatic inline int mount_entry_on_generic(struct mntent *mntent,\n                 const char* path, const struct lxc_rootfs *rootfs,\n\t\t const char *lxc_name, const char *lxc_path)\n{\n\tunsigned long mntflags;\n\tchar *mntdata;\n\tint ret;\n\tbool optional = hasmntopt(mntent, \"optional\") != NULL;\n\tbool dev = hasmntopt(mntent, \"dev\") != NULL;\n\n\tchar *rootfs_path = NULL;\n\tif (rootfs && rootfs->path)\n\t\trootfs_path = rootfs->mount;\n\n\tret = mount_entry_create_dir_file(mntent, path, rootfs, lxc_name, lxc_path);\n\n\tif (ret < 0)\n\t\treturn optional ? 0 : -1;\n\n\tcull_mntent_opt(mntent);\n\n\tif (parse_mntopts(mntent->mnt_opts, &mntflags, &mntdata) < 0) {\n\t\tfree(mntdata);\n\t\treturn -1;\n\t}\n\n\tret = mount_entry(mntent->mnt_fsname, path, mntent->mnt_type, mntflags,\n\t\t\t  mntdata, optional, dev, rootfs_path);\n\n\tfree(mntdata);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "detect_ramfs_rootfs()"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp2"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp2",
            "\"%s\\n\"",
            "mountinfo[i]"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "mountinfo[i]",
            "\"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\""
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp1"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp1",
            "\"%s\\n\"",
            "mountinfo[i]"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fdopen",
          "args": [
            "fd2",
            "\"r+\""
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fdopen",
          "args": [
            "fd1",
            "\"r+\""
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mkstemp",
          "args": [
            "tmpf2"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mkstemp",
          "args": [
            "tmpf1"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unshare",
          "args": [
            "CLONE_NEWNS"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "unshare",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.h",
          "lines": "73-81",
          "snippet": "static inline int unshare(int flags)\n{\n#ifdef __NR_unshare\n\treturn syscall(__NR_unshare, flags);\n#else\n\terrno = ENOSYS;\n\treturn -1;\n#endif\n}",
          "includes": [
            "#include <stdint.h>",
            "#  include <sys/signalfd.h>",
            "#include <../include/getline.h>",
            "#include \"initutils.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/syscall.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#  include <sys/signalfd.h>\n#include <../include/getline.h>\n#include \"initutils.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/syscall.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <errno.h>\n#include \"config.h\"\n\nstatic inline int unshare(int flags)\n{\n#ifdef __NR_unshare\n\treturn syscall(__NR_unshare, flags);\n#else\n\terrno = ENOSYS;\n\treturn -1;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "path",
            "O_RDONLY | O_CLOEXEC"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "do_test_file_open",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/aa.c",
          "lines": "63-102",
          "snippet": "static int do_test_file_open(struct lxc_container *c, char *fnam)\n{\n\tint fret = -1;\n\tint ret;\n\tpid_t pid;\n\tint pipefd[2];\n\tchar result[1024];\n\tlxc_attach_options_t attach_options = LXC_ATTACH_OPTIONS_DEFAULT;\n\n\tret = pipe(pipefd);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"pipe failed %d\\n\", ret);\n\t\treturn fret;\n\t}\n\tattach_options.stdout_fd = pipefd[1];\n\tattach_options.attach_flags &= ~(LXC_ATTACH_LSM_EXEC|LXC_ATTACH_DROP_CAPABILITIES);\n\tattach_options.attach_flags |= LXC_ATTACH_LSM_NOW;\n\tret = c->attach(c, test_attach_write_file, fnam, &attach_options, &pid);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"attach failed\\n\");\n\t\tgoto err1;\n\t}\n\n\tret = read(pipefd[0], result, sizeof(result)-1);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"read failed %d\\n\", ret);\n\t\tgoto err2;\n\t}\n\n\tfret = 1;\n\tif (strncmp(result, \"no\", 2) == 0)\n\t\tfret = 0;\n\nerr2:\n\twait_for_pid(pid);\nerr1:\n\tclose(pipefd[0]);\n\tclose(pipefd[1]);\n\treturn fret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"lxc/utils.h\"",
            "#include <lxc/lxccontainer.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"lxc/utils.h\"\n#include <lxc/lxccontainer.h>\n\nstatic int do_test_file_open(struct lxc_container *c, char *fnam)\n{\n\tint fret = -1;\n\tint ret;\n\tpid_t pid;\n\tint pipefd[2];\n\tchar result[1024];\n\tlxc_attach_options_t attach_options = LXC_ATTACH_OPTIONS_DEFAULT;\n\n\tret = pipe(pipefd);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"pipe failed %d\\n\", ret);\n\t\treturn fret;\n\t}\n\tattach_options.stdout_fd = pipefd[1];\n\tattach_options.attach_flags &= ~(LXC_ATTACH_LSM_EXEC|LXC_ATTACH_DROP_CAPABILITIES);\n\tattach_options.attach_flags |= LXC_ATTACH_LSM_NOW;\n\tret = c->attach(c, test_attach_write_file, fnam, &attach_options, &pid);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"attach failed\\n\");\n\t\tgoto err1;\n\t}\n\n\tret = read(pipefd[0], result, sizeof(result)-1);\n\tif (ret < 0) {\n\t\tfprintf(stderr, \"read failed %d\\n\", ret);\n\t\tgoto err2;\n\t}\n\n\tfret = 1;\n\tif (strncmp(result, \"no\", 2) == 0)\n\t\tfret = 0;\n\nerr2:\n\twait_for_pid(pid);\nerr1:\n\tclose(pipefd[0]);\n\tclose(pipefd[1]);\n\treturn fret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "path",
            "__MNTNS_LEN",
            "\"/proc/self/ns/mnt\""
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define __MNTNS_LEN (5 + (LXC_NUMSTRLEN64) + 7 + 1)\n\nvoid test_detect_ramfs_rootfs(void)\n{\n\tsize_t i;\n\tint ret;\n\tint fret = EXIT_FAILURE;\n\tchar path[__MNTNS_LEN];\n\tint init_ns = -1;\n\tchar tmpf1[] = \"lxc-test-utils-XXXXXX\";\n\tchar tmpf2[] = \"lxc-test-utils-XXXXXX\";\n\tint fd1 = -1, fd2 = -1;\n\tFILE *fp1 = NULL, *fp2 = NULL;\n\tchar *mountinfo[] = {\n\t\t\"18 24 0:17 / /sys rw,nosuid,nodev,noexec,relatime shared:7 - sysfs sysfs rw\",\n\t\t\"19 24 0:4 / /proc rw,nosuid,nodev,noexec,relatime shared:13 - proc proc rw\",\n\t\t\"20 24 0:6 / /dev rw,nosuid,relatime shared:2 - devtmpfs udev rw,size=4019884k,nr_inodes=1004971,mode=755\",\n\t\t\"21 20 0:14 / /dev/pts rw,nosuid,noexec,relatime shared:3 - devpts devpts rw,gid=5,mode=620,ptmxmode=000\",\n\t\t\"22 24 0:18 / /run rw,nosuid,noexec,relatime shared:5 - tmpfs tmpfs rw,size=807912k,mode=755\",\n\n\t\t/* This is what we care about. */\n\t\t\"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\",\n\n\t\t\"25 18 0:12 / /sys/kernel/security rw,nosuid,nodev,noexec,relatime shared:8 - securityfs securityfs rw\",\n\t\t\"26 20 0:20 / /dev/shm rw,nosuid,nodev shared:4 - tmpfs tmpfs rw\",\n\t\t\"27 22 0:21 / /run/lock rw,nosuid,nodev,noexec,relatime shared:6 - tmpfs tmpfs rw,size=5120k\",\n\t\t\"28 18 0:22 / /sys/fs/cgroup ro,nosuid,nodev,noexec shared:9 - tmpfs tmpfs ro,mode=755\",\n\t\t\"29 28 0:23 / /sys/fs/cgroup/systemd rw,nosuid,nodev,noexec,relatime shared:10 - cgroup cgroup rw,xattr,release_agent=/lib/systemd/systemd-cgroups-agent,name=systemd\",\n\t\t\"30 18 0:24 / /sys/fs/pstore rw,nosuid,nodev,noexec,relatime shared:11 - pstore pstore rw\",\n\t\t\"31 18 0:25 / /sys/firmware/efi/efivars rw,nosuid,nodev,noexec,relatime shared:12 - efivarfs efivarfs rw\",\n\t\t\"32 28 0:26 / /sys/fs/cgroup/cpu,cpuacct rw,nosuid,nodev,noexec,relatime shared:14 - cgroup cgroup rw,cpu,cpuacct\",\n\t\t\"33 28 0:27 / /sys/fs/cgroup/net_cls,net_prio rw,nosuid,nodev,noexec,relatime shared:15 - cgroup cgroup rw,net_cls,net_prio\",\n\t\t\"34 28 0:28 / /sys/fs/cgroup/blkio rw,nosuid,nodev,noexec,relatime shared:16 - cgroup cgroup rw,blkio\",\n\t\t\"35 28 0:29 / /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime shared:17 - cgroup cgroup rw,freezer\",\n\t\t\"36 28 0:30 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime shared:18 - cgroup cgroup rw,memory\",\n\t\t\"37 28 0:31 / /sys/fs/cgroup/hugetlb rw,nosuid,nodev,noexec,relatime shared:19 - cgroup cgroup rw,hugetlb\",\n\t\t\"38 28 0:32 / /sys/fs/cgroup/cpuset rw,nosuid,nodev,noexec,relatime shared:20 - cgroup cgroup rw,cpuset\",\n\t\t\"39 28 0:33 / /sys/fs/cgroup/devices rw,nosuid,nodev,noexec,relatime shared:21 - cgroup cgroup rw,devices\",\n\t\t\"40 28 0:34 / /sys/fs/cgroup/pids rw,nosuid,nodev,noexec,relatime shared:22 - cgroup cgroup rw,pids\",\n\t\t\"41 28 0:35 / /sys/fs/cgroup/perf_event rw,nosuid,nodev,noexec,relatime shared:23 - cgroup cgroup rw,perf_event\",\n\t\t\"42 19 0:36 / /proc/sys/fs/binfmt_misc rw,relatime shared:24 - autofs systemd-1 rw,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct\",\n\t\t\"43 18 0:7 / /sys/kernel/debug rw,relatime shared:25 - debugfs debugfs rw\",\n\t\t\"44 20 0:37 / /dev/hugepages rw,relatime shared:26 - hugetlbfs hugetlbfs rw\",\n\t\t\"45 20 0:16 / /dev/mqueue rw,relatime shared:27 - mqueue mqueue rw\",\n\t\t\"46 43 0:9 / /sys/kernel/debug/tracing rw,relatime shared:28 - tracefs tracefs rw\",\n\t\t\"76 18 0:38 / /sys/fs/fuse/connections rw,relatime shared:29 - fusectl fusectl rw\",\n\t\t\"78 24 8:1 / /boot/efi rw,relatime shared:30 - vfat /dev/sda1 rw,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro\",\n\t};\n\n\tret = snprintf(path, __MNTNS_LEN, \"/proc/self/ns/mnt\");\n\tif (ret < 0 || (size_t)ret >= __MNTNS_LEN) {\n\t\tlxc_error(\"%s\\n\", \"Failed to create path with snprintf().\");\n\t\tgoto non_test_error;\n\t}\n\n\tinit_ns = open(path, O_RDONLY | O_CLOEXEC);\n\tif (init_ns < 0) {\n\t\tlxc_error(\"%s\\n\", \"Failed to open initial mount namespace.\");\n\t\tgoto non_test_error;\n\t}\n\n\tif (unshare(CLONE_NEWNS) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not unshare mount namespace.\");\n\t\tclose(init_ns);\n\t\tinit_ns = -1;\n\t\tgoto non_test_error;\n\t}\n\n\tif (mount(NULL, \"/\", NULL, MS_REC | MS_PRIVATE, 0) < 0) {\n\t\tlxc_error(\"Failed to remount / private: %s.\\n\", strerror(errno));\n\t\tgoto non_test_error;\n\t}\n\n\tfd1 = mkstemp(tmpf1);\n\tif (fd1 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfd2 = mkstemp(tmpf2);\n\tif (fd2 < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not create temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp1 = fdopen(fd1, \"r+\");\n\tif (!fp1) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\tfp2 = fdopen(fd2, \"r+\");\n\tif (!fp2) {\n\t\tlxc_error(\"%s\\n\", \"Could not fdopen() temporary file.\");\n\t\tgoto non_test_error;\n\t}\n\n\t/* Test if it correctly detects - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (fprintf(fp1, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp1);\n\tfp1 = NULL;\n\n\t/* Test if it correctly fails to detect when no - rootfs rootfs */\n\tfor (i = 0; i < sizeof(mountinfo) / sizeof(mountinfo[0]); i++) {\n\t\tif (strcmp(mountinfo[i], \"24 0 8:2 / / rw - rootfs rootfs rw,size=1004396k,nr_inodes=251099\") == 0)\n\t\t\tcontinue;\n\t\tif (fprintf(fp2, \"%s\\n\", mountinfo[i]) < 0) {\n\t\t\tlxc_error(\"Could not write \\\"%s\\\" to temporary file.\", mountinfo[i]);\n\t\t\tgoto non_test_error;\n\t\t}\n\t}\n\tfclose(fp2);\n\tfp2 = NULL;\n\n\tif (mount(tmpf1, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(detect_ramfs_rootfs());\n\n\tif (mount(tmpf2, \"/proc/self/mountinfo\", NULL, MS_BIND, 0) < 0) {\n\t\tlxc_error(\"%s\\n\", \"Could not overmount \\\"/proc/self/mountinfo\\\".\");\n\t\tgoto non_test_error;\n\t}\n\n\tlxc_test_assert_abort(!detect_ramfs_rootfs());\n\tfret = EXIT_SUCCESS;\n\nnon_test_error:\n\tif (fp1)\n\t\tfclose(fp1);\n\telse if (fd1 > 0)\n\t\tclose(fd1);\n\tif (fp2)\n\t\tfclose(fp2);\n\telse if (fd2 > 0)\n\t\tclose(fd2);\n\n\tif (init_ns > 0) {\n\t\tif (setns(init_ns, 0) < 0) {\n\t\t\tlxc_error(\"Failed to switch back to initial mount namespace: %s.\\n\", strerror(errno));\n\t\t\tfret = EXIT_FAILURE;\n\t\t}\n\t\tclose(init_ns);\n\t}\n\tif (fret == EXIT_SUCCESS)\n\t\treturn;\n\texit(fret);\n}"
  },
  {
    "function_name": "test_lxc_deslashify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/tests/lxc-test-utils.c",
    "lines": "42-71",
    "snippet": "void test_lxc_deslashify(void)\n{\n\tchar *s = strdup(\"/A///B//C/D/E/\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A/B/C/D/E\") == 0);\n\tfree(s);\n\n\ts = strdup(\"/A\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A\") == 0);\n\tfree(s);\n\n\ts = strdup(\"\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"\") == 0);\n\tfree(s);\n\n\ts = strdup(\"//\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/\") == 0);\n\tfree(s);\n}",
    "includes": [
      "#include \"utils.h\"",
      "#include \"lxctest.h\"",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <sched.h>",
      "#include <limits.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "s"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "freeifaddrs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/include/ifaddrs.c",
          "lines": "590-599",
          "snippet": "void freeifaddrs(struct ifaddrs *ifa)\n{\n    struct ifaddrs *l_cur;\n    while(ifa)\n    {\n        l_cur = ifa;\n        ifa = ifa->ifa_next;\n        free(l_cur);\n    }\n}",
          "includes": [
            "#include <linux/rtnetlink.h>",
            "#include <linux/netlink.h>",
            "#include <netinet/in.h>",
            "#include <net/if_arp.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include \"ifaddrs.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <netinet/in.h>\n#include <net/if_arp.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <string.h>\n#include \"ifaddrs.h\"\n\nvoid freeifaddrs(struct ifaddrs *ifa)\n{\n    struct ifaddrs *l_cur;\n    while(ifa)\n    {\n        l_cur = ifa;\n        ifa = ifa->ifa_next;\n        free(l_cur);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"/\") == 0"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"/\""
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_deslashify(&s)"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_deslashify",
          "args": [
            "&s"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_deslashify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "725-766",
          "snippet": "bool lxc_deslashify(char **path)\n{\n\tbool ret = false;\n\tchar *p;\n\tchar **parts = NULL;\n\tsize_t n, len;\n\n\tparts = lxc_normalize_path(*path);\n\tif (!parts)\n\t\treturn false;\n\n\t/* We'll end up here if path == \"///\" or path == \"\". */\n\tif (!*parts) {\n\t\tlen = strlen(*path);\n\t\tif (!len) {\n\t\t\tret = true;\n\t\t\tgoto out;\n\t\t}\n\t\tn = strcspn(*path, \"/\");\n\t\tif (n == len) {\n\t\t\tp = strdup(\"/\");\n\t\t\tif (!p)\n\t\t\t\tgoto out;\n\t\t\tfree(*path);\n\t\t\t*path = p;\n\t\t\tret = true;\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\tp = lxc_string_join(\"/\", (const char **)parts, **path == '/');\n\tif (!p)\n\t\tgoto out;\n\n\tfree(*path);\n\t*path = p;\n\tret = true;\n\nout:\n\tlxc_free_array((void **)parts, free);\n\treturn ret;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern bool btrfs_try_remove_subvol(const char *path);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nextern bool btrfs_try_remove_subvol(const char *path);\n\nbool lxc_deslashify(char **path)\n{\n\tbool ret = false;\n\tchar *p;\n\tchar **parts = NULL;\n\tsize_t n, len;\n\n\tparts = lxc_normalize_path(*path);\n\tif (!parts)\n\t\treturn false;\n\n\t/* We'll end up here if path == \"///\" or path == \"\". */\n\tif (!*parts) {\n\t\tlen = strlen(*path);\n\t\tif (!len) {\n\t\t\tret = true;\n\t\t\tgoto out;\n\t\t}\n\t\tn = strcspn(*path, \"/\");\n\t\tif (n == len) {\n\t\t\tp = strdup(\"/\");\n\t\t\tif (!p)\n\t\t\t\tgoto out;\n\t\t\tfree(*path);\n\t\t\t*path = p;\n\t\t\tret = true;\n\t\t\tgoto out;\n\t\t}\n\t}\n\n\tp = lxc_string_join(\"/\", (const char **)parts, **path == '/');\n\tif (!p)\n\t\tgoto out;\n\n\tfree(*path);\n\t*path = p;\n\tret = true;\n\nout:\n\tlxc_free_array((void **)parts, free);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"//\""
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"\") == 0"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"\""
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_deslashify(&s)"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"\""
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"/A\") == 0"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"/A\""
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_deslashify(&s)"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"/A\""
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "strcmp(s, \"/A/B/C/D/E\") == 0"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "s",
            "\"/A/B/C/D/E\""
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxc_test_assert_abort",
          "args": [
            "lxc_deslashify(&s)"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"/A///B//C/D/E/\""
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils.h\"\n#include \"lxctest.h\"\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <sched.h>\n#include <limits.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <errno.h>\n\nvoid test_lxc_deslashify(void)\n{\n\tchar *s = strdup(\"/A///B//C/D/E/\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A/B/C/D/E\") == 0);\n\tfree(s);\n\n\ts = strdup(\"/A\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/A\") == 0);\n\tfree(s);\n\n\ts = strdup(\"\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"\") == 0);\n\tfree(s);\n\n\ts = strdup(\"//\");\n\tif (!s)\n\t\texit(EXIT_FAILURE);\n\tlxc_test_assert_abort(lxc_deslashify(&s));\n\tlxc_test_assert_abort(strcmp(s, \"/\") == 0);\n\tfree(s);\n}"
  }
]