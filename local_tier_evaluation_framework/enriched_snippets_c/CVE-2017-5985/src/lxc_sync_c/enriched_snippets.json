[
  {
    "function_name": "lxc_sync_fini",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "149-153",
    "snippet": "void lxc_sync_fini(struct lxc_handler *handler)\n{\n\tlxc_sync_fini_child(handler);\n\tlxc_sync_fini_parent(handler);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lxc_sync_fini_parent",
          "args": [
            "handler"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_sync_fini_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "141-147",
          "snippet": "void lxc_sync_fini_parent(struct lxc_handler *handler)\n{\n\tif (handler->sv[1] != -1) {\n\t\tclose(handler->sv[1]);\n\t\thandler->sv[1] = -1;\n\t}\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nvoid lxc_sync_fini_parent(struct lxc_handler *handler)\n{\n\tif (handler->sv[1] != -1) {\n\t\tclose(handler->sv[1]);\n\t\thandler->sv[1] = -1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxc_sync_fini_child",
          "args": [
            "handler"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_sync_fini_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "133-139",
          "snippet": "void lxc_sync_fini_child(struct lxc_handler *handler)\n{\n\tif (handler->sv[0] != -1) {\n\t\tclose(handler->sv[0]);\n\t\thandler->sv[0] = -1;\n\t}\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nvoid lxc_sync_fini_child(struct lxc_handler *handler)\n{\n\tif (handler->sv[0] != -1) {\n\t\tclose(handler->sv[0]);\n\t\thandler->sv[0] = -1;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nvoid lxc_sync_fini(struct lxc_handler *handler)\n{\n\tlxc_sync_fini_child(handler);\n\tlxc_sync_fini_parent(handler);\n}"
  },
  {
    "function_name": "lxc_sync_fini_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "141-147",
    "snippet": "void lxc_sync_fini_parent(struct lxc_handler *handler)\n{\n\tif (handler->sv[1] != -1) {\n\t\tclose(handler->sv[1]);\n\t\thandler->sv[1] = -1;\n\t}\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "handler->sv[1]"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_abstract_unix_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/af_unix.c",
          "lines": "84-96",
          "snippet": "int lxc_abstract_unix_close(int fd)\n{\n\tstruct sockaddr_un addr;\n\tsocklen_t addrlen = sizeof(addr);\n\n\tif (!getsockname(fd, (struct sockaddr *)&addr, &addrlen) &&\n\t\t\taddr.sun_path[0])\n\t\tunlink(addr.sun_path);\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stddef.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <string.h>\n#include <stddef.h>\n#include \"config.h\"\n\nint lxc_abstract_unix_close(int fd)\n{\n\tstruct sockaddr_un addr;\n\tsocklen_t addrlen = sizeof(addr);\n\n\tif (!getsockname(fd, (struct sockaddr *)&addr, &addrlen) &&\n\t\t\taddr.sun_path[0])\n\t\tunlink(addr.sun_path);\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nvoid lxc_sync_fini_parent(struct lxc_handler *handler)\n{\n\tif (handler->sv[1] != -1) {\n\t\tclose(handler->sv[1]);\n\t\thandler->sv[1] = -1;\n\t}\n}"
  },
  {
    "function_name": "lxc_sync_fini_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "133-139",
    "snippet": "void lxc_sync_fini_child(struct lxc_handler *handler)\n{\n\tif (handler->sv[0] != -1) {\n\t\tclose(handler->sv[0]);\n\t\thandler->sv[0] = -1;\n\t}\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "handler->sv[0]"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_abstract_unix_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/af_unix.c",
          "lines": "84-96",
          "snippet": "int lxc_abstract_unix_close(int fd)\n{\n\tstruct sockaddr_un addr;\n\tsocklen_t addrlen = sizeof(addr);\n\n\tif (!getsockname(fd, (struct sockaddr *)&addr, &addrlen) &&\n\t\t\taddr.sun_path[0])\n\t\tunlink(addr.sun_path);\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"log.h\"",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stddef.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <string.h>\n#include <stddef.h>\n#include \"config.h\"\n\nint lxc_abstract_unix_close(int fd)\n{\n\tstruct sockaddr_un addr;\n\tsocklen_t addrlen = sizeof(addr);\n\n\tif (!getsockname(fd, (struct sockaddr *)&addr, &addrlen) &&\n\t\t\taddr.sun_path[0])\n\t\tunlink(addr.sun_path);\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nvoid lxc_sync_fini_child(struct lxc_handler *handler)\n{\n\tif (handler->sv[0] != -1) {\n\t\tclose(handler->sv[0]);\n\t\thandler->sv[0] = -1;\n\t}\n}"
  },
  {
    "function_name": "lxc_sync_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "117-131",
    "snippet": "int lxc_sync_init(struct lxc_handler *handler)\n{\n\tint ret;\n\n\tret = socketpair(AF_LOCAL, SOCK_STREAM, 0, handler->sv);\n\tif (ret) {\n\t\tSYSERROR(\"failed to create synchronization socketpair\");\n\t\treturn -1;\n\t}\n\n\t/* Be sure we don't inherit this after the exec */\n\tfcntl(handler->sv[0], F_SETFD, FD_CLOEXEC);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fcntl",
          "args": [
            "handler->sv[0]",
            "F_SETFD",
            "FD_CLOEXEC"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SYSERROR",
          "args": [
            "\"failed to create synchronization socketpair\""
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socketpair",
          "args": [
            "AF_LOCAL",
            "SOCK_STREAM",
            "0",
            "handler->sv"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_init(struct lxc_handler *handler)\n{\n\tint ret;\n\n\tret = socketpair(AF_LOCAL, SOCK_STREAM, 0, handler->sv);\n\tif (ret) {\n\t\tSYSERROR(\"failed to create synchronization socketpair\");\n\t\treturn -1;\n\t}\n\n\t/* Be sure we don't inherit this after the exec */\n\tfcntl(handler->sv[0], F_SETFD, FD_CLOEXEC);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "lxc_sync_wake_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "112-115",
    "snippet": "int lxc_sync_wake_child(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wake(handler->sv[1], sequence);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_wake",
          "args": [
            "handler->sv[1]",
            "sequence"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_wake",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "69-78",
          "snippet": "static int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_wake_child(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wake(handler->sv[1], sequence);\n}"
  },
  {
    "function_name": "lxc_sync_wait_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "107-110",
    "snippet": "int lxc_sync_wait_child(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wait(handler->sv[1], sequence);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_wait",
          "args": [
            "handler->sv[1]",
            "sequence"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "36-67",
          "snippet": "static int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_wait_child(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wait(handler->sv[1], sequence);\n}"
  },
  {
    "function_name": "lxc_sync_wait_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "102-105",
    "snippet": "int lxc_sync_wait_parent(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wait(handler->sv[0], sequence);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_wait",
          "args": [
            "handler->sv[0]",
            "sequence"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "36-67",
          "snippet": "static int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_wait_parent(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wait(handler->sv[0], sequence);\n}"
  },
  {
    "function_name": "lxc_sync_wake_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "97-100",
    "snippet": "int lxc_sync_wake_parent(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wake(handler->sv[0], sequence);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_wake",
          "args": [
            "handler->sv[0]",
            "sequence"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_wake",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "69-78",
          "snippet": "static int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_wake_parent(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_wake(handler->sv[0], sequence);\n}"
  },
  {
    "function_name": "lxc_sync_barrier_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "92-95",
    "snippet": "int lxc_sync_barrier_child(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_barrier(handler->sv[1], sequence);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_barrier",
          "args": [
            "handler->sv[1]",
            "sequence"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_barrier",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "80-85",
          "snippet": "static int __sync_barrier(int fd, int sequence)\n{\n\tif (__sync_wake(fd, sequence))\n\t\treturn -1;\n\treturn __sync_wait(fd, sequence+1);\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_barrier(int fd, int sequence)\n{\n\tif (__sync_wake(fd, sequence))\n\t\treturn -1;\n\treturn __sync_wait(fd, sequence+1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_barrier_child(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_barrier(handler->sv[1], sequence);\n}"
  },
  {
    "function_name": "lxc_sync_barrier_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "87-90",
    "snippet": "int lxc_sync_barrier_parent(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_barrier(handler->sv[0], sequence);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_barrier",
          "args": [
            "handler->sv[0]",
            "sequence"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_barrier",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "80-85",
          "snippet": "static int __sync_barrier(int fd, int sequence)\n{\n\tif (__sync_wake(fd, sequence))\n\t\treturn -1;\n\treturn __sync_wait(fd, sequence+1);\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_barrier(int fd, int sequence)\n{\n\tif (__sync_wake(fd, sequence))\n\t\treturn -1;\n\treturn __sync_wait(fd, sequence+1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nint lxc_sync_barrier_parent(struct lxc_handler *handler, int sequence)\n{\n\treturn __sync_barrier(handler->sv[0], sequence);\n}"
  },
  {
    "function_name": "__sync_barrier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "80-85",
    "snippet": "static int __sync_barrier(int fd, int sequence)\n{\n\tif (__sync_wake(fd, sequence))\n\t\treturn -1;\n\treturn __sync_wait(fd, sequence+1);\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_wait",
          "args": [
            "fd",
            "sequence+1"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "36-67",
          "snippet": "static int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_wake",
          "args": [
            "fd",
            "sequence"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "__sync_wake",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
          "lines": "69-78",
          "snippet": "static int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"start.h\"",
            "#include \"log.h\"",
            "#include \"sync.h\"",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_barrier(int fd, int sequence)\n{\n\tif (__sync_wake(fd, sequence))\n\t\treturn -1;\n\treturn __sync_wait(fd, sequence+1);\n}"
  },
  {
    "function_name": "__sync_wake",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "69-78",
    "snippet": "static int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"sync wake failure : %m\""
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "fd",
            "&sync",
            "sizeof(sync)"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_write_nointr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "327-335",
          "snippet": "ssize_t lxc_write_nointr(int fd, const void* buf, size_t count)\n{\n\tssize_t ret;\nagain:\n\tret = write(fd, buf, count);\n\tif (ret < 0 && errno == EINTR)\n\t\tgoto again;\n\treturn ret;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nssize_t lxc_write_nointr(int fd, const void* buf, size_t count)\n{\n\tssize_t ret;\nagain:\n\tret = write(fd, buf, count);\n\tif (ret < 0 && errno == EINTR)\n\t\tgoto again;\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wake(int fd, int sequence)\n{\n\tint sync = sequence;\n\n\tif (write(fd, &sync, sizeof(sync)) < 0) {\n\t\tERROR(\"sync wake failure : %m\");\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "__sync_wait",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/sync.c",
    "lines": "36-67",
    "snippet": "static int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"start.h\"",
      "#include \"log.h\"",
      "#include \"sync.h\"",
      "#include <fcntl.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"invalid sequence number %d. expected %d\"",
            "sync",
            "sequence"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\"",
            "sequence"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"unexpected sync size: %zu expected %zu\"",
            "(size_t)ret",
            "sizeof(sync)"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"sync wait failure : %m\""
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "&sync",
            "sizeof(sync)"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "lxc_read_from_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5985/repo/src/lxc/utils.c",
          "lines": "962-990",
          "snippet": "int lxc_read_from_file(const char *filename, void* buf, size_t count)\n{\n\tint fd = -1, saved_errno;\n\tssize_t ret;\n\n\tfd = open(filename, O_RDONLY | O_CLOEXEC);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tif (!buf || !count) {\n\t\tchar buf2[100];\n\t\tsize_t count2 = 0;\n\t\twhile ((ret = read(fd, buf2, 100)) > 0)\n\t\t\tcount2 += ret;\n\t\tif (ret >= 0)\n\t\t\tret = count2;\n\t} else {\n\t\tmemset(buf, 0, count);\n\t\tret = read(fd, buf, count);\n\t}\n\n\tif (ret < 0)\n\t\tERROR(\"read %s: %s\", filename, strerror(errno));\n\n\tsaved_errno = errno;\n\tclose(fd);\n\terrno = saved_errno;\n\treturn ret;\n}",
          "includes": [
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include \"utils.h\"",
            "#include \"namespace.h\"",
            "#include \"lxclock.h\"",
            "#include \"log.h\"",
            "#include <sys/wait.h>",
            "#include <sys/vfs.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/prctl.h>",
            "#include <sys/param.h>",
            "#include <sys/mount.h>",
            "#include <sys/mman.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <libgen.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "#include <dirent.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include \"utils.h\"\n#include \"namespace.h\"\n#include \"lxclock.h\"\n#include \"log.h\"\n#include <sys/wait.h>\n#include <sys/vfs.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/prctl.h>\n#include <sys/param.h>\n#include <sys/mount.h>\n#include <sys/mman.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <libgen.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <errno.h>\n#include <dirent.h>\n#include \"config.h\"\n\nint lxc_read_from_file(const char *filename, void* buf, size_t count)\n{\n\tint fd = -1, saved_errno;\n\tssize_t ret;\n\n\tfd = open(filename, O_RDONLY | O_CLOEXEC);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tif (!buf || !count) {\n\t\tchar buf2[100];\n\t\tsize_t count2 = 0;\n\t\twhile ((ret = read(fd, buf2, 100)) > 0)\n\t\t\tcount2 += ret;\n\t\tif (ret >= 0)\n\t\t\tret = count2;\n\t} else {\n\t\tmemset(buf, 0, count);\n\t\tret = read(fd, buf, count);\n\t}\n\n\tif (ret < 0)\n\t\tERROR(\"read %s: %s\", filename, strerror(errno));\n\n\tsaved_errno = errno;\n\tclose(fd);\n\terrno = saved_errno;\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"start.h\"\n#include \"log.h\"\n#include \"sync.h\"\n#include <fcntl.h>\n#include <errno.h>\n#include <unistd.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n\nstatic int __sync_wait(int fd, int sequence)\n{\n\tint sync = -1;\n\tssize_t ret;\n\n\tret = read(fd, &sync, sizeof(sync));\n\tif (ret < 0) {\n\t\tERROR(\"sync wait failure : %m\");\n\t\treturn -1;\n\t}\n\n\tif (!ret)\n\t\treturn 0;\n\n\tif ((size_t)ret != sizeof(sync)) {\n\t\tERROR(\"unexpected sync size: %zu expected %zu\", (size_t)ret, sizeof(sync));\n\t\treturn -1;\n\t}\n\n\tif (sync == LXC_SYNC_ERROR) {\n\t\tERROR(\"An error occurred in another process \"\n\t\t      \"(expected sequence number %d)\", sequence);\n\t\treturn -1;\n\t}\n\n\tif (sync != sequence) {\n\t\tERROR(\"invalid sequence number %d. expected %d\",\n\t\t      sync, sequence);\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
  }
]