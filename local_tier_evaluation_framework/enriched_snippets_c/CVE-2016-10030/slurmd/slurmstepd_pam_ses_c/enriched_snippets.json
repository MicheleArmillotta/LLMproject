[
  {
    "function_name": "pam_finish",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
    "lines": "173-176",
    "snippet": "void pam_finish ()\n{\n\t/* Don't have PAM support, do nothing. */\n}",
    "includes": [
      "#  include <security/pam_misc.h>",
      "#  include <security/pam_appl.h>",
      "#  include <pam/pam_misc.h>",
      "#  include <pam/pam_appl.h>",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\nvoid pam_finish ()\n{\n\t/* Don't have PAM support, do nothing. */\n}"
  },
  {
    "function_name": "pam_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
    "lines": "167-171",
    "snippet": "int pam_setup (char *user, char *host)\n{\n\t/* Don't have PAM support, do nothing. */\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#  include <security/pam_misc.h>",
      "#  include <security/pam_appl.h>",
      "#  include <pam/pam_misc.h>",
      "#  include <pam/pam_appl.h>",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\nint pam_setup (char *user, char *host)\n{\n\t/* Don't have PAM support, do nothing. */\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "pam_finish",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
    "lines": "135-163",
    "snippet": "void\npam_finish ()\n{\n        int             rc = 0;\n\n\t/* \n\t * Allow PAM to clean up its state by closing the user session and\n\t * ending the association with PAM.\n\t */\n\n\tif (!conf->use_pam)\n\t\treturn;\n\n        if (pam_h != NULL) {\n\t\t/*\n\t\t * Log any errors, but there's no need to return a SLURM error.\n\t\t */\n                if ((rc = pam_close_session (pam_h, 0)) != PAM_SUCCESS) {\n                        error(\"pam_close_session: %s\", pam_strerror(pam_h, rc));\n                }\n                if ((rc = pam_setcred (pam_h, PAM_DELETE_CRED)) != PAM_SUCCESS){\n                        error(\"pam_setcred DELETE: %s\", pam_strerror(pam_h,rc));\n                }\n                if ((rc = pam_end (pam_h, rc)) != PAM_SUCCESS) {\n                        error(\"pam_end: %s\", pam_strerror(NULL, rc));\n                }\n                pam_h = NULL;\n        }\n}",
    "includes": [
      "#  include <security/pam_misc.h>",
      "#  include <security/pam_appl.h>",
      "#  include <pam/pam_misc.h>",
      "#  include <pam/pam_appl.h>",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"pam_end: %s\"",
            "pam_strerror(NULL, rc)"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "NULL",
            "rc"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_end",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_setcred",
          "args": [
            "pam_h",
            "PAM_DELETE_CRED"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_close_session",
          "args": [
            "pam_h",
            "0"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\nvoid\npam_finish ()\n{\n        int             rc = 0;\n\n\t/* \n\t * Allow PAM to clean up its state by closing the user session and\n\t * ending the association with PAM.\n\t */\n\n\tif (!conf->use_pam)\n\t\treturn;\n\n        if (pam_h != NULL) {\n\t\t/*\n\t\t * Log any errors, but there's no need to return a SLURM error.\n\t\t */\n                if ((rc = pam_close_session (pam_h, 0)) != PAM_SUCCESS) {\n                        error(\"pam_close_session: %s\", pam_strerror(pam_h, rc));\n                }\n                if ((rc = pam_setcred (pam_h, PAM_DELETE_CRED)) != PAM_SUCCESS){\n                        error(\"pam_setcred DELETE: %s\", pam_strerror(pam_h,rc));\n                }\n                if ((rc = pam_end (pam_h, rc)) != PAM_SUCCESS) {\n                        error(\"pam_end: %s\", pam_strerror(NULL, rc));\n                }\n                pam_h = NULL;\n        }\n}"
  },
  {
    "function_name": "pam_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
    "lines": "72-132",
    "snippet": "int\npam_setup (char *user, char *host)\n{\n\t/*\n\t * Any application using PAM must provide a conversation function, which\n\t * is used for direct communication between a loaded module and the\n\t * application. In this case, SLURM does not need a communication mechanism,\n\t * so the default (or null) conversation function may be used.\n\t */\n\tstruct pam_conv conv = {misc_conv, NULL};\n        int             rc = 0;\n\n\tif (!conf->use_pam)\n\t\treturn SLURM_SUCCESS;\n\t/*\n\t * SLURM uses PAM to obtain resource limits established by the system\n\t * administrator. PAM's session management library is responsible for\n\t * handling resource limits. When a PAM session is opened on behalf of\n\t * a user, the limits imposed by the sys admin are picked up. Opening\n\t * a PAM session requires a PAM handle, which is obtained when the PAM\n\t * interface is initialized. (PAM handles are required with essentially\n\t * all PAM calls.) It's also necessary to have the user's PAM credentials\n\t * to open a user session.\n \t */\n        if ((rc = pam_start (SLURM_SERVICE_PAM, user, &conv, &pam_h))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_start: %s\", pam_strerror(NULL, rc));\n                goto fail1;\n        } else if ((rc = pam_set_item (pam_h, PAM_USER, user))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_set_item USER: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_set_item (pam_h, PAM_RUSER, user))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_set_item RUSER: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_set_item (pam_h, PAM_RHOST, host))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_set_item HOST: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_setcred (pam_h, PAM_ESTABLISH_CRED))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_setcred ESTABLISH: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_open_session (pam_h, 0)) != PAM_SUCCESS) {\n                error(\"pam_open_session: %s\", pam_strerror(pam_h, rc));\n                goto fail3;\n        }\n\n\treturn SLURM_SUCCESS;\n\nfail3:\n        pam_setcred (pam_h, PAM_DELETE_CRED);\n\nfail2:\n        pam_end (pam_h, rc);\n\nfail1:\n        pam_h = NULL;\n        return SLURM_ERROR;\n}",
    "includes": [
      "#  include <security/pam_misc.h>",
      "#  include <security/pam_appl.h>",
      "#  include <pam/pam_misc.h>",
      "#  include <pam/pam_appl.h>",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [
      "#define SLURM_SERVICE_PAM \"slurm\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_end",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_setcred",
          "args": [
            "pam_h",
            "PAM_DELETE_CRED"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"pam_open_session: %s\"",
            "pam_strerror(pam_h, rc)"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_open_session",
          "args": [
            "pam_h",
            "0"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_setcred",
          "args": [
            "pam_h",
            "PAM_ESTABLISH_CRED"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_set_item",
          "args": [
            "pam_h",
            "PAM_RHOST",
            "host"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_set_item",
          "args": [
            "pam_h",
            "PAM_RUSER",
            "user"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "pam_h",
            "rc"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_set_item",
          "args": [
            "pam_h",
            "PAM_USER",
            "user"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_strerror",
          "args": [
            "NULL",
            "rc"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_start",
          "args": [
            "SLURM_SERVICE_PAM",
            "user",
            "&conv",
            "&pam_h"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\n#define SLURM_SERVICE_PAM \"slurm\"\n\nint\npam_setup (char *user, char *host)\n{\n\t/*\n\t * Any application using PAM must provide a conversation function, which\n\t * is used for direct communication between a loaded module and the\n\t * application. In this case, SLURM does not need a communication mechanism,\n\t * so the default (or null) conversation function may be used.\n\t */\n\tstruct pam_conv conv = {misc_conv, NULL};\n        int             rc = 0;\n\n\tif (!conf->use_pam)\n\t\treturn SLURM_SUCCESS;\n\t/*\n\t * SLURM uses PAM to obtain resource limits established by the system\n\t * administrator. PAM's session management library is responsible for\n\t * handling resource limits. When a PAM session is opened on behalf of\n\t * a user, the limits imposed by the sys admin are picked up. Opening\n\t * a PAM session requires a PAM handle, which is obtained when the PAM\n\t * interface is initialized. (PAM handles are required with essentially\n\t * all PAM calls.) It's also necessary to have the user's PAM credentials\n\t * to open a user session.\n \t */\n        if ((rc = pam_start (SLURM_SERVICE_PAM, user, &conv, &pam_h))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_start: %s\", pam_strerror(NULL, rc));\n                goto fail1;\n        } else if ((rc = pam_set_item (pam_h, PAM_USER, user))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_set_item USER: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_set_item (pam_h, PAM_RUSER, user))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_set_item RUSER: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_set_item (pam_h, PAM_RHOST, host))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_set_item HOST: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_setcred (pam_h, PAM_ESTABLISH_CRED))\n\t\t\t!= PAM_SUCCESS) {\n                error (\"pam_setcred ESTABLISH: %s\", pam_strerror(pam_h, rc));\n                goto fail2;\n        } else if ((rc = pam_open_session (pam_h, 0)) != PAM_SUCCESS) {\n                error(\"pam_open_session: %s\", pam_strerror(pam_h, rc));\n                goto fail3;\n        }\n\n\treturn SLURM_SUCCESS;\n\nfail3:\n        pam_setcred (pam_h, PAM_DELETE_CRED);\n\nfail2:\n        pam_end (pam_h, rc);\n\nfail1:\n        pam_h = NULL;\n        return SLURM_ERROR;\n}"
  }
]