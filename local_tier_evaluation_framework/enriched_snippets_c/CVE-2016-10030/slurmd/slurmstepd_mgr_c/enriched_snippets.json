[
  {
    "function_name": "_run_script_as_user",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2778-2891",
    "snippet": "int\n_run_script_as_user(const char *name, const char *path, stepd_step_rec_t *job,\n\t\t    int max_wait, char **env)\n{\n\tint status, rc, opt;\n\tpid_t cpid;\n\tstruct exec_wait_info *ei;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (_access(path, 5, job->uid, job->gid) < 0) {\n\t\terror(\"Could not run %s [%s]: access denied\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((ei = _fork_child_with_wait_info(0)) == NULL) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = _exec_wait_get_pid (ei)) == 0) {\n\t\tstruct priv_state sprivs;\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif ((job->jobid != 0) &&\t/* Ignore system processes */\n\t\t    (container_g_add_pid(job->jobid, getpid(), job->uid)\n\t\t     != SLURM_SUCCESS))\n\t\t\terror(\"container_g_add_pid(%u): %m\", job->jobid);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n\t\tsprivs.gid_list = NULL;\t/* initialize to prevent xfree */\n\t\tif (_drop_privileges(job, true, &sprivs, false) < 0) {\n\t\t\terror(\"run_script_as_user _drop_privileges: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (_become_user(job, &sprivs) < 0) {\n\t\t\terror(\"run_script_as_user _become_user failed: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (chdir(job->cwd) == -1)\n\t\t\terror(\"run_script_as_user: couldn't \"\n\t\t\t      \"change working dir to %s: %m\", job->cwd);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\t/*\n\t\t *  Wait for signal from parent\n\t\t */\n\t\t_exec_wait_child_wait_for_parent (ei);\n\n\t\twhile (1) {\n\t\t\texecve(path, argv, env);\n\t\t\terror(\"execve(%s): %m\", path);\n\t\t\tif ((errno == ENFILE) || (errno == ENOMEM)) {\n\t\t\t\t/* System limit on open files or memory reached,\n\t\t\t\t * retry after short delay */\n\t\t\t\tsleep(1);\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\texit(127);\n\t}\n\n\tif (exec_wait_signal_child (ei) < 0)\n\t\terror (\"run_script_as_user: Failed to wakeup %s\", name);\n\t_exec_wait_info_destroy (ei);\n\n\tif (max_wait < 0)\n\t\topt = 0;\n\telse\n\t\topt = WNOHANG;\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, opt);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\tstatus = 0;\n\t\t\tbreak;\n\t\t} else if (rc == 0) {\n\t\t\tsleep(1);\n\t\t\tif ((--max_wait) <= 0) {\n\t\t\t\tkillpg(cpid, SIGKILL);\n\t\t\t\topt = 0;\n\t\t\t}\n\t\t} else  {\n\t\t\t/* spawned process exited */\n\t\t\tbreak;\n\t\t}\n\t}\n\t/* Insure that all child processes get killed, one last time */\n\tkillpg(cpid, SIGKILL);\n\n\treturn status;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "killpg",
          "args": [
            "cpid",
            "SIGKILL"
          ],
          "line": 2888
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "killpg",
          "args": [
            "cpid",
            "SIGKILL"
          ],
          "line": 2879
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "1"
          ],
          "line": 2877
        },
        "resolved": true,
        "details": {
          "function_name": "_random_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "664-678",
          "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"waidpid: %m\""
          ],
          "line": 2873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "cpid",
            "&status",
            "opt"
          ],
          "line": 2869
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exec_wait_info_destroy",
          "args": [
            "ei"
          ],
          "line": 2861
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_info_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1439-1455",
          "snippet": "static void _exec_wait_info_destroy (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn;\n\n\tif (e->parentfd >= 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t}\n\tif (e->childfd >= 0) {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\te->id = -1;\n\te->pid = -1;\n\txfree(e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _exec_wait_info_destroy (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn;\n\n\tif (e->parentfd >= 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t}\n\tif (e->childfd >= 0) {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\te->id = -1;\n\te->pid = -1;\n\txfree(e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"run_script_as_user: Failed to wakeup %s\"",
            "name"
          ],
          "line": 2860
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "exec_wait_signal_child",
          "args": [
            "ei"
          ],
          "line": 2859
        },
        "resolved": true,
        "details": {
          "function_name": "exec_wait_signal_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1498-1506",
          "snippet": "static int exec_wait_signal_child (struct exec_wait_info *e)\n{\n\tchar c = '\\0';\n\n\tif (write (e->parentfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"write to unblock task %d failed: %m\", e->id);\n\n\treturn (0);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int exec_wait_signal_child (struct exec_wait_info *e)\n{\n\tchar c = '\\0';\n\n\tif (write (e->parentfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"write to unblock task %d failed: %m\", e->id);\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "127"
          ],
          "line": 2856
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "execve",
          "args": [
            "path",
            "argv",
            "env"
          ],
          "line": 2846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exec_wait_child_wait_for_parent",
          "args": [
            "ei"
          ],
          "line": 2843
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_child_wait_for_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1488-1496",
          "snippet": "static int _exec_wait_child_wait_for_parent (struct exec_wait_info *e)\n{\n\tchar c;\n\n\tif (read (e->childfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"_exec_wait_child_wait_for_parent: failed: %m\");\n\n\treturn (0);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int _exec_wait_child_wait_for_parent (struct exec_wait_info *e)\n{\n\tchar c;\n\n\tif (read (e->childfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"_exec_wait_child_wait_for_parent: failed: %m\");\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "setpgrp",
          "args": [],
          "line": 2838
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgrp",
          "args": [
            "0",
            "0"
          ],
          "line": 2836
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "job->cwd"
          ],
          "line": 2832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"run_script_as_user _become_user failed: %m\""
          ],
          "line": 2827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_become_user",
          "args": [
            "job",
            "&sprivs"
          ],
          "line": 2826
        },
        "resolved": true,
        "details": {
          "function_name": "_become_user",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2610-2643",
          "snippet": "static int\n_become_user(stepd_step_rec_t *job, struct priv_state *ps)\n{\n\t/*\n\t * First reclaim the effective uid and gid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\treturn SLURM_SUCCESS;\n\n\tif (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"_become_user seteuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setegid(ps->saved_gid) < 0) {\n\t\terror(\"_become_user setegid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/*\n\t * Now drop real, effective, and saved uid/gid\n\t */\n\tif (setregid(job->gid, job->gid) < 0) {\n\t\terror(\"setregid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setreuid(job->uid, job->uid) < 0) {\n\t\terror(\"setreuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_become_user(stepd_step_rec_t *job, struct priv_state *ps)\n{\n\t/*\n\t * First reclaim the effective uid and gid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\treturn SLURM_SUCCESS;\n\n\tif (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"_become_user seteuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setegid(ps->saved_gid) < 0) {\n\t\terror(\"_become_user setegid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/*\n\t * Now drop real, effective, and saved uid/gid\n\t */\n\tif (setregid(job->gid, job->gid) < 0) {\n\t\terror(\"setregid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setreuid(job->uid, job->uid) < 0) {\n\t\terror(\"setreuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"run_script_as_user _drop_privileges: %m\""
          ],
          "line": 2821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_drop_privileges",
          "args": [
            "job",
            "true",
            "&sprivs",
            "false"
          ],
          "line": 2820
        },
        "resolved": true,
        "details": {
          "function_name": "_drop_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2422-2478",
          "snippet": "static int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "path"
          ],
          "line": 2816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_g_add_pid",
          "args": [
            "job->jobid",
            "getpid()",
            "job->uid"
          ],
          "line": 2812
        },
        "resolved": true,
        "details": {
          "function_name": "container_g_add_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/job_container_plugin.c",
          "lines": "196-209",
          "snippet": "extern int container_g_add_pid(uint32_t job_id, pid_t pid, uid_t uid)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_pid))(job_id, pid, uid);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static job_container_ops_t\t*ops = NULL;",
            "static int\t\t\tg_container_context_num = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic job_container_ops_t\t*ops = NULL;\nstatic int\t\t\tg_container_context_num = -1;\n\nextern int container_g_add_pid(uint32_t job_id, pid_t pid, uid_t uid)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_pid))(job_id, pid, uid);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 2812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exec_wait_get_pid",
          "args": [
            "ei"
          ],
          "line": 2801
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_get_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1457-1462",
          "snippet": "static pid_t _exec_wait_get_pid (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn (-1);\n\treturn (e->pid);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic pid_t _exec_wait_get_pid (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn (-1);\n\treturn (e->pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_fork_child_with_wait_info",
          "args": [
            "0"
          ],
          "line": 2797
        },
        "resolved": true,
        "details": {
          "function_name": "_fork_child_with_wait_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1464-1486",
          "snippet": "static struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Could not run %s [%s]: access denied\"",
            "name",
            "path"
          ],
          "line": 2793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_access",
          "args": [
            "path",
            "5",
            "job->uid",
            "job->gid"
          ],
          "line": 2792
        },
        "resolved": true,
        "details": {
          "function_name": "_access",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2745-2763",
          "snippet": "static int _access(const char *path, int modes, uid_t uid, gid_t gid)\n{\n\tstruct stat buf;\n\tint f_mode;\n\n\tif (stat(path, &buf) != 0)\n\t\treturn -1;\n\n\tif (buf.st_uid == uid)\n\t\tf_mode = (buf.st_mode >> 6) & 07;\n\telse if (buf.st_gid == gid)\n\t\tf_mode = (buf.st_mode >> 3) & 07;\n\telse\n\t\tf_mode = buf.st_mode & 07;\n\n\tif ((f_mode & modes) == modes)\n\t\treturn 0;\n\treturn -1;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\n\nstatic int _access(const char *path, int modes, uid_t uid, gid_t gid)\n{\n\tstruct stat buf;\n\tint f_mode;\n\n\tif (stat(path, &buf) != 0)\n\t\treturn -1;\n\n\tif (buf.st_uid == uid)\n\t\tf_mode = (buf.st_mode >> 6) & 07;\n\telse if (buf.st_gid == gid)\n\t\tf_mode = (buf.st_mode >> 3) & 07;\n\telse\n\t\tf_mode = buf.st_mode & 07;\n\n\tif ((f_mode & modes) == modes)\n\t\treturn 0;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"[job %u] attempting to run %s [%s]\"",
            "job->jobid",
            "name",
            "path"
          ],
          "line": 2790
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "env"
          ],
          "line": 2786
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nint\n_run_script_as_user(const char *name, const char *path, stepd_step_rec_t *job,\n\t\t    int max_wait, char **env)\n{\n\tint status, rc, opt;\n\tpid_t cpid;\n\tstruct exec_wait_info *ei;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (_access(path, 5, job->uid, job->gid) < 0) {\n\t\terror(\"Could not run %s [%s]: access denied\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((ei = _fork_child_with_wait_info(0)) == NULL) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = _exec_wait_get_pid (ei)) == 0) {\n\t\tstruct priv_state sprivs;\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif ((job->jobid != 0) &&\t/* Ignore system processes */\n\t\t    (container_g_add_pid(job->jobid, getpid(), job->uid)\n\t\t     != SLURM_SUCCESS))\n\t\t\terror(\"container_g_add_pid(%u): %m\", job->jobid);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n\t\tsprivs.gid_list = NULL;\t/* initialize to prevent xfree */\n\t\tif (_drop_privileges(job, true, &sprivs, false) < 0) {\n\t\t\terror(\"run_script_as_user _drop_privileges: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (_become_user(job, &sprivs) < 0) {\n\t\t\terror(\"run_script_as_user _become_user failed: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (chdir(job->cwd) == -1)\n\t\t\terror(\"run_script_as_user: couldn't \"\n\t\t\t      \"change working dir to %s: %m\", job->cwd);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\t/*\n\t\t *  Wait for signal from parent\n\t\t */\n\t\t_exec_wait_child_wait_for_parent (ei);\n\n\t\twhile (1) {\n\t\t\texecve(path, argv, env);\n\t\t\terror(\"execve(%s): %m\", path);\n\t\t\tif ((errno == ENFILE) || (errno == ENOMEM)) {\n\t\t\t\t/* System limit on open files or memory reached,\n\t\t\t\t * retry after short delay */\n\t\t\t\tsleep(1);\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\texit(127);\n\t}\n\n\tif (exec_wait_signal_child (ei) < 0)\n\t\terror (\"run_script_as_user: Failed to wakeup %s\", name);\n\t_exec_wait_info_destroy (ei);\n\n\tif (max_wait < 0)\n\t\topt = 0;\n\telse\n\t\topt = WNOHANG;\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, opt);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\tstatus = 0;\n\t\t\tbreak;\n\t\t} else if (rc == 0) {\n\t\t\tsleep(1);\n\t\t\tif ((--max_wait) <= 0) {\n\t\t\t\tkillpg(cpid, SIGKILL);\n\t\t\t\topt = 0;\n\t\t\t}\n\t\t} else  {\n\t\t\t/* spawned process exited */\n\t\t\tbreak;\n\t\t}\n\t}\n\t/* Insure that all child processes get killed, one last time */\n\tkillpg(cpid, SIGKILL);\n\n\treturn status;\n}"
  },
  {
    "function_name": "_access",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2745-2763",
    "snippet": "static int _access(const char *path, int modes, uid_t uid, gid_t gid)\n{\n\tstruct stat buf;\n\tint f_mode;\n\n\tif (stat(path, &buf) != 0)\n\t\treturn -1;\n\n\tif (buf.st_uid == uid)\n\t\tf_mode = (buf.st_mode >> 6) & 07;\n\telse if (buf.st_gid == gid)\n\t\tf_mode = (buf.st_mode >> 3) & 07;\n\telse\n\t\tf_mode = buf.st_mode & 07;\n\n\tif ((f_mode & modes) == modes)\n\t\treturn 0;\n\treturn -1;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
      "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "path",
            "&buf"
          ],
          "line": 2750
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "986-992",
          "snippet": "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _reclaim_privileges(struct priv_state *state);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\n\nstatic int _access(const char *path, int modes, uid_t uid, gid_t gid)\n{\n\tstruct stat buf;\n\tint f_mode;\n\n\tif (stat(path, &buf) != 0)\n\t\treturn -1;\n\n\tif (buf.st_uid == uid)\n\t\tf_mode = (buf.st_mode >> 6) & 07;\n\telse if (buf.st_gid == gid)\n\t\tf_mode = (buf.st_mode >> 3) & 07;\n\telse\n\t\tf_mode = buf.st_mode & 07;\n\n\tif ((f_mode & modes) == modes)\n\t\treturn 0;\n\treturn -1;\n}"
  },
  {
    "function_name": "_initgroups",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2667-2735",
    "snippet": "static int\n_initgroups(stepd_step_rec_t *job)\n{\n#ifndef HAVE_NATIVE_CRAY\n\tgid_t primary_gid = 0;\n#endif\n\tint rc;\n\n\tif (job->ngids > 0) {\n\t\txassert(job->gids);\n\t\tdebug2(\"Using gid list sent by slurmd\");\n\t\treturn setgroups(job->ngids, job->gids);\n\t}\n\n\tdebug2(\"Uncached user/gid: %s/%ld\", job->user_name, (long)job->gid);\n\tif ((rc = initgroups(job->user_name, job->gid))) {\n\t\tif ((errno == EPERM) && (getuid() != (uid_t) 0)) {\n\t\t\tdebug(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t} else {\n\t\t\terror(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t}\n\t\treturn -1;\n\t}\n\n#ifndef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getpwnam_r() call */\n\trc = _get_primary_group(job->user_name, &primary_gid);\n\tif (rc < 0) {\n\t\terror(\"%s: _get_primary_group() failed\", __func__);\n\t\treturn -1;\n\t}\n\t/* If job->gid is not the primary group for the\n\t * user job->user_name then add the primary group\n\t * in the list of user groups.\n\t */\n\tif (primary_gid != job->gid) {\n\t\tint ngroups_max = sysconf(_SC_NGROUPS_MAX);\n\t\tgid_t grps[ngroups_max];\n\t\tint size, max;\n\n\t\tmax = ngroups_max;\n\n\t\tsize = getgrouplist(job->user_name,\n\t\t\t\t    job->gid,\n\t\t\t\t    grps,\n\t\t\t\t    &ngroups_max);\n\t\tif (size < 0) {\n\t\t\terror(\"%s: getgrouplist() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t\tif (size > max - 1) {\n\t\t\terror(\"\\\n%s: too many groups %d max %d for user %s groups %d %d\\n\",\n\t\t\t      __func__, size, max, job->user_name,\n\t\t\t      primary_gid, job->gid);\n\t\t}\n\t\tgrps[size++] = primary_gid;\n\n\t\tif (setgroups(size, grps)) {\n\t\t\terror(\"%s: setgroups() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\treturn 0;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: setgroups() failed: %m\"",
            "__func__"
          ],
          "line": 2729
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "size",
            "grps"
          ],
          "line": 2728
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"\\\n%s: too many groups %d max %d for user %s groups %d %d\\n\"",
            "__func__",
            "size",
            "max",
            "job->user_name",
            "primary_gid",
            "job->gid"
          ],
          "line": 2721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgrouplist",
          "args": [
            "job->user_name",
            "job->gid",
            "grps",
            "&ngroups_max"
          ],
          "line": 2712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysconf",
          "args": [
            "_SC_NGROUPS_MAX"
          ],
          "line": 2706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_get_primary_group",
          "args": [
            "job->user_name",
            "&primary_gid"
          ],
          "line": 2696
        },
        "resolved": true,
        "details": {
          "function_name": "_get_primary_group",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2648-2664",
          "snippet": "static int\n_get_primary_group(const char *user, gid_t *gid)\n{\n\tstruct passwd pwd;\n\tstruct passwd *pwd0 = NULL;\n\tchar buf[256];\n\tint cc;\n\n\tcc = getpwnam_r(user, &pwd, buf, sizeof(buf), &pwd0);\n\tif ((cc != 0) || (pwd0 == NULL)) {\n\t\terror(\"%s: getpwnam_r() failed: %m\", __func__);\n\t\treturn -1;\n\t}\n\n\t*gid = pwd0->pw_gid;\n\treturn 0;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\n\nstatic int\n_get_primary_group(const char *user, gid_t *gid)\n{\n\tstruct passwd pwd;\n\tstruct passwd *pwd0 = NULL;\n\tchar buf[256];\n\tint cc;\n\n\tcc = getpwnam_r(user, &pwd, buf, sizeof(buf), &pwd0);\n\tif ((cc != 0) || (pwd0 == NULL)) {\n\t\terror(\"%s: getpwnam_r() failed: %m\", __func__);\n\t\treturn -1;\n\t}\n\n\t*gid = pwd0->pw_gid;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Error in initgroups(%s, %ld): %m\"",
            "job->user_name",
            "(long)job->gid"
          ],
          "line": 2687
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Error in initgroups(%s, %ld): %m\"",
            "job->user_name",
            "(long)job->gid"
          ],
          "line": 2684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 2683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "initgroups",
          "args": [
            "job->user_name",
            "job->gid"
          ],
          "line": 2682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Uncached user/gid: %s/%ld\"",
            "job->user_name",
            "(long)job->gid"
          ],
          "line": 2681
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "job->ngids",
            "job->gids"
          ],
          "line": 2678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Using gid list sent by slurmd\""
          ],
          "line": 2677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "job->gids"
          ],
          "line": 2676
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_initgroups(stepd_step_rec_t *job)\n{\n#ifndef HAVE_NATIVE_CRAY\n\tgid_t primary_gid = 0;\n#endif\n\tint rc;\n\n\tif (job->ngids > 0) {\n\t\txassert(job->gids);\n\t\tdebug2(\"Using gid list sent by slurmd\");\n\t\treturn setgroups(job->ngids, job->gids);\n\t}\n\n\tdebug2(\"Uncached user/gid: %s/%ld\", job->user_name, (long)job->gid);\n\tif ((rc = initgroups(job->user_name, job->gid))) {\n\t\tif ((errno == EPERM) && (getuid() != (uid_t) 0)) {\n\t\t\tdebug(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t} else {\n\t\t\terror(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t}\n\t\treturn -1;\n\t}\n\n#ifndef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getpwnam_r() call */\n\trc = _get_primary_group(job->user_name, &primary_gid);\n\tif (rc < 0) {\n\t\terror(\"%s: _get_primary_group() failed\", __func__);\n\t\treturn -1;\n\t}\n\t/* If job->gid is not the primary group for the\n\t * user job->user_name then add the primary group\n\t * in the list of user groups.\n\t */\n\tif (primary_gid != job->gid) {\n\t\tint ngroups_max = sysconf(_SC_NGROUPS_MAX);\n\t\tgid_t grps[ngroups_max];\n\t\tint size, max;\n\n\t\tmax = ngroups_max;\n\n\t\tsize = getgrouplist(job->user_name,\n\t\t\t\t    job->gid,\n\t\t\t\t    grps,\n\t\t\t\t    &ngroups_max);\n\t\tif (size < 0) {\n\t\t\terror(\"%s: getgrouplist() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t\tif (size > max - 1) {\n\t\t\terror(\"\\\n%s: too many groups %d max %d for user %s groups %d %d\\n\",\n\t\t\t      __func__, size, max, job->user_name,\n\t\t\t      primary_gid, job->gid);\n\t\t}\n\t\tgrps[size++] = primary_gid;\n\n\t\tif (setgroups(size, grps)) {\n\t\t\terror(\"%s: setgroups() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\treturn 0;\n}"
  },
  {
    "function_name": "_get_primary_group",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2648-2664",
    "snippet": "static int\n_get_primary_group(const char *user, gid_t *gid)\n{\n\tstruct passwd pwd;\n\tstruct passwd *pwd0 = NULL;\n\tchar buf[256];\n\tint cc;\n\n\tcc = getpwnam_r(user, &pwd, buf, sizeof(buf), &pwd0);\n\tif ((cc != 0) || (pwd0 == NULL)) {\n\t\terror(\"%s: getpwnam_r() failed: %m\", __func__);\n\t\treturn -1;\n\t}\n\n\t*gid = pwd0->pw_gid;\n\treturn 0;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: getpwnam_r() failed: %m\"",
            "__func__"
          ],
          "line": 2658
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpwnam_r",
          "args": [
            "user",
            "&pwd",
            "buf",
            "sizeof(buf)",
            "&pwd0"
          ],
          "line": 2656
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\n\nstatic int\n_get_primary_group(const char *user, gid_t *gid)\n{\n\tstruct passwd pwd;\n\tstruct passwd *pwd0 = NULL;\n\tchar buf[256];\n\tint cc;\n\n\tcc = getpwnam_r(user, &pwd, buf, sizeof(buf), &pwd0);\n\tif ((cc != 0) || (pwd0 == NULL)) {\n\t\terror(\"%s: getpwnam_r() failed: %m\", __func__);\n\t\treturn -1;\n\t}\n\n\t*gid = pwd0->pw_gid;\n\treturn 0;\n}"
  },
  {
    "function_name": "_become_user",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2610-2643",
    "snippet": "static int\n_become_user(stepd_step_rec_t *job, struct priv_state *ps)\n{\n\t/*\n\t * First reclaim the effective uid and gid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\treturn SLURM_SUCCESS;\n\n\tif (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"_become_user seteuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setegid(ps->saved_gid) < 0) {\n\t\terror(\"_become_user setegid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/*\n\t * Now drop real, effective, and saved uid/gid\n\t */\n\tif (setregid(job->gid, job->gid) < 0) {\n\t\terror(\"setregid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setreuid(job->uid, job->uid) < 0) {\n\t\terror(\"setreuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
      "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"setreuid: %m\""
          ],
          "line": 2638
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setreuid",
          "args": [
            "job->uid",
            "job->uid"
          ],
          "line": 2637
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"setregid: %m\""
          ],
          "line": 2633
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setregid",
          "args": [
            "job->gid",
            "job->gid"
          ],
          "line": 2632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_become_user setegid: %m\""
          ],
          "line": 2625
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setegid",
          "args": [
            "ps->saved_gid"
          ],
          "line": 2624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_become_user seteuid: %m\""
          ],
          "line": 2620
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "seteuid",
          "args": [
            "ps->saved_uid"
          ],
          "line": 2619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 2616
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_become_user(stepd_step_rec_t *job, struct priv_state *ps)\n{\n\t/*\n\t * First reclaim the effective uid and gid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\treturn SLURM_SUCCESS;\n\n\tif (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"_become_user seteuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setegid(ps->saved_gid) < 0) {\n\t\terror(\"_become_user setegid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/*\n\t * Now drop real, effective, and saved uid/gid\n\t */\n\tif (setregid(job->gid, job->gid) < 0) {\n\t\terror(\"setregid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setreuid(job->uid, job->uid) < 0) {\n\t\terror(\"setreuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "_set_prio_process",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2582-2608",
    "snippet": "static void _set_prio_process (stepd_step_rec_t *job)\n{\n\tchar *env_name = \"SLURM_PRIO_PROCESS\";\n\tchar *env_val;\n\tint prio_daemon, prio_process;\n\n\tif (!(env_val = getenvp( job->env, env_name ))) {\n\t\terror( \"Couldn't find %s in environment\", env_name );\n\t\tprio_process = 0;\n\t} else {\n\t\t/* Users shouldn't get this in their environment */\n\t\tunsetenvp( job->env, env_name );\n\t\tprio_process = atoi( env_val );\n\t}\n\n\tif (conf->propagate_prio == PROP_PRIO_NICER) {\n\t\tprio_daemon = getpriority( PRIO_PROCESS, 0 );\n\t\tprio_process = MAX( prio_process, (prio_daemon + 1) );\n\t}\n\n\tif (setpriority( PRIO_PROCESS, 0, prio_process ))\n\t\terror( \"setpriority(PRIO_PROCESS, %d): %m\", prio_process );\n\telse {\n\t\tdebug2( \"_set_prio_process: setpriority %d succeeded\",\n\t\t\tprio_process);\n\t}\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"_set_prio_process: setpriority %d succeeded\"",
            "prio_process"
          ],
          "line": 2605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"setpriority(PRIO_PROCESS, %d): %m\"",
            "prio_process"
          ],
          "line": 2603
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "setpriority",
          "args": [
            "PRIO_PROCESS",
            "0",
            "prio_process"
          ],
          "line": 2602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAX",
          "args": [
            "prio_process",
            "(prio_daemon + 1)"
          ],
          "line": 2599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpriority",
          "args": [
            "PRIO_PROCESS",
            "0"
          ],
          "line": 2598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "env_val"
          ],
          "line": 2594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unsetenvp",
          "args": [
            "job->env",
            "env_name"
          ],
          "line": 2593
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenvp",
          "args": [
            "job->env",
            "env_name"
          ],
          "line": 2588
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_prio_process (stepd_step_rec_t *job)\n{\n\tchar *env_name = \"SLURM_PRIO_PROCESS\";\n\tchar *env_val;\n\tint prio_daemon, prio_process;\n\n\tif (!(env_val = getenvp( job->env, env_name ))) {\n\t\terror( \"Couldn't find %s in environment\", env_name );\n\t\tprio_process = 0;\n\t} else {\n\t\t/* Users shouldn't get this in their environment */\n\t\tunsetenvp( job->env, env_name );\n\t\tprio_process = atoi( env_val );\n\t}\n\n\tif (conf->propagate_prio == PROP_PRIO_NICER) {\n\t\tprio_daemon = getpriority( PRIO_PROCESS, 0 );\n\t\tprio_process = MAX( prio_process, (prio_daemon + 1) );\n\t}\n\n\tif (setpriority( PRIO_PROCESS, 0, prio_process ))\n\t\terror( \"setpriority(PRIO_PROCESS, %d): %m\", prio_process );\n\telse {\n\t\tdebug2( \"_set_prio_process: setpriority %d succeeded\",\n\t\t\tprio_process);\n\t}\n}"
  },
  {
    "function_name": "_setargs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2563-2575",
    "snippet": "static void\n_setargs(stepd_step_rec_t *job)\n{\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsetproctitle(\"[%u]\",    job->jobid);\n\telse\n\t\tsetproctitle(\"[%u.%u]\", job->jobid, job->stepid);\n\n\treturn;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "setproctitle",
          "args": [
            "\"[%u.%u]\"",
            "job->jobid",
            "job->stepid"
          ],
          "line": 2572
        },
        "resolved": true,
        "details": {
          "function_name": "setproctitle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
          "lines": "178-242",
          "snippet": "void\nsetproctitle(const char *fmt, ...)\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tunion pstun pst;\n#endif\n#if SETPROCTITLE_STRATEGY != PS_USE_NONE\n\tssize_t used;\n\tva_list ap;\n\n\t/* no ps display if you didn't call save_ps_display_args() */\n\tif (save_argv == NULL)\n\t\treturn;\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* If ps_buffer is a pointer, it might still be null */\n\tif (ps_buffer == NULL)\n\t\treturn;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Overwrite argv[] to point at appropriate space, if needed\n\t */\n#if SETPROCTITLE_STRATEGY == PS_USE_CHANGE_ARGV\n\tsave_argv[0] = ps_buffer;\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CHANGE_ARGV */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Make fixed prefix of ps display.\n\t */\n\n\tva_start(ap, fmt);\n\tif (fmt == NULL)\n\t\tsnprintf(ps_buffer, ps_buffer_size, \"%s\", __progname);\n\telse {\n\t\tused = snprintf(ps_buffer, ps_buffer_size, \"%s: \", __progname);\n\t\tif (used == -1 || used >= ps_buffer_size)\n\t\t\tused = ps_buffer_size;\n\t\tvsnprintf(ps_buffer + used, ps_buffer_size - used, fmt, ap);\n\t}\n\tva_end(ap);\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tpst.pst_command = ps_buffer;\n\tpstat(PSTAT_SETCMD, pst, strlen(ps_buffer), 0, 0);\n#endif   /* PS_USE_PSTAT */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PS_STRINGS\n\tPS_STRINGS->ps_nargvstr = 1;\n\tPS_STRINGS->ps_argvstr = ps_buffer;\n#endif   /* PS_USE_PS_STRINGS */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* pad unused memory */\n\tused = strlen(ps_buffer);\n\tmemset(ps_buffer + used, SETPROCTITLE_PS_PADDING,\n\t    ps_buffer_size - used);\n#endif   /* PS_USE_CLOBBER_ARGV */\n\n#endif /* PS_USE_NONE */\n}",
          "includes": [
            "#include <sys/exec.h>",
            "#include <machine/vmparam.h>\t/* for old BSD */",
            "#include <sys/pstat.h>\t\t/* for HP-UX */",
            "#include \"src/common/strlcpy.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <errno.h>",
            "#    include \"src/common/malloc.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define PS_USE_CLOBBER_ARGV\t\t4",
            "#define PS_USE_CHANGE_ARGV\t\t3",
            "#define PS_USE_PS_STRINGS\t\t2",
            "#define PS_USE_PSTAT\t\t\t1",
            "#define PS_USE_NONE\t\t\t0"
          ],
          "globals_used": [
            "static char **save_argv;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\n#define PS_USE_CLOBBER_ARGV\t\t4\n#define PS_USE_CHANGE_ARGV\t\t3\n#define PS_USE_PS_STRINGS\t\t2\n#define PS_USE_PSTAT\t\t\t1\n#define PS_USE_NONE\t\t\t0\n\nstatic char **save_argv;\n\nvoid\nsetproctitle(const char *fmt, ...)\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tunion pstun pst;\n#endif\n#if SETPROCTITLE_STRATEGY != PS_USE_NONE\n\tssize_t used;\n\tva_list ap;\n\n\t/* no ps display if you didn't call save_ps_display_args() */\n\tif (save_argv == NULL)\n\t\treturn;\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* If ps_buffer is a pointer, it might still be null */\n\tif (ps_buffer == NULL)\n\t\treturn;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Overwrite argv[] to point at appropriate space, if needed\n\t */\n#if SETPROCTITLE_STRATEGY == PS_USE_CHANGE_ARGV\n\tsave_argv[0] = ps_buffer;\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CHANGE_ARGV */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Make fixed prefix of ps display.\n\t */\n\n\tva_start(ap, fmt);\n\tif (fmt == NULL)\n\t\tsnprintf(ps_buffer, ps_buffer_size, \"%s\", __progname);\n\telse {\n\t\tused = snprintf(ps_buffer, ps_buffer_size, \"%s: \", __progname);\n\t\tif (used == -1 || used >= ps_buffer_size)\n\t\t\tused = ps_buffer_size;\n\t\tvsnprintf(ps_buffer + used, ps_buffer_size - used, fmt, ap);\n\t}\n\tva_end(ap);\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tpst.pst_command = ps_buffer;\n\tpstat(PSTAT_SETCMD, pst, strlen(ps_buffer), 0, 0);\n#endif   /* PS_USE_PSTAT */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PS_STRINGS\n\tPS_STRINGS->ps_nargvstr = 1;\n\tPS_STRINGS->ps_argvstr = ps_buffer;\n#endif   /* PS_USE_PS_STRINGS */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* pad unused memory */\n\tused = strlen(ps_buffer);\n\tmemset(ps_buffer + used, SETPROCTITLE_PS_PADDING,\n\t    ps_buffer_size - used);\n#endif   /* PS_USE_CLOBBER_ARGV */\n\n#endif /* PS_USE_NONE */\n}"
        }
      },
      {
        "call_info": {
          "callee": "setproctitle",
          "args": [
            "\"[%u]\"",
            "job->jobid"
          ],
          "line": 2570
        },
        "resolved": true,
        "details": {
          "function_name": "init_setproctitle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
          "lines": "263-328",
          "snippet": "void\ninit_setproctitle(int argc, char *argv[])\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tchar *end_of_area = NULL;\n\tint i;\n#endif\n\n\tsave_argc = argc;\n\tsave_argv = argv;\n\n#if defined(__NetBSD__) || defined(__FreeBSD__)\n\tsetprogname (argv[0]);\n#else\n\t_init__progname (argv[0]);\n#endif\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/*\n\t * If we're going to overwrite the argv area, count the available\n\t * space.  Also move the environment to make additional room.\n\t */\n\n\t/*\n\t * check for contiguous argv strings\n\t */\n\tfor (i = 0; i < argc; i++) {\n\t\tif (i == 0 || end_of_area + 1 == argv[i])\n\t\t\tend_of_area = argv[i] + strlen(argv[i]);\n\t}\n\n\t/* probably can't happen? */\n\tif (end_of_area == NULL) {\n\t\tps_buffer = NULL;\n\t\tps_buffer_size = 0;\n\t\treturn;\n\t}\n\n\t/*\n\t * check for contiguous environ strings following argv\n\t */\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tif (end_of_area + 1 == environ[i])\n\t\t\tend_of_area = environ[i] + strlen(environ[i]);\n\t}\n\n\tps_buffer = argv[0];\n\tps_buffer_size = end_of_area - argv[0] - 1;\n\n\t/*\n\t * Duplicate and move the environment out of the way\n\t */\n\tnew_environ = malloc(sizeof(char *) * (i + 1));\n\tif (!new_environ) {\n\t\tfprintf(stderr, \"ERROR: [%s:%d] %s: %s\\n\",\n\t\t\t__FILE__, __LINE__, \"init_setproctitle\",\n\t\t\tstrerror(errno));\n\t\tabort();\n\t}\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tnew_environ[i] = strdup(environ[i]);\n\t}\n\tnew_environ[i] = NULL;\n\tenviron = new_environ;\n#endif /* PS_USE_CLOBBER_ARGV */\n}",
          "includes": [
            "#include <sys/exec.h>",
            "#include <machine/vmparam.h>\t/* for old BSD */",
            "#include <sys/pstat.h>\t\t/* for HP-UX */",
            "#include \"src/common/strlcpy.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <errno.h>",
            "#    include \"src/common/malloc.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define PS_USE_CLOBBER_ARGV\t\t4"
          ],
          "globals_used": [
            "extern char **environ;",
            "static int\tsave_argc;",
            "static char **save_argv;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\n#define PS_USE_CLOBBER_ARGV\t\t4\n\nextern char **environ;\nstatic int\tsave_argc;\nstatic char **save_argv;\n\nvoid\ninit_setproctitle(int argc, char *argv[])\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tchar *end_of_area = NULL;\n\tint i;\n#endif\n\n\tsave_argc = argc;\n\tsave_argv = argv;\n\n#if defined(__NetBSD__) || defined(__FreeBSD__)\n\tsetprogname (argv[0]);\n#else\n\t_init__progname (argv[0]);\n#endif\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/*\n\t * If we're going to overwrite the argv area, count the available\n\t * space.  Also move the environment to make additional room.\n\t */\n\n\t/*\n\t * check for contiguous argv strings\n\t */\n\tfor (i = 0; i < argc; i++) {\n\t\tif (i == 0 || end_of_area + 1 == argv[i])\n\t\t\tend_of_area = argv[i] + strlen(argv[i]);\n\t}\n\n\t/* probably can't happen? */\n\tif (end_of_area == NULL) {\n\t\tps_buffer = NULL;\n\t\tps_buffer_size = 0;\n\t\treturn;\n\t}\n\n\t/*\n\t * check for contiguous environ strings following argv\n\t */\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tif (end_of_area + 1 == environ[i])\n\t\t\tend_of_area = environ[i] + strlen(environ[i]);\n\t}\n\n\tps_buffer = argv[0];\n\tps_buffer_size = end_of_area - argv[0] - 1;\n\n\t/*\n\t * Duplicate and move the environment out of the way\n\t */\n\tnew_environ = malloc(sizeof(char *) * (i + 1));\n\tif (!new_environ) {\n\t\tfprintf(stderr, \"ERROR: [%s:%d] %s: %s\\n\",\n\t\t\t__FILE__, __LINE__, \"init_setproctitle\",\n\t\t\tstrerror(errno));\n\t\tabort();\n\t}\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tnew_environ[i] = strdup(environ[i]);\n\t}\n\tnew_environ[i] = NULL;\n\tenviron = new_environ;\n#endif /* PS_USE_CLOBBER_ARGV */\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_setargs(stepd_step_rec_t *job)\n{\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsetproctitle(\"[%u]\",    job->jobid);\n\telse\n\t\tsetproctitle(\"[%u.%u]\", job->jobid, job->stepid);\n\n\treturn;\n}"
  },
  {
    "function_name": "_slurmd_job_log_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2505-2560",
    "snippet": "static int\n_slurmd_job_log_init(stepd_step_rec_t *job)\n{\n\tchar argv0[64];\n\n\tconf->log_opts.buffered = 1;\n\n\t/*\n\t * Reset stderr logging to user requested level\n\t * (Logfile and syslog levels remain the same)\n\t *\n\t * The maximum stderr log level is LOG_LEVEL_DEBUG3 because\n\t * some higher level debug messages are generated in the\n\t * stdio code, which would otherwise create more stderr traffic\n\t * to srun and therefore more debug messages in an endless loop.\n\t */\n\tconf->log_opts.stderr_level = LOG_LEVEL_ERROR + job->debug;\n\tif (conf->log_opts.stderr_level > LOG_LEVEL_DEBUG3)\n\t\tconf->log_opts.stderr_level = LOG_LEVEL_DEBUG3;\n\n#if defined(MULTIPLE_SLURMD)\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd-%s\", conf->node_name);\n#else\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd\");\n#endif\n\t/*\n\t * reinitialize log\n\t */\n\n\tlog_alter(conf->log_opts, 0, NULL);\n\tlog_set_argv0(argv0);\n\n\t/*  Connect slurmd stderr to stderr of job, unless we are using\n\t *   user_managed_io or a pty.\n\t *\n\t *  user_managed_io directly connects the client (e.g. poe) to the tasks\n\t *   over a TCP connection, and we fully leave it up to the client\n\t *   to manage the stream with no buffering on slurm's part.\n\t *   We also promise that we will not insert any foreign data into\n\t *   the stream, so here we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the tasks's stderr.\n\t *\n\t *  When pty terminal emulation is used, the pts can potentially\n\t *   cause IO to block, so we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the task's pts on stderr to avoid hangs in\n\t *   the slurmstepd.\n\t */\n\tif (!job->user_managed_io && !job->pty && job->task != NULL) {\n\t\tif (dup2(job->task[0]->stderr_fd, STDERR_FILENO) < 0) {\n\t\t\terror(\"job_log_init: dup2(stderr): %m\");\n\t\t\treturn ESLURMD_IO_ERROR;\n\t\t}\n\t}\n\tverbose(\"debug level = %d\", conf->log_opts.stderr_level);\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"debug level = %d\"",
            "conf->log_opts.stderr_level"
          ],
          "line": 2558
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"job_log_init: dup2(stderr): %m\""
          ],
          "line": 2554
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "job->task[0]->stderr_fd",
            "STDERR_FILENO"
          ],
          "line": 2553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_set_argv0",
          "args": [
            "argv0"
          ],
          "line": 2535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_alter",
          "args": [
            "conf->log_opts",
            "0",
            "NULL"
          ],
          "line": 2534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "argv0",
            "sizeof(argv0)",
            "\"slurmstepd\""
          ],
          "line": 2528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "argv0",
            "sizeof(argv0)",
            "\"slurmstepd-%s\"",
            "conf->node_name"
          ],
          "line": 2526
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_slurmd_job_log_init(stepd_step_rec_t *job)\n{\n\tchar argv0[64];\n\n\tconf->log_opts.buffered = 1;\n\n\t/*\n\t * Reset stderr logging to user requested level\n\t * (Logfile and syslog levels remain the same)\n\t *\n\t * The maximum stderr log level is LOG_LEVEL_DEBUG3 because\n\t * some higher level debug messages are generated in the\n\t * stdio code, which would otherwise create more stderr traffic\n\t * to srun and therefore more debug messages in an endless loop.\n\t */\n\tconf->log_opts.stderr_level = LOG_LEVEL_ERROR + job->debug;\n\tif (conf->log_opts.stderr_level > LOG_LEVEL_DEBUG3)\n\t\tconf->log_opts.stderr_level = LOG_LEVEL_DEBUG3;\n\n#if defined(MULTIPLE_SLURMD)\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd-%s\", conf->node_name);\n#else\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd\");\n#endif\n\t/*\n\t * reinitialize log\n\t */\n\n\tlog_alter(conf->log_opts, 0, NULL);\n\tlog_set_argv0(argv0);\n\n\t/*  Connect slurmd stderr to stderr of job, unless we are using\n\t *   user_managed_io or a pty.\n\t *\n\t *  user_managed_io directly connects the client (e.g. poe) to the tasks\n\t *   over a TCP connection, and we fully leave it up to the client\n\t *   to manage the stream with no buffering on slurm's part.\n\t *   We also promise that we will not insert any foreign data into\n\t *   the stream, so here we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the tasks's stderr.\n\t *\n\t *  When pty terminal emulation is used, the pts can potentially\n\t *   cause IO to block, so we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the task's pts on stderr to avoid hangs in\n\t *   the slurmstepd.\n\t */\n\tif (!job->user_managed_io && !job->pty && job->task != NULL) {\n\t\tif (dup2(job->task[0]->stderr_fd, STDERR_FILENO) < 0) {\n\t\t\terror(\"job_log_init: dup2(stderr): %m\");\n\t\t\treturn ESLURMD_IO_ERROR;\n\t\t}\n\t}\n\tverbose(\"debug level = %d\", conf->log_opts.stderr_level);\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "_reclaim_privileges",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2480-2502",
    "snippet": "static int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "ps->gid_list"
          ],
          "line": 2499
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "ps->ngids",
            "ps->gid_list"
          ],
          "line": 2497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"setegid: %m\""
          ],
          "line": 2494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setegid",
          "args": [
            "ps->saved_gid"
          ],
          "line": 2493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"seteuid: %m\""
          ],
          "line": 2491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "seteuid",
          "args": [
            "ps->saved_uid"
          ],
          "line": 2490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 2488
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}"
  },
  {
    "function_name": "_drop_privileges",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2422-2478",
    "snippet": "static int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
      "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"seteuid: %m\""
          ],
          "line": 2473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "seteuid",
          "args": [
            "job->uid"
          ],
          "line": 2472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_initgroups: %m\""
          ],
          "line": 2468
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_initgroups",
          "args": [
            "job"
          ],
          "line": 2467
        },
        "resolved": true,
        "details": {
          "function_name": "_initgroups",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2667-2735",
          "snippet": "static int\n_initgroups(stepd_step_rec_t *job)\n{\n#ifndef HAVE_NATIVE_CRAY\n\tgid_t primary_gid = 0;\n#endif\n\tint rc;\n\n\tif (job->ngids > 0) {\n\t\txassert(job->gids);\n\t\tdebug2(\"Using gid list sent by slurmd\");\n\t\treturn setgroups(job->ngids, job->gids);\n\t}\n\n\tdebug2(\"Uncached user/gid: %s/%ld\", job->user_name, (long)job->gid);\n\tif ((rc = initgroups(job->user_name, job->gid))) {\n\t\tif ((errno == EPERM) && (getuid() != (uid_t) 0)) {\n\t\t\tdebug(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t} else {\n\t\t\terror(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t}\n\t\treturn -1;\n\t}\n\n#ifndef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getpwnam_r() call */\n\trc = _get_primary_group(job->user_name, &primary_gid);\n\tif (rc < 0) {\n\t\terror(\"%s: _get_primary_group() failed\", __func__);\n\t\treturn -1;\n\t}\n\t/* If job->gid is not the primary group for the\n\t * user job->user_name then add the primary group\n\t * in the list of user groups.\n\t */\n\tif (primary_gid != job->gid) {\n\t\tint ngroups_max = sysconf(_SC_NGROUPS_MAX);\n\t\tgid_t grps[ngroups_max];\n\t\tint size, max;\n\n\t\tmax = ngroups_max;\n\n\t\tsize = getgrouplist(job->user_name,\n\t\t\t\t    job->gid,\n\t\t\t\t    grps,\n\t\t\t\t    &ngroups_max);\n\t\tif (size < 0) {\n\t\t\terror(\"%s: getgrouplist() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t\tif (size > max - 1) {\n\t\t\terror(\"\\\n%s: too many groups %d max %d for user %s groups %d %d\\n\",\n\t\t\t      __func__, size, max, job->user_name,\n\t\t\t      primary_gid, job->gid);\n\t\t}\n\t\tgrps[size++] = primary_gid;\n\n\t\tif (setgroups(size, grps)) {\n\t\t\terror(\"%s: setgroups() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\treturn 0;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_initgroups(stepd_step_rec_t *job)\n{\n#ifndef HAVE_NATIVE_CRAY\n\tgid_t primary_gid = 0;\n#endif\n\tint rc;\n\n\tif (job->ngids > 0) {\n\t\txassert(job->gids);\n\t\tdebug2(\"Using gid list sent by slurmd\");\n\t\treturn setgroups(job->ngids, job->gids);\n\t}\n\n\tdebug2(\"Uncached user/gid: %s/%ld\", job->user_name, (long)job->gid);\n\tif ((rc = initgroups(job->user_name, job->gid))) {\n\t\tif ((errno == EPERM) && (getuid() != (uid_t) 0)) {\n\t\t\tdebug(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t} else {\n\t\t\terror(\"Error in initgroups(%s, %ld): %m\",\n\t\t\t      job->user_name, (long)job->gid);\n\t\t}\n\t\treturn -1;\n\t}\n\n#ifndef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getpwnam_r() call */\n\trc = _get_primary_group(job->user_name, &primary_gid);\n\tif (rc < 0) {\n\t\terror(\"%s: _get_primary_group() failed\", __func__);\n\t\treturn -1;\n\t}\n\t/* If job->gid is not the primary group for the\n\t * user job->user_name then add the primary group\n\t * in the list of user groups.\n\t */\n\tif (primary_gid != job->gid) {\n\t\tint ngroups_max = sysconf(_SC_NGROUPS_MAX);\n\t\tgid_t grps[ngroups_max];\n\t\tint size, max;\n\n\t\tmax = ngroups_max;\n\n\t\tsize = getgrouplist(job->user_name,\n\t\t\t\t    job->gid,\n\t\t\t\t    grps,\n\t\t\t\t    &ngroups_max);\n\t\tif (size < 0) {\n\t\t\terror(\"%s: getgrouplist() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t\tif (size > max - 1) {\n\t\t\terror(\"\\\n%s: too many groups %d max %d for user %s groups %d %d\\n\",\n\t\t\t      __func__, size, max, job->user_name,\n\t\t\t      primary_gid, job->gid);\n\t\t}\n\t\tgrps[size++] = primary_gid;\n\n\t\tif (setgroups(size, grps)) {\n\t\t\terror(\"%s: setgroups() failed: %m\", __func__);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"setegid: %m\""
          ],
          "line": 2463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setegid",
          "args": [
            "job->gid"
          ],
          "line": 2462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 2459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "ps->gid_list"
          ],
          "line": 2450
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_drop_privileges: couldn't get %d groups: %m\"",
            "ps->ngids"
          ],
          "line": 2448
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getgroups",
          "args": [
            "ps->ngids",
            "ps->gid_list"
          ],
          "line": 2447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "ps->ngids * sizeof(gid_t)"
          ],
          "line": 2445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgroups",
          "args": [
            "0",
            "NULL"
          ],
          "line": 2443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(gid_t)"
          ],
          "line": 2439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "ps->saved_cwd",
            "\"/tmp\"",
            "sizeof (ps->saved_cwd)"
          ],
          "line": 2431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to get current working directory: %m\""
          ],
          "line": 2430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getcwd",
          "args": [
            "ps->saved_cwd",
            "sizeof (ps->saved_cwd)"
          ],
          "line": 2429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgid",
          "args": [],
          "line": 2427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 2426
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "_send_complete_batch_script_msg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2355-2417",
    "snippet": "static int\n_send_complete_batch_script_msg(stepd_step_rec_t *job, int err, int status)\n{\n\tint\t\trc, i, msg_rc;\n\tslurm_msg_t\treq_msg;\n\tcomplete_batch_script_msg_t req;\n\tchar *\t\tselect_type;\n\tbool\t\tmsg_to_ctld;\n\n\tif (conf->msg_aggr_window_msgs > 1)\n\t\tmsg_to_ctld = 0;\n\telse {\n\t\tselect_type = slurm_get_select_type();\n\t\tmsg_to_ctld = xstrcmp(select_type, \"select/serial\");\n\t\txfree(select_type);\n\t}\n\n\treq.job_id\t= job->jobid;\n\treq.job_rc      = status;\n\treq.jobacct\t= job->jobacct;\n\treq.node_name\t= job->node_name;\n\treq.slurm_rc\t= err;\n\treq.user_id\t= (uint32_t) job->uid;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type= REQUEST_COMPLETE_BATCH_SCRIPT;\n\treq_msg.data\t= &req;\n\n\tinfo(\"sending REQUEST_COMPLETE_BATCH_SCRIPT, error:%u status %d\",\n\t     err, status);\n\n\t/* Note: these log messages don't go to slurmd.log from here */\n\tfor (i = 0; i <= MAX_RETRY; i++) {\n\t\tif (msg_to_ctld) {\n\t\t\tmsg_rc = slurm_send_recv_controller_rc_msg(&req_msg,\n\t\t\t\t\t\t\t\t   &rc);\n\t\t} else {\n\t\t\t/* Send msg to slurmd, which forwards to slurmctld and\n\t\t\t * may get a new job to launch */\n\t\t\tif (i == 0) {\n\t\t\t\tslurm_set_addr_char(&req_msg.address,\n\t\t\t\t\t\t    conf->port, conf->hostname);\n\t\t\t}\n\t\t\tmsg_rc = slurm_send_recv_rc_msg_only_one(&req_msg,\n\t\t\t\t\t\t\t\t &rc, 0);\n\t\t}\n\t\tif (msg_rc == SLURM_SUCCESS)\n\t\t\tbreak;\n\t\tinfo(\"Retrying job complete RPC for %u.%u\",\n\t\t     job->jobid, job->stepid);\n\t\tsleep(RETRY_DELAY);\n\t}\n\tif (i > MAX_RETRY) {\n\t\terror(\"Unable to send job complete message: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif ((rc == ESLURM_ALREADY_DONE) || (rc == ESLURM_INVALID_JOB_ID))\n\t\trc = SLURM_SUCCESS;\n\tif (rc)\n\t\tslurm_seterrno_ret(rc);\n\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [
      "#define MAX_RETRY   240\t\t/* retry 240 times (one hour max) */",
      "#define RETRY_DELAY 15\t\t/* retry every 15 seconds */"
    ],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_seterrno_ret",
          "args": [
            "rc"
          ],
          "line": 2414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to send job complete message: %m\""
          ],
          "line": 2407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "RETRY_DELAY"
          ],
          "line": 2404
        },
        "resolved": true,
        "details": {
          "function_name": "_random_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "664-678",
          "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"Retrying job complete RPC for %u.%u\"",
            "job->jobid",
            "job->stepid"
          ],
          "line": 2402
        },
        "resolved": true,
        "details": {
          "function_name": "_chk_cpuinfo_float",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/get_mach_stat.c",
          "lines": "414-423",
          "snippet": "static int _chk_cpuinfo_float(char *buffer, char *keyword, float *val)\n{\n\tchar *valptr;\n\tif (_chk_cpuinfo_str(buffer, keyword, &valptr)) {\n\t\t*val = (float) strtod(valptr, (char **)NULL);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmctld/slurmctld.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include <unistd.h>",
            "# include <kstat.h>",
            "#  include <sys/vfs.h>",
            "#  include <sys/statfs.h>",
            "#  include <sys/statvfs.h>",
            "#include <sys/utsname.h>",
            "#  include <sys/sysinfo.h>",
            "#  include <sys/times.h> /* for times(3) */",
            "#  include <sys/types.h>",
            "#  include <sys/times.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "# include <sys/sysctl.h>",
            "#include <sys/types.h>",
            "# include <sys/dr.h>",
            "# include <sys/systemcfg.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmctld/slurmctld.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include <unistd.h>\n# include <kstat.h>\n#  include <sys/vfs.h>\n#  include <sys/statfs.h>\n#  include <sys/statvfs.h>\n#include <sys/utsname.h>\n#  include <sys/sysinfo.h>\n#  include <sys/times.h> /* for times(3) */\n#  include <sys/types.h>\n#  include <sys/times.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <errno.h>\n# include <sys/sysctl.h>\n#include <sys/types.h>\n# include <sys/dr.h>\n# include <sys/systemcfg.h>\n#  include \"config.h\"\n\nstatic int _chk_cpuinfo_float(char *buffer, char *keyword, float *val)\n{\n\tchar *valptr;\n\tif (_chk_cpuinfo_str(buffer, keyword, &valptr)) {\n\t\t*val = (float) strtod(valptr, (char **)NULL);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_send_recv_rc_msg_only_one",
          "args": [
            "&req_msg",
            "&rc",
            "0"
          ],
          "line": 2397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_set_addr_char",
          "args": [
            "&req_msg.address",
            "conf->port",
            "conf->hostname"
          ],
          "line": 2394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_send_recv_controller_rc_msg",
          "args": [
            "&req_msg",
            "&rc"
          ],
          "line": 2388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_msg_t_init",
          "args": [
            "&req_msg"
          ],
          "line": 2378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "select_type"
          ],
          "line": 2369
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrcmp",
          "args": [
            "select_type",
            "\"select/serial\""
          ],
          "line": 2368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_get_select_type",
          "args": [],
          "line": 2367
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\n#define MAX_RETRY   240\t\t/* retry 240 times (one hour max) */\n#define RETRY_DELAY 15\t\t/* retry every 15 seconds */\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_complete_batch_script_msg(stepd_step_rec_t *job, int err, int status)\n{\n\tint\t\trc, i, msg_rc;\n\tslurm_msg_t\treq_msg;\n\tcomplete_batch_script_msg_t req;\n\tchar *\t\tselect_type;\n\tbool\t\tmsg_to_ctld;\n\n\tif (conf->msg_aggr_window_msgs > 1)\n\t\tmsg_to_ctld = 0;\n\telse {\n\t\tselect_type = slurm_get_select_type();\n\t\tmsg_to_ctld = xstrcmp(select_type, \"select/serial\");\n\t\txfree(select_type);\n\t}\n\n\treq.job_id\t= job->jobid;\n\treq.job_rc      = status;\n\treq.jobacct\t= job->jobacct;\n\treq.node_name\t= job->node_name;\n\treq.slurm_rc\t= err;\n\treq.user_id\t= (uint32_t) job->uid;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type= REQUEST_COMPLETE_BATCH_SCRIPT;\n\treq_msg.data\t= &req;\n\n\tinfo(\"sending REQUEST_COMPLETE_BATCH_SCRIPT, error:%u status %d\",\n\t     err, status);\n\n\t/* Note: these log messages don't go to slurmd.log from here */\n\tfor (i = 0; i <= MAX_RETRY; i++) {\n\t\tif (msg_to_ctld) {\n\t\t\tmsg_rc = slurm_send_recv_controller_rc_msg(&req_msg,\n\t\t\t\t\t\t\t\t   &rc);\n\t\t} else {\n\t\t\t/* Send msg to slurmd, which forwards to slurmctld and\n\t\t\t * may get a new job to launch */\n\t\t\tif (i == 0) {\n\t\t\t\tslurm_set_addr_char(&req_msg.address,\n\t\t\t\t\t\t    conf->port, conf->hostname);\n\t\t\t}\n\t\t\tmsg_rc = slurm_send_recv_rc_msg_only_one(&req_msg,\n\t\t\t\t\t\t\t\t &rc, 0);\n\t\t}\n\t\tif (msg_rc == SLURM_SUCCESS)\n\t\t\tbreak;\n\t\tinfo(\"Retrying job complete RPC for %u.%u\",\n\t\t     job->jobid, job->stepid);\n\t\tsleep(RETRY_DELAY);\n\t}\n\tif (i > MAX_RETRY) {\n\t\terror(\"Unable to send job complete message: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif ((rc == ESLURM_ALREADY_DONE) || (rc == ESLURM_INVALID_JOB_ID))\n\t\trc = SLURM_SUCCESS;\n\tif (rc)\n\t\tslurm_seterrno_ret(rc);\n\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "_send_launch_resp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2316-2352",
    "snippet": "static void\n_send_launch_resp(stepd_step_rec_t *job, int rc)\n{\n\tint i;\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tsrun_info_t *srun = list_peek(job->sruns);\n\n\tif (job->batch)\n\t\treturn;\n\n\tdebug(\"Sending launch resp rc=%d\", rc);\n\n\tslurm_msg_t_init(&resp_msg);\n\tresp_msg.address\t= srun->resp_addr;\n\tresp_msg.protocol_version = srun->protocol_version;\n\tresp_msg.data\t\t= &resp;\n\tresp_msg.msg_type\t= RESPONSE_LAUNCH_TASKS;\n\n\tresp.node_name\t\t= xstrdup(job->node_name);\n\tresp.return_code\t= rc;\n\tresp.count_of_pids\t= job->node_tasks;\n\n\tresp.local_pids = xmalloc(job->node_tasks * sizeof(*resp.local_pids));\n\tresp.task_ids = xmalloc(job->node_tasks * sizeof(*resp.task_ids));\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tresp.local_pids[i] = job->task[i]->pid;\n\t\tresp.task_ids[i] = job->task[i]->gtid;\n\t}\n\n\tif (_send_srun_resp_msg(&resp_msg, job->nnodes) != SLURM_SUCCESS)\n\t\terror(\"failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\n\txfree(resp.local_pids);\n\txfree(resp.task_ids);\n\txfree(resp.node_name);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "resp.node_name"
          ],
          "line": 2351
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"failed to send RESPONSE_LAUNCH_TASKS: %m\""
          ],
          "line": 2347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_send_srun_resp_msg",
          "args": [
            "&resp_msg",
            "job->nnodes"
          ],
          "line": 2346
        },
        "resolved": true,
        "details": {
          "function_name": "_send_srun_resp_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "262-291",
          "snippet": "inline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\ninline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "job->node_tasks * sizeof(*resp.task_ids)"
          ],
          "line": 2340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "job->node_tasks * sizeof(*resp.local_pids)"
          ],
          "line": 2339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "job->node_name"
          ],
          "line": 2335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_msg_t_init",
          "args": [
            "&resp_msg"
          ],
          "line": 2329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Sending launch resp rc=%d\"",
            "rc"
          ],
          "line": 2327
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_wake_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "187-199",
          "snippet": "void pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_peek",
          "args": [
            "job->sruns"
          ],
          "line": 2322
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_send_launch_resp(stepd_step_rec_t *job, int rc)\n{\n\tint i;\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tsrun_info_t *srun = list_peek(job->sruns);\n\n\tif (job->batch)\n\t\treturn;\n\n\tdebug(\"Sending launch resp rc=%d\", rc);\n\n\tslurm_msg_t_init(&resp_msg);\n\tresp_msg.address\t= srun->resp_addr;\n\tresp_msg.protocol_version = srun->protocol_version;\n\tresp_msg.data\t\t= &resp;\n\tresp_msg.msg_type\t= RESPONSE_LAUNCH_TASKS;\n\n\tresp.node_name\t\t= xstrdup(job->node_name);\n\tresp.return_code\t= rc;\n\tresp.count_of_pids\t= job->node_tasks;\n\n\tresp.local_pids = xmalloc(job->node_tasks * sizeof(*resp.local_pids));\n\tresp.task_ids = xmalloc(job->node_tasks * sizeof(*resp.task_ids));\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tresp.local_pids[i] = job->task[i]->pid;\n\t\tresp.task_ids[i] = job->task[i]->gtid;\n\t}\n\n\tif (_send_srun_resp_msg(&resp_msg, job->nnodes) != SLURM_SUCCESS)\n\t\terror(\"failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\n\txfree(resp.local_pids);\n\txfree(resp.task_ids);\n\txfree(resp.node_name);\n}"
  },
  {
    "function_name": "_send_launch_failure",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2279-2314",
    "snippet": "static void\n_send_launch_failure(launch_tasks_request_msg_t *msg, slurm_addr_t *cli, int rc,\n\t\t     uint16_t protocol_version)\n{\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tint nodeid;\n\tchar *name = NULL;\n\n#ifndef HAVE_FRONT_END\n\tnodeid = nodelist_find(msg->complete_nodelist, conf->node_name);\n\tname = xstrdup(conf->node_name);\n#else\n\tnodeid = 0;\n\tname = xstrdup(msg->complete_nodelist);\n#endif\n\tdebug (\"sending launch failure message: %s\", slurm_strerror (rc));\n\n\tslurm_msg_t_init(&resp_msg);\n\tmemcpy(&resp_msg.address, cli, sizeof(slurm_addr_t));\n\tslurm_set_addr(&resp_msg.address,\n\t\t       msg->resp_port[nodeid % msg->num_resp_port],\n\t\t       NULL);\n\tresp_msg.data = &resp;\n\tresp_msg.msg_type = RESPONSE_LAUNCH_TASKS;\n\tresp_msg.protocol_version = protocol_version;\n\n\tresp.node_name     = name;\n\tresp.return_code   = rc ? rc : -1;\n\tresp.count_of_pids = 0;\n\n\tif (_send_srun_resp_msg(&resp_msg, msg->nnodes) != SLURM_SUCCESS)\n\t\terror(\"Failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\txfree(name);\n\treturn;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "name"
          ],
          "line": 2312
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to send RESPONSE_LAUNCH_TASKS: %m\""
          ],
          "line": 2311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_send_srun_resp_msg",
          "args": [
            "&resp_msg",
            "msg->nnodes"
          ],
          "line": 2310
        },
        "resolved": true,
        "details": {
          "function_name": "_send_srun_resp_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "262-291",
          "snippet": "inline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\ninline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_set_addr",
          "args": [
            "&resp_msg.address",
            "msg->resp_port[nodeid % msg->num_resp_port]",
            "NULL"
          ],
          "line": 2299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&resp_msg.address",
            "cli",
            "sizeof(slurm_addr_t)"
          ],
          "line": 2298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_msg_t_init",
          "args": [
            "&resp_msg"
          ],
          "line": 2297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"sending launch failure message: %s\"",
            "slurm_strerror (rc)"
          ],
          "line": 2295
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_wake_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "187-199",
          "snippet": "void pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_strerror",
          "args": [
            "rc"
          ],
          "line": 2295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "msg->complete_nodelist"
          ],
          "line": 2293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "conf->node_name"
          ],
          "line": 2290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nodelist_find",
          "args": [
            "msg->complete_nodelist",
            "conf->node_name"
          ],
          "line": 2289
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\n\nstatic void\n_send_launch_failure(launch_tasks_request_msg_t *msg, slurm_addr_t *cli, int rc,\n\t\t     uint16_t protocol_version)\n{\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tint nodeid;\n\tchar *name = NULL;\n\n#ifndef HAVE_FRONT_END\n\tnodeid = nodelist_find(msg->complete_nodelist, conf->node_name);\n\tname = xstrdup(conf->node_name);\n#else\n\tnodeid = 0;\n\tname = xstrdup(msg->complete_nodelist);\n#endif\n\tdebug (\"sending launch failure message: %s\", slurm_strerror (rc));\n\n\tslurm_msg_t_init(&resp_msg);\n\tmemcpy(&resp_msg.address, cli, sizeof(slurm_addr_t));\n\tslurm_set_addr(&resp_msg.address,\n\t\t       msg->resp_port[nodeid % msg->num_resp_port],\n\t\t       NULL);\n\tresp_msg.data = &resp;\n\tresp_msg.msg_type = RESPONSE_LAUNCH_TASKS;\n\tresp_msg.protocol_version = protocol_version;\n\n\tresp.node_name     = name;\n\tresp.return_code   = rc ? rc : -1;\n\tresp.count_of_pids = 0;\n\n\tif (_send_srun_resp_msg(&resp_msg, msg->nnodes) != SLURM_SUCCESS)\n\t\terror(\"Failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\txfree(name);\n\treturn;\n}"
  },
  {
    "function_name": "_drain_node",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2258-2277",
    "snippet": "static int _drain_node(char *reason)\n{\n\tslurm_msg_t req_msg;\n\tupdate_node_msg_t update_node_msg;\n\n\tmemset(&update_node_msg, 0, sizeof(update_node_msg_t));\n\tupdate_node_msg.node_names = conf->node_name;\n\tupdate_node_msg.node_state = NODE_STATE_DRAIN;\n\tupdate_node_msg.reason = reason;\n\tupdate_node_msg.reason_uid = getuid();\n\tupdate_node_msg.weight = NO_VAL;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type = REQUEST_UPDATE_NODE;\n\treq_msg.data = &update_node_msg;\n\n\tif (slurm_send_only_controller_msg(&req_msg) < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _drain_node(char *reason);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_send_only_controller_msg",
          "args": [
            "&req_msg"
          ],
          "line": 2273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_msg_t_init",
          "args": [
            "&req_msg"
          ],
          "line": 2269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 2267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&update_node_msg",
            "0",
            "sizeof(update_node_msg_t)"
          ],
          "line": 2263
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _drain_node(char *reason);\n\nstatic int _drain_node(char *reason)\n{\n\tslurm_msg_t req_msg;\n\tupdate_node_msg_t update_node_msg;\n\n\tmemset(&update_node_msg, 0, sizeof(update_node_msg_t));\n\tupdate_node_msg.node_names = conf->node_name;\n\tupdate_node_msg.node_state = NODE_STATE_DRAIN;\n\tupdate_node_msg.reason = reason;\n\tupdate_node_msg.reason_uid = getuid();\n\tupdate_node_msg.weight = NO_VAL;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type = REQUEST_UPDATE_NODE;\n\treq_msg.data = &update_node_msg;\n\n\tif (slurm_send_only_controller_msg(&req_msg) < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "_make_batch_script",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2207-2256",
    "snippet": "static char *\n_make_batch_script(batch_job_launch_msg_t *msg, char *path)\n{\n\tFILE *fp = NULL;\n\tchar  script[MAXPATHLEN];\n\n\tif (msg->script == NULL) {\n\t\terror(\"_make_batch_script: called with NULL script\");\n\t\treturn NULL;\n\t}\n\n\tsnprintf(script, sizeof(script), \"%s/%s\", path, \"slurm_script\");\n\nagain:\n\tif ((fp = safeopen(script, \"w\", SAFEOPEN_CREATE_ONLY)) == NULL) {\n\t\tif ((errno != EEXIST) || (unlink(script) < 0))  {\n\t\t\terror(\"couldn't open `%s': %m\", script);\n\t\t\tgoto error;\n\t\t}\n\t\tgoto again;\n\t}\n\n\tif (fputs(msg->script, fp) < 0) {\n\t\t(void) fclose(fp);\n\t\terror(\"fputs: %m\");\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (fclose(fp) < 0) {\n\t\terror(\"fclose: %m\");\n\t}\n\n\tif (chown(script, (uid_t) msg->uid, (gid_t) -1) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(script, 0500) < 0) {\n\t\terror(\"chmod: %m\");\n\t}\n\n\treturn xstrdup(script);\n\nerror:\n\t(void) unlink(script);\n\treturn NULL;\n\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "script"
          ],
          "line": 2253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "script"
          ],
          "line": 2250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"chmod: %m\""
          ],
          "line": 2247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chmod",
          "args": [
            "script",
            "0500"
          ],
          "line": 2246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"chown(%s): %m\"",
            "path"
          ],
          "line": 2242
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "script",
            "(uid_t) msg->uid",
            "(gid_t) -1"
          ],
          "line": 2241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"fclose: %m\""
          ],
          "line": 2238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 2237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_drain_node",
          "args": [
            "\"SlurmdSpoolDir is full\""
          ],
          "line": 2233
        },
        "resolved": true,
        "details": {
          "function_name": "_drain_node",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2258-2277",
          "snippet": "static int _drain_node(char *reason)\n{\n\tslurm_msg_t req_msg;\n\tupdate_node_msg_t update_node_msg;\n\n\tmemset(&update_node_msg, 0, sizeof(update_node_msg_t));\n\tupdate_node_msg.node_names = conf->node_name;\n\tupdate_node_msg.node_state = NODE_STATE_DRAIN;\n\tupdate_node_msg.reason = reason;\n\tupdate_node_msg.reason_uid = getuid();\n\tupdate_node_msg.weight = NO_VAL;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type = REQUEST_UPDATE_NODE;\n\treq_msg.data = &update_node_msg;\n\n\tif (slurm_send_only_controller_msg(&req_msg) < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _drain_node(char *reason);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _drain_node(char *reason);\n\nstatic int _drain_node(char *reason)\n{\n\tslurm_msg_t req_msg;\n\tupdate_node_msg_t update_node_msg;\n\n\tmemset(&update_node_msg, 0, sizeof(update_node_msg_t));\n\tupdate_node_msg.node_names = conf->node_name;\n\tupdate_node_msg.node_state = NODE_STATE_DRAIN;\n\tupdate_node_msg.reason = reason;\n\tupdate_node_msg.reason_uid = getuid();\n\tupdate_node_msg.weight = NO_VAL;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type = REQUEST_UPDATE_NODE;\n\treq_msg.data = &update_node_msg;\n\n\tif (slurm_send_only_controller_msg(&req_msg) < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"fputs: %m\""
          ],
          "line": 2231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 2230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fputs",
          "args": [
            "msg->script",
            "fp"
          ],
          "line": 2229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "script"
          ],
          "line": 2222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "safeopen",
          "args": [
            "script",
            "\"w\"",
            "SAFEOPEN_CREATE_ONLY"
          ],
          "line": 2221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "script",
            "sizeof(script)",
            "\"%s/%s\"",
            "path",
            "\"slurm_script\""
          ],
          "line": 2218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_make_batch_script: called with NULL script\""
          ],
          "line": 2214
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\n\nstatic char *\n_make_batch_script(batch_job_launch_msg_t *msg, char *path)\n{\n\tFILE *fp = NULL;\n\tchar  script[MAXPATHLEN];\n\n\tif (msg->script == NULL) {\n\t\terror(\"_make_batch_script: called with NULL script\");\n\t\treturn NULL;\n\t}\n\n\tsnprintf(script, sizeof(script), \"%s/%s\", path, \"slurm_script\");\n\nagain:\n\tif ((fp = safeopen(script, \"w\", SAFEOPEN_CREATE_ONLY)) == NULL) {\n\t\tif ((errno != EEXIST) || (unlink(script) < 0))  {\n\t\t\terror(\"couldn't open `%s': %m\", script);\n\t\t\tgoto error;\n\t\t}\n\t\tgoto again;\n\t}\n\n\tif (fputs(msg->script, fp) < 0) {\n\t\t(void) fclose(fp);\n\t\terror(\"fputs: %m\");\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (fclose(fp) < 0) {\n\t\terror(\"fclose: %m\");\n\t}\n\n\tif (chown(script, (uid_t) msg->uid, (gid_t) -1) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(script, 0500) < 0) {\n\t\terror(\"chmod: %m\");\n\t}\n\n\treturn xstrdup(script);\n\nerror:\n\t(void) unlink(script);\n\treturn NULL;\n\n}"
  },
  {
    "function_name": "_make_batch_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2171-2205",
    "snippet": "static char *\n_make_batch_dir(stepd_step_rec_t *job)\n{\n\tchar path[MAXPATHLEN];\n\n\tif (job->stepid == NO_VAL)\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u\",\n\t\t\t conf->spooldir, job->jobid);\n\telse {\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u.%05u\",\n\t\t\t conf->spooldir, job->jobid, job->stepid);\n\t}\n\n\tif ((mkdir(path, 0750) < 0) && (errno != EEXIST)) {\n\t\terror(\"mkdir(%s): %m\", path);\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (chown(path, (uid_t) -1, (gid_t) job->gid) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(path, 0750) < 0) {\n\t\terror(\"chmod(%s, 750): %m\", path);\n\t\tgoto error;\n\t}\n\n\treturn xstrdup(path);\n\nerror:\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "path"
          ],
          "line": 2201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"chmod(%s, 750): %m\"",
            "path"
          ],
          "line": 2197
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "chmod",
          "args": [
            "path",
            "0750"
          ],
          "line": 2196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "path",
            "(uid_t) -1",
            "(gid_t) job->gid"
          ],
          "line": 2191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_drain_node",
          "args": [
            "\"SlurmdSpoolDir is full\""
          ],
          "line": 2187
        },
        "resolved": true,
        "details": {
          "function_name": "_drain_node",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2258-2277",
          "snippet": "static int _drain_node(char *reason)\n{\n\tslurm_msg_t req_msg;\n\tupdate_node_msg_t update_node_msg;\n\n\tmemset(&update_node_msg, 0, sizeof(update_node_msg_t));\n\tupdate_node_msg.node_names = conf->node_name;\n\tupdate_node_msg.node_state = NODE_STATE_DRAIN;\n\tupdate_node_msg.reason = reason;\n\tupdate_node_msg.reason_uid = getuid();\n\tupdate_node_msg.weight = NO_VAL;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type = REQUEST_UPDATE_NODE;\n\treq_msg.data = &update_node_msg;\n\n\tif (slurm_send_only_controller_msg(&req_msg) < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _drain_node(char *reason);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _drain_node(char *reason);\n\nstatic int _drain_node(char *reason)\n{\n\tslurm_msg_t req_msg;\n\tupdate_node_msg_t update_node_msg;\n\n\tmemset(&update_node_msg, 0, sizeof(update_node_msg_t));\n\tupdate_node_msg.node_names = conf->node_name;\n\tupdate_node_msg.node_state = NODE_STATE_DRAIN;\n\tupdate_node_msg.reason = reason;\n\tupdate_node_msg.reason_uid = getuid();\n\tupdate_node_msg.weight = NO_VAL;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type = REQUEST_UPDATE_NODE;\n\treq_msg.data = &update_node_msg;\n\n\tif (slurm_send_only_controller_msg(&req_msg) < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mkdir",
          "args": [
            "path",
            "0750"
          ],
          "line": 2184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "path",
            "sizeof(path)",
            "\"%s/job%05u.%05u\"",
            "conf->spooldir",
            "job->jobid",
            "job->stepid"
          ],
          "line": 2180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "path",
            "sizeof(path)",
            "\"%s/job%05u\"",
            "conf->spooldir",
            "job->jobid"
          ],
          "line": 2177
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic char *\n_make_batch_dir(stepd_step_rec_t *job)\n{\n\tchar path[MAXPATHLEN];\n\n\tif (job->stepid == NO_VAL)\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u\",\n\t\t\t conf->spooldir, job->jobid);\n\telse {\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u.%05u\",\n\t\t\t conf->spooldir, job->jobid, job->stepid);\n\t}\n\n\tif ((mkdir(path, 0750) < 0) && (errno != EEXIST)) {\n\t\terror(\"mkdir(%s): %m\", path);\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (chown(path, (uid_t) -1, (gid_t) job->gid) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(path, 0750) < 0) {\n\t\terror(\"chmod(%s, 750): %m\", path);\n\t\tgoto error;\n\t}\n\n\treturn xstrdup(path);\n\nerror:\n\treturn NULL;\n}"
  },
  {
    "function_name": "_wait_for_io",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2149-2168",
    "snippet": "static void\n_wait_for_io(stepd_step_rec_t *job)\n{\n\tdebug(\"Waiting for IO\");\n\tio_close_all(job);\n\n\t/*\n\t * Wait until IO thread exits or kill it after 300 seconds\n\t */\n\tif (job->ioid) {\n\t\t_delay_kill_thread(job->ioid, 300);\n\t\tpthread_join(job->ioid, NULL);\n\t} else\n\t\tinfo(\"_wait_for_io: ioid==0\");\n\n\t/* Close any files for stdout/stderr opened by the stepd */\n\tio_close_local_fds(job);\n\n\treturn;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_close_local_fds",
          "args": [
            "job"
          ],
          "line": 2165
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_local_fds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1463-1487",
          "snippet": "void\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static bool _task_writable(eio_obj_t *);",
            "static bool _task_readable(eio_obj_t *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void *_io_thr(void *arg);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic bool _task_writable(eio_obj_t *);\nstatic bool _task_readable(eio_obj_t *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void *_io_thr(void *arg);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nvoid\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}"
        }
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"_wait_for_io: ioid==0\""
          ],
          "line": 2162
        },
        "resolved": true,
        "details": {
          "function_name": "_fork_child_with_wait_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1464-1486",
          "snippet": "static struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "pthread_join",
          "args": [
            "job->ioid",
            "NULL"
          ],
          "line": 2160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_delay_kill_thread",
          "args": [
            "job->ioid",
            "300"
          ],
          "line": 2159
        },
        "resolved": true,
        "details": {
          "function_name": "_delay_kill_thread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2124-2144",
          "snippet": "static void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_close_all",
          "args": [
            "job"
          ],
          "line": 2153
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1432-1461",
          "snippet": "void\nio_close_all(stepd_step_rec_t *job)\n{\n\tint devnull;\n#if 0\n\tint i;\n\tfor (i = 0; i < job->node_tasks; i++)\n\t\t_io_finalize(job->task[i]);\n#endif\n\n\t/* No more debug info will be received by client after this point\n\t */\n\tdebug(\"Closing debug channel\");\n\n\t/*\n\t * Send stderr to /dev/null since debug channel is closing\n\t *  and log facility may still try to write to stderr.\n\t */\n\tif ((devnull = open(\"/dev/null\", O_RDWR)) < 0) {\n\t\terror(\"Could not open /dev/null: %m\");\n\t} else {\n\t\tif (dup2(devnull, STDERR_FILENO) < 0)\n\t\t\terror(\"Unable to dup /dev/null onto stderr\");\n\t}\n\n\t/* Signal IO thread to close appropriate\n\t * client connections\n\t */\n\teio_signal_shutdown(job->eio);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nvoid\nio_close_all(stepd_step_rec_t *job)\n{\n\tint devnull;\n#if 0\n\tint i;\n\tfor (i = 0; i < job->node_tasks; i++)\n\t\t_io_finalize(job->task[i]);\n#endif\n\n\t/* No more debug info will be received by client after this point\n\t */\n\tdebug(\"Closing debug channel\");\n\n\t/*\n\t * Send stderr to /dev/null since debug channel is closing\n\t *  and log facility may still try to write to stderr.\n\t */\n\tif ((devnull = open(\"/dev/null\", O_RDWR)) < 0) {\n\t\terror(\"Could not open /dev/null: %m\");\n\t} else {\n\t\tif (dup2(devnull, STDERR_FILENO) < 0)\n\t\t\terror(\"Unable to dup /dev/null onto stderr\");\n\t}\n\n\t/* Signal IO thread to close appropriate\n\t * client connections\n\t */\n\teio_signal_shutdown(job->eio);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Waiting for IO\""
          ],
          "line": 2152
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_stop_current",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "120-139",
          "snippet": "void\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_io(stepd_step_rec_t *job)\n{\n\tdebug(\"Waiting for IO\");\n\tio_close_all(job);\n\n\t/*\n\t * Wait until IO thread exits or kill it after 300 seconds\n\t */\n\tif (job->ioid) {\n\t\t_delay_kill_thread(job->ioid, 300);\n\t\tpthread_join(job->ioid, NULL);\n\t} else\n\t\tinfo(\"_wait_for_io: ioid==0\");\n\n\t/* Close any files for stdout/stderr opened by the stepd */\n\tio_close_local_fds(job);\n\n\treturn;\n}"
  },
  {
    "function_name": "_delay_kill_thread",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2124-2144",
    "snippet": "static void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_attr_destroy",
          "args": [
            "&attr"
          ],
          "line": 2143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "usleep",
          "args": [
            "10"
          ],
          "line": 2141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_delay_kill_thread: Can't create pthread\""
          ],
          "line": 2138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_delay_kill_thread: pthread_create: %m\""
          ],
          "line": 2136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pthread_create",
          "args": [
            "&kill_id",
            "&attr",
            "&_kill_thr",
            "(void *) kt"
          ],
          "line": 2135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pthread_attr_setdetachstate",
          "args": [
            "&attr",
            "PTHREAD_CREATE_DETACHED"
          ],
          "line": 2134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_attr_init",
          "args": [
            "&attr"
          ],
          "line": 2133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(kill_thread_t)"
          ],
          "line": 2128
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}"
  },
  {
    "function_name": "_kill_thr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2112-2122",
    "snippet": "static void *_kill_thr(void *args)\n{\n\tkill_thread_t *kt = ( kill_thread_t *) args;\n\tunsigned int pause = kt->secs;\n\tdo {\n\t\tpause = sleep(pause);\n\t} while (pause > 0);\n\tpthread_cancel(kt->thread_id);\n\txfree(kt);\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "kt"
          ],
          "line": 2120
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "pthread_cancel",
          "args": [
            "kt->thread_id"
          ],
          "line": 2119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "pause"
          ],
          "line": 2117
        },
        "resolved": true,
        "details": {
          "function_name": "_random_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "664-678",
          "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void *_kill_thr(void *args)\n{\n\tkill_thread_t *kt = ( kill_thread_t *) args;\n\tunsigned int pause = kt->secs;\n\tdo {\n\t\tpause = sleep(pause);\n\t} while (pause > 0);\n\tpthread_cancel(kt->thread_id);\n\txfree(kt);\n\treturn NULL;\n}"
  },
  {
    "function_name": "_wait_for_all_tasks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "2071-2110",
    "snippet": "static void\n_wait_for_all_tasks(stepd_step_rec_t *job)\n{\n\tint tasks_left = 0;\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tif (job->task[i]->state < STEPD_STEP_TASK_COMPLETE) {\n\t\t\ttasks_left++;\n\t\t}\n\t}\n\tif (tasks_left < job->node_tasks)\n\t\tverbose(\"Only %d of %d requested tasks successfully launched\",\n\t\t\ttasks_left, job->node_tasks);\n\n\tfor (i = 0; i < tasks_left; ) {\n\t\tint rc;\n\t\trc = _wait_for_any_task(job, true);\n\t\tif (rc != -1) {\n\t\t\ti += rc;\n\t\t\tif (i < tasks_left) {\n\t\t\t\t/* To limit the amount of traffic back\n\t\t\t\t * we will sleep a bit to make sure we\n\t\t\t\t * have most if not all the tasks\n\t\t\t\t * completed before we return */\n\t\t\t\tusleep(100000);\t/* 100 msec */\n\t\t\t\trc = _wait_for_any_task(job, false);\n\t\t\t\tif (rc != -1)\n\t\t\t\t\ti += rc;\n\t\t\t}\n\t\t}\n\n\t\tif (i < tasks_left) {\n\t\t\t/* Send partial completion message only.\n\t\t\t * The full completion message can only be sent\n\t\t\t * after resetting CPU frequencies */\n\t\t\twhile (_send_pending_exit_msgs(job)) {;}\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _reclaim_privileges(struct priv_state *state);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "_send_pending_exit_msgs",
          "args": [
            "job"
          ],
          "line": 2107
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_wait_for_any_task",
          "args": [
            "job",
            "false"
          ],
          "line": 2097
        },
        "resolved": true,
        "details": {
          "function_name": "_wait_for_any_task",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1969-2069",
          "snippet": "static int\n_wait_for_any_task(stepd_step_rec_t *job, bool waitflag)\n{\n\tstepd_step_task_info_t *t = NULL;\n\tint status = 0;\n\tpid_t pid;\n\tint completed = 0;\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tchar **tmp_env;\n\n\tdo {\n\t\tpid = wait3(&status, waitflag ? 0 : WNOHANG, &rusage);\n\t\tif (pid == -1) {\n\t\t\tif (errno == ECHILD) {\n\t\t\t\tdebug(\"No child processes\");\n\t\t\t\tif (completed == 0)\n\t\t\t\t\tcompleted = -1;\n\t\t\t\tbreak;\n\t\t\t} else if (errno == EINTR) {\n\t\t\t\tdebug(\"wait3 was interrupted\");\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tdebug(\"Unknown errno %d\", errno);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t} else if (pid == 0) { /* WNOHANG and no pids available */\n\t\t\tbreak;\n\t\t}\n\n\t\t/************* acct stuff ********************/\n\t\tjobacct = jobacct_gather_remove_task(pid);\n\t\tif (jobacct) {\n\t\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\t\t/* Since we currently don't track energy\n\t\t\t   usage per task (only per step).  We take\n\t\t\t   into account only the last poll of the last task.\n\t\t\t   Odds are it is the only one with\n\t\t\t   information anyway, but just to be safe we\n\t\t\t   will zero out the previous value since this\n\t\t\t   one will over ride it.\n\t\t\t   If this ever changes in the future this logic\n\t\t\t   will need to change.\n\t\t\t*/\n\t\t\tif (jobacct->energy.consumed_energy)\n\t\t\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\t\tjobacctinfo_destroy(jobacct);\n\t\t}\n\t\tacct_gather_profile_g_task_end(pid);\n\t\t/*********************************************/\n\n\t\tif ((t = job_task_info_by_pid(job, pid))) {\n\t\t\tcompleted++;\n\t\t\t_log_task_exit(t->gtid, pid, status);\n\t\t\tt->exited  = true;\n\t\t\tt->estatus = status;\n\t\t\tjob->envtp->procid = t->gtid;\n\t\t\tjob->envtp->localid = t->id;\n\t\t\tjob->envtp->distribution = -1;\n\t\t\tjob->envtp->batch_flag = job->batch;\n\n\t\t\t/* Modify copy of job's environment. Do not alter in\n\t\t\t * place or concurrent searches of the environment can\n\t\t\t * generate invalid memory references. */\n\t\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\t\tsetup_env(job->envtp, false);\n\t\t\ttmp_env = job->env;\n\t\t\tjob->env = job->envtp->env;\n\t\t\tenv_array_free(tmp_env);\n\n\t\t\tif (job->task_epilog) {\n\t\t\t\t_run_script_as_user(\"user task_epilog\",\n\t\t\t\t\t\t    job->task_epilog,\n\t\t\t\t\t\t    job, 5, job->env);\n\t\t\t}\n\t\t\tif (conf->task_epilog) {\n\t\t\t\tchar *my_epilog;\n\t\t\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\t\t\tmy_epilog = xstrdup(conf->task_epilog);\n\t\t\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t\t\t_run_script_as_user(\"slurm task_epilog\",\n\t\t\t\t\t\t    my_epilog,\n\t\t\t\t\t\t    job, -1, job->env);\n\t\t\t\txfree(my_epilog);\n\t\t\t}\n\t\t\tjob->envtp->procid = t->id;\n\n\t\t\tif (spank_task_exit (job, t->id) < 0) {\n\t\t\t\terror (\"Unable to spank task %d at exit\",\n\t\t\t\t       t->id);\n\t\t\t}\n\t\t\ttask_g_post_term(job, t);\n\t\t}\n\n\t} while ((pid > 0) && !waitflag);\n\n\treturn completed;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static int  _wait_for_any_task(stepd_step_rec_t *job, bool waitflag);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic int  _wait_for_any_task(stepd_step_rec_t *job, bool waitflag);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_wait_for_any_task(stepd_step_rec_t *job, bool waitflag)\n{\n\tstepd_step_task_info_t *t = NULL;\n\tint status = 0;\n\tpid_t pid;\n\tint completed = 0;\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tchar **tmp_env;\n\n\tdo {\n\t\tpid = wait3(&status, waitflag ? 0 : WNOHANG, &rusage);\n\t\tif (pid == -1) {\n\t\t\tif (errno == ECHILD) {\n\t\t\t\tdebug(\"No child processes\");\n\t\t\t\tif (completed == 0)\n\t\t\t\t\tcompleted = -1;\n\t\t\t\tbreak;\n\t\t\t} else if (errno == EINTR) {\n\t\t\t\tdebug(\"wait3 was interrupted\");\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tdebug(\"Unknown errno %d\", errno);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t} else if (pid == 0) { /* WNOHANG and no pids available */\n\t\t\tbreak;\n\t\t}\n\n\t\t/************* acct stuff ********************/\n\t\tjobacct = jobacct_gather_remove_task(pid);\n\t\tif (jobacct) {\n\t\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\t\t/* Since we currently don't track energy\n\t\t\t   usage per task (only per step).  We take\n\t\t\t   into account only the last poll of the last task.\n\t\t\t   Odds are it is the only one with\n\t\t\t   information anyway, but just to be safe we\n\t\t\t   will zero out the previous value since this\n\t\t\t   one will over ride it.\n\t\t\t   If this ever changes in the future this logic\n\t\t\t   will need to change.\n\t\t\t*/\n\t\t\tif (jobacct->energy.consumed_energy)\n\t\t\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\t\tjobacctinfo_destroy(jobacct);\n\t\t}\n\t\tacct_gather_profile_g_task_end(pid);\n\t\t/*********************************************/\n\n\t\tif ((t = job_task_info_by_pid(job, pid))) {\n\t\t\tcompleted++;\n\t\t\t_log_task_exit(t->gtid, pid, status);\n\t\t\tt->exited  = true;\n\t\t\tt->estatus = status;\n\t\t\tjob->envtp->procid = t->gtid;\n\t\t\tjob->envtp->localid = t->id;\n\t\t\tjob->envtp->distribution = -1;\n\t\t\tjob->envtp->batch_flag = job->batch;\n\n\t\t\t/* Modify copy of job's environment. Do not alter in\n\t\t\t * place or concurrent searches of the environment can\n\t\t\t * generate invalid memory references. */\n\t\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\t\tsetup_env(job->envtp, false);\n\t\t\ttmp_env = job->env;\n\t\t\tjob->env = job->envtp->env;\n\t\t\tenv_array_free(tmp_env);\n\n\t\t\tif (job->task_epilog) {\n\t\t\t\t_run_script_as_user(\"user task_epilog\",\n\t\t\t\t\t\t    job->task_epilog,\n\t\t\t\t\t\t    job, 5, job->env);\n\t\t\t}\n\t\t\tif (conf->task_epilog) {\n\t\t\t\tchar *my_epilog;\n\t\t\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\t\t\tmy_epilog = xstrdup(conf->task_epilog);\n\t\t\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t\t\t_run_script_as_user(\"slurm task_epilog\",\n\t\t\t\t\t\t    my_epilog,\n\t\t\t\t\t\t    job, -1, job->env);\n\t\t\t\txfree(my_epilog);\n\t\t\t}\n\t\t\tjob->envtp->procid = t->id;\n\n\t\t\tif (spank_task_exit (job, t->id) < 0) {\n\t\t\t\terror (\"Unable to spank task %d at exit\",\n\t\t\t\t       t->id);\n\t\t\t}\n\t\t\ttask_g_post_term(job, t);\n\t\t}\n\n\t} while ((pid > 0) && !waitflag);\n\n\treturn completed;\n}"
        }
      },
      {
        "call_info": {
          "callee": "usleep",
          "args": [
            "100000"
          ],
          "line": 2096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"Only %d of %d requested tasks successfully launched\"",
            "tasks_left",
            "job->node_tasks"
          ],
          "line": 2083
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_all_tasks(stepd_step_rec_t *job)\n{\n\tint tasks_left = 0;\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tif (job->task[i]->state < STEPD_STEP_TASK_COMPLETE) {\n\t\t\ttasks_left++;\n\t\t}\n\t}\n\tif (tasks_left < job->node_tasks)\n\t\tverbose(\"Only %d of %d requested tasks successfully launched\",\n\t\t\ttasks_left, job->node_tasks);\n\n\tfor (i = 0; i < tasks_left; ) {\n\t\tint rc;\n\t\trc = _wait_for_any_task(job, true);\n\t\tif (rc != -1) {\n\t\t\ti += rc;\n\t\t\tif (i < tasks_left) {\n\t\t\t\t/* To limit the amount of traffic back\n\t\t\t\t * we will sleep a bit to make sure we\n\t\t\t\t * have most if not all the tasks\n\t\t\t\t * completed before we return */\n\t\t\t\tusleep(100000);\t/* 100 msec */\n\t\t\t\trc = _wait_for_any_task(job, false);\n\t\t\t\tif (rc != -1)\n\t\t\t\t\ti += rc;\n\t\t\t}\n\t\t}\n\n\t\tif (i < tasks_left) {\n\t\t\t/* Send partial completion message only.\n\t\t\t * The full completion message can only be sent\n\t\t\t * after resetting CPU frequencies */\n\t\t\twhile (_send_pending_exit_msgs(job)) {;}\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "_wait_for_any_task",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1969-2069",
    "snippet": "static int\n_wait_for_any_task(stepd_step_rec_t *job, bool waitflag)\n{\n\tstepd_step_task_info_t *t = NULL;\n\tint status = 0;\n\tpid_t pid;\n\tint completed = 0;\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tchar **tmp_env;\n\n\tdo {\n\t\tpid = wait3(&status, waitflag ? 0 : WNOHANG, &rusage);\n\t\tif (pid == -1) {\n\t\t\tif (errno == ECHILD) {\n\t\t\t\tdebug(\"No child processes\");\n\t\t\t\tif (completed == 0)\n\t\t\t\t\tcompleted = -1;\n\t\t\t\tbreak;\n\t\t\t} else if (errno == EINTR) {\n\t\t\t\tdebug(\"wait3 was interrupted\");\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tdebug(\"Unknown errno %d\", errno);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t} else if (pid == 0) { /* WNOHANG and no pids available */\n\t\t\tbreak;\n\t\t}\n\n\t\t/************* acct stuff ********************/\n\t\tjobacct = jobacct_gather_remove_task(pid);\n\t\tif (jobacct) {\n\t\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\t\t/* Since we currently don't track energy\n\t\t\t   usage per task (only per step).  We take\n\t\t\t   into account only the last poll of the last task.\n\t\t\t   Odds are it is the only one with\n\t\t\t   information anyway, but just to be safe we\n\t\t\t   will zero out the previous value since this\n\t\t\t   one will over ride it.\n\t\t\t   If this ever changes in the future this logic\n\t\t\t   will need to change.\n\t\t\t*/\n\t\t\tif (jobacct->energy.consumed_energy)\n\t\t\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\t\tjobacctinfo_destroy(jobacct);\n\t\t}\n\t\tacct_gather_profile_g_task_end(pid);\n\t\t/*********************************************/\n\n\t\tif ((t = job_task_info_by_pid(job, pid))) {\n\t\t\tcompleted++;\n\t\t\t_log_task_exit(t->gtid, pid, status);\n\t\t\tt->exited  = true;\n\t\t\tt->estatus = status;\n\t\t\tjob->envtp->procid = t->gtid;\n\t\t\tjob->envtp->localid = t->id;\n\t\t\tjob->envtp->distribution = -1;\n\t\t\tjob->envtp->batch_flag = job->batch;\n\n\t\t\t/* Modify copy of job's environment. Do not alter in\n\t\t\t * place or concurrent searches of the environment can\n\t\t\t * generate invalid memory references. */\n\t\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\t\tsetup_env(job->envtp, false);\n\t\t\ttmp_env = job->env;\n\t\t\tjob->env = job->envtp->env;\n\t\t\tenv_array_free(tmp_env);\n\n\t\t\tif (job->task_epilog) {\n\t\t\t\t_run_script_as_user(\"user task_epilog\",\n\t\t\t\t\t\t    job->task_epilog,\n\t\t\t\t\t\t    job, 5, job->env);\n\t\t\t}\n\t\t\tif (conf->task_epilog) {\n\t\t\t\tchar *my_epilog;\n\t\t\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\t\t\tmy_epilog = xstrdup(conf->task_epilog);\n\t\t\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t\t\t_run_script_as_user(\"slurm task_epilog\",\n\t\t\t\t\t\t    my_epilog,\n\t\t\t\t\t\t    job, -1, job->env);\n\t\t\t\txfree(my_epilog);\n\t\t\t}\n\t\t\tjob->envtp->procid = t->id;\n\n\t\t\tif (spank_task_exit (job, t->id) < 0) {\n\t\t\t\terror (\"Unable to spank task %d at exit\",\n\t\t\t\t       t->id);\n\t\t\t}\n\t\t\ttask_g_post_term(job, t);\n\t\t}\n\n\t} while ((pid > 0) && !waitflag);\n\n\treturn completed;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static int  _wait_for_any_task(stepd_step_rec_t *job, bool waitflag);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "task_g_post_term",
          "args": [
            "job",
            "t"
          ],
          "line": 2063
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_post_term",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "389-403",
          "snippet": "extern int task_g_post_term(stepd_step_rec_t *job,\n\t\t     stepd_step_task_info_t *task)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].post_term))(job, task);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_post_term(stepd_step_rec_t *job,\n\t\t     stepd_step_task_info_t *task)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].post_term))(job, task);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to spank task %d at exit\"",
            "t->id"
          ],
          "line": 2060
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spank_task_exit",
          "args": [
            "job",
            "t->id"
          ],
          "line": 2059
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "my_epilog"
          ],
          "line": 2055
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_run_script_as_user",
          "args": [
            "\"slurm task_epilog\"",
            "my_epilog",
            "job",
            "-1",
            "job->env"
          ],
          "line": 2052
        },
        "resolved": true,
        "details": {
          "function_name": "_run_script_as_user",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2778-2891",
          "snippet": "int\n_run_script_as_user(const char *name, const char *path, stepd_step_rec_t *job,\n\t\t    int max_wait, char **env)\n{\n\tint status, rc, opt;\n\tpid_t cpid;\n\tstruct exec_wait_info *ei;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (_access(path, 5, job->uid, job->gid) < 0) {\n\t\terror(\"Could not run %s [%s]: access denied\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((ei = _fork_child_with_wait_info(0)) == NULL) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = _exec_wait_get_pid (ei)) == 0) {\n\t\tstruct priv_state sprivs;\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif ((job->jobid != 0) &&\t/* Ignore system processes */\n\t\t    (container_g_add_pid(job->jobid, getpid(), job->uid)\n\t\t     != SLURM_SUCCESS))\n\t\t\terror(\"container_g_add_pid(%u): %m\", job->jobid);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n\t\tsprivs.gid_list = NULL;\t/* initialize to prevent xfree */\n\t\tif (_drop_privileges(job, true, &sprivs, false) < 0) {\n\t\t\terror(\"run_script_as_user _drop_privileges: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (_become_user(job, &sprivs) < 0) {\n\t\t\terror(\"run_script_as_user _become_user failed: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (chdir(job->cwd) == -1)\n\t\t\terror(\"run_script_as_user: couldn't \"\n\t\t\t      \"change working dir to %s: %m\", job->cwd);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\t/*\n\t\t *  Wait for signal from parent\n\t\t */\n\t\t_exec_wait_child_wait_for_parent (ei);\n\n\t\twhile (1) {\n\t\t\texecve(path, argv, env);\n\t\t\terror(\"execve(%s): %m\", path);\n\t\t\tif ((errno == ENFILE) || (errno == ENOMEM)) {\n\t\t\t\t/* System limit on open files or memory reached,\n\t\t\t\t * retry after short delay */\n\t\t\t\tsleep(1);\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\texit(127);\n\t}\n\n\tif (exec_wait_signal_child (ei) < 0)\n\t\terror (\"run_script_as_user: Failed to wakeup %s\", name);\n\t_exec_wait_info_destroy (ei);\n\n\tif (max_wait < 0)\n\t\topt = 0;\n\telse\n\t\topt = WNOHANG;\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, opt);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\tstatus = 0;\n\t\t\tbreak;\n\t\t} else if (rc == 0) {\n\t\t\tsleep(1);\n\t\t\tif ((--max_wait) <= 0) {\n\t\t\t\tkillpg(cpid, SIGKILL);\n\t\t\t\topt = 0;\n\t\t\t}\n\t\t} else  {\n\t\t\t/* spawned process exited */\n\t\t\tbreak;\n\t\t}\n\t}\n\t/* Insure that all child processes get killed, one last time */\n\tkillpg(cpid, SIGKILL);\n\n\treturn status;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nint\n_run_script_as_user(const char *name, const char *path, stepd_step_rec_t *job,\n\t\t    int max_wait, char **env)\n{\n\tint status, rc, opt;\n\tpid_t cpid;\n\tstruct exec_wait_info *ei;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (_access(path, 5, job->uid, job->gid) < 0) {\n\t\terror(\"Could not run %s [%s]: access denied\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((ei = _fork_child_with_wait_info(0)) == NULL) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = _exec_wait_get_pid (ei)) == 0) {\n\t\tstruct priv_state sprivs;\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif ((job->jobid != 0) &&\t/* Ignore system processes */\n\t\t    (container_g_add_pid(job->jobid, getpid(), job->uid)\n\t\t     != SLURM_SUCCESS))\n\t\t\terror(\"container_g_add_pid(%u): %m\", job->jobid);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n\t\tsprivs.gid_list = NULL;\t/* initialize to prevent xfree */\n\t\tif (_drop_privileges(job, true, &sprivs, false) < 0) {\n\t\t\terror(\"run_script_as_user _drop_privileges: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (_become_user(job, &sprivs) < 0) {\n\t\t\terror(\"run_script_as_user _become_user failed: %m\");\n\t\t\t/* child process, should not return */\n\t\t\texit(127);\n\t\t}\n\n\t\tif (chdir(job->cwd) == -1)\n\t\t\terror(\"run_script_as_user: couldn't \"\n\t\t\t      \"change working dir to %s: %m\", job->cwd);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\t/*\n\t\t *  Wait for signal from parent\n\t\t */\n\t\t_exec_wait_child_wait_for_parent (ei);\n\n\t\twhile (1) {\n\t\t\texecve(path, argv, env);\n\t\t\terror(\"execve(%s): %m\", path);\n\t\t\tif ((errno == ENFILE) || (errno == ENOMEM)) {\n\t\t\t\t/* System limit on open files or memory reached,\n\t\t\t\t * retry after short delay */\n\t\t\t\tsleep(1);\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\texit(127);\n\t}\n\n\tif (exec_wait_signal_child (ei) < 0)\n\t\terror (\"run_script_as_user: Failed to wakeup %s\", name);\n\t_exec_wait_info_destroy (ei);\n\n\tif (max_wait < 0)\n\t\topt = 0;\n\telse\n\t\topt = WNOHANG;\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, opt);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\tstatus = 0;\n\t\t\tbreak;\n\t\t} else if (rc == 0) {\n\t\t\tsleep(1);\n\t\t\tif ((--max_wait) <= 0) {\n\t\t\t\tkillpg(cpid, SIGKILL);\n\t\t\t\topt = 0;\n\t\t\t}\n\t\t} else  {\n\t\t\t/* spawned process exited */\n\t\t\tbreak;\n\t\t}\n\t}\n\t/* Insure that all child processes get killed, one last time */\n\tkillpg(cpid, SIGKILL);\n\n\treturn status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&conf->config_mutex"
          ],
          "line": 2051
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "conf->task_epilog"
          ],
          "line": 2050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&conf->config_mutex"
          ],
          "line": 2049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_array_free",
          "args": [
            "tmp_env"
          ],
          "line": 2040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_env",
          "args": [
            "job->envtp",
            "false"
          ],
          "line": 2037
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_array_copy",
          "args": [
            "(const char **) job->env"
          ],
          "line": 2036
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_log_task_exit",
          "args": [
            "t->gtid",
            "pid",
            "status"
          ],
          "line": 2025
        },
        "resolved": true,
        "details": {
          "function_name": "_log_task_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1929-1957",
          "snippet": "static inline void\n_log_task_exit(unsigned long taskid, unsigned long pid, int status)\n{\n\t/*\n\t *  Print a nice message to the log describing the task exit status.\n\t *\n\t *  The final else is there just in case there is ever an exit status\n\t *   that isn't WIFEXITED || WIFSIGNALED. We'll probably never reach\n\t *   that code, but it is better than dropping a potentially useful\n\t *   exit status.\n\t */\n\tif (WIFEXITED(status)) {\n\t\tverbose(\"task %lu (%lu) exited with exit code %d.\",\n\t\t\ttaskid, pid, WEXITSTATUS(status));\n\t} else if (WIFSIGNALED(status)) {\n\t\t/* WCOREDUMP isn't available on AIX */\n\t\tverbose(\"task %lu (%lu) exited. Killed by signal %d%s.\",\n\t\t\ttaskid, pid, WTERMSIG(status),\n#ifdef WCOREDUMP\n\t\t\tWCOREDUMP(status) ? \" (core dumped)\" : \"\"\n#else\n\t\t\t\"\"\n#endif\n\t\t\t);\n\t} else {\n\t\tverbose(\"task %lu (%lu) exited with status 0x%04x.\",\n\t\t\ttaskid, pid, status);\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\n\nstatic inline void\n_log_task_exit(unsigned long taskid, unsigned long pid, int status)\n{\n\t/*\n\t *  Print a nice message to the log describing the task exit status.\n\t *\n\t *  The final else is there just in case there is ever an exit status\n\t *   that isn't WIFEXITED || WIFSIGNALED. We'll probably never reach\n\t *   that code, but it is better than dropping a potentially useful\n\t *   exit status.\n\t */\n\tif (WIFEXITED(status)) {\n\t\tverbose(\"task %lu (%lu) exited with exit code %d.\",\n\t\t\ttaskid, pid, WEXITSTATUS(status));\n\t} else if (WIFSIGNALED(status)) {\n\t\t/* WCOREDUMP isn't available on AIX */\n\t\tverbose(\"task %lu (%lu) exited. Killed by signal %d%s.\",\n\t\t\ttaskid, pid, WTERMSIG(status),\n#ifdef WCOREDUMP\n\t\t\tWCOREDUMP(status) ? \" (core dumped)\" : \"\"\n#else\n\t\t\t\"\"\n#endif\n\t\t\t);\n\t} else {\n\t\tverbose(\"task %lu (%lu) exited with status 0x%04x.\",\n\t\t\ttaskid, pid, status);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "job_task_info_by_pid",
          "args": [
            "job",
            "pid"
          ],
          "line": 2023
        },
        "resolved": true,
        "details": {
          "function_name": "job_task_info_by_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.h",
          "lines": "266-279",
          "snippet": "static inline stepd_step_task_info_t *\njob_task_info_by_pid (stepd_step_rec_t *job, pid_t pid)\n{\n\tuint32_t i;\n\n\tif (!job)\n\t\treturn NULL;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tif (job->task[i]->pid == pid)\n\t\t\treturn (job->task[i]);\n\t}\n\treturn (NULL);\n}",
          "includes": [
            "#include \"src/common/stepd_api.h\"",
            "#include \"src/common/job_options.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/slurm_protocol_defs.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/macros.h\"",
            "#include <pwd.h>",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/common/stepd_api.h\"\n#include \"src/common/job_options.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/env.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/list.h\"\n#include \"src/common/slurm_protocol_defs.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/macros.h\"\n#include <pwd.h>\n#include <pthread.h>\n\nstatic inline stepd_step_task_info_t *\njob_task_info_by_pid (stepd_step_rec_t *job, pid_t pid)\n{\n\tuint32_t i;\n\n\tif (!job)\n\t\treturn NULL;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tif (job->task[i]->pid == pid)\n\t\t\treturn (job->task[i]);\n\t}\n\treturn (NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_task_end",
          "args": [
            "pid"
          ],
          "line": 2020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_destroy",
          "args": [
            "jobacct"
          ],
          "line": 2018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_aggregate",
          "args": [
            "job->jobacct",
            "jobacct"
          ],
          "line": 2017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_setinfo",
          "args": [
            "jobacct",
            "JOBACCT_DATA_RUSAGE",
            "&rusage",
            "SLURM_PROTOCOL_VERSION"
          ],
          "line": 2002
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_remove_task",
          "args": [
            "pid"
          ],
          "line": 2000
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Unknown errno %d\"",
            "errno"
          ],
          "line": 1992
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_wake_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "187-199",
          "snippet": "void pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"wait3 was interrupted\""
          ],
          "line": 1989
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_stop_current",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "120-139",
          "snippet": "void\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "wait3",
          "args": [
            "&status",
            "waitflag ? 0 : WNOHANG",
            "&rusage"
          ],
          "line": 1981
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic int  _wait_for_any_task(stepd_step_rec_t *job, bool waitflag);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_wait_for_any_task(stepd_step_rec_t *job, bool waitflag)\n{\n\tstepd_step_task_info_t *t = NULL;\n\tint status = 0;\n\tpid_t pid;\n\tint completed = 0;\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tchar **tmp_env;\n\n\tdo {\n\t\tpid = wait3(&status, waitflag ? 0 : WNOHANG, &rusage);\n\t\tif (pid == -1) {\n\t\t\tif (errno == ECHILD) {\n\t\t\t\tdebug(\"No child processes\");\n\t\t\t\tif (completed == 0)\n\t\t\t\t\tcompleted = -1;\n\t\t\t\tbreak;\n\t\t\t} else if (errno == EINTR) {\n\t\t\t\tdebug(\"wait3 was interrupted\");\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tdebug(\"Unknown errno %d\", errno);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t} else if (pid == 0) { /* WNOHANG and no pids available */\n\t\t\tbreak;\n\t\t}\n\n\t\t/************* acct stuff ********************/\n\t\tjobacct = jobacct_gather_remove_task(pid);\n\t\tif (jobacct) {\n\t\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\t\t/* Since we currently don't track energy\n\t\t\t   usage per task (only per step).  We take\n\t\t\t   into account only the last poll of the last task.\n\t\t\t   Odds are it is the only one with\n\t\t\t   information anyway, but just to be safe we\n\t\t\t   will zero out the previous value since this\n\t\t\t   one will over ride it.\n\t\t\t   If this ever changes in the future this logic\n\t\t\t   will need to change.\n\t\t\t*/\n\t\t\tif (jobacct->energy.consumed_energy)\n\t\t\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\t\tjobacctinfo_destroy(jobacct);\n\t\t}\n\t\tacct_gather_profile_g_task_end(pid);\n\t\t/*********************************************/\n\n\t\tif ((t = job_task_info_by_pid(job, pid))) {\n\t\t\tcompleted++;\n\t\t\t_log_task_exit(t->gtid, pid, status);\n\t\t\tt->exited  = true;\n\t\t\tt->estatus = status;\n\t\t\tjob->envtp->procid = t->gtid;\n\t\t\tjob->envtp->localid = t->id;\n\t\t\tjob->envtp->distribution = -1;\n\t\t\tjob->envtp->batch_flag = job->batch;\n\n\t\t\t/* Modify copy of job's environment. Do not alter in\n\t\t\t * place or concurrent searches of the environment can\n\t\t\t * generate invalid memory references. */\n\t\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\t\tsetup_env(job->envtp, false);\n\t\t\ttmp_env = job->env;\n\t\t\tjob->env = job->envtp->env;\n\t\t\tenv_array_free(tmp_env);\n\n\t\t\tif (job->task_epilog) {\n\t\t\t\t_run_script_as_user(\"user task_epilog\",\n\t\t\t\t\t\t    job->task_epilog,\n\t\t\t\t\t\t    job, 5, job->env);\n\t\t\t}\n\t\t\tif (conf->task_epilog) {\n\t\t\t\tchar *my_epilog;\n\t\t\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\t\t\tmy_epilog = xstrdup(conf->task_epilog);\n\t\t\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t\t\t_run_script_as_user(\"slurm task_epilog\",\n\t\t\t\t\t\t    my_epilog,\n\t\t\t\t\t\t    job, -1, job->env);\n\t\t\t\txfree(my_epilog);\n\t\t\t}\n\t\t\tjob->envtp->procid = t->id;\n\n\t\t\tif (spank_task_exit (job, t->id) < 0) {\n\t\t\t\terror (\"Unable to spank task %d at exit\",\n\t\t\t\t       t->id);\n\t\t\t}\n\t\t\ttask_g_post_term(job, t);\n\t\t}\n\n\t} while ((pid > 0) && !waitflag);\n\n\treturn completed;\n}"
  },
  {
    "function_name": "_log_task_exit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1929-1957",
    "snippet": "static inline void\n_log_task_exit(unsigned long taskid, unsigned long pid, int status)\n{\n\t/*\n\t *  Print a nice message to the log describing the task exit status.\n\t *\n\t *  The final else is there just in case there is ever an exit status\n\t *   that isn't WIFEXITED || WIFSIGNALED. We'll probably never reach\n\t *   that code, but it is better than dropping a potentially useful\n\t *   exit status.\n\t */\n\tif (WIFEXITED(status)) {\n\t\tverbose(\"task %lu (%lu) exited with exit code %d.\",\n\t\t\ttaskid, pid, WEXITSTATUS(status));\n\t} else if (WIFSIGNALED(status)) {\n\t\t/* WCOREDUMP isn't available on AIX */\n\t\tverbose(\"task %lu (%lu) exited. Killed by signal %d%s.\",\n\t\t\ttaskid, pid, WTERMSIG(status),\n#ifdef WCOREDUMP\n\t\t\tWCOREDUMP(status) ? \" (core dumped)\" : \"\"\n#else\n\t\t\t\"\"\n#endif\n\t\t\t);\n\t} else {\n\t\tverbose(\"task %lu (%lu) exited with status 0x%04x.\",\n\t\t\ttaskid, pid, status);\n\t}\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"task %lu (%lu) exited with status 0x%04x.\"",
            "taskid",
            "pid",
            "status"
          ],
          "line": 1954
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"task %lu (%lu) exited. Killed by signal %d%s.\"",
            "taskid",
            "pid",
            "WTERMSIG(status)",
            "#ifdef WCOREDUMPWCOREDUMP(status) ? \" (core dumped)\" : \"\"\n#else\n\t\t\t\"\"#endif"
          ],
          "line": 1945
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WCOREDUMP",
          "args": [
            "status"
          ],
          "line": 1948
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WTERMSIG",
          "args": [
            "status"
          ],
          "line": 1946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WIFSIGNALED",
          "args": [
            "status"
          ],
          "line": 1943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"task %lu (%lu) exited with exit code %d.\"",
            "taskid",
            "pid",
            "WEXITSTATUS(status)"
          ],
          "line": 1941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WEXITSTATUS",
          "args": [
            "status"
          ],
          "line": 1942
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WIFEXITED",
          "args": [
            "status"
          ],
          "line": 1940
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\n\nstatic inline void\n_log_task_exit(unsigned long taskid, unsigned long pid, int status)\n{\n\t/*\n\t *  Print a nice message to the log describing the task exit status.\n\t *\n\t *  The final else is there just in case there is ever an exit status\n\t *   that isn't WIFEXITED || WIFSIGNALED. We'll probably never reach\n\t *   that code, but it is better than dropping a potentially useful\n\t *   exit status.\n\t */\n\tif (WIFEXITED(status)) {\n\t\tverbose(\"task %lu (%lu) exited with exit code %d.\",\n\t\t\ttaskid, pid, WEXITSTATUS(status));\n\t} else if (WIFSIGNALED(status)) {\n\t\t/* WCOREDUMP isn't available on AIX */\n\t\tverbose(\"task %lu (%lu) exited. Killed by signal %d%s.\",\n\t\t\ttaskid, pid, WTERMSIG(status),\n#ifdef WCOREDUMP\n\t\t\tWCOREDUMP(status) ? \" (core dumped)\" : \"\"\n#else\n\t\t\t\"\"\n#endif\n\t\t\t);\n\t} else {\n\t\tverbose(\"task %lu (%lu) exited with status 0x%04x.\",\n\t\t\ttaskid, pid, status);\n\t}\n}"
  },
  {
    "function_name": "_send_pending_exit_msgs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1890-1927",
    "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "tid"
          ],
          "line": 1924
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_send_exit_msg",
          "args": [
            "job",
            "tid",
            "nsent",
            "status"
          ],
          "line": 1922
        },
        "resolved": true,
        "details": {
          "function_name": "_send_exit_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "684-732",
          "snippet": "static int\n_send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n, int status)\n{\n\tslurm_msg_t     resp;\n\ttask_exit_msg_t msg;\n\tListIterator    i       = NULL;\n\tsrun_info_t    *srun    = NULL;\n\n\tdebug3(\"sending task exit msg for %d tasks status %d\", n, status);\n\n\tmsg.task_id_list\t= tid;\n\tmsg.num_tasks\t\t= n;\n\tmsg.return_code\t\t= status;\n\tmsg.job_id\t\t= job->jobid;\n\tmsg.step_id\t\t= job->stepid;\n\tslurm_msg_t_init(&resp);\n\tresp.data\t\t= &msg;\n\tresp.msg_type\t\t= MESSAGE_TASK_EXIT;\n\n\t/*\n\t *  Hack for TCP timeouts on exit of large, synchronized job\n\t *  termination. Delay a random amount if job->nnodes > 500\n\t */\n\tif (job->nnodes > 500)\n\t\t_random_sleep(job);\n\n\t/*\n\t * Notify each srun and sattach.\n\t * No message for poe or batch jobs\n\t */\n\ti = list_iterator_create(job->sruns);\n\twhile ((srun = list_next(i))) {\n\t\tresp.address = srun->resp_addr;\n\t\tif ((resp.address.sin_family == 0) &&\n\t\t    (resp.address.sin_port == 0)   &&\n\t\t    (resp.address.sin_addr.s_addr == 0))\n\t\t\tcontinue;\t/* no srun or sattach here */\n\n\t\t/* This should always be set to something else we have a bug. */\n\t\txassert(srun->protocol_version);\n\t\tresp.protocol_version = srun->protocol_version;\n\n\t\tif (_send_srun_resp_msg(&resp, job->nnodes) != SLURM_SUCCESS)\n\t\t\terror(\"Failed to send MESSAGE_TASK_EXIT: %m\");\n\t}\n\tlist_iterator_destroy(i);\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n, int status)\n{\n\tslurm_msg_t     resp;\n\ttask_exit_msg_t msg;\n\tListIterator    i       = NULL;\n\tsrun_info_t    *srun    = NULL;\n\n\tdebug3(\"sending task exit msg for %d tasks status %d\", n, status);\n\n\tmsg.task_id_list\t= tid;\n\tmsg.num_tasks\t\t= n;\n\tmsg.return_code\t\t= status;\n\tmsg.job_id\t\t= job->jobid;\n\tmsg.step_id\t\t= job->stepid;\n\tslurm_msg_t_init(&resp);\n\tresp.data\t\t= &msg;\n\tresp.msg_type\t\t= MESSAGE_TASK_EXIT;\n\n\t/*\n\t *  Hack for TCP timeouts on exit of large, synchronized job\n\t *  termination. Delay a random amount if job->nnodes > 500\n\t */\n\tif (job->nnodes > 500)\n\t\t_random_sleep(job);\n\n\t/*\n\t * Notify each srun and sattach.\n\t * No message for poe or batch jobs\n\t */\n\ti = list_iterator_create(job->sruns);\n\twhile ((srun = list_next(i))) {\n\t\tresp.address = srun->resp_addr;\n\t\tif ((resp.address.sin_family == 0) &&\n\t\t    (resp.address.sin_port == 0)   &&\n\t\t    (resp.address.sin_addr.s_addr == 0))\n\t\t\tcontinue;\t/* no srun or sattach here */\n\n\t\t/* This should always be set to something else we have a bug. */\n\t\txassert(srun->protocol_version);\n\t\tresp.protocol_version = srun->protocol_version;\n\n\t\tif (_send_srun_resp_msg(&resp, job->nnodes) != SLURM_SUCCESS)\n\t\t\terror(\"Failed to send MESSAGE_TASK_EXIT: %m\");\n\t}\n\tlist_iterator_destroy(i);\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Aggregated %d task exit messages\"",
            "nsent"
          ],
          "line": 1921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(uint32_t) * job->node_tasks"
          ],
          "line": 1903
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
  },
  {
    "function_name": "_fork_all_tasks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1588-1882",
    "snippet": "static int\n_fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized)\n{\n\tint rc = SLURM_SUCCESS;\n\tint i;\n\tstruct priv_state sprivs;\n\tjobacct_id_t jobacct_id;\n\tchar *oom_value;\n\tList exec_wait_list = NULL;\n\tchar *esc;\n\n\txassert(job != NULL);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"Failed to invoke task plugins: one of task_p_pre_setuid functions returned error\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/* Temporarily drop effective privileges, except for the euid.\n\t * We need to wait until after pam_setup() to drop euid.\n\t */\n\tif (_drop_privileges (job, false, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (pam_setup(job->user_name, conf->hostname)\n\t    != SLURM_SUCCESS){\n\t\terror (\"error in pam_setup\");\n\t\trc = SLURM_ERROR;\n\t}\n\n\t/*\n\t * Reclaim privileges to do the io setup\n\t */\n\t_reclaim_privileges (&sprivs);\n\tif (rc)\n\t\tgoto fail1; /* pam_setup error */\n\n\tset_umask(job);\t\t/* set umask for stdout/err files */\n\tif (job->user_managed_io)\n\t\trc = _setup_user_managed_io(job);\n\telse\n\t\trc = _setup_normal_io(job);\n\t/*\n\t * Initialize log facility to copy errors back to srun\n\t */\n\tif (!rc)\n\t\trc = _slurmd_job_log_init(job);\n\n\tif (rc) {\n\t\terror(\"IO setup failed: %m\");\n\t\tjob->task[0]->estatus = 0x0100;\n\t\tstep_complete.step_rc = 0x0100;\n\t\tif (job->batch)\n\t\t\trc = SLURM_SUCCESS;\t/* drains node otherwise */\n\t\tgoto fail1;\n\t} else {\n\t\t*io_initialized = true;\n\t}\n\n\t/*\n\t * Temporarily drop effective privileges\n\t */\n\tif (_drop_privileges (job, true, &sprivs, true) < 0) {\n\t\terror (\"_drop_privileges: %m\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail2;\n\t}\n\n\t/* If there is an \\ in the path\n\t * remove it.\n\t */\n\tesc = is_path_escaped(job->cwd);\n\tif (esc) {\n\t\txfree(job->cwd);\n\t\tjob->cwd = esc;\n\t}\n\n\tif (chdir(job->cwd) < 0) {\n\t\terror(\"couldn't chdir to `%s': %m: going to /tmp instead\",\n\t\t      job->cwd);\n\t\tif (chdir(\"/tmp\") < 0) {\n\t\t\terror(\"couldn't chdir to /tmp either. dying.\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail3;\n\t\t}\n\t}\n\n\tif (spank_user (job) < 0) {\n\t\terror(\"spank_user failed.\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\texec_wait_list = list_create ((ListDelF) _exec_wait_info_destroy);\n\tif (!exec_wait_list) {\n\t\terror (\"Unable to create exec_wait_list\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\t/*\n\t * Fork all of the task processes.\n\t */\n\tverbose(\"starting %u tasks\", job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tchar time_stamp[256];\n\t\tpid_t pid;\n\t\tstruct exec_wait_info *ei;\n\n\t\tacct_gather_profile_g_task_start(i);\n\t\tif ((ei = _fork_child_with_wait_info (i)) == NULL) {\n\t\t\terror(\"child fork: %m\");\n\t\t\texec_wait_kill_children (exec_wait_list);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail4;\n\t\t} else if ((pid = _exec_wait_get_pid (ei)) == 0)  { /* child */\n\t\t\t/*\n\t\t\t *  Destroy exec_wait_list in the child.\n\t\t\t *   Only exec_wait_info for previous tasks have been\n\t\t\t *   added to the list so far, so everything else\n\t\t\t *   can be discarded.\n\t\t\t */\n\t\t\tFREE_NULL_LIST (exec_wait_list);\n\n#ifdef HAVE_AIX\n\t\t\t(void) mkcrid(0);\n#endif\n\t\t\t/* jobacctinfo_endpoll();\n\t\t\t * closing jobacct files here causes deadlock */\n\n\t\t\tif (conf->propagate_prio)\n\t\t\t\t_set_prio_process(job);\n\n\t\t\t/*\n\t\t\t *  Reclaim privileges and call any plugin hooks\n\t\t\t *  that may require elevated privs\n\t\t\t *  sprivs.gid_list is already set from the\n\t\t\t *  _drop_privileges call above, no not reinitialize.\n\t\t\t */\n\t\t\tif (_pre_task_privileged(job, i, &sprivs) < 0)\n\t\t\t\texit(1);\n\n \t\t\tif (_become_user(job, &sprivs) < 0) {\n \t\t\t\terror(\"_become_user failed: %m\");\n\t\t\t\t/* child process, should not return */\n\t\t\t\texit(1);\n \t\t\t}\n\n\t\t\t/* log_fini(); */ /* note: moved into exec_task() */\n\n\t\t\t_unblock_signals();\n\n\t\t\t/*\n\t\t\t *  Need to setup stdio before setpgid() is called\n\t\t\t *   in case we are setting up a tty. (login_tty()\n\t\t\t *   must be called before setpgid() or it is\n\t\t\t *   effectively disabled).\n\t\t\t */\n\t\t\tprepare_stdio (job, job->task[i]);\n\n\t\t\t/* Close profiling file descriptors */\n\t\t\tacct_gather_profile_g_child_forked();\n\n\t\t\t/*\n\t\t\t *  Block until parent notifies us that it is ok to\n\t\t\t *   proceed. This allows the parent to place all\n\t\t\t *   children in any process groups or containers\n\t\t\t *   before they make a call to exec(2).\n\t\t\t */\n\t\t\tif (_exec_wait_child_wait_for_parent (ei) < 0)\n\t\t\t\texit (1);\n\n\t\t\texec_task(job, i);\n\t\t}\n\n\t\t/*\n\t\t * Parent continues:\n\t\t */\n\n\t\tlist_append (exec_wait_list, ei);\n\n\t\tlog_timestamp(time_stamp, sizeof(time_stamp));\n\t\tverbose(\"task %lu (%lu) started %s\",\n\t\t\t(unsigned long) job->task[i]->gtid,\n\t\t\t(unsigned long) pid, time_stamp);\n\n\t\tjob->task[i]->pid = pid;\n\t\tif (i == 0)\n\t\t\tjob->pgid = pid;\n\t}\n\n\t/*\n\t * All tasks are now forked and running as the user, but\n\t * will wait for our signal before calling exec.\n\t */\n\n\t/*\n\t * Reclaim privileges\n\t */\n\tif (_reclaim_privileges (&sprivs) < 0) {\n\t\terror (\"Unable to reclaim privileges\");\n\t\t/* Don't bother erroring out here */\n\t}\n\n\tif ((oom_value = getenv(\"SLURMSTEPD_OOM_ADJ\"))) {\n\t\tint i = atoi(oom_value);\n\t\tdebug(\"Setting slurmstepd oom_adj to %d\", i);\n\t\tset_oom_adj(i);\n\t}\n\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Put this task in the step process group\n\t\t * login_tty() must put task zero in its own\n\t\t * session, causing setpgid() to fail, setsid()\n\t\t * has already set its process group as desired\n\t\t */\n\t\tif ((job->pty == 0)\n\t\t    &&  (setpgid (job->task[i]->pid, job->pgid) < 0)) {\n\t\t\terror(\"Unable to put task %d (pid %d) into \"\n\t\t\t      \"pgrp %d: %m\",\n\t\t\t      i,\n\t\t\t      job->task[i]->pid,\n\t\t\t      job->pgid);\n\t\t}\n\n\t\tif (proctrack_g_add(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\terror(\"proctrack_g_add: %m\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t\tjobacct_id.nodeid = job->nodeid;\n\t\tjobacct_id.taskid = job->task[i]->gtid;\n\t\tjobacct_id.job    = job;\n\t\tif (i == (job->node_tasks - 1)) {\n\t\t\t/* start polling on the last task */\n\t\t\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t1);\n\t\t} else {\n\t\t\t/* don't poll yet */\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t0);\n\t\t}\n\t\tif (spank_task_post_fork (job, i) < 0) {\n\t\t\terror (\"spank task %d post-fork failed\", i);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n//\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tif (container_g_add_cont(job->jobid, job->cont_id) != SLURM_SUCCESS)\n\t\terror(\"container_g_add_cont(%u): %m\", job->jobid);\n\tif (!job->batch && core_spec_g_set(job->cont_id, job->job_core_spec))\n\t\terror(\"core_spec_g_set: %m\");\n\n\t/*\n\t * Now it's ok to unblock the tasks, so they may call exec.\n\t */\n\tlist_for_each (exec_wait_list, (ListForF) exec_wait_signal, job);\n\tFREE_NULL_LIST (exec_wait_list);\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Prepare process for attach by parallel debugger\n\t\t * (if specified and able)\n\t\t */\n\t\tif (pdebug_trace_process(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n\n\treturn rc;\n\nfail4:\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\nfail3:\n\t_reclaim_privileges (&sprivs);\n\tFREE_NULL_LIST (exec_wait_list);\nfail2:\n\tio_close_task_fds(job);\nfail1:\n\tpam_finish();\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static int  _fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static void _unblock_signals(void);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "pam_finish",
          "args": [],
          "line": 1880
        },
        "resolved": true,
        "details": {
          "function_name": "pam_finish",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
          "lines": "173-176",
          "snippet": "void pam_finish ()\n{\n\t/* Don't have PAM support, do nothing. */\n}",
          "includes": [
            "#  include <security/pam_misc.h>",
            "#  include <security/pam_appl.h>",
            "#  include <pam/pam_misc.h>",
            "#  include <pam/pam_appl.h>",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\nvoid pam_finish ()\n{\n\t/* Don't have PAM support, do nothing. */\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_close_task_fds",
          "args": [
            "job"
          ],
          "line": 1878
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_task_fds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1420-1430",
          "snippet": "extern void\nio_close_task_fds(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tclose(job->task[i]->stdin_fd);\n\t\tclose(job->task[i]->stdout_fd);\n\t\tclose(job->task[i]->stderr_fd);\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nextern void\nio_close_task_fds(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tclose(job->task[i]->stdin_fd);\n\t\tclose(job->task[i]->stdout_fd);\n\t\tclose(job->task[i]->stderr_fd);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "FREE_NULL_LIST",
          "args": [
            "exec_wait_list"
          ],
          "line": 1876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_reclaim_privileges",
          "args": [
            "&sprivs"
          ],
          "line": 1875
        },
        "resolved": true,
        "details": {
          "function_name": "_reclaim_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2480-2502",
          "snippet": "static int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to return to working directory\""
          ],
          "line": 1872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "sprivs.saved_cwd"
          ],
          "line": 1871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pdebug_trace_process",
          "args": [
            "job",
            "job->task[i]->pid"
          ],
          "line": 1861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FREE_NULL_LIST",
          "args": [
            "exec_wait_list"
          ],
          "line": 1854
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_for_each",
          "args": [
            "exec_wait_list",
            "(ListForF) exec_wait_signal",
            "job"
          ],
          "line": 1853
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"core_spec_g_set: %m\""
          ],
          "line": 1848
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "core_spec_g_set",
          "args": [
            "job->cont_id",
            "job->job_core_spec"
          ],
          "line": 1847
        },
        "resolved": true,
        "details": {
          "function_name": "core_spec_g_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/core_spec_plugin.c",
          "lines": "176-189",
          "snippet": "extern int core_spec_g_set(uint64_t cont_id, uint16_t core_count)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (core_spec_g_init() != SLURM_SUCCESS)\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_core_spec_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].core_spec_p_set))(cont_id, core_count);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static core_spec_ops_t\t\t*ops = NULL;",
            "static int\t\t\tg_core_spec_context_num = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic core_spec_ops_t\t\t*ops = NULL;\nstatic int\t\t\tg_core_spec_context_num = -1;\n\nextern int core_spec_g_set(uint64_t cont_id, uint16_t core_count)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (core_spec_g_init() != SLURM_SUCCESS)\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_core_spec_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].core_spec_p_set))(cont_id, core_count);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"container_g_add_cont(%u): %m\"",
            "job->jobid"
          ],
          "line": 1846
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "container_g_add_cont",
          "args": [
            "job->jobid",
            "job->cont_id"
          ],
          "line": 1845
        },
        "resolved": true,
        "details": {
          "function_name": "container_g_add_cont",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/job_container_plugin.c",
          "lines": "213-226",
          "snippet": "extern int container_g_add_cont(uint32_t job_id, uint64_t cont_id)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_cont))(job_id, cont_id);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static job_container_ops_t\t*ops = NULL;",
            "static int\t\t\tg_container_context_num = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic job_container_ops_t\t*ops = NULL;\nstatic int\t\t\tg_container_context_num = -1;\n\nextern int container_g_add_cont(uint32_t job_id, uint64_t cont_id)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_cont))(job_id, cont_id);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spank_task_post_fork",
          "args": [
            "job",
            "i"
          ],
          "line": 1838
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_add_task",
          "args": [
            "job->task[i]->pid",
            "&jobacct_id",
            "0"
          ],
          "line": 1835
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_add_task",
          "args": [
            "job->task[i]->pid",
            "&jobacct_id",
            "1"
          ],
          "line": 1831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_set_proctrack_container_id",
          "args": [
            "job->cont_id"
          ],
          "line": 1830
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"proctrack_g_add: %m\""
          ],
          "line": 1821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "proctrack_g_add",
          "args": [
            "job",
            "job->task[i]->pid"
          ],
          "line": 1819
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "180-199",
          "snippet": "extern int proctrack_g_add(stepd_step_rec_t * job, pid_t pid)\n{\n\tint i = 0, max_retry = 3, rc;\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\t/* Sometimes a plugin is transient in adding a pid, so lets\n\t * try a few times before we call it quits.\n\t */\n\twhile ((rc = (*(ops.add)) (job, pid)) != SLURM_SUCCESS) {\n\t\tif (i++ > max_retry)\n\t\t\tbreak;\n\t\tdebug(\"%s: %u.%u couldn't add pid %u, sleeping and trying again\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tsleep(1);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_add(stepd_step_rec_t * job, pid_t pid)\n{\n\tint i = 0, max_retry = 3, rc;\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\t/* Sometimes a plugin is transient in adding a pid, so lets\n\t * try a few times before we call it quits.\n\t */\n\twhile ((rc = (*(ops.add)) (job, pid)) != SLURM_SUCCESS) {\n\t\tif (i++ > max_retry)\n\t\t\tbreak;\n\t\tdebug(\"%s: %u.%u couldn't add pid %u, sleeping and trying again\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tsleep(1);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to put task %d (pid %d) into \"\n\t\t\t      \"pgrp %d: %m\"",
            "i",
            "job->task[i]->pid",
            "job->pgid"
          ],
          "line": 1812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgid",
          "args": [
            "job->task[i]->pid",
            "job->pgid"
          ],
          "line": 1811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to return to working directory\""
          ],
          "line": 1800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "sprivs.saved_cwd"
          ],
          "line": 1799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_oom_adj",
          "args": [
            "i"
          ],
          "line": 1796
        },
        "resolved": true,
        "details": {
          "function_name": "set_oom_adj",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/set_oomadj.c",
          "lines": "93-98",
          "snippet": "extern int set_oom_adj(int adj)\n{\n\t/* FreeBSD does not handle OOM the same way Linux does */\n\t(void) adj; /* unused argument */\n\treturn 0;\n}",
          "includes": [
            "#include \"src/common/log.h\"",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/common/log.h\"\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <errno.h>\n\nextern int set_oom_adj(int adj)\n{\n\t/* FreeBSD does not handle OOM the same way Linux does */\n\t(void) adj; /* unused argument */\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Setting slurmstepd oom_adj to %d\"",
            "i"
          ],
          "line": 1795
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_wake_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "187-199",
          "snippet": "void pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "oom_value"
          ],
          "line": 1794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"SLURMSTEPD_OOM_ADJ\""
          ],
          "line": 1793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to reclaim privileges\""
          ],
          "line": 1789
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"task %lu (%lu) started %s\"",
            "(unsigned long) job->task[i]->gtid",
            "(unsigned long) pid",
            "time_stamp"
          ],
          "line": 1771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_timestamp",
          "args": [
            "time_stamp",
            "sizeof(time_stamp)"
          ],
          "line": 1770
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_append",
          "args": [
            "exec_wait_list",
            "ei"
          ],
          "line": 1768
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exec_task",
          "args": [
            "job",
            "i"
          ],
          "line": 1761
        },
        "resolved": true,
        "details": {
          "function_name": "exec_task",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "360-530",
          "snippet": "void\nexec_task(stepd_step_rec_t *job, int i)\n{\n\tuint32_t *gtids;\t\t/* pointer to array of ranks */\n\tint fd, j;\n\tstepd_step_task_info_t *task = job->task[i];\n\tchar **tmp_env;\n\tint saved_errno;\n\n\tif (i == 0)\n\t\t_make_tmpdir(job);\n\n\tgtids = xmalloc(job->node_tasks * sizeof(uint32_t));\n\tfor (j = 0; j < job->node_tasks; j++)\n\t\tgtids[j] = job->task[j]->gtid;\n\tjob->envtp->sgtids = _uint32_array_to_str(job->node_tasks, gtids);\n\txfree(gtids);\n\n\tjob->envtp->jobid = job->jobid;\n\tjob->envtp->stepid = job->stepid;\n\tjob->envtp->nodeid = job->nodeid;\n\tjob->envtp->cpus_on_node = job->cpus;\n\tjob->envtp->procid = task->gtid;\n\tjob->envtp->localid = task->id;\n\tjob->envtp->task_pid = getpid();\n\tjob->envtp->distribution = job->task_dist;\n\tjob->envtp->cpu_bind = xstrdup(job->cpu_bind);\n\tjob->envtp->cpu_bind_type = job->cpu_bind_type;\n\tjob->envtp->cpu_freq_min = job->cpu_freq_min;\n\tjob->envtp->cpu_freq_max = job->cpu_freq_max;\n\tjob->envtp->cpu_freq_gov = job->cpu_freq_gov;\n\tjob->envtp->mem_bind = xstrdup(job->mem_bind);\n\tjob->envtp->mem_bind_type = job->mem_bind_type;\n\tjob->envtp->distribution = -1;\n\tjob->envtp->ckpt_dir = xstrdup(job->ckpt_dir);\n\tjob->envtp->batch_flag = job->batch;\n\tjob->envtp->uid = job->uid;\n\tjob->envtp->user_name = xstrdup(job->user_name);\n\n\t/* Modify copy of job's environment. Do not alter in place or\n\t * concurrent searches of the environment can generate invalid memory\n\t * references. */\n\tjob->envtp->env = env_array_copy((const char **) job->env);\n\tsetup_env(job->envtp, false);\n\tsetenvf(&job->envtp->env, \"SLURMD_NODENAME\", \"%s\", conf->node_name);\n\ttmp_env = job->env;\n\tjob->env = job->envtp->env;\n\tenv_array_free(tmp_env);\n\tjob->envtp->env = NULL;\n\n\txfree(job->envtp->task_count);\n\n\tif (task->argv[0] && *task->argv[0] != '/') {\n\t\t/*\n\t\t * Normally the client (srun) expands the command name\n\t\t * to a fully qualified path, but in --multi-prog mode it\n\t\t * is left up to the server to search the PATH for the\n\t\t * executable.\n\t\t */\n\t\ttask->argv[0] = _build_path(task->argv[0], job->env, NULL);\n\t}\n\n\tif (!job->batch) {\n\t\tif (switch_g_job_attach(job->switch_job, &job->env,\n\t\t\t\t\tjob->nodeid, (uint32_t) i, job->nnodes,\n\t\t\t\t\tjob->ntasks, task->gtid) < 0) {\n\t\t\terror(\"Unable to attach to interconnect: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\n\t\tif (_setup_mpi(job, i) != SLURM_SUCCESS) {\n\t\t\terror(\"Unable to configure MPI plugin: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\t}\n\n\t/* task-specific pre-launch activities */\n\n\t/* task plugin hook */\n\tif (task_g_pre_launch(job)) {\n\t\terror(\"Failed to invoke task plugins: task_p_pre_launch error\");\n\t\texit(1);\n\t}\n\tif (!job->batch && job->accel_bind_type) {\n\t\t/* Modify copy of job's environment. Do not alter in place or\n\t\t * concurrent searches of the environment can generate invalid\n\t\t * memory references. */\n\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\tgres_plugin_step_set_env(&job->envtp->env, job->step_gres_list,\n\t\t\t\t\t job->accel_bind_type);\n\t\ttmp_env = job->env;\n\t\tjob->env = job->envtp->env;\n\t\tenv_array_free(tmp_env);\n\t}\n\n\tif (spank_user_task(job, i) < 0) {\n\t\terror(\"Failed to invoke spank plugin stack\");\n\t\texit(1);\n\t}\n\n\tif (conf->task_prolog) {\n\t\tchar *my_prolog;\n\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\tmy_prolog = xstrdup(conf->task_prolog);\n\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t_run_script_and_set_env(\"slurm task_prolog\",\n\t\t\t\t\tmy_prolog, job);\n\t\txfree(my_prolog);\n\t}\n\tif (job->task_prolog) {\n\t\t_run_script_and_set_env(\"user task_prolog\",\n\t\t\t\t\tjob->task_prolog, job);\n\t}\n\n\tif (!job->batch)\n\t\tpdebug_stop_current(job);\n\tif (job->env == NULL) {\n\t\tdebug(\"job->env is NULL\");\n\t\tjob->env = (char **)xmalloc(sizeof(char *));\n\t\tjob->env[0] = (char *)NULL;\n\t}\n\n\tif (job->restart_dir) {\n\t\tinfo(\"restart from %s\", job->restart_dir);\n\t\t/* no return on success */\n\t\tcheckpoint_restart_task(job, job->restart_dir, task->gtid);\n\t\terror(\"Restart task failed: %m\");\n\t\texit(errno);\n\t}\n\n\tif (task->argv[0] == NULL) {\n\t\terror(\"No executable program specified for this task\");\n\t\texit(2);\n\t}\n\n\t/* Do this last so you don't worry too much about the users\n\t   limits including the slurmstepd in with it.\n\t*/\n\tif (set_user_limits(job) < 0) {\n\t\tdebug(\"Unable to set user limits\");\n\t\tlog_fini();\n\t\texit(5);\n\t}\n\n\texecve(task->argv[0], task->argv, job->env);\n\tsaved_errno = errno;\n\n\t/*\n\t * print error message and clean up if execve() returns:\n\t */\n\tif ((errno == ENOENT) &&\n\t    ((fd = open(task->argv[0], O_RDONLY)) >= 0)) {\n\t\tchar buf[256], *eol;\n\t\tint sz;\n\t\tsz = read(fd, buf, sizeof(buf));\n\t\tif ((sz >= 3) && (xstrncmp(buf, \"#!\", 2) == 0)) {\n\t\t\tbuf[sizeof(buf)-1] = '\\0';\n\t\t\teol = strchr(buf, '\\n');\n\t\t\tif (eol)\n\t\t\t\teol[0] = '\\0';\n\t\t\tslurm_seterrno(saved_errno);\n\t\t\terror(\"execve(): bad interpreter(%s): %m\", buf+2);\n\t\t\texit(errno);\n\t\t}\n\t}\n\tslurm_seterrno(saved_errno);\n\terror(\"execve(): %s: %m\", task->argv[0]);\n\texit(errno);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _make_tmpdir(stepd_step_rec_t *job);",
            "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
            "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);",
            "static char *_uint32_array_to_str(int array_len, const uint32_t *array);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\nstatic char *_uint32_array_to_str(int array_len, const uint32_t *array);\n\nvoid\nexec_task(stepd_step_rec_t *job, int i)\n{\n\tuint32_t *gtids;\t\t/* pointer to array of ranks */\n\tint fd, j;\n\tstepd_step_task_info_t *task = job->task[i];\n\tchar **tmp_env;\n\tint saved_errno;\n\n\tif (i == 0)\n\t\t_make_tmpdir(job);\n\n\tgtids = xmalloc(job->node_tasks * sizeof(uint32_t));\n\tfor (j = 0; j < job->node_tasks; j++)\n\t\tgtids[j] = job->task[j]->gtid;\n\tjob->envtp->sgtids = _uint32_array_to_str(job->node_tasks, gtids);\n\txfree(gtids);\n\n\tjob->envtp->jobid = job->jobid;\n\tjob->envtp->stepid = job->stepid;\n\tjob->envtp->nodeid = job->nodeid;\n\tjob->envtp->cpus_on_node = job->cpus;\n\tjob->envtp->procid = task->gtid;\n\tjob->envtp->localid = task->id;\n\tjob->envtp->task_pid = getpid();\n\tjob->envtp->distribution = job->task_dist;\n\tjob->envtp->cpu_bind = xstrdup(job->cpu_bind);\n\tjob->envtp->cpu_bind_type = job->cpu_bind_type;\n\tjob->envtp->cpu_freq_min = job->cpu_freq_min;\n\tjob->envtp->cpu_freq_max = job->cpu_freq_max;\n\tjob->envtp->cpu_freq_gov = job->cpu_freq_gov;\n\tjob->envtp->mem_bind = xstrdup(job->mem_bind);\n\tjob->envtp->mem_bind_type = job->mem_bind_type;\n\tjob->envtp->distribution = -1;\n\tjob->envtp->ckpt_dir = xstrdup(job->ckpt_dir);\n\tjob->envtp->batch_flag = job->batch;\n\tjob->envtp->uid = job->uid;\n\tjob->envtp->user_name = xstrdup(job->user_name);\n\n\t/* Modify copy of job's environment. Do not alter in place or\n\t * concurrent searches of the environment can generate invalid memory\n\t * references. */\n\tjob->envtp->env = env_array_copy((const char **) job->env);\n\tsetup_env(job->envtp, false);\n\tsetenvf(&job->envtp->env, \"SLURMD_NODENAME\", \"%s\", conf->node_name);\n\ttmp_env = job->env;\n\tjob->env = job->envtp->env;\n\tenv_array_free(tmp_env);\n\tjob->envtp->env = NULL;\n\n\txfree(job->envtp->task_count);\n\n\tif (task->argv[0] && *task->argv[0] != '/') {\n\t\t/*\n\t\t * Normally the client (srun) expands the command name\n\t\t * to a fully qualified path, but in --multi-prog mode it\n\t\t * is left up to the server to search the PATH for the\n\t\t * executable.\n\t\t */\n\t\ttask->argv[0] = _build_path(task->argv[0], job->env, NULL);\n\t}\n\n\tif (!job->batch) {\n\t\tif (switch_g_job_attach(job->switch_job, &job->env,\n\t\t\t\t\tjob->nodeid, (uint32_t) i, job->nnodes,\n\t\t\t\t\tjob->ntasks, task->gtid) < 0) {\n\t\t\terror(\"Unable to attach to interconnect: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\n\t\tif (_setup_mpi(job, i) != SLURM_SUCCESS) {\n\t\t\terror(\"Unable to configure MPI plugin: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\t}\n\n\t/* task-specific pre-launch activities */\n\n\t/* task plugin hook */\n\tif (task_g_pre_launch(job)) {\n\t\terror(\"Failed to invoke task plugins: task_p_pre_launch error\");\n\t\texit(1);\n\t}\n\tif (!job->batch && job->accel_bind_type) {\n\t\t/* Modify copy of job's environment. Do not alter in place or\n\t\t * concurrent searches of the environment can generate invalid\n\t\t * memory references. */\n\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\tgres_plugin_step_set_env(&job->envtp->env, job->step_gres_list,\n\t\t\t\t\t job->accel_bind_type);\n\t\ttmp_env = job->env;\n\t\tjob->env = job->envtp->env;\n\t\tenv_array_free(tmp_env);\n\t}\n\n\tif (spank_user_task(job, i) < 0) {\n\t\terror(\"Failed to invoke spank plugin stack\");\n\t\texit(1);\n\t}\n\n\tif (conf->task_prolog) {\n\t\tchar *my_prolog;\n\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\tmy_prolog = xstrdup(conf->task_prolog);\n\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t_run_script_and_set_env(\"slurm task_prolog\",\n\t\t\t\t\tmy_prolog, job);\n\t\txfree(my_prolog);\n\t}\n\tif (job->task_prolog) {\n\t\t_run_script_and_set_env(\"user task_prolog\",\n\t\t\t\t\tjob->task_prolog, job);\n\t}\n\n\tif (!job->batch)\n\t\tpdebug_stop_current(job);\n\tif (job->env == NULL) {\n\t\tdebug(\"job->env is NULL\");\n\t\tjob->env = (char **)xmalloc(sizeof(char *));\n\t\tjob->env[0] = (char *)NULL;\n\t}\n\n\tif (job->restart_dir) {\n\t\tinfo(\"restart from %s\", job->restart_dir);\n\t\t/* no return on success */\n\t\tcheckpoint_restart_task(job, job->restart_dir, task->gtid);\n\t\terror(\"Restart task failed: %m\");\n\t\texit(errno);\n\t}\n\n\tif (task->argv[0] == NULL) {\n\t\terror(\"No executable program specified for this task\");\n\t\texit(2);\n\t}\n\n\t/* Do this last so you don't worry too much about the users\n\t   limits including the slurmstepd in with it.\n\t*/\n\tif (set_user_limits(job) < 0) {\n\t\tdebug(\"Unable to set user limits\");\n\t\tlog_fini();\n\t\texit(5);\n\t}\n\n\texecve(task->argv[0], task->argv, job->env);\n\tsaved_errno = errno;\n\n\t/*\n\t * print error message and clean up if execve() returns:\n\t */\n\tif ((errno == ENOENT) &&\n\t    ((fd = open(task->argv[0], O_RDONLY)) >= 0)) {\n\t\tchar buf[256], *eol;\n\t\tint sz;\n\t\tsz = read(fd, buf, sizeof(buf));\n\t\tif ((sz >= 3) && (xstrncmp(buf, \"#!\", 2) == 0)) {\n\t\t\tbuf[sizeof(buf)-1] = '\\0';\n\t\t\teol = strchr(buf, '\\n');\n\t\t\tif (eol)\n\t\t\t\teol[0] = '\\0';\n\t\t\tslurm_seterrno(saved_errno);\n\t\t\terror(\"execve(): bad interpreter(%s): %m\", buf+2);\n\t\t\texit(errno);\n\t\t}\n\t}\n\tslurm_seterrno(saved_errno);\n\terror(\"execve(): %s: %m\", task->argv[0]);\n\texit(errno);\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 1759
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_exec_wait_child_wait_for_parent",
          "args": [
            "ei"
          ],
          "line": 1758
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_child_wait_for_parent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1488-1496",
          "snippet": "static int _exec_wait_child_wait_for_parent (struct exec_wait_info *e)\n{\n\tchar c;\n\n\tif (read (e->childfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"_exec_wait_child_wait_for_parent: failed: %m\");\n\n\treturn (0);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int _exec_wait_child_wait_for_parent (struct exec_wait_info *e)\n{\n\tchar c;\n\n\tif (read (e->childfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"_exec_wait_child_wait_for_parent: failed: %m\");\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_child_forked",
          "args": [],
          "line": 1750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "prepare_stdio",
          "args": [
            "job",
            "job->task[i]"
          ],
          "line": 1747
        },
        "resolved": true,
        "details": {
          "function_name": "prepare_stdio",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1557-1570",
          "snippet": "static void prepare_stdio (stepd_step_rec_t *job, stepd_step_task_info_t *task)\n{\n#ifdef HAVE_PTY_H\n\tif (job->pty && (task->gtid == 0)) {\n\t\tif (login_tty(task->stdin_fd))\n\t\t\terror(\"login_tty: %m\");\n\t\telse\n\t\t\tdebug3(\"login_tty good\");\n\t\treturn;\n\t}\n#endif\n\tio_dup_stdio(task);\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void prepare_stdio (stepd_step_rec_t *job, stepd_step_task_info_t *task)\n{\n#ifdef HAVE_PTY_H\n\tif (job->pty && (task->gtid == 0)) {\n\t\tif (login_tty(task->stdin_fd))\n\t\t\terror(\"login_tty: %m\");\n\t\telse\n\t\t\tdebug3(\"login_tty good\");\n\t\treturn;\n\t}\n#endif\n\tio_dup_stdio(task);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_unblock_signals",
          "args": [],
          "line": 1739
        },
        "resolved": true,
        "details": {
          "function_name": "_unblock_signals",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1572-1584",
          "snippet": "static void _unblock_signals (void)\n{\n\tsigset_t set;\n\tint i;\n\n\tfor (i = 0; mgr_sigarray[i]; i++) {\n\t\t/* eliminate pending signals, then set to default */\n\t\txsignal(mgr_sigarray[i], SIG_IGN);\n\t\txsignal(mgr_sigarray[i], SIG_DFL);\n\t}\n\tsigemptyset(&set);\n\txsignal_set_mask (&set);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int mgr_sigarray[] = {\n\tSIGINT,  SIGTERM, SIGTSTP,\n\tSIGQUIT, SIGPIPE, SIGUSR1,\n\tSIGUSR2, SIGALRM, SIGHUP, 0\n};",
            "static void _unblock_signals(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int mgr_sigarray[] = {\n\tSIGINT,  SIGTERM, SIGTSTP,\n\tSIGQUIT, SIGPIPE, SIGUSR1,\n\tSIGUSR2, SIGALRM, SIGHUP, 0\n};\nstatic void _unblock_signals(void);\n\nstatic void _unblock_signals (void)\n{\n\tsigset_t set;\n\tint i;\n\n\tfor (i = 0; mgr_sigarray[i]; i++) {\n\t\t/* eliminate pending signals, then set to default */\n\t\txsignal(mgr_sigarray[i], SIG_IGN);\n\t\txsignal(mgr_sigarray[i], SIG_DFL);\n\t}\n\tsigemptyset(&set);\n\txsignal_set_mask (&set);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_become_user failed: %m\""
          ],
          "line": 1732
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_become_user",
          "args": [
            "job",
            "&sprivs"
          ],
          "line": 1731
        },
        "resolved": true,
        "details": {
          "function_name": "_become_user",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2610-2643",
          "snippet": "static int\n_become_user(stepd_step_rec_t *job, struct priv_state *ps)\n{\n\t/*\n\t * First reclaim the effective uid and gid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\treturn SLURM_SUCCESS;\n\n\tif (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"_become_user seteuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setegid(ps->saved_gid) < 0) {\n\t\terror(\"_become_user setegid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/*\n\t * Now drop real, effective, and saved uid/gid\n\t */\n\tif (setregid(job->gid, job->gid) < 0) {\n\t\terror(\"setregid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setreuid(job->uid, job->uid) < 0) {\n\t\terror(\"setreuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_become_user(stepd_step_rec_t *job, struct priv_state *ps)\n{\n\t/*\n\t * First reclaim the effective uid and gid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\treturn SLURM_SUCCESS;\n\n\tif (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"_become_user seteuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setegid(ps->saved_gid) < 0) {\n\t\terror(\"_become_user setegid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/*\n\t * Now drop real, effective, and saved uid/gid\n\t */\n\tif (setregid(job->gid, job->gid) < 0) {\n\t\terror(\"setregid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif (setreuid(job->uid, job->uid) < 0) {\n\t\terror(\"setreuid: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_pre_task_privileged",
          "args": [
            "job",
            "i",
            "&sprivs"
          ],
          "line": 1728
        },
        "resolved": true,
        "details": {
          "function_name": "_pre_task_privileged",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1394-1408",
          "snippet": "static int\n_pre_task_privileged(stepd_step_rec_t *job, int taskid, struct priv_state *sp)\n{\n\tif (_reclaim_privileges(sp) < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (spank_task_privileged (job, taskid) < 0)\n\t\treturn error(\"spank_task_init_privileged failed\");\n\n\tif (task_g_pre_launch_priv(job) < 0)\n\t\treturn error(\"pre_launch_priv failed\");\n\n\t/* sp->gid_list should already be initialized */\n\treturn(_drop_privileges (job, true, sp, false));\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_pre_task_privileged(stepd_step_rec_t *job, int taskid, struct priv_state *sp)\n{\n\tif (_reclaim_privileges(sp) < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (spank_task_privileged (job, taskid) < 0)\n\t\treturn error(\"spank_task_init_privileged failed\");\n\n\tif (task_g_pre_launch_priv(job) < 0)\n\t\treturn error(\"pre_launch_priv failed\");\n\n\t/* sp->gid_list should already be initialized */\n\treturn(_drop_privileges (job, true, sp, false));\n}"
        }
      },
      {
        "call_info": {
          "callee": "_set_prio_process",
          "args": [
            "job"
          ],
          "line": 1720
        },
        "resolved": true,
        "details": {
          "function_name": "_set_prio_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2582-2608",
          "snippet": "static void _set_prio_process (stepd_step_rec_t *job)\n{\n\tchar *env_name = \"SLURM_PRIO_PROCESS\";\n\tchar *env_val;\n\tint prio_daemon, prio_process;\n\n\tif (!(env_val = getenvp( job->env, env_name ))) {\n\t\terror( \"Couldn't find %s in environment\", env_name );\n\t\tprio_process = 0;\n\t} else {\n\t\t/* Users shouldn't get this in their environment */\n\t\tunsetenvp( job->env, env_name );\n\t\tprio_process = atoi( env_val );\n\t}\n\n\tif (conf->propagate_prio == PROP_PRIO_NICER) {\n\t\tprio_daemon = getpriority( PRIO_PROCESS, 0 );\n\t\tprio_process = MAX( prio_process, (prio_daemon + 1) );\n\t}\n\n\tif (setpriority( PRIO_PROCESS, 0, prio_process ))\n\t\terror( \"setpriority(PRIO_PROCESS, %d): %m\", prio_process );\n\telse {\n\t\tdebug2( \"_set_prio_process: setpriority %d succeeded\",\n\t\t\tprio_process);\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_prio_process (stepd_step_rec_t *job)\n{\n\tchar *env_name = \"SLURM_PRIO_PROCESS\";\n\tchar *env_val;\n\tint prio_daemon, prio_process;\n\n\tif (!(env_val = getenvp( job->env, env_name ))) {\n\t\terror( \"Couldn't find %s in environment\", env_name );\n\t\tprio_process = 0;\n\t} else {\n\t\t/* Users shouldn't get this in their environment */\n\t\tunsetenvp( job->env, env_name );\n\t\tprio_process = atoi( env_val );\n\t}\n\n\tif (conf->propagate_prio == PROP_PRIO_NICER) {\n\t\tprio_daemon = getpriority( PRIO_PROCESS, 0 );\n\t\tprio_process = MAX( prio_process, (prio_daemon + 1) );\n\t}\n\n\tif (setpriority( PRIO_PROCESS, 0, prio_process ))\n\t\terror( \"setpriority(PRIO_PROCESS, %d): %m\", prio_process );\n\telse {\n\t\tdebug2( \"_set_prio_process: setpriority %d succeeded\",\n\t\t\tprio_process);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "mkcrid",
          "args": [
            "0"
          ],
          "line": 1714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FREE_NULL_LIST",
          "args": [
            "exec_wait_list"
          ],
          "line": 1711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exec_wait_get_pid",
          "args": [
            "ei"
          ],
          "line": 1704
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_get_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1457-1462",
          "snippet": "static pid_t _exec_wait_get_pid (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn (-1);\n\treturn (e->pid);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic pid_t _exec_wait_get_pid (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn (-1);\n\treturn (e->pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "exec_wait_kill_children",
          "args": [
            "exec_wait_list"
          ],
          "line": 1701
        },
        "resolved": true,
        "details": {
          "function_name": "exec_wait_kill_children",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1534-1555",
          "snippet": "static int exec_wait_kill_children (List exec_wait_list)\n{\n\tint rc = 0;\n\tint count;\n\tstruct exec_wait_info *e;\n\tListIterator i;\n\n\tif ((count = list_count (exec_wait_list)) == 0)\n\t\treturn (0);\n\n\tverbose (\"Killing %d remaining child%s\",\n\t\t count, (count > 1 ? \"ren\" : \"\"));\n\n\ti = list_iterator_create (exec_wait_list);\n\tif (i == NULL)\n\t\treturn error (\"exec_wait_kill_children: iterator_create: %m\");\n\n\twhile ((e = list_next (i)))\n\t\trc += exec_wait_kill_child (e);\n\tlist_iterator_destroy (i);\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\n\nstatic int exec_wait_kill_children (List exec_wait_list)\n{\n\tint rc = 0;\n\tint count;\n\tstruct exec_wait_info *e;\n\tListIterator i;\n\n\tif ((count = list_count (exec_wait_list)) == 0)\n\t\treturn (0);\n\n\tverbose (\"Killing %d remaining child%s\",\n\t\t count, (count > 1 ? \"ren\" : \"\"));\n\n\ti = list_iterator_create (exec_wait_list);\n\tif (i == NULL)\n\t\treturn error (\"exec_wait_kill_children: iterator_create: %m\");\n\n\twhile ((e = list_next (i)))\n\t\trc += exec_wait_kill_child (e);\n\tlist_iterator_destroy (i);\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"child fork: %m\""
          ],
          "line": 1700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_fork_child_with_wait_info",
          "args": [
            "i"
          ],
          "line": 1699
        },
        "resolved": true,
        "details": {
          "function_name": "_fork_child_with_wait_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1464-1486",
          "snippet": "static struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_task_start",
          "args": [
            "i"
          ],
          "line": 1698
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"starting %u tasks\"",
            "job->node_tasks"
          ],
          "line": 1692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to create exec_wait_list\""
          ],
          "line": 1684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_create",
          "args": [
            "(ListDelF) _exec_wait_info_destroy"
          ],
          "line": 1682
        },
        "resolved": true,
        "details": {
          "function_name": "_script_list_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "178-210",
          "snippet": "static List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"spank_user failed.\""
          ],
          "line": 1677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_user",
          "args": [
            "job"
          ],
          "line": 1676
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"couldn't chdir to /tmp either. dying.\""
          ],
          "line": 1670
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "\"/tmp\""
          ],
          "line": 1669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "job->cwd"
          ],
          "line": 1666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "job->cwd"
          ],
          "line": 1662
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "is_path_escaped",
          "args": [
            "job->cwd"
          ],
          "line": 1660
        },
        "resolved": true,
        "details": {
          "function_name": "is_path_escaped",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/fname.c",
          "lines": "341-371",
          "snippet": "char *\nis_path_escaped(char *p)\n{\n\tchar *buf;\n\tbool t;\n\tint i;\n\n\tif (p == NULL)\n\t\treturn NULL;\n\n\tbuf = xmalloc((strlen(p) + 1) * sizeof(char));\n\tt = false;\n\ti = 0;\n\n\twhile (*p) {\n\t\tif (*p == '\\\\') {\n\t\t\tt = true;\n\t\t\t++p;\n\t\t\tcontinue;\n\t\t}\n\t\tbuf[i] = *p;\n\t\t++i;\n\t\t++p;\n\t}\n\n\tif (t == false) {\n\t\txfree(buf);\n\t\treturn NULL;\n\t}\n\treturn buf;\n}",
          "includes": [
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <ctype.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/uid.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <ctype.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <stdio.h>\n\nchar *\nis_path_escaped(char *p)\n{\n\tchar *buf;\n\tbool t;\n\tint i;\n\n\tif (p == NULL)\n\t\treturn NULL;\n\n\tbuf = xmalloc((strlen(p) + 1) * sizeof(char));\n\tt = false;\n\ti = 0;\n\n\twhile (*p) {\n\t\tif (*p == '\\\\') {\n\t\t\tt = true;\n\t\t\t++p;\n\t\t\tcontinue;\n\t\t}\n\t\tbuf[i] = *p;\n\t\t++i;\n\t\t++p;\n\t}\n\n\tif (t == false) {\n\t\txfree(buf);\n\t\treturn NULL;\n\t}\n\treturn buf;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_drop_privileges: %m\""
          ],
          "line": 1652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_drop_privileges",
          "args": [
            "job",
            "true",
            "&sprivs",
            "true"
          ],
          "line": 1651
        },
        "resolved": true,
        "details": {
          "function_name": "_drop_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2422-2478",
          "snippet": "static int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"IO setup failed: %m\""
          ],
          "line": 1638
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_slurmd_job_log_init",
          "args": [
            "job"
          ],
          "line": 1635
        },
        "resolved": true,
        "details": {
          "function_name": "_slurmd_job_log_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2505-2560",
          "snippet": "static int\n_slurmd_job_log_init(stepd_step_rec_t *job)\n{\n\tchar argv0[64];\n\n\tconf->log_opts.buffered = 1;\n\n\t/*\n\t * Reset stderr logging to user requested level\n\t * (Logfile and syslog levels remain the same)\n\t *\n\t * The maximum stderr log level is LOG_LEVEL_DEBUG3 because\n\t * some higher level debug messages are generated in the\n\t * stdio code, which would otherwise create more stderr traffic\n\t * to srun and therefore more debug messages in an endless loop.\n\t */\n\tconf->log_opts.stderr_level = LOG_LEVEL_ERROR + job->debug;\n\tif (conf->log_opts.stderr_level > LOG_LEVEL_DEBUG3)\n\t\tconf->log_opts.stderr_level = LOG_LEVEL_DEBUG3;\n\n#if defined(MULTIPLE_SLURMD)\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd-%s\", conf->node_name);\n#else\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd\");\n#endif\n\t/*\n\t * reinitialize log\n\t */\n\n\tlog_alter(conf->log_opts, 0, NULL);\n\tlog_set_argv0(argv0);\n\n\t/*  Connect slurmd stderr to stderr of job, unless we are using\n\t *   user_managed_io or a pty.\n\t *\n\t *  user_managed_io directly connects the client (e.g. poe) to the tasks\n\t *   over a TCP connection, and we fully leave it up to the client\n\t *   to manage the stream with no buffering on slurm's part.\n\t *   We also promise that we will not insert any foreign data into\n\t *   the stream, so here we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the tasks's stderr.\n\t *\n\t *  When pty terminal emulation is used, the pts can potentially\n\t *   cause IO to block, so we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the task's pts on stderr to avoid hangs in\n\t *   the slurmstepd.\n\t */\n\tif (!job->user_managed_io && !job->pty && job->task != NULL) {\n\t\tif (dup2(job->task[0]->stderr_fd, STDERR_FILENO) < 0) {\n\t\t\terror(\"job_log_init: dup2(stderr): %m\");\n\t\t\treturn ESLURMD_IO_ERROR;\n\t\t}\n\t}\n\tverbose(\"debug level = %d\", conf->log_opts.stderr_level);\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_slurmd_job_log_init(stepd_step_rec_t *job)\n{\n\tchar argv0[64];\n\n\tconf->log_opts.buffered = 1;\n\n\t/*\n\t * Reset stderr logging to user requested level\n\t * (Logfile and syslog levels remain the same)\n\t *\n\t * The maximum stderr log level is LOG_LEVEL_DEBUG3 because\n\t * some higher level debug messages are generated in the\n\t * stdio code, which would otherwise create more stderr traffic\n\t * to srun and therefore more debug messages in an endless loop.\n\t */\n\tconf->log_opts.stderr_level = LOG_LEVEL_ERROR + job->debug;\n\tif (conf->log_opts.stderr_level > LOG_LEVEL_DEBUG3)\n\t\tconf->log_opts.stderr_level = LOG_LEVEL_DEBUG3;\n\n#if defined(MULTIPLE_SLURMD)\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd-%s\", conf->node_name);\n#else\n\tsnprintf(argv0, sizeof(argv0), \"slurmstepd\");\n#endif\n\t/*\n\t * reinitialize log\n\t */\n\n\tlog_alter(conf->log_opts, 0, NULL);\n\tlog_set_argv0(argv0);\n\n\t/*  Connect slurmd stderr to stderr of job, unless we are using\n\t *   user_managed_io or a pty.\n\t *\n\t *  user_managed_io directly connects the client (e.g. poe) to the tasks\n\t *   over a TCP connection, and we fully leave it up to the client\n\t *   to manage the stream with no buffering on slurm's part.\n\t *   We also promise that we will not insert any foreign data into\n\t *   the stream, so here we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the tasks's stderr.\n\t *\n\t *  When pty terminal emulation is used, the pts can potentially\n\t *   cause IO to block, so we need to avoid connecting slurmstepd's\n\t *   STDERR_FILENO to the task's pts on stderr to avoid hangs in\n\t *   the slurmstepd.\n\t */\n\tif (!job->user_managed_io && !job->pty && job->task != NULL) {\n\t\tif (dup2(job->task[0]->stderr_fd, STDERR_FILENO) < 0) {\n\t\t\terror(\"job_log_init: dup2(stderr): %m\");\n\t\t\treturn ESLURMD_IO_ERROR;\n\t\t}\n\t}\n\tverbose(\"debug level = %d\", conf->log_opts.stderr_level);\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_setup_normal_io",
          "args": [
            "job"
          ],
          "line": 1630
        },
        "resolved": true,
        "details": {
          "function_name": "_setup_normal_io",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "506-649",
          "snippet": "static int\n_setup_normal_io(stepd_step_rec_t *job)\n{\n\tint rc = 0, ii = 0;\n\tstruct priv_state sprivs;\n\n\tdebug2(\"Entering _setup_normal_io\");\n\n\t/*\n\t * Temporarily drop permissions, initialize task stdio file\n\t * descriptors (which may be connected to files), then\n\t * reclaim privileges.\n\t */\n\tif (_drop_privileges(job, true, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (io_init_tasks_stdio(job) != SLURM_SUCCESS) {\n\t\trc = ESLURMD_IO_ERROR;\n\t\tgoto claim;\n\t}\n\n\t/*\n\t * MUST create the initial client object before starting\n\t * the IO thread, or we risk losing stdout/err traffic.\n\t */\n\tif (!job->batch) {\n\t\tsrun_info_t *srun = list_peek(job->sruns);\n\n\t\t/* local id of task that sends to srun, -1 for all tasks,\n\t\t   any other value for no tasks */\n\t\tint srun_stdout_tasks = -1;\n\t\tint srun_stderr_tasks = -1;\n\n\t\txassert(srun != NULL);\n\n\t\t/* If I/O is labelled with task num, and if a separate file is\n\t\t   written per node or per task, the I/O needs to be sent\n\t\t   back to the stepd, get a label appended, and written from\n\t\t   the stepd rather than sent back to srun or written directly\n\t\t   from the node.  When a task has ofname or efname == NULL, it\n\t\t   means data gets sent back to the client. */\n\n\t\tif (job->labelio) {\n\t\t\tslurmd_filename_pattern_t outpattern, errpattern;\n\t\t\tbool same = false;\n\t\t\tint file_flags;\n\n\t\t\tio_find_filename_pattern(job, &outpattern, &errpattern,\n\t\t\t\t\t\t &same);\n\t\t\tfile_flags = io_get_file_flags(job);\n\n\t\t\t/* Make eio objects to write from the slurmstepd */\n\t\t\tif (outpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t/* Open a separate file per task */\n\t\t\t\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[ii]->ofname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\tjob->task[ii]->id,\n\t\t\t\t\t\tsame ? job->task[ii]->id : -2);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t\t      job->task[ii]->ofname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t} else if (outpattern == SLURMD_ALL_SAME) {\n\t\t\t\t/* Open a file for all tasks */\n\t\t\t\trc = io_create_local_client(\n\t\t\t\t\tjob->task[0]->ofname,\n\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t-1, same ? -1 : -2);\n\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t      job->task[0]->ofname);\n\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\tgoto claim;\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t}\n\n\t\t\tif (!same) {\n\t\t\t\tif (errpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t\t/* Open a separate file per task */\n\t\t\t\t\tfor (ii = 0;\n\t\t\t\t\t     ii < job->node_tasks; ii++) {\n\t\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\t\tjob->task[ii]->efname,\n\t\t\t\t\t\t\tfile_flags, job,\n\t\t\t\t\t\t\tjob->labelio,\n\t\t\t\t\t\t\t-2, job->task[ii]->id);\n\t\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t\t      job->task[ii]->\n\t\t\t\t\t\t\t      efname);\n\t\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t} else if (errpattern == SLURMD_ALL_SAME) {\n\t\t\t\t\t/* Open a file for all tasks */\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[0]->efname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\t-2, -1);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t      job->task[0]->efname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (io_initial_client_connect(srun, job, srun_stdout_tasks,\n\t\t\t\t\t     srun_stderr_tasks) < 0) {\n\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\tgoto claim;\n\t\t}\n\t}\n\nclaim:\n\tif (_reclaim_privileges(&sprivs) < 0) {\n\t\terror(\"sete{u/g}id(%lu/%lu): %m\",\n\t\t      (u_long) sprivs.saved_uid, (u_long) sprivs.saved_gid);\n\t}\n\n\tif (!rc && !job->batch) {\n\t\tif (io_thread_start(job) < 0)\n\t\t\trc = ESLURMD_IO_ERROR;\n\t}\n\n\tdebug2(\"Leaving  _setup_normal_io\");\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_setup_normal_io(stepd_step_rec_t *job)\n{\n\tint rc = 0, ii = 0;\n\tstruct priv_state sprivs;\n\n\tdebug2(\"Entering _setup_normal_io\");\n\n\t/*\n\t * Temporarily drop permissions, initialize task stdio file\n\t * descriptors (which may be connected to files), then\n\t * reclaim privileges.\n\t */\n\tif (_drop_privileges(job, true, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (io_init_tasks_stdio(job) != SLURM_SUCCESS) {\n\t\trc = ESLURMD_IO_ERROR;\n\t\tgoto claim;\n\t}\n\n\t/*\n\t * MUST create the initial client object before starting\n\t * the IO thread, or we risk losing stdout/err traffic.\n\t */\n\tif (!job->batch) {\n\t\tsrun_info_t *srun = list_peek(job->sruns);\n\n\t\t/* local id of task that sends to srun, -1 for all tasks,\n\t\t   any other value for no tasks */\n\t\tint srun_stdout_tasks = -1;\n\t\tint srun_stderr_tasks = -1;\n\n\t\txassert(srun != NULL);\n\n\t\t/* If I/O is labelled with task num, and if a separate file is\n\t\t   written per node or per task, the I/O needs to be sent\n\t\t   back to the stepd, get a label appended, and written from\n\t\t   the stepd rather than sent back to srun or written directly\n\t\t   from the node.  When a task has ofname or efname == NULL, it\n\t\t   means data gets sent back to the client. */\n\n\t\tif (job->labelio) {\n\t\t\tslurmd_filename_pattern_t outpattern, errpattern;\n\t\t\tbool same = false;\n\t\t\tint file_flags;\n\n\t\t\tio_find_filename_pattern(job, &outpattern, &errpattern,\n\t\t\t\t\t\t &same);\n\t\t\tfile_flags = io_get_file_flags(job);\n\n\t\t\t/* Make eio objects to write from the slurmstepd */\n\t\t\tif (outpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t/* Open a separate file per task */\n\t\t\t\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[ii]->ofname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\tjob->task[ii]->id,\n\t\t\t\t\t\tsame ? job->task[ii]->id : -2);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t\t      job->task[ii]->ofname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t} else if (outpattern == SLURMD_ALL_SAME) {\n\t\t\t\t/* Open a file for all tasks */\n\t\t\t\trc = io_create_local_client(\n\t\t\t\t\tjob->task[0]->ofname,\n\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t-1, same ? -1 : -2);\n\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t      job->task[0]->ofname);\n\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\tgoto claim;\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t}\n\n\t\t\tif (!same) {\n\t\t\t\tif (errpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t\t/* Open a separate file per task */\n\t\t\t\t\tfor (ii = 0;\n\t\t\t\t\t     ii < job->node_tasks; ii++) {\n\t\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\t\tjob->task[ii]->efname,\n\t\t\t\t\t\t\tfile_flags, job,\n\t\t\t\t\t\t\tjob->labelio,\n\t\t\t\t\t\t\t-2, job->task[ii]->id);\n\t\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t\t      job->task[ii]->\n\t\t\t\t\t\t\t      efname);\n\t\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t} else if (errpattern == SLURMD_ALL_SAME) {\n\t\t\t\t\t/* Open a file for all tasks */\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[0]->efname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\t-2, -1);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t      job->task[0]->efname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (io_initial_client_connect(srun, job, srun_stdout_tasks,\n\t\t\t\t\t     srun_stderr_tasks) < 0) {\n\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\tgoto claim;\n\t\t}\n\t}\n\nclaim:\n\tif (_reclaim_privileges(&sprivs) < 0) {\n\t\terror(\"sete{u/g}id(%lu/%lu): %m\",\n\t\t      (u_long) sprivs.saved_uid, (u_long) sprivs.saved_gid);\n\t}\n\n\tif (!rc && !job->batch) {\n\t\tif (io_thread_start(job) < 0)\n\t\t\trc = ESLURMD_IO_ERROR;\n\t}\n\n\tdebug2(\"Leaving  _setup_normal_io\");\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_setup_user_managed_io",
          "args": [
            "job"
          ],
          "line": 1628
        },
        "resolved": true,
        "details": {
          "function_name": "_setup_user_managed_io",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "651-662",
          "snippet": "static int\n_setup_user_managed_io(stepd_step_rec_t *job)\n{\n\tsrun_info_t *srun;\n\n\tif ((srun = list_peek(job->sruns)) == NULL) {\n\t\terror(\"_setup_user_managed_io: no clients!\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn user_managed_io_client_connect(job->node_tasks, srun, job->task);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_setup_user_managed_io(stepd_step_rec_t *job)\n{\n\tsrun_info_t *srun;\n\n\tif ((srun = list_peek(job->sruns)) == NULL) {\n\t\terror(\"_setup_user_managed_io: no clients!\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn user_managed_io_client_connect(job->node_tasks, srun, job->task);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_umask",
          "args": [
            "job"
          ],
          "line": 1626
        },
        "resolved": true,
        "details": {
          "function_name": "set_umask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/ulimits.c",
          "lines": "181-199",
          "snippet": "extern int\nset_umask(stepd_step_rec_t *job)\n{\n\tmode_t mask;\n\tchar *val;\n\n\tif (!(val = getenvp(job->env, \"SLURM_UMASK\"))) {\n\t\tif (job->stepid != SLURM_EXTERN_CONT)\n\t\t\tdebug(\"Couldn't find SLURM_UMASK in environment\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tmask = strtol(val, (char **)NULL, 8);\n\tif ((job->stepid == SLURM_EXTERN_CONT) ||\n\t    (job->stepid == SLURM_BATCH_SCRIPT))\n\t\tunsetenvp(job->env, \"SLURM_UMASK\");\n\tumask(mask);\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/common/slurm_rlimits_info.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/env.h\" /* For unsetenvp() */",
            "#include \"src/common/log.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/resource.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/common/slurm_rlimits_info.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/env.h\" /* For unsetenvp() */\n#include \"src/common/log.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#  include \"config.h\"\n\nextern int\nset_umask(stepd_step_rec_t *job)\n{\n\tmode_t mask;\n\tchar *val;\n\n\tif (!(val = getenvp(job->env, \"SLURM_UMASK\"))) {\n\t\tif (job->stepid != SLURM_EXTERN_CONT)\n\t\t\tdebug(\"Couldn't find SLURM_UMASK in environment\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tmask = strtol(val, (char **)NULL, 8);\n\tif ((job->stepid == SLURM_EXTERN_CONT) ||\n\t    (job->stepid == SLURM_BATCH_SCRIPT))\n\t\tunsetenvp(job->env, \"SLURM_UMASK\");\n\tumask(mask);\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"error in pam_setup\""
          ],
          "line": 1615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_setup",
          "args": [
            "job->user_name",
            "conf->hostname"
          ],
          "line": 1613
        },
        "resolved": true,
        "details": {
          "function_name": "pam_setup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
          "lines": "167-171",
          "snippet": "int pam_setup (char *user, char *host)\n{\n\t/* Don't have PAM support, do nothing. */\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#  include <security/pam_misc.h>",
            "#  include <security/pam_appl.h>",
            "#  include <pam/pam_misc.h>",
            "#  include <pam/pam_appl.h>",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\nint pam_setup (char *user, char *host)\n{\n\t/* Don't have PAM support, do nothing. */\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to invoke task plugins: one of task_p_pre_setuid functions returned error\""
          ],
          "line": 1603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_g_pre_setuid",
          "args": [
            "job"
          ],
          "line": 1602
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_pre_setuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "329-342",
          "snippet": "extern int task_g_pre_setuid(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_setuid))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_pre_setuid(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_setuid))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "job != NULL"
          ],
          "line": 1599
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic int  _fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic void _unblock_signals(void);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized)\n{\n\tint rc = SLURM_SUCCESS;\n\tint i;\n\tstruct priv_state sprivs;\n\tjobacct_id_t jobacct_id;\n\tchar *oom_value;\n\tList exec_wait_list = NULL;\n\tchar *esc;\n\n\txassert(job != NULL);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"Failed to invoke task plugins: one of task_p_pre_setuid functions returned error\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/* Temporarily drop effective privileges, except for the euid.\n\t * We need to wait until after pam_setup() to drop euid.\n\t */\n\tif (_drop_privileges (job, false, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (pam_setup(job->user_name, conf->hostname)\n\t    != SLURM_SUCCESS){\n\t\terror (\"error in pam_setup\");\n\t\trc = SLURM_ERROR;\n\t}\n\n\t/*\n\t * Reclaim privileges to do the io setup\n\t */\n\t_reclaim_privileges (&sprivs);\n\tif (rc)\n\t\tgoto fail1; /* pam_setup error */\n\n\tset_umask(job);\t\t/* set umask for stdout/err files */\n\tif (job->user_managed_io)\n\t\trc = _setup_user_managed_io(job);\n\telse\n\t\trc = _setup_normal_io(job);\n\t/*\n\t * Initialize log facility to copy errors back to srun\n\t */\n\tif (!rc)\n\t\trc = _slurmd_job_log_init(job);\n\n\tif (rc) {\n\t\terror(\"IO setup failed: %m\");\n\t\tjob->task[0]->estatus = 0x0100;\n\t\tstep_complete.step_rc = 0x0100;\n\t\tif (job->batch)\n\t\t\trc = SLURM_SUCCESS;\t/* drains node otherwise */\n\t\tgoto fail1;\n\t} else {\n\t\t*io_initialized = true;\n\t}\n\n\t/*\n\t * Temporarily drop effective privileges\n\t */\n\tif (_drop_privileges (job, true, &sprivs, true) < 0) {\n\t\terror (\"_drop_privileges: %m\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail2;\n\t}\n\n\t/* If there is an \\ in the path\n\t * remove it.\n\t */\n\tesc = is_path_escaped(job->cwd);\n\tif (esc) {\n\t\txfree(job->cwd);\n\t\tjob->cwd = esc;\n\t}\n\n\tif (chdir(job->cwd) < 0) {\n\t\terror(\"couldn't chdir to `%s': %m: going to /tmp instead\",\n\t\t      job->cwd);\n\t\tif (chdir(\"/tmp\") < 0) {\n\t\t\terror(\"couldn't chdir to /tmp either. dying.\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail3;\n\t\t}\n\t}\n\n\tif (spank_user (job) < 0) {\n\t\terror(\"spank_user failed.\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\texec_wait_list = list_create ((ListDelF) _exec_wait_info_destroy);\n\tif (!exec_wait_list) {\n\t\terror (\"Unable to create exec_wait_list\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\t/*\n\t * Fork all of the task processes.\n\t */\n\tverbose(\"starting %u tasks\", job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tchar time_stamp[256];\n\t\tpid_t pid;\n\t\tstruct exec_wait_info *ei;\n\n\t\tacct_gather_profile_g_task_start(i);\n\t\tif ((ei = _fork_child_with_wait_info (i)) == NULL) {\n\t\t\terror(\"child fork: %m\");\n\t\t\texec_wait_kill_children (exec_wait_list);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail4;\n\t\t} else if ((pid = _exec_wait_get_pid (ei)) == 0)  { /* child */\n\t\t\t/*\n\t\t\t *  Destroy exec_wait_list in the child.\n\t\t\t *   Only exec_wait_info for previous tasks have been\n\t\t\t *   added to the list so far, so everything else\n\t\t\t *   can be discarded.\n\t\t\t */\n\t\t\tFREE_NULL_LIST (exec_wait_list);\n\n#ifdef HAVE_AIX\n\t\t\t(void) mkcrid(0);\n#endif\n\t\t\t/* jobacctinfo_endpoll();\n\t\t\t * closing jobacct files here causes deadlock */\n\n\t\t\tif (conf->propagate_prio)\n\t\t\t\t_set_prio_process(job);\n\n\t\t\t/*\n\t\t\t *  Reclaim privileges and call any plugin hooks\n\t\t\t *  that may require elevated privs\n\t\t\t *  sprivs.gid_list is already set from the\n\t\t\t *  _drop_privileges call above, no not reinitialize.\n\t\t\t */\n\t\t\tif (_pre_task_privileged(job, i, &sprivs) < 0)\n\t\t\t\texit(1);\n\n \t\t\tif (_become_user(job, &sprivs) < 0) {\n \t\t\t\terror(\"_become_user failed: %m\");\n\t\t\t\t/* child process, should not return */\n\t\t\t\texit(1);\n \t\t\t}\n\n\t\t\t/* log_fini(); */ /* note: moved into exec_task() */\n\n\t\t\t_unblock_signals();\n\n\t\t\t/*\n\t\t\t *  Need to setup stdio before setpgid() is called\n\t\t\t *   in case we are setting up a tty. (login_tty()\n\t\t\t *   must be called before setpgid() or it is\n\t\t\t *   effectively disabled).\n\t\t\t */\n\t\t\tprepare_stdio (job, job->task[i]);\n\n\t\t\t/* Close profiling file descriptors */\n\t\t\tacct_gather_profile_g_child_forked();\n\n\t\t\t/*\n\t\t\t *  Block until parent notifies us that it is ok to\n\t\t\t *   proceed. This allows the parent to place all\n\t\t\t *   children in any process groups or containers\n\t\t\t *   before they make a call to exec(2).\n\t\t\t */\n\t\t\tif (_exec_wait_child_wait_for_parent (ei) < 0)\n\t\t\t\texit (1);\n\n\t\t\texec_task(job, i);\n\t\t}\n\n\t\t/*\n\t\t * Parent continues:\n\t\t */\n\n\t\tlist_append (exec_wait_list, ei);\n\n\t\tlog_timestamp(time_stamp, sizeof(time_stamp));\n\t\tverbose(\"task %lu (%lu) started %s\",\n\t\t\t(unsigned long) job->task[i]->gtid,\n\t\t\t(unsigned long) pid, time_stamp);\n\n\t\tjob->task[i]->pid = pid;\n\t\tif (i == 0)\n\t\t\tjob->pgid = pid;\n\t}\n\n\t/*\n\t * All tasks are now forked and running as the user, but\n\t * will wait for our signal before calling exec.\n\t */\n\n\t/*\n\t * Reclaim privileges\n\t */\n\tif (_reclaim_privileges (&sprivs) < 0) {\n\t\terror (\"Unable to reclaim privileges\");\n\t\t/* Don't bother erroring out here */\n\t}\n\n\tif ((oom_value = getenv(\"SLURMSTEPD_OOM_ADJ\"))) {\n\t\tint i = atoi(oom_value);\n\t\tdebug(\"Setting slurmstepd oom_adj to %d\", i);\n\t\tset_oom_adj(i);\n\t}\n\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Put this task in the step process group\n\t\t * login_tty() must put task zero in its own\n\t\t * session, causing setpgid() to fail, setsid()\n\t\t * has already set its process group as desired\n\t\t */\n\t\tif ((job->pty == 0)\n\t\t    &&  (setpgid (job->task[i]->pid, job->pgid) < 0)) {\n\t\t\terror(\"Unable to put task %d (pid %d) into \"\n\t\t\t      \"pgrp %d: %m\",\n\t\t\t      i,\n\t\t\t      job->task[i]->pid,\n\t\t\t      job->pgid);\n\t\t}\n\n\t\tif (proctrack_g_add(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\terror(\"proctrack_g_add: %m\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t\tjobacct_id.nodeid = job->nodeid;\n\t\tjobacct_id.taskid = job->task[i]->gtid;\n\t\tjobacct_id.job    = job;\n\t\tif (i == (job->node_tasks - 1)) {\n\t\t\t/* start polling on the last task */\n\t\t\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t1);\n\t\t} else {\n\t\t\t/* don't poll yet */\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t0);\n\t\t}\n\t\tif (spank_task_post_fork (job, i) < 0) {\n\t\t\terror (\"spank task %d post-fork failed\", i);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n//\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tif (container_g_add_cont(job->jobid, job->cont_id) != SLURM_SUCCESS)\n\t\terror(\"container_g_add_cont(%u): %m\", job->jobid);\n\tif (!job->batch && core_spec_g_set(job->cont_id, job->job_core_spec))\n\t\terror(\"core_spec_g_set: %m\");\n\n\t/*\n\t * Now it's ok to unblock the tasks, so they may call exec.\n\t */\n\tlist_for_each (exec_wait_list, (ListForF) exec_wait_signal, job);\n\tFREE_NULL_LIST (exec_wait_list);\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Prepare process for attach by parallel debugger\n\t\t * (if specified and able)\n\t\t */\n\t\tif (pdebug_trace_process(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n\n\treturn rc;\n\nfail4:\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\nfail3:\n\t_reclaim_privileges (&sprivs);\n\tFREE_NULL_LIST (exec_wait_list);\nfail2:\n\tio_close_task_fds(job);\nfail1:\n\tpam_finish();\n\treturn rc;\n}"
  },
  {
    "function_name": "_unblock_signals",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1572-1584",
    "snippet": "static void _unblock_signals (void)\n{\n\tsigset_t set;\n\tint i;\n\n\tfor (i = 0; mgr_sigarray[i]; i++) {\n\t\t/* eliminate pending signals, then set to default */\n\t\txsignal(mgr_sigarray[i], SIG_IGN);\n\t\txsignal(mgr_sigarray[i], SIG_DFL);\n\t}\n\tsigemptyset(&set);\n\txsignal_set_mask (&set);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int mgr_sigarray[] = {\n\tSIGINT,  SIGTERM, SIGTSTP,\n\tSIGQUIT, SIGPIPE, SIGUSR1,\n\tSIGUSR2, SIGALRM, SIGHUP, 0\n};",
      "static void _unblock_signals(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xsignal_set_mask",
          "args": [
            "&set"
          ],
          "line": 1583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigemptyset",
          "args": [
            "&set"
          ],
          "line": 1582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xsignal",
          "args": [
            "mgr_sigarray[i]",
            "SIG_DFL"
          ],
          "line": 1580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xsignal",
          "args": [
            "mgr_sigarray[i]",
            "SIG_IGN"
          ],
          "line": 1579
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int mgr_sigarray[] = {\n\tSIGINT,  SIGTERM, SIGTSTP,\n\tSIGQUIT, SIGPIPE, SIGUSR1,\n\tSIGUSR2, SIGALRM, SIGHUP, 0\n};\nstatic void _unblock_signals(void);\n\nstatic void _unblock_signals (void)\n{\n\tsigset_t set;\n\tint i;\n\n\tfor (i = 0; mgr_sigarray[i]; i++) {\n\t\t/* eliminate pending signals, then set to default */\n\t\txsignal(mgr_sigarray[i], SIG_IGN);\n\t\txsignal(mgr_sigarray[i], SIG_DFL);\n\t}\n\tsigemptyset(&set);\n\txsignal_set_mask (&set);\n}"
  },
  {
    "function_name": "prepare_stdio",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1557-1570",
    "snippet": "static void prepare_stdio (stepd_step_rec_t *job, stepd_step_task_info_t *task)\n{\n#ifdef HAVE_PTY_H\n\tif (job->pty && (task->gtid == 0)) {\n\t\tif (login_tty(task->stdin_fd))\n\t\t\terror(\"login_tty: %m\");\n\t\telse\n\t\t\tdebug3(\"login_tty good\");\n\t\treturn;\n\t}\n#endif\n\tio_dup_stdio(task);\n\treturn;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_dup_stdio",
          "args": [
            "task"
          ],
          "line": 1568
        },
        "resolved": true,
        "details": {
          "function_name": "io_dup_stdio",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1724-1746",
          "snippet": "int\nio_dup_stdio(stepd_step_task_info_t *t)\n{\n\tif (dup2(t->stdin_fd, STDIN_FILENO  ) < 0) {\n\t\terror(\"dup2(stdin): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDIN_FILENO);\n\n\tif (dup2(t->stdout_fd, STDOUT_FILENO) < 0) {\n\t\terror(\"dup2(stdout): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDOUT_FILENO);\n\n\tif (dup2(t->stderr_fd, STDERR_FILENO) < 0) {\n\t\terror(\"dup2(stderr): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDERR_FILENO);\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nint\nio_dup_stdio(stepd_step_task_info_t *t)\n{\n\tif (dup2(t->stdin_fd, STDIN_FILENO  ) < 0) {\n\t\terror(\"dup2(stdin): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDIN_FILENO);\n\n\tif (dup2(t->stdout_fd, STDOUT_FILENO) < 0) {\n\t\terror(\"dup2(stdout): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDOUT_FILENO);\n\n\tif (dup2(t->stderr_fd, STDERR_FILENO) < 0) {\n\t\terror(\"dup2(stderr): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDERR_FILENO);\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"login_tty good\""
          ],
          "line": 1564
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"login_tty: %m\""
          ],
          "line": 1562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "login_tty",
          "args": [
            "task->stdin_fd"
          ],
          "line": 1561
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void prepare_stdio (stepd_step_rec_t *job, stepd_step_task_info_t *task)\n{\n#ifdef HAVE_PTY_H\n\tif (job->pty && (task->gtid == 0)) {\n\t\tif (login_tty(task->stdin_fd))\n\t\t\terror(\"login_tty: %m\");\n\t\telse\n\t\t\tdebug3(\"login_tty good\");\n\t\treturn;\n\t}\n#endif\n\tio_dup_stdio(task);\n\treturn;\n}"
  },
  {
    "function_name": "exec_wait_kill_children",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1534-1555",
    "snippet": "static int exec_wait_kill_children (List exec_wait_list)\n{\n\tint rc = 0;\n\tint count;\n\tstruct exec_wait_info *e;\n\tListIterator i;\n\n\tif ((count = list_count (exec_wait_list)) == 0)\n\t\treturn (0);\n\n\tverbose (\"Killing %d remaining child%s\",\n\t\t count, (count > 1 ? \"ren\" : \"\"));\n\n\ti = list_iterator_create (exec_wait_list);\n\tif (i == NULL)\n\t\treturn error (\"exec_wait_kill_children: iterator_create: %m\");\n\n\twhile ((e = list_next (i)))\n\t\trc += exec_wait_kill_child (e);\n\tlist_iterator_destroy (i);\n\treturn (rc);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "list_iterator_destroy",
          "args": [
            "i"
          ],
          "line": 1553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exec_wait_kill_child",
          "args": [
            "e"
          ],
          "line": 1552
        },
        "resolved": true,
        "details": {
          "function_name": "exec_wait_kill_children",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1534-1555",
          "snippet": "static int exec_wait_kill_children (List exec_wait_list)\n{\n\tint rc = 0;\n\tint count;\n\tstruct exec_wait_info *e;\n\tListIterator i;\n\n\tif ((count = list_count (exec_wait_list)) == 0)\n\t\treturn (0);\n\n\tverbose (\"Killing %d remaining child%s\",\n\t\t count, (count > 1 ? \"ren\" : \"\"));\n\n\ti = list_iterator_create (exec_wait_list);\n\tif (i == NULL)\n\t\treturn error (\"exec_wait_kill_children: iterator_create: %m\");\n\n\twhile ((e = list_next (i)))\n\t\trc += exec_wait_kill_child (e);\n\tlist_iterator_destroy (i);\n\treturn (rc);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "list_next",
          "args": [
            "i"
          ],
          "line": 1551
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"exec_wait_kill_children: iterator_create: %m\""
          ],
          "line": 1549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_iterator_create",
          "args": [
            "exec_wait_list"
          ],
          "line": 1547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"Killing %d remaining child%s\"",
            "count",
            "(count > 1 ? \"ren\" : \"\")"
          ],
          "line": 1544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_count",
          "args": [
            "exec_wait_list"
          ],
          "line": 1541
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\n\nstatic int exec_wait_kill_children (List exec_wait_list)\n{\n\tint rc = 0;\n\tint count;\n\tstruct exec_wait_info *e;\n\tListIterator i;\n\n\tif ((count = list_count (exec_wait_list)) == 0)\n\t\treturn (0);\n\n\tverbose (\"Killing %d remaining child%s\",\n\t\t count, (count > 1 ? \"ren\" : \"\"));\n\n\ti = list_iterator_create (exec_wait_list);\n\tif (i == NULL)\n\t\treturn error (\"exec_wait_kill_children: iterator_create: %m\");\n\n\twhile ((e = list_next (i)))\n\t\trc += exec_wait_kill_child (e);\n\tlist_iterator_destroy (i);\n\treturn (rc);\n}"
  },
  {
    "function_name": "exec_wait_kill_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1520-1528",
    "snippet": "static int exec_wait_kill_child (struct exec_wait_info *e)\n{\n\tif (e->pid < 0)\n\t\treturn (-1);\n\tif (kill (e->pid, SIGKILL) < 0)\n\t\treturn (-1);\n\te->pid = -1;\n\treturn (0);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kill",
          "args": [
            "e->pid",
            "SIGKILL"
          ],
          "line": 1524
        },
        "resolved": true,
        "details": {
          "function_name": "_delay_kill_thread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2124-2144",
          "snippet": "static void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int exec_wait_kill_child (struct exec_wait_info *e)\n{\n\tif (e->pid < 0)\n\t\treturn (-1);\n\tif (kill (e->pid, SIGKILL) < 0)\n\t\treturn (-1);\n\te->pid = -1;\n\treturn (0);\n}"
  },
  {
    "function_name": "exec_wait_signal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1508-1514",
    "snippet": "static int exec_wait_signal (struct exec_wait_info *e, stepd_step_rec_t *job)\n{\n\tdebug3 (\"Unblocking %u.%u task %d, writefd = %d\",\n\t\tjob->jobid, job->stepid, e->id, e->parentfd);\n\texec_wait_signal_child (e);\n\treturn (0);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exec_wait_signal_child",
          "args": [
            "e"
          ],
          "line": 1512
        },
        "resolved": true,
        "details": {
          "function_name": "exec_wait_signal_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1498-1506",
          "snippet": "static int exec_wait_signal_child (struct exec_wait_info *e)\n{\n\tchar c = '\\0';\n\n\tif (write (e->parentfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"write to unblock task %d failed: %m\", e->id);\n\n\treturn (0);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int exec_wait_signal_child (struct exec_wait_info *e)\n{\n\tchar c = '\\0';\n\n\tif (write (e->parentfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"write to unblock task %d failed: %m\", e->id);\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Unblocking %u.%u task %d, writefd = %d\"",
            "job->jobid",
            "job->stepid",
            "e->id",
            "e->parentfd"
          ],
          "line": 1510
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int exec_wait_signal (struct exec_wait_info *e, stepd_step_rec_t *job)\n{\n\tdebug3 (\"Unblocking %u.%u task %d, writefd = %d\",\n\t\tjob->jobid, job->stepid, e->id, e->parentfd);\n\texec_wait_signal_child (e);\n\treturn (0);\n}"
  },
  {
    "function_name": "exec_wait_signal_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1498-1506",
    "snippet": "static int exec_wait_signal_child (struct exec_wait_info *e)\n{\n\tchar c = '\\0';\n\n\tif (write (e->parentfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"write to unblock task %d failed: %m\", e->id);\n\n\treturn (0);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"write to unblock task %d failed: %m\"",
            "e->id"
          ],
          "line": 1503
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "e->parentfd",
            "&c",
            "sizeof (c)"
          ],
          "line": 1502
        },
        "resolved": true,
        "details": {
          "function_name": "_file_write_content",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/xcgroup.c",
          "lines": "1116-1147",
          "snippet": "int _file_write_content(char* file_path, char* content, size_t csize)\n{\n\tint fstatus;\n\tint rc;\n\tint fd;\n\n\t/* open file for writing */\n\tfd = open(file_path, O_WRONLY, 0700);\n\tif (fd < 0) {\n\t\tdebug2(\"%s: unable to open '%s' for writing : %m\",\n\t\t\t__func__, file_path);\n\t\treturn XCGROUP_ERROR;\n\t}\n\n\t/* write content */\n\tdo {\n\t\trc = write(fd, content, csize);\n\t} while (rc < 0 && errno == EINTR);\n\n\t/* check read size */\n\tif (rc < csize) {\n\t\tdebug2(\"%s: unable to write %lu bytes to file '%s' : %m\",\n\t\t\t__func__, (long unsigned int) csize, file_path);\n\t\tfstatus = XCGROUP_ERROR;\n\t} else\n\t\tfstatus = XCGROUP_SUCCESS;\n\n\t/* close file */\n\tclose(fd);\n\n\treturn fstatus;\n}",
          "includes": [
            "#include \"xcgroup.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/log.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include \"slurm/slurm.h\"",
            "#include <sys/mount.h>",
            "#include <dirent.h>",
            "#include <strings.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <sys/file.h>",
            "#  include <inttypes.h>",
            "#  include <stdint.h>",
            "#   include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "size_t _file_getsize(int fd);",
            "int _file_read_content(char* file_path, char** content, size_t *csize);",
            "int _file_write_content(char* file_path, char* content, size_t csize);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"xcgroup.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/log.h\"\n#include \"slurm/slurm_errno.h\"\n#include \"slurm/slurm.h\"\n#include <sys/mount.h>\n#include <dirent.h>\n#include <strings.h>\n#include <string.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <sys/file.h>\n#  include <inttypes.h>\n#  include <stdint.h>\n#   include \"config.h\"\n\nsize_t _file_getsize(int fd);\nint _file_read_content(char* file_path, char** content, size_t *csize);\nint _file_write_content(char* file_path, char* content, size_t csize);\n\nint _file_write_content(char* file_path, char* content, size_t csize)\n{\n\tint fstatus;\n\tint rc;\n\tint fd;\n\n\t/* open file for writing */\n\tfd = open(file_path, O_WRONLY, 0700);\n\tif (fd < 0) {\n\t\tdebug2(\"%s: unable to open '%s' for writing : %m\",\n\t\t\t__func__, file_path);\n\t\treturn XCGROUP_ERROR;\n\t}\n\n\t/* write content */\n\tdo {\n\t\trc = write(fd, content, csize);\n\t} while (rc < 0 && errno == EINTR);\n\n\t/* check read size */\n\tif (rc < csize) {\n\t\tdebug2(\"%s: unable to write %lu bytes to file '%s' : %m\",\n\t\t\t__func__, (long unsigned int) csize, file_path);\n\t\tfstatus = XCGROUP_ERROR;\n\t} else\n\t\tfstatus = XCGROUP_SUCCESS;\n\n\t/* close file */\n\tclose(fd);\n\n\treturn fstatus;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int exec_wait_signal_child (struct exec_wait_info *e)\n{\n\tchar c = '\\0';\n\n\tif (write (e->parentfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"write to unblock task %d failed: %m\", e->id);\n\n\treturn (0);\n}"
  },
  {
    "function_name": "_exec_wait_child_wait_for_parent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1488-1496",
    "snippet": "static int _exec_wait_child_wait_for_parent (struct exec_wait_info *e)\n{\n\tchar c;\n\n\tif (read (e->childfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"_exec_wait_child_wait_for_parent: failed: %m\");\n\n\treturn (0);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_exec_wait_child_wait_for_parent: failed: %m\""
          ],
          "line": 1493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "e->childfd",
            "&c",
            "sizeof (c)"
          ],
          "line": 1492
        },
        "resolved": true,
        "details": {
          "function_name": "_file_read_content",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/xcgroup.c",
          "lines": "1149-1197",
          "snippet": "int _file_read_content(char* file_path, char** content, size_t *csize)\n{\n\tint fstatus;\n\tint rc;\n\tint fd;\n\n\tsize_t fsize;\n\tchar* buf;\n\n\tfstatus = XCGROUP_ERROR;\n\n\t/* check input pointers */\n\tif (content == NULL || csize == NULL)\n\t\treturn fstatus;\n\n\t/* open file for reading */\n\tfd = open(file_path, O_RDONLY, 0700);\n\tif (fd < 0) {\n\t\tdebug2(\"%s: unable to open '%s' for reading : %m\",\n\t\t\t__func__, file_path);\n\t\treturn fstatus;\n\t}\n\n\t/* get file size */\n\tfsize=_file_getsize(fd);\n\tif (fsize == -1) {\n\t\tclose(fd);\n\t\treturn fstatus;\n\t}\n\n\t/* read file contents */\n\tbuf = (char*) xmalloc((fsize+1)*sizeof(char));\n\tbuf[fsize]='\\0';\n\tdo {\n\t\trc = read(fd, buf, fsize);\n\t} while (rc < 0 && errno == EINTR);\n\n\t/* set output values */\n\tif (rc >= 0) {\n\t\t*content = buf;\n\t\t*csize = rc;\n\t\tfstatus = XCGROUP_SUCCESS;\n\t}\n\n\t/* close file */\n\tclose(fd);\n\n\treturn fstatus;\n}",
          "includes": [
            "#include \"xcgroup.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/log.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include \"slurm/slurm.h\"",
            "#include <sys/mount.h>",
            "#include <dirent.h>",
            "#include <strings.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <sys/file.h>",
            "#  include <inttypes.h>",
            "#  include <stdint.h>",
            "#   include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "size_t _file_getsize(int fd);",
            "int _file_read_content(char* file_path, char** content, size_t *csize);",
            "int _file_write_content(char* file_path, char* content, size_t csize);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"xcgroup.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/log.h\"\n#include \"slurm/slurm_errno.h\"\n#include \"slurm/slurm.h\"\n#include <sys/mount.h>\n#include <dirent.h>\n#include <strings.h>\n#include <string.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <sys/file.h>\n#  include <inttypes.h>\n#  include <stdint.h>\n#   include \"config.h\"\n\nsize_t _file_getsize(int fd);\nint _file_read_content(char* file_path, char** content, size_t *csize);\nint _file_write_content(char* file_path, char* content, size_t csize);\n\nint _file_read_content(char* file_path, char** content, size_t *csize)\n{\n\tint fstatus;\n\tint rc;\n\tint fd;\n\n\tsize_t fsize;\n\tchar* buf;\n\n\tfstatus = XCGROUP_ERROR;\n\n\t/* check input pointers */\n\tif (content == NULL || csize == NULL)\n\t\treturn fstatus;\n\n\t/* open file for reading */\n\tfd = open(file_path, O_RDONLY, 0700);\n\tif (fd < 0) {\n\t\tdebug2(\"%s: unable to open '%s' for reading : %m\",\n\t\t\t__func__, file_path);\n\t\treturn fstatus;\n\t}\n\n\t/* get file size */\n\tfsize=_file_getsize(fd);\n\tif (fsize == -1) {\n\t\tclose(fd);\n\t\treturn fstatus;\n\t}\n\n\t/* read file contents */\n\tbuf = (char*) xmalloc((fsize+1)*sizeof(char));\n\tbuf[fsize]='\\0';\n\tdo {\n\t\trc = read(fd, buf, fsize);\n\t} while (rc < 0 && errno == EINTR);\n\n\t/* set output values */\n\tif (rc >= 0) {\n\t\t*content = buf;\n\t\t*csize = rc;\n\t\tfstatus = XCGROUP_SUCCESS;\n\t}\n\n\t/* close file */\n\tclose(fd);\n\n\treturn fstatus;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int _exec_wait_child_wait_for_parent (struct exec_wait_info *e)\n{\n\tchar c;\n\n\tif (read (e->childfd, &c, sizeof (c)) != 1)\n\t\treturn error (\"_exec_wait_child_wait_for_parent: failed: %m\");\n\n\treturn (0);\n}"
  },
  {
    "function_name": "_fork_child_with_wait_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1464-1486",
    "snippet": "static struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "e->childfd"
          ],
          "line": 1482
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_local_fds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1463-1487",
          "snippet": "void\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static bool _task_writable(eio_obj_t *);",
            "static bool _task_readable(eio_obj_t *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void *_io_thr(void *arg);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic bool _task_writable(eio_obj_t *);\nstatic bool _task_readable(eio_obj_t *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void *_io_thr(void *arg);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nvoid\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_exec_wait_info_destroy",
          "args": [
            "e"
          ],
          "line": 1472
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_info_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1439-1455",
          "snippet": "static void _exec_wait_info_destroy (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn;\n\n\tif (e->parentfd >= 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t}\n\tif (e->childfd >= 0) {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\te->id = -1;\n\te->pid = -1;\n\txfree(e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _exec_wait_info_destroy (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn;\n\n\tif (e->parentfd >= 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t}\n\tif (e->childfd >= 0) {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\te->id = -1;\n\te->pid = -1;\n\txfree(e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 1471
        },
        "resolved": true,
        "details": {
          "function_name": "_install_fork_handlers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd.c",
          "lines": "1991-1999",
          "snippet": "static void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/slurmd/req.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/stepd_api.h\"",
            "#include \"src/common/slurm_topology.h\"",
            "#include \"src/common/slurm_strcasestr.h\"",
            "#include \"src/common/slurm_route.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_mcs.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_acct_gather_energy.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_auth.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/proc_args.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/parse_time.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/pack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/node_features.h\"",
            "#include \"src/common/node_conf.h\"",
            "#include \"src/common/msg_aggr.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/daemonize.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/bitstring.h\"",
            "#include <unistd.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/resource.h>",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pthread.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <dlfcn.h>",
            "#include <dirent.h>",
            "#  include <hwloc.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void      _atfork_final(void);",
            "static void      _atfork_prepare(void);",
            "static void      _install_fork_handlers(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/slurmd/req.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/stepd_api.h\"\n#include \"src/common/slurm_topology.h\"\n#include \"src/common/slurm_strcasestr.h\"\n#include \"src/common/slurm_route.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_mcs.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_acct_gather_energy.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_auth.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/proc_args.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/parse_time.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/pack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/node_features.h\"\n#include \"src/common/node_conf.h\"\n#include \"src/common/msg_aggr.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/daemonize.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/bitstring.h\"\n#include <unistd.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <dlfcn.h>\n#include <dirent.h>\n#  include <hwloc.h>\n#  include \"config.h\"\n\nstatic void      _atfork_final(void);\nstatic void      _atfork_prepare(void);\nstatic void      _install_fork_handlers(void);\n\nstatic void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_exec_wait_info_create",
          "args": [
            "id"
          ],
          "line": 1468
        },
        "resolved": true,
        "details": {
          "function_name": "_exec_wait_info_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1417-1437",
          "snippet": "static struct exec_wait_info * _exec_wait_info_create (int i)\n{\n\tint fdpair[2];\n\tstruct exec_wait_info * e;\n\n\tif (pipe (fdpair) < 0) {\n\t\terror (\"_exec_wait_info_create: pipe: %m\");\n\t\treturn NULL;\n\t}\n\n\tfd_set_close_on_exec(fdpair[0]);\n\tfd_set_close_on_exec(fdpair[1]);\n\n\te = xmalloc (sizeof (*e));\n\te->childfd = fdpair[0];\n\te->parentfd = fdpair[1];\n\te->id = i;\n\te->pid = -1;\n\n\treturn (e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _exec_wait_info_create (int i)\n{\n\tint fdpair[2];\n\tstruct exec_wait_info * e;\n\n\tif (pipe (fdpair) < 0) {\n\t\terror (\"_exec_wait_info_create: pipe: %m\");\n\t\treturn NULL;\n\t}\n\n\tfd_set_close_on_exec(fdpair[0]);\n\tfd_set_close_on_exec(fdpair[1]);\n\n\te = xmalloc (sizeof (*e));\n\te->childfd = fdpair[0];\n\te->parentfd = fdpair[1];\n\te->id = i;\n\te->pid = -1;\n\n\treturn (e);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}"
  },
  {
    "function_name": "_exec_wait_get_pid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1457-1462",
    "snippet": "static pid_t _exec_wait_get_pid (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn (-1);\n\treturn (e->pid);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic pid_t _exec_wait_get_pid (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn (-1);\n\treturn (e->pid);\n}"
  },
  {
    "function_name": "_exec_wait_info_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1439-1455",
    "snippet": "static void _exec_wait_info_destroy (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn;\n\n\tif (e->parentfd >= 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t}\n\tif (e->childfd >= 0) {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\te->id = -1;\n\te->pid = -1;\n\txfree(e);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "e"
          ],
          "line": 1454
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "e->childfd"
          ],
          "line": 1449
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_local_fds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1463-1487",
          "snippet": "void\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static bool _task_writable(eio_obj_t *);",
            "static bool _task_readable(eio_obj_t *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void *_io_thr(void *arg);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic bool _task_writable(eio_obj_t *);\nstatic bool _task_readable(eio_obj_t *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void *_io_thr(void *arg);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nvoid\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _exec_wait_info_destroy (struct exec_wait_info *e)\n{\n\tif (e == NULL)\n\t\treturn;\n\n\tif (e->parentfd >= 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t}\n\tif (e->childfd >= 0) {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\te->id = -1;\n\te->pid = -1;\n\txfree(e);\n}"
  },
  {
    "function_name": "_exec_wait_info_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1417-1437",
    "snippet": "static struct exec_wait_info * _exec_wait_info_create (int i)\n{\n\tint fdpair[2];\n\tstruct exec_wait_info * e;\n\n\tif (pipe (fdpair) < 0) {\n\t\terror (\"_exec_wait_info_create: pipe: %m\");\n\t\treturn NULL;\n\t}\n\n\tfd_set_close_on_exec(fdpair[0]);\n\tfd_set_close_on_exec(fdpair[1]);\n\n\te = xmalloc (sizeof (*e));\n\te->childfd = fdpair[0];\n\te->parentfd = fdpair[1];\n\te->id = i;\n\te->pid = -1;\n\n\treturn (e);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof (*e)"
          ],
          "line": 1430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fd_set_close_on_exec",
          "args": [
            "fdpair[1]"
          ],
          "line": 1428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fd_set_close_on_exec",
          "args": [
            "fdpair[0]"
          ],
          "line": 1427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_exec_wait_info_create: pipe: %m\""
          ],
          "line": 1423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pipe",
          "args": [
            "fdpair"
          ],
          "line": 1422
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _exec_wait_info_create (int i)\n{\n\tint fdpair[2];\n\tstruct exec_wait_info * e;\n\n\tif (pipe (fdpair) < 0) {\n\t\terror (\"_exec_wait_info_create: pipe: %m\");\n\t\treturn NULL;\n\t}\n\n\tfd_set_close_on_exec(fdpair[0]);\n\tfd_set_close_on_exec(fdpair[1]);\n\n\te = xmalloc (sizeof (*e));\n\te->childfd = fdpair[0];\n\te->parentfd = fdpair[1];\n\te->id = i;\n\te->pid = -1;\n\n\treturn (e);\n}"
  },
  {
    "function_name": "_pre_task_privileged",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1394-1408",
    "snippet": "static int\n_pre_task_privileged(stepd_step_rec_t *job, int taskid, struct priv_state *sp)\n{\n\tif (_reclaim_privileges(sp) < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (spank_task_privileged (job, taskid) < 0)\n\t\treturn error(\"spank_task_init_privileged failed\");\n\n\tif (task_g_pre_launch_priv(job) < 0)\n\t\treturn error(\"pre_launch_priv failed\");\n\n\t/* sp->gid_list should already be initialized */\n\treturn(_drop_privileges (job, true, sp, false));\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "_drop_privileges",
          "args": [
            "job",
            "true",
            "sp",
            "false"
          ],
          "line": 1407
        },
        "resolved": true,
        "details": {
          "function_name": "_drop_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2422-2478",
          "snippet": "static int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"pre_launch_priv failed\""
          ],
          "line": 1404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_g_pre_launch_priv",
          "args": [
            "job"
          ],
          "line": 1403
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_pre_launch_priv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "349-362",
          "snippet": "extern int task_g_pre_launch_priv(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_launch_priv))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_pre_launch_priv(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_launch_priv))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"spank_task_init_privileged failed\""
          ],
          "line": 1401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_task_privileged",
          "args": [
            "job",
            "taskid"
          ],
          "line": 1400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_reclaim_privileges",
          "args": [
            "sp"
          ],
          "line": 1397
        },
        "resolved": true,
        "details": {
          "function_name": "_reclaim_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2480-2502",
          "snippet": "static int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_pre_task_privileged(stepd_step_rec_t *job, int taskid, struct priv_state *sp)\n{\n\tif (_reclaim_privileges(sp) < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (spank_task_privileged (job, taskid) < 0)\n\t\treturn error(\"spank_task_init_privileged failed\");\n\n\tif (task_g_pre_launch_priv(job) < 0)\n\t\treturn error(\"pre_launch_priv failed\");\n\n\t/* sp->gid_list should already be initialized */\n\treturn(_drop_privileges (job, true, sp, false));\n}"
  },
  {
    "function_name": "job_manager",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "1112-1392",
    "snippet": "int\njob_manager(stepd_step_rec_t *job)\n{\n\tint  rc = SLURM_SUCCESS;\n\tbool io_initialized = false;\n\tchar *ckpt_type = slurm_get_checkpoint_type();\n\n\tdebug3(\"Entered job_manager for %u.%u pid=%d\",\n\t       job->jobid, job->stepid, job->jmgr_pid);\n\n#ifdef PR_SET_DUMPABLE\n\tif (prctl(PR_SET_DUMPABLE, 1) < 0)\n\t\tdebug (\"Unable to set dumpable to 1\");\n#endif /* PR_SET_DUMPABLE */\n\n\t/* run now so we don't drop permissions on any of the gather plugins */\n\tacct_gather_conf_init();\n\n\t/*\n\t * Preload all plugins at start time to avoid plugin changes\n\t * (i.e. due to a Slurm upgrade) after the process starts.\n\t */\n\tif ((core_spec_g_init() != SLURM_SUCCESS)\t\t||\n\t    (switch_init() != SLURM_SUCCESS)\t\t\t||\n\t    (slurmd_task_init() != SLURM_SUCCESS)\t\t||\n\t    (slurm_proctrack_init() != SLURM_SUCCESS)\t\t||\n\t    (checkpoint_init(ckpt_type) != SLURM_SUCCESS)\t||\n\t    (jobacct_gather_init() != SLURM_SUCCESS)\t\t||\n\t    (acct_gather_profile_init() != SLURM_SUCCESS)\t||\n\t    (slurm_crypto_init() != SLURM_SUCCESS)\t\t||\n\t    (job_container_init() != SLURM_SUCCESS)\t\t||\n\t    (gres_plugin_init() != SLURM_SUCCESS)) {\n\t\trc = SLURM_PLUGIN_NAME_INVALID;\n\t\tgoto fail1;\n\t}\n\tif (mpi_hook_slurmstepd_init(&job->env) != SLURM_SUCCESS) {\n\t\trc = SLURM_MPI_PLUGIN_NAME_INVALID;\n\t\tgoto fail1;\n\t}\n\n\tif (!job->batch && (job->stepid != SLURM_EXTERN_CONT) &&\n\t    (switch_g_job_preinit(job->switch_job) < 0)) {\n\t\trc = ESLURM_INTERCONNECT_FAILURE;\n\t\tgoto fail1;\n\t}\n\n\tif ((job->cont_id == 0) &&\n\t    (proctrack_g_create(job) != SLURM_SUCCESS)) {\n\t\terror(\"proctrack_g_create: %m\");\n\t\trc = ESLURMD_SETUP_ENVIRONMENT_ERROR;\n\t\tgoto fail1;\n\t}\n\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn _spawn_job_container(job);\n\n\tif (!job->batch && job->accel_bind_type) {\n\t\t(void) gres_plugin_node_config_load(conf->cpus, conf->node_name,\n\t\t\t\t\t\t    (void *)&xcpuinfo_abs_to_mac);\n\t}\n\n#ifdef HAVE_ALPS_CRAY\n\t/*\n\t * Note that the previously called proctrack_g_create function is\n\t * mandatory since the select/cray plugin needs the job container\n\t * ID in order to CONFIRM the ALPS reservation.\n\t * It is not a good idea to perform this setup in _fork_all_tasks(),\n\t * since any transient failure of ALPS (which can happen in practice)\n\t * will then set the frontend node to DRAIN.\n\t *\n\t * ALso note that we do not check the reservation for batch jobs with\n\t * a reservation ID of zero and no CPUs. These are SLURM job\n\t * allocations containing no compute nodes and thus have no ALPS\n\t * reservation.\n\t */\n\tif (!job->batch || job->resv_id || job->cpus) {\n\t\trc = _select_cray_plugin_job_ready(job);\n\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t/*\n\t\t\t * Transient error: slurmctld knows this condition to\n\t\t\t * mean that the ALPS (not the SLURM) reservation\n\t\t\t * failed and tries again.\n\t\t\t */\n\t\t\tif (rc == READY_JOB_ERROR)\n\t\t\t\trc = ESLURM_RESERVATION_NOT_USABLE;\n\t\t\telse\n\t\t\t\trc = ESLURMD_SETUP_ENVIRONMENT_ERROR;\n\t\t\terror(\"could not confirm ALPS reservation #%u\",\n\t\t\t      job->resv_id);\n\t\t\tgoto fail1;\n\t\t}\n\t}\n#endif\n\n\tdebug2(\"Before call to spank_init()\");\n\tif (spank_init (job) < 0) {\n\t\terror (\"Plugin stack initialization failed.\");\n\t\trc = SLURM_PLUGIN_NAME_INVALID;\n\t\tgoto fail1;\n\t}\n\tdebug2(\"After call to spank_init()\");\n\n\t/* Call switch_g_job_init() before becoming user */\n\tif (!job->batch && job->argv && (switch_g_job_init(job) < 0)) {\n\t\t/* error(\"switch_g_job_init: %m\"); already logged */\n\t\trc = ESLURM_INTERCONNECT_FAILURE;\n\t\tgoto fail2;\n\t}\n\n\t/* fork necessary threads for checkpoint */\n\tif (checkpoint_stepd_prefork(job) != SLURM_SUCCESS) {\n\t\terror(\"Failed checkpoint_stepd_prefork\");\n\t\trc = SLURM_FAILURE;\n\t\tio_close_task_fds(job);\n\t\tgoto fail2;\n\t}\n\n\t/* fork necessary threads for MPI */\n\tif (mpi_hook_slurmstepd_prefork(job, &job->env) != SLURM_SUCCESS) {\n\t\terror(\"Failed mpi_hook_slurmstepd_prefork\");\n\t\trc = SLURM_FAILURE;\n\t\tgoto fail2;\n\t}\n\n\tif (!job->batch && job->accel_bind_type && (job->node_tasks <= 1))\n\t\tjob->accel_bind_type = 0;\n\tif (!job->batch && job->accel_bind_type && (job->node_tasks > 1)) {\n\t\tuint64_t gpu_cnt, mic_cnt, nic_cnt;\n\t\tgpu_cnt = gres_plugin_step_count(job->step_gres_list, \"gpu\");\n\t\tmic_cnt = gres_plugin_step_count(job->step_gres_list, \"mic\");\n\t\tnic_cnt = gres_plugin_step_count(job->step_gres_list, \"nic\");\n\t\tif ((gpu_cnt <= 1) || (gpu_cnt == NO_VAL64))\n\t\t\tjob->accel_bind_type &= (~ACCEL_BIND_CLOSEST_GPU);\n\t\tif ((mic_cnt <= 1) || (mic_cnt == NO_VAL64))\n\t\t\tjob->accel_bind_type &= (~ACCEL_BIND_CLOSEST_MIC);\n\t\tif ((nic_cnt <= 1) || (nic_cnt == NO_VAL64))\n\t\t\tjob->accel_bind_type &= (~ACCEL_BIND_CLOSEST_NIC);\n\t\tif (job->accel_bind_type == ACCEL_BIND_VERBOSE)\n\t\t\tjob->accel_bind_type = 0;\n\t}\n\n\t/* Calls pam_setup() and requires pam_finish() if\n\t * successful.  Only check for < 0 here since other slurm\n\t * error codes could come that are more descriptive. */\n\tif ((rc = _fork_all_tasks(job, &io_initialized)) < 0) {\n\t\tdebug(\"_fork_all_tasks failed\");\n\t\trc = ESLURMD_EXECVE_FAILED;\n\t\tgoto fail2;\n\t}\n\n\t/*\n\t * If IO initialization failed, return SLURM_SUCCESS (on a\n\t * batch step) or the node will be drain otherwise.  Regular\n\t * srun needs the error sent or it will hang waiting for the\n\t * launch to happen.\n\t */\n\tif ((rc != SLURM_SUCCESS) || !io_initialized)\n\t\tgoto fail2;\n\n\tio_close_task_fds(job);\n\n\txsignal_block (mgr_sigarray);\n\treattach_job = job;\n\n\t_set_job_state(job, SLURMSTEPD_STEP_RUNNING);\n\n\t/* Attach slurmstepd to system cgroups, if configured */\n\tattach_system_cgroup_pid(getpid());\n\n\t/* if we are not polling then we need to make sure we get some\n\t * information here\n\t */\n\tif (!conf->job_acct_gather_freq)\n\t\tjobacct_gather_stat_task(0);\n\n\t/* Send job launch response with list of pids */\n\t_send_launch_resp(job, 0);\n\n#ifdef PR_SET_DUMPABLE\n\t/* RHEL6 requires setting \"dumpable\" flag AGAIN; after euid changes */\n\tif (prctl(PR_SET_DUMPABLE, 1) < 0)\n\t\tdebug (\"Unable to set dumpable to 1\");\n#endif /* PR_SET_DUMPABLE */\n\n\t_wait_for_all_tasks(job);\n\tacct_gather_profile_endpoll();\n\tacct_gather_profile_g_node_step_end();\n\tacct_gather_profile_fini();\n\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\n\tif (!job->batch &&\n\t    (switch_g_job_fini(job->switch_job) < 0)) {\n\t\terror(\"switch_g_job_fini: %m\");\n\t}\n\nfail2:\n\t/*\n\t * First call switch_g_job_postfini() - In at least one case,\n\t * this will clean up any straggling processes. If this call\n\t * is moved behind wait_for_io(), we may block waiting for IO\n\t * on a hung process.\n\t *\n\t * Make sure all processes in session are dead. On systems\n\t * with an IBM Federation switch, all processes must be\n\t * terminated before the switch window can be released by\n\t * switch_g_job_postfini().\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tstep_terminate_monitor_start(job->jobid, job->stepid);\n\tif (job->cont_id != 0) {\n\t\tproctrack_g_signal(job->cont_id, SIGKILL);\n\t\tproctrack_g_wait(job->cont_id);\n\t}\n\tstep_terminate_monitor_stop();\n\tif (!job->batch) {\n\t\tif (switch_g_job_postfini(job) < 0)\n\t\t\terror(\"switch_g_job_postfini: %m\");\n\t}\n\n\t/*\n\t * Wait for io thread to complete (if there is one)\n\t */\n\tif (!job->batch && !job->user_managed_io && io_initialized)\n\t\t_wait_for_io(job);\n\n\t/*\n\t * Warn task plugin that the user's step have terminated\n\t */\n\ttask_g_post_step(job);\n\n\t/*\n\t * Reset cpu frequency if it was changed\n\t */\n\tif (job->cpu_freq_min != NO_VAL || job->cpu_freq_max != NO_VAL ||\n\t    job->cpu_freq_gov != NO_VAL)\n\t\tcpu_freq_reset(job);\n\n\t/* Notify srun of completion AFTER frequency reset to avoid race\n\t * condition starting another job on these CPUs. */\n\twhile (_send_pending_exit_msgs(job)) {;}\n\n\t/*\n\t * This just cleans up all of the PAM state in case rc == 0\n\t * which means _fork_all_tasks performs well.\n\t * Must be done after IO termination in case of IO operations\n\t * require something provided by the PAM (i.e. security token)\n\t */\n\tif (!rc)\n\t\tpam_finish();\n\n\tdebug2(\"Before call to spank_fini()\");\n\tif (spank_fini (job)  < 0) {\n\t\terror (\"spank_fini failed\");\n\t}\n\tdebug2(\"After call to spank_fini()\");\n\nfail1:\n\t/* If interactive job startup was abnormal,\n\t * be sure to notify client.\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tif (rc != 0) {\n\t\terror(\"job_manager exiting abnormally, rc = %d\", rc);\n\t\t_send_launch_resp(job, rc);\n\t}\n\n\tif (!job->batch && (step_complete.rank > -1)) {\n\t\tif (job->aborted)\n\t\t\tinfo(\"job_manager exiting with aborted job\");\n\t\telse\n\t\t\t_wait_for_children_slurmstepd(job);\n\t\t_send_step_complete_msgs(job);\n\t}\n\n\tif (!job->batch && core_spec_g_clear(job->cont_id))\n\t\terror(\"core_spec_g_clear: %m\");\n\n\txfree(ckpt_type);\n\treturn(rc);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int mgr_sigarray[] = {\n\tSIGINT,  SIGTERM, SIGTSTP,\n\tSIGQUIT, SIGPIPE, SIGUSR1,\n\tSIGUSR2, SIGALRM, SIGHUP, 0\n};",
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static int  _fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _reclaim_privileges(struct priv_state *state);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);",
      "static stepd_step_rec_t *reattach_job;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "ckpt_type"
          ],
          "line": 1390
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"core_spec_g_clear: %m\""
          ],
          "line": 1388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "core_spec_g_clear",
          "args": [
            "job->cont_id"
          ],
          "line": 1387
        },
        "resolved": true,
        "details": {
          "function_name": "core_spec_g_clear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/core_spec_plugin.c",
          "lines": "196-209",
          "snippet": "extern int core_spec_g_clear(uint64_t cont_id)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (core_spec_g_init() != SLURM_SUCCESS)\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_core_spec_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].core_spec_p_clear))(cont_id);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static core_spec_ops_t\t\t*ops = NULL;",
            "static int\t\t\tg_core_spec_context_num = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic core_spec_ops_t\t\t*ops = NULL;\nstatic int\t\t\tg_core_spec_context_num = -1;\n\nextern int core_spec_g_clear(uint64_t cont_id)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (core_spec_g_init() != SLURM_SUCCESS)\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_core_spec_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].core_spec_p_clear))(cont_id);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_send_step_complete_msgs",
          "args": [
            "job"
          ],
          "line": 1384
        },
        "resolved": true,
        "details": {
          "function_name": "_send_step_complete_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "937-975",
          "snippet": "static void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_wait_for_children_slurmstepd",
          "args": [
            "job"
          ],
          "line": 1383
        },
        "resolved": true,
        "details": {
          "function_name": "_wait_for_children_slurmstepd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "734-774",
          "snippet": "static void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"job_manager exiting with aborted job\""
          ],
          "line": 1381
        },
        "resolved": true,
        "details": {
          "function_name": "_fork_child_with_wait_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1464-1486",
          "snippet": "static struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_send_launch_resp",
          "args": [
            "job",
            "rc"
          ],
          "line": 1376
        },
        "resolved": true,
        "details": {
          "function_name": "_send_launch_resp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2316-2352",
          "snippet": "static void\n_send_launch_resp(stepd_step_rec_t *job, int rc)\n{\n\tint i;\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tsrun_info_t *srun = list_peek(job->sruns);\n\n\tif (job->batch)\n\t\treturn;\n\n\tdebug(\"Sending launch resp rc=%d\", rc);\n\n\tslurm_msg_t_init(&resp_msg);\n\tresp_msg.address\t= srun->resp_addr;\n\tresp_msg.protocol_version = srun->protocol_version;\n\tresp_msg.data\t\t= &resp;\n\tresp_msg.msg_type\t= RESPONSE_LAUNCH_TASKS;\n\n\tresp.node_name\t\t= xstrdup(job->node_name);\n\tresp.return_code\t= rc;\n\tresp.count_of_pids\t= job->node_tasks;\n\n\tresp.local_pids = xmalloc(job->node_tasks * sizeof(*resp.local_pids));\n\tresp.task_ids = xmalloc(job->node_tasks * sizeof(*resp.task_ids));\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tresp.local_pids[i] = job->task[i]->pid;\n\t\tresp.task_ids[i] = job->task[i]->gtid;\n\t}\n\n\tif (_send_srun_resp_msg(&resp_msg, job->nnodes) != SLURM_SUCCESS)\n\t\terror(\"failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\n\txfree(resp.local_pids);\n\txfree(resp.task_ids);\n\txfree(resp.node_name);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_send_launch_resp(stepd_step_rec_t *job, int rc)\n{\n\tint i;\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tsrun_info_t *srun = list_peek(job->sruns);\n\n\tif (job->batch)\n\t\treturn;\n\n\tdebug(\"Sending launch resp rc=%d\", rc);\n\n\tslurm_msg_t_init(&resp_msg);\n\tresp_msg.address\t= srun->resp_addr;\n\tresp_msg.protocol_version = srun->protocol_version;\n\tresp_msg.data\t\t= &resp;\n\tresp_msg.msg_type\t= RESPONSE_LAUNCH_TASKS;\n\n\tresp.node_name\t\t= xstrdup(job->node_name);\n\tresp.return_code\t= rc;\n\tresp.count_of_pids\t= job->node_tasks;\n\n\tresp.local_pids = xmalloc(job->node_tasks * sizeof(*resp.local_pids));\n\tresp.task_ids = xmalloc(job->node_tasks * sizeof(*resp.task_ids));\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tresp.local_pids[i] = job->task[i]->pid;\n\t\tresp.task_ids[i] = job->task[i]->gtid;\n\t}\n\n\tif (_send_srun_resp_msg(&resp_msg, job->nnodes) != SLURM_SUCCESS)\n\t\terror(\"failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\n\txfree(resp.local_pids);\n\txfree(resp.task_ids);\n\txfree(resp.node_name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"job_manager exiting abnormally, rc = %d\"",
            "rc"
          ],
          "line": 1375
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_set_job_state",
          "args": [
            "job",
            "SLURMSTEPD_STEP_ENDING"
          ],
          "line": 1373
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "986-992",
          "snippet": "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _reclaim_privileges(struct priv_state *state);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"After call to spank_fini()\""
          ],
          "line": 1367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"spank_fini failed\""
          ],
          "line": 1365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_fini",
          "args": [
            "job"
          ],
          "line": 1364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Before call to spank_fini()\""
          ],
          "line": 1363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pam_finish",
          "args": [],
          "line": 1361
        },
        "resolved": true,
        "details": {
          "function_name": "pam_finish",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pam_ses.c",
          "lines": "173-176",
          "snippet": "void pam_finish ()\n{\n\t/* Don't have PAM support, do nothing. */\n}",
          "includes": [
            "#  include <security/pam_misc.h>",
            "#  include <security/pam_appl.h>",
            "#  include <pam/pam_misc.h>",
            "#  include <pam/pam_appl.h>",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <security/pam_misc.h>\n#  include <security/pam_appl.h>\n#  include <pam/pam_misc.h>\n#  include <pam/pam_appl.h>\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/log.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"slurm/slurm_errno.h\"\n#  include \"config.h\"\n\nvoid pam_finish ()\n{\n\t/* Don't have PAM support, do nothing. */\n}"
        }
      },
      {
        "call_info": {
          "callee": "_send_pending_exit_msgs",
          "args": [
            "job"
          ],
          "line": 1352
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cpu_freq_reset",
          "args": [
            "job"
          ],
          "line": 1348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_g_post_step",
          "args": [
            "job"
          ],
          "line": 1341
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_post_step",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "410-423",
          "snippet": "extern int task_g_post_step(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].post_step))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_post_step(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].post_step))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_wait_for_io",
          "args": [
            "job"
          ],
          "line": 1336
        },
        "resolved": true,
        "details": {
          "function_name": "_wait_for_io",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2149-2168",
          "snippet": "static void\n_wait_for_io(stepd_step_rec_t *job)\n{\n\tdebug(\"Waiting for IO\");\n\tio_close_all(job);\n\n\t/*\n\t * Wait until IO thread exits or kill it after 300 seconds\n\t */\n\tif (job->ioid) {\n\t\t_delay_kill_thread(job->ioid, 300);\n\t\tpthread_join(job->ioid, NULL);\n\t} else\n\t\tinfo(\"_wait_for_io: ioid==0\");\n\n\t/* Close any files for stdout/stderr opened by the stepd */\n\tio_close_local_fds(job);\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_io(stepd_step_rec_t *job)\n{\n\tdebug(\"Waiting for IO\");\n\tio_close_all(job);\n\n\t/*\n\t * Wait until IO thread exits or kill it after 300 seconds\n\t */\n\tif (job->ioid) {\n\t\t_delay_kill_thread(job->ioid, 300);\n\t\tpthread_join(job->ioid, NULL);\n\t} else\n\t\tinfo(\"_wait_for_io: ioid==0\");\n\n\t/* Close any files for stdout/stderr opened by the stepd */\n\tio_close_local_fds(job);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"switch_g_job_postfini: %m\""
          ],
          "line": 1329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "switch_g_job_postfini",
          "args": [
            "job"
          ],
          "line": 1328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "step_terminate_monitor_stop",
          "args": [],
          "line": 1326
        },
        "resolved": true,
        "details": {
          "function_name": "step_terminate_monitor_stop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/step_terminate_monitor.c",
          "lines": "94-119",
          "snippet": "void step_terminate_monitor_stop(void)\n{\n\tslurm_mutex_lock(&lock);\n\n\tif (!running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\tif (stop_flag) {\n\t\terror(\"step_terminate_monitor_stop: already stopped\");\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tstop_flag = 1;\n\tdebug(\"step_terminate_monitor_stop signalling condition\");\n\tpthread_cond_signal(&cond);\n\tslurm_mutex_unlock(&lock);\n\n\tif (pthread_join(tid, NULL) != 0) {\n\t\terror(\"step_terminate_monitor_stop: pthread_join: %m\");\n\t}\n\n\txfree(program_name);\n\treturn;\n}",
          "includes": [
            "#include <time.h>",
            "#include <pthread.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/macros.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;",
            "static pthread_cond_t cond = PTHREAD_COND_INITIALIZER;",
            "static int running_flag = 0;",
            "static int stop_flag = 0;",
            "static pthread_t tid;",
            "static char *program_name;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <pthread.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/macros.h\"\n#  include \"config.h\"\n\nstatic pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;\nstatic pthread_cond_t cond = PTHREAD_COND_INITIALIZER;\nstatic int running_flag = 0;\nstatic int stop_flag = 0;\nstatic pthread_t tid;\nstatic char *program_name;\n\nvoid step_terminate_monitor_stop(void)\n{\n\tslurm_mutex_lock(&lock);\n\n\tif (!running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\tif (stop_flag) {\n\t\terror(\"step_terminate_monitor_stop: already stopped\");\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tstop_flag = 1;\n\tdebug(\"step_terminate_monitor_stop signalling condition\");\n\tpthread_cond_signal(&cond);\n\tslurm_mutex_unlock(&lock);\n\n\tif (pthread_join(tid, NULL) != 0) {\n\t\terror(\"step_terminate_monitor_stop: pthread_join: %m\");\n\t}\n\n\txfree(program_name);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "proctrack_g_wait",
          "args": [
            "job->cont_id"
          ],
          "line": 1324
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "448-454",
          "snippet": "extern int proctrack_g_wait(uint64_t cont_id)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn (*(ops.wait)) (cont_id);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_wait(uint64_t cont_id)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn (*(ops.wait)) (cont_id);\n}"
        }
      },
      {
        "call_info": {
          "callee": "proctrack_g_signal",
          "args": [
            "job->cont_id",
            "SIGKILL"
          ],
          "line": 1323
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_signal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "348-397",
          "snippet": "extern int proctrack_g_signal(uint64_t cont_id, int signal)\n{\n\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (signal == SIGKILL) {\n\t\tpid_t *pids = NULL;\n\t\tint i, j, npids = 0, hung_pids = 0;\n\t\tchar *stat_fname = NULL;\n\t\tif (proctrack_g_get_pids(cont_id, &pids, &npids) ==\n\t\t    SLURM_SUCCESS) {\n\t\t\t/* NOTE: proctrack_g_get_pids() is not supported\n\t\t\t * by the proctrack/pgid plugin */\n\t\t\tfor (j = 0; j < 2; j++) {\n\t\t\t\tif (j)\n\t\t\t\t\tsleep(2);\n\t\t\t\thung_pids = 0;\n\t\t\t\tfor (i = 0; i < npids; i++) {\n\t\t\t\t\tif (!pids[i])\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\txstrfmtcat(stat_fname, \"/proc/%d/stat\",\n\t\t\t\t\t\t   (int) pids[i]);\n\t\t\t\t\tif (_test_core_dumping(stat_fname)) {\n\t\t\t\t\t\tdebug(\"Process %d continuing \"\n\t\t\t\t\t\t      \"core dump\",\n\t\t\t\t\t\t      (int) pids[i]);\n\t\t\t\t\t\thung_pids++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Don't test this PID again */\n\t\t\t\t\t\tpids[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t\txfree(stat_fname);\n\t\t\t\t}\n\t\t\t\tif (hung_pids == 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\txfree(pids);\n\t\t\tif (hung_pids) {\n\t\t\t\tinfo(\"Defering sending signal, processes in \"\n\t\t\t\t     \"job are currently core dumping\");\n\t\t\t\t_spawn_signal_thread(cont_id, signal);\n\t\t\t\treturn SLURM_SUCCESS;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (*(ops.signal)) (cont_id, signal);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_signal(uint64_t cont_id, int signal)\n{\n\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (signal == SIGKILL) {\n\t\tpid_t *pids = NULL;\n\t\tint i, j, npids = 0, hung_pids = 0;\n\t\tchar *stat_fname = NULL;\n\t\tif (proctrack_g_get_pids(cont_id, &pids, &npids) ==\n\t\t    SLURM_SUCCESS) {\n\t\t\t/* NOTE: proctrack_g_get_pids() is not supported\n\t\t\t * by the proctrack/pgid plugin */\n\t\t\tfor (j = 0; j < 2; j++) {\n\t\t\t\tif (j)\n\t\t\t\t\tsleep(2);\n\t\t\t\thung_pids = 0;\n\t\t\t\tfor (i = 0; i < npids; i++) {\n\t\t\t\t\tif (!pids[i])\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\txstrfmtcat(stat_fname, \"/proc/%d/stat\",\n\t\t\t\t\t\t   (int) pids[i]);\n\t\t\t\t\tif (_test_core_dumping(stat_fname)) {\n\t\t\t\t\t\tdebug(\"Process %d continuing \"\n\t\t\t\t\t\t      \"core dump\",\n\t\t\t\t\t\t      (int) pids[i]);\n\t\t\t\t\t\thung_pids++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Don't test this PID again */\n\t\t\t\t\t\tpids[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t\txfree(stat_fname);\n\t\t\t\t}\n\t\t\t\tif (hung_pids == 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\txfree(pids);\n\t\t\tif (hung_pids) {\n\t\t\t\tinfo(\"Defering sending signal, processes in \"\n\t\t\t\t     \"job are currently core dumping\");\n\t\t\t\t_spawn_signal_thread(cont_id, signal);\n\t\t\t\treturn SLURM_SUCCESS;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (*(ops.signal)) (cont_id, signal);\n}"
        }
      },
      {
        "call_info": {
          "callee": "step_terminate_monitor_start",
          "args": [
            "job->jobid",
            "job->stepid"
          ],
          "line": 1321
        },
        "resolved": true,
        "details": {
          "function_name": "step_terminate_monitor_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/step_terminate_monitor.c",
          "lines": "59-92",
          "snippet": "void step_terminate_monitor_start(uint32_t jobid, uint32_t stepid)\n{\n\tslurm_ctl_conf_t *conf;\n\tpthread_attr_t attr;\n\n\tslurm_mutex_lock(&lock);\n\n\tif (running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tconf = slurm_conf_lock();\n\tif (conf->unkillable_program == NULL) {\n\t\t/* do nothing */\n\t\tslurm_conf_unlock();\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\ttimeout = conf->unkillable_timeout;\n\tprogram_name = xstrdup(conf->unkillable_program);\n\tslurm_conf_unlock();\n\n\tslurm_attr_init(&attr);\n\tpthread_create(&tid, &attr, _monitor, NULL);\n\tslurm_attr_destroy(&attr);\n\trunning_flag = 1;\n\trecorded_jobid = jobid;\n\trecorded_stepid = stepid;\n\n\tslurm_mutex_unlock(&lock);\n\n\treturn;\n}",
          "includes": [
            "#include <time.h>",
            "#include <pthread.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/macros.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;",
            "static int running_flag = 0;",
            "static pthread_t tid;",
            "static uint16_t timeout;",
            "static char *program_name;",
            "static uint32_t recorded_jobid = NO_VAL;",
            "static uint32_t recorded_stepid = NO_VAL;",
            "static void *_monitor(void *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <pthread.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/macros.h\"\n#  include \"config.h\"\n\nstatic pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;\nstatic int running_flag = 0;\nstatic pthread_t tid;\nstatic uint16_t timeout;\nstatic char *program_name;\nstatic uint32_t recorded_jobid = NO_VAL;\nstatic uint32_t recorded_stepid = NO_VAL;\nstatic void *_monitor(void *);\n\nvoid step_terminate_monitor_start(uint32_t jobid, uint32_t stepid)\n{\n\tslurm_ctl_conf_t *conf;\n\tpthread_attr_t attr;\n\n\tslurm_mutex_lock(&lock);\n\n\tif (running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tconf = slurm_conf_lock();\n\tif (conf->unkillable_program == NULL) {\n\t\t/* do nothing */\n\t\tslurm_conf_unlock();\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\ttimeout = conf->unkillable_timeout;\n\tprogram_name = xstrdup(conf->unkillable_program);\n\tslurm_conf_unlock();\n\n\tslurm_attr_init(&attr);\n\tpthread_create(&tid, &attr, _monitor, NULL);\n\tslurm_attr_destroy(&attr);\n\trunning_flag = 1;\n\trecorded_jobid = jobid;\n\trecorded_stepid = stepid;\n\n\tslurm_mutex_unlock(&lock);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"switch_g_job_fini: %m\""
          ],
          "line": 1305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "switch_g_job_fini",
          "args": [
            "job->switch_job"
          ],
          "line": 1304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_fini",
          "args": [],
          "line": 1299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_node_step_end",
          "args": [],
          "line": 1298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_endpoll",
          "args": [],
          "line": 1297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_wait_for_all_tasks",
          "args": [
            "job"
          ],
          "line": 1296
        },
        "resolved": true,
        "details": {
          "function_name": "_wait_for_all_tasks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2071-2110",
          "snippet": "static void\n_wait_for_all_tasks(stepd_step_rec_t *job)\n{\n\tint tasks_left = 0;\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tif (job->task[i]->state < STEPD_STEP_TASK_COMPLETE) {\n\t\t\ttasks_left++;\n\t\t}\n\t}\n\tif (tasks_left < job->node_tasks)\n\t\tverbose(\"Only %d of %d requested tasks successfully launched\",\n\t\t\ttasks_left, job->node_tasks);\n\n\tfor (i = 0; i < tasks_left; ) {\n\t\tint rc;\n\t\trc = _wait_for_any_task(job, true);\n\t\tif (rc != -1) {\n\t\t\ti += rc;\n\t\t\tif (i < tasks_left) {\n\t\t\t\t/* To limit the amount of traffic back\n\t\t\t\t * we will sleep a bit to make sure we\n\t\t\t\t * have most if not all the tasks\n\t\t\t\t * completed before we return */\n\t\t\t\tusleep(100000);\t/* 100 msec */\n\t\t\t\trc = _wait_for_any_task(job, false);\n\t\t\t\tif (rc != -1)\n\t\t\t\t\ti += rc;\n\t\t\t}\n\t\t}\n\n\t\tif (i < tasks_left) {\n\t\t\t/* Send partial completion message only.\n\t\t\t * The full completion message can only be sent\n\t\t\t * after resetting CPU frequencies */\n\t\t\twhile (_send_pending_exit_msgs(job)) {;}\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _reclaim_privileges(struct priv_state *state);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_all_tasks(stepd_step_rec_t *job)\n{\n\tint tasks_left = 0;\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tif (job->task[i]->state < STEPD_STEP_TASK_COMPLETE) {\n\t\t\ttasks_left++;\n\t\t}\n\t}\n\tif (tasks_left < job->node_tasks)\n\t\tverbose(\"Only %d of %d requested tasks successfully launched\",\n\t\t\ttasks_left, job->node_tasks);\n\n\tfor (i = 0; i < tasks_left; ) {\n\t\tint rc;\n\t\trc = _wait_for_any_task(job, true);\n\t\tif (rc != -1) {\n\t\t\ti += rc;\n\t\t\tif (i < tasks_left) {\n\t\t\t\t/* To limit the amount of traffic back\n\t\t\t\t * we will sleep a bit to make sure we\n\t\t\t\t * have most if not all the tasks\n\t\t\t\t * completed before we return */\n\t\t\t\tusleep(100000);\t/* 100 msec */\n\t\t\t\trc = _wait_for_any_task(job, false);\n\t\t\t\tif (rc != -1)\n\t\t\t\t\ti += rc;\n\t\t\t}\n\t\t}\n\n\t\tif (i < tasks_left) {\n\t\t\t/* Send partial completion message only.\n\t\t\t * The full completion message can only be sent\n\t\t\t * after resetting CPU frequencies */\n\t\t\twhile (_send_pending_exit_msgs(job)) {;}\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Unable to set dumpable to 1\""
          ],
          "line": 1293
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_stop_current",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "120-139",
          "snippet": "void\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "prctl",
          "args": [
            "PR_SET_DUMPABLE",
            "1"
          ],
          "line": 1292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_stat_task",
          "args": [
            "0"
          ],
          "line": 1285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "attach_system_cgroup_pid",
          "args": [
            "getpid()"
          ],
          "line": 1279
        },
        "resolved": true,
        "details": {
          "function_name": "attach_system_cgroup_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/slurmd_cgroup.c",
          "lines": "494-530",
          "snippet": "extern void attach_system_cgroup_pid(pid_t pid)\n{\n\tchar* slurm_cgpath;\n\n\tif (read_slurm_cgroup_conf(&slurm_cgroup_conf))\n\t\treturn;\n\n\tslurm_cgpath = (char*) xstrdup(slurm_cgroup_conf.cgroup_prepend);\n#ifdef MULTIPLE_SLURMD\n\tif ( conf->node_name != NULL )\n\t\txstrsubstitute(slurm_cgpath,\"%n\", conf->node_name);\n\telse {\n\t\txfree(slurm_cgpath);\n\t\tslurm_cgpath = (char*) xstrdup(\"/slurm\");\n\t}\n#endif\n\txstrcat(slurm_cgpath,\"/system\");\n\tif (xcgroup_ns_load(&slurm_cgroup_conf, &cpuset_ns, \"cpuset\")\n\t    == XCGROUP_SUCCESS) {\n\t\tif (xcgroup_load(&cpuset_ns, &system_cpuset_cg, slurm_cgpath)\n\t\t    == XCGROUP_SUCCESS)\n\t\t\tif (attach_system_cpuset_pid(pid) != SLURM_SUCCESS)\n\t\t\t\tdebug2(\"system cgroup: unable to attach pid to \"\n\t\t\t\t       \"system cpuset cgroup\");\n\t}\n\tif (xcgroup_ns_load(&slurm_cgroup_conf, &memory_ns, \"memory\")\n\t    == XCGROUP_SUCCESS) {\n\t\tif (xcgroup_load(&memory_ns, &system_memory_cg, slurm_cgpath)\n\t\t    == XCGROUP_SUCCESS)\n\t\t\tif (attach_system_memory_pid(pid) != SLURM_SUCCESS)\n\t\t\t\tdebug2(\"system cgroup: unable to attach pid to \"\n\t\t\t\t       \"system memory cgroup\");\n\t}\n\txfree(slurm_cgpath);\n\tfree_slurm_cgroup_conf(&slurm_cgroup_conf);\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/xcgroup.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xcgroup_read_config.h\"",
            "#include \"src/common/slurm_resource_info.h\"",
            "#include \"src/common/bitstring.h\"",
            "#include \"slurm/slurm.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <sched.h>",
            "#include <ctype.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static xcgroup_t system_cpuset_cg = {NULL, NULL, NULL, 0, 0, 0, 0};",
            "static xcgroup_t system_memory_cg = {NULL, NULL, NULL, 0, 0, 0, 0};",
            "static xcgroup_ns_t cpuset_ns = {NULL, NULL, NULL, NULL};",
            "static xcgroup_ns_t memory_ns = {NULL, NULL, NULL, NULL};",
            "static slurm_cgroup_conf_t slurm_cgroup_conf;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/xcgroup.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xcgroup_read_config.h\"\n#include \"src/common/slurm_resource_info.h\"\n#include \"src/common/bitstring.h\"\n#include \"slurm/slurm.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <sched.h>\n#include <ctype.h>\n#include \"config.h\"\n\nstatic xcgroup_t system_cpuset_cg = {NULL, NULL, NULL, 0, 0, 0, 0};\nstatic xcgroup_t system_memory_cg = {NULL, NULL, NULL, 0, 0, 0, 0};\nstatic xcgroup_ns_t cpuset_ns = {NULL, NULL, NULL, NULL};\nstatic xcgroup_ns_t memory_ns = {NULL, NULL, NULL, NULL};\nstatic slurm_cgroup_conf_t slurm_cgroup_conf;\n\nextern void attach_system_cgroup_pid(pid_t pid)\n{\n\tchar* slurm_cgpath;\n\n\tif (read_slurm_cgroup_conf(&slurm_cgroup_conf))\n\t\treturn;\n\n\tslurm_cgpath = (char*) xstrdup(slurm_cgroup_conf.cgroup_prepend);\n#ifdef MULTIPLE_SLURMD\n\tif ( conf->node_name != NULL )\n\t\txstrsubstitute(slurm_cgpath,\"%n\", conf->node_name);\n\telse {\n\t\txfree(slurm_cgpath);\n\t\tslurm_cgpath = (char*) xstrdup(\"/slurm\");\n\t}\n#endif\n\txstrcat(slurm_cgpath,\"/system\");\n\tif (xcgroup_ns_load(&slurm_cgroup_conf, &cpuset_ns, \"cpuset\")\n\t    == XCGROUP_SUCCESS) {\n\t\tif (xcgroup_load(&cpuset_ns, &system_cpuset_cg, slurm_cgpath)\n\t\t    == XCGROUP_SUCCESS)\n\t\t\tif (attach_system_cpuset_pid(pid) != SLURM_SUCCESS)\n\t\t\t\tdebug2(\"system cgroup: unable to attach pid to \"\n\t\t\t\t       \"system cpuset cgroup\");\n\t}\n\tif (xcgroup_ns_load(&slurm_cgroup_conf, &memory_ns, \"memory\")\n\t    == XCGROUP_SUCCESS) {\n\t\tif (xcgroup_load(&memory_ns, &system_memory_cg, slurm_cgpath)\n\t\t    == XCGROUP_SUCCESS)\n\t\t\tif (attach_system_memory_pid(pid) != SLURM_SUCCESS)\n\t\t\t\tdebug2(\"system cgroup: unable to attach pid to \"\n\t\t\t\t       \"system memory cgroup\");\n\t}\n\txfree(slurm_cgpath);\n\tfree_slurm_cgroup_conf(&slurm_cgroup_conf);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 1279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xsignal_block",
          "args": [
            "mgr_sigarray"
          ],
          "line": 1273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_close_task_fds",
          "args": [
            "job"
          ],
          "line": 1271
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_task_fds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1420-1430",
          "snippet": "extern void\nio_close_task_fds(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tclose(job->task[i]->stdin_fd);\n\t\tclose(job->task[i]->stdout_fd);\n\t\tclose(job->task[i]->stderr_fd);\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nextern void\nio_close_task_fds(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tclose(job->task[i]->stdin_fd);\n\t\tclose(job->task[i]->stdout_fd);\n\t\tclose(job->task[i]->stderr_fd);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "_fork_all_tasks",
          "args": [
            "job",
            "&io_initialized"
          ],
          "line": 1256
        },
        "resolved": true,
        "details": {
          "function_name": "_fork_all_tasks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1588-1882",
          "snippet": "static int\n_fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized)\n{\n\tint rc = SLURM_SUCCESS;\n\tint i;\n\tstruct priv_state sprivs;\n\tjobacct_id_t jobacct_id;\n\tchar *oom_value;\n\tList exec_wait_list = NULL;\n\tchar *esc;\n\n\txassert(job != NULL);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"Failed to invoke task plugins: one of task_p_pre_setuid functions returned error\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/* Temporarily drop effective privileges, except for the euid.\n\t * We need to wait until after pam_setup() to drop euid.\n\t */\n\tif (_drop_privileges (job, false, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (pam_setup(job->user_name, conf->hostname)\n\t    != SLURM_SUCCESS){\n\t\terror (\"error in pam_setup\");\n\t\trc = SLURM_ERROR;\n\t}\n\n\t/*\n\t * Reclaim privileges to do the io setup\n\t */\n\t_reclaim_privileges (&sprivs);\n\tif (rc)\n\t\tgoto fail1; /* pam_setup error */\n\n\tset_umask(job);\t\t/* set umask for stdout/err files */\n\tif (job->user_managed_io)\n\t\trc = _setup_user_managed_io(job);\n\telse\n\t\trc = _setup_normal_io(job);\n\t/*\n\t * Initialize log facility to copy errors back to srun\n\t */\n\tif (!rc)\n\t\trc = _slurmd_job_log_init(job);\n\n\tif (rc) {\n\t\terror(\"IO setup failed: %m\");\n\t\tjob->task[0]->estatus = 0x0100;\n\t\tstep_complete.step_rc = 0x0100;\n\t\tif (job->batch)\n\t\t\trc = SLURM_SUCCESS;\t/* drains node otherwise */\n\t\tgoto fail1;\n\t} else {\n\t\t*io_initialized = true;\n\t}\n\n\t/*\n\t * Temporarily drop effective privileges\n\t */\n\tif (_drop_privileges (job, true, &sprivs, true) < 0) {\n\t\terror (\"_drop_privileges: %m\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail2;\n\t}\n\n\t/* If there is an \\ in the path\n\t * remove it.\n\t */\n\tesc = is_path_escaped(job->cwd);\n\tif (esc) {\n\t\txfree(job->cwd);\n\t\tjob->cwd = esc;\n\t}\n\n\tif (chdir(job->cwd) < 0) {\n\t\terror(\"couldn't chdir to `%s': %m: going to /tmp instead\",\n\t\t      job->cwd);\n\t\tif (chdir(\"/tmp\") < 0) {\n\t\t\terror(\"couldn't chdir to /tmp either. dying.\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail3;\n\t\t}\n\t}\n\n\tif (spank_user (job) < 0) {\n\t\terror(\"spank_user failed.\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\texec_wait_list = list_create ((ListDelF) _exec_wait_info_destroy);\n\tif (!exec_wait_list) {\n\t\terror (\"Unable to create exec_wait_list\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\t/*\n\t * Fork all of the task processes.\n\t */\n\tverbose(\"starting %u tasks\", job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tchar time_stamp[256];\n\t\tpid_t pid;\n\t\tstruct exec_wait_info *ei;\n\n\t\tacct_gather_profile_g_task_start(i);\n\t\tif ((ei = _fork_child_with_wait_info (i)) == NULL) {\n\t\t\terror(\"child fork: %m\");\n\t\t\texec_wait_kill_children (exec_wait_list);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail4;\n\t\t} else if ((pid = _exec_wait_get_pid (ei)) == 0)  { /* child */\n\t\t\t/*\n\t\t\t *  Destroy exec_wait_list in the child.\n\t\t\t *   Only exec_wait_info for previous tasks have been\n\t\t\t *   added to the list so far, so everything else\n\t\t\t *   can be discarded.\n\t\t\t */\n\t\t\tFREE_NULL_LIST (exec_wait_list);\n\n#ifdef HAVE_AIX\n\t\t\t(void) mkcrid(0);\n#endif\n\t\t\t/* jobacctinfo_endpoll();\n\t\t\t * closing jobacct files here causes deadlock */\n\n\t\t\tif (conf->propagate_prio)\n\t\t\t\t_set_prio_process(job);\n\n\t\t\t/*\n\t\t\t *  Reclaim privileges and call any plugin hooks\n\t\t\t *  that may require elevated privs\n\t\t\t *  sprivs.gid_list is already set from the\n\t\t\t *  _drop_privileges call above, no not reinitialize.\n\t\t\t */\n\t\t\tif (_pre_task_privileged(job, i, &sprivs) < 0)\n\t\t\t\texit(1);\n\n \t\t\tif (_become_user(job, &sprivs) < 0) {\n \t\t\t\terror(\"_become_user failed: %m\");\n\t\t\t\t/* child process, should not return */\n\t\t\t\texit(1);\n \t\t\t}\n\n\t\t\t/* log_fini(); */ /* note: moved into exec_task() */\n\n\t\t\t_unblock_signals();\n\n\t\t\t/*\n\t\t\t *  Need to setup stdio before setpgid() is called\n\t\t\t *   in case we are setting up a tty. (login_tty()\n\t\t\t *   must be called before setpgid() or it is\n\t\t\t *   effectively disabled).\n\t\t\t */\n\t\t\tprepare_stdio (job, job->task[i]);\n\n\t\t\t/* Close profiling file descriptors */\n\t\t\tacct_gather_profile_g_child_forked();\n\n\t\t\t/*\n\t\t\t *  Block until parent notifies us that it is ok to\n\t\t\t *   proceed. This allows the parent to place all\n\t\t\t *   children in any process groups or containers\n\t\t\t *   before they make a call to exec(2).\n\t\t\t */\n\t\t\tif (_exec_wait_child_wait_for_parent (ei) < 0)\n\t\t\t\texit (1);\n\n\t\t\texec_task(job, i);\n\t\t}\n\n\t\t/*\n\t\t * Parent continues:\n\t\t */\n\n\t\tlist_append (exec_wait_list, ei);\n\n\t\tlog_timestamp(time_stamp, sizeof(time_stamp));\n\t\tverbose(\"task %lu (%lu) started %s\",\n\t\t\t(unsigned long) job->task[i]->gtid,\n\t\t\t(unsigned long) pid, time_stamp);\n\n\t\tjob->task[i]->pid = pid;\n\t\tif (i == 0)\n\t\t\tjob->pgid = pid;\n\t}\n\n\t/*\n\t * All tasks are now forked and running as the user, but\n\t * will wait for our signal before calling exec.\n\t */\n\n\t/*\n\t * Reclaim privileges\n\t */\n\tif (_reclaim_privileges (&sprivs) < 0) {\n\t\terror (\"Unable to reclaim privileges\");\n\t\t/* Don't bother erroring out here */\n\t}\n\n\tif ((oom_value = getenv(\"SLURMSTEPD_OOM_ADJ\"))) {\n\t\tint i = atoi(oom_value);\n\t\tdebug(\"Setting slurmstepd oom_adj to %d\", i);\n\t\tset_oom_adj(i);\n\t}\n\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Put this task in the step process group\n\t\t * login_tty() must put task zero in its own\n\t\t * session, causing setpgid() to fail, setsid()\n\t\t * has already set its process group as desired\n\t\t */\n\t\tif ((job->pty == 0)\n\t\t    &&  (setpgid (job->task[i]->pid, job->pgid) < 0)) {\n\t\t\terror(\"Unable to put task %d (pid %d) into \"\n\t\t\t      \"pgrp %d: %m\",\n\t\t\t      i,\n\t\t\t      job->task[i]->pid,\n\t\t\t      job->pgid);\n\t\t}\n\n\t\tif (proctrack_g_add(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\terror(\"proctrack_g_add: %m\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t\tjobacct_id.nodeid = job->nodeid;\n\t\tjobacct_id.taskid = job->task[i]->gtid;\n\t\tjobacct_id.job    = job;\n\t\tif (i == (job->node_tasks - 1)) {\n\t\t\t/* start polling on the last task */\n\t\t\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t1);\n\t\t} else {\n\t\t\t/* don't poll yet */\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t0);\n\t\t}\n\t\tif (spank_task_post_fork (job, i) < 0) {\n\t\t\terror (\"spank task %d post-fork failed\", i);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n//\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tif (container_g_add_cont(job->jobid, job->cont_id) != SLURM_SUCCESS)\n\t\terror(\"container_g_add_cont(%u): %m\", job->jobid);\n\tif (!job->batch && core_spec_g_set(job->cont_id, job->job_core_spec))\n\t\terror(\"core_spec_g_set: %m\");\n\n\t/*\n\t * Now it's ok to unblock the tasks, so they may call exec.\n\t */\n\tlist_for_each (exec_wait_list, (ListForF) exec_wait_signal, job);\n\tFREE_NULL_LIST (exec_wait_list);\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Prepare process for attach by parallel debugger\n\t\t * (if specified and able)\n\t\t */\n\t\tif (pdebug_trace_process(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n\n\treturn rc;\n\nfail4:\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\nfail3:\n\t_reclaim_privileges (&sprivs);\n\tFREE_NULL_LIST (exec_wait_list);\nfail2:\n\tio_close_task_fds(job);\nfail1:\n\tpam_finish();\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static int  _fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static void _unblock_signals(void);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic int  _fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic void _unblock_signals(void);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized)\n{\n\tint rc = SLURM_SUCCESS;\n\tint i;\n\tstruct priv_state sprivs;\n\tjobacct_id_t jobacct_id;\n\tchar *oom_value;\n\tList exec_wait_list = NULL;\n\tchar *esc;\n\n\txassert(job != NULL);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"Failed to invoke task plugins: one of task_p_pre_setuid functions returned error\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\t/* Temporarily drop effective privileges, except for the euid.\n\t * We need to wait until after pam_setup() to drop euid.\n\t */\n\tif (_drop_privileges (job, false, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (pam_setup(job->user_name, conf->hostname)\n\t    != SLURM_SUCCESS){\n\t\terror (\"error in pam_setup\");\n\t\trc = SLURM_ERROR;\n\t}\n\n\t/*\n\t * Reclaim privileges to do the io setup\n\t */\n\t_reclaim_privileges (&sprivs);\n\tif (rc)\n\t\tgoto fail1; /* pam_setup error */\n\n\tset_umask(job);\t\t/* set umask for stdout/err files */\n\tif (job->user_managed_io)\n\t\trc = _setup_user_managed_io(job);\n\telse\n\t\trc = _setup_normal_io(job);\n\t/*\n\t * Initialize log facility to copy errors back to srun\n\t */\n\tif (!rc)\n\t\trc = _slurmd_job_log_init(job);\n\n\tif (rc) {\n\t\terror(\"IO setup failed: %m\");\n\t\tjob->task[0]->estatus = 0x0100;\n\t\tstep_complete.step_rc = 0x0100;\n\t\tif (job->batch)\n\t\t\trc = SLURM_SUCCESS;\t/* drains node otherwise */\n\t\tgoto fail1;\n\t} else {\n\t\t*io_initialized = true;\n\t}\n\n\t/*\n\t * Temporarily drop effective privileges\n\t */\n\tif (_drop_privileges (job, true, &sprivs, true) < 0) {\n\t\terror (\"_drop_privileges: %m\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail2;\n\t}\n\n\t/* If there is an \\ in the path\n\t * remove it.\n\t */\n\tesc = is_path_escaped(job->cwd);\n\tif (esc) {\n\t\txfree(job->cwd);\n\t\tjob->cwd = esc;\n\t}\n\n\tif (chdir(job->cwd) < 0) {\n\t\terror(\"couldn't chdir to `%s': %m: going to /tmp instead\",\n\t\t      job->cwd);\n\t\tif (chdir(\"/tmp\") < 0) {\n\t\t\terror(\"couldn't chdir to /tmp either. dying.\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail3;\n\t\t}\n\t}\n\n\tif (spank_user (job) < 0) {\n\t\terror(\"spank_user failed.\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\texec_wait_list = list_create ((ListDelF) _exec_wait_info_destroy);\n\tif (!exec_wait_list) {\n\t\terror (\"Unable to create exec_wait_list\");\n\t\trc = SLURM_ERROR;\n\t\tgoto fail4;\n\t}\n\n\t/*\n\t * Fork all of the task processes.\n\t */\n\tverbose(\"starting %u tasks\", job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tchar time_stamp[256];\n\t\tpid_t pid;\n\t\tstruct exec_wait_info *ei;\n\n\t\tacct_gather_profile_g_task_start(i);\n\t\tif ((ei = _fork_child_with_wait_info (i)) == NULL) {\n\t\t\terror(\"child fork: %m\");\n\t\t\texec_wait_kill_children (exec_wait_list);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail4;\n\t\t} else if ((pid = _exec_wait_get_pid (ei)) == 0)  { /* child */\n\t\t\t/*\n\t\t\t *  Destroy exec_wait_list in the child.\n\t\t\t *   Only exec_wait_info for previous tasks have been\n\t\t\t *   added to the list so far, so everything else\n\t\t\t *   can be discarded.\n\t\t\t */\n\t\t\tFREE_NULL_LIST (exec_wait_list);\n\n#ifdef HAVE_AIX\n\t\t\t(void) mkcrid(0);\n#endif\n\t\t\t/* jobacctinfo_endpoll();\n\t\t\t * closing jobacct files here causes deadlock */\n\n\t\t\tif (conf->propagate_prio)\n\t\t\t\t_set_prio_process(job);\n\n\t\t\t/*\n\t\t\t *  Reclaim privileges and call any plugin hooks\n\t\t\t *  that may require elevated privs\n\t\t\t *  sprivs.gid_list is already set from the\n\t\t\t *  _drop_privileges call above, no not reinitialize.\n\t\t\t */\n\t\t\tif (_pre_task_privileged(job, i, &sprivs) < 0)\n\t\t\t\texit(1);\n\n \t\t\tif (_become_user(job, &sprivs) < 0) {\n \t\t\t\terror(\"_become_user failed: %m\");\n\t\t\t\t/* child process, should not return */\n\t\t\t\texit(1);\n \t\t\t}\n\n\t\t\t/* log_fini(); */ /* note: moved into exec_task() */\n\n\t\t\t_unblock_signals();\n\n\t\t\t/*\n\t\t\t *  Need to setup stdio before setpgid() is called\n\t\t\t *   in case we are setting up a tty. (login_tty()\n\t\t\t *   must be called before setpgid() or it is\n\t\t\t *   effectively disabled).\n\t\t\t */\n\t\t\tprepare_stdio (job, job->task[i]);\n\n\t\t\t/* Close profiling file descriptors */\n\t\t\tacct_gather_profile_g_child_forked();\n\n\t\t\t/*\n\t\t\t *  Block until parent notifies us that it is ok to\n\t\t\t *   proceed. This allows the parent to place all\n\t\t\t *   children in any process groups or containers\n\t\t\t *   before they make a call to exec(2).\n\t\t\t */\n\t\t\tif (_exec_wait_child_wait_for_parent (ei) < 0)\n\t\t\t\texit (1);\n\n\t\t\texec_task(job, i);\n\t\t}\n\n\t\t/*\n\t\t * Parent continues:\n\t\t */\n\n\t\tlist_append (exec_wait_list, ei);\n\n\t\tlog_timestamp(time_stamp, sizeof(time_stamp));\n\t\tverbose(\"task %lu (%lu) started %s\",\n\t\t\t(unsigned long) job->task[i]->gtid,\n\t\t\t(unsigned long) pid, time_stamp);\n\n\t\tjob->task[i]->pid = pid;\n\t\tif (i == 0)\n\t\t\tjob->pgid = pid;\n\t}\n\n\t/*\n\t * All tasks are now forked and running as the user, but\n\t * will wait for our signal before calling exec.\n\t */\n\n\t/*\n\t * Reclaim privileges\n\t */\n\tif (_reclaim_privileges (&sprivs) < 0) {\n\t\terror (\"Unable to reclaim privileges\");\n\t\t/* Don't bother erroring out here */\n\t}\n\n\tif ((oom_value = getenv(\"SLURMSTEPD_OOM_ADJ\"))) {\n\t\tint i = atoi(oom_value);\n\t\tdebug(\"Setting slurmstepd oom_adj to %d\", i);\n\t\tset_oom_adj(i);\n\t}\n\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Put this task in the step process group\n\t\t * login_tty() must put task zero in its own\n\t\t * session, causing setpgid() to fail, setsid()\n\t\t * has already set its process group as desired\n\t\t */\n\t\tif ((job->pty == 0)\n\t\t    &&  (setpgid (job->task[i]->pid, job->pgid) < 0)) {\n\t\t\terror(\"Unable to put task %d (pid %d) into \"\n\t\t\t      \"pgrp %d: %m\",\n\t\t\t      i,\n\t\t\t      job->task[i]->pid,\n\t\t\t      job->pgid);\n\t\t}\n\n\t\tif (proctrack_g_add(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\terror(\"proctrack_g_add: %m\");\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t\tjobacct_id.nodeid = job->nodeid;\n\t\tjobacct_id.taskid = job->task[i]->gtid;\n\t\tjobacct_id.job    = job;\n\t\tif (i == (job->node_tasks - 1)) {\n\t\t\t/* start polling on the last task */\n\t\t\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t1);\n\t\t} else {\n\t\t\t/* don't poll yet */\n\t\t\tjobacct_gather_add_task(job->task[i]->pid, &jobacct_id,\n\t\t\t\t\t\t0);\n\t\t}\n\t\tif (spank_task_post_fork (job, i) < 0) {\n\t\t\terror (\"spank task %d post-fork failed\", i);\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n//\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tif (container_g_add_cont(job->jobid, job->cont_id) != SLURM_SUCCESS)\n\t\terror(\"container_g_add_cont(%u): %m\", job->jobid);\n\tif (!job->batch && core_spec_g_set(job->cont_id, job->job_core_spec))\n\t\terror(\"core_spec_g_set: %m\");\n\n\t/*\n\t * Now it's ok to unblock the tasks, so they may call exec.\n\t */\n\tlist_for_each (exec_wait_list, (ListForF) exec_wait_signal, job);\n\tFREE_NULL_LIST (exec_wait_list);\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/*\n\t\t * Prepare process for attach by parallel debugger\n\t\t * (if specified and able)\n\t\t */\n\t\tif (pdebug_trace_process(job, job->task[i]->pid)\n\t\t    == SLURM_ERROR) {\n\t\t\trc = SLURM_ERROR;\n\t\t\tgoto fail2;\n\t\t}\n\t}\n\n\treturn rc;\n\nfail4:\n\tif (chdir (sprivs.saved_cwd) < 0) {\n\t\terror (\"Unable to return to working directory\");\n\t}\nfail3:\n\t_reclaim_privileges (&sprivs);\n\tFREE_NULL_LIST (exec_wait_list);\nfail2:\n\tio_close_task_fds(job);\nfail1:\n\tpam_finish();\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gres_plugin_step_count",
          "args": [
            "job->step_gres_list",
            "\"nic\""
          ],
          "line": 1242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gres_plugin_step_count",
          "args": [
            "job->step_gres_list",
            "\"mic\""
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gres_plugin_step_count",
          "args": [
            "job->step_gres_list",
            "\"gpu\""
          ],
          "line": 1240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed mpi_hook_slurmstepd_prefork\""
          ],
          "line": 1231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mpi_hook_slurmstepd_prefork",
          "args": [
            "job",
            "&job->env"
          ],
          "line": 1230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed checkpoint_stepd_prefork\""
          ],
          "line": 1223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkpoint_stepd_prefork",
          "args": [
            "job"
          ],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "switch_g_job_init",
          "args": [
            "job"
          ],
          "line": 1215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"After call to spank_init()\""
          ],
          "line": 1212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Plugin stack initialization failed.\""
          ],
          "line": 1208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_init",
          "args": [
            "job"
          ],
          "line": 1207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Before call to spank_init()\""
          ],
          "line": 1206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_select_cray_plugin_job_ready",
          "args": [
            "job"
          ],
          "line": 1188
        },
        "resolved": true,
        "details": {
          "function_name": "_select_cray_plugin_job_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "374-389",
          "snippet": "static int _select_cray_plugin_job_ready(stepd_step_rec_t *job)\n{\n\tuint64_t pagg_id = proctrack_g_find(job->jmgr_pid);\n\n\tif (pagg_id == 0) {\n\t\terror(\"no PAGG ID: job service disabled on this host?\");\n\t\t/*\n\t\t * If this process is not attached to a container, there is no\n\t\t * sense in trying to use the SID as fallback, since the call to\n\t\t * proctrack_g_add() in _fork_all_tasks() will fail later.\n\t\t * Hence drain the node until sgi_job returns proper PAGG IDs.\n\t\t */\n\t\treturn READY_JOB_FATAL;\n\t}\n\treturn _call_select_plugin_from_stepd(job, pagg_id, select_g_job_ready);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _select_cray_plugin_job_ready(stepd_step_rec_t *job)\n{\n\tuint64_t pagg_id = proctrack_g_find(job->jmgr_pid);\n\n\tif (pagg_id == 0) {\n\t\terror(\"no PAGG ID: job service disabled on this host?\");\n\t\t/*\n\t\t * If this process is not attached to a container, there is no\n\t\t * sense in trying to use the SID as fallback, since the call to\n\t\t * proctrack_g_add() in _fork_all_tasks() will fail later.\n\t\t * Hence drain the node until sgi_job returns proper PAGG IDs.\n\t\t */\n\t\treturn READY_JOB_FATAL;\n\t}\n\treturn _call_select_plugin_from_stepd(job, pagg_id, select_g_job_ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gres_plugin_node_config_load",
          "args": [
            "conf->cpus",
            "conf->node_name",
            "(void *)&xcpuinfo_abs_to_mac"
          ],
          "line": 1169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_spawn_job_container",
          "args": [
            "job"
          ],
          "line": 1166
        },
        "resolved": true,
        "details": {
          "function_name": "_spawn_job_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "994-1102",
          "snippet": "static int _spawn_job_container(stepd_step_rec_t *job)\n{\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tjobacct_id_t jobacct_id;\n\tint status = 0;\n\tpid_t pid;\n\tint rc = SLURM_SUCCESS;\n\n\tdebug2(\"%s: Before call to spank_init()\", __func__);\n\tif (spank_init(job) < 0) {\n\t\terror(\"%s: Plugin stack initialization failed.\", __func__);\n\t\treturn SLURM_PLUGIN_NAME_INVALID;\n\t}\n\tdebug2(\"%s: After call to spank_init()\", __func__);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"%s: Failed to invoke task plugins: one of \"\n\t\t      \"task_p_pre_setuid functions returned error\", __func__);\n\t}\n\n\tacct_gather_profile_g_task_start(0);\n\tpid = fork();\n\tif (pid == 0) {\n\t\tsetpgid(0, 0);\n\t\tsetsid();\n\t\tacct_gather_profile_g_child_forked();\n\t\t/* Need to exec() something for proctrack/linuxproc to work,\n\t\t * it will not keep a process named \"slurmstepd\" */\n\t\texecl(SLEEP_CMD, \"sleep\", \"1000000\", NULL);\n\t\terror(\"execl: %m\");\n\t\tsleep(1);\n\t\texit(0);\n\t} else if (pid < 0) {\n\t\terror(\"fork: %m\");\n\t\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\t\trc = SLURM_ERROR;\n\t\tgoto fail1;\n\t}\n\n\tjob->pgid = pid;\n\n\tif ((rc = proctrack_g_add(job, pid)) != SLURM_SUCCESS) {\n\t\terror(\"%s: Step %u.%u unable to add pid %d to the proctrack plugin\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tkillpg(pid, SIGKILL);\n\t\tkill(pid, SIGKILL);\n\t\tgoto fail1;\n\t}\n\n\tjobacct_id.nodeid = job->nodeid;\n\tjobacct_id.taskid = job->nodeid;   /* Treat node ID as global task ID */\n\tjobacct_id.job    = job;\n\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tjobacct_gather_add_task(pid, &jobacct_id, 1);\n\tcontainer_g_add_cont(job->jobid, job->cont_id);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_RUNNING);\n\tif (!conf->job_acct_gather_freq)\n\t\tjobacct_gather_stat_task(0);\n\n\tif (spank_task_post_fork(job, -1) < 0)\n\t\terror(\"spank extern task post-fork failed\");\n\n\twhile ((wait4(pid, &status, 0, &rusage) < 0) && (errno == EINTR)) {\n\t\t;\t       /* Wait until above processs exits from signal */\n\t}\n\n\tjobacct = jobacct_gather_remove_task(pid);\n\tif (jobacct) {\n\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\tjobacctinfo_destroy(jobacct);\n\t}\n\tacct_gather_profile_g_task_end(pid);\n\tstep_complete.rank = job->nodeid;\n\tacct_gather_profile_endpoll();\n\tacct_gather_profile_g_node_step_end();\n\tacct_gather_profile_fini();\n\n\t/* Call the other plugins to clean up\n\t * the cgroup hierarchy.\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tstep_terminate_monitor_start(job->jobid, job->stepid);\n\tproctrack_g_signal(job->cont_id, SIGKILL);\n\tproctrack_g_wait(job->cont_id);\n\tstep_terminate_monitor_stop();\n\n\ttask_g_post_step(job);\n\nfail1:\n\tdebug2(\"%s: Before call to spank_fini()\", __func__);\n\tif (spank_fini(job) < 0)\n\t\terror(\"spank_fini failed\");\n\tdebug2(\"%s: After call to spank_fini()\", __func__);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\n\tif (step_complete.rank > -1)\n\t\t_wait_for_children_slurmstepd(job);\n\t_send_step_complete_msgs(job);\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _spawn_job_container(stepd_step_rec_t *job)\n{\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tjobacct_id_t jobacct_id;\n\tint status = 0;\n\tpid_t pid;\n\tint rc = SLURM_SUCCESS;\n\n\tdebug2(\"%s: Before call to spank_init()\", __func__);\n\tif (spank_init(job) < 0) {\n\t\terror(\"%s: Plugin stack initialization failed.\", __func__);\n\t\treturn SLURM_PLUGIN_NAME_INVALID;\n\t}\n\tdebug2(\"%s: After call to spank_init()\", __func__);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"%s: Failed to invoke task plugins: one of \"\n\t\t      \"task_p_pre_setuid functions returned error\", __func__);\n\t}\n\n\tacct_gather_profile_g_task_start(0);\n\tpid = fork();\n\tif (pid == 0) {\n\t\tsetpgid(0, 0);\n\t\tsetsid();\n\t\tacct_gather_profile_g_child_forked();\n\t\t/* Need to exec() something for proctrack/linuxproc to work,\n\t\t * it will not keep a process named \"slurmstepd\" */\n\t\texecl(SLEEP_CMD, \"sleep\", \"1000000\", NULL);\n\t\terror(\"execl: %m\");\n\t\tsleep(1);\n\t\texit(0);\n\t} else if (pid < 0) {\n\t\terror(\"fork: %m\");\n\t\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\t\trc = SLURM_ERROR;\n\t\tgoto fail1;\n\t}\n\n\tjob->pgid = pid;\n\n\tif ((rc = proctrack_g_add(job, pid)) != SLURM_SUCCESS) {\n\t\terror(\"%s: Step %u.%u unable to add pid %d to the proctrack plugin\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tkillpg(pid, SIGKILL);\n\t\tkill(pid, SIGKILL);\n\t\tgoto fail1;\n\t}\n\n\tjobacct_id.nodeid = job->nodeid;\n\tjobacct_id.taskid = job->nodeid;   /* Treat node ID as global task ID */\n\tjobacct_id.job    = job;\n\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tjobacct_gather_add_task(pid, &jobacct_id, 1);\n\tcontainer_g_add_cont(job->jobid, job->cont_id);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_RUNNING);\n\tif (!conf->job_acct_gather_freq)\n\t\tjobacct_gather_stat_task(0);\n\n\tif (spank_task_post_fork(job, -1) < 0)\n\t\terror(\"spank extern task post-fork failed\");\n\n\twhile ((wait4(pid, &status, 0, &rusage) < 0) && (errno == EINTR)) {\n\t\t;\t       /* Wait until above processs exits from signal */\n\t}\n\n\tjobacct = jobacct_gather_remove_task(pid);\n\tif (jobacct) {\n\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\tjobacctinfo_destroy(jobacct);\n\t}\n\tacct_gather_profile_g_task_end(pid);\n\tstep_complete.rank = job->nodeid;\n\tacct_gather_profile_endpoll();\n\tacct_gather_profile_g_node_step_end();\n\tacct_gather_profile_fini();\n\n\t/* Call the other plugins to clean up\n\t * the cgroup hierarchy.\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tstep_terminate_monitor_start(job->jobid, job->stepid);\n\tproctrack_g_signal(job->cont_id, SIGKILL);\n\tproctrack_g_wait(job->cont_id);\n\tstep_terminate_monitor_stop();\n\n\ttask_g_post_step(job);\n\nfail1:\n\tdebug2(\"%s: Before call to spank_fini()\", __func__);\n\tif (spank_fini(job) < 0)\n\t\terror(\"spank_fini failed\");\n\tdebug2(\"%s: After call to spank_fini()\", __func__);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\n\tif (step_complete.rank > -1)\n\t\t_wait_for_children_slurmstepd(job);\n\t_send_step_complete_msgs(job);\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"proctrack_g_create: %m\""
          ],
          "line": 1160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "proctrack_g_create",
          "args": [
            "job"
          ],
          "line": 1159
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "163-169",
          "snippet": "extern int proctrack_g_create(stepd_step_rec_t * job)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn 0;\n\n\treturn (*(ops.create)) (job);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_create(stepd_step_rec_t * job)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn 0;\n\n\treturn (*(ops.create)) (job);\n}"
        }
      },
      {
        "call_info": {
          "callee": "switch_g_job_preinit",
          "args": [
            "job->switch_job"
          ],
          "line": 1153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mpi_hook_slurmstepd_init",
          "args": [
            "&job->env"
          ],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gres_plugin_init",
          "args": [],
          "line": 1143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "job_container_init",
          "args": [],
          "line": 1142
        },
        "resolved": true,
        "details": {
          "function_name": "job_container_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/job_container_plugin.c",
          "lines": "83-143",
          "snippet": "extern int job_container_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"job_container\";\n\tchar *container_plugin_type = NULL;\n\tchar *last = NULL, *job_container_plugin_list, *job_container = NULL;\n\n\tif (init_run && (g_container_context_num >= 0))\n\t\treturn retval;\n\n\tslurm_mutex_lock(&g_container_context_lock);\n\n\tif (g_container_context_num >= 0)\n\t\tgoto done;\n\n\tcontainer_plugin_type = slurm_get_job_container_plugin();\n\tg_container_context_num = 0; /* mark it before anything else */\n\tif ((container_plugin_type == NULL) ||\n\t    (container_plugin_type[0] == '\\0'))\n\t\tgoto done;\n\n\tjob_container_plugin_list = container_plugin_type;\n\twhile ((job_container =\n\t\tstrtok_r(job_container_plugin_list, \",\", &last))) {\n\t\txrealloc(ops,\n\t\t\t sizeof(job_container_ops_t) *\n\t\t\t (g_container_context_num + 1));\n\t\txrealloc(g_container_context, (sizeof(plugin_context_t *)\n\t\t\t\t\t  * (g_container_context_num + 1)));\n\t\tif (xstrncmp(job_container, \"job_container/\", 14) == 0)\n\t\t\tjob_container += 14; /* backward compatibility */\n\t\tjob_container = xstrdup_printf(\"job_container/%s\",\n\t\t\t\t\t       job_container);\n\t\tg_container_context[g_container_context_num] =\n\t\t\tplugin_context_create(\n\t\t\t\tplugin_type, job_container,\n\t\t\t\t(void **)&ops[g_container_context_num],\n\t\t\t\tsyms, sizeof(syms));\n\t\tif (!g_container_context[g_container_context_num]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, job_container);\n\t\t\txfree(job_container);\n\t\t\tretval = SLURM_ERROR;\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(job_container);\n\t\tg_container_context_num++;\n\t\tjob_container_plugin_list = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\n done:\n\tslurm_mutex_unlock(&g_container_context_lock);\n\txfree(container_plugin_type);\n\n\tif (retval != SLURM_SUCCESS)\n\t\tjob_container_fini();\n\n\treturn retval;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const char *syms[] = {\n\t\"container_p_create\",\n\t\"container_p_add_cont\",\n\t\"container_p_add_pid\",\n\t\"container_p_delete\",\n\t\"container_p_restore\",\n\t\"container_p_reconfig\",\n};",
            "static job_container_ops_t\t*ops = NULL;",
            "static plugin_context_t\t\t**g_container_context = NULL;",
            "static int\t\t\tg_container_context_num = -1;",
            "static pthread_mutex_t\t\tg_container_context_lock =\n\t\t\t\t\tPTHREAD_MUTEX_INITIALIZER;",
            "static bool init_run = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic const char *syms[] = {\n\t\"container_p_create\",\n\t\"container_p_add_cont\",\n\t\"container_p_add_pid\",\n\t\"container_p_delete\",\n\t\"container_p_restore\",\n\t\"container_p_reconfig\",\n};\nstatic job_container_ops_t\t*ops = NULL;\nstatic plugin_context_t\t\t**g_container_context = NULL;\nstatic int\t\t\tg_container_context_num = -1;\nstatic pthread_mutex_t\t\tg_container_context_lock =\n\t\t\t\t\tPTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int job_container_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"job_container\";\n\tchar *container_plugin_type = NULL;\n\tchar *last = NULL, *job_container_plugin_list, *job_container = NULL;\n\n\tif (init_run && (g_container_context_num >= 0))\n\t\treturn retval;\n\n\tslurm_mutex_lock(&g_container_context_lock);\n\n\tif (g_container_context_num >= 0)\n\t\tgoto done;\n\n\tcontainer_plugin_type = slurm_get_job_container_plugin();\n\tg_container_context_num = 0; /* mark it before anything else */\n\tif ((container_plugin_type == NULL) ||\n\t    (container_plugin_type[0] == '\\0'))\n\t\tgoto done;\n\n\tjob_container_plugin_list = container_plugin_type;\n\twhile ((job_container =\n\t\tstrtok_r(job_container_plugin_list, \",\", &last))) {\n\t\txrealloc(ops,\n\t\t\t sizeof(job_container_ops_t) *\n\t\t\t (g_container_context_num + 1));\n\t\txrealloc(g_container_context, (sizeof(plugin_context_t *)\n\t\t\t\t\t  * (g_container_context_num + 1)));\n\t\tif (xstrncmp(job_container, \"job_container/\", 14) == 0)\n\t\t\tjob_container += 14; /* backward compatibility */\n\t\tjob_container = xstrdup_printf(\"job_container/%s\",\n\t\t\t\t\t       job_container);\n\t\tg_container_context[g_container_context_num] =\n\t\t\tplugin_context_create(\n\t\t\t\tplugin_type, job_container,\n\t\t\t\t(void **)&ops[g_container_context_num],\n\t\t\t\tsyms, sizeof(syms));\n\t\tif (!g_container_context[g_container_context_num]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, job_container);\n\t\t\txfree(job_container);\n\t\t\tretval = SLURM_ERROR;\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(job_container);\n\t\tg_container_context_num++;\n\t\tjob_container_plugin_list = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\n done:\n\tslurm_mutex_unlock(&g_container_context_lock);\n\txfree(container_plugin_type);\n\n\tif (retval != SLURM_SUCCESS)\n\t\tjob_container_fini();\n\n\treturn retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_crypto_init",
          "args": [],
          "line": 1141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_init",
          "args": [],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_init",
          "args": [],
          "line": 1139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkpoint_init",
          "args": [
            "ckpt_type"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_proctrack_init",
          "args": [],
          "line": 1137
        },
        "resolved": true,
        "details": {
          "function_name": "slurm_proctrack_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "108-137",
          "snippet": "extern int slurm_proctrack_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"proctrack\";\n\tchar *type = NULL;\n\n\tif (init_run && g_context)\n\t\treturn retval;\n\n\tslurm_mutex_lock(&g_context_lock);\n\n\tif (g_context)\n\t\tgoto done;\n\n\ttype = slurm_get_proctrack_type();\n\tg_context = plugin_context_create(\n\t\tplugin_type, type, (void **)&ops, syms, sizeof(syms));\n\n\tif (!g_context) {\n\t\terror(\"cannot create %s context for %s\", plugin_type, type);\n\t\tretval = SLURM_ERROR;\n\t\tgoto done;\n\t}\n\tinit_run = true;\n\ndone:\n\tslurm_mutex_unlock(&g_context_lock);\n\txfree(type);\n\treturn retval;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const char *syms[] = {\n\t\"proctrack_p_create\",\n\t\"proctrack_p_add\",\n\t\"proctrack_p_signal\",\n\t\"proctrack_p_destroy\",\n\t\"proctrack_p_find\",\n\t\"proctrack_p_has_pid\",\n\t\"proctrack_p_wait\",\n\t\"proctrack_p_get_pids\"\n};",
            "static slurm_proctrack_ops_t ops;",
            "static plugin_context_t *g_context = NULL;",
            "static pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;",
            "static bool init_run = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic const char *syms[] = {\n\t\"proctrack_p_create\",\n\t\"proctrack_p_add\",\n\t\"proctrack_p_signal\",\n\t\"proctrack_p_destroy\",\n\t\"proctrack_p_find\",\n\t\"proctrack_p_has_pid\",\n\t\"proctrack_p_wait\",\n\t\"proctrack_p_get_pids\"\n};\nstatic slurm_proctrack_ops_t ops;\nstatic plugin_context_t *g_context = NULL;\nstatic pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int slurm_proctrack_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"proctrack\";\n\tchar *type = NULL;\n\n\tif (init_run && g_context)\n\t\treturn retval;\n\n\tslurm_mutex_lock(&g_context_lock);\n\n\tif (g_context)\n\t\tgoto done;\n\n\ttype = slurm_get_proctrack_type();\n\tg_context = plugin_context_create(\n\t\tplugin_type, type, (void **)&ops, syms, sizeof(syms));\n\n\tif (!g_context) {\n\t\terror(\"cannot create %s context for %s\", plugin_type, type);\n\t\tretval = SLURM_ERROR;\n\t\tgoto done;\n\t}\n\tinit_run = true;\n\ndone:\n\tslurm_mutex_unlock(&g_context_lock);\n\txfree(type);\n\treturn retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurmd_task_init",
          "args": [],
          "line": 1136
        },
        "resolved": true,
        "details": {
          "function_name": "slurmd_task_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "103-157",
          "snippet": "extern int slurmd_task_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"task\";\n\tchar *task_plugin_type = NULL;\n\tchar *last = NULL, *task_plugin_list, *type = NULL;\n\n\tif ( init_run && (g_task_context_num >= 0) )\n\t\treturn retval;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\n\tif ( g_task_context_num >= 0 )\n\t\tgoto done;\n\n\ttask_plugin_type = slurm_get_task_plugin();\n\tg_task_context_num = 0; /* mark it before anything else */\n\tif (task_plugin_type == NULL || task_plugin_type[0] == '\\0')\n\t\tgoto done;\n\n\ttask_plugin_list = task_plugin_type;\n\twhile ((type = strtok_r(task_plugin_list, \",\", &last))) {\n\t\txrealloc(ops,\n\t\t\t sizeof(slurmd_task_ops_t) * (g_task_context_num + 1));\n\t\txrealloc(g_task_context, (sizeof(plugin_context_t *)\n\t\t\t\t\t  * (g_task_context_num + 1)));\n\t\tif (xstrncmp(type, \"task/\", 5) == 0)\n\t\t\ttype += 5; /* backward compatibility */\n\t\ttype = xstrdup_printf(\"task/%s\", type);\n\t\tg_task_context[g_task_context_num] = plugin_context_create(\n\t\t\tplugin_type, type, (void **)&ops[g_task_context_num],\n\t\t\tsyms, sizeof(syms));\n\t\tif (!g_task_context[g_task_context_num]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, type);\n\t\t\txfree(type);\n\t\t\tretval = SLURM_ERROR;\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(type);\n\t\tg_task_context_num++;\n\t\ttask_plugin_list = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\n done:\n\tslurm_mutex_unlock( &g_task_context_lock );\n\txfree(task_plugin_type);\n\n\tif (retval != SLURM_SUCCESS)\n\t\tslurmd_task_fini();\n\n\treturn retval;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const char *syms[] = {\n\t\"task_p_slurmd_batch_request\",\n\t\"task_p_slurmd_launch_request\",\n\t\"task_p_slurmd_reserve_resources\",\n\t\"task_p_slurmd_suspend_job\",\n\t\"task_p_slurmd_resume_job\",\n\t\"task_p_slurmd_release_resources\",\n\t\"task_p_pre_setuid\",\n\t\"task_p_pre_launch_priv\",\n\t\"task_p_pre_launch\",\n\t\"task_p_post_term\",\n\t\"task_p_post_step\",\n\t\"task_p_add_pid\",\n};",
            "static slurmd_task_ops_t *ops = NULL;",
            "static plugin_context_t\t**g_task_context = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;",
            "static bool init_run = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic const char *syms[] = {\n\t\"task_p_slurmd_batch_request\",\n\t\"task_p_slurmd_launch_request\",\n\t\"task_p_slurmd_reserve_resources\",\n\t\"task_p_slurmd_suspend_job\",\n\t\"task_p_slurmd_resume_job\",\n\t\"task_p_slurmd_release_resources\",\n\t\"task_p_pre_setuid\",\n\t\"task_p_pre_launch_priv\",\n\t\"task_p_pre_launch\",\n\t\"task_p_post_term\",\n\t\"task_p_post_step\",\n\t\"task_p_add_pid\",\n};\nstatic slurmd_task_ops_t *ops = NULL;\nstatic plugin_context_t\t**g_task_context = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int slurmd_task_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"task\";\n\tchar *task_plugin_type = NULL;\n\tchar *last = NULL, *task_plugin_list, *type = NULL;\n\n\tif ( init_run && (g_task_context_num >= 0) )\n\t\treturn retval;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\n\tif ( g_task_context_num >= 0 )\n\t\tgoto done;\n\n\ttask_plugin_type = slurm_get_task_plugin();\n\tg_task_context_num = 0; /* mark it before anything else */\n\tif (task_plugin_type == NULL || task_plugin_type[0] == '\\0')\n\t\tgoto done;\n\n\ttask_plugin_list = task_plugin_type;\n\twhile ((type = strtok_r(task_plugin_list, \",\", &last))) {\n\t\txrealloc(ops,\n\t\t\t sizeof(slurmd_task_ops_t) * (g_task_context_num + 1));\n\t\txrealloc(g_task_context, (sizeof(plugin_context_t *)\n\t\t\t\t\t  * (g_task_context_num + 1)));\n\t\tif (xstrncmp(type, \"task/\", 5) == 0)\n\t\t\ttype += 5; /* backward compatibility */\n\t\ttype = xstrdup_printf(\"task/%s\", type);\n\t\tg_task_context[g_task_context_num] = plugin_context_create(\n\t\t\tplugin_type, type, (void **)&ops[g_task_context_num],\n\t\t\tsyms, sizeof(syms));\n\t\tif (!g_task_context[g_task_context_num]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, type);\n\t\t\txfree(type);\n\t\t\tretval = SLURM_ERROR;\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(type);\n\t\tg_task_context_num++;\n\t\ttask_plugin_list = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\n done:\n\tslurm_mutex_unlock( &g_task_context_lock );\n\txfree(task_plugin_type);\n\n\tif (retval != SLURM_SUCCESS)\n\t\tslurmd_task_fini();\n\n\treturn retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "switch_init",
          "args": [],
          "line": 1135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "core_spec_g_init",
          "args": [],
          "line": 1134
        },
        "resolved": true,
        "details": {
          "function_name": "core_spec_g_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/core_spec_plugin.c",
          "lines": "77-137",
          "snippet": "extern int core_spec_g_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"core_spec\";\n\tchar *core_spec_plugin_type = NULL;\n\tchar *last = NULL, *core_spec_plugin_list, *core_spec = NULL;\n\n\tif (init_run && (g_core_spec_context_num >= 0))\n\t\treturn retval;\n\n\tslurm_mutex_lock(&g_core_spec_context_lock);\n\n\tif (g_core_spec_context_num >= 0)\n\t\tgoto done;\n\n\tcore_spec_plugin_type = slurm_get_core_spec_plugin();\n\tg_core_spec_context_num = 0; /* mark it before anything else */\n\tif ((core_spec_plugin_type == NULL) ||\n\t    (core_spec_plugin_type[0] == '\\0'))\n\t\tgoto done;\n\n\tcore_spec_plugin_list = core_spec_plugin_type;\n\twhile ((core_spec =\n\t\tstrtok_r(core_spec_plugin_list, \",\", &last))) {\n\t\txrealloc(ops,\n\t\t\t sizeof(core_spec_ops_t) *\n\t\t\t (g_core_spec_context_num + 1));\n\t\txrealloc(g_core_spec_context, (sizeof(plugin_context_t *)\n\t\t\t\t\t  * (g_core_spec_context_num + 1)));\n\t\tif (xstrncmp(core_spec, \"core_spec/\", 10) == 0)\n\t\t\tcore_spec += 10; /* backward compatibility */\n\t\tcore_spec = xstrdup_printf(\"core_spec/%s\",\n\t\t\t\t\t       core_spec);\n\t\tg_core_spec_context[g_core_spec_context_num] =\n\t\t\tplugin_context_create(\n\t\t\t\tplugin_type, core_spec,\n\t\t\t\t(void **)&ops[g_core_spec_context_num],\n\t\t\t\tsyms, sizeof(syms));\n\t\tif (!g_core_spec_context[g_core_spec_context_num]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, core_spec);\n\t\t\txfree(core_spec);\n\t\t\tretval = SLURM_ERROR;\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(core_spec);\n\t\tg_core_spec_context_num++;\n\t\tcore_spec_plugin_list = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\n done:\n\tslurm_mutex_unlock(&g_core_spec_context_lock);\n\txfree(core_spec_plugin_type);\n\n\tif (retval != SLURM_SUCCESS)\n\t\tcore_spec_g_fini();\n\n\treturn retval;\n}",
          "includes": [
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const char *syms[] = {\n\t\"core_spec_p_set\",\n\t\"core_spec_p_clear\",\n\t\"core_spec_p_suspend\",\n\t\"core_spec_p_resume\",\n};",
            "static core_spec_ops_t\t\t*ops = NULL;",
            "static plugin_context_t\t\t**g_core_spec_context = NULL;",
            "static int\t\t\tg_core_spec_context_num = -1;",
            "static pthread_mutex_t\t\tg_core_spec_context_lock =\n\t\t\t\t\tPTHREAD_MUTEX_INITIALIZER;",
            "static bool init_run = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic const char *syms[] = {\n\t\"core_spec_p_set\",\n\t\"core_spec_p_clear\",\n\t\"core_spec_p_suspend\",\n\t\"core_spec_p_resume\",\n};\nstatic core_spec_ops_t\t\t*ops = NULL;\nstatic plugin_context_t\t\t**g_core_spec_context = NULL;\nstatic int\t\t\tg_core_spec_context_num = -1;\nstatic pthread_mutex_t\t\tg_core_spec_context_lock =\n\t\t\t\t\tPTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int core_spec_g_init(void)\n{\n\tint retval = SLURM_SUCCESS;\n\tchar *plugin_type = \"core_spec\";\n\tchar *core_spec_plugin_type = NULL;\n\tchar *last = NULL, *core_spec_plugin_list, *core_spec = NULL;\n\n\tif (init_run && (g_core_spec_context_num >= 0))\n\t\treturn retval;\n\n\tslurm_mutex_lock(&g_core_spec_context_lock);\n\n\tif (g_core_spec_context_num >= 0)\n\t\tgoto done;\n\n\tcore_spec_plugin_type = slurm_get_core_spec_plugin();\n\tg_core_spec_context_num = 0; /* mark it before anything else */\n\tif ((core_spec_plugin_type == NULL) ||\n\t    (core_spec_plugin_type[0] == '\\0'))\n\t\tgoto done;\n\n\tcore_spec_plugin_list = core_spec_plugin_type;\n\twhile ((core_spec =\n\t\tstrtok_r(core_spec_plugin_list, \",\", &last))) {\n\t\txrealloc(ops,\n\t\t\t sizeof(core_spec_ops_t) *\n\t\t\t (g_core_spec_context_num + 1));\n\t\txrealloc(g_core_spec_context, (sizeof(plugin_context_t *)\n\t\t\t\t\t  * (g_core_spec_context_num + 1)));\n\t\tif (xstrncmp(core_spec, \"core_spec/\", 10) == 0)\n\t\t\tcore_spec += 10; /* backward compatibility */\n\t\tcore_spec = xstrdup_printf(\"core_spec/%s\",\n\t\t\t\t\t       core_spec);\n\t\tg_core_spec_context[g_core_spec_context_num] =\n\t\t\tplugin_context_create(\n\t\t\t\tplugin_type, core_spec,\n\t\t\t\t(void **)&ops[g_core_spec_context_num],\n\t\t\t\tsyms, sizeof(syms));\n\t\tif (!g_core_spec_context[g_core_spec_context_num]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, core_spec);\n\t\t\txfree(core_spec);\n\t\t\tretval = SLURM_ERROR;\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(core_spec);\n\t\tg_core_spec_context_num++;\n\t\tcore_spec_plugin_list = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\n done:\n\tslurm_mutex_unlock(&g_core_spec_context_lock);\n\txfree(core_spec_plugin_type);\n\n\tif (retval != SLURM_SUCCESS)\n\t\tcore_spec_g_fini();\n\n\treturn retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acct_gather_conf_init",
          "args": [],
          "line": 1128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "prctl",
          "args": [
            "PR_SET_DUMPABLE",
            "1"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Entered job_manager for %u.%u pid=%d\"",
            "job->jobid",
            "job->stepid",
            "job->jmgr_pid"
          ],
          "line": 1119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_get_checkpoint_type",
          "args": [],
          "line": 1117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int mgr_sigarray[] = {\n\tSIGINT,  SIGTERM, SIGTSTP,\n\tSIGQUIT, SIGPIPE, SIGUSR1,\n\tSIGUSR2, SIGALRM, SIGHUP, 0\n};\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic int  _fork_all_tasks(stepd_step_rec_t *job, bool *io_initialized);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\nstatic stepd_step_rec_t *reattach_job;\n\nint\njob_manager(stepd_step_rec_t *job)\n{\n\tint  rc = SLURM_SUCCESS;\n\tbool io_initialized = false;\n\tchar *ckpt_type = slurm_get_checkpoint_type();\n\n\tdebug3(\"Entered job_manager for %u.%u pid=%d\",\n\t       job->jobid, job->stepid, job->jmgr_pid);\n\n#ifdef PR_SET_DUMPABLE\n\tif (prctl(PR_SET_DUMPABLE, 1) < 0)\n\t\tdebug (\"Unable to set dumpable to 1\");\n#endif /* PR_SET_DUMPABLE */\n\n\t/* run now so we don't drop permissions on any of the gather plugins */\n\tacct_gather_conf_init();\n\n\t/*\n\t * Preload all plugins at start time to avoid plugin changes\n\t * (i.e. due to a Slurm upgrade) after the process starts.\n\t */\n\tif ((core_spec_g_init() != SLURM_SUCCESS)\t\t||\n\t    (switch_init() != SLURM_SUCCESS)\t\t\t||\n\t    (slurmd_task_init() != SLURM_SUCCESS)\t\t||\n\t    (slurm_proctrack_init() != SLURM_SUCCESS)\t\t||\n\t    (checkpoint_init(ckpt_type) != SLURM_SUCCESS)\t||\n\t    (jobacct_gather_init() != SLURM_SUCCESS)\t\t||\n\t    (acct_gather_profile_init() != SLURM_SUCCESS)\t||\n\t    (slurm_crypto_init() != SLURM_SUCCESS)\t\t||\n\t    (job_container_init() != SLURM_SUCCESS)\t\t||\n\t    (gres_plugin_init() != SLURM_SUCCESS)) {\n\t\trc = SLURM_PLUGIN_NAME_INVALID;\n\t\tgoto fail1;\n\t}\n\tif (mpi_hook_slurmstepd_init(&job->env) != SLURM_SUCCESS) {\n\t\trc = SLURM_MPI_PLUGIN_NAME_INVALID;\n\t\tgoto fail1;\n\t}\n\n\tif (!job->batch && (job->stepid != SLURM_EXTERN_CONT) &&\n\t    (switch_g_job_preinit(job->switch_job) < 0)) {\n\t\trc = ESLURM_INTERCONNECT_FAILURE;\n\t\tgoto fail1;\n\t}\n\n\tif ((job->cont_id == 0) &&\n\t    (proctrack_g_create(job) != SLURM_SUCCESS)) {\n\t\terror(\"proctrack_g_create: %m\");\n\t\trc = ESLURMD_SETUP_ENVIRONMENT_ERROR;\n\t\tgoto fail1;\n\t}\n\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn _spawn_job_container(job);\n\n\tif (!job->batch && job->accel_bind_type) {\n\t\t(void) gres_plugin_node_config_load(conf->cpus, conf->node_name,\n\t\t\t\t\t\t    (void *)&xcpuinfo_abs_to_mac);\n\t}\n\n#ifdef HAVE_ALPS_CRAY\n\t/*\n\t * Note that the previously called proctrack_g_create function is\n\t * mandatory since the select/cray plugin needs the job container\n\t * ID in order to CONFIRM the ALPS reservation.\n\t * It is not a good idea to perform this setup in _fork_all_tasks(),\n\t * since any transient failure of ALPS (which can happen in practice)\n\t * will then set the frontend node to DRAIN.\n\t *\n\t * ALso note that we do not check the reservation for batch jobs with\n\t * a reservation ID of zero and no CPUs. These are SLURM job\n\t * allocations containing no compute nodes and thus have no ALPS\n\t * reservation.\n\t */\n\tif (!job->batch || job->resv_id || job->cpus) {\n\t\trc = _select_cray_plugin_job_ready(job);\n\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t/*\n\t\t\t * Transient error: slurmctld knows this condition to\n\t\t\t * mean that the ALPS (not the SLURM) reservation\n\t\t\t * failed and tries again.\n\t\t\t */\n\t\t\tif (rc == READY_JOB_ERROR)\n\t\t\t\trc = ESLURM_RESERVATION_NOT_USABLE;\n\t\t\telse\n\t\t\t\trc = ESLURMD_SETUP_ENVIRONMENT_ERROR;\n\t\t\terror(\"could not confirm ALPS reservation #%u\",\n\t\t\t      job->resv_id);\n\t\t\tgoto fail1;\n\t\t}\n\t}\n#endif\n\n\tdebug2(\"Before call to spank_init()\");\n\tif (spank_init (job) < 0) {\n\t\terror (\"Plugin stack initialization failed.\");\n\t\trc = SLURM_PLUGIN_NAME_INVALID;\n\t\tgoto fail1;\n\t}\n\tdebug2(\"After call to spank_init()\");\n\n\t/* Call switch_g_job_init() before becoming user */\n\tif (!job->batch && job->argv && (switch_g_job_init(job) < 0)) {\n\t\t/* error(\"switch_g_job_init: %m\"); already logged */\n\t\trc = ESLURM_INTERCONNECT_FAILURE;\n\t\tgoto fail2;\n\t}\n\n\t/* fork necessary threads for checkpoint */\n\tif (checkpoint_stepd_prefork(job) != SLURM_SUCCESS) {\n\t\terror(\"Failed checkpoint_stepd_prefork\");\n\t\trc = SLURM_FAILURE;\n\t\tio_close_task_fds(job);\n\t\tgoto fail2;\n\t}\n\n\t/* fork necessary threads for MPI */\n\tif (mpi_hook_slurmstepd_prefork(job, &job->env) != SLURM_SUCCESS) {\n\t\terror(\"Failed mpi_hook_slurmstepd_prefork\");\n\t\trc = SLURM_FAILURE;\n\t\tgoto fail2;\n\t}\n\n\tif (!job->batch && job->accel_bind_type && (job->node_tasks <= 1))\n\t\tjob->accel_bind_type = 0;\n\tif (!job->batch && job->accel_bind_type && (job->node_tasks > 1)) {\n\t\tuint64_t gpu_cnt, mic_cnt, nic_cnt;\n\t\tgpu_cnt = gres_plugin_step_count(job->step_gres_list, \"gpu\");\n\t\tmic_cnt = gres_plugin_step_count(job->step_gres_list, \"mic\");\n\t\tnic_cnt = gres_plugin_step_count(job->step_gres_list, \"nic\");\n\t\tif ((gpu_cnt <= 1) || (gpu_cnt == NO_VAL64))\n\t\t\tjob->accel_bind_type &= (~ACCEL_BIND_CLOSEST_GPU);\n\t\tif ((mic_cnt <= 1) || (mic_cnt == NO_VAL64))\n\t\t\tjob->accel_bind_type &= (~ACCEL_BIND_CLOSEST_MIC);\n\t\tif ((nic_cnt <= 1) || (nic_cnt == NO_VAL64))\n\t\t\tjob->accel_bind_type &= (~ACCEL_BIND_CLOSEST_NIC);\n\t\tif (job->accel_bind_type == ACCEL_BIND_VERBOSE)\n\t\t\tjob->accel_bind_type = 0;\n\t}\n\n\t/* Calls pam_setup() and requires pam_finish() if\n\t * successful.  Only check for < 0 here since other slurm\n\t * error codes could come that are more descriptive. */\n\tif ((rc = _fork_all_tasks(job, &io_initialized)) < 0) {\n\t\tdebug(\"_fork_all_tasks failed\");\n\t\trc = ESLURMD_EXECVE_FAILED;\n\t\tgoto fail2;\n\t}\n\n\t/*\n\t * If IO initialization failed, return SLURM_SUCCESS (on a\n\t * batch step) or the node will be drain otherwise.  Regular\n\t * srun needs the error sent or it will hang waiting for the\n\t * launch to happen.\n\t */\n\tif ((rc != SLURM_SUCCESS) || !io_initialized)\n\t\tgoto fail2;\n\n\tio_close_task_fds(job);\n\n\txsignal_block (mgr_sigarray);\n\treattach_job = job;\n\n\t_set_job_state(job, SLURMSTEPD_STEP_RUNNING);\n\n\t/* Attach slurmstepd to system cgroups, if configured */\n\tattach_system_cgroup_pid(getpid());\n\n\t/* if we are not polling then we need to make sure we get some\n\t * information here\n\t */\n\tif (!conf->job_acct_gather_freq)\n\t\tjobacct_gather_stat_task(0);\n\n\t/* Send job launch response with list of pids */\n\t_send_launch_resp(job, 0);\n\n#ifdef PR_SET_DUMPABLE\n\t/* RHEL6 requires setting \"dumpable\" flag AGAIN; after euid changes */\n\tif (prctl(PR_SET_DUMPABLE, 1) < 0)\n\t\tdebug (\"Unable to set dumpable to 1\");\n#endif /* PR_SET_DUMPABLE */\n\n\t_wait_for_all_tasks(job);\n\tacct_gather_profile_endpoll();\n\tacct_gather_profile_g_node_step_end();\n\tacct_gather_profile_fini();\n\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\n\tif (!job->batch &&\n\t    (switch_g_job_fini(job->switch_job) < 0)) {\n\t\terror(\"switch_g_job_fini: %m\");\n\t}\n\nfail2:\n\t/*\n\t * First call switch_g_job_postfini() - In at least one case,\n\t * this will clean up any straggling processes. If this call\n\t * is moved behind wait_for_io(), we may block waiting for IO\n\t * on a hung process.\n\t *\n\t * Make sure all processes in session are dead. On systems\n\t * with an IBM Federation switch, all processes must be\n\t * terminated before the switch window can be released by\n\t * switch_g_job_postfini().\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tstep_terminate_monitor_start(job->jobid, job->stepid);\n\tif (job->cont_id != 0) {\n\t\tproctrack_g_signal(job->cont_id, SIGKILL);\n\t\tproctrack_g_wait(job->cont_id);\n\t}\n\tstep_terminate_monitor_stop();\n\tif (!job->batch) {\n\t\tif (switch_g_job_postfini(job) < 0)\n\t\t\terror(\"switch_g_job_postfini: %m\");\n\t}\n\n\t/*\n\t * Wait for io thread to complete (if there is one)\n\t */\n\tif (!job->batch && !job->user_managed_io && io_initialized)\n\t\t_wait_for_io(job);\n\n\t/*\n\t * Warn task plugin that the user's step have terminated\n\t */\n\ttask_g_post_step(job);\n\n\t/*\n\t * Reset cpu frequency if it was changed\n\t */\n\tif (job->cpu_freq_min != NO_VAL || job->cpu_freq_max != NO_VAL ||\n\t    job->cpu_freq_gov != NO_VAL)\n\t\tcpu_freq_reset(job);\n\n\t/* Notify srun of completion AFTER frequency reset to avoid race\n\t * condition starting another job on these CPUs. */\n\twhile (_send_pending_exit_msgs(job)) {;}\n\n\t/*\n\t * This just cleans up all of the PAM state in case rc == 0\n\t * which means _fork_all_tasks performs well.\n\t * Must be done after IO termination in case of IO operations\n\t * require something provided by the PAM (i.e. security token)\n\t */\n\tif (!rc)\n\t\tpam_finish();\n\n\tdebug2(\"Before call to spank_fini()\");\n\tif (spank_fini (job)  < 0) {\n\t\terror (\"spank_fini failed\");\n\t}\n\tdebug2(\"After call to spank_fini()\");\n\nfail1:\n\t/* If interactive job startup was abnormal,\n\t * be sure to notify client.\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tif (rc != 0) {\n\t\terror(\"job_manager exiting abnormally, rc = %d\", rc);\n\t\t_send_launch_resp(job, rc);\n\t}\n\n\tif (!job->batch && (step_complete.rank > -1)) {\n\t\tif (job->aborted)\n\t\t\tinfo(\"job_manager exiting with aborted job\");\n\t\telse\n\t\t\t_wait_for_children_slurmstepd(job);\n\t\t_send_step_complete_msgs(job);\n\t}\n\n\tif (!job->batch && core_spec_g_clear(job->cont_id))\n\t\terror(\"core_spec_g_clear: %m\");\n\n\txfree(ckpt_type);\n\treturn(rc);\n}"
  },
  {
    "function_name": "_spawn_job_container",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "994-1102",
    "snippet": "static int _spawn_job_container(stepd_step_rec_t *job)\n{\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tjobacct_id_t jobacct_id;\n\tint status = 0;\n\tpid_t pid;\n\tint rc = SLURM_SUCCESS;\n\n\tdebug2(\"%s: Before call to spank_init()\", __func__);\n\tif (spank_init(job) < 0) {\n\t\terror(\"%s: Plugin stack initialization failed.\", __func__);\n\t\treturn SLURM_PLUGIN_NAME_INVALID;\n\t}\n\tdebug2(\"%s: After call to spank_init()\", __func__);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"%s: Failed to invoke task plugins: one of \"\n\t\t      \"task_p_pre_setuid functions returned error\", __func__);\n\t}\n\n\tacct_gather_profile_g_task_start(0);\n\tpid = fork();\n\tif (pid == 0) {\n\t\tsetpgid(0, 0);\n\t\tsetsid();\n\t\tacct_gather_profile_g_child_forked();\n\t\t/* Need to exec() something for proctrack/linuxproc to work,\n\t\t * it will not keep a process named \"slurmstepd\" */\n\t\texecl(SLEEP_CMD, \"sleep\", \"1000000\", NULL);\n\t\terror(\"execl: %m\");\n\t\tsleep(1);\n\t\texit(0);\n\t} else if (pid < 0) {\n\t\terror(\"fork: %m\");\n\t\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\t\trc = SLURM_ERROR;\n\t\tgoto fail1;\n\t}\n\n\tjob->pgid = pid;\n\n\tif ((rc = proctrack_g_add(job, pid)) != SLURM_SUCCESS) {\n\t\terror(\"%s: Step %u.%u unable to add pid %d to the proctrack plugin\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tkillpg(pid, SIGKILL);\n\t\tkill(pid, SIGKILL);\n\t\tgoto fail1;\n\t}\n\n\tjobacct_id.nodeid = job->nodeid;\n\tjobacct_id.taskid = job->nodeid;   /* Treat node ID as global task ID */\n\tjobacct_id.job    = job;\n\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tjobacct_gather_add_task(pid, &jobacct_id, 1);\n\tcontainer_g_add_cont(job->jobid, job->cont_id);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_RUNNING);\n\tif (!conf->job_acct_gather_freq)\n\t\tjobacct_gather_stat_task(0);\n\n\tif (spank_task_post_fork(job, -1) < 0)\n\t\terror(\"spank extern task post-fork failed\");\n\n\twhile ((wait4(pid, &status, 0, &rusage) < 0) && (errno == EINTR)) {\n\t\t;\t       /* Wait until above processs exits from signal */\n\t}\n\n\tjobacct = jobacct_gather_remove_task(pid);\n\tif (jobacct) {\n\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\tjobacctinfo_destroy(jobacct);\n\t}\n\tacct_gather_profile_g_task_end(pid);\n\tstep_complete.rank = job->nodeid;\n\tacct_gather_profile_endpoll();\n\tacct_gather_profile_g_node_step_end();\n\tacct_gather_profile_fini();\n\n\t/* Call the other plugins to clean up\n\t * the cgroup hierarchy.\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tstep_terminate_monitor_start(job->jobid, job->stepid);\n\tproctrack_g_signal(job->cont_id, SIGKILL);\n\tproctrack_g_wait(job->cont_id);\n\tstep_terminate_monitor_stop();\n\n\ttask_g_post_step(job);\n\nfail1:\n\tdebug2(\"%s: Before call to spank_fini()\", __func__);\n\tif (spank_fini(job) < 0)\n\t\terror(\"spank_fini failed\");\n\tdebug2(\"%s: After call to spank_fini()\", __func__);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\n\tif (step_complete.rank > -1)\n\t\t_wait_for_children_slurmstepd(job);\n\t_send_step_complete_msgs(job);\n\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "_send_step_complete_msgs",
          "args": [
            "job"
          ],
          "line": 1099
        },
        "resolved": true,
        "details": {
          "function_name": "_send_step_complete_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "937-975",
          "snippet": "static void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_wait_for_children_slurmstepd",
          "args": [
            "job"
          ],
          "line": 1098
        },
        "resolved": true,
        "details": {
          "function_name": "_wait_for_children_slurmstepd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "734-774",
          "snippet": "static void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_set_job_state",
          "args": [
            "job",
            "SLURMSTEPD_STEP_ENDING"
          ],
          "line": 1095
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "986-992",
          "snippet": "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _reclaim_privileges(struct priv_state *state);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"%s: After call to spank_fini()\"",
            "__func__"
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"spank_fini failed\""
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_fini",
          "args": [
            "job"
          ],
          "line": 1091
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"%s: Before call to spank_fini()\"",
            "__func__"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_g_post_step",
          "args": [
            "job"
          ],
          "line": 1087
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_post_step",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "410-423",
          "snippet": "extern int task_g_post_step(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].post_step))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_post_step(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].post_step))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "step_terminate_monitor_stop",
          "args": [],
          "line": 1085
        },
        "resolved": true,
        "details": {
          "function_name": "step_terminate_monitor_stop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/step_terminate_monitor.c",
          "lines": "94-119",
          "snippet": "void step_terminate_monitor_stop(void)\n{\n\tslurm_mutex_lock(&lock);\n\n\tif (!running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\tif (stop_flag) {\n\t\terror(\"step_terminate_monitor_stop: already stopped\");\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tstop_flag = 1;\n\tdebug(\"step_terminate_monitor_stop signalling condition\");\n\tpthread_cond_signal(&cond);\n\tslurm_mutex_unlock(&lock);\n\n\tif (pthread_join(tid, NULL) != 0) {\n\t\terror(\"step_terminate_monitor_stop: pthread_join: %m\");\n\t}\n\n\txfree(program_name);\n\treturn;\n}",
          "includes": [
            "#include <time.h>",
            "#include <pthread.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/macros.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;",
            "static pthread_cond_t cond = PTHREAD_COND_INITIALIZER;",
            "static int running_flag = 0;",
            "static int stop_flag = 0;",
            "static pthread_t tid;",
            "static char *program_name;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <pthread.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/macros.h\"\n#  include \"config.h\"\n\nstatic pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;\nstatic pthread_cond_t cond = PTHREAD_COND_INITIALIZER;\nstatic int running_flag = 0;\nstatic int stop_flag = 0;\nstatic pthread_t tid;\nstatic char *program_name;\n\nvoid step_terminate_monitor_stop(void)\n{\n\tslurm_mutex_lock(&lock);\n\n\tif (!running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\tif (stop_flag) {\n\t\terror(\"step_terminate_monitor_stop: already stopped\");\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tstop_flag = 1;\n\tdebug(\"step_terminate_monitor_stop signalling condition\");\n\tpthread_cond_signal(&cond);\n\tslurm_mutex_unlock(&lock);\n\n\tif (pthread_join(tid, NULL) != 0) {\n\t\terror(\"step_terminate_monitor_stop: pthread_join: %m\");\n\t}\n\n\txfree(program_name);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "proctrack_g_wait",
          "args": [
            "job->cont_id"
          ],
          "line": 1084
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "448-454",
          "snippet": "extern int proctrack_g_wait(uint64_t cont_id)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn (*(ops.wait)) (cont_id);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_wait(uint64_t cont_id)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn (*(ops.wait)) (cont_id);\n}"
        }
      },
      {
        "call_info": {
          "callee": "proctrack_g_signal",
          "args": [
            "job->cont_id",
            "SIGKILL"
          ],
          "line": 1083
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_signal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "348-397",
          "snippet": "extern int proctrack_g_signal(uint64_t cont_id, int signal)\n{\n\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (signal == SIGKILL) {\n\t\tpid_t *pids = NULL;\n\t\tint i, j, npids = 0, hung_pids = 0;\n\t\tchar *stat_fname = NULL;\n\t\tif (proctrack_g_get_pids(cont_id, &pids, &npids) ==\n\t\t    SLURM_SUCCESS) {\n\t\t\t/* NOTE: proctrack_g_get_pids() is not supported\n\t\t\t * by the proctrack/pgid plugin */\n\t\t\tfor (j = 0; j < 2; j++) {\n\t\t\t\tif (j)\n\t\t\t\t\tsleep(2);\n\t\t\t\thung_pids = 0;\n\t\t\t\tfor (i = 0; i < npids; i++) {\n\t\t\t\t\tif (!pids[i])\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\txstrfmtcat(stat_fname, \"/proc/%d/stat\",\n\t\t\t\t\t\t   (int) pids[i]);\n\t\t\t\t\tif (_test_core_dumping(stat_fname)) {\n\t\t\t\t\t\tdebug(\"Process %d continuing \"\n\t\t\t\t\t\t      \"core dump\",\n\t\t\t\t\t\t      (int) pids[i]);\n\t\t\t\t\t\thung_pids++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Don't test this PID again */\n\t\t\t\t\t\tpids[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t\txfree(stat_fname);\n\t\t\t\t}\n\t\t\t\tif (hung_pids == 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\txfree(pids);\n\t\t\tif (hung_pids) {\n\t\t\t\tinfo(\"Defering sending signal, processes in \"\n\t\t\t\t     \"job are currently core dumping\");\n\t\t\t\t_spawn_signal_thread(cont_id, signal);\n\t\t\t\treturn SLURM_SUCCESS;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (*(ops.signal)) (cont_id, signal);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_signal(uint64_t cont_id, int signal)\n{\n\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\tif (signal == SIGKILL) {\n\t\tpid_t *pids = NULL;\n\t\tint i, j, npids = 0, hung_pids = 0;\n\t\tchar *stat_fname = NULL;\n\t\tif (proctrack_g_get_pids(cont_id, &pids, &npids) ==\n\t\t    SLURM_SUCCESS) {\n\t\t\t/* NOTE: proctrack_g_get_pids() is not supported\n\t\t\t * by the proctrack/pgid plugin */\n\t\t\tfor (j = 0; j < 2; j++) {\n\t\t\t\tif (j)\n\t\t\t\t\tsleep(2);\n\t\t\t\thung_pids = 0;\n\t\t\t\tfor (i = 0; i < npids; i++) {\n\t\t\t\t\tif (!pids[i])\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\txstrfmtcat(stat_fname, \"/proc/%d/stat\",\n\t\t\t\t\t\t   (int) pids[i]);\n\t\t\t\t\tif (_test_core_dumping(stat_fname)) {\n\t\t\t\t\t\tdebug(\"Process %d continuing \"\n\t\t\t\t\t\t      \"core dump\",\n\t\t\t\t\t\t      (int) pids[i]);\n\t\t\t\t\t\thung_pids++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* Don't test this PID again */\n\t\t\t\t\t\tpids[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t\txfree(stat_fname);\n\t\t\t\t}\n\t\t\t\tif (hung_pids == 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\txfree(pids);\n\t\t\tif (hung_pids) {\n\t\t\t\tinfo(\"Defering sending signal, processes in \"\n\t\t\t\t     \"job are currently core dumping\");\n\t\t\t\t_spawn_signal_thread(cont_id, signal);\n\t\t\t\treturn SLURM_SUCCESS;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (*(ops.signal)) (cont_id, signal);\n}"
        }
      },
      {
        "call_info": {
          "callee": "step_terminate_monitor_start",
          "args": [
            "job->jobid",
            "job->stepid"
          ],
          "line": 1082
        },
        "resolved": true,
        "details": {
          "function_name": "step_terminate_monitor_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/step_terminate_monitor.c",
          "lines": "59-92",
          "snippet": "void step_terminate_monitor_start(uint32_t jobid, uint32_t stepid)\n{\n\tslurm_ctl_conf_t *conf;\n\tpthread_attr_t attr;\n\n\tslurm_mutex_lock(&lock);\n\n\tif (running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tconf = slurm_conf_lock();\n\tif (conf->unkillable_program == NULL) {\n\t\t/* do nothing */\n\t\tslurm_conf_unlock();\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\ttimeout = conf->unkillable_timeout;\n\tprogram_name = xstrdup(conf->unkillable_program);\n\tslurm_conf_unlock();\n\n\tslurm_attr_init(&attr);\n\tpthread_create(&tid, &attr, _monitor, NULL);\n\tslurm_attr_destroy(&attr);\n\trunning_flag = 1;\n\trecorded_jobid = jobid;\n\trecorded_stepid = stepid;\n\n\tslurm_mutex_unlock(&lock);\n\n\treturn;\n}",
          "includes": [
            "#include <time.h>",
            "#include <pthread.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/macros.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;",
            "static int running_flag = 0;",
            "static pthread_t tid;",
            "static uint16_t timeout;",
            "static char *program_name;",
            "static uint32_t recorded_jobid = NO_VAL;",
            "static uint32_t recorded_stepid = NO_VAL;",
            "static void *_monitor(void *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <pthread.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/macros.h\"\n#  include \"config.h\"\n\nstatic pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;\nstatic int running_flag = 0;\nstatic pthread_t tid;\nstatic uint16_t timeout;\nstatic char *program_name;\nstatic uint32_t recorded_jobid = NO_VAL;\nstatic uint32_t recorded_stepid = NO_VAL;\nstatic void *_monitor(void *);\n\nvoid step_terminate_monitor_start(uint32_t jobid, uint32_t stepid)\n{\n\tslurm_ctl_conf_t *conf;\n\tpthread_attr_t attr;\n\n\tslurm_mutex_lock(&lock);\n\n\tif (running_flag) {\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\n\tconf = slurm_conf_lock();\n\tif (conf->unkillable_program == NULL) {\n\t\t/* do nothing */\n\t\tslurm_conf_unlock();\n\t\tslurm_mutex_unlock(&lock);\n\t\treturn;\n\t}\n\ttimeout = conf->unkillable_timeout;\n\tprogram_name = xstrdup(conf->unkillable_program);\n\tslurm_conf_unlock();\n\n\tslurm_attr_init(&attr);\n\tpthread_create(&tid, &attr, _monitor, NULL);\n\tslurm_attr_destroy(&attr);\n\trunning_flag = 1;\n\trecorded_jobid = jobid;\n\trecorded_stepid = stepid;\n\n\tslurm_mutex_unlock(&lock);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_fini",
          "args": [],
          "line": 1076
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_node_step_end",
          "args": [],
          "line": 1075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_endpoll",
          "args": [],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_task_end",
          "args": [
            "pid"
          ],
          "line": 1072
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_destroy",
          "args": [
            "jobacct"
          ],
          "line": 1070
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_aggregate",
          "args": [
            "job->jobacct",
            "jobacct"
          ],
          "line": 1069
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_setinfo",
          "args": [
            "jobacct",
            "JOBACCT_DATA_RUSAGE",
            "&rusage",
            "SLURM_PROTOCOL_VERSION"
          ],
          "line": 1065
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_remove_task",
          "args": [
            "pid"
          ],
          "line": 1063
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wait4",
          "args": [
            "pid",
            "&status",
            "0",
            "&rusage"
          ],
          "line": 1059
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"spank extern task post-fork failed\""
          ],
          "line": 1057
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_task_post_fork",
          "args": [
            "job",
            "-1"
          ],
          "line": 1056
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_stat_task",
          "args": [
            "0"
          ],
          "line": 1054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_g_add_cont",
          "args": [
            "job->jobid",
            "job->cont_id"
          ],
          "line": 1050
        },
        "resolved": true,
        "details": {
          "function_name": "container_g_add_cont",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/job_container_plugin.c",
          "lines": "213-226",
          "snippet": "extern int container_g_add_cont(uint32_t job_id, uint64_t cont_id)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_cont))(job_id, cont_id);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static job_container_ops_t\t*ops = NULL;",
            "static int\t\t\tg_container_context_num = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic job_container_ops_t\t*ops = NULL;\nstatic int\t\t\tg_container_context_num = -1;\n\nextern int container_g_add_cont(uint32_t job_id, uint64_t cont_id)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_cont))(job_id, cont_id);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "jobacct_gather_add_task",
          "args": [
            "pid",
            "&jobacct_id",
            "1"
          ],
          "line": 1049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacct_gather_set_proctrack_container_id",
          "args": [
            "job->cont_id"
          ],
          "line": 1048
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kill",
          "args": [
            "pid",
            "SIGKILL"
          ],
          "line": 1041
        },
        "resolved": true,
        "details": {
          "function_name": "_delay_kill_thread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2124-2144",
          "snippet": "static void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _delay_kill_thread(pthread_t thread_id, int secs)\n{\n\tpthread_t kill_id;\n\tpthread_attr_t attr;\n\tkill_thread_t *kt = xmalloc(sizeof(kill_thread_t));\n\tint retries = 0;\n\n\tkt->thread_id = thread_id;\n\tkt->secs = secs;\n\tslurm_attr_init(&attr);\n\tpthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);\n\twhile (pthread_create(&kill_id, &attr, &_kill_thr, (void *) kt)) {\n\t\terror(\"_delay_kill_thread: pthread_create: %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"_delay_kill_thread: Can't create pthread\");\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\tslurm_attr_destroy(&attr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "killpg",
          "args": [
            "pid",
            "SIGKILL"
          ],
          "line": 1040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: Step %u.%u unable to add pid %d to the proctrack plugin\"",
            "__func__",
            "job->jobid",
            "job->stepid",
            "pid"
          ],
          "line": 1038
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "proctrack_g_add",
          "args": [
            "job",
            "pid"
          ],
          "line": 1037
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "180-199",
          "snippet": "extern int proctrack_g_add(stepd_step_rec_t * job, pid_t pid)\n{\n\tint i = 0, max_retry = 3, rc;\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\t/* Sometimes a plugin is transient in adding a pid, so lets\n\t * try a few times before we call it quits.\n\t */\n\twhile ((rc = (*(ops.add)) (job, pid)) != SLURM_SUCCESS) {\n\t\tif (i++ > max_retry)\n\t\t\tbreak;\n\t\tdebug(\"%s: %u.%u couldn't add pid %u, sleeping and trying again\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tsleep(1);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern int proctrack_g_add(stepd_step_rec_t * job, pid_t pid)\n{\n\tint i = 0, max_retry = 3, rc;\n\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\t/* Sometimes a plugin is transient in adding a pid, so lets\n\t * try a few times before we call it quits.\n\t */\n\twhile ((rc = (*(ops.add)) (job, pid)) != SLURM_SUCCESS) {\n\t\tif (i++ > max_retry)\n\t\t\tbreak;\n\t\tdebug(\"%s: %u.%u couldn't add pid %u, sleeping and trying again\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tsleep(1);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"fork: %m\""
          ],
          "line": 1029
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "0"
          ],
          "line": 1027
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "1"
          ],
          "line": 1026
        },
        "resolved": true,
        "details": {
          "function_name": "_random_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "664-678",
          "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"execl: %m\""
          ],
          "line": 1025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "execl",
          "args": [
            "SLEEP_CMD",
            "\"sleep\"",
            "\"1000000\"",
            "NULL"
          ],
          "line": 1024
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_child_forked",
          "args": [],
          "line": 1021
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsid",
          "args": [],
          "line": 1020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgid",
          "args": [
            "0",
            "0"
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 1017
        },
        "resolved": true,
        "details": {
          "function_name": "_install_fork_handlers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd.c",
          "lines": "1991-1999",
          "snippet": "static void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/slurmd/req.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/stepd_api.h\"",
            "#include \"src/common/slurm_topology.h\"",
            "#include \"src/common/slurm_strcasestr.h\"",
            "#include \"src/common/slurm_route.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_mcs.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_acct_gather_energy.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_auth.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/proc_args.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/parse_time.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/pack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/node_features.h\"",
            "#include \"src/common/node_conf.h\"",
            "#include \"src/common/msg_aggr.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/daemonize.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/bitstring.h\"",
            "#include <unistd.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/resource.h>",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pthread.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <dlfcn.h>",
            "#include <dirent.h>",
            "#  include <hwloc.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void      _atfork_final(void);",
            "static void      _atfork_prepare(void);",
            "static void      _install_fork_handlers(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/slurmd/req.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/stepd_api.h\"\n#include \"src/common/slurm_topology.h\"\n#include \"src/common/slurm_strcasestr.h\"\n#include \"src/common/slurm_route.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_mcs.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_acct_gather_energy.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_auth.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/proc_args.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/parse_time.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/pack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/node_features.h\"\n#include \"src/common/node_conf.h\"\n#include \"src/common/msg_aggr.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/daemonize.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/bitstring.h\"\n#include <unistd.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <dlfcn.h>\n#include <dirent.h>\n#  include <hwloc.h>\n#  include \"config.h\"\n\nstatic void      _atfork_final(void);\nstatic void      _atfork_prepare(void);\nstatic void      _install_fork_handlers(void);\n\nstatic void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acct_gather_profile_g_task_start",
          "args": [
            "0"
          ],
          "line": 1016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: Failed to invoke task plugins: one of \"\n\t\t      \"task_p_pre_setuid functions returned error\"",
            "__func__"
          ],
          "line": 1012
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "task_g_pre_setuid",
          "args": [
            "job"
          ],
          "line": 1011
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_pre_setuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "329-342",
          "snippet": "extern int task_g_pre_setuid(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_setuid))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_pre_setuid(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_setuid))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_oom_adj",
          "args": [
            "0"
          ],
          "line": 1010
        },
        "resolved": true,
        "details": {
          "function_name": "set_oom_adj",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/set_oomadj.c",
          "lines": "93-98",
          "snippet": "extern int set_oom_adj(int adj)\n{\n\t/* FreeBSD does not handle OOM the same way Linux does */\n\t(void) adj; /* unused argument */\n\treturn 0;\n}",
          "includes": [
            "#include \"src/common/log.h\"",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/common/log.h\"\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <errno.h>\n\nextern int set_oom_adj(int adj)\n{\n\t/* FreeBSD does not handle OOM the same way Linux does */\n\t(void) adj; /* unused argument */\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"%s: After call to spank_init()\"",
            "__func__"
          ],
          "line": 1008
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_init",
          "args": [
            "job"
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"%s: Before call to spank_init()\"",
            "__func__"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _spawn_job_container(stepd_step_rec_t *job)\n{\n\tjobacctinfo_t *jobacct = NULL;\n\tstruct rusage rusage;\n\tjobacct_id_t jobacct_id;\n\tint status = 0;\n\tpid_t pid;\n\tint rc = SLURM_SUCCESS;\n\n\tdebug2(\"%s: Before call to spank_init()\", __func__);\n\tif (spank_init(job) < 0) {\n\t\terror(\"%s: Plugin stack initialization failed.\", __func__);\n\t\treturn SLURM_PLUGIN_NAME_INVALID;\n\t}\n\tdebug2(\"%s: After call to spank_init()\", __func__);\n\n\tset_oom_adj(0);\t/* the tasks may be killed by OOM */\n\tif (task_g_pre_setuid(job)) {\n\t\terror(\"%s: Failed to invoke task plugins: one of \"\n\t\t      \"task_p_pre_setuid functions returned error\", __func__);\n\t}\n\n\tacct_gather_profile_g_task_start(0);\n\tpid = fork();\n\tif (pid == 0) {\n\t\tsetpgid(0, 0);\n\t\tsetsid();\n\t\tacct_gather_profile_g_child_forked();\n\t\t/* Need to exec() something for proctrack/linuxproc to work,\n\t\t * it will not keep a process named \"slurmstepd\" */\n\t\texecl(SLEEP_CMD, \"sleep\", \"1000000\", NULL);\n\t\terror(\"execl: %m\");\n\t\tsleep(1);\n\t\texit(0);\n\t} else if (pid < 0) {\n\t\terror(\"fork: %m\");\n\t\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\t\trc = SLURM_ERROR;\n\t\tgoto fail1;\n\t}\n\n\tjob->pgid = pid;\n\n\tif ((rc = proctrack_g_add(job, pid)) != SLURM_SUCCESS) {\n\t\terror(\"%s: Step %u.%u unable to add pid %d to the proctrack plugin\",\n\t\t      __func__, job->jobid, job->stepid, pid);\n\t\tkillpg(pid, SIGKILL);\n\t\tkill(pid, SIGKILL);\n\t\tgoto fail1;\n\t}\n\n\tjobacct_id.nodeid = job->nodeid;\n\tjobacct_id.taskid = job->nodeid;   /* Treat node ID as global task ID */\n\tjobacct_id.job    = job;\n\tjobacct_gather_set_proctrack_container_id(job->cont_id);\n\tjobacct_gather_add_task(pid, &jobacct_id, 1);\n\tcontainer_g_add_cont(job->jobid, job->cont_id);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_RUNNING);\n\tif (!conf->job_acct_gather_freq)\n\t\tjobacct_gather_stat_task(0);\n\n\tif (spank_task_post_fork(job, -1) < 0)\n\t\terror(\"spank extern task post-fork failed\");\n\n\twhile ((wait4(pid, &status, 0, &rusage) < 0) && (errno == EINTR)) {\n\t\t;\t       /* Wait until above processs exits from signal */\n\t}\n\n\tjobacct = jobacct_gather_remove_task(pid);\n\tif (jobacct) {\n\t\tjobacctinfo_setinfo(jobacct,\n\t\t\t\t    JOBACCT_DATA_RUSAGE, &rusage,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tjob->jobacct->energy.consumed_energy = 0;\n\t\tjobacctinfo_aggregate(job->jobacct, jobacct);\n\t\tjobacctinfo_destroy(jobacct);\n\t}\n\tacct_gather_profile_g_task_end(pid);\n\tstep_complete.rank = job->nodeid;\n\tacct_gather_profile_endpoll();\n\tacct_gather_profile_g_node_step_end();\n\tacct_gather_profile_fini();\n\n\t/* Call the other plugins to clean up\n\t * the cgroup hierarchy.\n\t */\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\tstep_terminate_monitor_start(job->jobid, job->stepid);\n\tproctrack_g_signal(job->cont_id, SIGKILL);\n\tproctrack_g_wait(job->cont_id);\n\tstep_terminate_monitor_stop();\n\n\ttask_g_post_step(job);\n\nfail1:\n\tdebug2(\"%s: Before call to spank_fini()\", __func__);\n\tif (spank_fini(job) < 0)\n\t\terror(\"spank_fini failed\");\n\tdebug2(\"%s: After call to spank_fini()\", __func__);\n\n\t_set_job_state(job, SLURMSTEPD_STEP_ENDING);\n\n\tif (step_complete.rank > -1)\n\t\t_wait_for_children_slurmstepd(job);\n\t_send_step_complete_msgs(job);\n\n\treturn rc;\n}"
  },
  {
    "function_name": "_set_job_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "986-992",
    "snippet": "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _reclaim_privileges(struct priv_state *state);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&job->state_mutex"
          ],
          "line": 991
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pthread_cond_signal",
          "args": [
            "&job->state_cond"
          ],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&job->state_mutex"
          ],
          "line": 988
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}"
  },
  {
    "function_name": "agent_queue_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "980-984",
    "snippet": "extern void agent_queue_request(void *dummy)\n{\n\tfatal(\"Invalid agent_queue_request function call, likely from \"\n\t      \"checkpoint plugin\");\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fatal",
          "args": [
            "\"Invalid agent_queue_request function call, likely from \"\n\t      \"checkpoint plugin\""
          ],
          "line": 982
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nextern void agent_queue_request(void *dummy)\n{\n\tfatal(\"Invalid agent_queue_request function call, likely from \"\n\t      \"checkpoint plugin\");\n}"
  },
  {
    "function_name": "_send_step_complete_msgs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "937-975",
    "snippet": "static void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&step_complete.lock"
          ],
          "line": 974
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_one_step_complete_msg",
          "args": [
            "job",
            "step_complete.rank",
            "step_complete.rank"
          ],
          "line": 970
        },
        "resolved": true,
        "details": {
          "function_name": "_one_step_complete_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "781-891",
          "snippet": "static void\n_one_step_complete_msg(stepd_step_rec_t *job, int first, int last)\n{\n\tslurm_msg_t req;\n\tstep_complete_msg_t msg;\n\tint rc = -1;\n\tint retcode;\n\tint i;\n\tuint16_t port = 0;\n\tchar ip_buf[16];\n\tstatic bool acct_sent = false;\n\n\tdebug2(\"_one_step_complete_msg: first=%d, last=%d\", first, last);\n\n\tif (job->batch) {\t/* Nested batch step anomalies */\n\t\tif (first == -1)\n\t\t\tfirst = 0;\n\t\tif (last == -1)\n\t\t\tlast = 0;\n\t}\n\tmemset(&msg, 0, sizeof(step_complete_msg_t));\n\tmsg.job_id = job->jobid;\n\tmsg.job_step_id = job->stepid;\n\tmsg.range_first = first;\n\tmsg.range_last = last;\n\tmsg.step_rc = step_complete.step_rc;\n\tmsg.jobacct = jobacctinfo_create(NULL);\n\t/************* acct stuff ********************/\n\tif (!acct_sent) {\n\t\tjobacctinfo_aggregate(step_complete.jobacct, job->jobacct);\n\t\tjobacctinfo_getinfo(step_complete.jobacct,\n\t\t\t\t    JOBACCT_DATA_TOTAL, msg.jobacct,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tacct_sent = true;\n\t}\n\t/*********************************************/\n\tslurm_msg_t_init(&req);\n\treq.msg_type = REQUEST_STEP_COMPLETE;\n\treq.data = &msg;\n\treq.address = step_complete.parent_addr;\n\n\t/* Do NOT change this check to \"step_complete.rank != 0\", because\n\t * there are odd situations where SlurmUser or root could\n\t * craft a launch without a valid credential, and no tree information\n\t * can be built with out the hostlist from the credential.\n\t */\n\tif (step_complete.parent_rank != -1) {\n\t\tdebug3(\"Rank %d sending complete to rank %d, range %d to %d\",\n\t\t       step_complete.rank, step_complete.parent_rank,\n\t\t       first, last);\n\t\t/* On error, pause then try sending to parent again.\n\t\t * The parent slurmstepd may just not have started yet, because\n\t\t * of the way that the launch message forwarding works.\n\t\t */\n\t\tfor (i = 0; i < REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\t/* on error AGAIN, send to the slurmctld instead */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t} else if (conf->msg_aggr_window_msgs > 1) {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmd for message aggr, \"\n\t\t       \"range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t\t/* this is the base of the tree, but we are doing\n\t\t * message aggr so send it to the slurmd to handle */\n\t\treq.msg_type = REQUEST_STEP_COMPLETE_AGGR;\n\t\tslurm_set_addr_char(&req.address, conf->port, conf->hostname);\n\t\tfor (i = 0; i <= REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\treq.msg_type = REQUEST_STEP_COMPLETE;\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t}  else {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld, range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t}\n\n\t/* Retry step complete RPC send to slurmctld indefinitely.\n\t * Prevent orphan job step if slurmctld is down */\n\ti = 1;\n\twhile (slurm_send_recv_controller_rc_msg(&req, &rc) < 0) {\n\t\tif (i++ == 1) {\n\t\t\tslurm_get_ip_str(&step_complete.parent_addr, &port,\n\t\t\t\t\t ip_buf, sizeof(ip_buf));\n\t\t\terror(\"Rank %d failed sending step completion message \"\n\t\t\t      \"directly to slurmctld (%s:%u), retrying\",\n\t\t\t      step_complete.rank, ip_buf, port);\n\t\t}\n\t\tsleep(60);\n\t}\n\tif (i > 1) {\n\t\tinfo(\"Rank %d sent step completion message directly to \"\n\t\t     \"slurmctld (%s:%u)\", step_complete.rank, ip_buf, port);\n\t}\n\nfinished:\n\tjobacctinfo_destroy(msg.jobacct);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_one_step_complete_msg(stepd_step_rec_t *job, int first, int last)\n{\n\tslurm_msg_t req;\n\tstep_complete_msg_t msg;\n\tint rc = -1;\n\tint retcode;\n\tint i;\n\tuint16_t port = 0;\n\tchar ip_buf[16];\n\tstatic bool acct_sent = false;\n\n\tdebug2(\"_one_step_complete_msg: first=%d, last=%d\", first, last);\n\n\tif (job->batch) {\t/* Nested batch step anomalies */\n\t\tif (first == -1)\n\t\t\tfirst = 0;\n\t\tif (last == -1)\n\t\t\tlast = 0;\n\t}\n\tmemset(&msg, 0, sizeof(step_complete_msg_t));\n\tmsg.job_id = job->jobid;\n\tmsg.job_step_id = job->stepid;\n\tmsg.range_first = first;\n\tmsg.range_last = last;\n\tmsg.step_rc = step_complete.step_rc;\n\tmsg.jobacct = jobacctinfo_create(NULL);\n\t/************* acct stuff ********************/\n\tif (!acct_sent) {\n\t\tjobacctinfo_aggregate(step_complete.jobacct, job->jobacct);\n\t\tjobacctinfo_getinfo(step_complete.jobacct,\n\t\t\t\t    JOBACCT_DATA_TOTAL, msg.jobacct,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tacct_sent = true;\n\t}\n\t/*********************************************/\n\tslurm_msg_t_init(&req);\n\treq.msg_type = REQUEST_STEP_COMPLETE;\n\treq.data = &msg;\n\treq.address = step_complete.parent_addr;\n\n\t/* Do NOT change this check to \"step_complete.rank != 0\", because\n\t * there are odd situations where SlurmUser or root could\n\t * craft a launch without a valid credential, and no tree information\n\t * can be built with out the hostlist from the credential.\n\t */\n\tif (step_complete.parent_rank != -1) {\n\t\tdebug3(\"Rank %d sending complete to rank %d, range %d to %d\",\n\t\t       step_complete.rank, step_complete.parent_rank,\n\t\t       first, last);\n\t\t/* On error, pause then try sending to parent again.\n\t\t * The parent slurmstepd may just not have started yet, because\n\t\t * of the way that the launch message forwarding works.\n\t\t */\n\t\tfor (i = 0; i < REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\t/* on error AGAIN, send to the slurmctld instead */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t} else if (conf->msg_aggr_window_msgs > 1) {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmd for message aggr, \"\n\t\t       \"range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t\t/* this is the base of the tree, but we are doing\n\t\t * message aggr so send it to the slurmd to handle */\n\t\treq.msg_type = REQUEST_STEP_COMPLETE_AGGR;\n\t\tslurm_set_addr_char(&req.address, conf->port, conf->hostname);\n\t\tfor (i = 0; i <= REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\treq.msg_type = REQUEST_STEP_COMPLETE;\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t}  else {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld, range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t}\n\n\t/* Retry step complete RPC send to slurmctld indefinitely.\n\t * Prevent orphan job step if slurmctld is down */\n\ti = 1;\n\twhile (slurm_send_recv_controller_rc_msg(&req, &rc) < 0) {\n\t\tif (i++ == 1) {\n\t\t\tslurm_get_ip_str(&step_complete.parent_addr, &port,\n\t\t\t\t\t ip_buf, sizeof(ip_buf));\n\t\t\terror(\"Rank %d failed sending step completion message \"\n\t\t\t      \"directly to slurmctld (%s:%u), retrying\",\n\t\t\t      step_complete.rank, ip_buf, port);\n\t\t}\n\t\tsleep(60);\n\t}\n\tif (i > 1) {\n\t\tinfo(\"Rank %d sent step completion message directly to \"\n\t\t     \"slurmctld (%s:%u)\", step_complete.rank, ip_buf, port);\n\t}\n\nfinished:\n\tjobacctinfo_destroy(msg.jobacct);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_bit_getrange",
          "args": [
            "start",
            "size",
            "&first",
            "&last"
          ],
          "line": 956
        },
        "resolved": true,
        "details": {
          "function_name": "_bit_getrange",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "899-929",
          "snippet": "static int\n_bit_getrange(int start, int size, int *first, int *last)\n{\n\tint i;\n\tbool found_first = false;\n\n\tfor (i = start; i < size; i++) {\n\t\tif (bit_test(step_complete.bits, i)) {\n\t\t\tif (found_first) {\n\t\t\t\t*last = i;\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tfound_first = true;\n\t\t\t\t*first = i;\n\t\t\t\t*last = i;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!found_first) {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\t*last = i - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (found_first)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\n\nstatic int\n_bit_getrange(int start, int size, int *first, int *last)\n{\n\tint i;\n\tbool found_first = false;\n\n\tfor (i = start; i < size; i++) {\n\t\tif (bit_test(step_complete.bits, i)) {\n\t\t\tif (found_first) {\n\t\t\t\t*last = i;\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tfound_first = true;\n\t\t\t\t*first = i;\n\t\t\t\t*last = i;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!found_first) {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\t*last = i - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (found_first)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&step_complete.lock"
          ],
          "line": 952
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bit_size",
          "args": [
            "step_complete.bits"
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&step_complete.lock"
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
  },
  {
    "function_name": "_bit_getrange",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "899-929",
    "snippet": "static int\n_bit_getrange(int start, int size, int *first, int *last)\n{\n\tint i;\n\tbool found_first = false;\n\n\tfor (i = start; i < size; i++) {\n\t\tif (bit_test(step_complete.bits, i)) {\n\t\t\tif (found_first) {\n\t\t\t\t*last = i;\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tfound_first = true;\n\t\t\t\t*first = i;\n\t\t\t\t*last = i;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!found_first) {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\t*last = i - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (found_first)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bit_test",
          "args": [
            "step_complete.bits",
            "i"
          ],
          "line": 906
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\n\nstatic int\n_bit_getrange(int start, int size, int *first, int *last)\n{\n\tint i;\n\tbool found_first = false;\n\n\tfor (i = start; i < size; i++) {\n\t\tif (bit_test(step_complete.bits, i)) {\n\t\t\tif (found_first) {\n\t\t\t\t*last = i;\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tfound_first = true;\n\t\t\t\t*first = i;\n\t\t\t\t*last = i;\n\t\t\t}\n\t\t} else {\n\t\t\tif (!found_first) {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\t*last = i - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (found_first)\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}"
  },
  {
    "function_name": "_one_step_complete_msg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "781-891",
    "snippet": "static void\n_one_step_complete_msg(stepd_step_rec_t *job, int first, int last)\n{\n\tslurm_msg_t req;\n\tstep_complete_msg_t msg;\n\tint rc = -1;\n\tint retcode;\n\tint i;\n\tuint16_t port = 0;\n\tchar ip_buf[16];\n\tstatic bool acct_sent = false;\n\n\tdebug2(\"_one_step_complete_msg: first=%d, last=%d\", first, last);\n\n\tif (job->batch) {\t/* Nested batch step anomalies */\n\t\tif (first == -1)\n\t\t\tfirst = 0;\n\t\tif (last == -1)\n\t\t\tlast = 0;\n\t}\n\tmemset(&msg, 0, sizeof(step_complete_msg_t));\n\tmsg.job_id = job->jobid;\n\tmsg.job_step_id = job->stepid;\n\tmsg.range_first = first;\n\tmsg.range_last = last;\n\tmsg.step_rc = step_complete.step_rc;\n\tmsg.jobacct = jobacctinfo_create(NULL);\n\t/************* acct stuff ********************/\n\tif (!acct_sent) {\n\t\tjobacctinfo_aggregate(step_complete.jobacct, job->jobacct);\n\t\tjobacctinfo_getinfo(step_complete.jobacct,\n\t\t\t\t    JOBACCT_DATA_TOTAL, msg.jobacct,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tacct_sent = true;\n\t}\n\t/*********************************************/\n\tslurm_msg_t_init(&req);\n\treq.msg_type = REQUEST_STEP_COMPLETE;\n\treq.data = &msg;\n\treq.address = step_complete.parent_addr;\n\n\t/* Do NOT change this check to \"step_complete.rank != 0\", because\n\t * there are odd situations where SlurmUser or root could\n\t * craft a launch without a valid credential, and no tree information\n\t * can be built with out the hostlist from the credential.\n\t */\n\tif (step_complete.parent_rank != -1) {\n\t\tdebug3(\"Rank %d sending complete to rank %d, range %d to %d\",\n\t\t       step_complete.rank, step_complete.parent_rank,\n\t\t       first, last);\n\t\t/* On error, pause then try sending to parent again.\n\t\t * The parent slurmstepd may just not have started yet, because\n\t\t * of the way that the launch message forwarding works.\n\t\t */\n\t\tfor (i = 0; i < REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\t/* on error AGAIN, send to the slurmctld instead */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t} else if (conf->msg_aggr_window_msgs > 1) {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmd for message aggr, \"\n\t\t       \"range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t\t/* this is the base of the tree, but we are doing\n\t\t * message aggr so send it to the slurmd to handle */\n\t\treq.msg_type = REQUEST_STEP_COMPLETE_AGGR;\n\t\tslurm_set_addr_char(&req.address, conf->port, conf->hostname);\n\t\tfor (i = 0; i <= REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\treq.msg_type = REQUEST_STEP_COMPLETE;\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t}  else {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld, range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t}\n\n\t/* Retry step complete RPC send to slurmctld indefinitely.\n\t * Prevent orphan job step if slurmctld is down */\n\ti = 1;\n\twhile (slurm_send_recv_controller_rc_msg(&req, &rc) < 0) {\n\t\tif (i++ == 1) {\n\t\t\tslurm_get_ip_str(&step_complete.parent_addr, &port,\n\t\t\t\t\t ip_buf, sizeof(ip_buf));\n\t\t\terror(\"Rank %d failed sending step completion message \"\n\t\t\t      \"directly to slurmctld (%s:%u), retrying\",\n\t\t\t      step_complete.rank, ip_buf, port);\n\t\t}\n\t\tsleep(60);\n\t}\n\tif (i > 1) {\n\t\tinfo(\"Rank %d sent step completion message directly to \"\n\t\t     \"slurmctld (%s:%u)\", step_complete.rank, ip_buf, port);\n\t}\n\nfinished:\n\tjobacctinfo_destroy(msg.jobacct);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "jobacctinfo_destroy",
          "args": [
            "msg.jobacct"
          ],
          "line": 890
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"Rank %d sent step completion message directly to \"\n\t\t     \"slurmctld (%s:%u)\"",
            "step_complete.rank",
            "ip_buf",
            "port"
          ],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "srun_info_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "601-638",
          "snippet": "extern srun_info_t *\nsrun_info_create(slurm_cred_t *cred, slurm_addr_t *resp_addr,\n\t\t slurm_addr_t *ioaddr, uint16_t protocol_version)\n{\n\tchar             *data = NULL;\n\tuint32_t          len  = 0;\n\tsrun_info_t *srun = xmalloc(sizeof(srun_info_t));\n\tsrun_key_t       *key  = xmalloc(sizeof(srun_key_t));\n\n\tsrun->key    = key;\n\tif (!protocol_version || (protocol_version == (uint16_t)NO_VAL))\n\t\tprotocol_version = SLURM_PROTOCOL_VERSION;\n\tsrun->protocol_version = protocol_version;\n\t/*\n\t * If no credential was provided, return the empty\n\t * srun info object. (This is used, for example, when\n\t * creating a batch job structure)\n\t */\n\tif (!cred) return srun;\n\n\tslurm_cred_get_signature(cred, &data, &len);\n\n\tlen = len > SLURM_IO_KEY_SIZE ? SLURM_IO_KEY_SIZE : len;\n\n\tif (data != NULL) {\n\t\tmemcpy((void *) key->data, data, len);\n\n\t\tif (len < SLURM_IO_KEY_SIZE)\n\t\t\tmemset( (void *) (key->data + len), 0,\n\t\t\t\tSLURM_IO_KEY_SIZE - len);\n\t}\n\n\tif (ioaddr != NULL)\n\t\tsrun->ioaddr    = *ioaddr;\n\tif (resp_addr != NULL)\n\t\tsrun->resp_addr = *resp_addr;\n\treturn srun;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nextern srun_info_t *\nsrun_info_create(slurm_cred_t *cred, slurm_addr_t *resp_addr,\n\t\t slurm_addr_t *ioaddr, uint16_t protocol_version)\n{\n\tchar             *data = NULL;\n\tuint32_t          len  = 0;\n\tsrun_info_t *srun = xmalloc(sizeof(srun_info_t));\n\tsrun_key_t       *key  = xmalloc(sizeof(srun_key_t));\n\n\tsrun->key    = key;\n\tif (!protocol_version || (protocol_version == (uint16_t)NO_VAL))\n\t\tprotocol_version = SLURM_PROTOCOL_VERSION;\n\tsrun->protocol_version = protocol_version;\n\t/*\n\t * If no credential was provided, return the empty\n\t * srun info object. (This is used, for example, when\n\t * creating a batch job structure)\n\t */\n\tif (!cred) return srun;\n\n\tslurm_cred_get_signature(cred, &data, &len);\n\n\tlen = len > SLURM_IO_KEY_SIZE ? SLURM_IO_KEY_SIZE : len;\n\n\tif (data != NULL) {\n\t\tmemcpy((void *) key->data, data, len);\n\n\t\tif (len < SLURM_IO_KEY_SIZE)\n\t\t\tmemset( (void *) (key->data + len), 0,\n\t\t\t\tSLURM_IO_KEY_SIZE - len);\n\t}\n\n\tif (ioaddr != NULL)\n\t\tsrun->ioaddr    = *ioaddr;\n\tif (resp_addr != NULL)\n\t\tsrun->resp_addr = *resp_addr;\n\treturn srun;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "60"
          ],
          "line": 882
        },
        "resolved": true,
        "details": {
          "function_name": "_random_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "664-678",
          "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Rank %d failed sending step completion message \"\n\t\t\t      \"directly to slurmctld (%s:%u), retrying\"",
            "step_complete.rank",
            "ip_buf",
            "port"
          ],
          "line": 878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_get_ip_str",
          "args": [
            "&step_complete.parent_addr",
            "&port",
            "ip_buf",
            "sizeof(ip_buf)"
          ],
          "line": 876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_send_recv_controller_rc_msg",
          "args": [
            "&req",
            "&rc"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Rank %d sending complete to slurmctld, range %d to %d\"",
            "step_complete.rank",
            "first",
            "last"
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\"",
            "step_complete.rank",
            "first",
            "last"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_send_recv_rc_msg_only_one",
          "args": [
            "&req",
            "&rc",
            "0"
          ],
          "line": 857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_set_addr_char",
          "args": [
            "&req.address",
            "conf->port",
            "conf->hostname"
          ],
          "line": 853
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Rank %d sending complete to slurmd for message aggr, \"\n\t\t       \"range %d to %d\"",
            "step_complete.rank",
            "first",
            "last"
          ],
          "line": 847
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\"",
            "step_complete.rank",
            "first",
            "last"
          ],
          "line": 843
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_send_recv_rc_msg_only_one",
          "args": [
            "&req",
            "&rc",
            "0"
          ],
          "line": 838
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Rank %d sending complete to rank %d, range %d to %d\"",
            "step_complete.rank",
            "step_complete.parent_rank",
            "first",
            "last"
          ],
          "line": 828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_msg_t_init",
          "args": [
            "&req"
          ],
          "line": 817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_getinfo",
          "args": [
            "step_complete.jobacct",
            "JOBACCT_DATA_TOTAL",
            "msg.jobacct",
            "SLURM_PROTOCOL_VERSION"
          ],
          "line": 811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_aggregate",
          "args": [
            "step_complete.jobacct",
            "job->jobacct"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jobacctinfo_create",
          "args": [
            "NULL"
          ],
          "line": 807
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&msg",
            "0",
            "sizeof(step_complete_msg_t)"
          ],
          "line": 801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"_one_step_complete_msg: first=%d, last=%d\"",
            "first",
            "last"
          ],
          "line": 793
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_one_step_complete_msg(stepd_step_rec_t *job, int first, int last)\n{\n\tslurm_msg_t req;\n\tstep_complete_msg_t msg;\n\tint rc = -1;\n\tint retcode;\n\tint i;\n\tuint16_t port = 0;\n\tchar ip_buf[16];\n\tstatic bool acct_sent = false;\n\n\tdebug2(\"_one_step_complete_msg: first=%d, last=%d\", first, last);\n\n\tif (job->batch) {\t/* Nested batch step anomalies */\n\t\tif (first == -1)\n\t\t\tfirst = 0;\n\t\tif (last == -1)\n\t\t\tlast = 0;\n\t}\n\tmemset(&msg, 0, sizeof(step_complete_msg_t));\n\tmsg.job_id = job->jobid;\n\tmsg.job_step_id = job->stepid;\n\tmsg.range_first = first;\n\tmsg.range_last = last;\n\tmsg.step_rc = step_complete.step_rc;\n\tmsg.jobacct = jobacctinfo_create(NULL);\n\t/************* acct stuff ********************/\n\tif (!acct_sent) {\n\t\tjobacctinfo_aggregate(step_complete.jobacct, job->jobacct);\n\t\tjobacctinfo_getinfo(step_complete.jobacct,\n\t\t\t\t    JOBACCT_DATA_TOTAL, msg.jobacct,\n\t\t\t\t    SLURM_PROTOCOL_VERSION);\n\t\tacct_sent = true;\n\t}\n\t/*********************************************/\n\tslurm_msg_t_init(&req);\n\treq.msg_type = REQUEST_STEP_COMPLETE;\n\treq.data = &msg;\n\treq.address = step_complete.parent_addr;\n\n\t/* Do NOT change this check to \"step_complete.rank != 0\", because\n\t * there are odd situations where SlurmUser or root could\n\t * craft a launch without a valid credential, and no tree information\n\t * can be built with out the hostlist from the credential.\n\t */\n\tif (step_complete.parent_rank != -1) {\n\t\tdebug3(\"Rank %d sending complete to rank %d, range %d to %d\",\n\t\t       step_complete.rank, step_complete.parent_rank,\n\t\t       first, last);\n\t\t/* On error, pause then try sending to parent again.\n\t\t * The parent slurmstepd may just not have started yet, because\n\t\t * of the way that the launch message forwarding works.\n\t\t */\n\t\tfor (i = 0; i < REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\t/* on error AGAIN, send to the slurmctld instead */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t} else if (conf->msg_aggr_window_msgs > 1) {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmd for message aggr, \"\n\t\t       \"range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t\t/* this is the base of the tree, but we are doing\n\t\t * message aggr so send it to the slurmd to handle */\n\t\treq.msg_type = REQUEST_STEP_COMPLETE_AGGR;\n\t\tslurm_set_addr_char(&req.address, conf->port, conf->hostname);\n\t\tfor (i = 0; i <= REVERSE_TREE_PARENT_RETRY; i++) {\n\t\t\tif (i)\n\t\t\t\tsleep(1);\n\t\t\tretcode = slurm_send_recv_rc_msg_only_one(&req, &rc, 0);\n\t\t\tif ((retcode == 0) && (rc == 0))\n\t\t\t\tgoto finished;\n\t\t}\n\t\treq.msg_type = REQUEST_STEP_COMPLETE;\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld instead, range \"\n\t\t       \"%d to %d\", step_complete.rank, first, last);\n\t}  else {\n\t\t/* this is the base of the tree, its parent is slurmctld */\n\t\tdebug3(\"Rank %d sending complete to slurmctld, range %d to %d\",\n\t\t       step_complete.rank, first, last);\n\t}\n\n\t/* Retry step complete RPC send to slurmctld indefinitely.\n\t * Prevent orphan job step if slurmctld is down */\n\ti = 1;\n\twhile (slurm_send_recv_controller_rc_msg(&req, &rc) < 0) {\n\t\tif (i++ == 1) {\n\t\t\tslurm_get_ip_str(&step_complete.parent_addr, &port,\n\t\t\t\t\t ip_buf, sizeof(ip_buf));\n\t\t\terror(\"Rank %d failed sending step completion message \"\n\t\t\t      \"directly to slurmctld (%s:%u), retrying\",\n\t\t\t      step_complete.rank, ip_buf, port);\n\t\t}\n\t\tsleep(60);\n\t}\n\tif (i > 1) {\n\t\tinfo(\"Rank %d sent step completion message directly to \"\n\t\t     \"slurmctld (%s:%u)\", step_complete.rank, ip_buf, port);\n\t}\n\nfinished:\n\tjobacctinfo_destroy(msg.jobacct);\n}"
  },
  {
    "function_name": "_wait_for_children_slurmstepd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "734-774",
    "snippet": "static void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&step_complete.lock"
          ],
          "line": 773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_get_exit_code",
          "args": [
            "job"
          ],
          "line": 770
        },
        "resolved": true,
        "details": {
          "function_name": "_get_exit_code",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "296-340",
          "snippet": "static uint32_t _get_exit_code(stepd_step_rec_t *job)\n{\n\tuint32_t i;\n\tuint32_t step_rc = NO_VAL;\n\n\t/* We are always killing/cancelling the extern_step so don't\n\t * report that.\n\t */\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn 0;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/* if this task was killed by cmd, ignore its\n\t\t * return status as it only reflects the fact\n\t\t * that we killed it\n\t\t */\n\t\tif (job->task[i]->killed_by_cmd) {\n\t\t\tdebug(\"get_exit_code task %u killed by cmd\", i);\n\t\t\tcontinue;\n\t\t}\n\t\t/* if this task called PMI_Abort or PMI2_Abort,\n\t\t * then we let it define the exit status\n\t\t */\n\t\tif (job->task[i]->aborted) {\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tdebug(\"get_exit_code task %u called abort\", i);\n\t\t\tbreak;\n\t\t}\n\t\t/* If signalled we need to cycle thru all the\n\t\t * tasks in case one of them called abort\n\t\t */\n\t\tif (WIFSIGNALED(job->task[i]->estatus)) {\n\t\t\terror(\"get_exit_code task %u died by signal\", i);\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tbreak;\n\t\t}\n\t\tstep_rc = MAX(step_complete.step_rc, job->task[i]->estatus);\n\t}\n\t/* If we killed all the tasks by cmd give at least one return\n\t   code. */\n\tif (step_rc == NO_VAL && job->task[0])\n\t\tstep_rc = job->task[0]->estatus;\n\n\treturn step_rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic uint32_t _get_exit_code(stepd_step_rec_t *job)\n{\n\tuint32_t i;\n\tuint32_t step_rc = NO_VAL;\n\n\t/* We are always killing/cancelling the extern_step so don't\n\t * report that.\n\t */\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn 0;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/* if this task was killed by cmd, ignore its\n\t\t * return status as it only reflects the fact\n\t\t * that we killed it\n\t\t */\n\t\tif (job->task[i]->killed_by_cmd) {\n\t\t\tdebug(\"get_exit_code task %u killed by cmd\", i);\n\t\t\tcontinue;\n\t\t}\n\t\t/* if this task called PMI_Abort or PMI2_Abort,\n\t\t * then we let it define the exit status\n\t\t */\n\t\tif (job->task[i]->aborted) {\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tdebug(\"get_exit_code task %u called abort\", i);\n\t\t\tbreak;\n\t\t}\n\t\t/* If signalled we need to cycle thru all the\n\t\t * tasks in case one of them called abort\n\t\t */\n\t\tif (WIFSIGNALED(job->task[i]->estatus)) {\n\t\t\terror(\"get_exit_code task %u died by signal\", i);\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tbreak;\n\t\t}\n\t\tstep_rc = MAX(step_complete.step_rc, job->task[i]->estatus);\n\t}\n\t/* If we killed all the tasks by cmd give at least one return\n\t   code. */\n\tif (step_rc == NO_VAL && job->task[0])\n\t\tstep_rc = job->task[0]->estatus;\n\n\treturn step_rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Rank %d has no children slurmstepd\"",
            "step_complete.rank"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Rank %d got all children completions\"",
            "step_complete.rank"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\"",
            "step_complete.rank",
            "left",
            "step_complete.children"
          ],
          "line": 755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pthread_cond_timedwait",
          "args": [
            "&step_complete.cond",
            "&step_complete.lock",
            "&ts"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"Rank %d waiting for %d (of %d) children\"",
            "step_complete.rank",
            "left",
            "step_complete.children"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bit_clear_count",
          "args": [
            "step_complete.bits"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "NULL"
          ],
          "line": 746
        },
        "resolved": true,
        "details": {
          "function_name": "get_up_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/get_mach_stat.c",
          "lines": "274-325",
          "snippet": "extern int get_up_time(uint32_t *up_time)\n{\n#if defined(HAVE_AIX) || defined(__sun) || defined(__APPLE__) || defined(__NetBSD__) || defined(__FreeBSD__)\n\tclock_t tm;\n\tstruct tms buf;\n\n\ttm = times(&buf);\n\tif (tm == (clock_t) -1) {\n\t\t*up_time = 0;\n\t\treturn errno;\n\t}\n\n\t*up_time = tm / sysconf(_SC_CLK_TCK);\n#elif defined(__CYGWIN__)\n\tFILE *uptime_file;\n\tchar buffer[128];\n\tchar* _uptime_path = \"/proc/uptime\";\n\n\tif (!(uptime_file = fopen(_uptime_path, \"r\"))) {\n\t\terror(\"get_up_time: error %d opening %s\", errno, _uptime_path);\n\t\treturn errno;\n\t}\n\n\tif (fgets(buffer, sizeof(buffer), uptime_file))\n\t\t*up_time = atoi(buffer);\n\n\tfclose(uptime_file);\n#else\n\t/* NOTE for Linux: The return value of times() may overflow the\n\t * possible range of type clock_t. There is also an offset of\n\t * 429 million seconds on some implementations. We just use the\n\t * simpler sysinfo() function instead. */\n\tstruct sysinfo info;\n\n\tif (sysinfo(&info) < 0) {\n\t\t*up_time = 0;\n\t\treturn errno;\n\t}\n\n\n\tif (conf->boot_time) {\n\t\t/* Make node look like it rebooted when slurmd started */\n\t\tstatic uint32_t orig_uptime = 0;\n\t\tif (orig_uptime == 0)\n\t\t\torig_uptime = info.uptime;\n\t\t*up_time = info.uptime - orig_uptime;\n\t} else {\n\t\t*up_time = info.uptime;\n\t}\n#endif\n\treturn 0;\n}",
          "includes": [
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmctld/slurmctld.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include <unistd.h>",
            "# include <kstat.h>",
            "#  include <sys/vfs.h>",
            "#  include <sys/statfs.h>",
            "#  include <sys/statvfs.h>",
            "#include <sys/utsname.h>",
            "#  include <sys/sysinfo.h>",
            "#  include <sys/times.h> /* for times(3) */",
            "#  include <sys/types.h>",
            "#  include <sys/times.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "# include <sys/sysctl.h>",
            "#include <sys/types.h>",
            "# include <sys/dr.h>",
            "# include <sys/systemcfg.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmctld/slurmctld.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include <unistd.h>\n# include <kstat.h>\n#  include <sys/vfs.h>\n#  include <sys/statfs.h>\n#  include <sys/statvfs.h>\n#include <sys/utsname.h>\n#  include <sys/sysinfo.h>\n#  include <sys/times.h> /* for times(3) */\n#  include <sys/types.h>\n#  include <sys/times.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <errno.h>\n# include <sys/sysctl.h>\n#include <sys/types.h>\n# include <sys/dr.h>\n# include <sys/systemcfg.h>\n#  include \"config.h\"\n\nextern int get_up_time(uint32_t *up_time)\n{\n#if defined(HAVE_AIX) || defined(__sun) || defined(__APPLE__) || defined(__NetBSD__) || defined(__FreeBSD__)\n\tclock_t tm;\n\tstruct tms buf;\n\n\ttm = times(&buf);\n\tif (tm == (clock_t) -1) {\n\t\t*up_time = 0;\n\t\treturn errno;\n\t}\n\n\t*up_time = tm / sysconf(_SC_CLK_TCK);\n#elif defined(__CYGWIN__)\n\tFILE *uptime_file;\n\tchar buffer[128];\n\tchar* _uptime_path = \"/proc/uptime\";\n\n\tif (!(uptime_file = fopen(_uptime_path, \"r\"))) {\n\t\terror(\"get_up_time: error %d opening %s\", errno, _uptime_path);\n\t\treturn errno;\n\t}\n\n\tif (fgets(buffer, sizeof(buffer), uptime_file))\n\t\t*up_time = atoi(buffer);\n\n\tfclose(uptime_file);\n#else\n\t/* NOTE for Linux: The return value of times() may overflow the\n\t * possible range of type clock_t. There is also an offset of\n\t * 429 million seconds on some implementations. We just use the\n\t * simpler sysinfo() function instead. */\n\tstruct sysinfo info;\n\n\tif (sysinfo(&info) < 0) {\n\t\t*up_time = 0;\n\t\treturn errno;\n\t}\n\n\n\tif (conf->boot_time) {\n\t\t/* Make node look like it rebooted when slurmd started */\n\t\tstatic uint32_t orig_uptime = 0;\n\t\tif (orig_uptime == 0)\n\t\t\torig_uptime = info.uptime;\n\t\t*up_time = info.uptime - orig_uptime;\n\t} else {\n\t\t*up_time = info.uptime;\n\t}\n#endif\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&step_complete.lock"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
  },
  {
    "function_name": "_send_exit_msg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "684-732",
    "snippet": "static int\n_send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n, int status)\n{\n\tslurm_msg_t     resp;\n\ttask_exit_msg_t msg;\n\tListIterator    i       = NULL;\n\tsrun_info_t    *srun    = NULL;\n\n\tdebug3(\"sending task exit msg for %d tasks status %d\", n, status);\n\n\tmsg.task_id_list\t= tid;\n\tmsg.num_tasks\t\t= n;\n\tmsg.return_code\t\t= status;\n\tmsg.job_id\t\t= job->jobid;\n\tmsg.step_id\t\t= job->stepid;\n\tslurm_msg_t_init(&resp);\n\tresp.data\t\t= &msg;\n\tresp.msg_type\t\t= MESSAGE_TASK_EXIT;\n\n\t/*\n\t *  Hack for TCP timeouts on exit of large, synchronized job\n\t *  termination. Delay a random amount if job->nnodes > 500\n\t */\n\tif (job->nnodes > 500)\n\t\t_random_sleep(job);\n\n\t/*\n\t * Notify each srun and sattach.\n\t * No message for poe or batch jobs\n\t */\n\ti = list_iterator_create(job->sruns);\n\twhile ((srun = list_next(i))) {\n\t\tresp.address = srun->resp_addr;\n\t\tif ((resp.address.sin_family == 0) &&\n\t\t    (resp.address.sin_port == 0)   &&\n\t\t    (resp.address.sin_addr.s_addr == 0))\n\t\t\tcontinue;\t/* no srun or sattach here */\n\n\t\t/* This should always be set to something else we have a bug. */\n\t\txassert(srun->protocol_version);\n\t\tresp.protocol_version = srun->protocol_version;\n\n\t\tif (_send_srun_resp_msg(&resp, job->nnodes) != SLURM_SUCCESS)\n\t\t\terror(\"Failed to send MESSAGE_TASK_EXIT: %m\");\n\t}\n\tlist_iterator_destroy(i);\n\n\treturn SLURM_SUCCESS;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "list_iterator_destroy",
          "args": [
            "i"
          ],
          "line": 729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to send MESSAGE_TASK_EXIT: %m\""
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_send_srun_resp_msg",
          "args": [
            "&resp",
            "job->nnodes"
          ],
          "line": 726
        },
        "resolved": true,
        "details": {
          "function_name": "_send_srun_resp_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "262-291",
          "snippet": "inline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\ninline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "srun->protocol_version"
          ],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_next",
          "args": [
            "i"
          ],
          "line": 715
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_iterator_create",
          "args": [
            "job->sruns"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_random_sleep",
          "args": [
            "job"
          ],
          "line": 708
        },
        "resolved": true,
        "details": {
          "function_name": "_random_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "664-678",
          "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_msg_t_init",
          "args": [
            "&resp"
          ],
          "line": 699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"sending task exit msg for %d tasks status %d\"",
            "n",
            "status"
          ],
          "line": 692
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n, int status)\n{\n\tslurm_msg_t     resp;\n\ttask_exit_msg_t msg;\n\tListIterator    i       = NULL;\n\tsrun_info_t    *srun    = NULL;\n\n\tdebug3(\"sending task exit msg for %d tasks status %d\", n, status);\n\n\tmsg.task_id_list\t= tid;\n\tmsg.num_tasks\t\t= n;\n\tmsg.return_code\t\t= status;\n\tmsg.job_id\t\t= job->jobid;\n\tmsg.step_id\t\t= job->stepid;\n\tslurm_msg_t_init(&resp);\n\tresp.data\t\t= &msg;\n\tresp.msg_type\t\t= MESSAGE_TASK_EXIT;\n\n\t/*\n\t *  Hack for TCP timeouts on exit of large, synchronized job\n\t *  termination. Delay a random amount if job->nnodes > 500\n\t */\n\tif (job->nnodes > 500)\n\t\t_random_sleep(job);\n\n\t/*\n\t * Notify each srun and sattach.\n\t * No message for poe or batch jobs\n\t */\n\ti = list_iterator_create(job->sruns);\n\twhile ((srun = list_next(i))) {\n\t\tresp.address = srun->resp_addr;\n\t\tif ((resp.address.sin_family == 0) &&\n\t\t    (resp.address.sin_port == 0)   &&\n\t\t    (resp.address.sin_addr.s_addr == 0))\n\t\t\tcontinue;\t/* no srun or sattach here */\n\n\t\t/* This should always be set to something else we have a bug. */\n\t\txassert(srun->protocol_version);\n\t\tresp.protocol_version = srun->protocol_version;\n\n\t\tif (_send_srun_resp_msg(&resp, job->nnodes) != SLURM_SUCCESS)\n\t\t\terror(\"Failed to send MESSAGE_TASK_EXIT: %m\");\n\t}\n\tlist_iterator_destroy(i);\n\n\treturn SLURM_SUCCESS;\n}"
  },
  {
    "function_name": "_random_sleep",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "664-678",
    "snippet": "static void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "NULL",
            "0",
            "delay"
          ],
          "line": 676
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"delaying %ldms\"",
            "delay"
          ],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lrand48",
          "args": [],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "srand48",
          "args": [
            "(long int) (job->jobid + job->nodeid)"
          ],
          "line": 672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "max",
            "5000"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_get_tcp_timeout",
          "args": [],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_random_sleep(stepd_step_rec_t *job)\n{\n#if !defined HAVE_FRONT_END\n\tlong int delay = 0;\n\tlong int max   = (slurm_get_tcp_timeout() * job->nnodes);\n\n\tmax = MIN(max, 5000);\n\tsrand48((long int) (job->jobid + job->nodeid));\n\n\tdelay = lrand48() % ( max + 1 );\n\tdebug3(\"delaying %ldms\", delay);\n\tpoll(NULL, 0, delay);\n#endif\n}"
  },
  {
    "function_name": "_setup_user_managed_io",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "651-662",
    "snippet": "static int\n_setup_user_managed_io(stepd_step_rec_t *job)\n{\n\tsrun_info_t *srun;\n\n\tif ((srun = list_peek(job->sruns)) == NULL) {\n\t\terror(\"_setup_user_managed_io: no clients!\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn user_managed_io_client_connect(job->node_tasks, srun, job->task);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "user_managed_io_client_connect",
          "args": [
            "job->node_tasks",
            "srun",
            "job->task"
          ],
          "line": 661
        },
        "resolved": true,
        "details": {
          "function_name": "user_managed_io_client_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1957-1978",
          "snippet": "int\nuser_managed_io_client_connect(int node_tasks, srun_info_t *srun,\n\t\t\t       stepd_step_task_info_t **tasks)\n{\n\tint fd;\n\tint i;\n\n\tfor (i = 0; i < node_tasks; i++) {\n\t\tfd = _user_managed_io_connect(srun, tasks[i]->gtid);\n\t\tif (fd == -1)\n\t\t\treturn SLURM_ERROR;\n\t\tfd_set_close_on_exec(fd);\n\t\ttasks[i]->stdin_fd = fd;\n\t\ttasks[i]->to_stdin = -1;\n\t\ttasks[i]->stdout_fd = fd;\n\t\ttasks[i]->from_stdout = -1;\n\t\ttasks[i]->stderr_fd = fd;\n\t\ttasks[i]->from_stderr = -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nint\nuser_managed_io_client_connect(int node_tasks, srun_info_t *srun,\n\t\t\t       stepd_step_task_info_t **tasks)\n{\n\tint fd;\n\tint i;\n\n\tfor (i = 0; i < node_tasks; i++) {\n\t\tfd = _user_managed_io_connect(srun, tasks[i]->gtid);\n\t\tif (fd == -1)\n\t\t\treturn SLURM_ERROR;\n\t\tfd_set_close_on_exec(fd);\n\t\ttasks[i]->stdin_fd = fd;\n\t\ttasks[i]->to_stdin = -1;\n\t\ttasks[i]->stdout_fd = fd;\n\t\ttasks[i]->from_stdout = -1;\n\t\ttasks[i]->stderr_fd = fd;\n\t\ttasks[i]->from_stderr = -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"_setup_user_managed_io: no clients!\""
          ],
          "line": 657
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_peek",
          "args": [
            "job->sruns"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_setup_user_managed_io(stepd_step_rec_t *job)\n{\n\tsrun_info_t *srun;\n\n\tif ((srun = list_peek(job->sruns)) == NULL) {\n\t\terror(\"_setup_user_managed_io: no clients!\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\treturn user_managed_io_client_connect(job->node_tasks, srun, job->task);\n}"
  },
  {
    "function_name": "_setup_normal_io",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "506-649",
    "snippet": "static int\n_setup_normal_io(stepd_step_rec_t *job)\n{\n\tint rc = 0, ii = 0;\n\tstruct priv_state sprivs;\n\n\tdebug2(\"Entering _setup_normal_io\");\n\n\t/*\n\t * Temporarily drop permissions, initialize task stdio file\n\t * descriptors (which may be connected to files), then\n\t * reclaim privileges.\n\t */\n\tif (_drop_privileges(job, true, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (io_init_tasks_stdio(job) != SLURM_SUCCESS) {\n\t\trc = ESLURMD_IO_ERROR;\n\t\tgoto claim;\n\t}\n\n\t/*\n\t * MUST create the initial client object before starting\n\t * the IO thread, or we risk losing stdout/err traffic.\n\t */\n\tif (!job->batch) {\n\t\tsrun_info_t *srun = list_peek(job->sruns);\n\n\t\t/* local id of task that sends to srun, -1 for all tasks,\n\t\t   any other value for no tasks */\n\t\tint srun_stdout_tasks = -1;\n\t\tint srun_stderr_tasks = -1;\n\n\t\txassert(srun != NULL);\n\n\t\t/* If I/O is labelled with task num, and if a separate file is\n\t\t   written per node or per task, the I/O needs to be sent\n\t\t   back to the stepd, get a label appended, and written from\n\t\t   the stepd rather than sent back to srun or written directly\n\t\t   from the node.  When a task has ofname or efname == NULL, it\n\t\t   means data gets sent back to the client. */\n\n\t\tif (job->labelio) {\n\t\t\tslurmd_filename_pattern_t outpattern, errpattern;\n\t\t\tbool same = false;\n\t\t\tint file_flags;\n\n\t\t\tio_find_filename_pattern(job, &outpattern, &errpattern,\n\t\t\t\t\t\t &same);\n\t\t\tfile_flags = io_get_file_flags(job);\n\n\t\t\t/* Make eio objects to write from the slurmstepd */\n\t\t\tif (outpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t/* Open a separate file per task */\n\t\t\t\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[ii]->ofname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\tjob->task[ii]->id,\n\t\t\t\t\t\tsame ? job->task[ii]->id : -2);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t\t      job->task[ii]->ofname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t} else if (outpattern == SLURMD_ALL_SAME) {\n\t\t\t\t/* Open a file for all tasks */\n\t\t\t\trc = io_create_local_client(\n\t\t\t\t\tjob->task[0]->ofname,\n\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t-1, same ? -1 : -2);\n\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t      job->task[0]->ofname);\n\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\tgoto claim;\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t}\n\n\t\t\tif (!same) {\n\t\t\t\tif (errpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t\t/* Open a separate file per task */\n\t\t\t\t\tfor (ii = 0;\n\t\t\t\t\t     ii < job->node_tasks; ii++) {\n\t\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\t\tjob->task[ii]->efname,\n\t\t\t\t\t\t\tfile_flags, job,\n\t\t\t\t\t\t\tjob->labelio,\n\t\t\t\t\t\t\t-2, job->task[ii]->id);\n\t\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t\t      job->task[ii]->\n\t\t\t\t\t\t\t      efname);\n\t\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t} else if (errpattern == SLURMD_ALL_SAME) {\n\t\t\t\t\t/* Open a file for all tasks */\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[0]->efname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\t-2, -1);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t      job->task[0]->efname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (io_initial_client_connect(srun, job, srun_stdout_tasks,\n\t\t\t\t\t     srun_stderr_tasks) < 0) {\n\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\tgoto claim;\n\t\t}\n\t}\n\nclaim:\n\tif (_reclaim_privileges(&sprivs) < 0) {\n\t\terror(\"sete{u/g}id(%lu/%lu): %m\",\n\t\t      (u_long) sprivs.saved_uid, (u_long) sprivs.saved_gid);\n\t}\n\n\tif (!rc && !job->batch) {\n\t\tif (io_thread_start(job) < 0)\n\t\t\trc = ESLURMD_IO_ERROR;\n\t}\n\n\tdebug2(\"Leaving  _setup_normal_io\");\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Leaving  _setup_normal_io\""
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_thread_start",
          "args": [
            "job"
          ],
          "line": 643
        },
        "resolved": true,
        "details": {
          "function_name": "io_thread_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1195-1218",
          "snippet": "int\nio_thread_start(stepd_step_rec_t *job)\n{\n\tpthread_attr_t attr;\n\tint rc = 0, retries = 0;\n\n\tslurm_attr_init(&attr);\n\n\twhile (pthread_create(&job->ioid, &attr, &_io_thr, (void *)job)) {\n\t\terror(\"io_thread_start: pthread_create error %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"io_thread_start: Can't create pthread\");\n\t\t\trc = -1;\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\n\tslurm_attr_destroy(&attr);\n\n\t/*fatal_add_cleanup(&_fatal_cleanup, (void *) job);*/\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void *_io_thr(void *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic void *_io_thr(void *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nint\nio_thread_start(stepd_step_rec_t *job)\n{\n\tpthread_attr_t attr;\n\tint rc = 0, retries = 0;\n\n\tslurm_attr_init(&attr);\n\n\twhile (pthread_create(&job->ioid, &attr, &_io_thr, (void *)job)) {\n\t\terror(\"io_thread_start: pthread_create error %m\");\n\t\tif (++retries > MAX_RETRIES) {\n\t\t\terror(\"io_thread_start: Can't create pthread\");\n\t\t\trc = -1;\n\t\t\tbreak;\n\t\t}\n\t\tusleep(10);\t/* sleep and again */\n\t}\n\n\tslurm_attr_destroy(&attr);\n\n\t/*fatal_add_cleanup(&_fatal_cleanup, (void *) job);*/\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"sete{u/g}id(%lu/%lu): %m\"",
            "(u_long) sprivs.saved_uid",
            "(u_long) sprivs.saved_gid"
          ],
          "line": 638
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_reclaim_privileges",
          "args": [
            "&sprivs"
          ],
          "line": 637
        },
        "resolved": true,
        "details": {
          "function_name": "_reclaim_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2480-2502",
          "snippet": "static int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_reclaim_privileges(struct priv_state *ps)\n{\n\tint rc = SLURM_SUCCESS;\n\n\t/*\n\t * No need to reclaim privileges if our uid == job->uid\n\t */\n\tif (geteuid() == ps->saved_uid)\n\t\tgoto done;\n\telse if (seteuid(ps->saved_uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\trc = -1;\n\t} else if (setegid(ps->saved_gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\trc = -1;\n\t} else\n\t\tsetgroups(ps->ngids, ps->gid_list);\ndone:\n\txfree(ps->gid_list);\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_initial_client_connect",
          "args": [
            "srun",
            "job",
            "srun_stdout_tasks",
            "srun_stderr_tasks"
          ],
          "line": 629
        },
        "resolved": true,
        "details": {
          "function_name": "io_initial_client_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1572-1629",
          "snippet": "int\nio_initial_client_connect(srun_info_t *srun, stepd_step_rec_t *job,\n\t\t\t  int stdout_tasks, int stderr_tasks)\n{\n\tint sock = -1;\n\tstruct client_io_info *client;\n\teio_obj_t *obj;\n\n\tdebug4 (\"adding IO connection (logical node rank %d)\", job->nodeid);\n\n\tif (srun->ioaddr.sin_addr.s_addr) {\n\t\tchar         ip[256];\n\t\tuint16_t     port;\n\t\tslurm_get_ip_str(&srun->ioaddr, &port, ip, sizeof(ip));\n\t\tif (ntohs(port) == 0) {\n\t\t\tdebug3(\"No IO connection requested\");\n\t\t\treturn SLURM_SUCCESS;\n\t\t}\n\t\tdebug4(\"connecting IO back to %s:%d\", ip, ntohs(port));\n\t}\n\n\tif ((sock = (int) slurm_open_stream(&srun->ioaddr, true)) < 0) {\n\t\terror(\"connect io: %m\");\n\t\t/* XXX retry or silently fail?\n\t\t *     fail for now.\n\t\t */\n\t\treturn SLURM_ERROR;\n\t}\n\n\tfd_set_blocking(sock);  /* just in case... */\n\n\t_send_io_init_msg(sock, srun->key, job);\n\n\tdebug5(\"  back from _send_io_init_msg\");\n\tfd_set_nonblocking(sock);\n\tfd_set_close_on_exec(sock);\n\n\t/* Now set up the eio object */\n\tclient = xmalloc(sizeof(struct client_io_info));\n#ifndef NDEBUG\n\tclient->magic = CLIENT_IO_MAGIC;\n#endif\n\tclient->job = job;\n\tclient->msg_queue = list_create(NULL); /* FIXME - destructor */\n\n\tclient->ltaskid_stdout = stdout_tasks;\n\tclient->ltaskid_stderr = stderr_tasks;\n\tclient->labelio = false;\n\tclient->label_width = 0;\n\tclient->is_local_file = false;\n\n\tobj = eio_obj_create(sock, &client_ops, (void *)client);\n\tlist_append(job->clients, (void *)obj);\n\teio_new_initial_obj(job->eio, (void *)obj);\n\tdebug5(\"Now handling %d IO Client object(s)\", list_count(job->clients));\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define CLIENT_IO_MAGIC  0x10102"
          ],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "struct io_operations client_ops = {\n\t.readable = &_client_readable,\n\t.writable = &_client_writable,\n\t.handle_read = &_client_read,\n\t.handle_write = &_client_write,\n};",
            "static bool _local_file_writable(eio_obj_t *);",
            "static bool _task_writable(eio_obj_t *);",
            "static bool _task_readable(eio_obj_t *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\n#define CLIENT_IO_MAGIC  0x10102\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstruct io_operations client_ops = {\n\t.readable = &_client_readable,\n\t.writable = &_client_writable,\n\t.handle_read = &_client_read,\n\t.handle_write = &_client_write,\n};\nstatic bool _local_file_writable(eio_obj_t *);\nstatic bool _task_writable(eio_obj_t *);\nstatic bool _task_readable(eio_obj_t *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nint\nio_initial_client_connect(srun_info_t *srun, stepd_step_rec_t *job,\n\t\t\t  int stdout_tasks, int stderr_tasks)\n{\n\tint sock = -1;\n\tstruct client_io_info *client;\n\teio_obj_t *obj;\n\n\tdebug4 (\"adding IO connection (logical node rank %d)\", job->nodeid);\n\n\tif (srun->ioaddr.sin_addr.s_addr) {\n\t\tchar         ip[256];\n\t\tuint16_t     port;\n\t\tslurm_get_ip_str(&srun->ioaddr, &port, ip, sizeof(ip));\n\t\tif (ntohs(port) == 0) {\n\t\t\tdebug3(\"No IO connection requested\");\n\t\t\treturn SLURM_SUCCESS;\n\t\t}\n\t\tdebug4(\"connecting IO back to %s:%d\", ip, ntohs(port));\n\t}\n\n\tif ((sock = (int) slurm_open_stream(&srun->ioaddr, true)) < 0) {\n\t\terror(\"connect io: %m\");\n\t\t/* XXX retry or silently fail?\n\t\t *     fail for now.\n\t\t */\n\t\treturn SLURM_ERROR;\n\t}\n\n\tfd_set_blocking(sock);  /* just in case... */\n\n\t_send_io_init_msg(sock, srun->key, job);\n\n\tdebug5(\"  back from _send_io_init_msg\");\n\tfd_set_nonblocking(sock);\n\tfd_set_close_on_exec(sock);\n\n\t/* Now set up the eio object */\n\tclient = xmalloc(sizeof(struct client_io_info));\n#ifndef NDEBUG\n\tclient->magic = CLIENT_IO_MAGIC;\n#endif\n\tclient->job = job;\n\tclient->msg_queue = list_create(NULL); /* FIXME - destructor */\n\n\tclient->ltaskid_stdout = stdout_tasks;\n\tclient->ltaskid_stderr = stderr_tasks;\n\tclient->labelio = false;\n\tclient->label_width = 0;\n\tclient->is_local_file = false;\n\n\tobj = eio_obj_create(sock, &client_ops, (void *)client);\n\tlist_append(job->clients, (void *)obj);\n\teio_new_initial_obj(job->eio, (void *)obj);\n\tdebug5(\"Now handling %d IO Client object(s)\", list_count(job->clients));\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Could not open error file %s: %m\"",
            "job->task[0]->efname"
          ],
          "line": 619
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_create_local_client",
          "args": [
            "job->task[0]->efname",
            "file_flags",
            "job",
            "job->labelio",
            "-2",
            "-1"
          ],
          "line": 614
        },
        "resolved": true,
        "details": {
          "function_name": "io_create_local_client",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1519-1560",
          "snippet": "int\nio_create_local_client(const char *filename, int file_flags,\n\t\t       stepd_step_rec_t *job, bool labelio,\n\t\t       int stdout_tasks, int stderr_tasks)\n{\n\tint fd = -1;\n\tstruct client_io_info *client;\n\teio_obj_t *obj;\n\tint tmp;\n\n\tfd = open(filename, file_flags, 0666);\n\tif (fd == -1) {\n\t\treturn ESLURMD_IO_ERROR;\n\t}\n\tfd_set_close_on_exec(fd);\n\n\t/* Now set up the eio object */\n\tclient = xmalloc(sizeof(struct client_io_info));\n#ifndef NDEBUG\n\tclient->magic = CLIENT_IO_MAGIC;\n#endif\n\tclient->job = job;\n\tclient->msg_queue = list_create(NULL); /* FIXME - destructor */\n\n\tclient->ltaskid_stdout = stdout_tasks;\n\tclient->ltaskid_stderr = stderr_tasks;\n\tclient->labelio = labelio;\n\tclient->is_local_file = true;\n\n\tclient->label_width = 1;\n\ttmp = job->node_tasks-1;\n\twhile ((tmp /= 10) > 0)\n\t\tclient->label_width++;\n\n\n\tobj = eio_obj_create(fd, &local_file_ops, (void *)client);\n\tlist_append(job->clients, (void *)obj);\n\teio_new_initial_obj(job->eio, (void *)obj);\n\tdebug5(\"Now handling %d IO Client object(s)\", list_count(job->clients));\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define CLIENT_IO_MAGIC  0x10102"
          ],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static bool _local_file_writable(eio_obj_t *);",
            "struct io_operations local_file_ops = {\n\t.writable = &_local_file_writable,\n\t.handle_write = &_local_file_write,\n};",
            "static bool _task_writable(eio_obj_t *);",
            "static bool _task_readable(eio_obj_t *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);",
            "int file_flags = io_get_file_flags(job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\n#define CLIENT_IO_MAGIC  0x10102\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic bool _local_file_writable(eio_obj_t *);\nstruct io_operations local_file_ops = {\n\t.writable = &_local_file_writable,\n\t.handle_write = &_local_file_write,\n};\nstatic bool _task_writable(eio_obj_t *);\nstatic bool _task_readable(eio_obj_t *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\nint file_flags = io_get_file_flags(job);\n\nint\nio_create_local_client(const char *filename, int file_flags,\n\t\t       stepd_step_rec_t *job, bool labelio,\n\t\t       int stdout_tasks, int stderr_tasks)\n{\n\tint fd = -1;\n\tstruct client_io_info *client;\n\teio_obj_t *obj;\n\tint tmp;\n\n\tfd = open(filename, file_flags, 0666);\n\tif (fd == -1) {\n\t\treturn ESLURMD_IO_ERROR;\n\t}\n\tfd_set_close_on_exec(fd);\n\n\t/* Now set up the eio object */\n\tclient = xmalloc(sizeof(struct client_io_info));\n#ifndef NDEBUG\n\tclient->magic = CLIENT_IO_MAGIC;\n#endif\n\tclient->job = job;\n\tclient->msg_queue = list_create(NULL); /* FIXME - destructor */\n\n\tclient->ltaskid_stdout = stdout_tasks;\n\tclient->ltaskid_stderr = stderr_tasks;\n\tclient->labelio = labelio;\n\tclient->is_local_file = true;\n\n\tclient->label_width = 1;\n\ttmp = job->node_tasks-1;\n\twhile ((tmp /= 10) > 0)\n\t\tclient->label_width++;\n\n\n\tobj = eio_obj_create(fd, &local_file_ops, (void *)client);\n\tlist_append(job->clients, (void *)obj);\n\teio_new_initial_obj(job->eio, (void *)obj);\n\tdebug5(\"Now handling %d IO Client object(s)\", list_count(job->clients));\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_get_file_flags",
          "args": [
            "job"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "io_get_file_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "2094-2114",
          "snippet": "int\nio_get_file_flags(stepd_step_rec_t *job)\n{\n\tslurm_ctl_conf_t *conf;\n\tint file_flags;\n\n\t/* set files for opening stdout/err */\n\tif (job->open_mode == OPEN_MODE_APPEND)\n\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND;\n\telse if (job->open_mode == OPEN_MODE_TRUNCATE)\n\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND|O_TRUNC;\n\telse {\n\t\tconf = slurm_conf_lock();\n\t\tif (conf->job_file_append)\n\t\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND;\n\t\telse\n\t\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND|O_TRUNC;\n\t\tslurm_conf_unlock();\n\t}\n\treturn file_flags;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);",
            "int file_flags = io_get_file_flags(job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\nint file_flags = io_get_file_flags(job);\n\nint\nio_get_file_flags(stepd_step_rec_t *job)\n{\n\tslurm_ctl_conf_t *conf;\n\tint file_flags;\n\n\t/* set files for opening stdout/err */\n\tif (job->open_mode == OPEN_MODE_APPEND)\n\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND;\n\telse if (job->open_mode == OPEN_MODE_TRUNCATE)\n\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND|O_TRUNC;\n\telse {\n\t\tconf = slurm_conf_lock();\n\t\tif (conf->job_file_append)\n\t\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND;\n\t\telse\n\t\t\tfile_flags = O_CREAT|O_WRONLY|O_APPEND|O_TRUNC;\n\t\tslurm_conf_unlock();\n\t}\n\treturn file_flags;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_find_filename_pattern",
          "args": [
            "job",
            "&outpattern",
            "&errpattern",
            "&same"
          ],
          "line": 553
        },
        "resolved": true,
        "details": {
          "function_name": "io_find_filename_pattern",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1981-2091",
          "snippet": "void\nio_find_filename_pattern( stepd_step_rec_t *job,\n\t\t\t  slurmd_filename_pattern_t *outpattern,\n\t\t\t  slurmd_filename_pattern_t *errpattern,\n\t\t\t  bool *same_out_err_files )\n{\n\tint ii, jj;\n\tint of_num_null = 0, ef_num_null = 0;\n\tint of_num_devnull = 0, ef_num_devnull = 0;\n\tint of_lastnull = -1, ef_lastnull = -1;\n\tbool of_all_same = true, ef_all_same = true;\n\tbool of_all_unique = true, ef_all_unique = true;\n\n\t*outpattern = SLURMD_UNKNOWN;\n\t*errpattern = SLURMD_UNKNOWN;\n\t*same_out_err_files = false;\n\n\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\tif (job->task[ii]->ofname == NULL) {\n\t\t\tof_num_null++;\n\t\t\tof_lastnull = ii;\n\t\t} else if (xstrcmp(job->task[ii]->ofname, \"/dev/null\")==0) {\n\t\t\tof_num_devnull++;\n\t\t}\n\n\t\tif (job->task[ii]->efname == NULL) {\n\t\t\tef_num_null++;\n\t\t\tef_lastnull = ii;\n\t\t} else if (xstrcmp(job->task[ii]->efname, \"/dev/null\")==0) {\n\t\t\tef_num_devnull++;\n\t\t}\n\t}\n\tif (of_num_null == job->node_tasks)\n\t\t*outpattern = SLURMD_ALL_NULL;\n\n\tif (ef_num_null == job->node_tasks)\n\t\t*errpattern = SLURMD_ALL_NULL;\n\n\tif (of_num_null == 1 && of_num_devnull == job->node_tasks-1)\n\t\t*outpattern = SLURMD_ONE_NULL;\n\n\tif (ef_num_null == 1 && ef_num_devnull == job->node_tasks-1)\n\t\t*errpattern = SLURMD_ONE_NULL;\n\n\tif (*outpattern == SLURMD_ALL_NULL && *errpattern == SLURMD_ALL_NULL)\n\t\t*same_out_err_files = true;\n\n\tif (*outpattern == SLURMD_ONE_NULL && *errpattern == SLURMD_ONE_NULL &&\n\t    of_lastnull == ef_lastnull)\n\t\t*same_out_err_files = true;\n\n\tif (*outpattern != SLURMD_UNKNOWN && *errpattern != SLURMD_UNKNOWN)\n\t\treturn;\n\n\tfor (ii = 1; ii < job->node_tasks; ii++) {\n\t\tif (!job->task[ii]->ofname || !job->task[0]->ofname ||\n\t\t    xstrcmp(job->task[ii]->ofname, job->task[0]->ofname) != 0)\n\t\t\tof_all_same = false;\n\n\t\tif (!job->task[ii]->efname || !job->task[0]->efname ||\n\t\t    xstrcmp(job->task[ii]->efname, job->task[0]->efname) != 0)\n\t\t\tef_all_same = false;\n\t}\n\n\tif (of_all_same && *outpattern == SLURMD_UNKNOWN)\n\t\t*outpattern = SLURMD_ALL_SAME;\n\n\tif (ef_all_same && *errpattern == SLURMD_UNKNOWN)\n\t\t*errpattern = SLURMD_ALL_SAME;\n\n\tif (job->task[0]->ofname && job->task[0]->efname &&\n\t    xstrcmp(job->task[0]->ofname, job->task[0]->efname)==0)\n\t\t*same_out_err_files = true;\n\n\tif (*outpattern != SLURMD_UNKNOWN && *errpattern != SLURMD_UNKNOWN)\n\t\treturn;\n\n\tfor (ii = 0; ii < job->node_tasks-1; ii++) {\n\t\tfor (jj = ii+1; jj < job->node_tasks; jj++) {\n\n\t\t\tif (!job->task[ii]->ofname || !job->task[jj]->ofname ||\n\t\t\t    xstrcmp(job->task[ii]->ofname,\n\t\t\t\t    job->task[jj]->ofname) == 0)\n\t\t\t\tof_all_unique = false;\n\n\t\t\tif (!job->task[ii]->efname || !job->task[jj]->efname ||\n\t\t\t    xstrcmp(job->task[ii]->efname,\n\t\t\t\t    job->task[jj]->efname) == 0)\n\t\t\t\tef_all_unique = false;\n\t\t}\n\t}\n\n\tif (of_all_unique)\n\t\t*outpattern = SLURMD_ALL_UNIQUE;\n\n\tif (ef_all_unique)\n\t\t*errpattern = SLURMD_ALL_UNIQUE;\n\n\tif (of_all_unique && ef_all_unique) {\n\t\t*same_out_err_files = true;\n\t\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\t\tif (job->task[ii]->ofname &&\n\t\t\t    job->task[ii]->efname &&\n\t\t\t    xstrcmp(job->task[ii]->ofname,\n\t\t\t\t    job->task[ii]->efname) != 0) {\n\t\t\t\t*same_out_err_files = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nvoid\nio_find_filename_pattern( stepd_step_rec_t *job,\n\t\t\t  slurmd_filename_pattern_t *outpattern,\n\t\t\t  slurmd_filename_pattern_t *errpattern,\n\t\t\t  bool *same_out_err_files )\n{\n\tint ii, jj;\n\tint of_num_null = 0, ef_num_null = 0;\n\tint of_num_devnull = 0, ef_num_devnull = 0;\n\tint of_lastnull = -1, ef_lastnull = -1;\n\tbool of_all_same = true, ef_all_same = true;\n\tbool of_all_unique = true, ef_all_unique = true;\n\n\t*outpattern = SLURMD_UNKNOWN;\n\t*errpattern = SLURMD_UNKNOWN;\n\t*same_out_err_files = false;\n\n\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\tif (job->task[ii]->ofname == NULL) {\n\t\t\tof_num_null++;\n\t\t\tof_lastnull = ii;\n\t\t} else if (xstrcmp(job->task[ii]->ofname, \"/dev/null\")==0) {\n\t\t\tof_num_devnull++;\n\t\t}\n\n\t\tif (job->task[ii]->efname == NULL) {\n\t\t\tef_num_null++;\n\t\t\tef_lastnull = ii;\n\t\t} else if (xstrcmp(job->task[ii]->efname, \"/dev/null\")==0) {\n\t\t\tef_num_devnull++;\n\t\t}\n\t}\n\tif (of_num_null == job->node_tasks)\n\t\t*outpattern = SLURMD_ALL_NULL;\n\n\tif (ef_num_null == job->node_tasks)\n\t\t*errpattern = SLURMD_ALL_NULL;\n\n\tif (of_num_null == 1 && of_num_devnull == job->node_tasks-1)\n\t\t*outpattern = SLURMD_ONE_NULL;\n\n\tif (ef_num_null == 1 && ef_num_devnull == job->node_tasks-1)\n\t\t*errpattern = SLURMD_ONE_NULL;\n\n\tif (*outpattern == SLURMD_ALL_NULL && *errpattern == SLURMD_ALL_NULL)\n\t\t*same_out_err_files = true;\n\n\tif (*outpattern == SLURMD_ONE_NULL && *errpattern == SLURMD_ONE_NULL &&\n\t    of_lastnull == ef_lastnull)\n\t\t*same_out_err_files = true;\n\n\tif (*outpattern != SLURMD_UNKNOWN && *errpattern != SLURMD_UNKNOWN)\n\t\treturn;\n\n\tfor (ii = 1; ii < job->node_tasks; ii++) {\n\t\tif (!job->task[ii]->ofname || !job->task[0]->ofname ||\n\t\t    xstrcmp(job->task[ii]->ofname, job->task[0]->ofname) != 0)\n\t\t\tof_all_same = false;\n\n\t\tif (!job->task[ii]->efname || !job->task[0]->efname ||\n\t\t    xstrcmp(job->task[ii]->efname, job->task[0]->efname) != 0)\n\t\t\tef_all_same = false;\n\t}\n\n\tif (of_all_same && *outpattern == SLURMD_UNKNOWN)\n\t\t*outpattern = SLURMD_ALL_SAME;\n\n\tif (ef_all_same && *errpattern == SLURMD_UNKNOWN)\n\t\t*errpattern = SLURMD_ALL_SAME;\n\n\tif (job->task[0]->ofname && job->task[0]->efname &&\n\t    xstrcmp(job->task[0]->ofname, job->task[0]->efname)==0)\n\t\t*same_out_err_files = true;\n\n\tif (*outpattern != SLURMD_UNKNOWN && *errpattern != SLURMD_UNKNOWN)\n\t\treturn;\n\n\tfor (ii = 0; ii < job->node_tasks-1; ii++) {\n\t\tfor (jj = ii+1; jj < job->node_tasks; jj++) {\n\n\t\t\tif (!job->task[ii]->ofname || !job->task[jj]->ofname ||\n\t\t\t    xstrcmp(job->task[ii]->ofname,\n\t\t\t\t    job->task[jj]->ofname) == 0)\n\t\t\t\tof_all_unique = false;\n\n\t\t\tif (!job->task[ii]->efname || !job->task[jj]->efname ||\n\t\t\t    xstrcmp(job->task[ii]->efname,\n\t\t\t\t    job->task[jj]->efname) == 0)\n\t\t\t\tef_all_unique = false;\n\t\t}\n\t}\n\n\tif (of_all_unique)\n\t\t*outpattern = SLURMD_ALL_UNIQUE;\n\n\tif (ef_all_unique)\n\t\t*errpattern = SLURMD_ALL_UNIQUE;\n\n\tif (of_all_unique && ef_all_unique) {\n\t\t*same_out_err_files = true;\n\t\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\t\tif (job->task[ii]->ofname &&\n\t\t\t    job->task[ii]->efname &&\n\t\t\t    xstrcmp(job->task[ii]->ofname,\n\t\t\t\t    job->task[ii]->efname) != 0) {\n\t\t\t\t*same_out_err_files = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "srun != NULL"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_peek",
          "args": [
            "job->sruns"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_init_tasks_stdio",
          "args": [
            "job"
          ],
          "line": 522
        },
        "resolved": true,
        "details": {
          "function_name": "io_init_tasks_stdio",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1181-1193",
          "snippet": "int\nio_init_tasks_stdio(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS, tmprc;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\ttmprc = _init_task_stdio_fds(job->task[i], job);\n\t\tif (tmprc != SLURM_SUCCESS)\n\t\t\trc = tmprc;\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nint\nio_init_tasks_stdio(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS, tmprc;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\ttmprc = _init_task_stdio_fds(job->task[i], job);\n\t\tif (tmprc != SLURM_SUCCESS)\n\t\t\trc = tmprc;\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_drop_privileges",
          "args": [
            "job",
            "true",
            "&sprivs",
            "true"
          ],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "_drop_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2422-2478",
          "snippet": "static int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic int  _become_user(stepd_step_rec_t *job, struct priv_state *ps);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t\t     struct priv_state *state, bool get_list);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_drop_privileges(stepd_step_rec_t *job, bool do_setuid,\n\t\t struct priv_state *ps, bool get_list)\n{\n\tps->saved_uid = getuid();\n\tps->saved_gid = getgid();\n\n\tif (!getcwd (ps->saved_cwd, sizeof (ps->saved_cwd))) {\n\t\terror (\"Unable to get current working directory: %m\");\n\t\tstrncpy (ps->saved_cwd, \"/tmp\", sizeof (ps->saved_cwd));\n\t}\n\n#ifdef HAVE_NATIVE_CRAY\n\t/* LDAP on Native Cray is not sufficiently scalable to support the\n\t * getgroups() call */\n\tps->ngids = 1;\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(sizeof(gid_t));\n\t\tps->gid_list[0] = job->gid;\n\t}\n#else\n\tps->ngids = getgroups(0, NULL);\n\tif (get_list) {\n\t\tps->gid_list = (gid_t *) xmalloc(ps->ngids * sizeof(gid_t));\n\n\t\tif (getgroups(ps->ngids, ps->gid_list) == -1) {\n\t\t\terror(\"_drop_privileges: couldn't get %d groups: %m\",\n\t\t\t      ps->ngids);\n\t\t\txfree(ps->gid_list);\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\n\n\t/*\n\t * No need to drop privileges if we're not running as root\n\t */\n\tif (getuid() != (uid_t) 0)\n\t\treturn SLURM_SUCCESS;\n\n\tif (setegid(job->gid) < 0) {\n\t\terror(\"setegid: %m\");\n\t\treturn -1;\n\t}\n\n\tif (_initgroups(job) < 0) {\n\t\terror(\"_initgroups: %m\");\n\t\treturn -1;\n\t}\n\n\tif (do_setuid && seteuid(job->uid) < 0) {\n\t\terror(\"seteuid: %m\");\n\t\treturn -1;\n\t}\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug2",
          "args": [
            "\"Entering _setup_normal_io\""
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_setup_normal_io(stepd_step_rec_t *job)\n{\n\tint rc = 0, ii = 0;\n\tstruct priv_state sprivs;\n\n\tdebug2(\"Entering _setup_normal_io\");\n\n\t/*\n\t * Temporarily drop permissions, initialize task stdio file\n\t * descriptors (which may be connected to files), then\n\t * reclaim privileges.\n\t */\n\tif (_drop_privileges(job, true, &sprivs, true) < 0)\n\t\treturn ESLURMD_SET_UID_OR_GID_ERROR;\n\n\tif (io_init_tasks_stdio(job) != SLURM_SUCCESS) {\n\t\trc = ESLURMD_IO_ERROR;\n\t\tgoto claim;\n\t}\n\n\t/*\n\t * MUST create the initial client object before starting\n\t * the IO thread, or we risk losing stdout/err traffic.\n\t */\n\tif (!job->batch) {\n\t\tsrun_info_t *srun = list_peek(job->sruns);\n\n\t\t/* local id of task that sends to srun, -1 for all tasks,\n\t\t   any other value for no tasks */\n\t\tint srun_stdout_tasks = -1;\n\t\tint srun_stderr_tasks = -1;\n\n\t\txassert(srun != NULL);\n\n\t\t/* If I/O is labelled with task num, and if a separate file is\n\t\t   written per node or per task, the I/O needs to be sent\n\t\t   back to the stepd, get a label appended, and written from\n\t\t   the stepd rather than sent back to srun or written directly\n\t\t   from the node.  When a task has ofname or efname == NULL, it\n\t\t   means data gets sent back to the client. */\n\n\t\tif (job->labelio) {\n\t\t\tslurmd_filename_pattern_t outpattern, errpattern;\n\t\t\tbool same = false;\n\t\t\tint file_flags;\n\n\t\t\tio_find_filename_pattern(job, &outpattern, &errpattern,\n\t\t\t\t\t\t &same);\n\t\t\tfile_flags = io_get_file_flags(job);\n\n\t\t\t/* Make eio objects to write from the slurmstepd */\n\t\t\tif (outpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t/* Open a separate file per task */\n\t\t\t\tfor (ii = 0; ii < job->node_tasks; ii++) {\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[ii]->ofname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\tjob->task[ii]->id,\n\t\t\t\t\t\tsame ? job->task[ii]->id : -2);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t\t      job->task[ii]->ofname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t} else if (outpattern == SLURMD_ALL_SAME) {\n\t\t\t\t/* Open a file for all tasks */\n\t\t\t\trc = io_create_local_client(\n\t\t\t\t\tjob->task[0]->ofname,\n\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t-1, same ? -1 : -2);\n\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\terror(\"Could not open output file %s: %m\",\n\t\t\t\t\t      job->task[0]->ofname);\n\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\tgoto claim;\n\t\t\t\t}\n\t\t\t\tsrun_stdout_tasks = -2;\n\t\t\t\tif (same)\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t}\n\n\t\t\tif (!same) {\n\t\t\t\tif (errpattern == SLURMD_ALL_UNIQUE) {\n\t\t\t\t\t/* Open a separate file per task */\n\t\t\t\t\tfor (ii = 0;\n\t\t\t\t\t     ii < job->node_tasks; ii++) {\n\t\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\t\tjob->task[ii]->efname,\n\t\t\t\t\t\t\tfile_flags, job,\n\t\t\t\t\t\t\tjob->labelio,\n\t\t\t\t\t\t\t-2, job->task[ii]->id);\n\t\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t\t      job->task[ii]->\n\t\t\t\t\t\t\t      efname);\n\t\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t} else if (errpattern == SLURMD_ALL_SAME) {\n\t\t\t\t\t/* Open a file for all tasks */\n\t\t\t\t\trc = io_create_local_client(\n\t\t\t\t\t\tjob->task[0]->efname,\n\t\t\t\t\t\tfile_flags, job, job->labelio,\n\t\t\t\t\t\t-2, -1);\n\t\t\t\t\tif (rc != SLURM_SUCCESS) {\n\t\t\t\t\t\terror(\"Could not open error file %s: %m\",\n\t\t\t\t\t\t      job->task[0]->efname);\n\t\t\t\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\t\t\t\tgoto claim;\n\t\t\t\t\t}\n\t\t\t\t\tsrun_stderr_tasks = -2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (io_initial_client_connect(srun, job, srun_stdout_tasks,\n\t\t\t\t\t     srun_stderr_tasks) < 0) {\n\t\t\trc = ESLURMD_IO_ERROR;\n\t\t\tgoto claim;\n\t\t}\n\t}\n\nclaim:\n\tif (_reclaim_privileges(&sprivs) < 0) {\n\t\terror(\"sete{u/g}id(%lu/%lu): %m\",\n\t\t      (u_long) sprivs.saved_uid, (u_long) sprivs.saved_gid);\n\t}\n\n\tif (!rc && !job->batch) {\n\t\tif (io_thread_start(job) < 0)\n\t\t\trc = ESLURMD_IO_ERROR;\n\t}\n\n\tdebug2(\"Leaving  _setup_normal_io\");\n\treturn rc;\n}"
  },
  {
    "function_name": "_set_job_log_prefix",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "490-504",
    "snippet": "static void\n_set_job_log_prefix(stepd_step_rec_t *job)\n{\n\tchar buf[256];\n\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsnprintf(buf, sizeof(buf), \"[%u]\", job->jobid);\n\telse\n\t\tsnprintf(buf, sizeof(buf), \"[%u.%u]\", job->jobid, job->stepid);\n\n\tlog_set_fpfx(buf);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "log_set_fpfx",
          "args": [
            "buf"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "\"[%u.%u]\"",
            "job->jobid",
            "job->stepid"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "\"[%u]\"",
            "job->jobid"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_set_job_log_prefix(stepd_step_rec_t *job)\n{\n\tchar buf[256];\n\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsnprintf(buf, sizeof(buf), \"[%u]\", job->jobid);\n\telse\n\t\tsnprintf(buf, sizeof(buf), \"[%u.%u]\", job->jobid, job->stepid);\n\n\tlog_set_fpfx(buf);\n}"
  },
  {
    "function_name": "mgr_launch_batch_job_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "437-488",
    "snippet": "stepd_step_rec_t *\nmgr_launch_batch_job_setup(batch_job_launch_msg_t *msg, slurm_addr_t *cli)\n{\n\tstepd_step_rec_t *job = NULL;\n\n\tif (!(job = batch_stepd_step_rec_create(msg))) {\n\t\terror(\"batch_stepd_step_rec_create() failed: %m\");\n\t\treturn NULL;\n\t}\n\n\t_set_job_log_prefix(job);\n\n\t_setargs(job);\n\n\tif ((job->batchdir = _make_batch_dir(job)) == NULL) {\n\t\tgoto cleanup;\n\t}\n\n\txfree(job->argv[0]);\n\n\tif ((job->argv[0] = _make_batch_script(msg, job->batchdir)) == NULL) {\n\t\tgoto cleanup;\n\t}\n\n\t/* this is the new way of setting environment variables */\n\tenv_array_for_batch_job(&job->env, msg, conf->node_name);\n\n\t/* this is the old way of setting environment variables (but\n\t * needed) */\n\tjob->envtp->overcommit = msg->overcommit;\n\tjob->envtp->select_jobinfo = msg->select_jobinfo;\n\n\treturn job;\n\ncleanup:\n\terror(\"batch script setup failed for job %u.%u\",\n\t      msg->job_id, msg->step_id);\n\n\tif (job->aborted)\n\t\tverbose(\"job %u abort complete\", job->jobid);\n\n\t/* Do not purge directory until slurmctld is notified of batch job\n\t * completion to avoid race condition with slurmd registering missing\n\t * batch job. */\n\tif (job->batchdir && (rmdir(job->batchdir) < 0))\n\t\terror(\"rmdir(%s): %m\",  job->batchdir);\n\txfree(job->batchdir);\n\n\terrno = ESLURMD_CREATE_BATCH_DIR_ERROR;\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "job->batchdir"
          ],
          "line": 483
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"rmdir(%s): %m\"",
            "job->batchdir"
          ],
          "line": 482
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rmdir",
          "args": [
            "job->batchdir"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"job %u abort complete\"",
            "job->jobid"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"batch script setup failed for job %u.%u\"",
            "msg->job_id",
            "msg->step_id"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_array_for_batch_job",
          "args": [
            "&job->env",
            "msg",
            "conf->node_name"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_make_batch_script",
          "args": [
            "msg",
            "job->batchdir"
          ],
          "line": 457
        },
        "resolved": true,
        "details": {
          "function_name": "_make_batch_script",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2207-2256",
          "snippet": "static char *\n_make_batch_script(batch_job_launch_msg_t *msg, char *path)\n{\n\tFILE *fp = NULL;\n\tchar  script[MAXPATHLEN];\n\n\tif (msg->script == NULL) {\n\t\terror(\"_make_batch_script: called with NULL script\");\n\t\treturn NULL;\n\t}\n\n\tsnprintf(script, sizeof(script), \"%s/%s\", path, \"slurm_script\");\n\nagain:\n\tif ((fp = safeopen(script, \"w\", SAFEOPEN_CREATE_ONLY)) == NULL) {\n\t\tif ((errno != EEXIST) || (unlink(script) < 0))  {\n\t\t\terror(\"couldn't open `%s': %m\", script);\n\t\t\tgoto error;\n\t\t}\n\t\tgoto again;\n\t}\n\n\tif (fputs(msg->script, fp) < 0) {\n\t\t(void) fclose(fp);\n\t\terror(\"fputs: %m\");\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (fclose(fp) < 0) {\n\t\terror(\"fclose: %m\");\n\t}\n\n\tif (chown(script, (uid_t) msg->uid, (gid_t) -1) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(script, 0500) < 0) {\n\t\terror(\"chmod: %m\");\n\t}\n\n\treturn xstrdup(script);\n\nerror:\n\t(void) unlink(script);\n\treturn NULL;\n\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\n\nstatic char *\n_make_batch_script(batch_job_launch_msg_t *msg, char *path)\n{\n\tFILE *fp = NULL;\n\tchar  script[MAXPATHLEN];\n\n\tif (msg->script == NULL) {\n\t\terror(\"_make_batch_script: called with NULL script\");\n\t\treturn NULL;\n\t}\n\n\tsnprintf(script, sizeof(script), \"%s/%s\", path, \"slurm_script\");\n\nagain:\n\tif ((fp = safeopen(script, \"w\", SAFEOPEN_CREATE_ONLY)) == NULL) {\n\t\tif ((errno != EEXIST) || (unlink(script) < 0))  {\n\t\t\terror(\"couldn't open `%s': %m\", script);\n\t\t\tgoto error;\n\t\t}\n\t\tgoto again;\n\t}\n\n\tif (fputs(msg->script, fp) < 0) {\n\t\t(void) fclose(fp);\n\t\terror(\"fputs: %m\");\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (fclose(fp) < 0) {\n\t\terror(\"fclose: %m\");\n\t}\n\n\tif (chown(script, (uid_t) msg->uid, (gid_t) -1) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(script, 0500) < 0) {\n\t\terror(\"chmod: %m\");\n\t}\n\n\treturn xstrdup(script);\n\nerror:\n\t(void) unlink(script);\n\treturn NULL;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "_make_batch_dir",
          "args": [
            "job"
          ],
          "line": 451
        },
        "resolved": true,
        "details": {
          "function_name": "_make_batch_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2171-2205",
          "snippet": "static char *\n_make_batch_dir(stepd_step_rec_t *job)\n{\n\tchar path[MAXPATHLEN];\n\n\tif (job->stepid == NO_VAL)\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u\",\n\t\t\t conf->spooldir, job->jobid);\n\telse {\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u.%05u\",\n\t\t\t conf->spooldir, job->jobid, job->stepid);\n\t}\n\n\tif ((mkdir(path, 0750) < 0) && (errno != EEXIST)) {\n\t\terror(\"mkdir(%s): %m\", path);\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (chown(path, (uid_t) -1, (gid_t) job->gid) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(path, 0750) < 0) {\n\t\terror(\"chmod(%s, 750): %m\", path);\n\t\tgoto error;\n\t}\n\n\treturn xstrdup(path);\n\nerror:\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int  _access(const char *path, int modes, uid_t uid, gid_t gid);",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic int  _access(const char *path, int modes, uid_t uid, gid_t gid);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic char * _make_batch_script(batch_job_launch_msg_t *msg, char *path);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic char *\n_make_batch_dir(stepd_step_rec_t *job)\n{\n\tchar path[MAXPATHLEN];\n\n\tif (job->stepid == NO_VAL)\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u\",\n\t\t\t conf->spooldir, job->jobid);\n\telse {\n\t\tsnprintf(path, sizeof(path), \"%s/job%05u.%05u\",\n\t\t\t conf->spooldir, job->jobid, job->stepid);\n\t}\n\n\tif ((mkdir(path, 0750) < 0) && (errno != EEXIST)) {\n\t\terror(\"mkdir(%s): %m\", path);\n\t\tif (errno == ENOSPC)\n\t\t\t_drain_node(\"SlurmdSpoolDir is full\");\n\t\tgoto error;\n\t}\n\n\tif (chown(path, (uid_t) -1, (gid_t) job->gid) < 0) {\n\t\terror(\"chown(%s): %m\", path);\n\t\tgoto error;\n\t}\n\n\tif (chmod(path, 0750) < 0) {\n\t\terror(\"chmod(%s, 750): %m\", path);\n\t\tgoto error;\n\t}\n\n\treturn xstrdup(path);\n\nerror:\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_setargs",
          "args": [
            "job"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "_setargs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2563-2575",
          "snippet": "static void\n_setargs(stepd_step_rec_t *job)\n{\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsetproctitle(\"[%u]\",    job->jobid);\n\telse\n\t\tsetproctitle(\"[%u.%u]\", job->jobid, job->stepid);\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_setargs(stepd_step_rec_t *job)\n{\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsetproctitle(\"[%u]\",    job->jobid);\n\telse\n\t\tsetproctitle(\"[%u.%u]\", job->jobid, job->stepid);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_set_job_log_prefix",
          "args": [
            "job"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_log_prefix",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "490-504",
          "snippet": "static void\n_set_job_log_prefix(stepd_step_rec_t *job)\n{\n\tchar buf[256];\n\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsnprintf(buf, sizeof(buf), \"[%u]\", job->jobid);\n\telse\n\t\tsnprintf(buf, sizeof(buf), \"[%u.%u]\", job->jobid, job->stepid);\n\n\tlog_set_fpfx(buf);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_set_job_log_prefix(stepd_step_rec_t *job)\n{\n\tchar buf[256];\n\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsnprintf(buf, sizeof(buf), \"[%u]\", job->jobid);\n\telse\n\t\tsnprintf(buf, sizeof(buf), \"[%u.%u]\", job->jobid, job->stepid);\n\n\tlog_set_fpfx(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"batch_stepd_step_rec_create() failed: %m\""
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "batch_stepd_step_rec_create",
          "args": [
            "msg"
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "batch_stepd_step_rec_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "437-569",
          "snippet": "extern stepd_step_rec_t *\nbatch_stepd_step_rec_create(batch_job_launch_msg_t *msg)\n{\n\tstepd_step_rec_t *job;\n\tsrun_info_t  *srun = NULL;\n\tchar *in_name;\n\n\txassert(msg != NULL);\n\n\tdebug3(\"entering batch_stepd_step_rec_create\");\n\n\tif (!slurm_valid_uid_gid((uid_t)msg->uid, &(msg->gid),\n\t\t\t\t &(msg->user_name), already_validated_uid, 1))\n\t\treturn NULL;\n\n\tif (acct_gather_check_acct_freq_task(msg->job_mem, msg->acctg_freq))\n\t\treturn NULL;\n\n\tjob = xmalloc(sizeof(stepd_step_rec_t));\n\n\tjob->state = SLURMSTEPD_STEP_STARTING;\n\tpthread_cond_init(&job->state_cond, NULL);\n\tpthread_mutex_init(&job->state_mutex, NULL);\n\tif (msg->cpus_per_node)\n\t\tjob->cpus    = msg->cpus_per_node[0];\n\tjob->node_tasks  = 1;\n\tjob->ntasks  = msg->ntasks;\n\tjob->jobid   = msg->job_id;\n\tjob->stepid  = msg->step_id;\n\tjob->array_job_id  = msg->array_job_id;\n\tjob->array_task_id = msg->array_task_id;\n\tjob->job_core_spec = msg->job_core_spec;\n\n\tjob->batch   = true;\n\tjob->node_name  = xstrdup(conf->node_name);\n\tjob->user_name  = xstrdup(msg->user_name);\n\tjob->uid        = (uid_t) msg->uid;\n\tjob->gid        = (gid_t) msg->gid;\n\n\tjob->profile    = msg->profile;\n\n\t/* give them all to the 1 task */\n\tjob->cpus_per_task = job->cpus;\n\n\t/* This needs to happen before acct_gather_profile_startpoll\n\t   and only really looks at the profile in the job.\n\t*/\n\tacct_gather_profile_g_node_step_start(job);\n\t/* needed for the jobacct_gather plugin to start */\n\tacct_gather_profile_startpoll(msg->acctg_freq,\n\t\t\t\t      conf->job_acct_gather_freq);\n\n\tjob->multi_prog = 0;\n\tjob->open_mode  = msg->open_mode;\n\tjob->overcommit = (bool) msg->overcommit;\n\n\tjob->cwd     = xstrdup(msg->work_dir);\n\n\tjob->ckpt_dir = xstrdup(msg->ckpt_dir);\n\tjob->restart_dir = xstrdup(msg->restart_dir);\n\n\tjob->env     = _array_copy(msg->envc, msg->environment);\n\tjob->eio     = eio_handle_create(0);\n\tjob->sruns   = list_create((ListDelF) _srun_info_destructor);\n\tjob->envtp   = xmalloc(sizeof(env_t));\n\tjob->envtp->jobid = -1;\n\tjob->envtp->stepid = -1;\n\tjob->envtp->procid = -1;\n\tjob->envtp->localid = -1;\n\tjob->envtp->nodeid = -1;\n\n\tjob->envtp->distribution = 0;\n\tjob->cpu_bind_type = msg->cpu_bind_type;\n\tjob->cpu_bind = xstrdup(msg->cpu_bind);\n\tjob->envtp->mem_bind_type = 0;\n\tjob->envtp->mem_bind = NULL;\n\tjob->envtp->ckpt_dir = NULL;\n\tjob->envtp->restart_cnt = msg->restart_cnt;\n\n\tif (msg->cpus_per_node)\n\t\tjob->cpus    = msg->cpus_per_node[0];\n\n\tformat_core_allocs(msg->cred, conf->node_name, conf->cpus,\n\t\t\t   &job->job_alloc_cores, &job->step_alloc_cores,\n\t\t\t   &job->job_mem, &job->step_mem);\n\tif (job->step_mem\n\t\t&& conf->mem_limit_enforce)\n\t\tjobacct_gather_set_mem_limit(job->jobid, NO_VAL, job->step_mem);\n\telse if (job->job_mem\n\t\t&& conf->mem_limit_enforce)\n\t\tjobacct_gather_set_mem_limit(job->jobid, NO_VAL, job->job_mem);\n\n\tget_cred_gres(msg->cred, conf->node_name,\n\t\t      &job->job_gres_list, &job->step_gres_list);\n\n\tsrun = srun_info_create(NULL, NULL, NULL, (uint16_t)NO_VAL);\n\n\tlist_append(job->sruns, (void *) srun);\n\n\tif (msg->argc) {\n\t\tjob->argc    = msg->argc;\n\t\tjob->argv    = _array_copy(job->argc, msg->argv);\n\t} else {\n\t\tjob->argc    = 1;\n\t\t/* job script has not yet been written out to disk --\n\t\t * argv will be filled in later by _make_batch_script()\n\t\t */\n\t\tjob->argv    = (char **) xmalloc(2 * sizeof(char *));\n\t}\n\n\tjob->task = xmalloc(sizeof(stepd_step_task_info_t *));\n\tif (msg->std_err == NULL)\n\t\tmsg->std_err = xstrdup(msg->std_out);\n\n\tif (msg->std_in == NULL)\n\t\tin_name = xstrdup(\"/dev/null\");\n\telse\n\t\tin_name = fname_create(job, msg->std_in, 0);\n\n\tjob->task[0] = task_info_create(0, 0,\n\t\t\t\t\tin_name,\n\t\t\t\t\t_batchfilename(job, msg->std_out),\n\t\t\t\t\t_batchfilename(job, msg->std_err));\n\tjob->task[0]->argc = job->argc;\n\tjob->task[0]->argv = job->argv;\n\n#ifdef HAVE_ALPS_CRAY\n\tselect_g_select_jobinfo_get(msg->select_jobinfo, SELECT_JOBDATA_RESV_ID,\n\t\t\t\t    &job->resv_id);\n#endif\n\n\treturn job;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nstatic void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);\n\nextern stepd_step_rec_t *\nbatch_stepd_step_rec_create(batch_job_launch_msg_t *msg)\n{\n\tstepd_step_rec_t *job;\n\tsrun_info_t  *srun = NULL;\n\tchar *in_name;\n\n\txassert(msg != NULL);\n\n\tdebug3(\"entering batch_stepd_step_rec_create\");\n\n\tif (!slurm_valid_uid_gid((uid_t)msg->uid, &(msg->gid),\n\t\t\t\t &(msg->user_name), already_validated_uid, 1))\n\t\treturn NULL;\n\n\tif (acct_gather_check_acct_freq_task(msg->job_mem, msg->acctg_freq))\n\t\treturn NULL;\n\n\tjob = xmalloc(sizeof(stepd_step_rec_t));\n\n\tjob->state = SLURMSTEPD_STEP_STARTING;\n\tpthread_cond_init(&job->state_cond, NULL);\n\tpthread_mutex_init(&job->state_mutex, NULL);\n\tif (msg->cpus_per_node)\n\t\tjob->cpus    = msg->cpus_per_node[0];\n\tjob->node_tasks  = 1;\n\tjob->ntasks  = msg->ntasks;\n\tjob->jobid   = msg->job_id;\n\tjob->stepid  = msg->step_id;\n\tjob->array_job_id  = msg->array_job_id;\n\tjob->array_task_id = msg->array_task_id;\n\tjob->job_core_spec = msg->job_core_spec;\n\n\tjob->batch   = true;\n\tjob->node_name  = xstrdup(conf->node_name);\n\tjob->user_name  = xstrdup(msg->user_name);\n\tjob->uid        = (uid_t) msg->uid;\n\tjob->gid        = (gid_t) msg->gid;\n\n\tjob->profile    = msg->profile;\n\n\t/* give them all to the 1 task */\n\tjob->cpus_per_task = job->cpus;\n\n\t/* This needs to happen before acct_gather_profile_startpoll\n\t   and only really looks at the profile in the job.\n\t*/\n\tacct_gather_profile_g_node_step_start(job);\n\t/* needed for the jobacct_gather plugin to start */\n\tacct_gather_profile_startpoll(msg->acctg_freq,\n\t\t\t\t      conf->job_acct_gather_freq);\n\n\tjob->multi_prog = 0;\n\tjob->open_mode  = msg->open_mode;\n\tjob->overcommit = (bool) msg->overcommit;\n\n\tjob->cwd     = xstrdup(msg->work_dir);\n\n\tjob->ckpt_dir = xstrdup(msg->ckpt_dir);\n\tjob->restart_dir = xstrdup(msg->restart_dir);\n\n\tjob->env     = _array_copy(msg->envc, msg->environment);\n\tjob->eio     = eio_handle_create(0);\n\tjob->sruns   = list_create((ListDelF) _srun_info_destructor);\n\tjob->envtp   = xmalloc(sizeof(env_t));\n\tjob->envtp->jobid = -1;\n\tjob->envtp->stepid = -1;\n\tjob->envtp->procid = -1;\n\tjob->envtp->localid = -1;\n\tjob->envtp->nodeid = -1;\n\n\tjob->envtp->distribution = 0;\n\tjob->cpu_bind_type = msg->cpu_bind_type;\n\tjob->cpu_bind = xstrdup(msg->cpu_bind);\n\tjob->envtp->mem_bind_type = 0;\n\tjob->envtp->mem_bind = NULL;\n\tjob->envtp->ckpt_dir = NULL;\n\tjob->envtp->restart_cnt = msg->restart_cnt;\n\n\tif (msg->cpus_per_node)\n\t\tjob->cpus    = msg->cpus_per_node[0];\n\n\tformat_core_allocs(msg->cred, conf->node_name, conf->cpus,\n\t\t\t   &job->job_alloc_cores, &job->step_alloc_cores,\n\t\t\t   &job->job_mem, &job->step_mem);\n\tif (job->step_mem\n\t\t&& conf->mem_limit_enforce)\n\t\tjobacct_gather_set_mem_limit(job->jobid, NO_VAL, job->step_mem);\n\telse if (job->job_mem\n\t\t&& conf->mem_limit_enforce)\n\t\tjobacct_gather_set_mem_limit(job->jobid, NO_VAL, job->job_mem);\n\n\tget_cred_gres(msg->cred, conf->node_name,\n\t\t      &job->job_gres_list, &job->step_gres_list);\n\n\tsrun = srun_info_create(NULL, NULL, NULL, (uint16_t)NO_VAL);\n\n\tlist_append(job->sruns, (void *) srun);\n\n\tif (msg->argc) {\n\t\tjob->argc    = msg->argc;\n\t\tjob->argv    = _array_copy(job->argc, msg->argv);\n\t} else {\n\t\tjob->argc    = 1;\n\t\t/* job script has not yet been written out to disk --\n\t\t * argv will be filled in later by _make_batch_script()\n\t\t */\n\t\tjob->argv    = (char **) xmalloc(2 * sizeof(char *));\n\t}\n\n\tjob->task = xmalloc(sizeof(stepd_step_task_info_t *));\n\tif (msg->std_err == NULL)\n\t\tmsg->std_err = xstrdup(msg->std_out);\n\n\tif (msg->std_in == NULL)\n\t\tin_name = xstrdup(\"/dev/null\");\n\telse\n\t\tin_name = fname_create(job, msg->std_in, 0);\n\n\tjob->task[0] = task_info_create(0, 0,\n\t\t\t\t\tin_name,\n\t\t\t\t\t_batchfilename(job, msg->std_out),\n\t\t\t\t\t_batchfilename(job, msg->std_err));\n\tjob->task[0]->argc = job->argc;\n\tjob->task[0]->argv = job->argv;\n\n#ifdef HAVE_ALPS_CRAY\n\tselect_g_select_jobinfo_get(msg->select_jobinfo, SELECT_JOBDATA_RESV_ID,\n\t\t\t\t    &job->resv_id);\n#endif\n\n\treturn job;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic int  _run_script_as_user(const char *name, const char *path,\n\t\t\t\tstepd_step_rec_t *job,\n\t\t\t\tint max_wait, char **env);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstepd_step_rec_t *\nmgr_launch_batch_job_setup(batch_job_launch_msg_t *msg, slurm_addr_t *cli)\n{\n\tstepd_step_rec_t *job = NULL;\n\n\tif (!(job = batch_stepd_step_rec_create(msg))) {\n\t\terror(\"batch_stepd_step_rec_create() failed: %m\");\n\t\treturn NULL;\n\t}\n\n\t_set_job_log_prefix(job);\n\n\t_setargs(job);\n\n\tif ((job->batchdir = _make_batch_dir(job)) == NULL) {\n\t\tgoto cleanup;\n\t}\n\n\txfree(job->argv[0]);\n\n\tif ((job->argv[0] = _make_batch_script(msg, job->batchdir)) == NULL) {\n\t\tgoto cleanup;\n\t}\n\n\t/* this is the new way of setting environment variables */\n\tenv_array_for_batch_job(&job->env, msg, conf->node_name);\n\n\t/* this is the old way of setting environment variables (but\n\t * needed) */\n\tjob->envtp->overcommit = msg->overcommit;\n\tjob->envtp->select_jobinfo = msg->select_jobinfo;\n\n\treturn job;\n\ncleanup:\n\terror(\"batch script setup failed for job %u.%u\",\n\t      msg->job_id, msg->step_id);\n\n\tif (job->aborted)\n\t\tverbose(\"job %u abort complete\", job->jobid);\n\n\t/* Do not purge directory until slurmctld is notified of batch job\n\t * completion to avoid race condition with slurmd registering missing\n\t * batch job. */\n\tif (job->batchdir && (rmdir(job->batchdir) < 0))\n\t\terror(\"rmdir(%s): %m\",  job->batchdir);\n\txfree(job->batchdir);\n\n\terrno = ESLURMD_CREATE_BATCH_DIR_ERROR;\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "batch_finish",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "395-432",
    "snippet": "extern void\nbatch_finish(stepd_step_rec_t *job, int rc)\n{\n\tstep_complete.step_rc = _get_exit_code(job);\n\n\tif (job->argv[0] && (unlink(job->argv[0]) < 0))\n\t\terror(\"unlink(%s): %m\", job->argv[0]);\n\n#ifdef HAVE_ALPS_CRAY\n\t_call_select_plugin_from_stepd(job, 0, select_g_job_fini);\n#endif\n\n\tif (job->aborted) {\n\t\tif ((job->stepid == NO_VAL) ||\n\t\t    (job->stepid == SLURM_BATCH_SCRIPT)) {\n\t\t\tinfo(\"step %u.%u abort completed\",\n\t\t\t     job->jobid, job->stepid);\n\t\t} else\n\t\t\tinfo(\"job %u abort completed\", job->jobid);\n\t} else if ((job->stepid == NO_VAL) ||\n\t\t   (job->stepid == SLURM_BATCH_SCRIPT)) {\n\t\tverbose(\"job %u completed with slurm_rc = %d, job_rc = %d\",\n\t\t\tjob->jobid, rc, step_complete.step_rc);\n\t\t_send_complete_batch_script_msg(job, rc, step_complete.step_rc);\n\t} else {\n\t\t_wait_for_children_slurmstepd(job);\n\t\tverbose(\"job %u.%u completed with slurm_rc = %d, job_rc = %d\",\n\t\t\tjob->jobid, job->stepid, rc, step_complete.step_rc);\n\t\t_send_step_complete_msgs(job);\n\t}\n\n\t/* Do not purge directory until slurmctld is notified of batch job\n\t * completion to avoid race condition with slurmd registering missing\n\t * batch job. */\n\tif (job->batchdir && (rmdir(job->batchdir) < 0))\n\t\terror(\"rmdir(%s): %m\",  job->batchdir);\n\txfree(job->batchdir);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "job->batchdir"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"rmdir(%s): %m\"",
            "job->batchdir"
          ],
          "line": 430
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rmdir",
          "args": [
            "job->batchdir"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_send_step_complete_msgs",
          "args": [
            "job"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "_send_step_complete_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "937-975",
          "snippet": "static void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_send_step_complete_msgs(stepd_step_rec_t *job)\n{\n\tint start, size;\n\tint first = -1, last = -1;\n\tbool sent_own_comp_msg = false;\n\n\tslurm_mutex_lock(&step_complete.lock);\n\tstart = 0;\n\tsize = bit_size(step_complete.bits);\n\n\t/* If no children, send message and return early */\n\tif (size == 0) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t\tslurm_mutex_unlock(&step_complete.lock);\n\t\treturn;\n\t}\n\n\twhile (_bit_getrange(start, size, &first, &last)) {\n\t\t/* THIS node is not in the bit string, so we need to prepend\n\t\t * the local rank */\n\t\tif (start == 0 && first == 0) {\n\t\t\tsent_own_comp_msg = true;\n\t\t\tfirst = -1;\n\t\t}\n\n\t\t_one_step_complete_msg(job, (first + step_complete.rank + 1),\n\t      \t\t\t       (last + step_complete.rank + 1));\n\t\tstart = last + 1;\n\t}\n\n\tif (!sent_own_comp_msg) {\n\t\t_one_step_complete_msg(job, step_complete.rank,\n\t\t\t\t       step_complete.rank);\n\t}\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"job %u.%u completed with slurm_rc = %d, job_rc = %d\"",
            "job->jobid",
            "job->stepid",
            "rc",
            "step_complete.step_rc"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_wait_for_children_slurmstepd",
          "args": [
            "job"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "_wait_for_children_slurmstepd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "734-774",
          "snippet": "static void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_wait_for_children_slurmstepd(stepd_step_rec_t *job)\n{\n\tint left = 0;\n\tint rc;\n\tstruct timespec ts = {0, 0};\n\n\tslurm_mutex_lock(&step_complete.lock);\n\n\t/* wait an extra 3 seconds for every level of tree below this level */\n\tif (step_complete.children > 0) {\n\t\tts.tv_sec += 3 * (step_complete.max_depth-step_complete.depth);\n\t\tts.tv_sec += time(NULL) + REVERSE_TREE_CHILDREN_TIMEOUT;\n\n\t\twhile((left = bit_clear_count(step_complete.bits)) > 0) {\n\t\t\tdebug3(\"Rank %d waiting for %d (of %d) children\",\n\t\t\t       step_complete.rank, left,\n\t\t\t       step_complete.children);\n\t\t\trc = pthread_cond_timedwait(&step_complete.cond,\n\t\t\t\t\t\t    &step_complete.lock, &ts);\n\t\t\tif (rc == ETIMEDOUT) {\n\t\t\t\tdebug2(\"Rank %d timed out waiting for %d\"\n\t\t\t\t       \" (of %d) children\", step_complete.rank,\n\t\t\t\t       left, step_complete.children);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (left == 0) {\n\t\t\tdebug2(\"Rank %d got all children completions\",\n\t\t\t       step_complete.rank);\n\t\t}\n\t} else {\n\t\tdebug2(\"Rank %d has no children slurmstepd\",\n\t\t       step_complete.rank);\n\t}\n\n\tstep_complete.step_rc = _get_exit_code(job);\n\tstep_complete.wait_children = false;\n\n\tslurm_mutex_unlock(&step_complete.lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_send_complete_batch_script_msg",
          "args": [
            "job",
            "rc",
            "step_complete.step_rc"
          ],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "_send_complete_batch_script_msg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2355-2417",
          "snippet": "static int\n_send_complete_batch_script_msg(stepd_step_rec_t *job, int err, int status)\n{\n\tint\t\trc, i, msg_rc;\n\tslurm_msg_t\treq_msg;\n\tcomplete_batch_script_msg_t req;\n\tchar *\t\tselect_type;\n\tbool\t\tmsg_to_ctld;\n\n\tif (conf->msg_aggr_window_msgs > 1)\n\t\tmsg_to_ctld = 0;\n\telse {\n\t\tselect_type = slurm_get_select_type();\n\t\tmsg_to_ctld = xstrcmp(select_type, \"select/serial\");\n\t\txfree(select_type);\n\t}\n\n\treq.job_id\t= job->jobid;\n\treq.job_rc      = status;\n\treq.jobacct\t= job->jobacct;\n\treq.node_name\t= job->node_name;\n\treq.slurm_rc\t= err;\n\treq.user_id\t= (uint32_t) job->uid;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type= REQUEST_COMPLETE_BATCH_SCRIPT;\n\treq_msg.data\t= &req;\n\n\tinfo(\"sending REQUEST_COMPLETE_BATCH_SCRIPT, error:%u status %d\",\n\t     err, status);\n\n\t/* Note: these log messages don't go to slurmd.log from here */\n\tfor (i = 0; i <= MAX_RETRY; i++) {\n\t\tif (msg_to_ctld) {\n\t\t\tmsg_rc = slurm_send_recv_controller_rc_msg(&req_msg,\n\t\t\t\t\t\t\t\t   &rc);\n\t\t} else {\n\t\t\t/* Send msg to slurmd, which forwards to slurmctld and\n\t\t\t * may get a new job to launch */\n\t\t\tif (i == 0) {\n\t\t\t\tslurm_set_addr_char(&req_msg.address,\n\t\t\t\t\t\t    conf->port, conf->hostname);\n\t\t\t}\n\t\t\tmsg_rc = slurm_send_recv_rc_msg_only_one(&req_msg,\n\t\t\t\t\t\t\t\t &rc, 0);\n\t\t}\n\t\tif (msg_rc == SLURM_SUCCESS)\n\t\t\tbreak;\n\t\tinfo(\"Retrying job complete RPC for %u.%u\",\n\t\t     job->jobid, job->stepid);\n\t\tsleep(RETRY_DELAY);\n\t}\n\tif (i > MAX_RETRY) {\n\t\terror(\"Unable to send job complete message: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif ((rc == ESLURM_ALREADY_DONE) || (rc == ESLURM_INVALID_JOB_ID))\n\t\trc = SLURM_SUCCESS;\n\tif (rc)\n\t\tslurm_seterrno_ret(rc);\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define MAX_RETRY   240\t\t/* retry 240 times (one hour max) */",
            "#define RETRY_DELAY 15\t\t/* retry every 15 seconds */"
          ],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\n#define MAX_RETRY   240\t\t/* retry 240 times (one hour max) */\n#define RETRY_DELAY 15\t\t/* retry every 15 seconds */\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_complete_batch_script_msg(stepd_step_rec_t *job, int err, int status)\n{\n\tint\t\trc, i, msg_rc;\n\tslurm_msg_t\treq_msg;\n\tcomplete_batch_script_msg_t req;\n\tchar *\t\tselect_type;\n\tbool\t\tmsg_to_ctld;\n\n\tif (conf->msg_aggr_window_msgs > 1)\n\t\tmsg_to_ctld = 0;\n\telse {\n\t\tselect_type = slurm_get_select_type();\n\t\tmsg_to_ctld = xstrcmp(select_type, \"select/serial\");\n\t\txfree(select_type);\n\t}\n\n\treq.job_id\t= job->jobid;\n\treq.job_rc      = status;\n\treq.jobacct\t= job->jobacct;\n\treq.node_name\t= job->node_name;\n\treq.slurm_rc\t= err;\n\treq.user_id\t= (uint32_t) job->uid;\n\tslurm_msg_t_init(&req_msg);\n\treq_msg.msg_type= REQUEST_COMPLETE_BATCH_SCRIPT;\n\treq_msg.data\t= &req;\n\n\tinfo(\"sending REQUEST_COMPLETE_BATCH_SCRIPT, error:%u status %d\",\n\t     err, status);\n\n\t/* Note: these log messages don't go to slurmd.log from here */\n\tfor (i = 0; i <= MAX_RETRY; i++) {\n\t\tif (msg_to_ctld) {\n\t\t\tmsg_rc = slurm_send_recv_controller_rc_msg(&req_msg,\n\t\t\t\t\t\t\t\t   &rc);\n\t\t} else {\n\t\t\t/* Send msg to slurmd, which forwards to slurmctld and\n\t\t\t * may get a new job to launch */\n\t\t\tif (i == 0) {\n\t\t\t\tslurm_set_addr_char(&req_msg.address,\n\t\t\t\t\t\t    conf->port, conf->hostname);\n\t\t\t}\n\t\t\tmsg_rc = slurm_send_recv_rc_msg_only_one(&req_msg,\n\t\t\t\t\t\t\t\t &rc, 0);\n\t\t}\n\t\tif (msg_rc == SLURM_SUCCESS)\n\t\t\tbreak;\n\t\tinfo(\"Retrying job complete RPC for %u.%u\",\n\t\t     job->jobid, job->stepid);\n\t\tsleep(RETRY_DELAY);\n\t}\n\tif (i > MAX_RETRY) {\n\t\terror(\"Unable to send job complete message: %m\");\n\t\treturn SLURM_ERROR;\n\t}\n\n\tif ((rc == ESLURM_ALREADY_DONE) || (rc == ESLURM_INVALID_JOB_ID))\n\t\trc = SLURM_SUCCESS;\n\tif (rc)\n\t\tslurm_seterrno_ret(rc);\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "\"job %u completed with slurm_rc = %d, job_rc = %d\"",
            "job->jobid",
            "rc",
            "step_complete.step_rc"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"job %u abort completed\"",
            "job->jobid"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "_task_info_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "222-232",
          "snippet": "static void\n_task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog)\n{\n\tslurm_mutex_lock(&t->mutex);\n\tslurm_mutex_unlock(&t->mutex);\n\tslurm_mutex_destroy(&t->mutex);\n\tif (multi_prog) {\n\t\txfree(t->argv);\n\t} /* otherwise, t->argv is a pointer to job->argv */\n\txfree(t);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nstatic void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);\n\nstatic void\n_task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog)\n{\n\tslurm_mutex_lock(&t->mutex);\n\tslurm_mutex_unlock(&t->mutex);\n\tslurm_mutex_destroy(&t->mutex);\n\tif (multi_prog) {\n\t\txfree(t->argv);\n\t} /* otherwise, t->argv is a pointer to job->argv */\n\txfree(t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"step %u.%u abort completed\"",
            "job->jobid",
            "job->stepid"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "_chk_cpuinfo_float",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/get_mach_stat.c",
          "lines": "414-423",
          "snippet": "static int _chk_cpuinfo_float(char *buffer, char *keyword, float *val)\n{\n\tchar *valptr;\n\tif (_chk_cpuinfo_str(buffer, keyword, &valptr)) {\n\t\t*val = (float) strtod(valptr, (char **)NULL);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmctld/slurmctld.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include <unistd.h>",
            "# include <kstat.h>",
            "#  include <sys/vfs.h>",
            "#  include <sys/statfs.h>",
            "#  include <sys/statvfs.h>",
            "#include <sys/utsname.h>",
            "#  include <sys/sysinfo.h>",
            "#  include <sys/times.h> /* for times(3) */",
            "#  include <sys/types.h>",
            "#  include <sys/times.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "# include <sys/sysctl.h>",
            "#include <sys/types.h>",
            "# include <sys/dr.h>",
            "# include <sys/systemcfg.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmctld/slurmctld.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include <unistd.h>\n# include <kstat.h>\n#  include <sys/vfs.h>\n#  include <sys/statfs.h>\n#  include <sys/statvfs.h>\n#include <sys/utsname.h>\n#  include <sys/sysinfo.h>\n#  include <sys/times.h> /* for times(3) */\n#  include <sys/types.h>\n#  include <sys/times.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <errno.h>\n# include <sys/sysctl.h>\n#include <sys/types.h>\n# include <sys/dr.h>\n# include <sys/systemcfg.h>\n#  include \"config.h\"\n\nstatic int _chk_cpuinfo_float(char *buffer, char *keyword, float *val)\n{\n\tchar *valptr;\n\tif (_chk_cpuinfo_str(buffer, keyword, &valptr)) {\n\t\t*val = (float) strtod(valptr, (char **)NULL);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "_call_select_plugin_from_stepd",
          "args": [
            "job",
            "0",
            "select_g_job_fini"
          ],
          "line": 404
        },
        "resolved": true,
        "details": {
          "function_name": "_call_select_plugin_from_stepd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "354-372",
          "snippet": "static int _call_select_plugin_from_stepd(stepd_step_rec_t *job,\n\t\t\t\t\t  uint64_t pagg_id,\n\t\t\t\t\t  int (*select_fn)(struct job_record *))\n{\n\tstruct job_record fake_job_record = {0};\n\tint rc;\n\n\tfake_job_record.job_id\t\t= job->jobid;\n\tfake_job_record.job_state\t= NO_VAL;\n\tfake_job_record.select_jobinfo\t= select_g_select_jobinfo_alloc();\n\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t    SELECT_JOBDATA_RESV_ID, &job->resv_id);\n\tif (pagg_id)\n\t\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t\t    SELECT_JOBDATA_PAGG_ID, &pagg_id);\n\trc = (*select_fn)(&fake_job_record);\n\tselect_g_select_jobinfo_free(fake_job_record.select_jobinfo);\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _call_select_plugin_from_stepd(stepd_step_rec_t *job,\n\t\t\t\t\t  uint64_t pagg_id,\n\t\t\t\t\t  int (*select_fn)(struct job_record *))\n{\n\tstruct job_record fake_job_record = {0};\n\tint rc;\n\n\tfake_job_record.job_id\t\t= job->jobid;\n\tfake_job_record.job_state\t= NO_VAL;\n\tfake_job_record.select_jobinfo\t= select_g_select_jobinfo_alloc();\n\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t    SELECT_JOBDATA_RESV_ID, &job->resv_id);\n\tif (pagg_id)\n\t\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t\t    SELECT_JOBDATA_PAGG_ID, &pagg_id);\n\trc = (*select_fn)(&fake_job_record);\n\tselect_g_select_jobinfo_free(fake_job_record.select_jobinfo);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "job->argv[0]"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_get_exit_code",
          "args": [
            "job"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "_get_exit_code",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "296-340",
          "snippet": "static uint32_t _get_exit_code(stepd_step_rec_t *job)\n{\n\tuint32_t i;\n\tuint32_t step_rc = NO_VAL;\n\n\t/* We are always killing/cancelling the extern_step so don't\n\t * report that.\n\t */\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn 0;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/* if this task was killed by cmd, ignore its\n\t\t * return status as it only reflects the fact\n\t\t * that we killed it\n\t\t */\n\t\tif (job->task[i]->killed_by_cmd) {\n\t\t\tdebug(\"get_exit_code task %u killed by cmd\", i);\n\t\t\tcontinue;\n\t\t}\n\t\t/* if this task called PMI_Abort or PMI2_Abort,\n\t\t * then we let it define the exit status\n\t\t */\n\t\tif (job->task[i]->aborted) {\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tdebug(\"get_exit_code task %u called abort\", i);\n\t\t\tbreak;\n\t\t}\n\t\t/* If signalled we need to cycle thru all the\n\t\t * tasks in case one of them called abort\n\t\t */\n\t\tif (WIFSIGNALED(job->task[i]->estatus)) {\n\t\t\terror(\"get_exit_code task %u died by signal\", i);\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tbreak;\n\t\t}\n\t\tstep_rc = MAX(step_complete.step_rc, job->task[i]->estatus);\n\t}\n\t/* If we killed all the tasks by cmd give at least one return\n\t   code. */\n\tif (step_rc == NO_VAL && job->task[0])\n\t\tstep_rc = job->task[0]->estatus;\n\n\treturn step_rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic uint32_t _get_exit_code(stepd_step_rec_t *job)\n{\n\tuint32_t i;\n\tuint32_t step_rc = NO_VAL;\n\n\t/* We are always killing/cancelling the extern_step so don't\n\t * report that.\n\t */\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn 0;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/* if this task was killed by cmd, ignore its\n\t\t * return status as it only reflects the fact\n\t\t * that we killed it\n\t\t */\n\t\tif (job->task[i]->killed_by_cmd) {\n\t\t\tdebug(\"get_exit_code task %u killed by cmd\", i);\n\t\t\tcontinue;\n\t\t}\n\t\t/* if this task called PMI_Abort or PMI2_Abort,\n\t\t * then we let it define the exit status\n\t\t */\n\t\tif (job->task[i]->aborted) {\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tdebug(\"get_exit_code task %u called abort\", i);\n\t\t\tbreak;\n\t\t}\n\t\t/* If signalled we need to cycle thru all the\n\t\t * tasks in case one of them called abort\n\t\t */\n\t\tif (WIFSIGNALED(job->task[i]->estatus)) {\n\t\t\terror(\"get_exit_code task %u died by signal\", i);\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tbreak;\n\t\t}\n\t\tstep_rc = MAX(step_complete.step_rc, job->task[i]->estatus);\n\t}\n\t/* If we killed all the tasks by cmd give at least one return\n\t   code. */\n\tif (step_rc == NO_VAL && job->task[0])\n\t\tstep_rc = job->task[0]->estatus;\n\n\treturn step_rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nextern void\nbatch_finish(stepd_step_rec_t *job, int rc)\n{\n\tstep_complete.step_rc = _get_exit_code(job);\n\n\tif (job->argv[0] && (unlink(job->argv[0]) < 0))\n\t\terror(\"unlink(%s): %m\", job->argv[0]);\n\n#ifdef HAVE_ALPS_CRAY\n\t_call_select_plugin_from_stepd(job, 0, select_g_job_fini);\n#endif\n\n\tif (job->aborted) {\n\t\tif ((job->stepid == NO_VAL) ||\n\t\t    (job->stepid == SLURM_BATCH_SCRIPT)) {\n\t\t\tinfo(\"step %u.%u abort completed\",\n\t\t\t     job->jobid, job->stepid);\n\t\t} else\n\t\t\tinfo(\"job %u abort completed\", job->jobid);\n\t} else if ((job->stepid == NO_VAL) ||\n\t\t   (job->stepid == SLURM_BATCH_SCRIPT)) {\n\t\tverbose(\"job %u completed with slurm_rc = %d, job_rc = %d\",\n\t\t\tjob->jobid, rc, step_complete.step_rc);\n\t\t_send_complete_batch_script_msg(job, rc, step_complete.step_rc);\n\t} else {\n\t\t_wait_for_children_slurmstepd(job);\n\t\tverbose(\"job %u.%u completed with slurm_rc = %d, job_rc = %d\",\n\t\t\tjob->jobid, job->stepid, rc, step_complete.step_rc);\n\t\t_send_step_complete_msgs(job);\n\t}\n\n\t/* Do not purge directory until slurmctld is notified of batch job\n\t * completion to avoid race condition with slurmd registering missing\n\t * batch job. */\n\tif (job->batchdir && (rmdir(job->batchdir) < 0))\n\t\terror(\"rmdir(%s): %m\",  job->batchdir);\n\txfree(job->batchdir);\n}"
  },
  {
    "function_name": "_select_cray_plugin_job_ready",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "374-389",
    "snippet": "static int _select_cray_plugin_job_ready(stepd_step_rec_t *job)\n{\n\tuint64_t pagg_id = proctrack_g_find(job->jmgr_pid);\n\n\tif (pagg_id == 0) {\n\t\terror(\"no PAGG ID: job service disabled on this host?\");\n\t\t/*\n\t\t * If this process is not attached to a container, there is no\n\t\t * sense in trying to use the SID as fallback, since the call to\n\t\t * proctrack_g_add() in _fork_all_tasks() will fail later.\n\t\t * Hence drain the node until sgi_job returns proper PAGG IDs.\n\t\t */\n\t\treturn READY_JOB_FATAL;\n\t}\n\treturn _call_select_plugin_from_stepd(job, pagg_id, select_g_job_ready);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "_call_select_plugin_from_stepd",
          "args": [
            "job",
            "pagg_id",
            "select_g_job_ready"
          ],
          "line": 388
        },
        "resolved": true,
        "details": {
          "function_name": "_call_select_plugin_from_stepd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "354-372",
          "snippet": "static int _call_select_plugin_from_stepd(stepd_step_rec_t *job,\n\t\t\t\t\t  uint64_t pagg_id,\n\t\t\t\t\t  int (*select_fn)(struct job_record *))\n{\n\tstruct job_record fake_job_record = {0};\n\tint rc;\n\n\tfake_job_record.job_id\t\t= job->jobid;\n\tfake_job_record.job_state\t= NO_VAL;\n\tfake_job_record.select_jobinfo\t= select_g_select_jobinfo_alloc();\n\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t    SELECT_JOBDATA_RESV_ID, &job->resv_id);\n\tif (pagg_id)\n\t\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t\t    SELECT_JOBDATA_PAGG_ID, &pagg_id);\n\trc = (*select_fn)(&fake_job_record);\n\tselect_g_select_jobinfo_free(fake_job_record.select_jobinfo);\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _call_select_plugin_from_stepd(stepd_step_rec_t *job,\n\t\t\t\t\t  uint64_t pagg_id,\n\t\t\t\t\t  int (*select_fn)(struct job_record *))\n{\n\tstruct job_record fake_job_record = {0};\n\tint rc;\n\n\tfake_job_record.job_id\t\t= job->jobid;\n\tfake_job_record.job_state\t= NO_VAL;\n\tfake_job_record.select_jobinfo\t= select_g_select_jobinfo_alloc();\n\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t    SELECT_JOBDATA_RESV_ID, &job->resv_id);\n\tif (pagg_id)\n\t\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t\t    SELECT_JOBDATA_PAGG_ID, &pagg_id);\n\trc = (*select_fn)(&fake_job_record);\n\tselect_g_select_jobinfo_free(fake_job_record.select_jobinfo);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"no PAGG ID: job service disabled on this host?\""
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "proctrack_g_find",
          "args": [
            "job->jmgr_pid"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "proctrack_g_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/proctrack.c",
          "lines": "418-424",
          "snippet": "extern uint64_t proctrack_g_find(pid_t pid)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn (*(ops.find_cont)) (pid);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/log.h\"",
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <pthread.h>",
            "#include <fcntl.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static slurm_proctrack_ops_t ops;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/log.h\"\n#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <pthread.h>\n#include <fcntl.h>\n#  include \"config.h\"\n\nstatic slurm_proctrack_ops_t ops;\n\nextern uint64_t proctrack_g_find(pid_t pid)\n{\n\tif (slurm_proctrack_init() < 0)\n\t\treturn SLURM_ERROR;\n\n\treturn (*(ops.find_cont)) (pid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _select_cray_plugin_job_ready(stepd_step_rec_t *job)\n{\n\tuint64_t pagg_id = proctrack_g_find(job->jmgr_pid);\n\n\tif (pagg_id == 0) {\n\t\terror(\"no PAGG ID: job service disabled on this host?\");\n\t\t/*\n\t\t * If this process is not attached to a container, there is no\n\t\t * sense in trying to use the SID as fallback, since the call to\n\t\t * proctrack_g_add() in _fork_all_tasks() will fail later.\n\t\t * Hence drain the node until sgi_job returns proper PAGG IDs.\n\t\t */\n\t\treturn READY_JOB_FATAL;\n\t}\n\treturn _call_select_plugin_from_stepd(job, pagg_id, select_g_job_ready);\n}"
  },
  {
    "function_name": "_call_select_plugin_from_stepd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "354-372",
    "snippet": "static int _call_select_plugin_from_stepd(stepd_step_rec_t *job,\n\t\t\t\t\t  uint64_t pagg_id,\n\t\t\t\t\t  int (*select_fn)(struct job_record *))\n{\n\tstruct job_record fake_job_record = {0};\n\tint rc;\n\n\tfake_job_record.job_id\t\t= job->jobid;\n\tfake_job_record.job_state\t= NO_VAL;\n\tfake_job_record.select_jobinfo\t= select_g_select_jobinfo_alloc();\n\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t    SELECT_JOBDATA_RESV_ID, &job->resv_id);\n\tif (pagg_id)\n\t\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t\t    SELECT_JOBDATA_PAGG_ID, &pagg_id);\n\trc = (*select_fn)(&fake_job_record);\n\tselect_g_select_jobinfo_free(fake_job_record.select_jobinfo);\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "select_g_select_jobinfo_free",
          "args": [
            "fake_job_record.select_jobinfo"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "&fake_job_record"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "select_g_select_jobinfo_set",
          "args": [
            "fake_job_record.select_jobinfo",
            "SELECT_JOBDATA_PAGG_ID",
            "&pagg_id"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "select_g_select_jobinfo_set",
          "args": [
            "fake_job_record.select_jobinfo",
            "SELECT_JOBDATA_RESV_ID",
            "&job->resv_id"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "select_g_select_jobinfo_alloc",
          "args": [],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int _call_select_plugin_from_stepd(stepd_step_rec_t *job,\n\t\t\t\t\t  uint64_t pagg_id,\n\t\t\t\t\t  int (*select_fn)(struct job_record *))\n{\n\tstruct job_record fake_job_record = {0};\n\tint rc;\n\n\tfake_job_record.job_id\t\t= job->jobid;\n\tfake_job_record.job_state\t= NO_VAL;\n\tfake_job_record.select_jobinfo\t= select_g_select_jobinfo_alloc();\n\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t    SELECT_JOBDATA_RESV_ID, &job->resv_id);\n\tif (pagg_id)\n\t\tselect_g_select_jobinfo_set(fake_job_record.select_jobinfo,\n\t\t\t\t\t    SELECT_JOBDATA_PAGG_ID, &pagg_id);\n\trc = (*select_fn)(&fake_job_record);\n\tselect_g_select_jobinfo_free(fake_job_record.select_jobinfo);\n\treturn rc;\n}"
  },
  {
    "function_name": "_get_exit_code",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "296-340",
    "snippet": "static uint32_t _get_exit_code(stepd_step_rec_t *job)\n{\n\tuint32_t i;\n\tuint32_t step_rc = NO_VAL;\n\n\t/* We are always killing/cancelling the extern_step so don't\n\t * report that.\n\t */\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn 0;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/* if this task was killed by cmd, ignore its\n\t\t * return status as it only reflects the fact\n\t\t * that we killed it\n\t\t */\n\t\tif (job->task[i]->killed_by_cmd) {\n\t\t\tdebug(\"get_exit_code task %u killed by cmd\", i);\n\t\t\tcontinue;\n\t\t}\n\t\t/* if this task called PMI_Abort or PMI2_Abort,\n\t\t * then we let it define the exit status\n\t\t */\n\t\tif (job->task[i]->aborted) {\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tdebug(\"get_exit_code task %u called abort\", i);\n\t\t\tbreak;\n\t\t}\n\t\t/* If signalled we need to cycle thru all the\n\t\t * tasks in case one of them called abort\n\t\t */\n\t\tif (WIFSIGNALED(job->task[i]->estatus)) {\n\t\t\terror(\"get_exit_code task %u died by signal\", i);\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tbreak;\n\t\t}\n\t\tstep_rc = MAX(step_complete.step_rc, job->task[i]->estatus);\n\t}\n\t/* If we killed all the tasks by cmd give at least one return\n\t   code. */\n\tif (step_rc == NO_VAL && job->task[0])\n\t\tstep_rc = job->task[0]->estatus;\n\n\treturn step_rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "step_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "MAX",
          "args": [
            "step_complete.step_rc",
            "job->task[i]->estatus"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"get_exit_code task %u died by signal\"",
            "i"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "WIFSIGNALED",
          "args": [
            "job->task[i]->estatus"
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"get_exit_code task %u called abort\"",
            "i"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_wake_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "187-199",
          "snippet": "void pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstep_complete_t step_complete = {\n\tPTHREAD_COND_INITIALIZER,\n\tPTHREAD_MUTEX_INITIALIZER,\n\t-1,\n\t-1,\n\t-1,\n\t{},\n\t-1,\n\t-1,\n\ttrue,\n\t(bitstr_t *)NULL,\n\t0,\n\tNULL\n};\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic uint32_t _get_exit_code(stepd_step_rec_t *job)\n{\n\tuint32_t i;\n\tuint32_t step_rc = NO_VAL;\n\n\t/* We are always killing/cancelling the extern_step so don't\n\t * report that.\n\t */\n\tif (job->stepid == SLURM_EXTERN_CONT)\n\t\treturn 0;\n\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\t/* if this task was killed by cmd, ignore its\n\t\t * return status as it only reflects the fact\n\t\t * that we killed it\n\t\t */\n\t\tif (job->task[i]->killed_by_cmd) {\n\t\t\tdebug(\"get_exit_code task %u killed by cmd\", i);\n\t\t\tcontinue;\n\t\t}\n\t\t/* if this task called PMI_Abort or PMI2_Abort,\n\t\t * then we let it define the exit status\n\t\t */\n\t\tif (job->task[i]->aborted) {\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tdebug(\"get_exit_code task %u called abort\", i);\n\t\t\tbreak;\n\t\t}\n\t\t/* If signalled we need to cycle thru all the\n\t\t * tasks in case one of them called abort\n\t\t */\n\t\tif (WIFSIGNALED(job->task[i]->estatus)) {\n\t\t\terror(\"get_exit_code task %u died by signal\", i);\n\t\t\tstep_rc = job->task[i]->estatus;\n\t\t\tbreak;\n\t\t}\n\t\tstep_rc = MAX(step_complete.step_rc, job->task[i]->estatus);\n\t}\n\t/* If we killed all the tasks by cmd give at least one return\n\t   code. */\n\tif (step_rc == NO_VAL && job->task[0])\n\t\tstep_rc = job->task[0]->estatus;\n\n\treturn step_rc;\n}"
  },
  {
    "function_name": "_send_srun_resp_msg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "262-291",
    "snippet": "inline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static void _send_launch_resp(stepd_step_rec_t *job, int rc);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "usleep",
          "args": [
            "delay"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug3",
          "args": [
            "\"%s: failed to send msg type %u: %m\"",
            "__func__",
            "resp_msg->msg_type"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_send_only_node_msg",
          "args": [
            "resp_msg"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wait_for_resumed",
          "args": [
            "resp_msg->msg_type"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "wait_for_resumed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/req.c",
          "lines": "1806-1820",
          "snippet": "extern void wait_for_resumed(uint16_t msg_type)\n{\n\tint i;\n\n\tfor (i = 0; ; i++) {\n\t\tif (i)\n\t\t\tsleep(1);\n\t\tif (!suspended)\n\t\t\treturn;\n\t\tif (i == 0) {\n\t\t\tinfo(\"defer sending msg_type %u to suspended job\",\n\t\t\t     msg_type);\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/timers.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/stepd_api.h\"",
            "#include \"src/common/slurm_acct_gather.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_auth.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/parse_time.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include <stdlib.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int _handle_state(int fd, stepd_step_rec_t *job);",
            "static int _handle_info(int fd, stepd_step_rec_t *job);",
            "static int _handle_mem_limits(int fd, stepd_step_rec_t *job);",
            "static int _handle_uid(int fd, stepd_step_rec_t *job);",
            "static int _handle_nodeid(int fd, stepd_step_rec_t *job);",
            "static int _handle_pid_in_container(int fd, stepd_step_rec_t *job);",
            "static int _handle_add_extern_pid(int fd, stepd_step_rec_t *job);",
            "static int _handle_daemon_pid(int fd, stepd_step_rec_t *job);",
            "static int _handle_task_info(int fd, stepd_step_rec_t *job);",
            "static int _handle_list_pids(int fd, stepd_step_rec_t *job);",
            "static bool suspended = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/timers.h\"\n#include \"src/common/checkpoint.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/stepd_api.h\"\n#include \"src/common/slurm_acct_gather.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_auth.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/parse_time.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/cpu_frequency.h\"\n#include <stdlib.h>\n#include <time.h>\n#include <signal.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#  include \"config.h\"\n\nstatic int _handle_state(int fd, stepd_step_rec_t *job);\nstatic int _handle_info(int fd, stepd_step_rec_t *job);\nstatic int _handle_mem_limits(int fd, stepd_step_rec_t *job);\nstatic int _handle_uid(int fd, stepd_step_rec_t *job);\nstatic int _handle_nodeid(int fd, stepd_step_rec_t *job);\nstatic int _handle_pid_in_container(int fd, stepd_step_rec_t *job);\nstatic int _handle_add_extern_pid(int fd, stepd_step_rec_t *job);\nstatic int _handle_daemon_pid(int fd, stepd_step_rec_t *job);\nstatic int _handle_task_info(int fd, stepd_step_rec_t *job);\nstatic int _handle_list_pids(int fd, stepd_step_rec_t *job);\nstatic bool suspended = false;\n\nextern void wait_for_resumed(uint16_t msg_type)\n{\n\tint i;\n\n\tfor (i = 0; ; i++) {\n\t\tif (i)\n\t\t\tsleep(1);\n\t\tif (!suspended)\n\t\t\treturn;\n\t\tif (i == 0) {\n\t\t\tinfo(\"defer sending msg_type %u to suspended job\",\n\t\t\t     msg_type);\n\t\t}\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\ninline static int\n_send_srun_resp_msg(slurm_msg_t *resp_msg, uint32_t nnodes)\n{\n\tint rc, retry = 0, max_retry = 0;\n\tunsigned long delay = 100000;\n\n\t/* NOTE: Wait until suspended job step is resumed or the RPC\n\t * authentication credential from Munge may expire by the time\n\t * it is resumed */\n\twait_for_resumed(resp_msg->msg_type);\n\twhile (1) {\n\t\trc = slurm_send_only_node_msg(resp_msg);\n\t\tif ((rc == SLURM_SUCCESS) || (errno != ETIMEDOUT))\n\t\t\tbreak;\n\n\t\tif (!max_retry)\n\t\t\tmax_retry = (nnodes / 1024) + 1;\n\n\t\tif (retry > max_retry)\n\t\t\tbreak;\n\n\t\tdebug3(\"%s: failed to send msg type %u: %m\",\n\t\t\t__func__, resp_msg->msg_type);\n\t\tusleep(delay);\n\t\tif (delay < 800000)\n\t\t\tdelay *= 2;\n\t\tretry++;\n\t}\n\treturn rc;\n}"
  },
  {
    "function_name": "mgr_launch_tasks_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
    "lines": "233-260",
    "snippet": "extern stepd_step_rec_t *\nmgr_launch_tasks_setup(launch_tasks_request_msg_t *msg, slurm_addr_t *cli,\n\t\t       slurm_addr_t *self, uint16_t protocol_version)\n{\n\tstepd_step_rec_t *job = NULL;\n\n\tif (!(job = stepd_step_rec_create(msg, protocol_version))) {\n\t\t/* We want to send back to the slurmd the reason we\n\t\t   failed so keep track of it since errno could be\n\t\t   reset in _send_launch_failure.\n\t\t*/\n\t\tint fail = errno;\n\t\t_send_launch_failure(msg, cli, errno, protocol_version);\n\t\terrno = fail;\n\t\treturn NULL;\n\t}\n\n\t_set_job_log_prefix(job);\n\n\t_setargs(job);\n\n\tjob->envtp->cli = cli;\n\tjob->envtp->self = self;\n\tjob->envtp->select_jobinfo = msg->select_jobinfo;\n\tjob->accel_bind_type = msg->accel_bind_type;\n\n\treturn job;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/fname.h\"",
      "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
      "#include \"src/slurmd/slurmstepd/req.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmstepd/io.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/mgr.h\"",
      "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
      "#include \"src/slurmd/common/xcpuinfo.h\"",
      "#include \"src/slurmd/common/set_oomadj.h\"",
      "#include \"src/slurmd/common/reverse_tree.h\"",
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/slurmd_cgroup.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/slurmd/common/setproctitle.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/slurmd/common/core_spec_plugin.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/util-net.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/slurm_jobacct_gather.h\"",
      "#include \"src/common/slurm_cred.h\"",
      "#include \"src/common/slurm_acct_gather_profile.h\"",
      "#include \"src/common/safeopen.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/node_select.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/hostlist.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/forward.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/cpu_frequency.h\"",
      "#include \"src/common/cbuf.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#    include <utmp.h>",
      "#  include <pty.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <time.h>",
      "#include <sys/wait.h>",
      "#include <sys/utsname.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <pwd.h>",
      "#include <pthread.h>",
      "#include <poll.h>",
      "#include <grp.h>",
      "#  include \"src/common/unsetenv.h\"",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/prctl.h>",
      "#  include <sys/types.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);",
      "static int  _drain_node(char *reason);",
      "static void  _set_prio_process (stepd_step_rec_t *job);",
      "static void _set_job_log_prefix(stepd_step_rec_t *job);",
      "static int  _setup_normal_io(stepd_step_rec_t *job);",
      "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
      "static void _wait_for_io(stepd_step_rec_t *job);",
      "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
      "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
      "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
      "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
      "static void _setargs(stepd_step_rec_t *job);",
      "static void _random_sleep(stepd_step_rec_t *job);",
      "static char * _make_batch_dir(stepd_step_rec_t *job);",
      "static int _initgroups(stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "_setargs",
          "args": [
            "job"
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "_setargs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2563-2575",
          "snippet": "static void\n_setargs(stepd_step_rec_t *job)\n{\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsetproctitle(\"[%u]\",    job->jobid);\n\telse\n\t\tsetproctitle(\"[%u.%u]\", job->jobid, job->stepid);\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_setargs(stepd_step_rec_t *job)\n{\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsetproctitle(\"[%u]\",    job->jobid);\n\telse\n\t\tsetproctitle(\"[%u.%u]\", job->jobid, job->stepid);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_set_job_log_prefix",
          "args": [
            "job"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_log_prefix",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "490-504",
          "snippet": "static void\n_set_job_log_prefix(stepd_step_rec_t *job)\n{\n\tchar buf[256];\n\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsnprintf(buf, sizeof(buf), \"[%u]\", job->jobid);\n\telse\n\t\tsnprintf(buf, sizeof(buf), \"[%u.%u]\", job->jobid, job->stepid);\n\n\tlog_set_fpfx(buf);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void\n_set_job_log_prefix(stepd_step_rec_t *job)\n{\n\tchar buf[256];\n\n\tif (job->jobid > MAX_NOALLOC_JOBID)\n\t\treturn;\n\n\tif ((job->jobid >= MIN_NOALLOC_JOBID) || (job->stepid == NO_VAL))\n\t\tsnprintf(buf, sizeof(buf), \"[%u]\", job->jobid);\n\telse\n\t\tsnprintf(buf, sizeof(buf), \"[%u.%u]\", job->jobid, job->stepid);\n\n\tlog_set_fpfx(buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_send_launch_failure",
          "args": [
            "msg",
            "cli",
            "errno",
            "protocol_version"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "_send_launch_failure",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "2279-2314",
          "snippet": "static void\n_send_launch_failure(launch_tasks_request_msg_t *msg, slurm_addr_t *cli, int rc,\n\t\t     uint16_t protocol_version)\n{\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tint nodeid;\n\tchar *name = NULL;\n\n#ifndef HAVE_FRONT_END\n\tnodeid = nodelist_find(msg->complete_nodelist, conf->node_name);\n\tname = xstrdup(conf->node_name);\n#else\n\tnodeid = 0;\n\tname = xstrdup(msg->complete_nodelist);\n#endif\n\tdebug (\"sending launch failure message: %s\", slurm_strerror (rc));\n\n\tslurm_msg_t_init(&resp_msg);\n\tmemcpy(&resp_msg.address, cli, sizeof(slurm_addr_t));\n\tslurm_set_addr(&resp_msg.address,\n\t\t       msg->resp_port[nodeid % msg->num_resp_port],\n\t\t       NULL);\n\tresp_msg.data = &resp;\n\tresp_msg.msg_type = RESPONSE_LAUNCH_TASKS;\n\tresp_msg.protocol_version = protocol_version;\n\n\tresp.node_name     = name;\n\tresp.return_code   = rc ? rc : -1;\n\tresp.count_of_pids = 0;\n\n\tif (_send_srun_resp_msg(&resp_msg, msg->nnodes) != SLURM_SUCCESS)\n\t\terror(\"Failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\txfree(name);\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);",
            "static void _send_launch_resp(stepd_step_rec_t *job, int rc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);\nstatic void _send_launch_resp(stepd_step_rec_t *job, int rc);\n\nstatic void\n_send_launch_failure(launch_tasks_request_msg_t *msg, slurm_addr_t *cli, int rc,\n\t\t     uint16_t protocol_version)\n{\n\tslurm_msg_t resp_msg;\n\tlaunch_tasks_response_msg_t resp;\n\tint nodeid;\n\tchar *name = NULL;\n\n#ifndef HAVE_FRONT_END\n\tnodeid = nodelist_find(msg->complete_nodelist, conf->node_name);\n\tname = xstrdup(conf->node_name);\n#else\n\tnodeid = 0;\n\tname = xstrdup(msg->complete_nodelist);\n#endif\n\tdebug (\"sending launch failure message: %s\", slurm_strerror (rc));\n\n\tslurm_msg_t_init(&resp_msg);\n\tmemcpy(&resp_msg.address, cli, sizeof(slurm_addr_t));\n\tslurm_set_addr(&resp_msg.address,\n\t\t       msg->resp_port[nodeid % msg->num_resp_port],\n\t\t       NULL);\n\tresp_msg.data = &resp;\n\tresp_msg.msg_type = RESPONSE_LAUNCH_TASKS;\n\tresp_msg.protocol_version = protocol_version;\n\n\tresp.node_name     = name;\n\tresp.return_code   = rc ? rc : -1;\n\tresp.count_of_pids = 0;\n\n\tif (_send_srun_resp_msg(&resp_msg, msg->nnodes) != SLURM_SUCCESS)\n\t\terror(\"Failed to send RESPONSE_LAUNCH_TASKS: %m\");\n\txfree(name);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "stepd_step_rec_create",
          "args": [
            "msg",
            "protocol_version"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "stepd_step_rec_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "235-435",
          "snippet": "extern stepd_step_rec_t *\nstepd_step_rec_create(launch_tasks_request_msg_t *msg, uint16_t protocol_version)\n{\n\tstepd_step_rec_t  *job = NULL;\n\tsrun_info_t   *srun = NULL;\n\tslurm_addr_t     resp_addr;\n\tslurm_addr_t     io_addr;\n\tint            i, nodeid = NO_VAL;\n\n\txassert(msg != NULL);\n\txassert(msg->complete_nodelist != NULL);\n\tdebug3(\"entering stepd_step_rec_create\");\n\n\tif (!slurm_valid_uid_gid((uid_t)msg->uid, &(msg->gid),\n\t\t\t\t &(msg->user_name), already_validated_uid, 1))\n\t\treturn NULL;\n\n\tif (acct_gather_check_acct_freq_task(msg->job_mem_lim, msg->acctg_freq))\n\t\treturn NULL;\n\n\tjob = xmalloc(sizeof(stepd_step_rec_t));\n\tjob->msg = msg;\n#ifndef HAVE_FRONT_END\n\tnodeid = nodelist_find(msg->complete_nodelist, conf->node_name);\n\tjob->node_name = xstrdup(conf->node_name);\n#else\n\tnodeid = 0;\n\tjob->node_name = xstrdup(msg->complete_nodelist);\n#endif\n\tif (nodeid < 0) {\n\t\terror(\"couldn't find node %s in %s\",\n\t\t      job->node_name, msg->complete_nodelist);\n\t\tstepd_step_rec_destroy(job);\n\t\treturn NULL;\n\t}\n\n\tjob->state = SLURMSTEPD_STEP_STARTING;\n\tpthread_cond_init(&job->state_cond, NULL);\n\tpthread_mutex_init(&job->state_mutex, NULL);\n\tjob->node_tasks\t= msg->tasks_to_launch[nodeid];\n\ti = sizeof(uint16_t) * msg->nnodes;\n\tjob->task_cnts  = xmalloc(i);\n\tmemcpy(job->task_cnts, msg->tasks_to_launch, i);\n\tjob->ntasks\t= msg->ntasks;\n\tjob->jobid\t= msg->job_id;\n\tjob->stepid\t= msg->job_step_id;\n\n\tjob->uid\t= (uid_t) msg->uid;\n\tjob->user_name  = xstrdup(msg->user_name);\n\tjob->gid\t= (gid_t) msg->gid;\n\tjob->cwd\t= xstrdup(msg->cwd);\n\tjob->task_dist\t= msg->task_dist;\n\n\tjob->cpu_bind_type = msg->cpu_bind_type;\n\tjob->cpu_bind = xstrdup(msg->cpu_bind);\n\tjob->mem_bind_type = msg->mem_bind_type;\n\tjob->mem_bind = xstrdup(msg->mem_bind);\n\tjob->cpu_freq_min = msg->cpu_freq_min;\n\tjob->cpu_freq_max = msg->cpu_freq_max;\n\tjob->cpu_freq_gov = msg->cpu_freq_gov;\n\tjob->ckpt_dir = xstrdup(msg->ckpt_dir);\n\tjob->restart_dir = xstrdup(msg->restart_dir);\n\tjob->cpus_per_task = msg->cpus_per_task;\n\n\tjob->env     = _array_copy(msg->envc, msg->env);\n\tjob->array_job_id  = msg->job_id;\n\tjob->array_task_id = NO_VAL;\n\tfor (i = 0; i < msg->envc; i++) {\n\t\t/*                         1234567890123456789 */\n\t\tif (!xstrncmp(msg->env[i], \"SLURM_ARRAY_JOB_ID=\", 19))\n\t\t\tjob->array_job_id = atoi(msg->env[i] + 19);\n\t\t/*                         12345678901234567890 */\n\t\tif (!xstrncmp(msg->env[i], \"SLURM_ARRAY_TASK_ID=\", 20))\n\t\t\tjob->array_task_id = atoi(msg->env[i] + 20);\n\t}\n\n\tjob->eio     = eio_handle_create(0);\n\tjob->sruns   = list_create((ListDelF) _srun_info_destructor);\n\n\t/* Based on my testing the next 3 lists here could use the\n\t * eio_obj_destroy, but if you do you can get an invalid read.  Since\n\t * these stay until the end of the job it isn't that big of a deal.\n\t */\n\tjob->clients = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->stdout_eio_objs = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->stderr_eio_objs = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->free_incoming = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->incoming_count = 0;\n\tjob->free_outgoing = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->outgoing_count = 0;\n\tjob->outgoing_cache = list_create(NULL); /* FIXME! Needs destructor */\n\n\tjob->envtp   = xmalloc(sizeof(env_t));\n\tjob->envtp->jobid = -1;\n\tjob->envtp->stepid = -1;\n\tjob->envtp->procid = -1;\n\tjob->envtp->localid = -1;\n\tjob->envtp->nodeid = -1;\n\n\tjob->envtp->distribution = 0;\n\tjob->envtp->cpu_bind_type = 0;\n\tjob->envtp->cpu_bind = NULL;\n\tjob->envtp->mem_bind_type = 0;\n\tjob->envtp->mem_bind = NULL;\n\tjob->envtp->ckpt_dir = NULL;\n\tif (!msg->resp_port)\n\t\tmsg->num_resp_port = 0;\n\tif (msg->num_resp_port) {\n\t\tjob->envtp->comm_port =\n\t\t\tmsg->resp_port[nodeid % msg->num_resp_port];\n\t\tmemcpy(&resp_addr, &msg->orig_addr, sizeof(slurm_addr_t));\n\t\tslurm_set_addr(&resp_addr,\n\t\t\t       msg->resp_port[nodeid % msg->num_resp_port],\n\t\t\t       NULL);\n\t} else {\n\t\tmemset(&resp_addr, 0, sizeof(slurm_addr_t));\n\t}\n\tjob->user_managed_io = msg->user_managed_io;\n\tif (!msg->io_port)\n\t\tmsg->user_managed_io = 1;\n\tif (!msg->user_managed_io) {\n\t\tmemcpy(&io_addr,   &msg->orig_addr, sizeof(slurm_addr_t));\n\t\tslurm_set_addr(&io_addr,\n\t\t\t       msg->io_port[nodeid % msg->num_io_port],\n\t\t\t       NULL);\n\t} else {\n\t\tmemset(&io_addr, 0, sizeof(slurm_addr_t));\n\t}\n\n\tsrun = srun_info_create(msg->cred, &resp_addr, &io_addr,\n\t\t\t\tprotocol_version);\n\n\tjob->buffered_stdio = msg->buffered_stdio;\n\tjob->labelio = msg->labelio;\n\n\tjob->profile     = msg->profile;\n\tjob->task_prolog = xstrdup(msg->task_prolog);\n\tjob->task_epilog = xstrdup(msg->task_epilog);\n\n\tjob->argc    = msg->argc;\n\tjob->argv    = _array_copy(job->argc, msg->argv);\n\n\tjob->nnodes  = msg->nnodes;\n\tjob->nodeid  = nodeid;\n\tjob->debug   = msg->slurmd_debug;\n\tjob->cpus    = msg->node_cpus;\n\tjob->job_core_spec = msg->job_core_spec;\n\n\t/* This needs to happen before acct_gather_profile_startpoll\n\t   and only really looks at the profile in the job.\n\t*/\n\tacct_gather_profile_g_node_step_start(job);\n\n\tacct_gather_profile_startpoll(msg->acctg_freq,\n\t\t\t\t      conf->job_acct_gather_freq);\n\n\tjob->multi_prog  = msg->multi_prog;\n\tjob->timelimit   = (time_t) -1;\n\tjob->task_flags  = msg->task_flags;\n\tjob->switch_job  = msg->switch_job;\n\tjob->pty         = msg->pty;\n\tjob->open_mode   = msg->open_mode;\n\tjob->options     = msg->options;\n\tformat_core_allocs(msg->cred, conf->node_name, conf->cpus,\n\t\t\t   &job->job_alloc_cores, &job->step_alloc_cores,\n\t\t\t   &job->job_mem, &job->step_mem);\n\n\t/* If users have configured MemLimitEnforce=no\n\t * in their slurm.conf keep going.\n\t */\n\tif (job->step_mem\n\t    && conf->mem_limit_enforce) {\n\t\tjobacct_gather_set_mem_limit(job->jobid, job->stepid,\n\t\t\t\t\t     job->step_mem);\n\t} else if (job->job_mem\n\t\t   && conf->mem_limit_enforce) {\n\t\tjobacct_gather_set_mem_limit(job->jobid, job->stepid,\n\t\t\t\t\t     job->job_mem);\n\t}\n\n#ifdef HAVE_ALPS_CRAY\n\t/* This is only used for Cray emulation mode where slurmd is used to\n\t * launch job steps. On a real Cray system, ALPS is used to launch\n\t * the tasks instead of SLURM. SLURM's task launch RPC does NOT\n\t * contain the reservation ID, so just use some non-zero value here\n\t * for testing purposes. */\n\tjob->resv_id = 1;\n\tselect_g_select_jobinfo_set(msg->select_jobinfo, SELECT_JOBDATA_RESV_ID,\n\t\t\t\t    &job->resv_id);\n#endif\n\n\tget_cred_gres(msg->cred, conf->node_name,\n\t\t      &job->job_gres_list, &job->step_gres_list);\n\n\tlist_append(job->sruns, (void *) srun);\n\n\t_job_init_task_info(job, msg->global_task_ids,\n\t\t\t    msg->ifname, msg->ofname, msg->efname);\n\n\treturn job;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _job_init_task_info(stepd_step_rec_t *job, uint32_t **gtid,\n\t\t\t\tchar *ifname, char *ofname, char *efname);",
            "static void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nstatic void _job_init_task_info(stepd_step_rec_t *job, uint32_t **gtid,\n\t\t\t\tchar *ifname, char *ofname, char *efname);\nstatic void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);\n\nextern stepd_step_rec_t *\nstepd_step_rec_create(launch_tasks_request_msg_t *msg, uint16_t protocol_version)\n{\n\tstepd_step_rec_t  *job = NULL;\n\tsrun_info_t   *srun = NULL;\n\tslurm_addr_t     resp_addr;\n\tslurm_addr_t     io_addr;\n\tint            i, nodeid = NO_VAL;\n\n\txassert(msg != NULL);\n\txassert(msg->complete_nodelist != NULL);\n\tdebug3(\"entering stepd_step_rec_create\");\n\n\tif (!slurm_valid_uid_gid((uid_t)msg->uid, &(msg->gid),\n\t\t\t\t &(msg->user_name), already_validated_uid, 1))\n\t\treturn NULL;\n\n\tif (acct_gather_check_acct_freq_task(msg->job_mem_lim, msg->acctg_freq))\n\t\treturn NULL;\n\n\tjob = xmalloc(sizeof(stepd_step_rec_t));\n\tjob->msg = msg;\n#ifndef HAVE_FRONT_END\n\tnodeid = nodelist_find(msg->complete_nodelist, conf->node_name);\n\tjob->node_name = xstrdup(conf->node_name);\n#else\n\tnodeid = 0;\n\tjob->node_name = xstrdup(msg->complete_nodelist);\n#endif\n\tif (nodeid < 0) {\n\t\terror(\"couldn't find node %s in %s\",\n\t\t      job->node_name, msg->complete_nodelist);\n\t\tstepd_step_rec_destroy(job);\n\t\treturn NULL;\n\t}\n\n\tjob->state = SLURMSTEPD_STEP_STARTING;\n\tpthread_cond_init(&job->state_cond, NULL);\n\tpthread_mutex_init(&job->state_mutex, NULL);\n\tjob->node_tasks\t= msg->tasks_to_launch[nodeid];\n\ti = sizeof(uint16_t) * msg->nnodes;\n\tjob->task_cnts  = xmalloc(i);\n\tmemcpy(job->task_cnts, msg->tasks_to_launch, i);\n\tjob->ntasks\t= msg->ntasks;\n\tjob->jobid\t= msg->job_id;\n\tjob->stepid\t= msg->job_step_id;\n\n\tjob->uid\t= (uid_t) msg->uid;\n\tjob->user_name  = xstrdup(msg->user_name);\n\tjob->gid\t= (gid_t) msg->gid;\n\tjob->cwd\t= xstrdup(msg->cwd);\n\tjob->task_dist\t= msg->task_dist;\n\n\tjob->cpu_bind_type = msg->cpu_bind_type;\n\tjob->cpu_bind = xstrdup(msg->cpu_bind);\n\tjob->mem_bind_type = msg->mem_bind_type;\n\tjob->mem_bind = xstrdup(msg->mem_bind);\n\tjob->cpu_freq_min = msg->cpu_freq_min;\n\tjob->cpu_freq_max = msg->cpu_freq_max;\n\tjob->cpu_freq_gov = msg->cpu_freq_gov;\n\tjob->ckpt_dir = xstrdup(msg->ckpt_dir);\n\tjob->restart_dir = xstrdup(msg->restart_dir);\n\tjob->cpus_per_task = msg->cpus_per_task;\n\n\tjob->env     = _array_copy(msg->envc, msg->env);\n\tjob->array_job_id  = msg->job_id;\n\tjob->array_task_id = NO_VAL;\n\tfor (i = 0; i < msg->envc; i++) {\n\t\t/*                         1234567890123456789 */\n\t\tif (!xstrncmp(msg->env[i], \"SLURM_ARRAY_JOB_ID=\", 19))\n\t\t\tjob->array_job_id = atoi(msg->env[i] + 19);\n\t\t/*                         12345678901234567890 */\n\t\tif (!xstrncmp(msg->env[i], \"SLURM_ARRAY_TASK_ID=\", 20))\n\t\t\tjob->array_task_id = atoi(msg->env[i] + 20);\n\t}\n\n\tjob->eio     = eio_handle_create(0);\n\tjob->sruns   = list_create((ListDelF) _srun_info_destructor);\n\n\t/* Based on my testing the next 3 lists here could use the\n\t * eio_obj_destroy, but if you do you can get an invalid read.  Since\n\t * these stay until the end of the job it isn't that big of a deal.\n\t */\n\tjob->clients = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->stdout_eio_objs = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->stderr_eio_objs = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->free_incoming = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->incoming_count = 0;\n\tjob->free_outgoing = list_create(NULL); /* FIXME! Needs destructor */\n\tjob->outgoing_count = 0;\n\tjob->outgoing_cache = list_create(NULL); /* FIXME! Needs destructor */\n\n\tjob->envtp   = xmalloc(sizeof(env_t));\n\tjob->envtp->jobid = -1;\n\tjob->envtp->stepid = -1;\n\tjob->envtp->procid = -1;\n\tjob->envtp->localid = -1;\n\tjob->envtp->nodeid = -1;\n\n\tjob->envtp->distribution = 0;\n\tjob->envtp->cpu_bind_type = 0;\n\tjob->envtp->cpu_bind = NULL;\n\tjob->envtp->mem_bind_type = 0;\n\tjob->envtp->mem_bind = NULL;\n\tjob->envtp->ckpt_dir = NULL;\n\tif (!msg->resp_port)\n\t\tmsg->num_resp_port = 0;\n\tif (msg->num_resp_port) {\n\t\tjob->envtp->comm_port =\n\t\t\tmsg->resp_port[nodeid % msg->num_resp_port];\n\t\tmemcpy(&resp_addr, &msg->orig_addr, sizeof(slurm_addr_t));\n\t\tslurm_set_addr(&resp_addr,\n\t\t\t       msg->resp_port[nodeid % msg->num_resp_port],\n\t\t\t       NULL);\n\t} else {\n\t\tmemset(&resp_addr, 0, sizeof(slurm_addr_t));\n\t}\n\tjob->user_managed_io = msg->user_managed_io;\n\tif (!msg->io_port)\n\t\tmsg->user_managed_io = 1;\n\tif (!msg->user_managed_io) {\n\t\tmemcpy(&io_addr,   &msg->orig_addr, sizeof(slurm_addr_t));\n\t\tslurm_set_addr(&io_addr,\n\t\t\t       msg->io_port[nodeid % msg->num_io_port],\n\t\t\t       NULL);\n\t} else {\n\t\tmemset(&io_addr, 0, sizeof(slurm_addr_t));\n\t}\n\n\tsrun = srun_info_create(msg->cred, &resp_addr, &io_addr,\n\t\t\t\tprotocol_version);\n\n\tjob->buffered_stdio = msg->buffered_stdio;\n\tjob->labelio = msg->labelio;\n\n\tjob->profile     = msg->profile;\n\tjob->task_prolog = xstrdup(msg->task_prolog);\n\tjob->task_epilog = xstrdup(msg->task_epilog);\n\n\tjob->argc    = msg->argc;\n\tjob->argv    = _array_copy(job->argc, msg->argv);\n\n\tjob->nnodes  = msg->nnodes;\n\tjob->nodeid  = nodeid;\n\tjob->debug   = msg->slurmd_debug;\n\tjob->cpus    = msg->node_cpus;\n\tjob->job_core_spec = msg->job_core_spec;\n\n\t/* This needs to happen before acct_gather_profile_startpoll\n\t   and only really looks at the profile in the job.\n\t*/\n\tacct_gather_profile_g_node_step_start(job);\n\n\tacct_gather_profile_startpoll(msg->acctg_freq,\n\t\t\t\t      conf->job_acct_gather_freq);\n\n\tjob->multi_prog  = msg->multi_prog;\n\tjob->timelimit   = (time_t) -1;\n\tjob->task_flags  = msg->task_flags;\n\tjob->switch_job  = msg->switch_job;\n\tjob->pty         = msg->pty;\n\tjob->open_mode   = msg->open_mode;\n\tjob->options     = msg->options;\n\tformat_core_allocs(msg->cred, conf->node_name, conf->cpus,\n\t\t\t   &job->job_alloc_cores, &job->step_alloc_cores,\n\t\t\t   &job->job_mem, &job->step_mem);\n\n\t/* If users have configured MemLimitEnforce=no\n\t * in their slurm.conf keep going.\n\t */\n\tif (job->step_mem\n\t    && conf->mem_limit_enforce) {\n\t\tjobacct_gather_set_mem_limit(job->jobid, job->stepid,\n\t\t\t\t\t     job->step_mem);\n\t} else if (job->job_mem\n\t\t   && conf->mem_limit_enforce) {\n\t\tjobacct_gather_set_mem_limit(job->jobid, job->stepid,\n\t\t\t\t\t     job->job_mem);\n\t}\n\n#ifdef HAVE_ALPS_CRAY\n\t/* This is only used for Cray emulation mode where slurmd is used to\n\t * launch job steps. On a real Cray system, ALPS is used to launch\n\t * the tasks instead of SLURM. SLURM's task launch RPC does NOT\n\t * contain the reservation ID, so just use some non-zero value here\n\t * for testing purposes. */\n\tjob->resv_id = 1;\n\tselect_g_select_jobinfo_set(msg->select_jobinfo, SELECT_JOBDATA_RESV_ID,\n\t\t\t\t    &job->resv_id);\n#endif\n\n\tget_cred_gres(msg->cred, conf->node_name,\n\t\t      &job->job_gres_list, &job->step_gres_list);\n\n\tlist_append(job->sruns, (void *) srun);\n\n\t_job_init_task_info(job, msg->global_task_ids,\n\t\t\t    msg->ifname, msg->ofname, msg->efname);\n\n\treturn job;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void _send_launch_failure(launch_tasks_request_msg_t *,\n\t\t\t\t slurm_addr_t *, int, uint16_t);\nstatic int  _drain_node(char *reason);\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nextern stepd_step_rec_t *\nmgr_launch_tasks_setup(launch_tasks_request_msg_t *msg, slurm_addr_t *cli,\n\t\t       slurm_addr_t *self, uint16_t protocol_version)\n{\n\tstepd_step_rec_t *job = NULL;\n\n\tif (!(job = stepd_step_rec_create(msg, protocol_version))) {\n\t\t/* We want to send back to the slurmd the reason we\n\t\t   failed so keep track of it since errno could be\n\t\t   reset in _send_launch_failure.\n\t\t*/\n\t\tint fail = errno;\n\t\t_send_launch_failure(msg, cli, errno, protocol_version);\n\t\terrno = fail;\n\t\treturn NULL;\n\t}\n\n\t_set_job_log_prefix(job);\n\n\t_setargs(job);\n\n\tjob->envtp->cli = cli;\n\tjob->envtp->self = self;\n\tjob->envtp->select_jobinfo = msg->select_jobinfo;\n\tjob->accel_bind_type = msg->accel_bind_type;\n\n\treturn job;\n}"
  }
]