[
  {
    "function_name": "mpmd_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
    "lines": "512-534",
    "snippet": "extern void mpmd_free(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tif (!job->mpmd_set)\n\t\treturn;\n\n\tif (job->mpmd_set->args) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->args[i]);\n\t\txfree(job->mpmd_set->args);\n\t}\n\tif (job->mpmd_set->command) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->command[i]);\n\t\txfree(job->mpmd_set->command);\n\t}\n\txfree(job->mpmd_set->first_pe);\n\txfree(job->mpmd_set->placement);\n\txfree(job->mpmd_set->start_pe);\n\txfree(job->mpmd_set->total_pe);\n\txfree(job->mpmd_set);\n}",
    "includes": [
      "#include \"multi_prog.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/log.h\"",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <ctype.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "job->mpmd_set"
          ],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\nextern void mpmd_free(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tif (!job->mpmd_set)\n\t\treturn;\n\n\tif (job->mpmd_set->args) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->args[i]);\n\t\txfree(job->mpmd_set->args);\n\t}\n\tif (job->mpmd_set->command) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->command[i]);\n\t\txfree(job->mpmd_set->command);\n\t}\n\txfree(job->mpmd_set->first_pe);\n\txfree(job->mpmd_set->placement);\n\txfree(job->mpmd_set->start_pe);\n\txfree(job->mpmd_set->total_pe);\n\txfree(job->mpmd_set);\n}"
  },
  {
    "function_name": "multi_prog_parse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
    "lines": "306-508",
    "snippet": "extern void multi_prog_parse(stepd_step_rec_t *job, uint32_t **gtid)\n{\n\tint i, j, line_num = 0, rank_id, total_ranks = 0;\n\tchar *line = NULL, *local_data = NULL;\n\tchar *end_ptr = NULL, *save_ptr = NULL, *tmp_str;\n\tchar *rank_spec = NULL, *cmd_spec = NULL, *args_spec = NULL;\n\tchar *p = NULL;\n\tchar **tmp_args, **tmp_cmd, *one_rank;\n\tuint32_t *ranks_node_id = NULL;\t/* Node ID for each rank */\n\tuint32_t *node_id2nid = NULL;\t/* Map Slurm node ID to Cray NID name */\n\thostlist_t hl;\n\n\ttmp_args = xmalloc(sizeof(char *) * job->ntasks);\n\ttmp_cmd = xmalloc(sizeof(char *) * job->ntasks);\n\tnode_id2nid = xmalloc(sizeof(uint32_t) * job->nnodes);\n\tranks_node_id = xmalloc(sizeof(uint32_t) * job->ntasks);\n\tlocal_data = xstrdup(job->argv[1]);\n\twhile (1) {\n\t\tif (line_num)\n\t\t\tline = strtok_r(NULL, \"\\n\", &save_ptr);\n\t\telse\n\t\t\tline = strtok_r(local_data, \"\\n\", &save_ptr);\n\t\tif (!line)\n\t\t\tbreak;\n\t\tline_num++;\n\n\t\tp = line;\n\t\twhile ((*p != '\\0') && isspace(*p)) /* remove leading spaces */\n\t\t\tp++;\n\t\tif (*p == '#')\t/* only whole-line comments handled */\n\t\t\tcontinue;\n\t\tif (*p == '\\0') /* blank line ignored */\n\t\t\tcontinue;\n\n\t\trank_spec = p;\t/* Rank specification for this line */\n\t\twhile ((*p != '\\0') && !isspace(*p))\n\t\t\tp++;\n\t\tif (*p == '\\0')\n\t\t\tgoto fail;\n\t\t*p++ = '\\0';\n\n\t\twhile ((*p != '\\0') && isspace(*p)) /* remove leading spaces */\n\t\t\tp++;\n\t\tif (*p == '\\0') /* blank line ignored */\n\t\t\tcontinue;\n\n\t\tcmd_spec = p;\t/* command only */\n\t\twhile ((*p != '\\0') && !isspace(*p))\n\t\t\tp++;\n\t\tif (isspace(*p))\n\t\t\t*p++ = '\\0';\n\n\t\twhile ((*p != '\\0') && isspace(*p)) /* remove leading spaces */\n\t\t\tp++;\n\t\tif (*p == '\\0')\n\t\t\targs_spec = NULL;\t/* no arguments */\n\t\telse\n\t\t\targs_spec = p;\t\t/* arguments string */\n\n\t\ttmp_str = xmalloc(strlen(rank_spec) + 3);\n\t\tsprintf(tmp_str, \"[%s]\", rank_spec);\n\t\thl = hostlist_create(tmp_str);\n\t\txfree(tmp_str);\n\t\tif (!hl)\n\t\t\tgoto fail;\n\t\twhile ((one_rank = hostlist_pop(hl))) {\n\t\t\trank_id = strtol(one_rank, &end_ptr, 10);\n\t\t\tif ((end_ptr[0] != '\\0') || (rank_id < 0) ||\n\t\t\t    (rank_id >= job->ntasks)) {\n\t\t\t\tfree(one_rank);\n\t\t\t\thostlist_destroy(hl);\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tfree(one_rank);\n\t\t\tif (tmp_args[rank_id])\t/* duplicate record for rank */\n\t\t\t\txfree(tmp_args[rank_id]);\n\t\t\tif (tmp_cmd[rank_id])\t/* duplicate record for rank */\n\t\t\t\txfree(tmp_cmd[rank_id]);\n\t\t\telse\n\t\t\t\ttotal_ranks++;\n\t\t\ttmp_args[rank_id] = xstrdup(args_spec);\n\t\t\ttmp_cmd[rank_id] = xstrdup(cmd_spec);\n\t\t}\n\t\thostlist_destroy(hl);\n\t}\n\tif (total_ranks != job->ntasks)\n\t\tgoto fail;\n\n\tif (job->msg->complete_nodelist &&\n\t    ((hl = hostlist_create(job->msg->complete_nodelist)))) {\n\t\ti = 0;\n\t\twhile ((one_rank = hostlist_shift(hl))) {\n\t\t\tif (i >= job->nnodes) {\n\t\t\t\terror(\"MPMD more nodes in nodelist than count \"\n\t\t\t\t      \"(cnt:%u nodelist:%s)\", job->nnodes,\n\t\t\t\t      job->msg->complete_nodelist);\n\t\t\t}\n\t\t\tfor (j = 0; one_rank[j] && !isdigit(one_rank[j]); j++)\n\t\t\t\t;\n\t\t\tnode_id2nid[i++] = strtol(one_rank + j, &end_ptr, 10);\n\t\t\tfree(one_rank);\n\t\t}\n\t\thostlist_destroy(hl);\n\t}\n\n\tfor (i = 0; i < job->nnodes; i++) {\n\t\tif (!job->task_cnts) {\n\t\t\terror(\"MPMD job->task_cnts is NULL\");\n\t\t\tbreak;\n\t\t}\n\t\tif (!job->task_cnts[i]) {\n\t\t\terror(\"MPMD job->task_cnts[%d] is NULL\", i);\n\t\t\tbreak;\n\t\t}\n\t\tif (!gtid) {\n\t\t\terror(\"MPMD gtid is NULL\");\n\t\t\tbreak;\n\t\t}\n\t\tif (!gtid[i]) {\n\t\t\terror(\"MPMD gtid[%d] is NULL\", i);\n\t\t\tbreak;\n\t\t}\n\t\tfor (j = 0; j < job->task_cnts[i]; j++) {\n\t\t\tif (gtid[i][j] >= job->ntasks) {\n\t\t\t\terror(\"MPMD gtid[%d][%d] is invalid (%u >= %u)\",\n\t\t\t\t      i, j, gtid[i][j], job->ntasks);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tranks_node_id[gtid[i][j]] = i;\n\t\t}\n\t}\n\n\tjob->mpmd_set = xmalloc(sizeof(mpmd_set_t));\n\tjob->mpmd_set->apid      = SLURM_ID_HASH(job->jobid, job->stepid);\n\tjob->mpmd_set->args      = xmalloc(sizeof(char *) * job->ntasks);\n\tjob->mpmd_set->command   = xmalloc(sizeof(char *) * job->ntasks);\n\tjob->mpmd_set->first_pe  = xmalloc(sizeof(int) * job->ntasks);\n\tjob->mpmd_set->start_pe  = xmalloc(sizeof(int) * job->ntasks);\n\tjob->mpmd_set->total_pe  = xmalloc(sizeof(int) * job->ntasks);\n\tjob->mpmd_set->placement = xmalloc(sizeof(int) * job->ntasks);\n\tfor (i = 0, j = 0; i < job->ntasks; i++) {\n\t\tjob->mpmd_set->placement[i] = node_id2nid[ranks_node_id[i]];\n\t\tif (i == 0) {\n\t\t\tjob->mpmd_set->num_cmds++;\n\t\t\tif (ranks_node_id[i] == job->nodeid)\n\t\t\t\tjob->mpmd_set->first_pe[j] = i;\n\t\t\telse\n\t\t\t\tjob->mpmd_set->first_pe[j] = -1;\n\t\t\tjob->mpmd_set->args[j] = xstrdup(tmp_args[i]);\n\t\t\tjob->mpmd_set->command[j] = xstrdup(tmp_cmd[i]);\n\t\t\tjob->mpmd_set->start_pe[j] = i;\n\t\t\tjob->mpmd_set->total_pe[j]++;\n\t\t} else if (!xstrcmp(tmp_cmd[i-1],  tmp_cmd[i]) &&\n\t\t\t   !xstrcmp(tmp_args[i-1], tmp_args[i]) &&\n\t\t\t   !xstrchr(tmp_args[i-1], '%')) {\n\t\t\tif ((ranks_node_id[i] == job->nodeid) &&\n\t\t\t    (job->mpmd_set->first_pe[j] == -1))\n\t\t\t\tjob->mpmd_set->first_pe[j] = i;\n\t\t\tjob->mpmd_set->total_pe[j]++;\n\t\t} else {\n\t\t\tj++;\n\t\t\tif (ranks_node_id[i] == job->nodeid)\n\t\t\t\tjob->mpmd_set->first_pe[j] = i;\n\t\t\telse\n\t\t\t\tjob->mpmd_set->first_pe[j] = -1;\n\t\t\tjob->mpmd_set->num_cmds++;\n\t\t\tjob->mpmd_set->args[j] = xstrdup(tmp_args[i]);\n\t\t\tjob->mpmd_set->command[j] = xstrdup(tmp_cmd[i]);\n\t\t\tjob->mpmd_set->start_pe[j] = i;\n\t\t\tjob->mpmd_set->total_pe[j]++;\n\t\t}\n\t}\n#if _DEBUG\n\tinfo(\"MPMD Apid:%\"PRIu64\"\", job->mpmd_set->apid);\n\tinfo(\"MPMD NumPEs:%u\", job->ntasks);\t\t/* Total rank count */\n\tinfo(\"MPMD NumPEsHere:%u\", job->node_tasks);\t/* Node's rank count */\n\tinfo(\"MPMD NumCmds:%d\", job->mpmd_set->num_cmds);\n\tfor (i = 0; i < job->mpmd_set->num_cmds; i++) {\n\t\tinfo(\"MPMD Cmd:%s Args:%s FirstPE:%d StartPE:%d TotalPEs:%d \",\n\t\t     job->mpmd_set->command[i],  job->mpmd_set->args[i],\n\t\t     job->mpmd_set->first_pe[i], job->mpmd_set->start_pe[i],\n\t\t     job->mpmd_set->total_pe[i]);\n\t}\n\tfor (i = 0; i < job->ntasks; i++) {\n\t\tinfo(\"MPMD Placement[%d]:nid%5.5d\",\n\t\t     i, job->mpmd_set->placement[i]);\n\t}\n#endif\n\nfini:\tfor (i = 0; i < job->ntasks; i++) {\n\t\txfree(tmp_args[i]);\n\t\txfree(tmp_cmd[i]);\n\t}\n\txfree(tmp_args);\n\txfree(tmp_cmd);\n\txfree(local_data);\n\txfree(node_id2nid);\n\txfree(ranks_node_id);\n\treturn;\n\nfail:\terror(\"Invalid MPMD configuration line %d\", line_num);\n\tgoto fini;\n}",
    "includes": [
      "#include \"multi_prog.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/log.h\"",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <ctype.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [
      "#define _DEBUG   0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid MPMD configuration line %d\"",
            "line_num"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "ranks_node_id"
          ],
          "line": 503
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"MPMD Placement[%d]:nid%5.5d\"",
            "i",
            "job->mpmd_set->placement[i]"
          ],
          "line": 490
        },
        "resolved": true,
        "details": {
          "function_name": "_chk_cpuinfo_float",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/get_mach_stat.c",
          "lines": "414-423",
          "snippet": "static int _chk_cpuinfo_float(char *buffer, char *keyword, float *val)\n{\n\tchar *valptr;\n\tif (_chk_cpuinfo_str(buffer, keyword, &valptr)) {\n\t\t*val = (float) strtod(valptr, (char **)NULL);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmctld/slurmctld.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include <unistd.h>",
            "# include <kstat.h>",
            "#  include <sys/vfs.h>",
            "#  include <sys/statfs.h>",
            "#  include <sys/statvfs.h>",
            "#include <sys/utsname.h>",
            "#  include <sys/sysinfo.h>",
            "#  include <sys/times.h> /* for times(3) */",
            "#  include <sys/types.h>",
            "#  include <sys/times.h>",
            "#include <syslog.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <errno.h>",
            "# include <sys/sysctl.h>",
            "#include <sys/types.h>",
            "# include <sys/dr.h>",
            "# include <sys/systemcfg.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmctld/slurmctld.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include <unistd.h>\n# include <kstat.h>\n#  include <sys/vfs.h>\n#  include <sys/statfs.h>\n#  include <sys/statvfs.h>\n#include <sys/utsname.h>\n#  include <sys/sysinfo.h>\n#  include <sys/times.h> /* for times(3) */\n#  include <sys/types.h>\n#  include <sys/times.h>\n#include <syslog.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <errno.h>\n# include <sys/sysctl.h>\n#include <sys/types.h>\n# include <sys/dr.h>\n# include <sys/systemcfg.h>\n#  include \"config.h\"\n\nstatic int _chk_cpuinfo_float(char *buffer, char *keyword, float *val)\n{\n\tchar *valptr;\n\tif (_chk_cpuinfo_str(buffer, keyword, &valptr)) {\n\t\t*val = (float) strtod(valptr, (char **)NULL);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"MPMD Cmd:%s Args:%s FirstPE:%d StartPE:%d TotalPEs:%d \"",
            "job->mpmd_set->command[i]",
            "job->mpmd_set->args[i]",
            "job->mpmd_set->first_pe[i]",
            "job->mpmd_set->start_pe[i]",
            "job->mpmd_set->total_pe[i]"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"MPMD NumCmds:%d\"",
            "job->mpmd_set->num_cmds"
          ],
          "line": 482
        },
        "resolved": true,
        "details": {
          "function_name": "_task_info_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "222-232",
          "snippet": "static void\n_task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog)\n{\n\tslurm_mutex_lock(&t->mutex);\n\tslurm_mutex_unlock(&t->mutex);\n\tslurm_mutex_destroy(&t->mutex);\n\tif (multi_prog) {\n\t\txfree(t->argv);\n\t} /* otherwise, t->argv is a pointer to job->argv */\n\txfree(t);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nstatic void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);\n\nstatic void\n_task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog)\n{\n\tslurm_mutex_lock(&t->mutex);\n\tslurm_mutex_unlock(&t->mutex);\n\tslurm_mutex_destroy(&t->mutex);\n\tif (multi_prog) {\n\t\txfree(t->argv);\n\t} /* otherwise, t->argv is a pointer to job->argv */\n\txfree(t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "tmp_cmd[i]"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "tmp_args[i]"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrchr",
          "args": [
            "tmp_args[i-1]",
            "'%'"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrcmp",
          "args": [
            "tmp_args[i-1]",
            "tmp_args[i]"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrcmp",
          "args": [
            "tmp_cmd[i-1]",
            "tmp_cmd[i]"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "tmp_cmd[i]"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "tmp_args[i]"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(int) * job->ntasks"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(int) * job->ntasks"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(int) * job->ntasks"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(int) * job->ntasks"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(char *) * job->ntasks"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(char *) * job->ntasks"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SLURM_ID_HASH",
          "args": [
            "job->jobid",
            "job->stepid"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(mpmd_set_t)"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"MPMD gtid[%d][%d] is invalid (%u >= %u)\"",
            "i",
            "j",
            "gtid[i][j]",
            "job->ntasks"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"MPMD gtid is NULL\""
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"MPMD job->task_cnts is NULL\""
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_destroy",
          "args": [
            "hl"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "one_rank"
          ],
          "line": 406
        },
        "resolved": true,
        "details": {
          "function_name": "mpmd_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
          "lines": "512-534",
          "snippet": "extern void mpmd_free(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tif (!job->mpmd_set)\n\t\treturn;\n\n\tif (job->mpmd_set->args) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->args[i]);\n\t\txfree(job->mpmd_set->args);\n\t}\n\tif (job->mpmd_set->command) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->command[i]);\n\t\txfree(job->mpmd_set->command);\n\t}\n\txfree(job->mpmd_set->first_pe);\n\txfree(job->mpmd_set->placement);\n\txfree(job->mpmd_set->start_pe);\n\txfree(job->mpmd_set->total_pe);\n\txfree(job->mpmd_set);\n}",
          "includes": [
            "#include \"multi_prog.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/log.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\nextern void mpmd_free(stepd_step_rec_t *job)\n{\n\tint i;\n\n\tif (!job->mpmd_set)\n\t\treturn;\n\n\tif (job->mpmd_set->args) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->args[i]);\n\t\txfree(job->mpmd_set->args);\n\t}\n\tif (job->mpmd_set->command) {\n\t\tfor (i = 0; i < job->ntasks; i++)\n\t\t\txfree(job->mpmd_set->command[i]);\n\t\txfree(job->mpmd_set->command);\n\t}\n\txfree(job->mpmd_set->first_pe);\n\txfree(job->mpmd_set->placement);\n\txfree(job->mpmd_set->start_pe);\n\txfree(job->mpmd_set->total_pe);\n\txfree(job->mpmd_set);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "one_rank + j",
            "&end_ptr",
            "10"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isdigit",
          "args": [
            "one_rank[j]"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"MPMD more nodes in nodelist than count \"\n\t\t\t\t      \"(cnt:%u nodelist:%s)\"",
            "job->nnodes",
            "job->msg->complete_nodelist"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_shift",
          "args": [
            "hl"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_create",
          "args": [
            "job->msg->complete_nodelist"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_destroy",
          "args": [
            "hl"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "cmd_spec"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "args_spec"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_destroy",
          "args": [
            "hl"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "one_rank",
            "&end_ptr",
            "10"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_pop",
          "args": [
            "hl"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hostlist_create",
          "args": [
            "tmp_str"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "tmp_str",
            "\"[%s]\"",
            "rank_spec"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "strlen(rank_spec) + 3"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "rank_spec"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "local_data",
            "\"\\n\"",
            "&save_ptr"
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\"\\n\"",
            "&save_ptr"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "job->argv[1]"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(uint32_t) * job->ntasks"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(uint32_t) * job->nnodes"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(char *) * job->ntasks"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(char *) * job->ntasks"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\n#define _DEBUG   0\n\nextern void multi_prog_parse(stepd_step_rec_t *job, uint32_t **gtid)\n{\n\tint i, j, line_num = 0, rank_id, total_ranks = 0;\n\tchar *line = NULL, *local_data = NULL;\n\tchar *end_ptr = NULL, *save_ptr = NULL, *tmp_str;\n\tchar *rank_spec = NULL, *cmd_spec = NULL, *args_spec = NULL;\n\tchar *p = NULL;\n\tchar **tmp_args, **tmp_cmd, *one_rank;\n\tuint32_t *ranks_node_id = NULL;\t/* Node ID for each rank */\n\tuint32_t *node_id2nid = NULL;\t/* Map Slurm node ID to Cray NID name */\n\thostlist_t hl;\n\n\ttmp_args = xmalloc(sizeof(char *) * job->ntasks);\n\ttmp_cmd = xmalloc(sizeof(char *) * job->ntasks);\n\tnode_id2nid = xmalloc(sizeof(uint32_t) * job->nnodes);\n\tranks_node_id = xmalloc(sizeof(uint32_t) * job->ntasks);\n\tlocal_data = xstrdup(job->argv[1]);\n\twhile (1) {\n\t\tif (line_num)\n\t\t\tline = strtok_r(NULL, \"\\n\", &save_ptr);\n\t\telse\n\t\t\tline = strtok_r(local_data, \"\\n\", &save_ptr);\n\t\tif (!line)\n\t\t\tbreak;\n\t\tline_num++;\n\n\t\tp = line;\n\t\twhile ((*p != '\\0') && isspace(*p)) /* remove leading spaces */\n\t\t\tp++;\n\t\tif (*p == '#')\t/* only whole-line comments handled */\n\t\t\tcontinue;\n\t\tif (*p == '\\0') /* blank line ignored */\n\t\t\tcontinue;\n\n\t\trank_spec = p;\t/* Rank specification for this line */\n\t\twhile ((*p != '\\0') && !isspace(*p))\n\t\t\tp++;\n\t\tif (*p == '\\0')\n\t\t\tgoto fail;\n\t\t*p++ = '\\0';\n\n\t\twhile ((*p != '\\0') && isspace(*p)) /* remove leading spaces */\n\t\t\tp++;\n\t\tif (*p == '\\0') /* blank line ignored */\n\t\t\tcontinue;\n\n\t\tcmd_spec = p;\t/* command only */\n\t\twhile ((*p != '\\0') && !isspace(*p))\n\t\t\tp++;\n\t\tif (isspace(*p))\n\t\t\t*p++ = '\\0';\n\n\t\twhile ((*p != '\\0') && isspace(*p)) /* remove leading spaces */\n\t\t\tp++;\n\t\tif (*p == '\\0')\n\t\t\targs_spec = NULL;\t/* no arguments */\n\t\telse\n\t\t\targs_spec = p;\t\t/* arguments string */\n\n\t\ttmp_str = xmalloc(strlen(rank_spec) + 3);\n\t\tsprintf(tmp_str, \"[%s]\", rank_spec);\n\t\thl = hostlist_create(tmp_str);\n\t\txfree(tmp_str);\n\t\tif (!hl)\n\t\t\tgoto fail;\n\t\twhile ((one_rank = hostlist_pop(hl))) {\n\t\t\trank_id = strtol(one_rank, &end_ptr, 10);\n\t\t\tif ((end_ptr[0] != '\\0') || (rank_id < 0) ||\n\t\t\t    (rank_id >= job->ntasks)) {\n\t\t\t\tfree(one_rank);\n\t\t\t\thostlist_destroy(hl);\n\t\t\t\tgoto fail;\n\t\t\t}\n\t\t\tfree(one_rank);\n\t\t\tif (tmp_args[rank_id])\t/* duplicate record for rank */\n\t\t\t\txfree(tmp_args[rank_id]);\n\t\t\tif (tmp_cmd[rank_id])\t/* duplicate record for rank */\n\t\t\t\txfree(tmp_cmd[rank_id]);\n\t\t\telse\n\t\t\t\ttotal_ranks++;\n\t\t\ttmp_args[rank_id] = xstrdup(args_spec);\n\t\t\ttmp_cmd[rank_id] = xstrdup(cmd_spec);\n\t\t}\n\t\thostlist_destroy(hl);\n\t}\n\tif (total_ranks != job->ntasks)\n\t\tgoto fail;\n\n\tif (job->msg->complete_nodelist &&\n\t    ((hl = hostlist_create(job->msg->complete_nodelist)))) {\n\t\ti = 0;\n\t\twhile ((one_rank = hostlist_shift(hl))) {\n\t\t\tif (i >= job->nnodes) {\n\t\t\t\terror(\"MPMD more nodes in nodelist than count \"\n\t\t\t\t      \"(cnt:%u nodelist:%s)\", job->nnodes,\n\t\t\t\t      job->msg->complete_nodelist);\n\t\t\t}\n\t\t\tfor (j = 0; one_rank[j] && !isdigit(one_rank[j]); j++)\n\t\t\t\t;\n\t\t\tnode_id2nid[i++] = strtol(one_rank + j, &end_ptr, 10);\n\t\t\tfree(one_rank);\n\t\t}\n\t\thostlist_destroy(hl);\n\t}\n\n\tfor (i = 0; i < job->nnodes; i++) {\n\t\tif (!job->task_cnts) {\n\t\t\terror(\"MPMD job->task_cnts is NULL\");\n\t\t\tbreak;\n\t\t}\n\t\tif (!job->task_cnts[i]) {\n\t\t\terror(\"MPMD job->task_cnts[%d] is NULL\", i);\n\t\t\tbreak;\n\t\t}\n\t\tif (!gtid) {\n\t\t\terror(\"MPMD gtid is NULL\");\n\t\t\tbreak;\n\t\t}\n\t\tif (!gtid[i]) {\n\t\t\terror(\"MPMD gtid[%d] is NULL\", i);\n\t\t\tbreak;\n\t\t}\n\t\tfor (j = 0; j < job->task_cnts[i]; j++) {\n\t\t\tif (gtid[i][j] >= job->ntasks) {\n\t\t\t\terror(\"MPMD gtid[%d][%d] is invalid (%u >= %u)\",\n\t\t\t\t      i, j, gtid[i][j], job->ntasks);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tranks_node_id[gtid[i][j]] = i;\n\t\t}\n\t}\n\n\tjob->mpmd_set = xmalloc(sizeof(mpmd_set_t));\n\tjob->mpmd_set->apid      = SLURM_ID_HASH(job->jobid, job->stepid);\n\tjob->mpmd_set->args      = xmalloc(sizeof(char *) * job->ntasks);\n\tjob->mpmd_set->command   = xmalloc(sizeof(char *) * job->ntasks);\n\tjob->mpmd_set->first_pe  = xmalloc(sizeof(int) * job->ntasks);\n\tjob->mpmd_set->start_pe  = xmalloc(sizeof(int) * job->ntasks);\n\tjob->mpmd_set->total_pe  = xmalloc(sizeof(int) * job->ntasks);\n\tjob->mpmd_set->placement = xmalloc(sizeof(int) * job->ntasks);\n\tfor (i = 0, j = 0; i < job->ntasks; i++) {\n\t\tjob->mpmd_set->placement[i] = node_id2nid[ranks_node_id[i]];\n\t\tif (i == 0) {\n\t\t\tjob->mpmd_set->num_cmds++;\n\t\t\tif (ranks_node_id[i] == job->nodeid)\n\t\t\t\tjob->mpmd_set->first_pe[j] = i;\n\t\t\telse\n\t\t\t\tjob->mpmd_set->first_pe[j] = -1;\n\t\t\tjob->mpmd_set->args[j] = xstrdup(tmp_args[i]);\n\t\t\tjob->mpmd_set->command[j] = xstrdup(tmp_cmd[i]);\n\t\t\tjob->mpmd_set->start_pe[j] = i;\n\t\t\tjob->mpmd_set->total_pe[j]++;\n\t\t} else if (!xstrcmp(tmp_cmd[i-1],  tmp_cmd[i]) &&\n\t\t\t   !xstrcmp(tmp_args[i-1], tmp_args[i]) &&\n\t\t\t   !xstrchr(tmp_args[i-1], '%')) {\n\t\t\tif ((ranks_node_id[i] == job->nodeid) &&\n\t\t\t    (job->mpmd_set->first_pe[j] == -1))\n\t\t\t\tjob->mpmd_set->first_pe[j] = i;\n\t\t\tjob->mpmd_set->total_pe[j]++;\n\t\t} else {\n\t\t\tj++;\n\t\t\tif (ranks_node_id[i] == job->nodeid)\n\t\t\t\tjob->mpmd_set->first_pe[j] = i;\n\t\t\telse\n\t\t\t\tjob->mpmd_set->first_pe[j] = -1;\n\t\t\tjob->mpmd_set->num_cmds++;\n\t\t\tjob->mpmd_set->args[j] = xstrdup(tmp_args[i]);\n\t\t\tjob->mpmd_set->command[j] = xstrdup(tmp_cmd[i]);\n\t\t\tjob->mpmd_set->start_pe[j] = i;\n\t\t\tjob->mpmd_set->total_pe[j]++;\n\t\t}\n\t}\n#if _DEBUG\n\tinfo(\"MPMD Apid:%\"PRIu64\"\", job->mpmd_set->apid);\n\tinfo(\"MPMD NumPEs:%u\", job->ntasks);\t\t/* Total rank count */\n\tinfo(\"MPMD NumPEsHere:%u\", job->node_tasks);\t/* Node's rank count */\n\tinfo(\"MPMD NumCmds:%d\", job->mpmd_set->num_cmds);\n\tfor (i = 0; i < job->mpmd_set->num_cmds; i++) {\n\t\tinfo(\"MPMD Cmd:%s Args:%s FirstPE:%d StartPE:%d TotalPEs:%d \",\n\t\t     job->mpmd_set->command[i],  job->mpmd_set->args[i],\n\t\t     job->mpmd_set->first_pe[i], job->mpmd_set->start_pe[i],\n\t\t     job->mpmd_set->total_pe[i]);\n\t}\n\tfor (i = 0; i < job->ntasks; i++) {\n\t\tinfo(\"MPMD Placement[%d]:nid%5.5d\",\n\t\t     i, job->mpmd_set->placement[i]);\n\t}\n#endif\n\nfini:\tfor (i = 0; i < job->ntasks; i++) {\n\t\txfree(tmp_args[i]);\n\t\txfree(tmp_cmd[i]);\n\t}\n\txfree(tmp_args);\n\txfree(tmp_cmd);\n\txfree(local_data);\n\txfree(node_id2nid);\n\txfree(ranks_node_id);\n\treturn;\n\nfail:\terror(\"Invalid MPMD configuration line %d\", line_num);\n\tgoto fini;\n}"
  },
  {
    "function_name": "multi_prog_get_argv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
    "lines": "145-297",
    "snippet": "extern int multi_prog_get_argv(char *config_data, char **prog_env,\n\t\t\t       int task_rank, uint32_t *argc, char ***argv,\n\t\t\t       int global_argc, char **global_argv)\n{\n\tchar *line = NULL;\n\tint i, line_num = 0;\n\tint task_offset;\n\tchar *p = NULL, *s = NULL, *ptrptr = NULL;\n\tchar *rank_spec = NULL, *args_spec = NULL;\n\tint prog_argc = 0;\n\tchar **prog_argv = NULL;\n\tchar *local_data = NULL;\n\n\tprog_argv = (char **)xmalloc(sizeof(char *) * MAX_ARGC);\n\n\tif (task_rank < 0) {\n\t\terror(\"Invalid task rank %d\", task_rank);\n\t\t*argc = 1;\n\t\t*argv = prog_argv;\n\t\treturn -1;\n\t}\n\n\tlocal_data = xstrdup(config_data);\n\n\tline = strtok_r(local_data, \"\\n\", &ptrptr);\n\twhile (line) {\n\t\tif (line_num > 0)\n\t\t\tline = strtok_r(NULL, \"\\n\", &ptrptr);\n\t\tif (line == NULL) {\n\t\t\terror(\"No executable program specified for this task\");\n\t\t\tgoto fail;\n\t\t}\n\t\tline_num ++;\n\t\tif (strlen (line) >= (BUF_SIZE - 1)) {\n\t\t\terror (\"Line %d of configuration file too long\",\n\t\t\t\tline_num);\n\t\t\tgoto fail;\n\t\t}\n\n\t\tp = line;\n\t\twhile (*p != '\\0' && isspace (*p)) /* remove leading spaces */\n\t\t\tp ++;\n\n\t\tif (*p == '#') /* only whole-line comments handled */\n\t\t\tcontinue;\n\n\t\tif (*p == '\\0') /* blank line ignored */\n\t\t\tcontinue;\n\n\t\trank_spec = p;\n\n\t\twhile (*p != '\\0' && !isspace (*p))\n\t\t\tp ++;\n\t\tif (*p == '\\0') {\n\t\t\terror(\"Invalid MPMD configuration line %d\", line_num);\n\t\t\tgoto fail;\n\t\t}\n\t\t*p ++ = '\\0';\n\n\t\tif (!_in_range (task_rank, rank_spec, &task_offset))\n\t\t\tcontinue;\n\n\t\t/* skip all whitspace after the range spec */\n\t\twhile(*p != '\\0' && isspace (*p))\n\t\t\tp++;\n\n\t\targs_spec = p;\n\t\twhile (*args_spec != '\\0') {\n\t\t\t/* Only simple quote and escape supported */\n\t\t\tprog_argv[prog_argc ++] = args_spec;\n\t\t\tif ((prog_argc + 1) >= MAX_ARGC) {\n\t\t\t\tinfo(\"Exceeded multi-prog argc limit\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\tCONT:\twhile (*args_spec != '\\0' && *args_spec != '\\\\'\n\t\t\t&&     *args_spec != '%'\n\t\t\t&&     *args_spec != '\\'' && !isspace (*args_spec)) {\n\t\t\t\targs_spec ++;\n\t\t\t}\n\t\t\tif (*args_spec == '\\0') {\n\t\t\t\t/* the last argument */\n\t\t\t\tbreak;\n\n\t\t\t} else if (*args_spec == '%') {\n\t\t\t\t_sub_expression(args_spec, task_rank,\n\t\t\t\t\ttask_offset);\n\t\t\t\targs_spec ++;\n\t\t\t\tgoto CONT;\n\n\t\t\t} else if (*args_spec == '\\\\') {\n\t\t\t\t/* escape, just remove the backslash */\n\t\t\t\ts = args_spec ++;\n\t\t\t\tp = args_spec;\n\t\t\t\tdo {\n\t\t\t\t\t*s ++ = *p;\n\t\t\t\t} while (*p ++ != '\\0');\n\t\t\t\tgoto CONT;\n\n\t\t\t} else if (*args_spec == '\\'') {\n\t\t\t\t/* single quote,\n\t\t\t\t * preserve all characters quoted. */\n\t\t\t\tp = args_spec + 1;\n\t\t\t\twhile (*p != '\\0' && *p != '\\'') {\n\t\t\t\t\t/* remove quote */\n\t\t\t\t\t*args_spec ++ = *p ++;\n\t\t\t\t}\n\t\t\t\tif (*p == '\\0') {\n\t\t\t\t\t/* closing quote not found */\n\t\t\t\t\terror(\"Program arguments specification\"\n\t\t\t\t\t\t\" format invalid: %s.\",\n\t\t\t\t\t\tprog_argv[prog_argc -1]);\n\t\t\t\t\tgoto fail;\n\t\t\t\t}\n\t\t\t\tp ++; /* skip closing quote */\n\t\t\t\ts = args_spec;\n\t\t\t\tdo {\n\t\t\t\t\t*s ++ = *p;\n\t\t\t\t} while (*p ++ != '\\0');\n\t\t\t\tgoto CONT;\n\n\t\t\t} else {\n\t\t\t\t/* space */\n\t\t\t\t*args_spec ++ = '\\0';\n\t\t\t\twhile (*args_spec != '\\0'\n\t\t\t\t&& isspace (*args_spec))\n\t\t\t\t\targs_spec ++;\n\t\t\t}\n\n\t\t}\n\n\t\tfor (i = 2; i < global_argc; i++) {\n\t\t\tif ((prog_argc + 1) >= MAX_ARGC) {\n\t\t\t\tinfo(\"Exceeded multi-prog argc limit\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tprog_argv[prog_argc++] = xstrdup(global_argv[i]);\n\t\t}\n\t\tprog_argv[prog_argc] = NULL;\n\n\t\t*argc = prog_argc;\n\t\t*argv = prog_argv;\n\t\t/* FIXME - local_data is leaked */\n\t\treturn 0;\n\t}\n\n\terror(\"Program for task rank %d not specified.\", task_rank);\nfail:\n\txfree(local_data);\n\t*argc = 1;\n\tprog_argv[0] = NULL;\n\t*argv = prog_argv;\n\treturn -1;\n}",
    "includes": [
      "#include \"multi_prog.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/log.h\"",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <ctype.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [
      "#define MAX_ARGC 128"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "local_data"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Program for task rank %d not specified.\"",
            "task_rank"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "global_argv[i]"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"Exceeded multi-prog argc limit\""
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "_fork_child_with_wait_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1464-1486",
          "snippet": "static struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic struct exec_wait_info * _fork_child_with_wait_info (int id)\n{\n\tstruct exec_wait_info *e;\n\n\tif (!(e = _exec_wait_info_create (id)))\n\t\treturn (NULL);\n\n\tif ((e->pid = fork ()) < 0) {\n\t\t_exec_wait_info_destroy (e);\n\t\treturn (NULL);\n\t}\n\t/*\n\t *  Close parentfd in child, and childfd in parent:\n\t */\n\tif (e->pid == 0) {\n\t\tclose (e->parentfd);\n\t\te->parentfd = -1;\n\t} else {\n\t\tclose (e->childfd);\n\t\te->childfd = -1;\n\t}\n\treturn (e);\n}"
        }
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*args_spec"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_sub_expression",
          "args": [
            "args_spec",
            "task_rank",
            "task_offset"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "_sub_expression",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
          "lines": "122-138",
          "snippet": "static void\n_sub_expression(char *args_spec, int task_rank, int task_offset)\n{\n\tchar tmp[BUF_SIZE];\n\n\tif (args_spec[0] == '%') {\n\t\tif (args_spec[1] == 't') {\n\t\t\t/* task rank */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_rank, tmp);\n\t\t} else if (args_spec[1] == 'o') {\n\t\t\t/* task offset */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_offset, tmp);\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"multi_prog.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/log.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\nstatic void\n_sub_expression(char *args_spec, int task_rank, int task_offset)\n{\n\tchar tmp[BUF_SIZE];\n\n\tif (args_spec[0] == '%') {\n\t\tif (args_spec[1] == 't') {\n\t\t\t/* task rank */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_rank, tmp);\n\t\t} else if (args_spec[1] == 'o') {\n\t\t\t/* task offset */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_offset, tmp);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*args_spec"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_in_range",
          "args": [
            "task_rank",
            "rank_spec",
            "&task_offset"
          ],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "_in_range",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
          "lines": "69-119",
          "snippet": "static int\n_in_range(int rank, char* spec, int *offset)\n{\n\tchar* range;\n\tchar* p;\n\tchar* upper;\n\tint high_num, low_num, passed = 0;\n\n\txassert(offset);\n\n\tif (spec[0] == '*' && spec[1] == '\\0') {\n\t\t*offset = rank;\n\t\treturn 1;\n\t}\n\n\tfor (range = strtok (spec, \",\"); range != NULL;\n\t\t\trange = strtok (NULL, \",\")) {\n\t\tp = range;\n\t\twhile (*p != '\\0' && isdigit (*p))\n\t\t\tp ++;\n\t\tif (*p == '\\0') { /* single rank */\n\t\t\tif (rank == atoi (range)) {\n\t\t\t\t*offset = passed;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tpassed ++;\n\n\t\t} else if (*p == '-') { /* lower-upper */\n\t\t\tupper = ++ p;\n\t\t\twhile (isdigit (*p))\n\t\t\t\tp ++;\n\t\t\tif (*p != '\\0') {\n\t\t\t\terror (\"Invalid task range specification (%s) \"\n\t\t\t\t\t\"ignored.\", range);\n\t\t\t\tcontinue;\n\t\t\t};\n\t\t\tlow_num  = atoi (range);\n\t\t\thigh_num = atoi (upper);\n\t\t\tif ((rank >= low_num) && (rank <= high_num)) {\n\t\t\t\t*offset = passed + (rank - low_num);\n\t\t\t\treturn 1;\n\t\t\t} else\n\t\t\t\tpassed += (1 + high_num - low_num);\n\n\t\t} else {\n\t\t\terror (\"Invalid task range specification (%s) ignored.\",\n\t\t\t\trange);\n\t\t}\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include \"multi_prog.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/log.h\"",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\nstatic int\n_in_range(int rank, char* spec, int *offset)\n{\n\tchar* range;\n\tchar* p;\n\tchar* upper;\n\tint high_num, low_num, passed = 0;\n\n\txassert(offset);\n\n\tif (spec[0] == '*' && spec[1] == '\\0') {\n\t\t*offset = rank;\n\t\treturn 1;\n\t}\n\n\tfor (range = strtok (spec, \",\"); range != NULL;\n\t\t\trange = strtok (NULL, \",\")) {\n\t\tp = range;\n\t\twhile (*p != '\\0' && isdigit (*p))\n\t\t\tp ++;\n\t\tif (*p == '\\0') { /* single rank */\n\t\t\tif (rank == atoi (range)) {\n\t\t\t\t*offset = passed;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tpassed ++;\n\n\t\t} else if (*p == '-') { /* lower-upper */\n\t\t\tupper = ++ p;\n\t\t\twhile (isdigit (*p))\n\t\t\t\tp ++;\n\t\t\tif (*p != '\\0') {\n\t\t\t\terror (\"Invalid task range specification (%s) \"\n\t\t\t\t\t\"ignored.\", range);\n\t\t\t\tcontinue;\n\t\t\t};\n\t\t\tlow_num  = atoi (range);\n\t\t\thigh_num = atoi (upper);\n\t\t\tif ((rank >= low_num) && (rank <= high_num)) {\n\t\t\t\t*offset = passed + (rank - low_num);\n\t\t\t\treturn 1;\n\t\t\t} else\n\t\t\t\tpassed += (1 + high_num - low_num);\n\n\t\t} else {\n\t\t\terror (\"Invalid task range specification (%s) ignored.\",\n\t\t\t\trange);\n\t\t}\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*p"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "line"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"No executable program specified for this task\""
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\"\\n\"",
            "&ptrptr"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "local_data",
            "\"\\n\"",
            "&ptrptr"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "config_data"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(char *) * MAX_ARGC"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\n#define MAX_ARGC 128\n\nextern int multi_prog_get_argv(char *config_data, char **prog_env,\n\t\t\t       int task_rank, uint32_t *argc, char ***argv,\n\t\t\t       int global_argc, char **global_argv)\n{\n\tchar *line = NULL;\n\tint i, line_num = 0;\n\tint task_offset;\n\tchar *p = NULL, *s = NULL, *ptrptr = NULL;\n\tchar *rank_spec = NULL, *args_spec = NULL;\n\tint prog_argc = 0;\n\tchar **prog_argv = NULL;\n\tchar *local_data = NULL;\n\n\tprog_argv = (char **)xmalloc(sizeof(char *) * MAX_ARGC);\n\n\tif (task_rank < 0) {\n\t\terror(\"Invalid task rank %d\", task_rank);\n\t\t*argc = 1;\n\t\t*argv = prog_argv;\n\t\treturn -1;\n\t}\n\n\tlocal_data = xstrdup(config_data);\n\n\tline = strtok_r(local_data, \"\\n\", &ptrptr);\n\twhile (line) {\n\t\tif (line_num > 0)\n\t\t\tline = strtok_r(NULL, \"\\n\", &ptrptr);\n\t\tif (line == NULL) {\n\t\t\terror(\"No executable program specified for this task\");\n\t\t\tgoto fail;\n\t\t}\n\t\tline_num ++;\n\t\tif (strlen (line) >= (BUF_SIZE - 1)) {\n\t\t\terror (\"Line %d of configuration file too long\",\n\t\t\t\tline_num);\n\t\t\tgoto fail;\n\t\t}\n\n\t\tp = line;\n\t\twhile (*p != '\\0' && isspace (*p)) /* remove leading spaces */\n\t\t\tp ++;\n\n\t\tif (*p == '#') /* only whole-line comments handled */\n\t\t\tcontinue;\n\n\t\tif (*p == '\\0') /* blank line ignored */\n\t\t\tcontinue;\n\n\t\trank_spec = p;\n\n\t\twhile (*p != '\\0' && !isspace (*p))\n\t\t\tp ++;\n\t\tif (*p == '\\0') {\n\t\t\terror(\"Invalid MPMD configuration line %d\", line_num);\n\t\t\tgoto fail;\n\t\t}\n\t\t*p ++ = '\\0';\n\n\t\tif (!_in_range (task_rank, rank_spec, &task_offset))\n\t\t\tcontinue;\n\n\t\t/* skip all whitspace after the range spec */\n\t\twhile(*p != '\\0' && isspace (*p))\n\t\t\tp++;\n\n\t\targs_spec = p;\n\t\twhile (*args_spec != '\\0') {\n\t\t\t/* Only simple quote and escape supported */\n\t\t\tprog_argv[prog_argc ++] = args_spec;\n\t\t\tif ((prog_argc + 1) >= MAX_ARGC) {\n\t\t\t\tinfo(\"Exceeded multi-prog argc limit\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\tCONT:\twhile (*args_spec != '\\0' && *args_spec != '\\\\'\n\t\t\t&&     *args_spec != '%'\n\t\t\t&&     *args_spec != '\\'' && !isspace (*args_spec)) {\n\t\t\t\targs_spec ++;\n\t\t\t}\n\t\t\tif (*args_spec == '\\0') {\n\t\t\t\t/* the last argument */\n\t\t\t\tbreak;\n\n\t\t\t} else if (*args_spec == '%') {\n\t\t\t\t_sub_expression(args_spec, task_rank,\n\t\t\t\t\ttask_offset);\n\t\t\t\targs_spec ++;\n\t\t\t\tgoto CONT;\n\n\t\t\t} else if (*args_spec == '\\\\') {\n\t\t\t\t/* escape, just remove the backslash */\n\t\t\t\ts = args_spec ++;\n\t\t\t\tp = args_spec;\n\t\t\t\tdo {\n\t\t\t\t\t*s ++ = *p;\n\t\t\t\t} while (*p ++ != '\\0');\n\t\t\t\tgoto CONT;\n\n\t\t\t} else if (*args_spec == '\\'') {\n\t\t\t\t/* single quote,\n\t\t\t\t * preserve all characters quoted. */\n\t\t\t\tp = args_spec + 1;\n\t\t\t\twhile (*p != '\\0' && *p != '\\'') {\n\t\t\t\t\t/* remove quote */\n\t\t\t\t\t*args_spec ++ = *p ++;\n\t\t\t\t}\n\t\t\t\tif (*p == '\\0') {\n\t\t\t\t\t/* closing quote not found */\n\t\t\t\t\terror(\"Program arguments specification\"\n\t\t\t\t\t\t\" format invalid: %s.\",\n\t\t\t\t\t\tprog_argv[prog_argc -1]);\n\t\t\t\t\tgoto fail;\n\t\t\t\t}\n\t\t\t\tp ++; /* skip closing quote */\n\t\t\t\ts = args_spec;\n\t\t\t\tdo {\n\t\t\t\t\t*s ++ = *p;\n\t\t\t\t} while (*p ++ != '\\0');\n\t\t\t\tgoto CONT;\n\n\t\t\t} else {\n\t\t\t\t/* space */\n\t\t\t\t*args_spec ++ = '\\0';\n\t\t\t\twhile (*args_spec != '\\0'\n\t\t\t\t&& isspace (*args_spec))\n\t\t\t\t\targs_spec ++;\n\t\t\t}\n\n\t\t}\n\n\t\tfor (i = 2; i < global_argc; i++) {\n\t\t\tif ((prog_argc + 1) >= MAX_ARGC) {\n\t\t\t\tinfo(\"Exceeded multi-prog argc limit\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tprog_argv[prog_argc++] = xstrdup(global_argv[i]);\n\t\t}\n\t\tprog_argv[prog_argc] = NULL;\n\n\t\t*argc = prog_argc;\n\t\t*argv = prog_argv;\n\t\t/* FIXME - local_data is leaked */\n\t\treturn 0;\n\t}\n\n\terror(\"Program for task rank %d not specified.\", task_rank);\nfail:\n\txfree(local_data);\n\t*argc = 1;\n\tprog_argv[0] = NULL;\n\t*argv = prog_argv;\n\treturn -1;\n}"
  },
  {
    "function_name": "_sub_expression",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
    "lines": "122-138",
    "snippet": "static void\n_sub_expression(char *args_spec, int task_rank, int task_offset)\n{\n\tchar tmp[BUF_SIZE];\n\n\tif (args_spec[0] == '%') {\n\t\tif (args_spec[1] == 't') {\n\t\t\t/* task rank */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_rank, tmp);\n\t\t} else if (args_spec[1] == 'o') {\n\t\t\t/* task offset */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_offset, tmp);\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"multi_prog.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/log.h\"",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <ctype.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "args_spec",
            "\"%d%s\"",
            "task_offset",
            "tmp"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "tmp",
            "&args_spec[2]"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "args_spec",
            "\"%d%s\"",
            "task_rank",
            "tmp"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "tmp",
            "&args_spec[2]"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\nstatic void\n_sub_expression(char *args_spec, int task_rank, int task_offset)\n{\n\tchar tmp[BUF_SIZE];\n\n\tif (args_spec[0] == '%') {\n\t\tif (args_spec[1] == 't') {\n\t\t\t/* task rank */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_rank, tmp);\n\t\t} else if (args_spec[1] == 'o') {\n\t\t\t/* task offset */\n\t\t\tstrcpy(tmp, &args_spec[2]);\n\t\t\tsprintf(args_spec, \"%d%s\", task_offset, tmp);\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "_in_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/multi_prog.c",
    "lines": "69-119",
    "snippet": "static int\n_in_range(int rank, char* spec, int *offset)\n{\n\tchar* range;\n\tchar* p;\n\tchar* upper;\n\tint high_num, low_num, passed = 0;\n\n\txassert(offset);\n\n\tif (spec[0] == '*' && spec[1] == '\\0') {\n\t\t*offset = rank;\n\t\treturn 1;\n\t}\n\n\tfor (range = strtok (spec, \",\"); range != NULL;\n\t\t\trange = strtok (NULL, \",\")) {\n\t\tp = range;\n\t\twhile (*p != '\\0' && isdigit (*p))\n\t\t\tp ++;\n\t\tif (*p == '\\0') { /* single rank */\n\t\t\tif (rank == atoi (range)) {\n\t\t\t\t*offset = passed;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tpassed ++;\n\n\t\t} else if (*p == '-') { /* lower-upper */\n\t\t\tupper = ++ p;\n\t\t\twhile (isdigit (*p))\n\t\t\t\tp ++;\n\t\t\tif (*p != '\\0') {\n\t\t\t\terror (\"Invalid task range specification (%s) \"\n\t\t\t\t\t\"ignored.\", range);\n\t\t\t\tcontinue;\n\t\t\t};\n\t\t\tlow_num  = atoi (range);\n\t\t\thigh_num = atoi (upper);\n\t\t\tif ((rank >= low_num) && (rank <= high_num)) {\n\t\t\t\t*offset = passed + (rank - low_num);\n\t\t\t\treturn 1;\n\t\t\t} else\n\t\t\t\tpassed += (1 + high_num - low_num);\n\n\t\t} else {\n\t\t\terror (\"Invalid task range specification (%s) ignored.\",\n\t\t\t\trange);\n\t\t}\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include \"multi_prog.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/log.h\"",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <ctype.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid task range specification (%s) ignored.\"",
            "range"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "upper"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "range"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isdigit",
          "args": [
            "*p"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "range"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isdigit",
          "args": [
            "*p"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "NULL",
            "\",\""
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "spec",
            "\",\""
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "offset"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"multi_prog.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/log.h\"\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n#include <stdio.h>\n\nstatic int\n_in_range(int rank, char* spec, int *offset)\n{\n\tchar* range;\n\tchar* p;\n\tchar* upper;\n\tint high_num, low_num, passed = 0;\n\n\txassert(offset);\n\n\tif (spec[0] == '*' && spec[1] == '\\0') {\n\t\t*offset = rank;\n\t\treturn 1;\n\t}\n\n\tfor (range = strtok (spec, \",\"); range != NULL;\n\t\t\trange = strtok (NULL, \",\")) {\n\t\tp = range;\n\t\twhile (*p != '\\0' && isdigit (*p))\n\t\t\tp ++;\n\t\tif (*p == '\\0') { /* single rank */\n\t\t\tif (rank == atoi (range)) {\n\t\t\t\t*offset = passed;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tpassed ++;\n\n\t\t} else if (*p == '-') { /* lower-upper */\n\t\t\tupper = ++ p;\n\t\t\twhile (isdigit (*p))\n\t\t\t\tp ++;\n\t\t\tif (*p != '\\0') {\n\t\t\t\terror (\"Invalid task range specification (%s) \"\n\t\t\t\t\t\"ignored.\", range);\n\t\t\t\tcontinue;\n\t\t\t};\n\t\t\tlow_num  = atoi (range);\n\t\t\thigh_num = atoi (upper);\n\t\t\tif ((rank >= low_num) && (rank <= high_num)) {\n\t\t\t\t*offset = passed + (rank - low_num);\n\t\t\t\treturn 1;\n\t\t\t} else\n\t\t\t\tpassed += (1 + high_num - low_num);\n\n\t\t} else {\n\t\t\terror (\"Invalid task range specification (%s) ignored.\",\n\t\t\t\trange);\n\t\t}\n\t}\n\treturn 0;\n}"
  }
]