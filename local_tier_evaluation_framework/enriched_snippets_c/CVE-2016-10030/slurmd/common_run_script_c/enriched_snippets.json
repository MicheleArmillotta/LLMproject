[
  {
    "function_name": "run_script",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
    "lines": "212-240",
    "snippet": "int run_script(const char *name, const char *pattern, uint32_t job_id,\n\t       int max_wait, char **env, uid_t uid)\n{\n\tint rc = 0;\n\tList l;\n\tListIterator i;\n\tchar *s;\n\n\tif (pattern == NULL || pattern[0] == '\\0')\n\t\treturn 0;\n\n\tl = _script_list_create (pattern);\n\tif (l == NULL)\n\t\treturn error (\"Unable to run %s [%s]\", name, pattern);\n\n\ti = list_iterator_create (l);\n\twhile ((s = list_next (i))) {\n\t\trc = _run_one_script (name, s, job_id, max_wait, env, uid);\n\t\tif (rc) {\n\t\t\terror (\"%s: exited with status 0x%04x\\n\", s, rc);\n\t\t\tbreak;\n\t\t}\n\n\t}\n\tlist_iterator_destroy (i);\n\tFREE_NULL_LIST (l);\n\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/list.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <glob.h>",
      "#include <string.h>",
      "#include <sys/errno.h>",
      "#include <sys/wait.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <poll.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FREE_NULL_LIST",
          "args": [
            "l"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_iterator_destroy",
          "args": [
            "i"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: exited with status 0x%04x\\n\"",
            "s",
            "rc"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_run_one_script",
          "args": [
            "name",
            "s",
            "job_id",
            "max_wait",
            "env",
            "uid"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "_run_one_script",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "110-165",
          "snippet": "static int\n_run_one_script(const char *name, const char *path, uint32_t job_id,\n\t\tint max_wait, char **env, uid_t uid)\n{\n\tint status;\n\tpid_t cpid;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tif (job_id) {\n\t\tdebug(\"[job %u] attempting to run %s [%s]\",\n\t\t\tjob_id, name, path);\n\t} else\n\t\tdebug(\"attempting to run %s [%s]\", name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Can not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((cpid = fork()) < 0) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif (container_g_add_pid(job_id, getpid(), getuid())\n\t\t    != SLURM_SUCCESS)\n\t\t\terror(\"container_g_add_pid(%u): %m\", job_id);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tif (waitpid_timeout(name, cpid, &status, max_wait) < 0)\n\t\treturn (-1);\n\treturn status;\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic int\n_run_one_script(const char *name, const char *path, uint32_t job_id,\n\t\tint max_wait, char **env, uid_t uid)\n{\n\tint status;\n\tpid_t cpid;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tif (job_id) {\n\t\tdebug(\"[job %u] attempting to run %s [%s]\",\n\t\t\tjob_id, name, path);\n\t} else\n\t\tdebug(\"attempting to run %s [%s]\", name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Can not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((cpid = fork()) < 0) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif (container_g_add_pid(job_id, getpid(), getuid())\n\t\t    != SLURM_SUCCESS)\n\t\t\terror(\"container_g_add_pid(%u): %m\", job_id);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tif (waitpid_timeout(name, cpid, &status, max_wait) < 0)\n\t\treturn (-1);\n\treturn status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "list_next",
          "args": [
            "i"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_iterator_create",
          "args": [
            "l"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to run %s [%s]\"",
            "name",
            "pattern"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_script_list_create",
          "args": [
            "pattern"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "_script_list_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "178-210",
          "snippet": "static List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nint run_script(const char *name, const char *pattern, uint32_t job_id,\n\t       int max_wait, char **env, uid_t uid)\n{\n\tint rc = 0;\n\tList l;\n\tListIterator i;\n\tchar *s;\n\n\tif (pattern == NULL || pattern[0] == '\\0')\n\t\treturn 0;\n\n\tl = _script_list_create (pattern);\n\tif (l == NULL)\n\t\treturn error (\"Unable to run %s [%s]\", name, pattern);\n\n\ti = list_iterator_create (l);\n\twhile ((s = list_next (i))) {\n\t\trc = _run_one_script (name, s, job_id, max_wait, env, uid);\n\t\tif (rc) {\n\t\t\terror (\"%s: exited with status 0x%04x\\n\", s, rc);\n\t\t\tbreak;\n\t\t}\n\n\t}\n\tlist_iterator_destroy (i);\n\tFREE_NULL_LIST (l);\n\n\treturn rc;\n}"
  },
  {
    "function_name": "_script_list_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
    "lines": "178-210",
    "snippet": "static List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}",
    "includes": [
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/list.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <glob.h>",
      "#include <string.h>",
      "#include <sys/errno.h>",
      "#include <sys/wait.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <poll.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "globfree",
          "args": [
            "&gl"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unknown glob(3) return code = %d\"",
            "rc"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"run_script: glob(3): Out of memory\""
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_push",
          "args": [
            "l",
            "xstrdup (gl.gl_pathv[i])"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "gl.gl_pathv[i]"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "list_create",
          "args": [
            "(ListDelF) _xfree_f"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "_script_list_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "178-210",
          "snippet": "static List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "glob",
          "args": [
            "pattern",
            "GLOB_ERR",
            "_ef",
            "&gl"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic List _script_list_create (const char *pattern)\n{\n\tglob_t gl;\n\tsize_t i;\n\tList l = NULL;\n\n\tif (pattern == NULL)\n\t\treturn (NULL);\n\n\tint rc = glob (pattern, GLOB_ERR, _ef, &gl);\n\tswitch (rc) {\n\tcase 0:\n\t\tl = list_create ((ListDelF) _xfree_f);\n\t\tfor (i = 0; i < gl.gl_pathc; i++)\n\t\t\tlist_push (l, xstrdup (gl.gl_pathv[i]));\n\t\tbreak;\n\tcase GLOB_NOMATCH:\n\t\tbreak;\n\tcase GLOB_NOSPACE:\n\t\terror (\"run_script: glob(3): Out of memory\");\n\t\tbreak;\n\tcase GLOB_ABORTED:\n\t\terror (\"run_script: cannot read dir %s: %m\", pattern);\n\t\tbreak;\n\tdefault:\n\t\terror (\"Unknown glob(3) return code = %d\", rc);\n\t\tbreak;\n\t}\n\n\tglobfree (&gl);\n\n\treturn l;\n}"
  },
  {
    "function_name": "_ef",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
    "lines": "173-176",
    "snippet": "static int _ef (const char *p, int errnum)\n{\n\treturn error (\"run_script: glob: %s: %s\", p, strerror (errno));\n}",
    "includes": [
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/list.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <glob.h>",
      "#include <string.h>",
      "#include <sys/errno.h>",
      "#include <sys/wait.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <poll.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"run_script: glob: %s: %s\"",
            "p",
            "strerror (errno)"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic int _ef (const char *p, int errnum)\n{\n\treturn error (\"run_script: glob: %s: %s\", p, strerror (errno));\n}"
  },
  {
    "function_name": "_xfree_f",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
    "lines": "167-170",
    "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
    "includes": [
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/list.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <glob.h>",
      "#include <string.h>",
      "#include <sys/errno.h>",
      "#include <sys/wait.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <poll.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "x"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
  },
  {
    "function_name": "_run_one_script",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
    "lines": "110-165",
    "snippet": "static int\n_run_one_script(const char *name, const char *path, uint32_t job_id,\n\t\tint max_wait, char **env, uid_t uid)\n{\n\tint status;\n\tpid_t cpid;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tif (job_id) {\n\t\tdebug(\"[job %u] attempting to run %s [%s]\",\n\t\t\tjob_id, name, path);\n\t} else\n\t\tdebug(\"attempting to run %s [%s]\", name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Can not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((cpid = fork()) < 0) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif (container_g_add_pid(job_id, getpid(), getuid())\n\t\t    != SLURM_SUCCESS)\n\t\t\terror(\"container_g_add_pid(%u): %m\", job_id);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tif (waitpid_timeout(name, cpid, &status, max_wait) < 0)\n\t\treturn (-1);\n\treturn status;\n}",
    "includes": [
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/list.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <glob.h>",
      "#include <string.h>",
      "#include <sys/errno.h>",
      "#include <sys/wait.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <poll.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "waitpid_timeout",
          "args": [
            "name",
            "cpid",
            "&status",
            "max_wait"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "waitpid_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "64-97",
          "snippet": "int waitpid_timeout (const char *name, pid_t pid, int *pstatus, int timeout)\n{\n\tint timeout_ms = 1000 * timeout; /* timeout in ms                   */\n\tint max_delay =  1000;           /* max delay between waitpid calls */\n\tint delay = 10;                  /* initial delay                   */\n\tint rc;\n\tint options = WNOHANG;\n\n\tif (timeout <= 0)\n\t\toptions = 0;\n\n\twhile ((rc = waitpid (pid, pstatus, options)) <= 0) {\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waitpid: %m\");\n\t\t\treturn (-1);\n\t\t} else if (timeout_ms <= 0) {\n\t\t\tinfo (\"%s%stimeout after %ds: killing pgid %d\",\n\t\t\t      name != NULL ? name : \"\",\n\t\t\t      name != NULL ? \": \" : \"\",\n\t\t\t      timeout, pid);\n\t\t\tkillpg(pid, SIGKILL);\n\t\t\toptions = 0;\n\t\t} else {\n\t\t\tpoll(NULL, 0, delay);\n\t\t\ttimeout_ms -= delay;\n\t\t\tdelay = MIN (timeout_ms, MIN(max_delay, delay*2));\n\t\t}\n\t}\n\n\tkillpg(pid, SIGKILL);  /* kill children too */\n\treturn (0);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nint waitpid_timeout (const char *name, pid_t pid, int *pstatus, int timeout)\n{\n\tint timeout_ms = 1000 * timeout; /* timeout in ms                   */\n\tint max_delay =  1000;           /* max delay between waitpid calls */\n\tint delay = 10;                  /* initial delay                   */\n\tint rc;\n\tint options = WNOHANG;\n\n\tif (timeout <= 0)\n\t\toptions = 0;\n\n\twhile ((rc = waitpid (pid, pstatus, options)) <= 0) {\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waitpid: %m\");\n\t\t\treturn (-1);\n\t\t} else if (timeout_ms <= 0) {\n\t\t\tinfo (\"%s%stimeout after %ds: killing pgid %d\",\n\t\t\t      name != NULL ? name : \"\",\n\t\t\t      name != NULL ? \": \" : \"\",\n\t\t\t      timeout, pid);\n\t\t\tkillpg(pid, SIGKILL);\n\t\t\toptions = 0;\n\t\t} else {\n\t\t\tpoll(NULL, 0, delay);\n\t\t\ttimeout_ms -= delay;\n\t\t\tdelay = MIN (timeout_ms, MIN(max_delay, delay*2));\n\t\t}\n\t}\n\n\tkillpg(pid, SIGKILL);  /* kill children too */\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "127"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"execve(%s): %m\"",
            "path"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "execve",
          "args": [
            "path",
            "argv",
            "env"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgrp",
          "args": [],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgrp",
          "args": [
            "0",
            "0"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "path"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "container_g_add_pid",
          "args": [
            "job_id",
            "getpid()",
            "getuid()"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "container_g_add_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/job_container_plugin.c",
          "lines": "196-209",
          "snippet": "extern int container_g_add_pid(uint32_t job_id, pid_t pid, uid_t uid)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_pid))(job_id, pid, uid);\n\t}\n\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static job_container_ops_t\t*ops = NULL;",
            "static int\t\t\tg_container_context_num = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic job_container_ops_t\t*ops = NULL;\nstatic int\t\t\tg_container_context_num = -1;\n\nextern int container_g_add_pid(uint32_t job_id, pid_t pid, uid_t uid)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (job_container_init())\n\t\treturn SLURM_ERROR;\n\n\tfor (i = 0; ((i < g_container_context_num) && (rc == SLURM_SUCCESS));\n\t     i++) {\n\t\trc = (*(ops[i].container_p_add_pid))(job_id, pid, uid);\n\t}\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "_install_fork_handlers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd.c",
          "lines": "1991-1999",
          "snippet": "static void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/slurmd/req.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/stepd_api.h\"",
            "#include \"src/common/slurm_topology.h\"",
            "#include \"src/common/slurm_strcasestr.h\"",
            "#include \"src/common/slurm_route.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_mcs.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_acct_gather_energy.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_auth.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/proc_args.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/parse_time.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/pack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/node_features.h\"",
            "#include \"src/common/node_conf.h\"",
            "#include \"src/common/msg_aggr.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/daemonize.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/bitstring.h\"",
            "#include <unistd.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/resource.h>",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pthread.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <dlfcn.h>",
            "#include <dirent.h>",
            "#  include <hwloc.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void      _atfork_final(void);",
            "static void      _atfork_prepare(void);",
            "static void      _install_fork_handlers(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/slurmd/req.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/stepd_api.h\"\n#include \"src/common/slurm_topology.h\"\n#include \"src/common/slurm_strcasestr.h\"\n#include \"src/common/slurm_route.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_mcs.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_acct_gather_energy.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_auth.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/proc_args.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/parse_time.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/pack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/node_features.h\"\n#include \"src/common/node_conf.h\"\n#include \"src/common/msg_aggr.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/daemonize.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/bitstring.h\"\n#include <unistd.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <dlfcn.h>\n#include <dirent.h>\n#  include <hwloc.h>\n#  include \"config.h\"\n\nstatic void      _atfork_final(void);\nstatic void      _atfork_prepare(void);\nstatic void      _install_fork_handlers(void);\n\nstatic void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Can not run %s [%s]: %m\"",
            "name",
            "path"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "path",
            "R_OK | X_OK"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"attempting to run %s [%s]\"",
            "name",
            "path"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"[job %u] attempting to run %s [%s]\"",
            "job_id",
            "name",
            "path"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "env"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic int\n_run_one_script(const char *name, const char *path, uint32_t job_id,\n\t\tint max_wait, char **env, uid_t uid)\n{\n\tint status;\n\tpid_t cpid;\n\n\txassert(env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tif (job_id) {\n\t\tdebug(\"[job %u] attempting to run %s [%s]\",\n\t\t\tjob_id, name, path);\n\t} else\n\t\tdebug(\"attempting to run %s [%s]\", name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Can not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\n\tif ((cpid = fork()) < 0) {\n\t\terror (\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\t/* container_g_add_pid needs to be called in the\n\t\t   forked process part of the fork to avoid a race\n\t\t   condition where if this process makes a file or\n\t\t   detacts itself from a child before we add the pid\n\t\t   to the container in the parent of the fork.\n\t\t*/\n\t\tif (container_g_add_pid(job_id, getpid(), getuid())\n\t\t    != SLURM_SUCCESS)\n\t\t\terror(\"container_g_add_pid(%u): %m\", job_id);\n\n\t\targv[0] = (char *)xstrdup(path);\n\t\targv[1] = NULL;\n\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tif (waitpid_timeout(name, cpid, &status, max_wait) < 0)\n\t\treturn (-1);\n\treturn status;\n}"
  },
  {
    "function_name": "waitpid_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
    "lines": "64-97",
    "snippet": "int waitpid_timeout (const char *name, pid_t pid, int *pstatus, int timeout)\n{\n\tint timeout_ms = 1000 * timeout; /* timeout in ms                   */\n\tint max_delay =  1000;           /* max delay between waitpid calls */\n\tint delay = 10;                  /* initial delay                   */\n\tint rc;\n\tint options = WNOHANG;\n\n\tif (timeout <= 0)\n\t\toptions = 0;\n\n\twhile ((rc = waitpid (pid, pstatus, options)) <= 0) {\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waitpid: %m\");\n\t\t\treturn (-1);\n\t\t} else if (timeout_ms <= 0) {\n\t\t\tinfo (\"%s%stimeout after %ds: killing pgid %d\",\n\t\t\t      name != NULL ? name : \"\",\n\t\t\t      name != NULL ? \": \" : \"\",\n\t\t\t      timeout, pid);\n\t\t\tkillpg(pid, SIGKILL);\n\t\t\toptions = 0;\n\t\t} else {\n\t\t\tpoll(NULL, 0, delay);\n\t\t\ttimeout_ms -= delay;\n\t\t\tdelay = MIN (timeout_ms, MIN(max_delay, delay*2));\n\t\t}\n\t}\n\n\tkillpg(pid, SIGKILL);  /* kill children too */\n\treturn (0);\n}",
    "includes": [
      "#include \"src/slurmd/common/run_script.h\"",
      "#include \"src/slurmd/common/job_container_plugin.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xassert.h\"",
      "#include \"src/common/list.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <glob.h>",
      "#include <string.h>",
      "#include <sys/errno.h>",
      "#include <sys/wait.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <poll.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "killpg",
          "args": [
            "pid",
            "SIGKILL"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "timeout_ms",
            "MIN(max_delay, delay*2)"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "max_delay",
            "delay*2"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "NULL",
            "0",
            "delay"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "killpg",
          "args": [
            "pid",
            "SIGKILL"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"%s%stimeout after %ds: killing pgid %d\"",
            "name != NULL ? name : \"\"",
            "name != NULL ? \": \" : \"\"",
            "timeout",
            "pid"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "task_info_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "647-683",
          "snippet": "extern stepd_step_task_info_t *\ntask_info_create(int taskid, int gtaskid,\n\t\t char *ifname, char *ofname, char *efname)\n{\n\tstepd_step_task_info_t *t = xmalloc(sizeof(stepd_step_task_info_t));\n\n\txassert(taskid >= 0);\n\txassert(gtaskid >= 0);\n\n\tslurm_mutex_init(&t->mutex);\n\tslurm_mutex_lock(&t->mutex);\n\tt->state       = STEPD_STEP_TASK_INIT;\n\tt->id          = taskid;\n\tt->gtid\t       = gtaskid;\n\tt->pid         = (pid_t) -1;\n\tt->ifname      = ifname;\n\tt->ofname      = ofname;\n\tt->efname      = efname;\n\tt->stdin_fd    = -1;\n\tt->to_stdin    = -1;\n\tt->stdout_fd   = -1;\n\tt->from_stdout = -1;\n\tt->stderr_fd   = -1;\n\tt->from_stderr = -1;\n\tt->in          = NULL;\n\tt->out         = NULL;\n\tt->err         = NULL;\n\tt->killed_by_cmd = false;\n\tt->aborted     = false;\n\tt->esent       = false;\n\tt->exited      = false;\n\tt->estatus     = -1;\n\tt->argc\t       = 0;\n\tt->argv\t       = NULL;\n\tslurm_mutex_unlock(&t->mutex);\n\treturn t;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _job_init_task_info(stepd_step_rec_t *job, uint32_t **gtid,\n\t\t\t\tchar *ifname, char *ofname, char *efname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nstatic void _job_init_task_info(stepd_step_rec_t *job, uint32_t **gtid,\n\t\t\t\tchar *ifname, char *ofname, char *efname);\n\nextern stepd_step_task_info_t *\ntask_info_create(int taskid, int gtaskid,\n\t\t char *ifname, char *ofname, char *efname)\n{\n\tstepd_step_task_info_t *t = xmalloc(sizeof(stepd_step_task_info_t));\n\n\txassert(taskid >= 0);\n\txassert(gtaskid >= 0);\n\n\tslurm_mutex_init(&t->mutex);\n\tslurm_mutex_lock(&t->mutex);\n\tt->state       = STEPD_STEP_TASK_INIT;\n\tt->id          = taskid;\n\tt->gtid\t       = gtaskid;\n\tt->pid         = (pid_t) -1;\n\tt->ifname      = ifname;\n\tt->ofname      = ofname;\n\tt->efname      = efname;\n\tt->stdin_fd    = -1;\n\tt->to_stdin    = -1;\n\tt->stdout_fd   = -1;\n\tt->from_stdout = -1;\n\tt->stderr_fd   = -1;\n\tt->from_stderr = -1;\n\tt->in          = NULL;\n\tt->out         = NULL;\n\tt->err         = NULL;\n\tt->killed_by_cmd = false;\n\tt->aborted     = false;\n\tt->esent       = false;\n\tt->exited      = false;\n\tt->estatus     = -1;\n\tt->argc\t       = 0;\n\tt->argv\t       = NULL;\n\tslurm_mutex_unlock(&t->mutex);\n\treturn t;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"waitpid: %m\""
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "pid",
            "pstatus",
            "options"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nint waitpid_timeout (const char *name, pid_t pid, int *pstatus, int timeout)\n{\n\tint timeout_ms = 1000 * timeout; /* timeout in ms                   */\n\tint max_delay =  1000;           /* max delay between waitpid calls */\n\tint delay = 10;                  /* initial delay                   */\n\tint rc;\n\tint options = WNOHANG;\n\n\tif (timeout <= 0)\n\t\toptions = 0;\n\n\twhile ((rc = waitpid (pid, pstatus, options)) <= 0) {\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waitpid: %m\");\n\t\t\treturn (-1);\n\t\t} else if (timeout_ms <= 0) {\n\t\t\tinfo (\"%s%stimeout after %ds: killing pgid %d\",\n\t\t\t      name != NULL ? name : \"\",\n\t\t\t      name != NULL ? \": \" : \"\",\n\t\t\t      timeout, pid);\n\t\t\tkillpg(pid, SIGKILL);\n\t\t\toptions = 0;\n\t\t} else {\n\t\t\tpoll(NULL, 0, delay);\n\t\t\ttimeout_ms -= delay;\n\t\t\tdelay = MIN (timeout_ms, MIN(max_delay, delay*2));\n\t\t}\n\t}\n\n\tkillpg(pid, SIGKILL);  /* kill children too */\n\treturn (0);\n}"
  }
]