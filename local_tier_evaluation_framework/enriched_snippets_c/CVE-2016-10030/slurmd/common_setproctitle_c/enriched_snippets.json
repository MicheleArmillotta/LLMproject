[
  {
    "function_name": "fini_setproctitle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
    "lines": "332-347",
    "snippet": "void fini_setproctitle(void)\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tint i;\n\n\tif (!new_environ)\n\t\treturn;\n\n\tfor (i = 0; new_environ[i] != NULL; i++) {\n\t\tfree(new_environ[i]);\n\t}\n\tfree(new_environ);\n\tnew_environ = (char **) NULL;\n\tenviron = new_environ;\n#endif /* PS_USE_CLOBBER_ARGV */\n}",
    "includes": [
      "#include <sys/exec.h>",
      "#include <machine/vmparam.h>\t/* for old BSD */",
      "#include <sys/pstat.h>\t\t/* for HP-UX */",
      "#include \"src/common/strlcpy.h\"",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <errno.h>",
      "#    include \"src/common/malloc.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [
      "#define PS_USE_CLOBBER_ARGV\t\t4"
    ],
    "globals_used": [
      "extern char **environ;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "new_environ"
          ],
          "line": 343
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\n#define PS_USE_CLOBBER_ARGV\t\t4\n\nextern char **environ;\n\nvoid fini_setproctitle(void)\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tint i;\n\n\tif (!new_environ)\n\t\treturn;\n\n\tfor (i = 0; new_environ[i] != NULL; i++) {\n\t\tfree(new_environ[i]);\n\t}\n\tfree(new_environ);\n\tnew_environ = (char **) NULL;\n\tenviron = new_environ;\n#endif /* PS_USE_CLOBBER_ARGV */\n}"
  },
  {
    "function_name": "init_setproctitle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
    "lines": "263-328",
    "snippet": "void\ninit_setproctitle(int argc, char *argv[])\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tchar *end_of_area = NULL;\n\tint i;\n#endif\n\n\tsave_argc = argc;\n\tsave_argv = argv;\n\n#if defined(__NetBSD__) || defined(__FreeBSD__)\n\tsetprogname (argv[0]);\n#else\n\t_init__progname (argv[0]);\n#endif\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/*\n\t * If we're going to overwrite the argv area, count the available\n\t * space.  Also move the environment to make additional room.\n\t */\n\n\t/*\n\t * check for contiguous argv strings\n\t */\n\tfor (i = 0; i < argc; i++) {\n\t\tif (i == 0 || end_of_area + 1 == argv[i])\n\t\t\tend_of_area = argv[i] + strlen(argv[i]);\n\t}\n\n\t/* probably can't happen? */\n\tif (end_of_area == NULL) {\n\t\tps_buffer = NULL;\n\t\tps_buffer_size = 0;\n\t\treturn;\n\t}\n\n\t/*\n\t * check for contiguous environ strings following argv\n\t */\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tif (end_of_area + 1 == environ[i])\n\t\t\tend_of_area = environ[i] + strlen(environ[i]);\n\t}\n\n\tps_buffer = argv[0];\n\tps_buffer_size = end_of_area - argv[0] - 1;\n\n\t/*\n\t * Duplicate and move the environment out of the way\n\t */\n\tnew_environ = malloc(sizeof(char *) * (i + 1));\n\tif (!new_environ) {\n\t\tfprintf(stderr, \"ERROR: [%s:%d] %s: %s\\n\",\n\t\t\t__FILE__, __LINE__, \"init_setproctitle\",\n\t\t\tstrerror(errno));\n\t\tabort();\n\t}\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tnew_environ[i] = strdup(environ[i]);\n\t}\n\tnew_environ[i] = NULL;\n\tenviron = new_environ;\n#endif /* PS_USE_CLOBBER_ARGV */\n}",
    "includes": [
      "#include <sys/exec.h>",
      "#include <machine/vmparam.h>\t/* for old BSD */",
      "#include <sys/pstat.h>\t\t/* for HP-UX */",
      "#include \"src/common/strlcpy.h\"",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <errno.h>",
      "#    include \"src/common/malloc.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [
      "#define PS_USE_CLOBBER_ARGV\t\t4"
    ],
    "globals_used": [
      "extern char **environ;",
      "static int\tsave_argc;",
      "static char **save_argv;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "environ[i]"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "abort",
          "args": [],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"ERROR: [%s:%d] %s: %s\\n\"",
            "__FILE__",
            "__LINE__",
            "\"init_setproctitle\"",
            "strerror(errno)"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(char *) * (i + 1)"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "environ[i]"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_init__progname",
          "args": [
            "argv[0]"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "_init__progname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
          "lines": "244-251",
          "snippet": "static void _init__progname (const char *argv0)\n{\n#if !HAVE__PROGNAME\n\tchar *start = strrchr (argv0, '/');\n\tstrlcpy (__progname, start ? (start + 1) : argv0, sizeof (__progname));\n\treturn;\n#endif /* !HAVE__PROGNAME */\n}",
          "includes": [
            "#include <sys/exec.h>",
            "#include <machine/vmparam.h>\t/* for old BSD */",
            "#include <sys/pstat.h>\t\t/* for HP-UX */",
            "#include \"src/common/strlcpy.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdarg.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <errno.h>",
            "#    include \"src/common/malloc.h\"",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\nstatic void _init__progname (const char *argv0)\n{\n#if !HAVE__PROGNAME\n\tchar *start = strrchr (argv0, '/');\n\tstrlcpy (__progname, start ? (start + 1) : argv0, sizeof (__progname));\n\treturn;\n#endif /* !HAVE__PROGNAME */\n}"
        }
      },
      {
        "call_info": {
          "callee": "setprogname",
          "args": [
            "argv[0]"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\n#define PS_USE_CLOBBER_ARGV\t\t4\n\nextern char **environ;\nstatic int\tsave_argc;\nstatic char **save_argv;\n\nvoid\ninit_setproctitle(int argc, char *argv[])\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tchar *end_of_area = NULL;\n\tint i;\n#endif\n\n\tsave_argc = argc;\n\tsave_argv = argv;\n\n#if defined(__NetBSD__) || defined(__FreeBSD__)\n\tsetprogname (argv[0]);\n#else\n\t_init__progname (argv[0]);\n#endif\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/*\n\t * If we're going to overwrite the argv area, count the available\n\t * space.  Also move the environment to make additional room.\n\t */\n\n\t/*\n\t * check for contiguous argv strings\n\t */\n\tfor (i = 0; i < argc; i++) {\n\t\tif (i == 0 || end_of_area + 1 == argv[i])\n\t\t\tend_of_area = argv[i] + strlen(argv[i]);\n\t}\n\n\t/* probably can't happen? */\n\tif (end_of_area == NULL) {\n\t\tps_buffer = NULL;\n\t\tps_buffer_size = 0;\n\t\treturn;\n\t}\n\n\t/*\n\t * check for contiguous environ strings following argv\n\t */\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tif (end_of_area + 1 == environ[i])\n\t\t\tend_of_area = environ[i] + strlen(environ[i]);\n\t}\n\n\tps_buffer = argv[0];\n\tps_buffer_size = end_of_area - argv[0] - 1;\n\n\t/*\n\t * Duplicate and move the environment out of the way\n\t */\n\tnew_environ = malloc(sizeof(char *) * (i + 1));\n\tif (!new_environ) {\n\t\tfprintf(stderr, \"ERROR: [%s:%d] %s: %s\\n\",\n\t\t\t__FILE__, __LINE__, \"init_setproctitle\",\n\t\t\tstrerror(errno));\n\t\tabort();\n\t}\n\tfor (i = 0; environ[i] != NULL; i++) {\n\t\tnew_environ[i] = strdup(environ[i]);\n\t}\n\tnew_environ[i] = NULL;\n\tenviron = new_environ;\n#endif /* PS_USE_CLOBBER_ARGV */\n}"
  },
  {
    "function_name": "_init__progname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
    "lines": "244-251",
    "snippet": "static void _init__progname (const char *argv0)\n{\n#if !HAVE__PROGNAME\n\tchar *start = strrchr (argv0, '/');\n\tstrlcpy (__progname, start ? (start + 1) : argv0, sizeof (__progname));\n\treturn;\n#endif /* !HAVE__PROGNAME */\n}",
    "includes": [
      "#include <sys/exec.h>",
      "#include <machine/vmparam.h>\t/* for old BSD */",
      "#include <sys/pstat.h>\t\t/* for HP-UX */",
      "#include \"src/common/strlcpy.h\"",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <errno.h>",
      "#    include \"src/common/malloc.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "__progname",
            "start ? (start + 1) : argv0",
            "sizeof (__progname)"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "argv0",
            "'/'"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\nstatic void _init__progname (const char *argv0)\n{\n#if !HAVE__PROGNAME\n\tchar *start = strrchr (argv0, '/');\n\tstrlcpy (__progname, start ? (start + 1) : argv0, sizeof (__progname));\n\treturn;\n#endif /* !HAVE__PROGNAME */\n}"
  },
  {
    "function_name": "setproctitle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/setproctitle.c",
    "lines": "178-242",
    "snippet": "void\nsetproctitle(const char *fmt, ...)\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tunion pstun pst;\n#endif\n#if SETPROCTITLE_STRATEGY != PS_USE_NONE\n\tssize_t used;\n\tva_list ap;\n\n\t/* no ps display if you didn't call save_ps_display_args() */\n\tif (save_argv == NULL)\n\t\treturn;\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* If ps_buffer is a pointer, it might still be null */\n\tif (ps_buffer == NULL)\n\t\treturn;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Overwrite argv[] to point at appropriate space, if needed\n\t */\n#if SETPROCTITLE_STRATEGY == PS_USE_CHANGE_ARGV\n\tsave_argv[0] = ps_buffer;\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CHANGE_ARGV */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Make fixed prefix of ps display.\n\t */\n\n\tva_start(ap, fmt);\n\tif (fmt == NULL)\n\t\tsnprintf(ps_buffer, ps_buffer_size, \"%s\", __progname);\n\telse {\n\t\tused = snprintf(ps_buffer, ps_buffer_size, \"%s: \", __progname);\n\t\tif (used == -1 || used >= ps_buffer_size)\n\t\t\tused = ps_buffer_size;\n\t\tvsnprintf(ps_buffer + used, ps_buffer_size - used, fmt, ap);\n\t}\n\tva_end(ap);\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tpst.pst_command = ps_buffer;\n\tpstat(PSTAT_SETCMD, pst, strlen(ps_buffer), 0, 0);\n#endif   /* PS_USE_PSTAT */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PS_STRINGS\n\tPS_STRINGS->ps_nargvstr = 1;\n\tPS_STRINGS->ps_argvstr = ps_buffer;\n#endif   /* PS_USE_PS_STRINGS */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* pad unused memory */\n\tused = strlen(ps_buffer);\n\tmemset(ps_buffer + used, SETPROCTITLE_PS_PADDING,\n\t    ps_buffer_size - used);\n#endif   /* PS_USE_CLOBBER_ARGV */\n\n#endif /* PS_USE_NONE */\n}",
    "includes": [
      "#include <sys/exec.h>",
      "#include <machine/vmparam.h>\t/* for old BSD */",
      "#include <sys/pstat.h>\t\t/* for HP-UX */",
      "#include \"src/common/strlcpy.h\"",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdarg.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <errno.h>",
      "#    include \"src/common/malloc.h\"",
      "#  include \"config.h\""
    ],
    "macros_used": [
      "#define PS_USE_CLOBBER_ARGV\t\t4",
      "#define PS_USE_CHANGE_ARGV\t\t3",
      "#define PS_USE_PS_STRINGS\t\t2",
      "#define PS_USE_PSTAT\t\t\t1",
      "#define PS_USE_NONE\t\t\t0"
    ],
    "globals_used": [
      "static char **save_argv;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ps_buffer + used",
            "SETPROCTITLE_PS_PADDING",
            "ps_buffer_size - used"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ps_buffer"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pstat",
          "args": [
            "PSTAT_SETCMD",
            "pst",
            "strlen(ps_buffer)",
            "0",
            "0"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ps_buffer"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vsnprintf",
          "args": [
            "ps_buffer + used",
            "ps_buffer_size - used",
            "fmt",
            "ap"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "ps_buffer",
            "ps_buffer_size",
            "\"%s: \"",
            "__progname"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "ps_buffer",
            "ps_buffer_size",
            "\"%s\"",
            "__progname"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "fmt"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/exec.h>\n#include <machine/vmparam.h>\t/* for old BSD */\n#include <sys/pstat.h>\t\t/* for HP-UX */\n#include \"src/common/strlcpy.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdarg.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#    include \"src/common/malloc.h\"\n#  include \"config.h\"\n\n#define PS_USE_CLOBBER_ARGV\t\t4\n#define PS_USE_CHANGE_ARGV\t\t3\n#define PS_USE_PS_STRINGS\t\t2\n#define PS_USE_PSTAT\t\t\t1\n#define PS_USE_NONE\t\t\t0\n\nstatic char **save_argv;\n\nvoid\nsetproctitle(const char *fmt, ...)\n{\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tunion pstun pst;\n#endif\n#if SETPROCTITLE_STRATEGY != PS_USE_NONE\n\tssize_t used;\n\tva_list ap;\n\n\t/* no ps display if you didn't call save_ps_display_args() */\n\tif (save_argv == NULL)\n\t\treturn;\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* If ps_buffer is a pointer, it might still be null */\n\tif (ps_buffer == NULL)\n\t\treturn;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Overwrite argv[] to point at appropriate space, if needed\n\t */\n#if SETPROCTITLE_STRATEGY == PS_USE_CHANGE_ARGV\n\tsave_argv[0] = ps_buffer;\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CHANGE_ARGV */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\tsave_argv[1] = NULL;\n#endif /* PS_USE_CLOBBER_ARGV */\n\n\t/*\n\t * Make fixed prefix of ps display.\n\t */\n\n\tva_start(ap, fmt);\n\tif (fmt == NULL)\n\t\tsnprintf(ps_buffer, ps_buffer_size, \"%s\", __progname);\n\telse {\n\t\tused = snprintf(ps_buffer, ps_buffer_size, \"%s: \", __progname);\n\t\tif (used == -1 || used >= ps_buffer_size)\n\t\t\tused = ps_buffer_size;\n\t\tvsnprintf(ps_buffer + used, ps_buffer_size - used, fmt, ap);\n\t}\n\tva_end(ap);\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PSTAT\n\tpst.pst_command = ps_buffer;\n\tpstat(PSTAT_SETCMD, pst, strlen(ps_buffer), 0, 0);\n#endif   /* PS_USE_PSTAT */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_PS_STRINGS\n\tPS_STRINGS->ps_nargvstr = 1;\n\tPS_STRINGS->ps_argvstr = ps_buffer;\n#endif   /* PS_USE_PS_STRINGS */\n\n#if SETPROCTITLE_STRATEGY == PS_USE_CLOBBER_ARGV\n\t/* pad unused memory */\n\tused = strlen(ps_buffer);\n\tmemset(ps_buffer + used, SETPROCTITLE_PS_PADDING,\n\t    ps_buffer_size - used);\n#endif   /* PS_USE_CLOBBER_ARGV */\n\n#endif /* PS_USE_NONE */\n}"
  }
]