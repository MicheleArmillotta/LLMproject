[
  {
    "function_name": "_uint32_array_to_str",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "581-598",
    "snippet": "static char *_uint32_array_to_str(int array_len, const uint32_t *array)\n{\n\tint i;\n\tchar *sep = \",\";  /* seperator */\n\tchar *str = xstrdup(\"\");\n\n\tif (array == NULL)\n\t\treturn str;\n\n\tfor (i = 0; i < array_len; i++) {\n\n\t\tif (i == array_len-1) /* last time through loop */\n\t\t\tsep = \"\";\n\t\txstrfmtcat(str, \"%u%s\", array[i], sep);\n\t}\n\n\treturn str;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char *_uint32_array_to_str(int array_len, const uint32_t *array);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xstrfmtcat",
          "args": [
            "str",
            "\"%u%s\"",
            "array[i]",
            "sep"
          ],
          "line": 594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "\"\""
          ],
          "line": 585
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic char *_uint32_array_to_str(int array_len, const uint32_t *array);\n\nstatic char *_uint32_array_to_str(int array_len, const uint32_t *array)\n{\n\tint i;\n\tchar *sep = \",\";  /* seperator */\n\tchar *str = xstrdup(\"\");\n\n\tif (array == NULL)\n\t\treturn str;\n\n\tfor (i = 0; i < array_len; i++) {\n\n\t\tif (i == array_len-1) /* last time through loop */\n\t\t\tsep = \"\";\n\t\txstrfmtcat(str, \"%u%s\", array[i], sep);\n\t}\n\n\treturn str;\n}"
  },
  {
    "function_name": "_make_tmpdir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "532-572",
    "snippet": "static void\n_make_tmpdir(stepd_step_rec_t *job)\n{\n\tchar *tmpdir;\n\n\tif (!(tmpdir = getenvp(job->env, \"TMPDIR\")))\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\"); /* task may want it set */\n\telse if (mkdir(tmpdir, 0700) < 0) {\n\t\tstruct stat st;\n\t\tint mkdir_errno = errno;\n\n\t\tif (stat(tmpdir, &st)) { /* does the file exist ? */\n\t\t\t/* show why we were not able to create it */\n\t\t\terror(\"Unable to create TMPDIR [%s]: %s\",\n\t\t\t      tmpdir, strerror(mkdir_errno));\n\t\t} else if (!S_ISDIR(st.st_mode)) {  /* is it a directory? */\n\t\t\terror(\"TMPDIR [%s] is not a directory\", tmpdir);\n\t\t}\n\n\t\t/* Eaccess wasn't introduced until glibc 2.4 but euidaccess\n\t\t * has been around for a while.  So to make sure we\n\t\t * still work with older systems we include this check.\n\t\t */\n\n#if defined(HAVE_FACCESSAT)\n\t\telse if (faccessat(AT_FDCWD, tmpdir, X_OK|W_OK, AT_EACCESS))\n#elif defined(HAVE_EACCESS)\n\t\telse if (eaccess(tmpdir, X_OK|W_OK)) /* check permissions */\n#else\n\t\telse if (euidaccess(tmpdir, X_OK|W_OK))\n#endif\n\t\t\terror(\"TMPDIR [%s] is not writeable\", tmpdir);\n\t\telse\n\t\t\treturn;\n\n\t\terror(\"Setting TMPDIR to /tmp\");\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\");\n\t}\n\n\treturn;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [
      "#define HAVE_EACCESS 1"
    ],
    "globals_used": [
      "static void  _make_tmpdir(stepd_step_rec_t *job);",
      "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
      "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "setenvf",
          "args": [
            "&job->env",
            "\"TMPDIR\"",
            "\"/tmp\""
          ],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Setting TMPDIR to /tmp\""
          ],
          "line": 567
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"TMPDIR [%s] is not writeable\"",
            "tmpdir"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "st.st_mode"
          ],
          "line": 547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to create TMPDIR [%s]: %s\"",
            "tmpdir",
            "strerror(mkdir_errno)"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "mkdir_errno"
          ],
          "line": 546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "tmpdir",
            "&st"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "986-992",
          "snippet": "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _reclaim_privileges(struct priv_state *state);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mkdir",
          "args": [
            "tmpdir",
            "0700"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setenvf",
          "args": [
            "&job->env",
            "\"TMPDIR\"",
            "\"/tmp\""
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenvp",
          "args": [
            "job->env",
            "\"TMPDIR\""
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\n#define HAVE_EACCESS 1\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic void\n_make_tmpdir(stepd_step_rec_t *job)\n{\n\tchar *tmpdir;\n\n\tif (!(tmpdir = getenvp(job->env, \"TMPDIR\")))\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\"); /* task may want it set */\n\telse if (mkdir(tmpdir, 0700) < 0) {\n\t\tstruct stat st;\n\t\tint mkdir_errno = errno;\n\n\t\tif (stat(tmpdir, &st)) { /* does the file exist ? */\n\t\t\t/* show why we were not able to create it */\n\t\t\terror(\"Unable to create TMPDIR [%s]: %s\",\n\t\t\t      tmpdir, strerror(mkdir_errno));\n\t\t} else if (!S_ISDIR(st.st_mode)) {  /* is it a directory? */\n\t\t\terror(\"TMPDIR [%s] is not a directory\", tmpdir);\n\t\t}\n\n\t\t/* Eaccess wasn't introduced until glibc 2.4 but euidaccess\n\t\t * has been around for a while.  So to make sure we\n\t\t * still work with older systems we include this check.\n\t\t */\n\n#if defined(HAVE_FACCESSAT)\n\t\telse if (faccessat(AT_FDCWD, tmpdir, X_OK|W_OK, AT_EACCESS))\n#elif defined(HAVE_EACCESS)\n\t\telse if (eaccess(tmpdir, X_OK|W_OK)) /* check permissions */\n#else\n\t\telse if (euidaccess(tmpdir, X_OK|W_OK))\n#endif\n\t\t\terror(\"TMPDIR [%s] is not writeable\", tmpdir);\n\t\telse\n\t\t\treturn;\n\n\t\terror(\"Setting TMPDIR to /tmp\");\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\");\n\t}\n\n\treturn;\n}"
  },
  {
    "function_name": "exec_task",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "360-530",
    "snippet": "void\nexec_task(stepd_step_rec_t *job, int i)\n{\n\tuint32_t *gtids;\t\t/* pointer to array of ranks */\n\tint fd, j;\n\tstepd_step_task_info_t *task = job->task[i];\n\tchar **tmp_env;\n\tint saved_errno;\n\n\tif (i == 0)\n\t\t_make_tmpdir(job);\n\n\tgtids = xmalloc(job->node_tasks * sizeof(uint32_t));\n\tfor (j = 0; j < job->node_tasks; j++)\n\t\tgtids[j] = job->task[j]->gtid;\n\tjob->envtp->sgtids = _uint32_array_to_str(job->node_tasks, gtids);\n\txfree(gtids);\n\n\tjob->envtp->jobid = job->jobid;\n\tjob->envtp->stepid = job->stepid;\n\tjob->envtp->nodeid = job->nodeid;\n\tjob->envtp->cpus_on_node = job->cpus;\n\tjob->envtp->procid = task->gtid;\n\tjob->envtp->localid = task->id;\n\tjob->envtp->task_pid = getpid();\n\tjob->envtp->distribution = job->task_dist;\n\tjob->envtp->cpu_bind = xstrdup(job->cpu_bind);\n\tjob->envtp->cpu_bind_type = job->cpu_bind_type;\n\tjob->envtp->cpu_freq_min = job->cpu_freq_min;\n\tjob->envtp->cpu_freq_max = job->cpu_freq_max;\n\tjob->envtp->cpu_freq_gov = job->cpu_freq_gov;\n\tjob->envtp->mem_bind = xstrdup(job->mem_bind);\n\tjob->envtp->mem_bind_type = job->mem_bind_type;\n\tjob->envtp->distribution = -1;\n\tjob->envtp->ckpt_dir = xstrdup(job->ckpt_dir);\n\tjob->envtp->batch_flag = job->batch;\n\tjob->envtp->uid = job->uid;\n\tjob->envtp->user_name = xstrdup(job->user_name);\n\n\t/* Modify copy of job's environment. Do not alter in place or\n\t * concurrent searches of the environment can generate invalid memory\n\t * references. */\n\tjob->envtp->env = env_array_copy((const char **) job->env);\n\tsetup_env(job->envtp, false);\n\tsetenvf(&job->envtp->env, \"SLURMD_NODENAME\", \"%s\", conf->node_name);\n\ttmp_env = job->env;\n\tjob->env = job->envtp->env;\n\tenv_array_free(tmp_env);\n\tjob->envtp->env = NULL;\n\n\txfree(job->envtp->task_count);\n\n\tif (task->argv[0] && *task->argv[0] != '/') {\n\t\t/*\n\t\t * Normally the client (srun) expands the command name\n\t\t * to a fully qualified path, but in --multi-prog mode it\n\t\t * is left up to the server to search the PATH for the\n\t\t * executable.\n\t\t */\n\t\ttask->argv[0] = _build_path(task->argv[0], job->env, NULL);\n\t}\n\n\tif (!job->batch) {\n\t\tif (switch_g_job_attach(job->switch_job, &job->env,\n\t\t\t\t\tjob->nodeid, (uint32_t) i, job->nnodes,\n\t\t\t\t\tjob->ntasks, task->gtid) < 0) {\n\t\t\terror(\"Unable to attach to interconnect: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\n\t\tif (_setup_mpi(job, i) != SLURM_SUCCESS) {\n\t\t\terror(\"Unable to configure MPI plugin: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\t}\n\n\t/* task-specific pre-launch activities */\n\n\t/* task plugin hook */\n\tif (task_g_pre_launch(job)) {\n\t\terror(\"Failed to invoke task plugins: task_p_pre_launch error\");\n\t\texit(1);\n\t}\n\tif (!job->batch && job->accel_bind_type) {\n\t\t/* Modify copy of job's environment. Do not alter in place or\n\t\t * concurrent searches of the environment can generate invalid\n\t\t * memory references. */\n\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\tgres_plugin_step_set_env(&job->envtp->env, job->step_gres_list,\n\t\t\t\t\t job->accel_bind_type);\n\t\ttmp_env = job->env;\n\t\tjob->env = job->envtp->env;\n\t\tenv_array_free(tmp_env);\n\t}\n\n\tif (spank_user_task(job, i) < 0) {\n\t\terror(\"Failed to invoke spank plugin stack\");\n\t\texit(1);\n\t}\n\n\tif (conf->task_prolog) {\n\t\tchar *my_prolog;\n\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\tmy_prolog = xstrdup(conf->task_prolog);\n\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t_run_script_and_set_env(\"slurm task_prolog\",\n\t\t\t\t\tmy_prolog, job);\n\t\txfree(my_prolog);\n\t}\n\tif (job->task_prolog) {\n\t\t_run_script_and_set_env(\"user task_prolog\",\n\t\t\t\t\tjob->task_prolog, job);\n\t}\n\n\tif (!job->batch)\n\t\tpdebug_stop_current(job);\n\tif (job->env == NULL) {\n\t\tdebug(\"job->env is NULL\");\n\t\tjob->env = (char **)xmalloc(sizeof(char *));\n\t\tjob->env[0] = (char *)NULL;\n\t}\n\n\tif (job->restart_dir) {\n\t\tinfo(\"restart from %s\", job->restart_dir);\n\t\t/* no return on success */\n\t\tcheckpoint_restart_task(job, job->restart_dir, task->gtid);\n\t\terror(\"Restart task failed: %m\");\n\t\texit(errno);\n\t}\n\n\tif (task->argv[0] == NULL) {\n\t\terror(\"No executable program specified for this task\");\n\t\texit(2);\n\t}\n\n\t/* Do this last so you don't worry too much about the users\n\t   limits including the slurmstepd in with it.\n\t*/\n\tif (set_user_limits(job) < 0) {\n\t\tdebug(\"Unable to set user limits\");\n\t\tlog_fini();\n\t\texit(5);\n\t}\n\n\texecve(task->argv[0], task->argv, job->env);\n\tsaved_errno = errno;\n\n\t/*\n\t * print error message and clean up if execve() returns:\n\t */\n\tif ((errno == ENOENT) &&\n\t    ((fd = open(task->argv[0], O_RDONLY)) >= 0)) {\n\t\tchar buf[256], *eol;\n\t\tint sz;\n\t\tsz = read(fd, buf, sizeof(buf));\n\t\tif ((sz >= 3) && (xstrncmp(buf, \"#!\", 2) == 0)) {\n\t\t\tbuf[sizeof(buf)-1] = '\\0';\n\t\t\teol = strchr(buf, '\\n');\n\t\t\tif (eol)\n\t\t\t\teol[0] = '\\0';\n\t\t\tslurm_seterrno(saved_errno);\n\t\t\terror(\"execve(): bad interpreter(%s): %m\", buf+2);\n\t\t\texit(errno);\n\t\t}\n\t}\n\tslurm_seterrno(saved_errno);\n\terror(\"execve(): %s: %m\", task->argv[0]);\n\texit(errno);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _make_tmpdir(stepd_step_rec_t *job);",
      "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
      "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);",
      "static char *_uint32_array_to_str(int array_len, const uint32_t *array);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "errno"
          ],
          "line": 529
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"execve(): %s: %m\"",
            "task->argv[0]"
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_seterrno",
          "args": [
            "saved_errno"
          ],
          "line": 527
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_seterrno",
          "args": [
            "saved_errno"
          ],
          "line": 522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "'\\n'"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrncmp",
          "args": [
            "buf",
            "\"#!\"",
            "2"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "buf",
            "sizeof(buf)"
          ],
          "line": 516
        },
        "resolved": true,
        "details": {
          "function_name": "_file_read_content",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/xcgroup.c",
          "lines": "1149-1197",
          "snippet": "int _file_read_content(char* file_path, char** content, size_t *csize)\n{\n\tint fstatus;\n\tint rc;\n\tint fd;\n\n\tsize_t fsize;\n\tchar* buf;\n\n\tfstatus = XCGROUP_ERROR;\n\n\t/* check input pointers */\n\tif (content == NULL || csize == NULL)\n\t\treturn fstatus;\n\n\t/* open file for reading */\n\tfd = open(file_path, O_RDONLY, 0700);\n\tif (fd < 0) {\n\t\tdebug2(\"%s: unable to open '%s' for reading : %m\",\n\t\t\t__func__, file_path);\n\t\treturn fstatus;\n\t}\n\n\t/* get file size */\n\tfsize=_file_getsize(fd);\n\tif (fsize == -1) {\n\t\tclose(fd);\n\t\treturn fstatus;\n\t}\n\n\t/* read file contents */\n\tbuf = (char*) xmalloc((fsize+1)*sizeof(char));\n\tbuf[fsize]='\\0';\n\tdo {\n\t\trc = read(fd, buf, fsize);\n\t} while (rc < 0 && errno == EINTR);\n\n\t/* set output values */\n\tif (rc >= 0) {\n\t\t*content = buf;\n\t\t*csize = rc;\n\t\tfstatus = XCGROUP_SUCCESS;\n\t}\n\n\t/* close file */\n\tclose(fd);\n\n\treturn fstatus;\n}",
          "includes": [
            "#include \"xcgroup.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/log.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include \"slurm/slurm.h\"",
            "#include <sys/mount.h>",
            "#include <dirent.h>",
            "#include <strings.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <sys/file.h>",
            "#  include <inttypes.h>",
            "#  include <stdint.h>",
            "#   include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "size_t _file_getsize(int fd);",
            "int _file_read_content(char* file_path, char** content, size_t *csize);",
            "int _file_write_content(char* file_path, char* content, size_t csize);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"xcgroup.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/log.h\"\n#include \"slurm/slurm_errno.h\"\n#include \"slurm/slurm.h\"\n#include <sys/mount.h>\n#include <dirent.h>\n#include <strings.h>\n#include <string.h>\n#include <stdlib.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <sys/file.h>\n#  include <inttypes.h>\n#  include <stdint.h>\n#   include \"config.h\"\n\nsize_t _file_getsize(int fd);\nint _file_read_content(char* file_path, char** content, size_t *csize);\nint _file_write_content(char* file_path, char* content, size_t csize);\n\nint _file_read_content(char* file_path, char** content, size_t *csize)\n{\n\tint fstatus;\n\tint rc;\n\tint fd;\n\n\tsize_t fsize;\n\tchar* buf;\n\n\tfstatus = XCGROUP_ERROR;\n\n\t/* check input pointers */\n\tif (content == NULL || csize == NULL)\n\t\treturn fstatus;\n\n\t/* open file for reading */\n\tfd = open(file_path, O_RDONLY, 0700);\n\tif (fd < 0) {\n\t\tdebug2(\"%s: unable to open '%s' for reading : %m\",\n\t\t\t__func__, file_path);\n\t\treturn fstatus;\n\t}\n\n\t/* get file size */\n\tfsize=_file_getsize(fd);\n\tif (fsize == -1) {\n\t\tclose(fd);\n\t\treturn fstatus;\n\t}\n\n\t/* read file contents */\n\tbuf = (char*) xmalloc((fsize+1)*sizeof(char));\n\tbuf[fsize]='\\0';\n\tdo {\n\t\trc = read(fd, buf, fsize);\n\t} while (rc < 0 && errno == EINTR);\n\n\t/* set output values */\n\tif (rc >= 0) {\n\t\t*content = buf;\n\t\t*csize = rc;\n\t\tfstatus = XCGROUP_SUCCESS;\n\t}\n\n\t/* close file */\n\tclose(fd);\n\n\treturn fstatus;\n}"
        }
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "task->argv[0]",
            "O_RDONLY"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "execve",
          "args": [
            "task->argv[0]",
            "task->argv",
            "job->env"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_fini",
          "args": [],
          "line": 502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"Unable to set user limits\""
          ],
          "line": 501
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_stop_current",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "120-139",
          "snippet": "void\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid\npdebug_stop_current(stepd_step_rec_t *job)\n{\n\t/*\n\t * Stop the task on exec for TotalView to connect\n\t */\n\tif ( (job->task_flags & TASK_PARALLEL_DEBUG)\n#ifdef BSD\n\t     && (_PTRACE(PT_TRACE_ME, 0, (caddr_t)0, 0) < 0) )\n#elif defined(PT_TRACE_ME)\n\t     && (_PTRACE(PT_TRACE_ME, 0, NULL, 0) < 0) )\n#elif defined(__sun)\n\t     && (_PTRACE(0, 0, NULL, 0) < 0))\n#elif defined(__CYGWIN__)\n\t     && 0)\n#else\n\t     && (_PTRACE(PTRACE_TRACEME, 0, NULL, 0) < 0) )\n#endif\n\t\terror(\"ptrace: %m\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_user_limits",
          "args": [
            "job"
          ],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "set_user_limits",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/ulimits.c",
          "lines": "88-166",
          "snippet": "int set_user_limits(stepd_step_rec_t *job)\n{\n#ifdef RLIMIT_AS\n#define SLURM_RLIMIT_VSIZE RLIMIT_AS\n#define SLURM_RLIMIT_VNAME \"RLIMIT_AS\"\n#elif defined(RLIMIT_DATA)\n/* RLIMIT_DATA is useless on many systems which provide anonymous\n * mmap()'s in addition to brk(), use it here only as a fallback for\n * oddball systems lacking RLIMIT_AS. */\n#define SLURM_RLIMIT_VSIZE RLIMIT_DATA\n#define SLURM_RLIMIT_VNAME \"RLIMIT_DATA\"\n#endif\n\tslurm_rlimits_info_t *rli;\n\tstruct rlimit r;\n\trlim_t task_mem_bytes;\n#ifdef SLURM_RLIMIT_VSIZE\n\tuint16_t vsize_factor;\n#endif\n\n\tif (getrlimit(RLIMIT_CPU, &r) == 0) {\n\t\tif (r.rlim_max != RLIM_INFINITY) {\n\t\t\terror(\"SLURM process CPU time limit is %d seconds\",\n\t\t\t      (int) r.rlim_max);\n\t\t}\n\t}\n\n\tfor (rli = get_slurm_rlimits_info(); rli->name; rli++)\n\t\t_set_limit( job->env, rli );\n\n\t/* Set soft and hard rss and vsize limit for this process,\n\t * handle job limit (for all spawned processes) in slurmd */\n\ttask_mem_bytes  = job->step_mem;\t/* MB */\n\ttask_mem_bytes *= (1024 * 1024);\n\n\t/* Many systems, Linux included, ignore RSS limits, but set it\n\t * here anyway for consistency and to provide a way for\n\t * applications to interrogate what the RSS limit is (with the\n\t * caveat that the real RSS limit is over all job tasks on the\n\t * node and not per process, but hopefully this is better than\n\t * nothing).  */\n#ifdef RLIMIT_RSS\n\tif ((task_mem_bytes) && (getrlimit(RLIMIT_RSS, &r) == 0) &&\n\t    (r.rlim_max > task_mem_bytes)) {\n\t\tr.rlim_max =  r.rlim_cur = task_mem_bytes;\n\t\tif (setrlimit(RLIMIT_RSS, &r)) {\n\t\t\t/* Indicates that limit has already been exceeded */\n\t\t\tfatal(\"setrlimit(RLIMIT_RSS, %u MB): %m\",\n\t\t\t      job->step_mem);\n\t\t} else\n\t\t\tdebug2(\"Set task rss(%u MB)\", job->step_mem);\n#if 0\n\t\tgetrlimit(RLIMIT_RSS, &r);\n\t\tinfo(\"task RSS limits: %u %u\", r.rlim_cur, r.rlim_max);\n#endif\n\t}\n#endif\n\n#ifdef SLURM_RLIMIT_VSIZE\n\tif ((task_mem_bytes) &&\n\t    ((vsize_factor = slurm_get_vsize_factor()) != 0) &&\n\t    (getrlimit(SLURM_RLIMIT_VSIZE, &r) == 0) &&\n\t    (r.rlim_max > task_mem_bytes)) {\n\t\tr.rlim_max = task_mem_bytes * (vsize_factor / 100.0);\n\t\tr.rlim_cur = r.rlim_max;\n\t\tif (setrlimit(SLURM_RLIMIT_VSIZE, &r)) {\n\t\t\t/* Indicates that limit has already been exceeded */\n\t\t\tfatal(\"setrlimit(%s, %u MB): %m\", \n\t\t\t      SLURM_RLIMIT_VNAME, job->step_mem);\n\t\t} else\n\t\t\tdebug2(\"Set task vsize(%u MB)\", job->step_mem);\n#if 0\n\t\tgetrlimit(SLURM_RLIMIT_VSIZE, &r);\n\t\tinfo(\"task VSIZE limits:   %u %u\", r.rlim_cur, r.rlim_max);\n#endif\n\t}\n#endif\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/common/slurm_rlimits_info.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/env.h\" /* For unsetenvp() */",
            "#include \"src/common/log.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/resource.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define SLURM_RLIMIT_VNAME \"RLIMIT_DATA\"",
            "#define SLURM_RLIMIT_VSIZE RLIMIT_DATA",
            "#define SLURM_RLIMIT_VNAME \"RLIMIT_AS\"",
            "#define SLURM_RLIMIT_VSIZE RLIMIT_AS"
          ],
          "globals_used": [
            "static int _set_limit(char **env, slurm_rlimits_info_t *rli);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/common/slurm_rlimits_info.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/env.h\" /* For unsetenvp() */\n#include \"src/common/log.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#  include \"config.h\"\n\n#define SLURM_RLIMIT_VNAME \"RLIMIT_DATA\"\n#define SLURM_RLIMIT_VSIZE RLIMIT_DATA\n#define SLURM_RLIMIT_VNAME \"RLIMIT_AS\"\n#define SLURM_RLIMIT_VSIZE RLIMIT_AS\n\nstatic int _set_limit(char **env, slurm_rlimits_info_t *rli);\n\nint set_user_limits(stepd_step_rec_t *job)\n{\n#ifdef RLIMIT_AS\n#define SLURM_RLIMIT_VSIZE RLIMIT_AS\n#define SLURM_RLIMIT_VNAME \"RLIMIT_AS\"\n#elif defined(RLIMIT_DATA)\n/* RLIMIT_DATA is useless on many systems which provide anonymous\n * mmap()'s in addition to brk(), use it here only as a fallback for\n * oddball systems lacking RLIMIT_AS. */\n#define SLURM_RLIMIT_VSIZE RLIMIT_DATA\n#define SLURM_RLIMIT_VNAME \"RLIMIT_DATA\"\n#endif\n\tslurm_rlimits_info_t *rli;\n\tstruct rlimit r;\n\trlim_t task_mem_bytes;\n#ifdef SLURM_RLIMIT_VSIZE\n\tuint16_t vsize_factor;\n#endif\n\n\tif (getrlimit(RLIMIT_CPU, &r) == 0) {\n\t\tif (r.rlim_max != RLIM_INFINITY) {\n\t\t\terror(\"SLURM process CPU time limit is %d seconds\",\n\t\t\t      (int) r.rlim_max);\n\t\t}\n\t}\n\n\tfor (rli = get_slurm_rlimits_info(); rli->name; rli++)\n\t\t_set_limit( job->env, rli );\n\n\t/* Set soft and hard rss and vsize limit for this process,\n\t * handle job limit (for all spawned processes) in slurmd */\n\ttask_mem_bytes  = job->step_mem;\t/* MB */\n\ttask_mem_bytes *= (1024 * 1024);\n\n\t/* Many systems, Linux included, ignore RSS limits, but set it\n\t * here anyway for consistency and to provide a way for\n\t * applications to interrogate what the RSS limit is (with the\n\t * caveat that the real RSS limit is over all job tasks on the\n\t * node and not per process, but hopefully this is better than\n\t * nothing).  */\n#ifdef RLIMIT_RSS\n\tif ((task_mem_bytes) && (getrlimit(RLIMIT_RSS, &r) == 0) &&\n\t    (r.rlim_max > task_mem_bytes)) {\n\t\tr.rlim_max =  r.rlim_cur = task_mem_bytes;\n\t\tif (setrlimit(RLIMIT_RSS, &r)) {\n\t\t\t/* Indicates that limit has already been exceeded */\n\t\t\tfatal(\"setrlimit(RLIMIT_RSS, %u MB): %m\",\n\t\t\t      job->step_mem);\n\t\t} else\n\t\t\tdebug2(\"Set task rss(%u MB)\", job->step_mem);\n#if 0\n\t\tgetrlimit(RLIMIT_RSS, &r);\n\t\tinfo(\"task RSS limits: %u %u\", r.rlim_cur, r.rlim_max);\n#endif\n\t}\n#endif\n\n#ifdef SLURM_RLIMIT_VSIZE\n\tif ((task_mem_bytes) &&\n\t    ((vsize_factor = slurm_get_vsize_factor()) != 0) &&\n\t    (getrlimit(SLURM_RLIMIT_VSIZE, &r) == 0) &&\n\t    (r.rlim_max > task_mem_bytes)) {\n\t\tr.rlim_max = task_mem_bytes * (vsize_factor / 100.0);\n\t\tr.rlim_cur = r.rlim_max;\n\t\tif (setrlimit(SLURM_RLIMIT_VSIZE, &r)) {\n\t\t\t/* Indicates that limit has already been exceeded */\n\t\t\tfatal(\"setrlimit(%s, %u MB): %m\", \n\t\t\t      SLURM_RLIMIT_VNAME, job->step_mem);\n\t\t} else\n\t\t\tdebug2(\"Set task vsize(%u MB)\", job->step_mem);\n#if 0\n\t\tgetrlimit(SLURM_RLIMIT_VSIZE, &r);\n\t\tinfo(\"task VSIZE limits:   %u %u\", r.rlim_cur, r.rlim_max);\n#endif\n\t}\n#endif\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"No executable program specified for this task\""
          ],
          "line": 493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Restart task failed: %m\""
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkpoint_restart_task",
          "args": [
            "job",
            "job->restart_dir",
            "task->gtid"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "info",
          "args": [
            "\"restart from %s\"",
            "job->restart_dir"
          ],
          "line": 485
        },
        "resolved": true,
        "details": {
          "function_name": "_task_info_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/slurmstepd_job.c",
          "lines": "222-232",
          "snippet": "static void\n_task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog)\n{\n\tslurm_mutex_lock(&t->mutex);\n\tslurm_mutex_unlock(&t->mutex);\n\tslurm_mutex_destroy(&t->mutex);\n\tif (multi_prog) {\n\t\txfree(t->argv);\n\t} /* otherwise, t->argv is a pointer to job->argv */\n\txfree(t);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/slurmstepd/multi_prog.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/uid.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include <sys/types.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <grp.h>",
            "#  include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/slurmstepd/multi_prog.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/uid.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include <sys/types.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <grp.h>\n#  include <string.h>\n#  include \"config.h\"\n\nstatic void _task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog);\n\nstatic void\n_task_info_destroy(stepd_step_task_info_t *t, uint16_t multi_prog)\n{\n\tslurm_mutex_lock(&t->mutex);\n\tslurm_mutex_unlock(&t->mutex);\n\tslurm_mutex_destroy(&t->mutex);\n\tif (multi_prog) {\n\t\txfree(t->argv);\n\t} /* otherwise, t->argv is a pointer to job->argv */\n\txfree(t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "sizeof(char *)"
          ],
          "line": 480
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_run_script_and_set_env",
          "args": [
            "\"user task_prolog\"",
            "job->task_prolog",
            "job"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "_run_script_and_set_env",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "204-282",
          "snippet": "static int\n_run_script_and_set_env(const char *name, const char *path,\n\t\t\tstepd_step_rec_t *job)\n{\n\tint status, rc;\n\tpid_t cpid;\n\tint pfd[2];\n\tchar buf[4096];\n\tFILE *f;\n\n\txassert(job->env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Could not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\tif (pipe(pfd) < 0) {\n\t\terror(\"executing %s: pipe: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = fork()) < 0) {\n\t\terror(\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\targv[0] = xstrdup(path);\n\t\targv[1] = NULL;\n\t\tclose(1);\n\t\tif (dup(pfd[1]) == -1)\n\t\t\terror(\"couldn't do the dup: %m\");\n\t\tclose(2);\n\t\tclose(0);\n\t\tclose(pfd[0]);\n\t\tclose(pfd[1]);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, job->env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tclose(pfd[1]);\n\tf = fdopen(pfd[0], \"r\");\n\tif (f == NULL) {\n\t\terror(\"Cannot open pipe device: %m\");\n\t\tlog_fini();\n\t\texit(1);\n\t}\n\twhile (feof(f) == 0) {\n\t\tif (fgets(buf, sizeof(buf) - 1, f) != NULL) {\n\t\t\t_proc_stdout(buf, job);\n\t\t}\n\t}\n\tfclose(f);\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, 0);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\treturn 0;\n\t\t} else  {\n\t\t\tkillpg(cpid, SIGKILL);  /* kill children too */\n\t\t\treturn status;\n\t\t}\n\t}\n\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _make_tmpdir(stepd_step_rec_t *job);",
            "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
            "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic int\n_run_script_and_set_env(const char *name, const char *path,\n\t\t\tstepd_step_rec_t *job)\n{\n\tint status, rc;\n\tpid_t cpid;\n\tint pfd[2];\n\tchar buf[4096];\n\tFILE *f;\n\n\txassert(job->env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Could not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\tif (pipe(pfd) < 0) {\n\t\terror(\"executing %s: pipe: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = fork()) < 0) {\n\t\terror(\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\targv[0] = xstrdup(path);\n\t\targv[1] = NULL;\n\t\tclose(1);\n\t\tif (dup(pfd[1]) == -1)\n\t\t\terror(\"couldn't do the dup: %m\");\n\t\tclose(2);\n\t\tclose(0);\n\t\tclose(pfd[0]);\n\t\tclose(pfd[1]);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, job->env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tclose(pfd[1]);\n\tf = fdopen(pfd[0], \"r\");\n\tif (f == NULL) {\n\t\terror(\"Cannot open pipe device: %m\");\n\t\tlog_fini();\n\t\texit(1);\n\t}\n\twhile (feof(f) == 0) {\n\t\tif (fgets(buf, sizeof(buf) - 1, f) != NULL) {\n\t\t\t_proc_stdout(buf, job);\n\t\t}\n\t}\n\tfclose(f);\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, 0);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\treturn 0;\n\t\t} else  {\n\t\t\tkillpg(cpid, SIGKILL);  /* kill children too */\n\t\t\treturn status;\n\t\t}\n\t}\n\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "my_prolog"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&conf->config_mutex"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "conf->task_prolog"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&conf->config_mutex"
          ],
          "line": 464
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to invoke spank plugin stack\""
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spank_user_task",
          "args": [
            "job",
            "i"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_array_free",
          "args": [
            "tmp_env"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gres_plugin_step_set_env",
          "args": [
            "&job->envtp->env",
            "job->step_gres_list",
            "job->accel_bind_type"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_array_copy",
          "args": [
            "(const char **) job->env"
          ],
          "line": 449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to invoke task plugins: task_p_pre_launch error\""
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_g_pre_launch",
          "args": [
            "job"
          ],
          "line": 441
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_pre_launch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "369-382",
          "snippet": "extern int task_g_pre_launch(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_launch))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_pre_launch(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_launch))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_fini",
          "args": [],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to configure MPI plugin: %m\""
          ],
          "line": 432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_setup_mpi",
          "args": [
            "job",
            "i"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "_setup_mpi",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "337-354",
          "snippet": "static int\n_setup_mpi(stepd_step_rec_t *job, int ltaskid)\n{\n\tmpi_plugin_task_info_t info[1];\n\n\tinfo->jobid = job->jobid;\n\tinfo->stepid = job->stepid;\n\tinfo->nnodes = job->nnodes;\n\tinfo->nodeid = job->nodeid;\n\tinfo->ntasks = job->ntasks;\n\tinfo->ltasks = job->node_tasks;\n\tinfo->gtaskid = job->task[ltaskid]->gtid;\n\tinfo->ltaskid = job->task[ltaskid]->id;\n\tinfo->self = job->envtp->self;\n\tinfo->client = job->envtp->cli;\n\n\treturn mpi_hook_slurmstepd_task(info, &job->env);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _make_tmpdir(stepd_step_rec_t *job);",
            "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
            "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic int\n_setup_mpi(stepd_step_rec_t *job, int ltaskid)\n{\n\tmpi_plugin_task_info_t info[1];\n\n\tinfo->jobid = job->jobid;\n\tinfo->stepid = job->stepid;\n\tinfo->nnodes = job->nnodes;\n\tinfo->nodeid = job->nodeid;\n\tinfo->ntasks = job->ntasks;\n\tinfo->ltasks = job->node_tasks;\n\tinfo->gtaskid = job->task[ltaskid]->gtid;\n\tinfo->ltaskid = job->task[ltaskid]->id;\n\tinfo->self = job->envtp->self;\n\tinfo->client = job->envtp->cli;\n\n\treturn mpi_hook_slurmstepd_task(info, &job->env);\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_fini",
          "args": [],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to attach to interconnect: %m\""
          ],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "switch_g_job_attach",
          "args": [
            "job->switch_job",
            "&job->env",
            "job->nodeid",
            "(uint32_t) i",
            "job->nnodes",
            "job->ntasks",
            "task->gtid"
          ],
          "line": 423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_build_path",
          "args": [
            "task->argv[0]",
            "job->env",
            "NULL"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "_build_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "287-335",
          "snippet": "extern char *_build_path(char *fname, char **prog_env, char *cwd)\n{\n\tchar *path_env = NULL, *dir;\n\tchar *file_name;\n\tstruct stat stat_buf;\n\tint len = PATH_MAX;\n\n\tif (!fname)\n\t\treturn NULL;\n\n\tfile_name = (char *) xmalloc(len);\n\n\t/* check if already absolute path */\n\tif (fname[0] == '/') {\n\t\t/* copy and ensure null termination */\n\t\tstrlcpy(file_name, fname, len);\n\t\treturn file_name;\n\t}\n\n\tif (fname[0] == '.') {\n\t\tif (cwd) {\n\t\t\tsnprintf(file_name, len, \"%s/%s\", cwd, fname);\n\t\t} else {\n\t\t\tdir = (char *) xmalloc(len);\n\t\t\tif (!getcwd(dir, len))\n\t\t\t\terror(\"getcwd failed: %m\");\n\t\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\t\txfree(dir);\n\t\t}\n\t\treturn file_name;\n\t}\n\n\t/* search for the file using PATH environment variable */\n\tpath_env = xstrdup(getenvp(prog_env, \"PATH\"));\n\n\tdir = strtok(path_env, \":\");\n\twhile (dir) {\n\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\tif ((stat(file_name, &stat_buf) == 0)\n\t\t    && (! S_ISDIR(stat_buf.st_mode)))\n\t\t\tbreak;\n\t\tdir = strtok(NULL, \":\");\n\t}\n\tif (dir == NULL)\t/* not found */\n\t\tstrlcpy(file_name, fname, len);\n\n\txfree(path_env);\n\treturn file_name;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nextern char *_build_path(char *fname, char **prog_env, char *cwd)\n{\n\tchar *path_env = NULL, *dir;\n\tchar *file_name;\n\tstruct stat stat_buf;\n\tint len = PATH_MAX;\n\n\tif (!fname)\n\t\treturn NULL;\n\n\tfile_name = (char *) xmalloc(len);\n\n\t/* check if already absolute path */\n\tif (fname[0] == '/') {\n\t\t/* copy and ensure null termination */\n\t\tstrlcpy(file_name, fname, len);\n\t\treturn file_name;\n\t}\n\n\tif (fname[0] == '.') {\n\t\tif (cwd) {\n\t\t\tsnprintf(file_name, len, \"%s/%s\", cwd, fname);\n\t\t} else {\n\t\t\tdir = (char *) xmalloc(len);\n\t\t\tif (!getcwd(dir, len))\n\t\t\t\terror(\"getcwd failed: %m\");\n\t\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\t\txfree(dir);\n\t\t}\n\t\treturn file_name;\n\t}\n\n\t/* search for the file using PATH environment variable */\n\tpath_env = xstrdup(getenvp(prog_env, \"PATH\"));\n\n\tdir = strtok(path_env, \":\");\n\twhile (dir) {\n\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\tif ((stat(file_name, &stat_buf) == 0)\n\t\t    && (! S_ISDIR(stat_buf.st_mode)))\n\t\t\tbreak;\n\t\tdir = strtok(NULL, \":\");\n\t}\n\tif (dir == NULL)\t/* not found */\n\t\tstrlcpy(file_name, fname, len);\n\n\txfree(path_env);\n\treturn file_name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "env_array_free",
          "args": [
            "tmp_env"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setenvf",
          "args": [
            "&job->envtp->env",
            "\"SLURMD_NODENAME\"",
            "\"%s\"",
            "conf->node_name"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_env",
          "args": [
            "job->envtp",
            "false"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "env_array_copy",
          "args": [
            "(const char **) job->env"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "job->user_name"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "job->ckpt_dir"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "job->mem_bind"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "job->cpu_bind"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_uint32_array_to_str",
          "args": [
            "job->node_tasks",
            "gtids"
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "_uint32_array_to_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "581-598",
          "snippet": "static char *_uint32_array_to_str(int array_len, const uint32_t *array)\n{\n\tint i;\n\tchar *sep = \",\";  /* seperator */\n\tchar *str = xstrdup(\"\");\n\n\tif (array == NULL)\n\t\treturn str;\n\n\tfor (i = 0; i < array_len; i++) {\n\n\t\tif (i == array_len-1) /* last time through loop */\n\t\t\tsep = \"\";\n\t\txstrfmtcat(str, \"%u%s\", array[i], sep);\n\t}\n\n\treturn str;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static char *_uint32_array_to_str(int array_len, const uint32_t *array);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic char *_uint32_array_to_str(int array_len, const uint32_t *array);\n\nstatic char *_uint32_array_to_str(int array_len, const uint32_t *array)\n{\n\tint i;\n\tchar *sep = \",\";  /* seperator */\n\tchar *str = xstrdup(\"\");\n\n\tif (array == NULL)\n\t\treturn str;\n\n\tfor (i = 0; i < array_len; i++) {\n\n\t\tif (i == array_len-1) /* last time through loop */\n\t\t\tsep = \"\";\n\t\txstrfmtcat(str, \"%u%s\", array[i], sep);\n\t}\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "job->node_tasks * sizeof(uint32_t)"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_make_tmpdir",
          "args": [
            "job"
          ],
          "line": 370
        },
        "resolved": true,
        "details": {
          "function_name": "_make_tmpdir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "532-572",
          "snippet": "static void\n_make_tmpdir(stepd_step_rec_t *job)\n{\n\tchar *tmpdir;\n\n\tif (!(tmpdir = getenvp(job->env, \"TMPDIR\")))\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\"); /* task may want it set */\n\telse if (mkdir(tmpdir, 0700) < 0) {\n\t\tstruct stat st;\n\t\tint mkdir_errno = errno;\n\n\t\tif (stat(tmpdir, &st)) { /* does the file exist ? */\n\t\t\t/* show why we were not able to create it */\n\t\t\terror(\"Unable to create TMPDIR [%s]: %s\",\n\t\t\t      tmpdir, strerror(mkdir_errno));\n\t\t} else if (!S_ISDIR(st.st_mode)) {  /* is it a directory? */\n\t\t\terror(\"TMPDIR [%s] is not a directory\", tmpdir);\n\t\t}\n\n\t\t/* Eaccess wasn't introduced until glibc 2.4 but euidaccess\n\t\t * has been around for a while.  So to make sure we\n\t\t * still work with older systems we include this check.\n\t\t */\n\n#if defined(HAVE_FACCESSAT)\n\t\telse if (faccessat(AT_FDCWD, tmpdir, X_OK|W_OK, AT_EACCESS))\n#elif defined(HAVE_EACCESS)\n\t\telse if (eaccess(tmpdir, X_OK|W_OK)) /* check permissions */\n#else\n\t\telse if (euidaccess(tmpdir, X_OK|W_OK))\n#endif\n\t\t\terror(\"TMPDIR [%s] is not writeable\", tmpdir);\n\t\telse\n\t\t\treturn;\n\n\t\terror(\"Setting TMPDIR to /tmp\");\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\");\n\t}\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [
            "#define HAVE_EACCESS 1"
          ],
          "globals_used": [
            "static void  _make_tmpdir(stepd_step_rec_t *job);",
            "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
            "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\n#define HAVE_EACCESS 1\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic void\n_make_tmpdir(stepd_step_rec_t *job)\n{\n\tchar *tmpdir;\n\n\tif (!(tmpdir = getenvp(job->env, \"TMPDIR\")))\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\"); /* task may want it set */\n\telse if (mkdir(tmpdir, 0700) < 0) {\n\t\tstruct stat st;\n\t\tint mkdir_errno = errno;\n\n\t\tif (stat(tmpdir, &st)) { /* does the file exist ? */\n\t\t\t/* show why we were not able to create it */\n\t\t\terror(\"Unable to create TMPDIR [%s]: %s\",\n\t\t\t      tmpdir, strerror(mkdir_errno));\n\t\t} else if (!S_ISDIR(st.st_mode)) {  /* is it a directory? */\n\t\t\terror(\"TMPDIR [%s] is not a directory\", tmpdir);\n\t\t}\n\n\t\t/* Eaccess wasn't introduced until glibc 2.4 but euidaccess\n\t\t * has been around for a while.  So to make sure we\n\t\t * still work with older systems we include this check.\n\t\t */\n\n#if defined(HAVE_FACCESSAT)\n\t\telse if (faccessat(AT_FDCWD, tmpdir, X_OK|W_OK, AT_EACCESS))\n#elif defined(HAVE_EACCESS)\n\t\telse if (eaccess(tmpdir, X_OK|W_OK)) /* check permissions */\n#else\n\t\telse if (euidaccess(tmpdir, X_OK|W_OK))\n#endif\n\t\t\terror(\"TMPDIR [%s] is not writeable\", tmpdir);\n\t\telse\n\t\t\treturn;\n\n\t\terror(\"Setting TMPDIR to /tmp\");\n\t\tsetenvf(&job->env, \"TMPDIR\", \"/tmp\");\n\t}\n\n\treturn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\nstatic char *_uint32_array_to_str(int array_len, const uint32_t *array);\n\nvoid\nexec_task(stepd_step_rec_t *job, int i)\n{\n\tuint32_t *gtids;\t\t/* pointer to array of ranks */\n\tint fd, j;\n\tstepd_step_task_info_t *task = job->task[i];\n\tchar **tmp_env;\n\tint saved_errno;\n\n\tif (i == 0)\n\t\t_make_tmpdir(job);\n\n\tgtids = xmalloc(job->node_tasks * sizeof(uint32_t));\n\tfor (j = 0; j < job->node_tasks; j++)\n\t\tgtids[j] = job->task[j]->gtid;\n\tjob->envtp->sgtids = _uint32_array_to_str(job->node_tasks, gtids);\n\txfree(gtids);\n\n\tjob->envtp->jobid = job->jobid;\n\tjob->envtp->stepid = job->stepid;\n\tjob->envtp->nodeid = job->nodeid;\n\tjob->envtp->cpus_on_node = job->cpus;\n\tjob->envtp->procid = task->gtid;\n\tjob->envtp->localid = task->id;\n\tjob->envtp->task_pid = getpid();\n\tjob->envtp->distribution = job->task_dist;\n\tjob->envtp->cpu_bind = xstrdup(job->cpu_bind);\n\tjob->envtp->cpu_bind_type = job->cpu_bind_type;\n\tjob->envtp->cpu_freq_min = job->cpu_freq_min;\n\tjob->envtp->cpu_freq_max = job->cpu_freq_max;\n\tjob->envtp->cpu_freq_gov = job->cpu_freq_gov;\n\tjob->envtp->mem_bind = xstrdup(job->mem_bind);\n\tjob->envtp->mem_bind_type = job->mem_bind_type;\n\tjob->envtp->distribution = -1;\n\tjob->envtp->ckpt_dir = xstrdup(job->ckpt_dir);\n\tjob->envtp->batch_flag = job->batch;\n\tjob->envtp->uid = job->uid;\n\tjob->envtp->user_name = xstrdup(job->user_name);\n\n\t/* Modify copy of job's environment. Do not alter in place or\n\t * concurrent searches of the environment can generate invalid memory\n\t * references. */\n\tjob->envtp->env = env_array_copy((const char **) job->env);\n\tsetup_env(job->envtp, false);\n\tsetenvf(&job->envtp->env, \"SLURMD_NODENAME\", \"%s\", conf->node_name);\n\ttmp_env = job->env;\n\tjob->env = job->envtp->env;\n\tenv_array_free(tmp_env);\n\tjob->envtp->env = NULL;\n\n\txfree(job->envtp->task_count);\n\n\tif (task->argv[0] && *task->argv[0] != '/') {\n\t\t/*\n\t\t * Normally the client (srun) expands the command name\n\t\t * to a fully qualified path, but in --multi-prog mode it\n\t\t * is left up to the server to search the PATH for the\n\t\t * executable.\n\t\t */\n\t\ttask->argv[0] = _build_path(task->argv[0], job->env, NULL);\n\t}\n\n\tif (!job->batch) {\n\t\tif (switch_g_job_attach(job->switch_job, &job->env,\n\t\t\t\t\tjob->nodeid, (uint32_t) i, job->nnodes,\n\t\t\t\t\tjob->ntasks, task->gtid) < 0) {\n\t\t\terror(\"Unable to attach to interconnect: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\n\t\tif (_setup_mpi(job, i) != SLURM_SUCCESS) {\n\t\t\terror(\"Unable to configure MPI plugin: %m\");\n\t\t\tlog_fini();\n\t\t\texit(1);\n\t\t}\n\t}\n\n\t/* task-specific pre-launch activities */\n\n\t/* task plugin hook */\n\tif (task_g_pre_launch(job)) {\n\t\terror(\"Failed to invoke task plugins: task_p_pre_launch error\");\n\t\texit(1);\n\t}\n\tif (!job->batch && job->accel_bind_type) {\n\t\t/* Modify copy of job's environment. Do not alter in place or\n\t\t * concurrent searches of the environment can generate invalid\n\t\t * memory references. */\n\t\tjob->envtp->env = env_array_copy((const char **) job->env);\n\t\tgres_plugin_step_set_env(&job->envtp->env, job->step_gres_list,\n\t\t\t\t\t job->accel_bind_type);\n\t\ttmp_env = job->env;\n\t\tjob->env = job->envtp->env;\n\t\tenv_array_free(tmp_env);\n\t}\n\n\tif (spank_user_task(job, i) < 0) {\n\t\terror(\"Failed to invoke spank plugin stack\");\n\t\texit(1);\n\t}\n\n\tif (conf->task_prolog) {\n\t\tchar *my_prolog;\n\t\tslurm_mutex_lock(&conf->config_mutex);\n\t\tmy_prolog = xstrdup(conf->task_prolog);\n\t\tslurm_mutex_unlock(&conf->config_mutex);\n\t\t_run_script_and_set_env(\"slurm task_prolog\",\n\t\t\t\t\tmy_prolog, job);\n\t\txfree(my_prolog);\n\t}\n\tif (job->task_prolog) {\n\t\t_run_script_and_set_env(\"user task_prolog\",\n\t\t\t\t\tjob->task_prolog, job);\n\t}\n\n\tif (!job->batch)\n\t\tpdebug_stop_current(job);\n\tif (job->env == NULL) {\n\t\tdebug(\"job->env is NULL\");\n\t\tjob->env = (char **)xmalloc(sizeof(char *));\n\t\tjob->env[0] = (char *)NULL;\n\t}\n\n\tif (job->restart_dir) {\n\t\tinfo(\"restart from %s\", job->restart_dir);\n\t\t/* no return on success */\n\t\tcheckpoint_restart_task(job, job->restart_dir, task->gtid);\n\t\terror(\"Restart task failed: %m\");\n\t\texit(errno);\n\t}\n\n\tif (task->argv[0] == NULL) {\n\t\terror(\"No executable program specified for this task\");\n\t\texit(2);\n\t}\n\n\t/* Do this last so you don't worry too much about the users\n\t   limits including the slurmstepd in with it.\n\t*/\n\tif (set_user_limits(job) < 0) {\n\t\tdebug(\"Unable to set user limits\");\n\t\tlog_fini();\n\t\texit(5);\n\t}\n\n\texecve(task->argv[0], task->argv, job->env);\n\tsaved_errno = errno;\n\n\t/*\n\t * print error message and clean up if execve() returns:\n\t */\n\tif ((errno == ENOENT) &&\n\t    ((fd = open(task->argv[0], O_RDONLY)) >= 0)) {\n\t\tchar buf[256], *eol;\n\t\tint sz;\n\t\tsz = read(fd, buf, sizeof(buf));\n\t\tif ((sz >= 3) && (xstrncmp(buf, \"#!\", 2) == 0)) {\n\t\t\tbuf[sizeof(buf)-1] = '\\0';\n\t\t\teol = strchr(buf, '\\n');\n\t\t\tif (eol)\n\t\t\t\teol[0] = '\\0';\n\t\t\tslurm_seterrno(saved_errno);\n\t\t\terror(\"execve(): bad interpreter(%s): %m\", buf+2);\n\t\t\texit(errno);\n\t\t}\n\t}\n\tslurm_seterrno(saved_errno);\n\terror(\"execve(): %s: %m\", task->argv[0]);\n\texit(errno);\n}"
  },
  {
    "function_name": "_setup_mpi",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "337-354",
    "snippet": "static int\n_setup_mpi(stepd_step_rec_t *job, int ltaskid)\n{\n\tmpi_plugin_task_info_t info[1];\n\n\tinfo->jobid = job->jobid;\n\tinfo->stepid = job->stepid;\n\tinfo->nnodes = job->nnodes;\n\tinfo->nodeid = job->nodeid;\n\tinfo->ntasks = job->ntasks;\n\tinfo->ltasks = job->node_tasks;\n\tinfo->gtaskid = job->task[ltaskid]->gtid;\n\tinfo->ltaskid = job->task[ltaskid]->id;\n\tinfo->self = job->envtp->self;\n\tinfo->client = job->envtp->cli;\n\n\treturn mpi_hook_slurmstepd_task(info, &job->env);\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _make_tmpdir(stepd_step_rec_t *job);",
      "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
      "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "mpi_hook_slurmstepd_task",
          "args": [
            "info",
            "&job->env"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic int\n_setup_mpi(stepd_step_rec_t *job, int ltaskid)\n{\n\tmpi_plugin_task_info_t info[1];\n\n\tinfo->jobid = job->jobid;\n\tinfo->stepid = job->stepid;\n\tinfo->nnodes = job->nnodes;\n\tinfo->nodeid = job->nodeid;\n\tinfo->ntasks = job->ntasks;\n\tinfo->ltasks = job->node_tasks;\n\tinfo->gtaskid = job->task[ltaskid]->gtid;\n\tinfo->ltaskid = job->task[ltaskid]->id;\n\tinfo->self = job->envtp->self;\n\tinfo->client = job->envtp->cli;\n\n\treturn mpi_hook_slurmstepd_task(info, &job->env);\n}"
  },
  {
    "function_name": "_build_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "287-335",
    "snippet": "extern char *_build_path(char *fname, char **prog_env, char *cwd)\n{\n\tchar *path_env = NULL, *dir;\n\tchar *file_name;\n\tstruct stat stat_buf;\n\tint len = PATH_MAX;\n\n\tif (!fname)\n\t\treturn NULL;\n\n\tfile_name = (char *) xmalloc(len);\n\n\t/* check if already absolute path */\n\tif (fname[0] == '/') {\n\t\t/* copy and ensure null termination */\n\t\tstrlcpy(file_name, fname, len);\n\t\treturn file_name;\n\t}\n\n\tif (fname[0] == '.') {\n\t\tif (cwd) {\n\t\t\tsnprintf(file_name, len, \"%s/%s\", cwd, fname);\n\t\t} else {\n\t\t\tdir = (char *) xmalloc(len);\n\t\t\tif (!getcwd(dir, len))\n\t\t\t\terror(\"getcwd failed: %m\");\n\t\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\t\txfree(dir);\n\t\t}\n\t\treturn file_name;\n\t}\n\n\t/* search for the file using PATH environment variable */\n\tpath_env = xstrdup(getenvp(prog_env, \"PATH\"));\n\n\tdir = strtok(path_env, \":\");\n\twhile (dir) {\n\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\tif ((stat(file_name, &stat_buf) == 0)\n\t\t    && (! S_ISDIR(stat_buf.st_mode)))\n\t\t\tbreak;\n\t\tdir = strtok(NULL, \":\");\n\t}\n\tif (dir == NULL)\t/* not found */\n\t\tstrlcpy(file_name, fname, len);\n\n\txfree(path_env);\n\treturn file_name;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "path_env"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "file_name",
            "fname",
            "len"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "NULL",
            "\":\""
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "stat_buf.st_mode"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "file_name",
            "&stat_buf"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "_set_job_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "986-992",
          "snippet": "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _reclaim_privileges(struct priv_state *state);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _reclaim_privileges(struct priv_state *state);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic void _set_job_state(stepd_step_rec_t *job, slurmstepd_state_t new_state)\n{\n\tslurm_mutex_lock(&job->state_mutex);\n\tjob->state = new_state;\n\tpthread_cond_signal(&job->state_cond);\n\tslurm_mutex_unlock(&job->state_mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "file_name",
            "len",
            "\"%s/%s\"",
            "dir",
            "fname"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "path_env",
            "\":\""
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "getenvp(prog_env, \"PATH\")"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenvp",
          "args": [
            "prog_env",
            "\"PATH\""
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "file_name",
            "len",
            "\"%s/%s\"",
            "dir",
            "fname"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"getcwd failed: %m\""
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getcwd",
          "args": [
            "dir",
            "len"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "len"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "file_name",
            "len",
            "\"%s/%s\"",
            "cwd",
            "fname"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "file_name",
            "fname",
            "len"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmalloc",
          "args": [
            "len"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nextern char *_build_path(char *fname, char **prog_env, char *cwd)\n{\n\tchar *path_env = NULL, *dir;\n\tchar *file_name;\n\tstruct stat stat_buf;\n\tint len = PATH_MAX;\n\n\tif (!fname)\n\t\treturn NULL;\n\n\tfile_name = (char *) xmalloc(len);\n\n\t/* check if already absolute path */\n\tif (fname[0] == '/') {\n\t\t/* copy and ensure null termination */\n\t\tstrlcpy(file_name, fname, len);\n\t\treturn file_name;\n\t}\n\n\tif (fname[0] == '.') {\n\t\tif (cwd) {\n\t\t\tsnprintf(file_name, len, \"%s/%s\", cwd, fname);\n\t\t} else {\n\t\t\tdir = (char *) xmalloc(len);\n\t\t\tif (!getcwd(dir, len))\n\t\t\t\terror(\"getcwd failed: %m\");\n\t\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\t\txfree(dir);\n\t\t}\n\t\treturn file_name;\n\t}\n\n\t/* search for the file using PATH environment variable */\n\tpath_env = xstrdup(getenvp(prog_env, \"PATH\"));\n\n\tdir = strtok(path_env, \":\");\n\twhile (dir) {\n\t\tsnprintf(file_name, len, \"%s/%s\", dir, fname);\n\t\tif ((stat(file_name, &stat_buf) == 0)\n\t\t    && (! S_ISDIR(stat_buf.st_mode)))\n\t\t\tbreak;\n\t\tdir = strtok(NULL, \":\");\n\t}\n\tif (dir == NULL)\t/* not found */\n\t\tstrlcpy(file_name, fname, len);\n\n\txfree(path_env);\n\treturn file_name;\n}"
  },
  {
    "function_name": "_run_script_and_set_env",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "204-282",
    "snippet": "static int\n_run_script_and_set_env(const char *name, const char *path,\n\t\t\tstepd_step_rec_t *job)\n{\n\tint status, rc;\n\tpid_t cpid;\n\tint pfd[2];\n\tchar buf[4096];\n\tFILE *f;\n\n\txassert(job->env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Could not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\tif (pipe(pfd) < 0) {\n\t\terror(\"executing %s: pipe: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = fork()) < 0) {\n\t\terror(\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\targv[0] = xstrdup(path);\n\t\targv[1] = NULL;\n\t\tclose(1);\n\t\tif (dup(pfd[1]) == -1)\n\t\t\terror(\"couldn't do the dup: %m\");\n\t\tclose(2);\n\t\tclose(0);\n\t\tclose(pfd[0]);\n\t\tclose(pfd[1]);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, job->env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tclose(pfd[1]);\n\tf = fdopen(pfd[0], \"r\");\n\tif (f == NULL) {\n\t\terror(\"Cannot open pipe device: %m\");\n\t\tlog_fini();\n\t\texit(1);\n\t}\n\twhile (feof(f) == 0) {\n\t\tif (fgets(buf, sizeof(buf) - 1, f) != NULL) {\n\t\t\t_proc_stdout(buf, job);\n\t\t}\n\t}\n\tfclose(f);\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, 0);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\treturn 0;\n\t\t} else  {\n\t\t\tkillpg(cpid, SIGKILL);  /* kill children too */\n\t\t\treturn status;\n\t\t}\n\t}\n\n\t/* NOTREACHED */\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _make_tmpdir(stepd_step_rec_t *job);",
      "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
      "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "killpg",
          "args": [
            "cpid",
            "SIGKILL"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"waidpid: %m\""
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "cpid",
            "&status",
            "0"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "f"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_proc_stdout",
          "args": [
            "buf",
            "job"
          ],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "_proc_stdout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
          "lines": "116-192",
          "snippet": "static void _proc_stdout(char *buf, stepd_step_rec_t *job)\n{\n\tbool end_buf = false;\n\tint len;\n\tchar *buf_ptr, *name_ptr, *val_ptr;\n\tchar *end_line, *equal_ptr;\n\tchar ***env = &job->env;\n\n\tbuf_ptr = buf;\n\twhile (buf_ptr[0]) {\n\t\tend_line = strchr(buf_ptr, '\\n');\n\t\tif (!end_line) {\n\t\t\tend_line = buf_ptr + strlen(buf_ptr);\n\t\t\tend_buf = true;\n\t\t}\n\t\tif (!xstrncmp(buf_ptr, \"print \", 6)) {\n\t\t\tbuf_ptr += 6;\n\t\t\twhile (isspace(buf_ptr[0]))\n\t\t\t\tbuf_ptr++;\n\t\t\tlen = end_line - buf_ptr + 1;\n\t\t\tsafe_write(1, buf_ptr, len);\n\t\t} else if (!xstrncmp(buf_ptr, \"export \",7)) {\n\t\t\tname_ptr = buf_ptr + 7;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tequal_ptr = strchr(name_ptr, '=');\n\t\t\tif (!equal_ptr || (equal_ptr > end_line))\n\t\t\t\tgoto rwfail;\n\t\t\tval_ptr = equal_ptr + 1;\n\t\t\twhile (isspace(equal_ptr[-1]))\n\t\t\t\tequal_ptr--;\n\t\t\tequal_ptr[0] = '\\0';\n\t\t\tend_line[0] = '\\0';\n\t\t\tif (!xstrcmp(name_ptr, \"SLURM_PROLOG_CPU_MASK\")) {\n\t\t\t\tjob->cpu_bind_type = CPU_BIND_MASK;\n\t\t\t\txfree(job->cpu_bind);\n\t\t\t\tjob->cpu_bind = xstrdup(val_ptr);\n\t\t\t\tif (task_g_pre_launch(job)) {\n\t\t\t\t\terror(\"Failed SLURM_PROLOG_CPU_MASK \"\n\t\t\t\t\t      \"setup\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdebug(\"export name:%s:val:%s:\", name_ptr, val_ptr);\n\t\t\tif (setenvf(env, name_ptr, \"%s\", val_ptr)) {\n\t\t\t\terror(\"Unable to set %s environment variable\",\n\t\t\t\t      buf_ptr);\n\t\t\t}\n\t\t\tequal_ptr[0] = '=';\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t} else if (!xstrncmp(buf_ptr, \"unset \", 6)) {\n\t\t\tname_ptr = buf_ptr + 6;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tif ((name_ptr[0] == '\\n') || (name_ptr[0] == '\\0'))\n\t\t\t\tgoto rwfail;\n\t\t\twhile (isspace(end_line[-1]))\n\t\t\t\tend_line--;\n\t\t\tend_line[0] = '\\0';\n\t\t\tdebug(\" unset name:%s:\", name_ptr);\n\t\t\tunsetenvp(*env, name_ptr);\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t}\n\nrwfail:\t\t /* process rest of script output */\n\t\tif (end_buf)\n\t\t\tbreak;\n\t\tbuf_ptr = end_line + 1;\n\t}\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/strlcpy.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/checkpoint.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <sys/resource.h>",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/types.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <pwd.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _make_tmpdir(stepd_step_rec_t *job);",
            "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
            "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic void _proc_stdout(char *buf, stepd_step_rec_t *job)\n{\n\tbool end_buf = false;\n\tint len;\n\tchar *buf_ptr, *name_ptr, *val_ptr;\n\tchar *end_line, *equal_ptr;\n\tchar ***env = &job->env;\n\n\tbuf_ptr = buf;\n\twhile (buf_ptr[0]) {\n\t\tend_line = strchr(buf_ptr, '\\n');\n\t\tif (!end_line) {\n\t\t\tend_line = buf_ptr + strlen(buf_ptr);\n\t\t\tend_buf = true;\n\t\t}\n\t\tif (!xstrncmp(buf_ptr, \"print \", 6)) {\n\t\t\tbuf_ptr += 6;\n\t\t\twhile (isspace(buf_ptr[0]))\n\t\t\t\tbuf_ptr++;\n\t\t\tlen = end_line - buf_ptr + 1;\n\t\t\tsafe_write(1, buf_ptr, len);\n\t\t} else if (!xstrncmp(buf_ptr, \"export \",7)) {\n\t\t\tname_ptr = buf_ptr + 7;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tequal_ptr = strchr(name_ptr, '=');\n\t\t\tif (!equal_ptr || (equal_ptr > end_line))\n\t\t\t\tgoto rwfail;\n\t\t\tval_ptr = equal_ptr + 1;\n\t\t\twhile (isspace(equal_ptr[-1]))\n\t\t\t\tequal_ptr--;\n\t\t\tequal_ptr[0] = '\\0';\n\t\t\tend_line[0] = '\\0';\n\t\t\tif (!xstrcmp(name_ptr, \"SLURM_PROLOG_CPU_MASK\")) {\n\t\t\t\tjob->cpu_bind_type = CPU_BIND_MASK;\n\t\t\t\txfree(job->cpu_bind);\n\t\t\t\tjob->cpu_bind = xstrdup(val_ptr);\n\t\t\t\tif (task_g_pre_launch(job)) {\n\t\t\t\t\terror(\"Failed SLURM_PROLOG_CPU_MASK \"\n\t\t\t\t\t      \"setup\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdebug(\"export name:%s:val:%s:\", name_ptr, val_ptr);\n\t\t\tif (setenvf(env, name_ptr, \"%s\", val_ptr)) {\n\t\t\t\terror(\"Unable to set %s environment variable\",\n\t\t\t\t      buf_ptr);\n\t\t\t}\n\t\t\tequal_ptr[0] = '=';\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t} else if (!xstrncmp(buf_ptr, \"unset \", 6)) {\n\t\t\tname_ptr = buf_ptr + 6;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tif ((name_ptr[0] == '\\n') || (name_ptr[0] == '\\0'))\n\t\t\t\tgoto rwfail;\n\t\t\twhile (isspace(end_line[-1]))\n\t\t\t\tend_line--;\n\t\t\tend_line[0] = '\\0';\n\t\t\tdebug(\" unset name:%s:\", name_ptr);\n\t\t\tunsetenvp(*env, name_ptr);\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t}\n\nrwfail:\t\t /* process rest of script output */\n\t\tif (end_buf)\n\t\t\tbreak;\n\t\tbuf_ptr = end_line + 1;\n\t}\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "sizeof(buf) - 1",
            "f"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "feof",
          "args": [
            "f"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_fini",
          "args": [],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Cannot open pipe device: %m\""
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fdopen",
          "args": [
            "pfd[0]",
            "\"r\""
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "pfd[1]"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "io_close_local_fds",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1463-1487",
          "snippet": "void\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static bool _task_writable(eio_obj_t *);",
            "static bool _task_readable(eio_obj_t *);",
            "static int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);",
            "static void *_io_thr(void *arg);",
            "static void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);",
            "static void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);",
            "static bool _incoming_buf_free(stepd_step_rec_t *job);",
            "static bool _outgoing_buf_free(stepd_step_rec_t *job);",
            "static int  _send_connection_okay_response(stepd_step_rec_t *job);",
            "static struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic bool _task_writable(eio_obj_t *);\nstatic bool _task_readable(eio_obj_t *);\nstatic int _send_io_init_msg(int sock, srun_key_t *key, stepd_step_rec_t *job);\nstatic void *_io_thr(void *arg);\nstatic void _free_outgoing_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_incoming_msg(struct io_buf *msg, stepd_step_rec_t *job);\nstatic void _free_all_outgoing_msgs(List msg_queue, stepd_step_rec_t *job);\nstatic bool _incoming_buf_free(stepd_step_rec_t *job);\nstatic bool _outgoing_buf_free(stepd_step_rec_t *job);\nstatic int  _send_connection_okay_response(stepd_step_rec_t *job);\nstatic struct io_buf *_build_connection_okay_message(stepd_step_rec_t *job);\n\nvoid\nio_close_local_fds(stepd_step_rec_t *job)\n{\n\tListIterator clients;\n\teio_obj_t *eio;\n\tint rc;\n\tstruct client_io_info *client;\n\n\tif (job == NULL || job->clients == NULL)\n\t\treturn;\n\n\tclients = list_iterator_create(job->clients);\n\twhile((eio = list_next(clients))) {\n\t\tclient = (struct client_io_info *)eio->arg;\n\t\tif (client->is_local_file) {\n\t\t\tif (eio->fd >= 0) {\n\t\t\t\tdo {\n\t\t\t\t\trc = close(eio->fd);\n\t\t\t\t} while (rc == -1 && errno == EINTR);\n\t\t\t\teio->fd = -1;\n\t\t\t}\n\t\t}\n\t}\n\tlist_iterator_destroy(clients);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"execve(%s): %m\"",
            "path"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "execve",
          "args": [
            "path",
            "argv",
            "job->env"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgrp",
          "args": [],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setpgrp",
          "args": [
            "0",
            "0"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"couldn't do the dup: %m\""
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup",
          "args": [
            "pfd[1]"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "io_dup_stdio",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "1724-1746",
          "snippet": "int\nio_dup_stdio(stepd_step_task_info_t *t)\n{\n\tif (dup2(t->stdin_fd, STDIN_FILENO  ) < 0) {\n\t\terror(\"dup2(stdin): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDIN_FILENO);\n\n\tif (dup2(t->stdout_fd, STDOUT_FILENO) < 0) {\n\t\terror(\"dup2(stdout): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDOUT_FILENO);\n\n\tif (dup2(t->stderr_fd, STDERR_FILENO) < 0) {\n\t\terror(\"dup2(stderr): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDERR_FILENO);\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nint\nio_dup_stdio(stepd_step_task_info_t *t)\n{\n\tif (dup2(t->stdin_fd, STDIN_FILENO  ) < 0) {\n\t\terror(\"dup2(stdin): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDIN_FILENO);\n\n\tif (dup2(t->stdout_fd, STDOUT_FILENO) < 0) {\n\t\terror(\"dup2(stdout): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDOUT_FILENO);\n\n\tif (dup2(t->stderr_fd, STDERR_FILENO) < 0) {\n\t\terror(\"dup2(stderr): %m\");\n\t\treturn SLURM_FAILURE;\n\t}\n\tfd_set_noclose_on_exec(STDERR_FILENO);\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "path"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "_install_fork_handlers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd.c",
          "lines": "1991-1999",
          "snippet": "static void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}",
          "includes": [
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/slurmd/req.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/slurmd/get_mach_stat.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/stepd_api.h\"",
            "#include \"src/common/slurm_topology.h\"",
            "#include \"src/common/slurm_strcasestr.h\"",
            "#include \"src/common/slurm_route.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/slurm_mcs.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_acct_gather_energy.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_auth.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/proc_args.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/parse_time.h\"",
            "#include \"src/common/parse_spec.h\"",
            "#include \"src/common/pack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/node_features.h\"",
            "#include \"src/common/node_conf.h\"",
            "#include \"src/common/msg_aggr.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/daemonize.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/bitstring.h\"",
            "#include <unistd.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <sys/resource.h>",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <pthread.h>",
            "#include <grp.h>",
            "#include <fcntl.h>",
            "#include <dlfcn.h>",
            "#include <dirent.h>",
            "#  include <hwloc.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void      _atfork_final(void);",
            "static void      _atfork_prepare(void);",
            "static void      _install_fork_handlers(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/slurmd/req.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/slurmd/get_mach_stat.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/stepd_api.h\"\n#include \"src/common/slurm_topology.h\"\n#include \"src/common/slurm_strcasestr.h\"\n#include \"src/common/slurm_route.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/slurm_mcs.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_acct_gather_energy.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_auth.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/proc_args.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/parse_time.h\"\n#include \"src/common/parse_spec.h\"\n#include \"src/common/pack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/node_features.h\"\n#include \"src/common/node_conf.h\"\n#include \"src/common/msg_aggr.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/daemonize.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/bitstring.h\"\n#include <unistd.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <sys/resource.h>\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <dlfcn.h>\n#include <dirent.h>\n#  include <hwloc.h>\n#  include \"config.h\"\n\nstatic void      _atfork_final(void);\nstatic void      _atfork_prepare(void);\nstatic void      _install_fork_handlers(void);\n\nstatic void _install_fork_handlers(void)\n{\n\tint err;\n\n\terr = pthread_atfork(&_atfork_prepare, &_atfork_final, &_atfork_final);\n\tif (err) error (\"pthread_atfork: %m\");\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pipe",
          "args": [
            "pfd"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Could not run %s [%s]: %m\"",
            "name",
            "path"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "path",
            "R_OK | X_OK"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"[job %u] attempting to run %s [%s]\"",
            "job->jobid",
            "name",
            "path"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xassert",
          "args": [
            "job->env"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic int\n_run_script_and_set_env(const char *name, const char *path,\n\t\t\tstepd_step_rec_t *job)\n{\n\tint status, rc;\n\tpid_t cpid;\n\tint pfd[2];\n\tchar buf[4096];\n\tFILE *f;\n\n\txassert(job->env);\n\tif (path == NULL || path[0] == '\\0')\n\t\treturn 0;\n\n\tdebug(\"[job %u] attempting to run %s [%s]\", job->jobid, name, path);\n\n\tif (access(path, R_OK | X_OK) < 0) {\n\t\terror(\"Could not run %s [%s]: %m\", name, path);\n\t\treturn -1;\n\t}\n\tif (pipe(pfd) < 0) {\n\t\terror(\"executing %s: pipe: %m\", name);\n\t\treturn -1;\n\t}\n\tif ((cpid = fork()) < 0) {\n\t\terror(\"executing %s: fork: %m\", name);\n\t\treturn -1;\n\t}\n\tif (cpid == 0) {\n\t\tchar *argv[2];\n\n\t\targv[0] = xstrdup(path);\n\t\targv[1] = NULL;\n\t\tclose(1);\n\t\tif (dup(pfd[1]) == -1)\n\t\t\terror(\"couldn't do the dup: %m\");\n\t\tclose(2);\n\t\tclose(0);\n\t\tclose(pfd[0]);\n\t\tclose(pfd[1]);\n#ifdef SETPGRP_TWO_ARGS\n\t\tsetpgrp(0, 0);\n#else\n\t\tsetpgrp();\n#endif\n\t\texecve(path, argv, job->env);\n\t\terror(\"execve(%s): %m\", path);\n\t\texit(127);\n\t}\n\n\tclose(pfd[1]);\n\tf = fdopen(pfd[0], \"r\");\n\tif (f == NULL) {\n\t\terror(\"Cannot open pipe device: %m\");\n\t\tlog_fini();\n\t\texit(1);\n\t}\n\twhile (feof(f) == 0) {\n\t\tif (fgets(buf, sizeof(buf) - 1, f) != NULL) {\n\t\t\t_proc_stdout(buf, job);\n\t\t}\n\t}\n\tfclose(f);\n\n\twhile (1) {\n\t\trc = waitpid(cpid, &status, 0);\n\t\tif (rc < 0) {\n\t\t\tif (errno == EINTR)\n\t\t\t\tcontinue;\n\t\t\terror(\"waidpid: %m\");\n\t\t\treturn 0;\n\t\t} else  {\n\t\t\tkillpg(cpid, SIGKILL);  /* kill children too */\n\t\t\treturn status;\n\t\t}\n\t}\n\n\t/* NOTREACHED */\n}"
  },
  {
    "function_name": "_proc_stdout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/task.c",
    "lines": "116-192",
    "snippet": "static void _proc_stdout(char *buf, stepd_step_rec_t *job)\n{\n\tbool end_buf = false;\n\tint len;\n\tchar *buf_ptr, *name_ptr, *val_ptr;\n\tchar *end_line, *equal_ptr;\n\tchar ***env = &job->env;\n\n\tbuf_ptr = buf;\n\twhile (buf_ptr[0]) {\n\t\tend_line = strchr(buf_ptr, '\\n');\n\t\tif (!end_line) {\n\t\t\tend_line = buf_ptr + strlen(buf_ptr);\n\t\t\tend_buf = true;\n\t\t}\n\t\tif (!xstrncmp(buf_ptr, \"print \", 6)) {\n\t\t\tbuf_ptr += 6;\n\t\t\twhile (isspace(buf_ptr[0]))\n\t\t\t\tbuf_ptr++;\n\t\t\tlen = end_line - buf_ptr + 1;\n\t\t\tsafe_write(1, buf_ptr, len);\n\t\t} else if (!xstrncmp(buf_ptr, \"export \",7)) {\n\t\t\tname_ptr = buf_ptr + 7;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tequal_ptr = strchr(name_ptr, '=');\n\t\t\tif (!equal_ptr || (equal_ptr > end_line))\n\t\t\t\tgoto rwfail;\n\t\t\tval_ptr = equal_ptr + 1;\n\t\t\twhile (isspace(equal_ptr[-1]))\n\t\t\t\tequal_ptr--;\n\t\t\tequal_ptr[0] = '\\0';\n\t\t\tend_line[0] = '\\0';\n\t\t\tif (!xstrcmp(name_ptr, \"SLURM_PROLOG_CPU_MASK\")) {\n\t\t\t\tjob->cpu_bind_type = CPU_BIND_MASK;\n\t\t\t\txfree(job->cpu_bind);\n\t\t\t\tjob->cpu_bind = xstrdup(val_ptr);\n\t\t\t\tif (task_g_pre_launch(job)) {\n\t\t\t\t\terror(\"Failed SLURM_PROLOG_CPU_MASK \"\n\t\t\t\t\t      \"setup\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdebug(\"export name:%s:val:%s:\", name_ptr, val_ptr);\n\t\t\tif (setenvf(env, name_ptr, \"%s\", val_ptr)) {\n\t\t\t\terror(\"Unable to set %s environment variable\",\n\t\t\t\t      buf_ptr);\n\t\t\t}\n\t\t\tequal_ptr[0] = '=';\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t} else if (!xstrncmp(buf_ptr, \"unset \", 6)) {\n\t\t\tname_ptr = buf_ptr + 6;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tif ((name_ptr[0] == '\\n') || (name_ptr[0] == '\\0'))\n\t\t\t\tgoto rwfail;\n\t\t\twhile (isspace(end_line[-1]))\n\t\t\t\tend_line--;\n\t\t\tend_line[0] = '\\0';\n\t\t\tdebug(\" unset name:%s:\", name_ptr);\n\t\t\tunsetenvp(*env, name_ptr);\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t}\n\nrwfail:\t\t /* process rest of script output */\n\t\tif (end_buf)\n\t\t\tbreak;\n\t\tbuf_ptr = end_line + 1;\n\t}\n\treturn;\n}",
    "includes": [
      "#include \"src/slurmd/slurmstepd/ulimits.h\"",
      "#include \"src/slurmd/slurmstepd/task.h\"",
      "#include \"src/slurmd/slurmstepd/pdebug.h\"",
      "#include \"src/slurmd/slurmd/slurmd.h\"",
      "#include \"src/slurmd/common/task_plugin.h\"",
      "#include \"src/slurmd/common/proctrack.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xsignal.h\"",
      "#include \"src/common/switch.h\"",
      "#include \"src/common/strlcpy.h\"",
      "#include \"src/common/slurm_mpi.h\"",
      "#include \"src/common/plugstack.h\"",
      "#include \"src/common/log.h\"",
      "#include \"src/common/fd.h\"",
      "#include \"src/common/gres.h\"",
      "#include \"src/common/env.h\"",
      "#include \"src/common/checkpoint.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include <sys/resource.h>",
      "#  include <sys/checkpnt.h>",
      "#  include <sys/types.h>",
      "#  include <stdlib.h>",
      "#include <unistd.h>",
      "#include <sys/wait.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <sys/param.h>",
      "#include <string.h>",
      "#include <pwd.h>",
      "#include <grp.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <assert.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void  _make_tmpdir(stepd_step_rec_t *job);",
      "static int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);",
      "static void  _proc_stdout(char *buf, stepd_step_rec_t *job);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "unsetenvp",
          "args": [
            "*env",
            "name_ptr"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\" unset name:%s:\"",
            "name_ptr"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "pdebug_wake_process",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/pdebug.c",
          "lines": "187-199",
          "snippet": "void pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}",
          "includes": [
            "#  include <linux/sched.h>",
            "#include <signal.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"pdebug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#  include <linux/sched.h>\n#include <signal.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"pdebug.h\"\n\nvoid pdebug_wake_process(stepd_step_rec_t *job, pid_t pid)\n{\n\tif ((job->task_flags & TASK_PARALLEL_DEBUG) && (pid > (pid_t) 0)) {\n\t\tif (_pid_to_wake(pid)) {\n\t\t\tif (kill(pid, SIGCONT) < 0)\n\t\t\t\terror(\"kill(%lu): %m\", (unsigned long) pid);\n\t\t\telse\n\t\t\t\tdebug(\"woke pid %lu\", (unsigned long) pid);\n\t\t} else {\n\t\t\tdebug(\"pid %lu not stopped\", (unsigned long) pid);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "end_line[-1]"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "name_ptr[0]"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrncmp",
          "args": [
            "buf_ptr",
            "\"unset \"",
            "6"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to set %s environment variable\"",
            "buf_ptr"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "_task_write_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/io.c",
          "lines": "641-650",
          "snippet": "static int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/write_labelled_message.h\"",
            "#include \"src/common/read_config.h\"",
            "#include \"src/common/net.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/list.h\"",
            "#include \"src/common/io_hdr.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/eio.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <poll.h>",
            "#  include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#  include <string.h>",
            "#  include <unistd.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static bool _client_readable(eio_obj_t *);",
            "static bool _client_writable(eio_obj_t *);",
            "static int  _client_read(eio_obj_t *, List);",
            "static int  _client_write(eio_obj_t *, List);",
            "static bool _local_file_writable(eio_obj_t *);",
            "static int  _local_file_write(eio_obj_t *, List);",
            "static bool _task_writable(eio_obj_t *);",
            "static int  _task_write(eio_obj_t *, List);",
            "static int _task_write_error(eio_obj_t *obj, List objs);",
            "static bool _task_readable(eio_obj_t *);",
            "static int  _task_read(eio_obj_t *, List);",
            "static void _route_msg_task_to_client(eio_obj_t *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/write_labelled_message.h\"\n#include \"src/common/read_config.h\"\n#include \"src/common/net.h\"\n#include \"src/common/macros.h\"\n#include \"src/common/log.h\"\n#include \"src/common/list.h\"\n#include \"src/common/io_hdr.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/eio.h\"\n#include \"src/common/cbuf.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <poll.h>\n#  include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#  include <string.h>\n#  include <unistd.h>\n#  include \"config.h\"\n\nstatic bool _client_readable(eio_obj_t *);\nstatic bool _client_writable(eio_obj_t *);\nstatic int  _client_read(eio_obj_t *, List);\nstatic int  _client_write(eio_obj_t *, List);\nstatic bool _local_file_writable(eio_obj_t *);\nstatic int  _local_file_write(eio_obj_t *, List);\nstatic bool _task_writable(eio_obj_t *);\nstatic int  _task_write(eio_obj_t *, List);\nstatic int _task_write_error(eio_obj_t *obj, List objs);\nstatic bool _task_readable(eio_obj_t *);\nstatic int  _task_read(eio_obj_t *, List);\nstatic void _route_msg_task_to_client(eio_obj_t *obj);\n\nstatic int\n_task_write_error(eio_obj_t *obj, List objs)\n{\n\tdebug4(\"Called _task_write_error, closing fd %d\", obj->fd);\n\n\tclose(obj->fd);\n\tobj->fd = -1;\n\n\treturn SLURM_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "setenvf",
          "args": [
            "env",
            "name_ptr",
            "\"%s\"",
            "val_ptr"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug",
          "args": [
            "\"export name:%s:val:%s:\"",
            "name_ptr",
            "val_ptr"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "_send_pending_exit_msgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmstepd/mgr.c",
          "lines": "1890-1927",
          "snippet": "static int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/fname.h\"",
            "#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"",
            "#include \"src/slurmd/slurmstepd/ulimits.h\"",
            "#include \"src/slurmd/slurmstepd/pam_ses.h\"",
            "#include \"src/slurmd/slurmstepd/req.h\"",
            "#include \"src/slurmd/slurmstepd/pdebug.h\"",
            "#include \"src/slurmd/slurmstepd/io.h\"",
            "#include \"src/slurmd/slurmstepd/task.h\"",
            "#include \"src/slurmd/slurmstepd/mgr.h\"",
            "#include \"src/slurmd/slurmstepd/slurmstepd.h\"",
            "#include \"src/slurmd/common/xcpuinfo.h\"",
            "#include \"src/slurmd/common/set_oomadj.h\"",
            "#include \"src/slurmd/common/reverse_tree.h\"",
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/slurmd/common/slurmd_cgroup.h\"",
            "#include \"src/slurmd/common/proctrack.h\"",
            "#include \"src/slurmd/common/setproctitle.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/slurmd/common/core_spec_plugin.h\"",
            "#include \"src/slurmd/slurmd/slurmd.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xsignal.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/util-net.h\"",
            "#include \"src/common/switch.h\"",
            "#include \"src/common/slurm_mpi.h\"",
            "#include \"src/common/slurm_jobacct_gather.h\"",
            "#include \"src/common/slurm_cred.h\"",
            "#include \"src/common/slurm_acct_gather_profile.h\"",
            "#include \"src/common/safeopen.h\"",
            "#include \"src/common/plugstack.h\"",
            "#include \"src/common/node_select.h\"",
            "#include \"src/common/log.h\"",
            "#include \"src/common/hostlist.h\"",
            "#include \"src/common/gres.h\"",
            "#include \"src/common/forward.h\"",
            "#include \"src/common/fd.h\"",
            "#include \"src/common/env.h\"",
            "#include \"src/common/cpu_frequency.h\"",
            "#include \"src/common/cbuf.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#    include <utmp.h>",
            "#  include <pty.h>",
            "#  include <stdlib.h>",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/wait.h>",
            "#include <sys/utsname.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/param.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <pwd.h>",
            "#include <pthread.h>",
            "#include <poll.h>",
            "#include <grp.h>",
            "#  include \"src/common/unsetenv.h\"",
            "#  include <sys/checkpnt.h>",
            "#  include <sys/prctl.h>",
            "#  include <sys/types.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void  _set_prio_process (stepd_step_rec_t *job);",
            "static void _set_job_log_prefix(stepd_step_rec_t *job);",
            "static int  _setup_normal_io(stepd_step_rec_t *job);",
            "static int  _slurmd_job_log_init(stepd_step_rec_t *job);",
            "static void _wait_for_io(stepd_step_rec_t *job);",
            "static int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);",
            "static void _wait_for_children_slurmstepd(stepd_step_rec_t *job);",
            "static int  _send_pending_exit_msgs(stepd_step_rec_t *job);",
            "static void _send_step_complete_msgs(stepd_step_rec_t *job);",
            "static void _wait_for_all_tasks(stepd_step_rec_t *job);",
            "static void _setargs(stepd_step_rec_t *job);",
            "static void _random_sleep(stepd_step_rec_t *job);",
            "static char * _make_batch_dir(stepd_step_rec_t *job);",
            "static int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);",
            "static int _initgroups(stepd_step_rec_t *job);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/fname.h\"\n#include \"src/slurmd/slurmstepd/step_terminate_monitor.h\"\n#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/pam_ses.h\"\n#include \"src/slurmd/slurmstepd/req.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmstepd/io.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/mgr.h\"\n#include \"src/slurmd/slurmstepd/slurmstepd.h\"\n#include \"src/slurmd/common/xcpuinfo.h\"\n#include \"src/slurmd/common/set_oomadj.h\"\n#include \"src/slurmd/common/reverse_tree.h\"\n#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/slurmd_cgroup.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/slurmd/common/setproctitle.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/slurmd/common/core_spec_plugin.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/util-net.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/slurm_jobacct_gather.h\"\n#include \"src/common/slurm_cred.h\"\n#include \"src/common/slurm_acct_gather_profile.h\"\n#include \"src/common/safeopen.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/node_select.h\"\n#include \"src/common/log.h\"\n#include \"src/common/hostlist.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/forward.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/env.h\"\n#include \"src/common/cpu_frequency.h\"\n#include \"src/common/cbuf.h\"\n#include \"slurm/slurm_errno.h\"\n#    include <utmp.h>\n#  include <pty.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <time.h>\n#include <sys/wait.h>\n#include <sys/utsname.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <stdio.h>\n#include <pwd.h>\n#include <pthread.h>\n#include <poll.h>\n#include <grp.h>\n#  include \"src/common/unsetenv.h\"\n#  include <sys/checkpnt.h>\n#  include <sys/prctl.h>\n#  include <sys/types.h>\n#  include \"config.h\"\n\nstatic void  _set_prio_process (stepd_step_rec_t *job);\nstatic void _set_job_log_prefix(stepd_step_rec_t *job);\nstatic int  _setup_normal_io(stepd_step_rec_t *job);\nstatic int  _slurmd_job_log_init(stepd_step_rec_t *job);\nstatic void _wait_for_io(stepd_step_rec_t *job);\nstatic int  _send_exit_msg(stepd_step_rec_t *job, uint32_t *tid, int n,\n\t\t\t   int status);\nstatic void _wait_for_children_slurmstepd(stepd_step_rec_t *job);\nstatic int  _send_pending_exit_msgs(stepd_step_rec_t *job);\nstatic void _send_step_complete_msgs(stepd_step_rec_t *job);\nstatic void _wait_for_all_tasks(stepd_step_rec_t *job);\nstatic void _setargs(stepd_step_rec_t *job);\nstatic void _random_sleep(stepd_step_rec_t *job);\nstatic char * _make_batch_dir(stepd_step_rec_t *job);\nstatic int    _send_complete_batch_script_msg(stepd_step_rec_t *job,\n\t\t\t\t\t      int err, int status);\nstatic int _initgroups(stepd_step_rec_t *job);\n\nstatic int\n_send_pending_exit_msgs(stepd_step_rec_t *job)\n{\n\tint  i;\n\tint  nsent  = 0;\n\tint  status = 0;\n\tbool set    = false;\n\tuint32_t *tid;\n\n\t/*\n\t * Collect all exit codes with the same status into a\n\t * single message.\n\t */\n\ttid = xmalloc(sizeof(uint32_t) * job->node_tasks);\n\tfor (i = 0; i < job->node_tasks; i++) {\n\t\tstepd_step_task_info_t *t = job->task[i];\n\n\t\tif (!t->exited || t->esent)\n\t\t\tcontinue;\n\n\t\tif (!set) {\n\t\t\tstatus = t->estatus;\n\t\t\tset    = true;\n\t\t} else if (status != t->estatus)\n\t\t\tcontinue;\n\n\t\ttid[nsent++] = t->gtid;\n\t\tt->esent = true;\n\t}\n\n\tif (nsent) {\n\t\tdebug2(\"Aggregated %d task exit messages\", nsent);\n\t\t_send_exit_msg(job, tid, nsent, status);\n\t}\n\txfree(tid);\n\n\treturn nsent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed SLURM_PROLOG_CPU_MASK \"\n\t\t\t\t\t      \"setup\""
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_g_pre_launch",
          "args": [
            "job"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "task_g_pre_launch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/task_plugin.c",
          "lines": "369-382",
          "snippet": "extern int task_g_pre_launch(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_launch))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}",
          "includes": [
            "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"",
            "#include \"src/slurmd/common/task_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include <pthread.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static slurmd_task_ops_t *ops = NULL;",
            "static int\t\t\tg_task_context_num = -1;",
            "static pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmstepd/slurmstepd_job.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include <pthread.h>\n\nstatic slurmd_task_ops_t *ops = NULL;\nstatic int\t\t\tg_task_context_num = -1;\nstatic pthread_mutex_t\t\tg_task_context_lock = PTHREAD_MUTEX_INITIALIZER;\n\nextern int task_g_pre_launch(stepd_step_rec_t *job)\n{\n\tint i, rc = SLURM_SUCCESS;\n\n\tif (slurmd_task_init())\n\t\treturn SLURM_ERROR;\n\n\tslurm_mutex_lock( &g_task_context_lock );\n\tfor (i = 0; ((i < g_task_context_num) && (rc == SLURM_SUCCESS)); i++)\n\t\trc = (*(ops[i].pre_launch))(job);\n\tslurm_mutex_unlock( &g_task_context_lock );\n\n\treturn (rc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrdup",
          "args": [
            "val_ptr"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "job->cpu_bind"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xstrcmp",
          "args": [
            "name_ptr",
            "\"SLURM_PROLOG_CPU_MASK\""
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "equal_ptr[-1]"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "name_ptr",
            "'='"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "name_ptr[0]"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrncmp",
          "args": [
            "buf_ptr",
            "\"export \"",
            "7"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "safe_write",
          "args": [
            "1",
            "buf_ptr",
            "len"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "buf_ptr[0]"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrncmp",
          "args": [
            "buf_ptr",
            "\"print \"",
            "6"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf_ptr"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf_ptr",
            "'\\n'"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmstepd/ulimits.h\"\n#include \"src/slurmd/slurmstepd/task.h\"\n#include \"src/slurmd/slurmstepd/pdebug.h\"\n#include \"src/slurmd/slurmd/slurmd.h\"\n#include \"src/slurmd/common/task_plugin.h\"\n#include \"src/slurmd/common/proctrack.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xsignal.h\"\n#include \"src/common/switch.h\"\n#include \"src/common/strlcpy.h\"\n#include \"src/common/slurm_mpi.h\"\n#include \"src/common/plugstack.h\"\n#include \"src/common/log.h\"\n#include \"src/common/fd.h\"\n#include \"src/common/gres.h\"\n#include \"src/common/env.h\"\n#include \"src/common/checkpoint.h\"\n#include \"slurm/slurm_errno.h\"\n#include <sys/resource.h>\n#  include <sys/checkpnt.h>\n#  include <sys/types.h>\n#  include <stdlib.h>\n#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/param.h>\n#include <string.h>\n#include <pwd.h>\n#include <grp.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <assert.h>\n#  include \"config.h\"\n\nstatic void  _make_tmpdir(stepd_step_rec_t *job);\nstatic int   _run_script_and_set_env(const char *name, const char *path,\n\t\t\t\t     stepd_step_rec_t *job);\nstatic void  _proc_stdout(char *buf, stepd_step_rec_t *job);\n\nstatic void _proc_stdout(char *buf, stepd_step_rec_t *job)\n{\n\tbool end_buf = false;\n\tint len;\n\tchar *buf_ptr, *name_ptr, *val_ptr;\n\tchar *end_line, *equal_ptr;\n\tchar ***env = &job->env;\n\n\tbuf_ptr = buf;\n\twhile (buf_ptr[0]) {\n\t\tend_line = strchr(buf_ptr, '\\n');\n\t\tif (!end_line) {\n\t\t\tend_line = buf_ptr + strlen(buf_ptr);\n\t\t\tend_buf = true;\n\t\t}\n\t\tif (!xstrncmp(buf_ptr, \"print \", 6)) {\n\t\t\tbuf_ptr += 6;\n\t\t\twhile (isspace(buf_ptr[0]))\n\t\t\t\tbuf_ptr++;\n\t\t\tlen = end_line - buf_ptr + 1;\n\t\t\tsafe_write(1, buf_ptr, len);\n\t\t} else if (!xstrncmp(buf_ptr, \"export \",7)) {\n\t\t\tname_ptr = buf_ptr + 7;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tequal_ptr = strchr(name_ptr, '=');\n\t\t\tif (!equal_ptr || (equal_ptr > end_line))\n\t\t\t\tgoto rwfail;\n\t\t\tval_ptr = equal_ptr + 1;\n\t\t\twhile (isspace(equal_ptr[-1]))\n\t\t\t\tequal_ptr--;\n\t\t\tequal_ptr[0] = '\\0';\n\t\t\tend_line[0] = '\\0';\n\t\t\tif (!xstrcmp(name_ptr, \"SLURM_PROLOG_CPU_MASK\")) {\n\t\t\t\tjob->cpu_bind_type = CPU_BIND_MASK;\n\t\t\t\txfree(job->cpu_bind);\n\t\t\t\tjob->cpu_bind = xstrdup(val_ptr);\n\t\t\t\tif (task_g_pre_launch(job)) {\n\t\t\t\t\terror(\"Failed SLURM_PROLOG_CPU_MASK \"\n\t\t\t\t\t      \"setup\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdebug(\"export name:%s:val:%s:\", name_ptr, val_ptr);\n\t\t\tif (setenvf(env, name_ptr, \"%s\", val_ptr)) {\n\t\t\t\terror(\"Unable to set %s environment variable\",\n\t\t\t\t      buf_ptr);\n\t\t\t}\n\t\t\tequal_ptr[0] = '=';\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t} else if (!xstrncmp(buf_ptr, \"unset \", 6)) {\n\t\t\tname_ptr = buf_ptr + 6;\n\t\t\twhile (isspace(name_ptr[0]))\n\t\t\t\tname_ptr++;\n\t\t\tif ((name_ptr[0] == '\\n') || (name_ptr[0] == '\\0'))\n\t\t\t\tgoto rwfail;\n\t\t\twhile (isspace(end_line[-1]))\n\t\t\t\tend_line--;\n\t\t\tend_line[0] = '\\0';\n\t\t\tdebug(\" unset name:%s:\", name_ptr);\n\t\t\tunsetenvp(*env, name_ptr);\n\t\t\tif (end_buf)\n\t\t\t\tend_line[0] = '\\0';\n\t\t\telse\n\t\t\t\tend_line[0] = '\\n';\n\t\t}\n\nrwfail:\t\t /* process rest of script output */\n\t\tif (end_buf)\n\t\t\tbreak;\n\t\tbuf_ptr = end_line + 1;\n\t}\n\treturn;\n}"
  }
]