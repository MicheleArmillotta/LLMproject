[
  {
    "function_name": "slurmd_plugstack_fini",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd_plugstack.c",
    "lines": "159-182",
    "snippet": "extern int slurmd_plugstack_fini(void)\n{\n\tint i, j, rc = SLURM_SUCCESS;\n\n\tslurm_mutex_lock(&g_context_lock);\n\tif (g_context_cnt < 0)\n\t\tgoto fini;\n\n\tinit_run = false;\n\tfor (i=0; i<g_context_cnt; i++) {\n\t\tif (g_context[i]) {\n\t\t\tj = plugin_context_destroy(g_context[i]);\n\t\t\tif (j != SLURM_SUCCESS)\n\t\t\t\trc = j;\n\t\t}\n\t}\n\txfree(ops);\n\txfree(g_context);\n\txfree(slurmd_plugstack_list);\n\tg_context_cnt = -1;\n\nfini:\tslurm_mutex_unlock(&g_context_lock);\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/slurm_protocol_api.h\"",
      "#include \"src/common/plugrack.h\"",
      "#include \"src/common/plugin.h\"",
      "#include \"src/common/macros.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include \"slurm/slurm.h\"",
      "#include <stdio.h>",
      "#  include <string.h>",
      "#  include <stdint.h>",
      "#  include <unistd.h>",
      "#  include <sys/types.h>",
      "#      include <stdint.h>",
      "#    include <inttypes.h>",
      "#    include <unistd.h>",
      "#    include <sys/types.h>",
      "#    include <string.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int g_context_cnt = -1;",
      "static slurmd_plugstack_ops_t *ops = NULL;",
      "static plugin_context_t **g_context = NULL;",
      "static char *slurmd_plugstack_list = NULL;",
      "static pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;",
      "static bool init_run = false;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&g_context_lock"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "slurmd_plugstack_list"
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plugin_context_destroy",
          "args": [
            "g_context[i]"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&g_context_lock"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include \"src/common/macros.h\"\n#include \"slurm/slurm_errno.h\"\n#include \"slurm/slurm.h\"\n#include <stdio.h>\n#  include <string.h>\n#  include <stdint.h>\n#  include <unistd.h>\n#  include <sys/types.h>\n#      include <stdint.h>\n#    include <inttypes.h>\n#    include <unistd.h>\n#    include <sys/types.h>\n#    include <string.h>\n#  include \"config.h\"\n\nstatic int g_context_cnt = -1;\nstatic slurmd_plugstack_ops_t *ops = NULL;\nstatic plugin_context_t **g_context = NULL;\nstatic char *slurmd_plugstack_list = NULL;\nstatic pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int slurmd_plugstack_fini(void)\n{\n\tint i, j, rc = SLURM_SUCCESS;\n\n\tslurm_mutex_lock(&g_context_lock);\n\tif (g_context_cnt < 0)\n\t\tgoto fini;\n\n\tinit_run = false;\n\tfor (i=0; i<g_context_cnt; i++) {\n\t\tif (g_context[i]) {\n\t\t\tj = plugin_context_destroy(g_context[i]);\n\t\t\tif (j != SLURM_SUCCESS)\n\t\t\t\trc = j;\n\t\t}\n\t}\n\txfree(ops);\n\txfree(g_context);\n\txfree(slurmd_plugstack_list);\n\tg_context_cnt = -1;\n\nfini:\tslurm_mutex_unlock(&g_context_lock);\n\treturn rc;\n}"
  },
  {
    "function_name": "slurmd_plugstack_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd_plugstack.c",
    "lines": "99-152",
    "snippet": "extern int slurmd_plugstack_init(void)\n{\n\tint rc = SLURM_SUCCESS;\n\tchar *last = NULL, *names;\n\tchar *plugin_type = \"slurmd_plugstack\";\n\tchar *type;\n\n\tif (init_run && (g_context_cnt >= 0))\n\t\treturn rc;\n\n\tslurm_mutex_lock(&g_context_lock);\n\tif (g_context_cnt >= 0)\n\t\tgoto fini;\n\n\tslurmd_plugstack_list = slurm_get_slurmd_plugstack();\n\tg_context_cnt = 0;\n\tif ((slurmd_plugstack_list == NULL) ||\n\t    (slurmd_plugstack_list[0] == '\\0'))\n\t\tgoto fini;\n\n\tnames = slurmd_plugstack_list;\n\twhile ((type = strtok_r(names, \",\", &last))) {\n\t\txrealloc(ops, (sizeof(slurmd_plugstack_ops_t) *\n\t\t\t      (g_context_cnt + 1)));\n\t\txrealloc(g_context,\n\t\t\t (sizeof(plugin_context_t *) * (g_context_cnt + 1)));\n\t\tif (xstrncmp(type, \"slurmd/\", 10) == 0)\n\t\t\ttype += 10; /* backward compatibility */\n\t\ttype = xstrdup_printf(\"slurmd/%s\", type);\n\t\tg_context[g_context_cnt] = plugin_context_create(\n\t\t\tplugin_type, type, (void **)&ops[g_context_cnt],\n\t\t\tsyms, sizeof(syms));\n\t\tif (!g_context[g_context_cnt]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, type);\n\t\t\trc = SLURM_ERROR;\n\t\t\txfree(type);\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(type);\n\t\tg_context_cnt++;\n\t\tnames = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\nfini:\n\tslurm_mutex_unlock(&g_context_lock);\n\n\tif (rc != SLURM_SUCCESS)\n\t\tslurmd_plugstack_fini();\n\n\treturn rc;\n}",
    "includes": [
      "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
      "#include \"src/common/xstring.h\"",
      "#include \"src/common/xmalloc.h\"",
      "#include \"src/common/slurm_protocol_api.h\"",
      "#include \"src/common/plugrack.h\"",
      "#include \"src/common/plugin.h\"",
      "#include \"src/common/macros.h\"",
      "#include \"slurm/slurm_errno.h\"",
      "#include \"slurm/slurm.h\"",
      "#include <stdio.h>",
      "#  include <string.h>",
      "#  include <stdint.h>",
      "#  include <unistd.h>",
      "#  include <sys/types.h>",
      "#      include <stdint.h>",
      "#    include <inttypes.h>",
      "#    include <unistd.h>",
      "#    include <sys/types.h>",
      "#    include <string.h>",
      "#  include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static const char *syms[] = {\n\t/* NO FUNCTIONS */\n};",
      "static int g_context_cnt = -1;",
      "static slurmd_plugstack_ops_t *ops = NULL;",
      "static plugin_context_t **g_context = NULL;",
      "static char *slurmd_plugstack_list = NULL;",
      "static pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;",
      "static bool init_run = false;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "slurmd_plugstack_fini",
          "args": [],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "slurmd_plugstack_fini",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/slurmd/slurmd_plugstack.c",
          "lines": "159-182",
          "snippet": "extern int slurmd_plugstack_fini(void)\n{\n\tint i, j, rc = SLURM_SUCCESS;\n\n\tslurm_mutex_lock(&g_context_lock);\n\tif (g_context_cnt < 0)\n\t\tgoto fini;\n\n\tinit_run = false;\n\tfor (i=0; i<g_context_cnt; i++) {\n\t\tif (g_context[i]) {\n\t\t\tj = plugin_context_destroy(g_context[i]);\n\t\t\tif (j != SLURM_SUCCESS)\n\t\t\t\trc = j;\n\t\t}\n\t}\n\txfree(ops);\n\txfree(g_context);\n\txfree(slurmd_plugstack_list);\n\tg_context_cnt = -1;\n\nfini:\tslurm_mutex_unlock(&g_context_lock);\n\treturn rc;\n}",
          "includes": [
            "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/slurm_protocol_api.h\"",
            "#include \"src/common/plugrack.h\"",
            "#include \"src/common/plugin.h\"",
            "#include \"src/common/macros.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include \"slurm/slurm.h\"",
            "#include <stdio.h>",
            "#  include <string.h>",
            "#  include <stdint.h>",
            "#  include <unistd.h>",
            "#  include <sys/types.h>",
            "#      include <stdint.h>",
            "#    include <inttypes.h>",
            "#    include <unistd.h>",
            "#    include <sys/types.h>",
            "#    include <string.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int g_context_cnt = -1;",
            "static slurmd_plugstack_ops_t *ops = NULL;",
            "static plugin_context_t **g_context = NULL;",
            "static char *slurmd_plugstack_list = NULL;",
            "static pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;",
            "static bool init_run = false;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include \"src/common/macros.h\"\n#include \"slurm/slurm_errno.h\"\n#include \"slurm/slurm.h\"\n#include <stdio.h>\n#  include <string.h>\n#  include <stdint.h>\n#  include <unistd.h>\n#  include <sys/types.h>\n#      include <stdint.h>\n#    include <inttypes.h>\n#    include <unistd.h>\n#    include <sys/types.h>\n#    include <string.h>\n#  include \"config.h\"\n\nstatic int g_context_cnt = -1;\nstatic slurmd_plugstack_ops_t *ops = NULL;\nstatic plugin_context_t **g_context = NULL;\nstatic char *slurmd_plugstack_list = NULL;\nstatic pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int slurmd_plugstack_fini(void)\n{\n\tint i, j, rc = SLURM_SUCCESS;\n\n\tslurm_mutex_lock(&g_context_lock);\n\tif (g_context_cnt < 0)\n\t\tgoto fini;\n\n\tinit_run = false;\n\tfor (i=0; i<g_context_cnt; i++) {\n\t\tif (g_context[i]) {\n\t\t\tj = plugin_context_destroy(g_context[i]);\n\t\t\tif (j != SLURM_SUCCESS)\n\t\t\t\trc = j;\n\t\t}\n\t}\n\txfree(ops);\n\txfree(g_context);\n\txfree(slurmd_plugstack_list);\n\tg_context_cnt = -1;\n\nfini:\tslurm_mutex_unlock(&g_context_lock);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "slurm_mutex_unlock",
          "args": [
            "&g_context_lock"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xfree",
          "args": [
            "type"
          ],
          "line": 139
        },
        "resolved": true,
        "details": {
          "function_name": "_xfree_f",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10030/repo/src/slurmd/common/run_script.c",
          "lines": "167-170",
          "snippet": "static void _xfree_f (void *x)\n{\n\txfree (x);\n}",
          "includes": [
            "#include \"src/slurmd/common/run_script.h\"",
            "#include \"src/slurmd/common/job_container_plugin.h\"",
            "#include \"src/common/xstring.h\"",
            "#include \"src/common/xmalloc.h\"",
            "#include \"src/common/xassert.h\"",
            "#include \"src/common/list.h\"",
            "#include \"slurm/slurm_errno.h\"",
            "#include <glob.h>",
            "#include <string.h>",
            "#include <sys/errno.h>",
            "#include <sys/wait.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <poll.h>",
            "#  include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/slurmd/common/run_script.h\"\n#include \"src/slurmd/common/job_container_plugin.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/xassert.h\"\n#include \"src/common/list.h\"\n#include \"slurm/slurm_errno.h\"\n#include <glob.h>\n#include <string.h>\n#include <sys/errno.h>\n#include <sys/wait.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <poll.h>\n#  include \"config.h\"\n\nstatic void _xfree_f (void *x)\n{\n\txfree (x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"cannot create %s context for %s\"",
            "plugin_type",
            "type"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plugin_context_create",
          "args": [
            "plugin_type",
            "type",
            "(void **)&ops[g_context_cnt]",
            "syms",
            "sizeof(syms)"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrdup_printf",
          "args": [
            "\"slurmd/%s\"",
            "type"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xstrncmp",
          "args": [
            "type",
            "\"slurmd/\"",
            "10"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xrealloc",
          "args": [
            "g_context",
            "(sizeof(plugin_context_t *) * (g_context_cnt + 1))"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xrealloc",
          "args": [
            "ops",
            "(sizeof(slurmd_plugstack_ops_t) *\n\t\t\t      (g_context_cnt + 1))"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "names",
            "\",\"",
            "&last"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_get_slurmd_plugstack",
          "args": [],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slurm_mutex_lock",
          "args": [
            "&g_context_lock"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/slurmd/slurmd/slurmd_plugstack.h\"\n#include \"src/common/xstring.h\"\n#include \"src/common/xmalloc.h\"\n#include \"src/common/slurm_protocol_api.h\"\n#include \"src/common/plugrack.h\"\n#include \"src/common/plugin.h\"\n#include \"src/common/macros.h\"\n#include \"slurm/slurm_errno.h\"\n#include \"slurm/slurm.h\"\n#include <stdio.h>\n#  include <string.h>\n#  include <stdint.h>\n#  include <unistd.h>\n#  include <sys/types.h>\n#      include <stdint.h>\n#    include <inttypes.h>\n#    include <unistd.h>\n#    include <sys/types.h>\n#    include <string.h>\n#  include \"config.h\"\n\nstatic const char *syms[] = {\n\t/* NO FUNCTIONS */\n};\nstatic int g_context_cnt = -1;\nstatic slurmd_plugstack_ops_t *ops = NULL;\nstatic plugin_context_t **g_context = NULL;\nstatic char *slurmd_plugstack_list = NULL;\nstatic pthread_mutex_t g_context_lock = PTHREAD_MUTEX_INITIALIZER;\nstatic bool init_run = false;\n\nextern int slurmd_plugstack_init(void)\n{\n\tint rc = SLURM_SUCCESS;\n\tchar *last = NULL, *names;\n\tchar *plugin_type = \"slurmd_plugstack\";\n\tchar *type;\n\n\tif (init_run && (g_context_cnt >= 0))\n\t\treturn rc;\n\n\tslurm_mutex_lock(&g_context_lock);\n\tif (g_context_cnt >= 0)\n\t\tgoto fini;\n\n\tslurmd_plugstack_list = slurm_get_slurmd_plugstack();\n\tg_context_cnt = 0;\n\tif ((slurmd_plugstack_list == NULL) ||\n\t    (slurmd_plugstack_list[0] == '\\0'))\n\t\tgoto fini;\n\n\tnames = slurmd_plugstack_list;\n\twhile ((type = strtok_r(names, \",\", &last))) {\n\t\txrealloc(ops, (sizeof(slurmd_plugstack_ops_t) *\n\t\t\t      (g_context_cnt + 1)));\n\t\txrealloc(g_context,\n\t\t\t (sizeof(plugin_context_t *) * (g_context_cnt + 1)));\n\t\tif (xstrncmp(type, \"slurmd/\", 10) == 0)\n\t\t\ttype += 10; /* backward compatibility */\n\t\ttype = xstrdup_printf(\"slurmd/%s\", type);\n\t\tg_context[g_context_cnt] = plugin_context_create(\n\t\t\tplugin_type, type, (void **)&ops[g_context_cnt],\n\t\t\tsyms, sizeof(syms));\n\t\tif (!g_context[g_context_cnt]) {\n\t\t\terror(\"cannot create %s context for %s\",\n\t\t\t      plugin_type, type);\n\t\t\trc = SLURM_ERROR;\n\t\t\txfree(type);\n\t\t\tbreak;\n\t\t}\n\n\t\txfree(type);\n\t\tg_context_cnt++;\n\t\tnames = NULL; /* for next iteration */\n\t}\n\tinit_run = true;\n\nfini:\n\tslurm_mutex_unlock(&g_context_lock);\n\n\tif (rc != SLURM_SUCCESS)\n\t\tslurmd_plugstack_fini();\n\n\treturn rc;\n}"
  }
]