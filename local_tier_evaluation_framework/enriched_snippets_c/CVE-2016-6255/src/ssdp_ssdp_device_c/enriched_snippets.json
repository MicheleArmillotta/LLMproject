[
  {
    "function_name": "DeviceShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "832-912",
    "snippet": "int DeviceShutdown(char *DevType, int RootDev, char *Udn,\n\t\t   char *Location, int Duration, int AddressFamily,\n\t\t   int PowerState, int SleepPeriod, int RegistrationState)\n{\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\tchar *msgs[3];\n\tchar Mil_Usn[LINE_SIZE];\n\tint ret_code = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tmsgs[0] = NULL;\n\tmsgs[1] = NULL;\n\tmsgs[2] = NULL;\n\tmemset(&__ss, 0, sizeof(__ss));\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\t/* root device has one extra msg */\n\tif (RootDev) {\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\",\n\t\t\tUdn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_SHUTDOWN, \"upnp:rootdevice\",\n\t\t\t\t    Mil_Usn, Location, Duration, &msgs[0],\n\t\t\t\t    AddressFamily, PowerState, SleepPeriod,\n\t\t\t\t    RegistrationState);\n\t}\n\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t   \"In function DeviceShutdown\\n\");\n\t/* both root and sub-devices need to send these two messages */\n\tCreateServicePacket(MSGTYPE_SHUTDOWN, Udn, Udn,\n\t\t\t    Location, Duration, &msgs[1], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_SHUTDOWN, DevType, Mil_Usn,\n\t\t\t    Location, Duration, &msgs[2], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\t/* check error */\n\tif ((RootDev && msgs[0] == NULL) || msgs[1] == NULL || msgs[2] == NULL) {\n\t\tgoto error_handler;\n\t}\n\t/* send packets */\n\tif (RootDev) {\n\t\t/* send 3 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 3, &msgs[0]);\n\t} else {\n\t\t/* sub-device */\n\t\t/* send 2 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 2, &msgs[1]);\n\t}\n\nerror_handler:\n\t/* free msgs */\n\tfree(msgs[0]);\n\tfree(msgs[1]);\n\tfree(msgs[2]);\n\n\treturn ret_code;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_SHUTDOWN\t0",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msgs[2]"
          ],
          "line": 909
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "(struct sockaddr *)&__ss",
            "2",
            "&msgs[1]"
          ],
          "line": 902
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_SHUTDOWN",
            "DevType",
            "Mil_Usn",
            "Location",
            "Duration",
            "&msgs[2]",
            "AddressFamily",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 886
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "DevType"
          ],
          "line": 883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UpnpPrintf",
          "args": [
            "UPNP_INFO",
            "SSDP",
            "__FILE__",
            "__LINE__",
            "\"In function DeviceShutdown\\n\""
          ],
          "line": 877
        },
        "resolved": true,
        "details": {
          "function_name": "UpnpPrintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpdebug.c",
          "lines": "124-154",
          "snippet": "void UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include \"upnpdebug.h\"",
            "#include \"upnp.h\"",
            "#include \"ixml.h\"",
            "#include \"ithread.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include \"upnpdebug.h\"\n#include \"upnp.h\"\n#include \"ixml.h\"\n#include \"ithread.h\"\n#include \"config.h\"\n\nvoid UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::upnp:rootdevice\"",
            "Udn"
          ],
          "line": 868
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_pton",
          "args": [
            "AF_INET6",
            "(isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL",
            "&DestAddr6->sin6_addr"
          ],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "inet_pton",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/inet_pton.c",
          "lines": "307-321",
          "snippet": "int inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"inet_pton.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inet_pton.h\"\n\nint inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "isUrlV6UlaGua",
          "args": [
            "Location"
          ],
          "line": 857
        },
        "resolved": true,
        "details": {
          "function_name": "isUrlV6UlaGua",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "299-310",
          "snippet": "static int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&__ss",
            "0",
            "sizeof(__ss)"
          ],
          "line": 847
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "345-352",
          "snippet": "static void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memset"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memset;\n\nstatic void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_SHUTDOWN\t0\n#define snprintf _snprintf\n\nint DeviceShutdown(char *DevType, int RootDev, char *Udn,\n\t\t   char *Location, int Duration, int AddressFamily,\n\t\t   int PowerState, int SleepPeriod, int RegistrationState)\n{\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\tchar *msgs[3];\n\tchar Mil_Usn[LINE_SIZE];\n\tint ret_code = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tmsgs[0] = NULL;\n\tmsgs[1] = NULL;\n\tmsgs[2] = NULL;\n\tmemset(&__ss, 0, sizeof(__ss));\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\t/* root device has one extra msg */\n\tif (RootDev) {\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\",\n\t\t\tUdn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_SHUTDOWN, \"upnp:rootdevice\",\n\t\t\t\t    Mil_Usn, Location, Duration, &msgs[0],\n\t\t\t\t    AddressFamily, PowerState, SleepPeriod,\n\t\t\t\t    RegistrationState);\n\t}\n\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t   \"In function DeviceShutdown\\n\");\n\t/* both root and sub-devices need to send these two messages */\n\tCreateServicePacket(MSGTYPE_SHUTDOWN, Udn, Udn,\n\t\t\t    Location, Duration, &msgs[1], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_SHUTDOWN, DevType, Mil_Usn,\n\t\t\t    Location, Duration, &msgs[2], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\t/* check error */\n\tif ((RootDev && msgs[0] == NULL) || msgs[1] == NULL || msgs[2] == NULL) {\n\t\tgoto error_handler;\n\t}\n\t/* send packets */\n\tif (RootDev) {\n\t\t/* send 3 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 3, &msgs[0]);\n\t} else {\n\t\t/* sub-device */\n\t\t/* send 2 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 2, &msgs[1]);\n\t}\n\nerror_handler:\n\t/* free msgs */\n\tfree(msgs[0]);\n\tfree(msgs[1]);\n\tfree(msgs[2]);\n\n\treturn ret_code;\n}"
  },
  {
    "function_name": "ServiceShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "781-830",
    "snippet": "int ServiceShutdown(char *Udn, char *ServType, char *Location, int Duration,\n\t\t    int AddressFamily, int PowerState,\n\t\t    int SleepPeriod, int RegistrationState)\n{\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *szReq[1];\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tmemset(&__ss, 0, sizeof(__ss));\n\tszReq[0] = NULL;\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\t/* sprintf(Mil_Nt,\"%s\",ServType); */\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, ServType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\t/* CreateServiceRequestPacket(0,szReq[0],Mil_Nt,Mil_Usn,\n\t * Server,Location,Duration); */\n\tCreateServicePacket(MSGTYPE_SHUTDOWN, ServType, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[0], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\tif (szReq[0] == NULL)\n\t\tgoto error_handler;\n\tRetVal = NewRequestHandler((struct sockaddr *)&__ss, 1, szReq);\n\nerror_handler:\n\tfree(szReq[0]);\n\n\treturn RetVal;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_SHUTDOWN\t0",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "szReq[0]"
          ],
          "line": 827
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "(struct sockaddr *)&__ss",
            "1",
            "szReq"
          ],
          "line": 824
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_SHUTDOWN",
            "ServType",
            "Mil_Usn",
            "Location",
            "Duration",
            "&szReq[0]",
            "AddressFamily",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 819
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "ServType"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UpnpPrintf",
          "args": [
            "UPNP_CRITICAL",
            "SSDP",
            "__FILE__",
            "__LINE__",
            "\"Invalid device address family.\\n\""
          ],
          "line": 810
        },
        "resolved": true,
        "details": {
          "function_name": "UpnpPrintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpdebug.c",
          "lines": "124-154",
          "snippet": "void UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include \"upnpdebug.h\"",
            "#include \"upnp.h\"",
            "#include \"ixml.h\"",
            "#include \"ithread.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include \"upnpdebug.h\"\n#include \"upnp.h\"\n#include \"ixml.h\"\n#include \"ithread.h\"\n#include \"config.h\"\n\nvoid UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_pton",
          "args": [
            "AF_INET6",
            "(isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL",
            "&DestAddr6->sin6_addr"
          ],
          "line": 803
        },
        "resolved": true,
        "details": {
          "function_name": "inet_pton",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/inet_pton.c",
          "lines": "307-321",
          "snippet": "int inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"inet_pton.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inet_pton.h\"\n\nint inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "isUrlV6UlaGua",
          "args": [
            "Location"
          ],
          "line": 804
        },
        "resolved": true,
        "details": {
          "function_name": "isUrlV6UlaGua",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "299-310",
          "snippet": "static int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&__ss",
            "0",
            "sizeof(__ss)"
          ],
          "line": 793
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "345-352",
          "snippet": "static void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memset"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memset;\n\nstatic void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_SHUTDOWN\t0\n#define snprintf _snprintf\n\nint ServiceShutdown(char *Udn, char *ServType, char *Location, int Duration,\n\t\t    int AddressFamily, int PowerState,\n\t\t    int SleepPeriod, int RegistrationState)\n{\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *szReq[1];\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tmemset(&__ss, 0, sizeof(__ss));\n\tszReq[0] = NULL;\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\t/* sprintf(Mil_Nt,\"%s\",ServType); */\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, ServType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\t/* CreateServiceRequestPacket(0,szReq[0],Mil_Nt,Mil_Usn,\n\t * Server,Location,Duration); */\n\tCreateServicePacket(MSGTYPE_SHUTDOWN, ServType, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[0], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\tif (szReq[0] == NULL)\n\t\tgoto error_handler;\n\tRetVal = NewRequestHandler((struct sockaddr *)&__ss, 1, szReq);\n\nerror_handler:\n\tfree(szReq[0]);\n\n\treturn RetVal;\n}"
  },
  {
    "function_name": "ServiceReply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "755-779",
    "snippet": "int ServiceReply(struct sockaddr *DestAddr, char *ServType, char *Udn,\n\t\t char *Location, int Duration, int PowerState, int SleepPeriod,\n\t\t int RegistrationState)\n{\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *szReq[1];\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tszReq[0] = NULL;\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, ServType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_REPLY, ServType, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[0], (int)DestAddr->sa_family,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\tif (szReq[0] == NULL)\n\t\tgoto error_handler;\n\tRetVal = NewRequestHandler(DestAddr, 1, szReq);\n\nerror_handler:\n\tfree(szReq[0]);\n\n\treturn RetVal;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_REPLY\t\t2",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "szReq[0]"
          ],
          "line": 776
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "DestAddr",
            "1",
            "szReq"
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_REPLY",
            "ServType",
            "Mil_Usn",
            "Location",
            "Duration",
            "&szReq[0]",
            "(int)DestAddr->sa_family",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 768
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "ServType"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define snprintf _snprintf\n\nint ServiceReply(struct sockaddr *DestAddr, char *ServType, char *Udn,\n\t\t char *Location, int Duration, int PowerState, int SleepPeriod,\n\t\t int RegistrationState)\n{\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *szReq[1];\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tszReq[0] = NULL;\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, ServType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_REPLY, ServType, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[0], (int)DestAddr->sa_family,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\tif (szReq[0] == NULL)\n\t\tgoto error_handler;\n\tRetVal = NewRequestHandler(DestAddr, 1, szReq);\n\nerror_handler:\n\tfree(szReq[0]);\n\n\treturn RetVal;\n}"
  },
  {
    "function_name": "ServiceAdvertisement",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "704-753",
    "snippet": "int ServiceAdvertisement(char *Udn, char *ServType, char *Location,\n\t\t\t int Duration, int AddressFamily,\n\t\t\t int PowerState, int SleepPeriod, int RegistrationState)\n{\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *szReq[1];\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\tint rc = 0;\n\n\tmemset(&__ss, 0, sizeof(__ss));\n\tszReq[0] = NULL;\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, ServType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\t/* CreateServiceRequestPacket(1,szReq[0],Mil_Nt,Mil_Usn,\n\t * Server,Location,Duration); */\n\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, ServType, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[0], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\tif (szReq[0] == NULL) {\n\t\tgoto error_handler;\n\t}\n\tRetVal = NewRequestHandler((struct sockaddr *)&__ss, 1, szReq);\n\nerror_handler:\n\tfree(szReq[0]);\n\n\treturn RetVal;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_ADVERTISEMENT\t1",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "szReq[0]"
          ],
          "line": 750
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "(struct sockaddr *)&__ss",
            "1",
            "szReq"
          ],
          "line": 747
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_ADVERTISEMENT",
            "ServType",
            "Mil_Usn",
            "Location",
            "Duration",
            "&szReq[0]",
            "AddressFamily",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 741
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "ServType"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UpnpPrintf",
          "args": [
            "UPNP_CRITICAL",
            "SSDP",
            "__FILE__",
            "__LINE__",
            "\"Invalid device address family.\\n\""
          ],
          "line": 733
        },
        "resolved": true,
        "details": {
          "function_name": "UpnpPrintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpdebug.c",
          "lines": "124-154",
          "snippet": "void UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include \"upnpdebug.h\"",
            "#include \"upnp.h\"",
            "#include \"ixml.h\"",
            "#include \"ithread.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include \"upnpdebug.h\"\n#include \"upnp.h\"\n#include \"ixml.h\"\n#include \"ithread.h\"\n#include \"config.h\"\n\nvoid UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_pton",
          "args": [
            "AF_INET6",
            "(isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL",
            "&DestAddr6->sin6_addr"
          ],
          "line": 726
        },
        "resolved": true,
        "details": {
          "function_name": "inet_pton",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/inet_pton.c",
          "lines": "307-321",
          "snippet": "int inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"inet_pton.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inet_pton.h\"\n\nint inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "isUrlV6UlaGua",
          "args": [
            "Location"
          ],
          "line": 727
        },
        "resolved": true,
        "details": {
          "function_name": "isUrlV6UlaGua",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "299-310",
          "snippet": "static int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&__ss",
            "0",
            "sizeof(__ss)"
          ],
          "line": 716
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "345-352",
          "snippet": "static void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memset"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memset;\n\nstatic void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_ADVERTISEMENT\t1\n#define snprintf _snprintf\n\nint ServiceAdvertisement(char *Udn, char *ServType, char *Location,\n\t\t\t int Duration, int AddressFamily,\n\t\t\t int PowerState, int SleepPeriod, int RegistrationState)\n{\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *szReq[1];\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\tint rc = 0;\n\n\tmemset(&__ss, 0, sizeof(__ss));\n\tszReq[0] = NULL;\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AddressFamily;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, ServType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\t/* CreateServiceRequestPacket(1,szReq[0],Mil_Nt,Mil_Usn,\n\t * Server,Location,Duration); */\n\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, ServType, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[0], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\tif (szReq[0] == NULL) {\n\t\tgoto error_handler;\n\t}\n\tRetVal = NewRequestHandler((struct sockaddr *)&__ss, 1, szReq);\n\nerror_handler:\n\tfree(szReq[0]);\n\n\treturn RetVal;\n}"
  },
  {
    "function_name": "DeviceReply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "641-702",
    "snippet": "int DeviceReply(struct sockaddr *DestAddr, char *DevType, int RootDev,\n\t\tchar *Udn, char *Location, int Duration, int PowerState,\n\t\tint SleepPeriod, int RegistrationState)\n{\n\tchar *szReq[3], Mil_Nt[LINE_SIZE], Mil_Usn[LINE_SIZE];\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tszReq[0] = NULL;\n\tszReq[1] = NULL;\n\tszReq[2] = NULL;\n\t/* create 2 or 3 msgs */\n\tif (RootDev) {\n\t\t/* 3 replies for root device */\n\t\tmemset(Mil_Nt, 0, sizeof(Mil_Nt));\n\t\tstrncpy(Mil_Nt, \"upnp:rootdevice\", sizeof(Mil_Nt) - 1);\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\", Udn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_REPLY, Mil_Nt, Mil_Usn,\n\t\t\t\t    Location, Duration, &szReq[0],\n\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t    SleepPeriod, RegistrationState);\n\t}\n\trc = snprintf(Mil_Nt, sizeof(Mil_Nt), \"%s\", Udn);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Nt))\n\t\tgoto error_handler;\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s\", Udn);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_REPLY, Mil_Nt, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[1], (int)DestAddr->sa_family,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\trc = snprintf(Mil_Nt, sizeof(Mil_Nt), \"%s\", DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Nt))\n\t\tgoto error_handler;\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_REPLY, Mil_Nt, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[2], (int)DestAddr->sa_family,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\t/* check error */\n\tif ((RootDev && szReq[0] == NULL) ||\n\t    szReq[1] == NULL || szReq[2] == NULL) {\n\t\tgoto error_handler;\n\t}\n\t/* send replies */\n\tif (RootDev) {\n\t\tRetVal = NewRequestHandler(DestAddr, 3, szReq);\n\t} else {\n\t\tRetVal = NewRequestHandler(DestAddr, 2, &szReq[1]);\n\t}\n\nerror_handler:\n\t/* free */\n\tfree(szReq[0]);\n\tfree(szReq[1]);\n\tfree(szReq[2]);\n\n\treturn RetVal;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_REPLY\t\t2",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "szReq[2]"
          ],
          "line": 699
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "DestAddr",
            "2",
            "&szReq[1]"
          ],
          "line": 692
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_REPLY",
            "Mil_Nt",
            "Mil_Usn",
            "Location",
            "Duration",
            "&szReq[2]",
            "(int)DestAddr->sa_family",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "DevType"
          ],
          "line": 677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Nt",
            "sizeof(Mil_Nt)",
            "\"%s\"",
            "DevType"
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s\"",
            "Udn"
          ],
          "line": 668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Nt",
            "sizeof(Mil_Nt)",
            "\"%s\"",
            "Udn"
          ],
          "line": 665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::upnp:rootdevice\"",
            "Udn"
          ],
          "line": 657
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "Mil_Nt",
            "\"upnp:rootdevice\"",
            "sizeof(Mil_Nt) - 1"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "Mil_Nt",
            "0",
            "sizeof(Mil_Nt)"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "345-352",
          "snippet": "static void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memset"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memset;\n\nstatic void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define snprintf _snprintf\n\nint DeviceReply(struct sockaddr *DestAddr, char *DevType, int RootDev,\n\t\tchar *Udn, char *Location, int Duration, int PowerState,\n\t\tint SleepPeriod, int RegistrationState)\n{\n\tchar *szReq[3], Mil_Nt[LINE_SIZE], Mil_Usn[LINE_SIZE];\n\tint RetVal = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tszReq[0] = NULL;\n\tszReq[1] = NULL;\n\tszReq[2] = NULL;\n\t/* create 2 or 3 msgs */\n\tif (RootDev) {\n\t\t/* 3 replies for root device */\n\t\tmemset(Mil_Nt, 0, sizeof(Mil_Nt));\n\t\tstrncpy(Mil_Nt, \"upnp:rootdevice\", sizeof(Mil_Nt) - 1);\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\", Udn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_REPLY, Mil_Nt, Mil_Usn,\n\t\t\t\t    Location, Duration, &szReq[0],\n\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t    SleepPeriod, RegistrationState);\n\t}\n\trc = snprintf(Mil_Nt, sizeof(Mil_Nt), \"%s\", Udn);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Nt))\n\t\tgoto error_handler;\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s\", Udn);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_REPLY, Mil_Nt, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[1], (int)DestAddr->sa_family,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\trc = snprintf(Mil_Nt, sizeof(Mil_Nt), \"%s\", DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Nt))\n\t\tgoto error_handler;\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_REPLY, Mil_Nt, Mil_Usn,\n\t\t\t    Location, Duration, &szReq[2], (int)DestAddr->sa_family,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\t/* check error */\n\tif ((RootDev && szReq[0] == NULL) ||\n\t    szReq[1] == NULL || szReq[2] == NULL) {\n\t\tgoto error_handler;\n\t}\n\t/* send replies */\n\tif (RootDev) {\n\t\tRetVal = NewRequestHandler(DestAddr, 3, szReq);\n\t} else {\n\t\tRetVal = NewRequestHandler(DestAddr, 2, &szReq[1]);\n\t}\n\nerror_handler:\n\t/* free */\n\tfree(szReq[0]);\n\tfree(szReq[1]);\n\tfree(szReq[2]);\n\n\treturn RetVal;\n}"
  },
  {
    "function_name": "SendReply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "577-639",
    "snippet": "int SendReply(struct sockaddr *DestAddr, char *DevType, int RootDev,\n\t      char *Udn, char *Location, int Duration, int ByType,\n\t      int PowerState, int SleepPeriod, int RegistrationState)\n{\n\tint ret_code = UPNP_E_OUTOF_MEMORY;\n\tchar *msgs[2];\n\tint num_msgs;\n\tchar Mil_Usn[LINE_SIZE];\n\tint i;\n\tint rc = 0;\n\n\tmsgs[0] = NULL;\n\tmsgs[1] = NULL;\n\tif (RootDev) {\n\t\t/* one msg for root device */\n\t\tnum_msgs = 1;\n\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\",\n\t\t\tUdn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_REPLY, \"upnp:rootdevice\",\n\t\t\t\t    Mil_Usn, Location, Duration, &msgs[0],\n\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t    SleepPeriod, RegistrationState);\n\t} else {\n\t\t/* two msgs for embedded devices */\n\t\tnum_msgs = 1;\n\n\t\t/*NK: FIX for extra response when someone searches by udn */\n\t\tif (!ByType) {\n\t\t\tCreateServicePacket(MSGTYPE_REPLY, Udn, Udn, Location,\n\t\t\t\t\t    Duration, &msgs[0],\n\t\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t\t    SleepPeriod, RegistrationState);\n\t\t} else {\n\t\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn,\n\t\t\t\tDevType);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\t\tgoto error_handler;\n\t\t\tCreateServicePacket(MSGTYPE_REPLY, DevType, Mil_Usn,\n\t\t\t\t\t    Location, Duration, &msgs[0],\n\t\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t\t    SleepPeriod, RegistrationState);\n\t\t}\n\t}\n\t/* check error */\n\tfor (i = 0; i < num_msgs; i++) {\n\t\tif (msgs[i] == NULL) {\n\t\t\tgoto error_handler;\n\t\t}\n\t}\n\t/* send msgs */\n\tret_code = NewRequestHandler(DestAddr, num_msgs, msgs);\n\nerror_handler:\n\tfor (i = 0; i < num_msgs; i++) {\n\t\tif (msgs[i] != NULL)\n\t\t\tfree(msgs[i]);\n\t}\n\n\treturn ret_code;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_REPLY\t\t2",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msgs[i]"
          ],
          "line": 635
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "DestAddr",
            "num_msgs",
            "msgs"
          ],
          "line": 630
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_REPLY",
            "DevType",
            "Mil_Usn",
            "Location",
            "Duration",
            "&msgs[0]",
            "(int)DestAddr->sa_family",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "DevType"
          ],
          "line": 613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::upnp:rootdevice\"",
            "Udn"
          ],
          "line": 594
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define snprintf _snprintf\n\nint SendReply(struct sockaddr *DestAddr, char *DevType, int RootDev,\n\t      char *Udn, char *Location, int Duration, int ByType,\n\t      int PowerState, int SleepPeriod, int RegistrationState)\n{\n\tint ret_code = UPNP_E_OUTOF_MEMORY;\n\tchar *msgs[2];\n\tint num_msgs;\n\tchar Mil_Usn[LINE_SIZE];\n\tint i;\n\tint rc = 0;\n\n\tmsgs[0] = NULL;\n\tmsgs[1] = NULL;\n\tif (RootDev) {\n\t\t/* one msg for root device */\n\t\tnum_msgs = 1;\n\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\",\n\t\t\tUdn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_REPLY, \"upnp:rootdevice\",\n\t\t\t\t    Mil_Usn, Location, Duration, &msgs[0],\n\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t    SleepPeriod, RegistrationState);\n\t} else {\n\t\t/* two msgs for embedded devices */\n\t\tnum_msgs = 1;\n\n\t\t/*NK: FIX for extra response when someone searches by udn */\n\t\tif (!ByType) {\n\t\t\tCreateServicePacket(MSGTYPE_REPLY, Udn, Udn, Location,\n\t\t\t\t\t    Duration, &msgs[0],\n\t\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t\t    SleepPeriod, RegistrationState);\n\t\t} else {\n\t\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn,\n\t\t\t\tDevType);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\t\tgoto error_handler;\n\t\t\tCreateServicePacket(MSGTYPE_REPLY, DevType, Mil_Usn,\n\t\t\t\t\t    Location, Duration, &msgs[0],\n\t\t\t\t\t    (int)DestAddr->sa_family, PowerState,\n\t\t\t\t\t    SleepPeriod, RegistrationState);\n\t\t}\n\t}\n\t/* check error */\n\tfor (i = 0; i < num_msgs; i++) {\n\t\tif (msgs[i] == NULL) {\n\t\t\tgoto error_handler;\n\t\t}\n\t}\n\t/* send msgs */\n\tret_code = NewRequestHandler(DestAddr, num_msgs, msgs);\n\nerror_handler:\n\tfor (i = 0; i < num_msgs; i++) {\n\t\tif (msgs[i] != NULL)\n\t\t\tfree(msgs[i]);\n\t}\n\n\treturn ret_code;\n}"
  },
  {
    "function_name": "DeviceAdvertisement",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "493-575",
    "snippet": "int DeviceAdvertisement(char *DevType, int RootDev, char *Udn, char *Location,\n\t\t\tint Duration, int AddressFamily, int PowerState,\n\t\t\tint SleepPeriod, int RegistrationState)\n{\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\t/* char Mil_Nt[LINE_SIZE] */\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *msgs[3];\n\tint ret_code = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t   \"In function DeviceAdvertisement\\n\");\n\tmemset(&__ss, 0, sizeof(__ss));\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AF_INET;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AF_INET6;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\tmsgs[0] = NULL;\n\tmsgs[1] = NULL;\n\tmsgs[2] = NULL;\n\t/* If deviceis a root device , here we need to send 3 advertisement\n\t * or reply */\n\tif (RootDev) {\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\",\n\t\t\tUdn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, \"upnp:rootdevice\",\n\t\t\t\t    Mil_Usn, Location, Duration, &msgs[0],\n\t\t\t\t    AddressFamily, PowerState, SleepPeriod,\n\t\t\t\t    RegistrationState);\n\t}\n\t/* both root and sub-devices need to send these two messages */\n\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, Udn, Udn,\n\t\t\t    Location, Duration, &msgs[1], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, DevType, Mil_Usn,\n\t\t\t    Location, Duration, &msgs[2], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\t/* check error */\n\tif ((RootDev && msgs[0] == NULL) || msgs[1] == NULL || msgs[2] == NULL) {\n\t\tgoto error_handler;\n\t}\n\t/* send packets */\n\tif (RootDev) {\n\t\t/* send 3 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 3, &msgs[0]);\n\t} else {\t\t/* sub-device */\n\n\t\t/* send 2 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 2, &msgs[1]);\n\t}\n\nerror_handler:\n\t/* free msgs */\n\tfree(msgs[0]);\n\tfree(msgs[1]);\n\tfree(msgs[2]);\n\n\treturn ret_code;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_ADVERTISEMENT\t1",
      "#define snprintf _snprintf"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msgs[2]"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewRequestHandler",
          "args": [
            "(struct sockaddr *)&__ss",
            "2",
            "&msgs[1]"
          ],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "NewRequestHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "174-254",
          "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CreateServicePacket",
          "args": [
            "MSGTYPE_ADVERTISEMENT",
            "DevType",
            "Mil_Usn",
            "Location",
            "Duration",
            "&msgs[2]",
            "AddressFamily",
            "PowerState",
            "SleepPeriod",
            "RegistrationState"
          ],
          "line": 549
        },
        "resolved": true,
        "details": {
          "function_name": "CreateServicePacket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "317-491",
          "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define MSGTYPE_REPLY\t\t2",
            "#define MSGTYPE_ADVERTISEMENT\t1",
            "#define MSGTYPE_SHUTDOWN\t0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::%s\"",
            "Udn",
            "DevType"
          ],
          "line": 546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "Mil_Usn",
            "sizeof(Mil_Usn)",
            "\"%s::upnp:rootdevice\"",
            "Udn"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UpnpPrintf",
          "args": [
            "UPNP_CRITICAL",
            "SSDP",
            "__FILE__",
            "__LINE__",
            "\"Invalid device address family.\\n\""
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "UpnpPrintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpdebug.c",
          "lines": "124-154",
          "snippet": "void UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include \"upnpdebug.h\"",
            "#include \"upnp.h\"",
            "#include \"ixml.h\"",
            "#include \"ithread.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include \"upnpdebug.h\"\n#include \"upnp.h\"\n#include \"ixml.h\"\n#include \"ithread.h\"\n#include \"config.h\"\n\nvoid UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_pton",
          "args": [
            "AF_INET6",
            "(isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL",
            "&DestAddr6->sin6_addr"
          ],
          "line": 517
        },
        "resolved": true,
        "details": {
          "function_name": "inet_pton",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/inet_pton.c",
          "lines": "307-321",
          "snippet": "int inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"inet_pton.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inet_pton.h\"\n\nint inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "isUrlV6UlaGua",
          "args": [
            "Location"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "isUrlV6UlaGua",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "299-310",
          "snippet": "static int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "SSDP_PORT"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&__ss",
            "0",
            "sizeof(__ss)"
          ],
          "line": 508
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "345-352",
          "snippet": "static void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memset"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memset;\n\nstatic void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_ADVERTISEMENT\t1\n#define snprintf _snprintf\n\nint DeviceAdvertisement(char *DevType, int RootDev, char *Udn, char *Location,\n\t\t\tint Duration, int AddressFamily, int PowerState,\n\t\t\tint SleepPeriod, int RegistrationState)\n{\n\tstruct sockaddr_storage __ss;\n\tstruct sockaddr_in *DestAddr4 = (struct sockaddr_in *)&__ss;\n\tstruct sockaddr_in6 *DestAddr6 = (struct sockaddr_in6 *)&__ss;\n\t/* char Mil_Nt[LINE_SIZE] */\n\tchar Mil_Usn[LINE_SIZE];\n\tchar *msgs[3];\n\tint ret_code = UPNP_E_OUTOF_MEMORY;\n\tint rc = 0;\n\n\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t   \"In function DeviceAdvertisement\\n\");\n\tmemset(&__ss, 0, sizeof(__ss));\n\tswitch (AddressFamily) {\n\tcase AF_INET:\n\t\tDestAddr4->sin_family = (sa_family_t)AF_INET;\n\t\tinet_pton(AF_INET, SSDP_IP, &DestAddr4->sin_addr);\n\t\tDestAddr4->sin_port = htons(SSDP_PORT);\n\t\tbreak;\n\tcase AF_INET6:\n\t\tDestAddr6->sin6_family = (sa_family_t)AF_INET6;\n\t\tinet_pton(AF_INET6,\n\t\t\t  (isUrlV6UlaGua(Location)) ? SSDP_IPV6_SITELOCAL :\n\t\t\t  SSDP_IPV6_LINKLOCAL, &DestAddr6->sin6_addr);\n\t\tDestAddr6->sin6_port = htons(SSDP_PORT);\n\t\tDestAddr6->sin6_scope_id = gIF_INDEX;\n\t\tbreak;\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid device address family.\\n\");\n\t}\n\tmsgs[0] = NULL;\n\tmsgs[1] = NULL;\n\tmsgs[2] = NULL;\n\t/* If deviceis a root device , here we need to send 3 advertisement\n\t * or reply */\n\tif (RootDev) {\n\t\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::upnp:rootdevice\",\n\t\t\tUdn);\n\t\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\t\tgoto error_handler;\n\t\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, \"upnp:rootdevice\",\n\t\t\t\t    Mil_Usn, Location, Duration, &msgs[0],\n\t\t\t\t    AddressFamily, PowerState, SleepPeriod,\n\t\t\t\t    RegistrationState);\n\t}\n\t/* both root and sub-devices need to send these two messages */\n\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, Udn, Udn,\n\t\t\t    Location, Duration, &msgs[1], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\trc = snprintf(Mil_Usn, sizeof(Mil_Usn), \"%s::%s\", Udn, DevType);\n\tif (rc < 0 || (unsigned int) rc >= sizeof(Mil_Usn))\n\t\tgoto error_handler;\n\tCreateServicePacket(MSGTYPE_ADVERTISEMENT, DevType, Mil_Usn,\n\t\t\t    Location, Duration, &msgs[2], AddressFamily,\n\t\t\t    PowerState, SleepPeriod, RegistrationState);\n\t/* check error */\n\tif ((RootDev && msgs[0] == NULL) || msgs[1] == NULL || msgs[2] == NULL) {\n\t\tgoto error_handler;\n\t}\n\t/* send packets */\n\tif (RootDev) {\n\t\t/* send 3 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 3, &msgs[0]);\n\t} else {\t\t/* sub-device */\n\n\t\t/* send 2 msg types */\n\t\tret_code =\n\t\t    NewRequestHandler((struct sockaddr *)&__ss, 2, &msgs[1]);\n\t}\n\nerror_handler:\n\t/* free msgs */\n\tfree(msgs[0]);\n\tfree(msgs[1]);\n\tfree(msgs[2]);\n\n\treturn ret_code;\n}"
  },
  {
    "function_name": "CreateServicePacket",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "317-491",
    "snippet": "static void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MSGTYPE_REPLY\t\t2",
      "#define MSGTYPE_ADVERTISEMENT\t1",
      "#define MSGTYPE_SHUTDOWN\t0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "membuffer_destroy",
          "args": [
            "&buf"
          ],
          "line": 488
        },
        "resolved": true,
        "details": {
          "function_name": "membuffer_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/util/membuffer.c",
          "lines": "160-168",
          "snippet": "void membuffer_destroy(membuffer *m)\n{\n\tif (m == NULL) {\n\t\treturn;\n\t}\n\n\tfree(m->buf);\n\tmembuffer_init(m);\n}",
          "includes": [
            "#include \"unixutil.h\"",
            "#include \"upnp.h\"",
            "#include \"membuffer.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <assert.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"unixutil.h\"\n#include \"upnp.h\"\n#include \"membuffer.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <assert.h>\n#include \"config.h\"\n\nvoid membuffer_destroy(membuffer *m)\n{\n\tif (m == NULL) {\n\t\treturn;\n\t}\n\n\tfree(m->buf);\n\tmembuffer_init(m);\n}"
        }
      },
      {
        "call_info": {
          "callee": "membuffer_detach",
          "args": [
            "&buf"
          ],
          "line": 487
        },
        "resolved": true,
        "details": {
          "function_name": "membuffer_detach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/util/membuffer.c",
          "lines": "273-285",
          "snippet": "char *membuffer_detach(membuffer *m)\n{\n\tchar *buf;\n\n\tassert(m != NULL);\n\n\tbuf = m->buf;\n\n\t/* free all */\n\tmembuffer_initialize(m);\n\n\treturn buf;\n}",
          "includes": [
            "#include \"unixutil.h\"",
            "#include \"upnp.h\"",
            "#include \"membuffer.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <assert.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"unixutil.h\"\n#include \"upnp.h\"\n#include \"membuffer.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <assert.h>\n#include \"config.h\"\n\nchar *membuffer_detach(membuffer *m)\n{\n\tchar *buf;\n\n\tassert(m != NULL);\n\n\tbuf = m->buf;\n\n\t/* free all */\n\tmembuffer_initialize(m);\n\n\treturn buf;\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "0"
          ],
          "line": 485
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "http_MakeMessage",
          "args": [
            "&buf",
            "1",
            "1",
            "\"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\"",
            "HTTPMETHOD_NOTIFY",
            "\"*\"",
            "(size_t) 1",
            "\"HOST: \"",
            "host",
            "\":\"",
            "SSDP_PORT",
            "\"CACHE-CONTROL: max-age=\"",
            "duration",
            "\"LOCATION: \"",
            "location",
            "\"NT: \"",
            "nt",
            "\"NTS: \"",
            "nts",
            "\"USN: \"",
            "usn"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "http_MakeMessage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/net/http/httpreadwrite.c",
          "lines": "1470-1703",
          "snippet": "int http_MakeMessage(membuffer *buf, int http_major_version,\n\tint http_minor_version, const char *fmt, ...)\n{\n\tchar c;\n\tchar *s = NULL;\n\tsize_t num;\n\toff_t bignum;\n\tsize_t length;\n\ttime_t *loc_time;\n\ttime_t curr_time;\n\tstruct tm date_storage;\n\tstruct tm *date;\n\tconst char *start_str;\n\tconst char *end_str;\n\tint status_code;\n\tconst char *status_msg;\n\thttp_method_t method;\n\tconst char *method_str;\n\tconst char *url_str;\n\tconst char *temp_str;\n\turi_type url;\n\turi_type *uri_ptr;\n\tint error_code = 0;\n\tva_list argp;\n\tchar tempbuf[200];\n\tconst char *weekday_str = \"Sun\\0Mon\\0Tue\\0Wed\\0Thu\\0Fri\\0Sat\";\n\tconst char *month_str = \"Jan\\0Feb\\0Mar\\0Apr\\0May\\0Jun\\0\"\n\t    \"Jul\\0Aug\\0Sep\\0Oct\\0Nov\\0Dec\";\n\tint rc = 0;\n\n\tmemset(tempbuf, 0, sizeof(tempbuf));\n\tva_start(argp, fmt);\n\twhile ((c = *fmt++)) {\n\t\tif (c == 's') {\n\t\t\t/* C string */\n\t\t\ts = (char *)va_arg(argp, char *);\n\t\t\tassert(s);\n\t\t\tUpnpPrintf(UPNP_ALL, HTTP, __FILE__, __LINE__,\n\t\t\t\t   \"Adding a string : %s\\n\", s);\n\t\t\tif (membuffer_append(buf, s, strlen(s)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'K') {\n\t\t\t/* Add Chunky header */\n\t\t\tif (membuffer_append(buf, \"TRANSFER-ENCODING: chunked\\r\\n\",\n\t\t\t\tstrlen(\"Transfer-Encoding: chunked\\r\\n\")))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'G') {\n\t\t\t/* Add Range header */\n\t\t\tstruct SendInstruction *RespInstr;\n\t\t\tRespInstr = (struct SendInstruction *)\n\t\t\t    va_arg(argp, struct SendInstruction *);\n\t\t\tassert(RespInstr);\n\t\t\t/* connection header */\n\t\t\tif (membuffer_append(buf, RespInstr->RangeHeader,\n\t\t\t\tstrlen(RespInstr->RangeHeader)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'b') {\n\t\t\t/* mem buffer */\n\t\t\ts = (char *)va_arg(argp, char *);\n\t\t\tUpnpPrintf(UPNP_ALL, HTTP, __FILE__, __LINE__,\n\t\t\t\t\"Adding a char Buffer starting with: %c\\n\", (int)s[0]);\n\t\t\tassert(s);\n\t\t\tlength = (size_t) va_arg(argp, size_t);\n\t\t\tif (membuffer_append(buf, s, length))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'c') {\n\t\t\t/* crlf */\n\t\t\tif (membuffer_append(buf, \"\\r\\n\", (size_t)2))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'd') {\n\t\t\t/* integer */\n\t\t\tnum = (size_t)va_arg(argp, int);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"%\" PRIzu, num);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\tmembuffer_append(buf, tempbuf, strlen(tempbuf)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'h') {\n\t\t\t/* off_t */\n\t\t\tbignum = (off_t) va_arg(argp, off_t);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"%\" PRId64,\n\t\t\t\t(int64_t) bignum);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\tmembuffer_append(buf, tempbuf, strlen(tempbuf)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 't' || c == 'D') {\n\t\t\t/* date */\n\t\t\tif (c == 'D') {\n\t\t\t\t/* header */\n\t\t\t\tstart_str = \"DATE: \";\n\t\t\t\tend_str = \"\\r\\n\";\n\t\t\t\tcurr_time = time(NULL);\n\t\t\t\tloc_time = &curr_time;\n\t\t\t} else {\n\t\t\t\t/* date value only */\n\t\t\t\tstart_str = end_str = \"\";\n\t\t\t\tloc_time = (time_t *)va_arg(argp, time_t *);\n\t\t\t}\n\t\t\tassert(loc_time);\n\t\t\tdate = http_gmtime_r(loc_time, &date_storage);\n\t\t\tif (date == NULL)\n\t\t\t\tgoto error_handler;\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf),\n\t\t\t\t\"%s%s, %02d %s %d %02d:%02d:%02d GMT%s\",\n\t\t\t\tstart_str, &weekday_str[date->tm_wday * 4],\n\t\t\t\tdate->tm_mday, &month_str[date->tm_mon * 4],\n\t\t\t\tdate->tm_year + 1900, date->tm_hour,\n\t\t\t\tdate->tm_min, date->tm_sec, end_str);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\tmembuffer_append(buf, tempbuf, strlen(tempbuf)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'L') {\n\t\t\t/* Add CONTENT-LANGUAGE header only if WEB_SERVER_CONTENT_LANGUAGE */\n\t\t\t/* is not empty and if Accept-Language header is not empty */\n\t\t\tstruct SendInstruction *RespInstr;\n\t\t\tRespInstr = (struct SendInstruction *)\n\t\t\t    va_arg(argp, struct SendInstruction *);\n\t\t\tassert(RespInstr);\n\t\t\tif (strcmp(RespInstr->AcceptLanguageHeader, \"\") &&\n\t\t\t    strcmp(WEB_SERVER_CONTENT_LANGUAGE, \"\") &&\n\t\t\t    http_MakeMessage(buf, http_major_version,\n\t\t\t\t\thttp_minor_version, \"ssc\",\n\t\t\t\t\t\"CONTENT-LANGUAGE: \",\n\t\t\t\t\tWEB_SERVER_CONTENT_LANGUAGE) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'C') {\n\t\t\tif ((http_major_version > 1) ||\n\t\t\t    (http_major_version == 1 && http_minor_version == 1)\n\t\t\t    ) {\n\t\t\t\t/* connection header */\n\t\t\t\tif (membuffer_append_str(buf, \"CONNECTION: close\\r\\n\"))\n\t\t\t\t\tgoto error_handler;\n\t\t\t}\n\t\t} else if (c == 'N') {\n\t\t\t/* content-length header */\n\t\t\tbignum = (off_t) va_arg(argp, off_t);\n\t\t\tassert(bignum >= 0);\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"shc\", \"CONTENT-LENGTH: \", bignum) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'S' || c == 'U') {\n\t\t\t/* SERVER or USER-AGENT header */\n\t\t\ttemp_str = (c == 'S') ? \"SERVER: \" : \"USER-AGENT: \";\n\t\t\tget_sdk_info(tempbuf, sizeof(tempbuf));\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ss\", temp_str, tempbuf) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'X') {\n\t\t\t/* C string */\n\t\t\ts = (char *)va_arg(argp, char *);\n\t\t\tassert(s);\n\t\t\tif (membuffer_append_str(buf, \"X-User-Agent: \") != 0)\n\t\t\t\tgoto error_handler;\n\t\t\tif (membuffer_append(buf, s, strlen(s)) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'R') {\n\t\t\t/* response start line */\n\t\t\t/*   e.g.: 'HTTP/1.1 200 OK' code */\n\t\t\tstatus_code = (int)va_arg(argp, int);\n\t\t\tassert(status_code > 0);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"HTTP/%d.%d %d \",\n\t\t\t\thttp_major_version, http_minor_version,\n\t\t\t\tstatus_code);\n\t\t\t/* str */\n\t\t\tstatus_msg = http_get_code_text(status_code);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\thttp_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ssc\", tempbuf, status_msg) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'B') {\n\t\t\t/* body of a simple reply */\n\t\t\tstatus_code = (int)va_arg(argp, int);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"%s%d %s%s\",\n\t\t\t\t\"<html><body><h1>\",\n\t\t\t\tstatus_code, http_get_code_text(status_code),\n\t\t\t\t\"</h1></body></html>\");\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf))\n\t\t\t\tgoto error_handler;\n\t\t\tbignum = (off_t)strlen(tempbuf);\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"NTcs\", bignum,\t/* content-length */\n\t\t\t\t\t     \"text/html\",\t/* content-type */\n\t\t\t\t\t     tempbuf) != 0\t/* body */\n\t\t\t    )\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'Q') {\n\t\t\t/* request start line */\n\t\t\t/* GET /foo/bar.html HTTP/1.1\\r\\n */\n\t\t\tmethod = (http_method_t) va_arg(argp, http_method_t);\n\t\t\tmethod_str = method_to_str(method);\n\t\t\turl_str = (const char *)va_arg(argp, const char *);\n\t\t\tnum = (size_t) va_arg(argp, size_t);\t\t/* length of url_str */\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ssbsdsdc\", method_str,\t/* method */\n\t\t\t\t\t     \" \", url_str, num,\t\t/* url */\n\t\t\t\t\t     \" HTTP/\", http_major_version, \".\",\n\t\t\t\t\t     http_minor_version) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'q') {\n\t\t\t/* request start line and HOST header */\n\t\t\tmethod = (http_method_t) va_arg(argp, http_method_t);\n\t\t\turi_ptr = (uri_type *) va_arg(argp, uri_type *);\n\t\t\tassert(uri_ptr);\n\t\t\tif (http_FixUrl(uri_ptr, &url) != 0) {\n\t\t\t\terror_code = UPNP_E_INVALID_URL;\n\t\t\t\tgoto error_handler;\n\t\t\t}\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t\"Q\" \"sbc\", method, url.pathquery.buff,\n\t\t\t\t\turl.pathquery.size, \"HOST: \",\n\t\t\t\t\turl.hostport.text.buff,\n\t\t\t\t\turl.hostport.text.size) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'T') {\n\t\t\t/* content type header */\n\t\t\ttemp_str = (const char *)va_arg(argp, const char *);\t/* type/subtype format */\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ssc\", \"CONTENT-TYPE: \", temp_str) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else {\n\t\t\tassert(0);\n\t\t}\n\t}\n\tgoto ExitFunction;\n\nerror_handler:\n\t/* Default is out of memory error. */\n\tif (!error_code)\n\t\terror_code = UPNP_E_OUTOF_MEMORY;\n\tmembuffer_destroy(buf);\n\nExitFunction:\n\tva_end(argp);\n\treturn error_code;\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include <arpa/inet.h>",
            "#include <malloc.h>",
            "#include <stdarg.h>",
            "#include <assert.h>",
            "#include \"webserver.h\"",
            "#include \"UpnpStdInt.h\"",
            "#include \"UpnpIntTypes.h\"",
            "#include \"UpnpInet.h\"",
            "#include \"sock.h\"",
            "#include \"statcodes.h\"",
            "#include \"uri.h\"",
            "#include \"membuffer.h\"",
            "#include \"upnpapi.h\"",
            "#include \"upnp.h\"",
            "#include \"unixutil.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define snprintf _snprintf"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include <arpa/inet.h>\n#include <malloc.h>\n#include <stdarg.h>\n#include <assert.h>\n#include \"webserver.h\"\n#include \"UpnpStdInt.h\"\n#include \"UpnpIntTypes.h\"\n#include \"UpnpInet.h\"\n#include \"sock.h\"\n#include \"statcodes.h\"\n#include \"uri.h\"\n#include \"membuffer.h\"\n#include \"upnpapi.h\"\n#include \"upnp.h\"\n#include \"unixutil.h\"\n#include \"httpreadwrite.h\"\n#include \"config.h\"\n\n#define snprintf _snprintf\n\nint http_MakeMessage(membuffer *buf, int http_major_version,\n\tint http_minor_version, const char *fmt, ...)\n{\n\tchar c;\n\tchar *s = NULL;\n\tsize_t num;\n\toff_t bignum;\n\tsize_t length;\n\ttime_t *loc_time;\n\ttime_t curr_time;\n\tstruct tm date_storage;\n\tstruct tm *date;\n\tconst char *start_str;\n\tconst char *end_str;\n\tint status_code;\n\tconst char *status_msg;\n\thttp_method_t method;\n\tconst char *method_str;\n\tconst char *url_str;\n\tconst char *temp_str;\n\turi_type url;\n\turi_type *uri_ptr;\n\tint error_code = 0;\n\tva_list argp;\n\tchar tempbuf[200];\n\tconst char *weekday_str = \"Sun\\0Mon\\0Tue\\0Wed\\0Thu\\0Fri\\0Sat\";\n\tconst char *month_str = \"Jan\\0Feb\\0Mar\\0Apr\\0May\\0Jun\\0\"\n\t    \"Jul\\0Aug\\0Sep\\0Oct\\0Nov\\0Dec\";\n\tint rc = 0;\n\n\tmemset(tempbuf, 0, sizeof(tempbuf));\n\tva_start(argp, fmt);\n\twhile ((c = *fmt++)) {\n\t\tif (c == 's') {\n\t\t\t/* C string */\n\t\t\ts = (char *)va_arg(argp, char *);\n\t\t\tassert(s);\n\t\t\tUpnpPrintf(UPNP_ALL, HTTP, __FILE__, __LINE__,\n\t\t\t\t   \"Adding a string : %s\\n\", s);\n\t\t\tif (membuffer_append(buf, s, strlen(s)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'K') {\n\t\t\t/* Add Chunky header */\n\t\t\tif (membuffer_append(buf, \"TRANSFER-ENCODING: chunked\\r\\n\",\n\t\t\t\tstrlen(\"Transfer-Encoding: chunked\\r\\n\")))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'G') {\n\t\t\t/* Add Range header */\n\t\t\tstruct SendInstruction *RespInstr;\n\t\t\tRespInstr = (struct SendInstruction *)\n\t\t\t    va_arg(argp, struct SendInstruction *);\n\t\t\tassert(RespInstr);\n\t\t\t/* connection header */\n\t\t\tif (membuffer_append(buf, RespInstr->RangeHeader,\n\t\t\t\tstrlen(RespInstr->RangeHeader)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'b') {\n\t\t\t/* mem buffer */\n\t\t\ts = (char *)va_arg(argp, char *);\n\t\t\tUpnpPrintf(UPNP_ALL, HTTP, __FILE__, __LINE__,\n\t\t\t\t\"Adding a char Buffer starting with: %c\\n\", (int)s[0]);\n\t\t\tassert(s);\n\t\t\tlength = (size_t) va_arg(argp, size_t);\n\t\t\tif (membuffer_append(buf, s, length))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'c') {\n\t\t\t/* crlf */\n\t\t\tif (membuffer_append(buf, \"\\r\\n\", (size_t)2))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'd') {\n\t\t\t/* integer */\n\t\t\tnum = (size_t)va_arg(argp, int);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"%\" PRIzu, num);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\tmembuffer_append(buf, tempbuf, strlen(tempbuf)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'h') {\n\t\t\t/* off_t */\n\t\t\tbignum = (off_t) va_arg(argp, off_t);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"%\" PRId64,\n\t\t\t\t(int64_t) bignum);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\tmembuffer_append(buf, tempbuf, strlen(tempbuf)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 't' || c == 'D') {\n\t\t\t/* date */\n\t\t\tif (c == 'D') {\n\t\t\t\t/* header */\n\t\t\t\tstart_str = \"DATE: \";\n\t\t\t\tend_str = \"\\r\\n\";\n\t\t\t\tcurr_time = time(NULL);\n\t\t\t\tloc_time = &curr_time;\n\t\t\t} else {\n\t\t\t\t/* date value only */\n\t\t\t\tstart_str = end_str = \"\";\n\t\t\t\tloc_time = (time_t *)va_arg(argp, time_t *);\n\t\t\t}\n\t\t\tassert(loc_time);\n\t\t\tdate = http_gmtime_r(loc_time, &date_storage);\n\t\t\tif (date == NULL)\n\t\t\t\tgoto error_handler;\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf),\n\t\t\t\t\"%s%s, %02d %s %d %02d:%02d:%02d GMT%s\",\n\t\t\t\tstart_str, &weekday_str[date->tm_wday * 4],\n\t\t\t\tdate->tm_mday, &month_str[date->tm_mon * 4],\n\t\t\t\tdate->tm_year + 1900, date->tm_hour,\n\t\t\t\tdate->tm_min, date->tm_sec, end_str);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\tmembuffer_append(buf, tempbuf, strlen(tempbuf)))\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'L') {\n\t\t\t/* Add CONTENT-LANGUAGE header only if WEB_SERVER_CONTENT_LANGUAGE */\n\t\t\t/* is not empty and if Accept-Language header is not empty */\n\t\t\tstruct SendInstruction *RespInstr;\n\t\t\tRespInstr = (struct SendInstruction *)\n\t\t\t    va_arg(argp, struct SendInstruction *);\n\t\t\tassert(RespInstr);\n\t\t\tif (strcmp(RespInstr->AcceptLanguageHeader, \"\") &&\n\t\t\t    strcmp(WEB_SERVER_CONTENT_LANGUAGE, \"\") &&\n\t\t\t    http_MakeMessage(buf, http_major_version,\n\t\t\t\t\thttp_minor_version, \"ssc\",\n\t\t\t\t\t\"CONTENT-LANGUAGE: \",\n\t\t\t\t\tWEB_SERVER_CONTENT_LANGUAGE) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'C') {\n\t\t\tif ((http_major_version > 1) ||\n\t\t\t    (http_major_version == 1 && http_minor_version == 1)\n\t\t\t    ) {\n\t\t\t\t/* connection header */\n\t\t\t\tif (membuffer_append_str(buf, \"CONNECTION: close\\r\\n\"))\n\t\t\t\t\tgoto error_handler;\n\t\t\t}\n\t\t} else if (c == 'N') {\n\t\t\t/* content-length header */\n\t\t\tbignum = (off_t) va_arg(argp, off_t);\n\t\t\tassert(bignum >= 0);\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"shc\", \"CONTENT-LENGTH: \", bignum) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'S' || c == 'U') {\n\t\t\t/* SERVER or USER-AGENT header */\n\t\t\ttemp_str = (c == 'S') ? \"SERVER: \" : \"USER-AGENT: \";\n\t\t\tget_sdk_info(tempbuf, sizeof(tempbuf));\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ss\", temp_str, tempbuf) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'X') {\n\t\t\t/* C string */\n\t\t\ts = (char *)va_arg(argp, char *);\n\t\t\tassert(s);\n\t\t\tif (membuffer_append_str(buf, \"X-User-Agent: \") != 0)\n\t\t\t\tgoto error_handler;\n\t\t\tif (membuffer_append(buf, s, strlen(s)) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'R') {\n\t\t\t/* response start line */\n\t\t\t/*   e.g.: 'HTTP/1.1 200 OK' code */\n\t\t\tstatus_code = (int)va_arg(argp, int);\n\t\t\tassert(status_code > 0);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"HTTP/%d.%d %d \",\n\t\t\t\thttp_major_version, http_minor_version,\n\t\t\t\tstatus_code);\n\t\t\t/* str */\n\t\t\tstatus_msg = http_get_code_text(status_code);\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf) ||\n\t\t\t\thttp_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ssc\", tempbuf, status_msg) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'B') {\n\t\t\t/* body of a simple reply */\n\t\t\tstatus_code = (int)va_arg(argp, int);\n\t\t\trc = snprintf(tempbuf, sizeof(tempbuf), \"%s%d %s%s\",\n\t\t\t\t\"<html><body><h1>\",\n\t\t\t\tstatus_code, http_get_code_text(status_code),\n\t\t\t\t\"</h1></body></html>\");\n\t\t\tif (rc < 0 || (unsigned int) rc >= sizeof(tempbuf))\n\t\t\t\tgoto error_handler;\n\t\t\tbignum = (off_t)strlen(tempbuf);\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"NTcs\", bignum,\t/* content-length */\n\t\t\t\t\t     \"text/html\",\t/* content-type */\n\t\t\t\t\t     tempbuf) != 0\t/* body */\n\t\t\t    )\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'Q') {\n\t\t\t/* request start line */\n\t\t\t/* GET /foo/bar.html HTTP/1.1\\r\\n */\n\t\t\tmethod = (http_method_t) va_arg(argp, http_method_t);\n\t\t\tmethod_str = method_to_str(method);\n\t\t\turl_str = (const char *)va_arg(argp, const char *);\n\t\t\tnum = (size_t) va_arg(argp, size_t);\t\t/* length of url_str */\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ssbsdsdc\", method_str,\t/* method */\n\t\t\t\t\t     \" \", url_str, num,\t\t/* url */\n\t\t\t\t\t     \" HTTP/\", http_major_version, \".\",\n\t\t\t\t\t     http_minor_version) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'q') {\n\t\t\t/* request start line and HOST header */\n\t\t\tmethod = (http_method_t) va_arg(argp, http_method_t);\n\t\t\turi_ptr = (uri_type *) va_arg(argp, uri_type *);\n\t\t\tassert(uri_ptr);\n\t\t\tif (http_FixUrl(uri_ptr, &url) != 0) {\n\t\t\t\terror_code = UPNP_E_INVALID_URL;\n\t\t\t\tgoto error_handler;\n\t\t\t}\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t\"Q\" \"sbc\", method, url.pathquery.buff,\n\t\t\t\t\turl.pathquery.size, \"HOST: \",\n\t\t\t\t\turl.hostport.text.buff,\n\t\t\t\t\turl.hostport.text.size) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else if (c == 'T') {\n\t\t\t/* content type header */\n\t\t\ttemp_str = (const char *)va_arg(argp, const char *);\t/* type/subtype format */\n\t\t\tif (http_MakeMessage(buf, http_major_version, http_minor_version,\n\t\t\t\t\t     \"ssc\", \"CONTENT-TYPE: \", temp_str) != 0)\n\t\t\t\tgoto error_handler;\n\t\t} else {\n\t\t\tassert(0);\n\t\t}\n\t}\n\tgoto ExitFunction;\n\nerror_handler:\n\t/* Default is out of memory error. */\n\tif (!error_code)\n\t\terror_code = UPNP_E_OUTOF_MEMORY;\n\tmembuffer_destroy(buf);\n\nExitFunction:\n\tva_end(argp);\n\treturn error_code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "isUrlV6UlaGua",
          "args": [
            "location"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "isUrlV6UlaGua",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "299-310",
          "snippet": "static int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "membuffer_init",
          "args": [
            "&buf"
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "membuffer_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/util/membuffer.c",
          "lines": "152-158",
          "snippet": "void membuffer_init(membuffer *m)\n{\n\tassert(m != NULL);\n\n\tm->size_inc = MEMBUF_DEF_SIZE_INC;\n\tmembuffer_initialize(m);\n}",
          "includes": [
            "#include \"unixutil.h\"",
            "#include \"upnp.h\"",
            "#include \"membuffer.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <assert.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"unixutil.h\"\n#include \"upnp.h\"\n#include \"membuffer.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <assert.h>\n#include \"config.h\"\n\nvoid membuffer_init(membuffer *m)\n{\n\tassert(m != NULL);\n\n\tm->size_inc = MEMBUF_DEF_SIZE_INC;\n\tmembuffer_initialize(m);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MSGTYPE_REPLY\t\t2\n#define MSGTYPE_ADVERTISEMENT\t1\n#define MSGTYPE_SHUTDOWN\t0\n\nstatic void CreateServicePacket(\n\t/*! [in] type of the message (Search Reply, Advertisement\n\t * or Shutdown). */\n\tint msg_type,\n\t/*! [in] ssdp type. */\n\tconst char *nt,\n\t/*! [in] unique service name ( go in the HTTP Header). */\n\tchar *usn,\n\t/*! [in] Location URL. */\n\tchar *location,\n\t/*! [in] Service duration in sec. */\n\tint duration,\n\t/*! [out] Output buffer filled with HTTP statement. */\n\tchar **packet,\n\t/*! [in] Address family of the HTTP request. */\n\tint AddressFamily,\n\t/*! [in] PowerState as defined by UPnP Low Power. */\n\tint PowerState,\n\t/*! [in] SleepPeriod as defined by UPnP Low Power. */\n\tint SleepPeriod,\n\t/*! [in] RegistrationState as defined by UPnP Low Power. */\n\tint RegistrationState)\n{\n\tint ret_code;\n\tconst char *nts;\n\tmembuffer buf;\n\n\t/* Notf == 0 means service shutdown,\n\t * Notf == 1 means service advertisement,\n\t * Notf == 2 means reply */\n\tmembuffer_init(&buf);\n\tbuf.size_inc = (size_t)30;\n\t*packet = NULL;\n\tif (msg_type == MSGTYPE_REPLY) {\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n                        ret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn, \"Powerstate: \", PowerState,\n\t\t\t\t\t    \"SleepPeriod: \", SleepPeriod,\n\t\t\t\t\t    \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"Xc\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid,\n\t\t\t\t\t    X_USER_AGENT, \"ST: \", nt, \"USN: \",\n\t\t\t\t\t    usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"R\" \"sdc\" \"D\" \"sc\" \"ssc\"\n\t\t\t\t\t    \"S\" \"ssc\" \"sscc\", HTTP_OK,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"EXT:\", \"LOCATION: \", location,\n\t\t\t\t\t    \"ST: \", nt, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code != 0) {\n\t\t\treturn;\n\t\t}\n\t} else if (msg_type == MSGTYPE_ADVERTISEMENT ||\n\t\t   msg_type == MSGTYPE_SHUTDOWN) {\n\t\tconst char *host = NULL;\n\n\t\tif (msg_type == MSGTYPE_ADVERTISEMENT)\n\t\t\tnts = \"ssdp:alive\";\n\t\telse\n\t\t\t/* shutdown */\n\t\t\tnts = \"ssdp:byebye\";\n\t\t/* NOTE: The CACHE-CONTROL and LOCATION headers are not present in\n\t\t * a shutdown msg, but are present here for MS WinMe interop. */\n\t\tswitch (AddressFamily) {\n\t\tcase AF_INET:\n\t\t\thost = SSDP_IP;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (isUrlV6UlaGua(location))\n\t\t\t\thost = \"[\" SSDP_IPV6_SITELOCAL \"]\";\n\t\t\telse\n\t\t\t\thost = \"[\" SSDP_IPV6_LINKLOCAL \"]\";\n\t\t}\n\t\tif (PowerState > 0) {\n#ifdef UPNP_HAVE_OPTSSDP\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"ssc\"\n\t\t\t\t\t    \"sdc\" \"sdc\" \"sdcc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts,\n\t\t\t\t\t    \"USN: \", usn, \"Powerstate: \",\n\t\t\t\t\t    PowerState, \"SleepPeriod: \",\n\t\t\t\t\t    SleepPeriod, \"RegistrationState: \",\n\t\t\t\t\t    RegistrationState);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t} else {\n#ifdef UPNP_HAVE_OPTSSDP \n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\" \"ssc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"Xc\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"OPT: \",\n\t\t\t\t\t    \"\\\"http://schemas.upnp.org/upnp/1/0/\\\"; ns=01\",\n\t\t\t\t\t    \"01-NLS: \", gUpnpSdkNLSuuid, \"NT: \",\n\t\t\t\t\t    nt, \"NTS: \", nts, X_USER_AGENT,\n\t\t\t\t\t    \"USN: \", usn);\n#else\n\t\t\tret_code = http_MakeMessage(&buf, 1, 1,\n\t\t\t\t\t    \"Q\" \"sssdc\" \"sdc\" \"ssc\"\n\t\t\t\t\t    \"ssc\" \"ssc\" \"S\" \"sscc\",\n\t\t\t\t\t    HTTPMETHOD_NOTIFY, \"*\", (size_t) 1,\n\t\t\t\t\t    \"HOST: \", host, \":\", SSDP_PORT,\n\t\t\t\t\t    \"CACHE-CONTROL: max-age=\", duration,\n\t\t\t\t\t    \"LOCATION: \", location, \"NT: \", nt,\n\t\t\t\t\t    \"NTS: \", nts, \"USN: \", usn);\n#endif /* UPNP_HAVE_OPTSSDP */\n\t\t}\n\t\tif (ret_code)\n\t\t\treturn;\n\t} else\n\t\t/* unknown msg */\n\t\tassert(0);\n\t/* return msg */\n\t*packet = membuffer_detach(&buf);\n\tmembuffer_destroy(&buf);\n\n\treturn;\n}"
  },
  {
    "function_name": "isUrlV6UlaGua",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "299-310",
    "snippet": "static int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "IN6_IS_ADDR_LINKLOCAL",
          "args": [
            "&v6_addr"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_pton",
          "args": [
            "AF_INET6",
            "address",
            "&v6_addr"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "inet_pton",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/inet_pton.c",
          "lines": "307-321",
          "snippet": "int inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"inet_pton.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inet_pton.h\"\n\nint inet_pton(int af, const char *src, void *dst)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_pton4(src, dst);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_pton6(src, dst);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn -1;\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "extractIPv6address",
          "args": [
            "descdocUrl",
            "address"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "extractIPv6address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
          "lines": "261-292",
          "snippet": "static int extractIPv6address(char *url, char *address)\n{\n\tint i = 0;\n\tint j = 0;\n\tint ret = 0;\n\n\twhile (url[i] != '[' && url[i] != '\\0') {\n\t\ti++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\t/* bracket has been found, we deal with an IPv6 address */\n\ti++;\n\twhile (url[i] != '\\0' && url[i] != ']') {\n\t\taddress[j] = url[i];\n\t\ti++;\n\t\tj++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\tif (url[i] == ']') {\n\t\taddress[j] = '\\0';\n\t\tret = 1;\n\t}\n\n exit_function:\n\treturn ret;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <assert.h>",
            "#include \"UpnpInet.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int extractIPv6address(char *url, char *address)\n{\n\tint i = 0;\n\tint j = 0;\n\tint ret = 0;\n\n\twhile (url[i] != '[' && url[i] != '\\0') {\n\t\ti++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\t/* bracket has been found, we deal with an IPv6 address */\n\ti++;\n\twhile (url[i] != '\\0' && url[i] != ']') {\n\t\taddress[j] = url[i];\n\t\ti++;\n\t\tj++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\tif (url[i] == ']') {\n\t\taddress[j] = '\\0';\n\t\tret = 1;\n\t}\n\n exit_function:\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int isUrlV6UlaGua(char *descdocUrl)\n{\n\tchar address[INET6_ADDRSTRLEN];\n\tstruct in6_addr v6_addr;\n\n\tif (extractIPv6address(descdocUrl, address)) {\n\t\tinet_pton(AF_INET6, address, &v6_addr);\n\t\treturn !IN6_IS_ADDR_LINKLOCAL(&v6_addr);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "extractIPv6address",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "261-292",
    "snippet": "static int extractIPv6address(char *url, char *address)\n{\n\tint i = 0;\n\tint j = 0;\n\tint ret = 0;\n\n\twhile (url[i] != '[' && url[i] != '\\0') {\n\t\ti++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\t/* bracket has been found, we deal with an IPv6 address */\n\ti++;\n\twhile (url[i] != '\\0' && url[i] != ']') {\n\t\taddress[j] = url[i];\n\t\ti++;\n\t\tj++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\tif (url[i] == ']') {\n\t\taddress[j] = '\\0';\n\t\tret = 1;\n\t}\n\n exit_function:\n\treturn ret;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int extractIPv6address(char *url, char *address)\n{\n\tint i = 0;\n\tint j = 0;\n\tint ret = 0;\n\n\twhile (url[i] != '[' && url[i] != '\\0') {\n\t\ti++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\t/* bracket has been found, we deal with an IPv6 address */\n\ti++;\n\twhile (url[i] != '\\0' && url[i] != ']') {\n\t\taddress[j] = url[i];\n\t\ti++;\n\t\tj++;\n\t}\n\tif (url[i] == '\\0') {\n\t\tgoto exit_function;\n\t}\n\n\tif (url[i] == ']') {\n\t\taddress[j] = '\\0';\n\t\tret = 1;\n\t}\n\n exit_function:\n\treturn ret;\n}"
  },
  {
    "function_name": "NewRequestHandler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "174-254",
    "snippet": "static int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "UpnpCloseSocket",
          "args": [
            "ReplySock"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UpnpPrintf",
          "args": [
            "UPNP_INFO",
            "SSDP",
            "__FILE__",
            "__LINE__",
            "\"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\"",
            "errorBuffer"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "UpnpPrintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpdebug.c",
          "lines": "124-154",
          "snippet": "void UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include \"upnpdebug.h\"",
            "#include \"upnp.h\"",
            "#include \"ixml.h\"",
            "#include \"ithread.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include \"upnpdebug.h\"\n#include \"upnp.h\"\n#include \"ixml.h\"\n#include \"ithread.h\"\n#include \"config.h\"\n\nvoid UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror_r",
          "args": [
            "errno",
            "errorBuffer",
            "ERROR_BUFFER_LEN"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sendto",
          "args": [
            "ReplySock",
            "*(RqPacket + Index)",
            "strlen(*(RqPacket + Index))",
            "0",
            "DestAddr",
            "socklen"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "*(RqPacket + Index)"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "ReplySock",
            "IPPROTO_IPV6",
            "IPV6_MULTICAST_HOPS",
            "(char *)&hops",
            "sizeof(hops)"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "ReplySock",
            "IPPROTO_IPV6",
            "IPV6_MULTICAST_IF",
            "(char *)&gIF_INDEX",
            "sizeof(gIF_INDEX)"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntop",
          "args": [
            "AF_INET6",
            "&((struct sockaddr_in6 *)DestAddr)->sin6_addr",
            "buf_ntop",
            "sizeof(buf_ntop)"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "inet_ntop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/inet_pton.c",
          "lines": "291-305",
          "snippet": "const char *inet_ntop(int af, const void *src, char *dst,socklen_t size)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_ntop4(src, dst, size);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_ntop6(src, dst, size);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn NULL;\n\t}\n\t/* NOTREACHED */\n}",
          "includes": [
            "#include \"inet_pton.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inet_pton.h\"\n\nconst char *inet_ntop(int af, const void *src, char *dst,socklen_t size)\n{\n\tswitch (af) {\n\tcase AF_INET:\n\t\treturn inet_ntop4(src, dst, size);\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\treturn inet_ntop6(src, dst, size);\n#endif\n\tdefault:\n\t\t/*__set_errno(EAFNOSUPPORT);*/\n\t\treturn NULL;\n\t}\n\t/* NOTREACHED */\n}"
        }
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "ReplySock",
            "IPPROTO_IP",
            "IP_MULTICAST_TTL",
            "(char *)&ttl",
            "sizeof(int)"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "ReplySock",
            "IPPROTO_IP",
            "IP_MULTICAST_IF",
            "(char *)&replyAddr",
            "sizeof(replyAddr)"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror_r",
          "args": [
            "errno",
            "errorBuffer",
            "ERROR_BUFFER_LEN"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "(int)DestAddr->sa_family",
            "SOCK_DGRAM",
            "0"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "get_miniserver_sockets",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/miniserver/miniserver.c",
          "lines": "500-786",
          "snippet": "static int get_miniserver_sockets(\n\t/*! [in] Socket Array. */\n\tMiniServerSockArray *out,\n\t/*! [in] port on which the server is listening for incoming IPv4\n\t * connections. */\n\tuint16_t listen_port4\n#ifdef UPNP_ENABLE_IPV6\n\t,\n\t/*! [in] port on which the server is listening for incoming IPv6\n\t * connections. */\n\tuint16_t listen_port6\n#endif\n\t)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tstruct sockaddr_storage __ss_v4;\n\tstruct sockaddr_in* serverAddr4 = (struct sockaddr_in*)&__ss_v4;\n\tSOCKET listenfd4;\n\tuint16_t actual_port4 = 0u;\n#ifdef UPNP_ENABLE_IPV6\n\tstruct sockaddr_storage __ss_v6;\n\tstruct sockaddr_in6* serverAddr6 = (struct sockaddr_in6*)&__ss_v6;\n\tSOCKET listenfd6;\n\tuint16_t actual_port6 = 0u;\n#endif\n\tint ret_code;\n\tint reuseaddr_on = 0;\n\tint sockError = UPNP_E_SUCCESS;\n\tint errCode = 0;\n\n\t/* Create listen socket for IPv4/IPv6. An error here may indicate\n\t * that we don't have an IPv4/IPv6 stack. */\n\tlistenfd4 = socket(AF_INET, SOCK_STREAM, 0);\n\tif (listenfd4 == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: IPv4 socket not available: %s\\n\",\n\t\t\terrorBuffer);\n\t}\n#ifdef UPNP_ENABLE_IPV6\n\tlistenfd6 = socket(AF_INET6, SOCK_STREAM, 0);\n\tif (listenfd6 == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: IPv6 socket not available: %s\\n\",\n\t\t\terrorBuffer);\n\t} else {\n\t\tint onOff = 1;\n\t\tsockError = setsockopt(listenfd6, IPPROTO_IPV6, IPV6_V6ONLY,\n\t\t\t\t\t\t\t   (char *)&onOff, sizeof(onOff));\n\t\tif (sockError == SOCKET_ERROR) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\t\"get_miniserver_sockets: unable to set IPv6 socket protocol: %s\\n\",\n\t\t\t\terrorBuffer);\n\t\t\tsock_close(listenfd6);\n\t\t\tlistenfd6 = INVALID_SOCKET;\n\t\t}\n\t}\n#endif\n\tif (listenfd4 == INVALID_SOCKET\n#ifdef UPNP_ENABLE_IPV6\n\t    && listenfd6 == INVALID_SOCKET\n#endif\n\t) {\n\t\tUpnpPrintf(UPNP_CRITICAL, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: no protocols available\\n\");\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\t/* As per the IANA specifications for the use of ports by applications\n\t * override the listen port passed in with the first available. */\n\tif (listen_port4 < APPLICATION_LISTENING_PORT) {\n\t\tlisten_port4 = (uint16_t)APPLICATION_LISTENING_PORT;\n\t}\n#ifdef UPNP_ENABLE_IPV6\n\tif (listen_port6 < APPLICATION_LISTENING_PORT) {\n\t\tlisten_port6 = (uint16_t)APPLICATION_LISTENING_PORT;\n\t}\n#endif\n\tmemset(&__ss_v4, 0, sizeof (__ss_v4));\n\tserverAddr4->sin_family = (sa_family_t)AF_INET;\n\tinet_pton(AF_INET, gIF_IPV4, &serverAddr4->sin_addr);\n#ifdef UPNP_ENABLE_IPV6\n\tmemset(&__ss_v6, 0, sizeof (__ss_v6));\n\tserverAddr6->sin6_family = (sa_family_t)AF_INET6;\n\tinet_pton(AF_INET6, gIF_IPV6, &serverAddr6->sin6_addr);\n#endif\n\t/* Getting away with implementation of re-using address:port and\n\t * instead choosing to increment port numbers.\n\t * Keeping the re-use address code as an optional behaviour that\n\t * can be turned on if necessary.\n\t * TURN ON the reuseaddr_on option to use the option. */\n\tif (reuseaddr_on) {\n\t\t/* THIS IS ALLOWS US TO BIND AGAIN IMMEDIATELY\n\t\t * AFTER OUR SERVER HAS BEEN CLOSED\n\t\t * THIS MAY CAUSE TCP TO BECOME LESS RELIABLE\n\t\t * HOWEVER IT HAS BEEN SUGESTED FOR TCP SERVERS. */\n\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: resuseaddr is set.\\n\");\n\t\tif (listenfd4 != INVALID_SOCKET) {\n\t\t\tsockError = setsockopt(listenfd4, SOL_SOCKET,\n\t\t\t\tSO_REUSEADDR,\n\t\t\t\t(const char *)&reuseaddr_on, sizeof (int));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\t\tsock_close(listenfd6);\n#endif\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t\tserverAddr4->sin_port = htons(listen_port4);\n\t\t\tsockError = bind(listenfd4,\n\t\t\t\t(struct sockaddr *)&__ss_v4,\n\t\t\t\tsizeof (__ss_v4));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv4 bind(): %s\\n\", \n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\t\tsock_close(listenfd6);\n#endif\n\t\t\t\t/* Bind failed */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#ifdef UPNP_ENABLE_IPV6\n\t\tif (listenfd6 != INVALID_SOCKET) {\n\t\t\tsockError = setsockopt(listenfd6, SOL_SOCKET,\n\t\t\t\tSO_REUSEADDR,\n\t\t\t(const char *)&reuseaddr_on, sizeof (int));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tsock_close(listenfd4);\n\t\t\t\tsock_close(listenfd6);\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t\tserverAddr6->sin6_port = htons(listen_port6);\n\t\t\tsockError = bind(listenfd6,\n\t\t\t\t(struct sockaddr *)&__ss_v6,\n\t\t\t\tsizeof (__ss_v6));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv6 bind(): %s\\n\", \n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n\t\t\t\tsock_close(listenfd6);\n\t\t\t\t/* Bind failed */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#endif  /* IPv6 */\n\t} else {\n\t\tif (listenfd4 != INVALID_SOCKET) {\n\t\t\tuint16_t orig_listen_port4 = listen_port4;\n\t\t\tdo {\n\t\t\t\tserverAddr4->sin_port = htons(listen_port4++);\n\t\t\t\tsockError = bind(listenfd4,\n\t\t\t\t\t(struct sockaddr *)serverAddr4,\n\t\t\t\t\tsizeof(*serverAddr4));\n\t\t\t\tif (sockError == SOCKET_ERROR) {\n#ifdef WIN32\n\t\t\t\t\terrCode = WSAGetLastError();\n#else\n\t\t\t\t\terrCode = errno;\n#endif\n\t\t\t\t\tif (errno == EADDRINUSE) {\n\t\t\t\t\t\terrCode = 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terrCode = 0;\n\t\t\t\t}\n\t\t\t} while (errCode != 0 &&\n\t\t\t\t listen_port4 >= orig_listen_port4);\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv4 bind(): %s\\n\",\n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\t\tsock_close(listenfd6);\n#endif\n\t\t\t\t/* Bind failied. */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#ifdef UPNP_ENABLE_IPV6\n\t\tif (listenfd6 != INVALID_SOCKET) {\n\t\t\tuint16_t orig_listen_port6 = listen_port6;\n\t\t\tdo {\n\t\t\t\tserverAddr6->sin6_port = htons(listen_port6++);\n\t\t\t\tsockError = bind(listenfd6,\n\t\t\t\t\t(struct sockaddr *)serverAddr6,\n\t\t\t\t\tsizeof(*serverAddr6));\n\t\t\t\tif (sockError == SOCKET_ERROR) {\n#ifdef WIN32\n\t\t\t\t\terrCode = WSAGetLastError();\n#else\n\t\t\t\t\terrCode = errno; \n#endif\n\t\t\t\t\tif (errno == EADDRINUSE) {\n\t\t\t\t\t\terrCode = 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terrCode = 0;\n\t\t\t\t}\n\t\t\t} while (errCode != 0 &&\n\t\t\t\t listen_port6 >= orig_listen_port6);\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv6 bind(): %s\\n\",\n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n\t\t\t\tsock_close(listenfd6);\n\t\t\t\t/* Bind failied. */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#endif\n\t}\n\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\"get_miniserver_sockets: bind successful\\n\");\n\tif (listenfd4 != INVALID_SOCKET) {\n\t\tret_code = listen(listenfd4, SOMAXCONN);\n\t\tif (ret_code == SOCKET_ERROR) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\t\"mserv start: Error in IPv4 listen(): %s\\n\",\n\t\t\t\terrorBuffer);\n\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\tsock_close(listenfd6);\n#endif\n\t\t\treturn UPNP_E_LISTEN;\n\t\t}\n\t\tret_code = get_port(listenfd4, &actual_port4);\n\t\tif (ret_code < 0) {\n\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\tsock_close(listenfd6);\n#endif\n\t\t\treturn UPNP_E_INTERNAL_ERROR;\n\t\t}\n\t\tout->miniServerPort4 = actual_port4;\n\t}\n#ifdef UPNP_ENABLE_IPV6\n\tif (listenfd6 != INVALID_SOCKET) {\n\t\tret_code = listen(listenfd6, SOMAXCONN);\n\t\tif (ret_code == SOCKET_ERROR) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\t\"mserv start: Error in IPv6 listen(): %s\\n\",\n\t\t\t\terrorBuffer);\n\t\t\tsock_close(listenfd4);\n\t\t\tsock_close(listenfd6);\n\t\t\treturn UPNP_E_LISTEN;\n\t\t}\n\t\tret_code = get_port(listenfd6, &actual_port6);\n\t\tif (ret_code < 0) {\n\t\t\tsock_close(listenfd4);\n\t\t\tsock_close(listenfd6);\n\t\t\treturn UPNP_E_INTERNAL_ERROR;\n\t\t}\n\t\tout->miniServerPort6 = actual_port6;\n\t}\n#endif\n\tout->miniServerSock4 = listenfd4;\n#ifdef UPNP_ENABLE_IPV6\n\tout->miniServerSock6 = listenfd6;\n#endif\n\treturn UPNP_E_SUCCESS;\n}",
          "includes": [
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"upnputil.h\"",
            "#include \"upnpapi.h\"",
            "#include \"unixutil.h\" /* for socklen_t, EAFNOSUPPORT */",
            "#include \"ThreadPool.h\"",
            "#include \"statcodes.h\"",
            "#include \"ssdplib.h\"",
            "#include \"ithread.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"miniserver.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define APPLICATION_LISTENING_PORT 49152"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <errno.h>\n#include <assert.h>\n#include \"upnputil.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\" /* for socklen_t, EAFNOSUPPORT */\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"ithread.h\"\n#include \"httpreadwrite.h\"\n#include \"miniserver.h\"\n#include \"config.h\"\n\n#define APPLICATION_LISTENING_PORT 49152\n\nstatic int get_miniserver_sockets(\n\t/*! [in] Socket Array. */\n\tMiniServerSockArray *out,\n\t/*! [in] port on which the server is listening for incoming IPv4\n\t * connections. */\n\tuint16_t listen_port4\n#ifdef UPNP_ENABLE_IPV6\n\t,\n\t/*! [in] port on which the server is listening for incoming IPv6\n\t * connections. */\n\tuint16_t listen_port6\n#endif\n\t)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tstruct sockaddr_storage __ss_v4;\n\tstruct sockaddr_in* serverAddr4 = (struct sockaddr_in*)&__ss_v4;\n\tSOCKET listenfd4;\n\tuint16_t actual_port4 = 0u;\n#ifdef UPNP_ENABLE_IPV6\n\tstruct sockaddr_storage __ss_v6;\n\tstruct sockaddr_in6* serverAddr6 = (struct sockaddr_in6*)&__ss_v6;\n\tSOCKET listenfd6;\n\tuint16_t actual_port6 = 0u;\n#endif\n\tint ret_code;\n\tint reuseaddr_on = 0;\n\tint sockError = UPNP_E_SUCCESS;\n\tint errCode = 0;\n\n\t/* Create listen socket for IPv4/IPv6. An error here may indicate\n\t * that we don't have an IPv4/IPv6 stack. */\n\tlistenfd4 = socket(AF_INET, SOCK_STREAM, 0);\n\tif (listenfd4 == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: IPv4 socket not available: %s\\n\",\n\t\t\terrorBuffer);\n\t}\n#ifdef UPNP_ENABLE_IPV6\n\tlistenfd6 = socket(AF_INET6, SOCK_STREAM, 0);\n\tif (listenfd6 == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: IPv6 socket not available: %s\\n\",\n\t\t\terrorBuffer);\n\t} else {\n\t\tint onOff = 1;\n\t\tsockError = setsockopt(listenfd6, IPPROTO_IPV6, IPV6_V6ONLY,\n\t\t\t\t\t\t\t   (char *)&onOff, sizeof(onOff));\n\t\tif (sockError == SOCKET_ERROR) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\t\"get_miniserver_sockets: unable to set IPv6 socket protocol: %s\\n\",\n\t\t\t\terrorBuffer);\n\t\t\tsock_close(listenfd6);\n\t\t\tlistenfd6 = INVALID_SOCKET;\n\t\t}\n\t}\n#endif\n\tif (listenfd4 == INVALID_SOCKET\n#ifdef UPNP_ENABLE_IPV6\n\t    && listenfd6 == INVALID_SOCKET\n#endif\n\t) {\n\t\tUpnpPrintf(UPNP_CRITICAL, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: no protocols available\\n\");\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\t/* As per the IANA specifications for the use of ports by applications\n\t * override the listen port passed in with the first available. */\n\tif (listen_port4 < APPLICATION_LISTENING_PORT) {\n\t\tlisten_port4 = (uint16_t)APPLICATION_LISTENING_PORT;\n\t}\n#ifdef UPNP_ENABLE_IPV6\n\tif (listen_port6 < APPLICATION_LISTENING_PORT) {\n\t\tlisten_port6 = (uint16_t)APPLICATION_LISTENING_PORT;\n\t}\n#endif\n\tmemset(&__ss_v4, 0, sizeof (__ss_v4));\n\tserverAddr4->sin_family = (sa_family_t)AF_INET;\n\tinet_pton(AF_INET, gIF_IPV4, &serverAddr4->sin_addr);\n#ifdef UPNP_ENABLE_IPV6\n\tmemset(&__ss_v6, 0, sizeof (__ss_v6));\n\tserverAddr6->sin6_family = (sa_family_t)AF_INET6;\n\tinet_pton(AF_INET6, gIF_IPV6, &serverAddr6->sin6_addr);\n#endif\n\t/* Getting away with implementation of re-using address:port and\n\t * instead choosing to increment port numbers.\n\t * Keeping the re-use address code as an optional behaviour that\n\t * can be turned on if necessary.\n\t * TURN ON the reuseaddr_on option to use the option. */\n\tif (reuseaddr_on) {\n\t\t/* THIS IS ALLOWS US TO BIND AGAIN IMMEDIATELY\n\t\t * AFTER OUR SERVER HAS BEEN CLOSED\n\t\t * THIS MAY CAUSE TCP TO BECOME LESS RELIABLE\n\t\t * HOWEVER IT HAS BEEN SUGESTED FOR TCP SERVERS. */\n\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\"get_miniserver_sockets: resuseaddr is set.\\n\");\n\t\tif (listenfd4 != INVALID_SOCKET) {\n\t\t\tsockError = setsockopt(listenfd4, SOL_SOCKET,\n\t\t\t\tSO_REUSEADDR,\n\t\t\t\t(const char *)&reuseaddr_on, sizeof (int));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\t\tsock_close(listenfd6);\n#endif\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t\tserverAddr4->sin_port = htons(listen_port4);\n\t\t\tsockError = bind(listenfd4,\n\t\t\t\t(struct sockaddr *)&__ss_v4,\n\t\t\t\tsizeof (__ss_v4));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv4 bind(): %s\\n\", \n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\t\tsock_close(listenfd6);\n#endif\n\t\t\t\t/* Bind failed */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#ifdef UPNP_ENABLE_IPV6\n\t\tif (listenfd6 != INVALID_SOCKET) {\n\t\t\tsockError = setsockopt(listenfd6, SOL_SOCKET,\n\t\t\t\tSO_REUSEADDR,\n\t\t\t(const char *)&reuseaddr_on, sizeof (int));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tsock_close(listenfd4);\n\t\t\t\tsock_close(listenfd6);\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t\tserverAddr6->sin6_port = htons(listen_port6);\n\t\t\tsockError = bind(listenfd6,\n\t\t\t\t(struct sockaddr *)&__ss_v6,\n\t\t\t\tsizeof (__ss_v6));\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv6 bind(): %s\\n\", \n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n\t\t\t\tsock_close(listenfd6);\n\t\t\t\t/* Bind failed */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#endif  /* IPv6 */\n\t} else {\n\t\tif (listenfd4 != INVALID_SOCKET) {\n\t\t\tuint16_t orig_listen_port4 = listen_port4;\n\t\t\tdo {\n\t\t\t\tserverAddr4->sin_port = htons(listen_port4++);\n\t\t\t\tsockError = bind(listenfd4,\n\t\t\t\t\t(struct sockaddr *)serverAddr4,\n\t\t\t\t\tsizeof(*serverAddr4));\n\t\t\t\tif (sockError == SOCKET_ERROR) {\n#ifdef WIN32\n\t\t\t\t\terrCode = WSAGetLastError();\n#else\n\t\t\t\t\terrCode = errno;\n#endif\n\t\t\t\t\tif (errno == EADDRINUSE) {\n\t\t\t\t\t\terrCode = 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terrCode = 0;\n\t\t\t\t}\n\t\t\t} while (errCode != 0 &&\n\t\t\t\t listen_port4 >= orig_listen_port4);\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv4 bind(): %s\\n\",\n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\t\tsock_close(listenfd6);\n#endif\n\t\t\t\t/* Bind failied. */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#ifdef UPNP_ENABLE_IPV6\n\t\tif (listenfd6 != INVALID_SOCKET) {\n\t\t\tuint16_t orig_listen_port6 = listen_port6;\n\t\t\tdo {\n\t\t\t\tserverAddr6->sin6_port = htons(listen_port6++);\n\t\t\t\tsockError = bind(listenfd6,\n\t\t\t\t\t(struct sockaddr *)serverAddr6,\n\t\t\t\t\tsizeof(*serverAddr6));\n\t\t\t\tif (sockError == SOCKET_ERROR) {\n#ifdef WIN32\n\t\t\t\t\terrCode = WSAGetLastError();\n#else\n\t\t\t\t\terrCode = errno; \n#endif\n\t\t\t\t\tif (errno == EADDRINUSE) {\n\t\t\t\t\t\terrCode = 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terrCode = 0;\n\t\t\t\t}\n\t\t\t} while (errCode != 0 &&\n\t\t\t\t listen_port6 >= orig_listen_port6);\n\t\t\tif (sockError == SOCKET_ERROR) {\n\t\t\t\tstrerror_r(errno, errorBuffer,\n\t\t\t\t\tERROR_BUFFER_LEN);\n\t\t\t\tUpnpPrintf(UPNP_INFO, MSERV,\n\t\t\t\t\t__FILE__, __LINE__,\n\t\t\t\t\t\"get_miniserver_sockets: \"\n\t\t\t\t\t\"Error in IPv6 bind(): %s\\n\",\n\t\t\t\t\terrorBuffer);\n\t\t\t\tsock_close(listenfd4);\n\t\t\t\tsock_close(listenfd6);\n\t\t\t\t/* Bind failied. */\n\t\t\t\treturn UPNP_E_SOCKET_BIND;\n\t\t\t}\n\t\t}\n#endif\n\t}\n\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\"get_miniserver_sockets: bind successful\\n\");\n\tif (listenfd4 != INVALID_SOCKET) {\n\t\tret_code = listen(listenfd4, SOMAXCONN);\n\t\tif (ret_code == SOCKET_ERROR) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\t\"mserv start: Error in IPv4 listen(): %s\\n\",\n\t\t\t\terrorBuffer);\n\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\tsock_close(listenfd6);\n#endif\n\t\t\treturn UPNP_E_LISTEN;\n\t\t}\n\t\tret_code = get_port(listenfd4, &actual_port4);\n\t\tif (ret_code < 0) {\n\t\t\tsock_close(listenfd4);\n#ifdef UPNP_ENABLE_IPV6\n\t\t\tsock_close(listenfd6);\n#endif\n\t\t\treturn UPNP_E_INTERNAL_ERROR;\n\t\t}\n\t\tout->miniServerPort4 = actual_port4;\n\t}\n#ifdef UPNP_ENABLE_IPV6\n\tif (listenfd6 != INVALID_SOCKET) {\n\t\tret_code = listen(listenfd6, SOMAXCONN);\n\t\tif (ret_code == SOCKET_ERROR) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, MSERV, __FILE__, __LINE__,\n\t\t\t\t\"mserv start: Error in IPv6 listen(): %s\\n\",\n\t\t\t\terrorBuffer);\n\t\t\tsock_close(listenfd4);\n\t\t\tsock_close(listenfd6);\n\t\t\treturn UPNP_E_LISTEN;\n\t\t}\n\t\tret_code = get_port(listenfd6, &actual_port6);\n\t\tif (ret_code < 0) {\n\t\t\tsock_close(listenfd4);\n\t\t\tsock_close(listenfd6);\n\t\t\treturn UPNP_E_INTERNAL_ERROR;\n\t\t}\n\t\tout->miniServerPort6 = actual_port6;\n\t}\n#endif\n\tout->miniServerSock4 = listenfd4;\n#ifdef UPNP_ENABLE_IPV6\n\tout->miniServerSock6 = listenfd6;\n#endif\n\treturn UPNP_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "inet_addr",
          "args": [
            "gIF_IPV4"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nstatic int NewRequestHandler(\n\t/*! [in] Ip address, to send the reply. */\n\tstruct sockaddr *DestAddr,\n\t/*! [in] Number of packet to be sent. */\n\tint NumPacket,\n\t/*! [in] . */\n\tchar **RqPacket)\n{\n\tchar errorBuffer[ERROR_BUFFER_LEN];\n\tSOCKET ReplySock;\n\tsocklen_t socklen = sizeof(struct sockaddr_storage);\n\tint Index;\n\tunsigned long replyAddr = inet_addr(gIF_IPV4);\n\t/* a/c to UPNP Spec */\n\tint ttl = 4;\n#ifdef INET_IPV6\n\tint hops = 1;\n#endif\n\tchar buf_ntop[INET6_ADDRSTRLEN];\n\tint ret = UPNP_E_SUCCESS;\n\n\tReplySock = socket((int)DestAddr->sa_family, SOCK_DGRAM, 0);\n\tif (ReplySock == INVALID_SOCKET) {\n\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\n\t\treturn UPNP_E_OUTOF_SOCKET;\n\t}\n\n\tswitch (DestAddr->sa_family) {\n\tcase AF_INET:\n\t\tinet_ntop(AF_INET, &((struct sockaddr_in *)DestAddr)->sin_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_IF,\n\t\t\t   (char *)&replyAddr, sizeof(replyAddr));\n\t\tsetsockopt(ReplySock, IPPROTO_IP, IP_MULTICAST_TTL,\n\t\t\t   (char *)&ttl, sizeof(int));\n\t\tsocklen = sizeof(struct sockaddr_in);\n\t\tbreak;\n#ifdef INET_IPV6\n\tcase AF_INET6:\n\t\tinet_ntop(AF_INET6,\n\t\t\t  &((struct sockaddr_in6 *)DestAddr)->sin6_addr,\n\t\t\t  buf_ntop, sizeof(buf_ntop));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_IF,\n\t\t\t   (char *)&gIF_INDEX, sizeof(gIF_INDEX));\n\t\tsetsockopt(ReplySock, IPPROTO_IPV6, IPV6_MULTICAST_HOPS,\n\t\t\t   (char *)&hops, sizeof(hops));\n\t\tbreak;\n#endif\n\tdefault:\n\t\tUpnpPrintf(UPNP_CRITICAL, SSDP, __FILE__, __LINE__,\n\t\t\t   \"Invalid destination address specified.\");\n\t\tret = UPNP_E_NETWORK_ERROR;\n\t\tgoto end_NewRequestHandler;\n\t}\n\n\tfor (Index = 0; Index < NumPacket; Index++) {\n\t\tssize_t rc;\n\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t   \">>> SSDP SEND to %s >>>\\n%s\\n\",\n\t\t\t   buf_ntop, *(RqPacket + Index));\n\t\trc = sendto(ReplySock, *(RqPacket + Index),\n\t\t\t    strlen(*(RqPacket + Index)), 0, DestAddr, socklen);\n\t\tif (rc == -1) {\n\t\t\tstrerror_r(errno, errorBuffer, ERROR_BUFFER_LEN);\n\t\t\tUpnpPrintf(UPNP_INFO, SSDP, __FILE__, __LINE__,\n\t\t\t\t   \"SSDP_LIB: New Request Handler:\"\n\t\t\t\t   \"Error in socket(): %s\\n\", errorBuffer);\n\t\t\tret = UPNP_E_SOCKET_WRITE;\n\t\t\tgoto end_NewRequestHandler;\n\t\t}\n\t}\n\n end_NewRequestHandler:\n\tUpnpCloseSocket(ReplySock);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "ssdp_handle_device_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "82-165",
    "snippet": "void ssdp_handle_device_request(http_message_t *hmsg, struct sockaddr_storage *dest_addr)\n{\n#define MX_FUDGE_FACTOR 10\n\tint handle;\n\tstruct Handle_Info *dev_info = NULL;\n\tmemptr hdr_value;\n\tint mx;\n\tchar save_char;\n\tSsdpEvent event;\n\tint ret_code;\n\tSsdpSearchReply *threadArg = NULL;\n\tThreadPoolJob job;\n\tint replyTime;\n\tint maxAge;\n\n\tmemset(&job, 0, sizeof(job));\n\n\t/* check man hdr. */\n\tif (httpmsg_find_hdr(hmsg, HDR_MAN, &hdr_value) == NULL ||\n\t    memptr_cmp(&hdr_value, \"\\\"ssdp:discover\\\"\") != 0)\n\t\t/* bad or missing hdr. */\n\t\treturn;\n\t/* MX header. */\n\tif (httpmsg_find_hdr(hmsg, HDR_MX, &hdr_value) == NULL ||\n\t    (mx = raw_to_int(&hdr_value, 10)) < 0)\n\t\treturn;\n\t/* ST header. */\n\tif (httpmsg_find_hdr(hmsg, HDR_ST, &hdr_value) == NULL)\n\t\treturn;\n\tsave_char = hdr_value.buf[hdr_value.length];\n\thdr_value.buf[hdr_value.length] = '\\0';\n\tret_code = ssdp_request_type(hdr_value.buf, &event);\n\t/* restore. */\n\thdr_value.buf[hdr_value.length] = save_char;\n\tif (ret_code == -1)\n\t\t/* bad ST header. */\n\t\treturn;\n\n\tHandleLock();\n\t/* device info. */\n\tswitch (GetDeviceHandleInfo((int)dest_addr->ss_family,\n\t\t\t\t&handle, &dev_info)) {\n\tcase HND_DEVICE:\n\t\tbreak;\n\tdefault:\n\t\tHandleUnlock();\n\t\t/* no info found. */\n\t\treturn;\n\t}\n\tmaxAge = dev_info->MaxAge;\n\tHandleUnlock();\n\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"MAX-AGE     =  %d\\n\", maxAge);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"MX     =  %d\\n\", event.Mx);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"DeviceType   =  %s\\n\", event.DeviceType);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"DeviceUuid   =  %s\\n\", event.UDN);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"ServiceType =  %s\\n\", event.ServiceType);\n\tthreadArg = (SsdpSearchReply *)malloc(sizeof(SsdpSearchReply));\n\tif (threadArg == NULL)\n\t\treturn;\n\tthreadArg->handle = handle;\n\tmemcpy(&threadArg->dest_addr, dest_addr, sizeof(threadArg->dest_addr));\n\tthreadArg->event = event;\n\tthreadArg->MaxAge = maxAge;\n\n\tTPJobInit(&job, advertiseAndReplyThread, threadArg);\n\tTPJobSetFreeFunction(&job, (free_routine) free);\n\n\t/* Subtract a percentage from the mx to allow for network and processing\n\t * delays (i.e. if search is for 30 seconds, respond\n\t * within 0 - 27 seconds). */\n\tif (mx >= 2)\n\t\tmx -= MAXVAL(1, mx / MX_FUDGE_FACTOR);\n\tif (mx < 1)\n\t\tmx = 1;\n\treplyTime = rand() % mx;\n\tTimerThreadSchedule(&gTimerThread, replyTime, REL_SEC, &job,\n\t\t\t    SHORT_TERM, NULL);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [
      "#define MX_FUDGE_FACTOR 10"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "TimerThreadSchedule",
          "args": [
            "&gTimerThread",
            "replyTime",
            "REL_SEC",
            "&job",
            "SHORT_TERM",
            "NULL"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rand",
          "args": [],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "true_random",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/uuid.c",
          "lines": "205-219",
          "snippet": "static uint16_t true_random(void)\n{\n\tstatic int inited = 0;\n\tuuid_time_t time_now;\n\n\tif (!inited) {\n\t\tget_system_time(&time_now);\n\t\ttime_now = time_now / UUIDS_PER_TICK;\n\t\tsrand((unsigned int)(((time_now >> 32) ^ time_now) &\n\t\t\t\t     0xffffffff));\n\t\tinited = 1;\n\t};\n\n\treturn (uint16_t) (rand());\n}",
          "includes": [
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <string.h>",
            "#include \"UpnpStdInt.h\"",
            "#include \"UpnpInet.h\"",
            "#include \"uuid.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static uint16_t true_random(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <string.h>\n#include \"UpnpStdInt.h\"\n#include \"UpnpInet.h\"\n#include \"uuid.h\"\n#include \"config.h\"\n\nstatic uint16_t true_random(void);\n\nstatic uint16_t true_random(void)\n{\n\tstatic int inited = 0;\n\tuuid_time_t time_now;\n\n\tif (!inited) {\n\t\tget_system_time(&time_now);\n\t\ttime_now = time_now / UUIDS_PER_TICK;\n\t\tsrand((unsigned int)(((time_now >> 32) ^ time_now) &\n\t\t\t\t     0xffffffff));\n\t\tinited = 1;\n\t};\n\n\treturn (uint16_t) (rand());\n}"
        }
      },
      {
        "call_info": {
          "callee": "MAXVAL",
          "args": [
            "1",
            "mx / MX_FUDGE_FACTOR"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TPJobSetFreeFunction",
          "args": [
            "&job",
            "(free_routine) free"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TPJobInit",
          "args": [
            "&job",
            "advertiseAndReplyThread",
            "threadArg"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&threadArg->dest_addr",
            "dest_addr",
            "sizeof(threadArg->dest_addr)"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "333-340",
          "snippet": "static void\nMD5_memcpy(POINTER  output, POINTER  input, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\toutput[i] = input[i];\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memcpy"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memcpy;\n\nstatic void\nMD5_memcpy(POINTER  output, POINTER  input, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\toutput[i] = input[i];\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(SsdpSearchReply)"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UpnpPrintf",
          "args": [
            "UPNP_PACKET",
            "API",
            "__FILE__",
            "__LINE__",
            "\"ServiceType =  %s\\n\"",
            "event.ServiceType"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "UpnpPrintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpdebug.c",
          "lines": "124-154",
          "snippet": "void UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include \"upnpdebug.h\"",
            "#include \"upnp.h\"",
            "#include \"ixml.h\"",
            "#include \"ithread.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include \"upnpdebug.h\"\n#include \"upnp.h\"\n#include \"ixml.h\"\n#include \"ithread.h\"\n#include \"config.h\"\n\nvoid UpnpPrintf(Upnp_LogLevel DLevel,\n\t\tDbg_Module Module,\n\t\tconst char *DbgFileName, int DbgLineNo, const char *FmtStr, ...)\n{\n\tva_list ArgList;\n\n\tif (!DebugAtThisLevel(DLevel, Module))\n\t\treturn;\n\tithread_mutex_lock(&GlobalDebugMutex);\n\tva_start(ArgList, FmtStr);\n\tif (!DEBUG_TARGET) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(stdout, DbgFileName, DbgLineNo);\n\t\tvfprintf(stdout, FmtStr, ArgList);\n\t\tfflush(stdout);\n\t} else if (DLevel == 0) {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(ErrFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(ErrFileHnd, FmtStr, ArgList);\n\t\tfflush(ErrFileHnd);\n\t} else {\n\t\tif (DbgFileName)\n\t\t\tUpnpDisplayFileAndLine(InfoFileHnd, DbgFileName,\n\t\t\t\t\t       DbgLineNo);\n\t\tvfprintf(InfoFileHnd, FmtStr, ArgList);\n\t\tfflush(InfoFileHnd);\n\t}\n\tva_end(ArgList);\n\tithread_mutex_unlock(&GlobalDebugMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "HandleUnlock",
          "args": [],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HandleUnlock",
          "args": [],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDeviceHandleInfo",
          "args": [
            "(int)dest_addr->ss_family",
            "&handle",
            "&dev_info"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "GetDeviceHandleInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/api/upnpapi.c",
          "lines": "3849-3878",
          "snippet": "Upnp_Handle_Type GetDeviceHandleInfo(\n\tint AddressFamily,\n\tUpnpDevice_Handle *device_handle_out,\n\tstruct Handle_Info **HndInfo)\n{\n#ifdef INCLUDE_DEVICE_APIS\n\t/* Check if we've got a registered device of the address family specified. */\n\tif ((AddressFamily == AF_INET  && UpnpSdkDeviceRegisteredV4 == 0) ||\n\t    (AddressFamily == AF_INET6 && UpnpSdkDeviceregisteredV6 == 0)) {\n\t\t*device_handle_out = -1;\n\t\treturn HND_INVALID;\n\t}\n\n\t/* Find it. */\n\tfor (*device_handle_out=1; *device_handle_out < NUM_HANDLE; (*device_handle_out)++) {\n\t\tswitch (GetHandleInfo(*device_handle_out, HndInfo)) {\n\t\tcase HND_DEVICE:\n\t\t\tif ((*HndInfo)->DeviceAf == AddressFamily) {\n\t\t\t\treturn HND_DEVICE;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n#endif /* INCLUDE_DEVICE_APIS */\n\n\t*device_handle_out = -1;\n\treturn HND_INVALID;\n}",
          "includes": [
            "#include <openssl/ssl.h>",
            "#include <sys/types.h>",
            "#include <sys/param.h>",
            "#include <sys/ioctl.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <assert.h>",
            "#include <sys/stat.h>",
            "#include \"webserver.h\"",
            "#include \"VirtualDir.h\"",
            "#include \"urlconfig.h\"",
            "#include \"service_table.h\"",
            "#include \"miniserver.h\"",
            "#include \"gena.h\"",
            "#include \"uuid.h\"",
            "#include \"UpnpUniStd.h\" /* for close() */",
            "#include \"UpnpStdInt.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sysdep.h\"",
            "#include \"soaplib.h\"",
            "#include \"ssdplib.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"upnpapi.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [
            "#define NUM_HANDLE 200"
          ],
          "globals_used": [
            "int UpnpSdkDeviceRegisteredV4 = 0;",
            "int UpnpSdkDeviceregisteredV6 = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ssl.h>\n#include <sys/types.h>\n#include <sys/param.h>\n#include <sys/ioctl.h>\n#include <string.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <assert.h>\n#include <sys/stat.h>\n#include \"webserver.h\"\n#include \"VirtualDir.h\"\n#include \"urlconfig.h\"\n#include \"service_table.h\"\n#include \"miniserver.h\"\n#include \"gena.h\"\n#include \"uuid.h\"\n#include \"UpnpUniStd.h\" /* for close() */\n#include \"UpnpStdInt.h\"\n#include \"ThreadPool.h\"\n#include \"sysdep.h\"\n#include \"soaplib.h\"\n#include \"ssdplib.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"upnpapi.h\"\n#include \"config.h\"\n\n#define NUM_HANDLE 200\n\nint UpnpSdkDeviceRegisteredV4 = 0;\nint UpnpSdkDeviceregisteredV6 = 0;\n\nUpnp_Handle_Type GetDeviceHandleInfo(\n\tint AddressFamily,\n\tUpnpDevice_Handle *device_handle_out,\n\tstruct Handle_Info **HndInfo)\n{\n#ifdef INCLUDE_DEVICE_APIS\n\t/* Check if we've got a registered device of the address family specified. */\n\tif ((AddressFamily == AF_INET  && UpnpSdkDeviceRegisteredV4 == 0) ||\n\t    (AddressFamily == AF_INET6 && UpnpSdkDeviceregisteredV6 == 0)) {\n\t\t*device_handle_out = -1;\n\t\treturn HND_INVALID;\n\t}\n\n\t/* Find it. */\n\tfor (*device_handle_out=1; *device_handle_out < NUM_HANDLE; (*device_handle_out)++) {\n\t\tswitch (GetHandleInfo(*device_handle_out, HndInfo)) {\n\t\tcase HND_DEVICE:\n\t\t\tif ((*HndInfo)->DeviceAf == AddressFamily) {\n\t\t\t\treturn HND_DEVICE;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n#endif /* INCLUDE_DEVICE_APIS */\n\n\t*device_handle_out = -1;\n\treturn HND_INVALID;\n}"
        }
      },
      {
        "call_info": {
          "callee": "HandleLock",
          "args": [],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssdp_request_type",
          "args": [
            "hdr_value.buf",
            "&event"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "ssdp_request_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "549-560",
          "snippet": "int ssdp_request_type(char *cmd, SsdpEvent *Evt)\n{\n\t/* clear event */\n\tmemset(Evt, 0, sizeof(SsdpEvent));\n\tunique_service_name(cmd, Evt);\n\tEvt->ErrCode = NO_ERROR_FOUND;\n\tif ((Evt->RequestType = ssdp_request_type1(cmd)) == SSDP_SERROR) {\n\t\tEvt->ErrCode = E_HTTP_SYNTEX;\n\t\treturn -1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nint ssdp_request_type(char *cmd, SsdpEvent *Evt)\n{\n\t/* clear event */\n\tmemset(Evt, 0, sizeof(SsdpEvent));\n\tunique_service_name(cmd, Evt);\n\tEvt->ErrCode = NO_ERROR_FOUND;\n\tif ((Evt->RequestType = ssdp_request_type1(cmd)) == SSDP_SERROR) {\n\t\tEvt->ErrCode = E_HTTP_SYNTEX;\n\t\treturn -1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "httpmsg_find_hdr",
          "args": [
            "hmsg",
            "HDR_ST",
            "&hdr_value"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "httpmsg_find_hdr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/net/http/httpparser.c",
          "lines": "489-510",
          "snippet": "http_header_t *httpmsg_find_hdr(\n\tIN http_message_t *msg,\n\tIN int header_name_id,\n\tOUT memptr *value)\n{\n    http_header_t header;       /* temp header for searching */\n    ListNode *node;\n    http_header_t *data;\n\n    header.name_id = header_name_id;\n    node = ListFind( &msg->headers, NULL, &header );\n    if( node == NULL ) {\n        return NULL;\n    }\n    data = ( http_header_t * ) node->item;\n    if( value != NULL ) {\n        value->buf = data->value.buf;\n        value->length = data->value.length;\n    }\n\n    return data;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#include \"upnpdebug.h\"",
            "#include \"unixutil.h\"",
            "#include \"statcodes.h\"",
            "#include \"httpparser.h\"",
            "#include \"strintmap.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <ctype.h>\n#include <assert.h>\n#include \"upnpdebug.h\"\n#include \"unixutil.h\"\n#include \"statcodes.h\"\n#include \"httpparser.h\"\n#include \"strintmap.h\"\n#include \"config.h\"\n\nhttp_header_t *httpmsg_find_hdr(\n\tIN http_message_t *msg,\n\tIN int header_name_id,\n\tOUT memptr *value)\n{\n    http_header_t header;       /* temp header for searching */\n    ListNode *node;\n    http_header_t *data;\n\n    header.name_id = header_name_id;\n    node = ListFind( &msg->headers, NULL, &header );\n    if( node == NULL ) {\n        return NULL;\n    }\n    data = ( http_header_t * ) node->item;\n    if( value != NULL ) {\n        value->buf = data->value.buf;\n        value->length = data->value.length;\n    }\n\n    return data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "raw_to_int",
          "args": [
            "&hdr_value",
            "10"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "raw_to_int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/net/http/httpparser.c",
          "lines": "2107-2125",
          "snippet": "int raw_to_int(IN memptr *raw_value, IN int base)\n{\n\tlong num;\n\tchar *end_ptr;\n\n\tif (raw_value->length == (size_t)0)\n\t\treturn -1;\n\terrno = 0;\n\tnum = strtol(raw_value->buf, &end_ptr, base);\n\tif ((num < 0)\n\t    /* all and only those chars in token should be used for num */\n\t    || (end_ptr != raw_value->buf + raw_value->length)\n\t    || ((num == LONG_MIN || num == LONG_MAX)\n\t\t&& (errno == ERANGE))\n\t    ) {\n\t\treturn -1;\n\t}\n\treturn (int)num;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <limits.h>",
            "#include <ctype.h>",
            "#include <assert.h>",
            "#include \"upnpdebug.h\"",
            "#include \"unixutil.h\"",
            "#include \"statcodes.h\"",
            "#include \"httpparser.h\"",
            "#include \"strintmap.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <limits.h>\n#include <ctype.h>\n#include <assert.h>\n#include \"upnpdebug.h\"\n#include \"unixutil.h\"\n#include \"statcodes.h\"\n#include \"httpparser.h\"\n#include \"strintmap.h\"\n#include \"config.h\"\n\nint raw_to_int(IN memptr *raw_value, IN int base)\n{\n\tlong num;\n\tchar *end_ptr;\n\n\tif (raw_value->length == (size_t)0)\n\t\treturn -1;\n\terrno = 0;\n\tnum = strtol(raw_value->buf, &end_ptr, base);\n\tif ((num < 0)\n\t    /* all and only those chars in token should be used for num */\n\t    || (end_ptr != raw_value->buf + raw_value->length)\n\t    || ((num == LONG_MIN || num == LONG_MAX)\n\t\t&& (errno == ERANGE))\n\t    ) {\n\t\treturn -1;\n\t}\n\treturn (int)num;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memptr_cmp",
          "args": [
            "&hdr_value",
            "\"\\\"ssdp:discover\\\"\""
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "memptr_cmp_nocase",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/genlib/util/membuffer.c",
          "lines": "78-90",
          "snippet": "int memptr_cmp_nocase(memptr * m, const char *s)\n{\n\tint cmp;\n\n\tcmp = strncasecmp(m->buf, s, m->length);\n\tif (cmp == 0 && m->length < strlen(s)) {\n\t\t/* both strings equal for 'm->length' chars */\n\t\t/*  if m is shorter than s, then s is greater */\n\t\treturn -1;\n\t}\n\n\treturn cmp;\n}",
          "includes": [
            "#include \"unixutil.h\"",
            "#include \"upnp.h\"",
            "#include \"membuffer.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <assert.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"unixutil.h\"\n#include \"upnp.h\"\n#include \"membuffer.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <assert.h>\n#include \"config.h\"\n\nint memptr_cmp_nocase(memptr * m, const char *s)\n{\n\tint cmp;\n\n\tcmp = strncasecmp(m->buf, s, m->length);\n\tif (cmp == 0 && m->length < strlen(s)) {\n\t\t/* both strings equal for 'm->length' chars */\n\t\t/*  if m is shorter than s, then s is greater */\n\t\treturn -1;\n\t}\n\n\treturn cmp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&job",
            "0",
            "sizeof(job)"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "MD5_memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/uuid/md5.c",
          "lines": "345-352",
          "snippet": "static void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}",
          "includes": [
            "#include \"md5.h\"",
            "#include \"global.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void MD5_memset"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"md5.h\"\n#include \"global.h\"\n#include \"config.h\"\n\nstatic void MD5_memset;\n\nstatic void\nMD5_memset(POINTER output, int value, unsigned int len)\n{\n\tunsigned int i;\n\tfor (i = 0; i < len; ++i) {\n\t\t((char *)output)[i] = (char)value;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\n#define MX_FUDGE_FACTOR 10\n\nvoid ssdp_handle_device_request(http_message_t *hmsg, struct sockaddr_storage *dest_addr)\n{\n#define MX_FUDGE_FACTOR 10\n\tint handle;\n\tstruct Handle_Info *dev_info = NULL;\n\tmemptr hdr_value;\n\tint mx;\n\tchar save_char;\n\tSsdpEvent event;\n\tint ret_code;\n\tSsdpSearchReply *threadArg = NULL;\n\tThreadPoolJob job;\n\tint replyTime;\n\tint maxAge;\n\n\tmemset(&job, 0, sizeof(job));\n\n\t/* check man hdr. */\n\tif (httpmsg_find_hdr(hmsg, HDR_MAN, &hdr_value) == NULL ||\n\t    memptr_cmp(&hdr_value, \"\\\"ssdp:discover\\\"\") != 0)\n\t\t/* bad or missing hdr. */\n\t\treturn;\n\t/* MX header. */\n\tif (httpmsg_find_hdr(hmsg, HDR_MX, &hdr_value) == NULL ||\n\t    (mx = raw_to_int(&hdr_value, 10)) < 0)\n\t\treturn;\n\t/* ST header. */\n\tif (httpmsg_find_hdr(hmsg, HDR_ST, &hdr_value) == NULL)\n\t\treturn;\n\tsave_char = hdr_value.buf[hdr_value.length];\n\thdr_value.buf[hdr_value.length] = '\\0';\n\tret_code = ssdp_request_type(hdr_value.buf, &event);\n\t/* restore. */\n\thdr_value.buf[hdr_value.length] = save_char;\n\tif (ret_code == -1)\n\t\t/* bad ST header. */\n\t\treturn;\n\n\tHandleLock();\n\t/* device info. */\n\tswitch (GetDeviceHandleInfo((int)dest_addr->ss_family,\n\t\t\t\t&handle, &dev_info)) {\n\tcase HND_DEVICE:\n\t\tbreak;\n\tdefault:\n\t\tHandleUnlock();\n\t\t/* no info found. */\n\t\treturn;\n\t}\n\tmaxAge = dev_info->MaxAge;\n\tHandleUnlock();\n\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"MAX-AGE     =  %d\\n\", maxAge);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"MX     =  %d\\n\", event.Mx);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"DeviceType   =  %s\\n\", event.DeviceType);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"DeviceUuid   =  %s\\n\", event.UDN);\n\tUpnpPrintf(UPNP_PACKET, API, __FILE__, __LINE__,\n\t\t   \"ServiceType =  %s\\n\", event.ServiceType);\n\tthreadArg = (SsdpSearchReply *)malloc(sizeof(SsdpSearchReply));\n\tif (threadArg == NULL)\n\t\treturn;\n\tthreadArg->handle = handle;\n\tmemcpy(&threadArg->dest_addr, dest_addr, sizeof(threadArg->dest_addr));\n\tthreadArg->event = event;\n\tthreadArg->MaxAge = maxAge;\n\n\tTPJobInit(&job, advertiseAndReplyThread, threadArg);\n\tTPJobSetFreeFunction(&job, (free_routine) free);\n\n\t/* Subtract a percentage from the mx to allow for network and processing\n\t * delays (i.e. if search is for 30 seconds, respond\n\t * within 0 - 27 seconds). */\n\tif (mx >= 2)\n\t\tmx -= MAXVAL(1, mx / MX_FUDGE_FACTOR);\n\tif (mx < 1)\n\t\tmx = 1;\n\treplyTime = rand() % mx;\n\tTimerThreadSchedule(&gTimerThread, replyTime, REL_SEC, &job,\n\t\t\t    SHORT_TERM, NULL);\n}"
  },
  {
    "function_name": "advertiseAndReplyThread",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_device.c",
    "lines": "67-79",
    "snippet": "void *advertiseAndReplyThread(void *data)\n{\n\tSsdpSearchReply *arg = (SsdpSearchReply *) data;\n\n\tAdvertiseAndReply(0, arg->handle,\n\t\t\t  arg->event.RequestType,\n\t\t\t  (struct sockaddr *)&arg->dest_addr,\n\t\t\t  arg->event.DeviceType,\n\t\t\t  arg->event.UDN, arg->event.ServiceType, arg->MaxAge);\n\tfree(arg);\n\n\treturn NULL;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <assert.h>",
      "#include \"UpnpInet.h\"",
      "#include \"upnpapi.h\"",
      "#include \"unixutil.h\"",
      "#include \"ThreadPool.h\"",
      "#include \"statcodes.h\"",
      "#include \"ssdplib.h\"",
      "#include \"httpreadwrite.h\"",
      "#include \"httpparser.h\"",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "arg"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "free_ssdp_event_handler_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "565-578",
          "snippet": "static void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nstatic void free_ssdp_event_handler_data(\n\t/*! [in] ssdp_thread_data structure. This structure contains SSDP\n\t * request message. */\n\tvoid *the_data)\n{\n\tssdp_thread_data *data = (ssdp_thread_data *) the_data;\n\n\tif (data != NULL) {\n\t\thttp_message_t *hmsg = &data->parser.msg;\n\t\t/* free data */\n\t\thttpmsg_destroy(hmsg);\n\t\tfree(data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AdvertiseAndReply",
          "args": [
            "0",
            "arg->handle",
            "arg->event.RequestType",
            "(struct sockaddr *)&arg->dest_addr",
            "arg->event.DeviceType",
            "arg->event.UDN",
            "arg->event.ServiceType",
            "arg->MaxAge"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "AdvertiseAndReply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-6255/repo/upnp/src/ssdp/ssdp_server.c",
          "lines": "92-445",
          "snippet": "int AdvertiseAndReply(int AdFlag, UpnpDevice_Handle Hnd,\n\t\t      enum SsdpSearchType SearchType,\n\t\t      struct sockaddr *DestAddr, char *DeviceType,\n\t\t      char *DeviceUDN, char *ServiceType, int Exp)\n{\n\tint retVal = UPNP_E_SUCCESS;\n\tlong unsigned int i;\n\tlong unsigned int j;\n\tint defaultExp = DEFAULT_MAXAGE;\n\tstruct Handle_Info *SInfo = NULL;\n\tchar UDNstr[100];\n\tchar devType[100];\n\tchar servType[100];\n\tIXML_NodeList *nodeList = NULL;\n\tIXML_NodeList *tmpNodeList = NULL;\n\tIXML_Node *tmpNode = NULL;\n\tIXML_Node *tmpNode2 = NULL;\n\tIXML_Node *textNode = NULL;\n\tconst DOMString tmpStr;\n\tconst DOMString dbgStr;\n\tint NumCopy = 0;\n\n\tmemset(UDNstr, 0, sizeof(UDNstr));\n\tmemset(devType, 0, sizeof(devType));\n\tmemset(servType, 0, sizeof(servType));\n\n\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t   \"Inside AdvertiseAndReply with AdFlag = %d\\n\", AdFlag);\n\n\t/* Use a read lock */\n\tHandleReadLock();\n\tif (GetHandleInfo(Hnd, &SInfo) != HND_DEVICE) {\n\t\tretVal = UPNP_E_INVALID_HANDLE;\n\t\tgoto end_function;\n\t}\n\tdefaultExp = SInfo->MaxAge;\n\t/* parse the device list and send advertisements/replies */\n\twhile (NumCopy == 0 || (AdFlag && NumCopy < NUM_SSDP_COPY)) {\n\t\tif (NumCopy != 0)\n\t\t\timillisleep(SSDP_PAUSE);\n\t\tNumCopy++;\n\t\tfor (i = 0lu;; i++) {\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Entering new device list with i = %lu\\n\\n\",\n\t\t\t\t   i);\n\t\t\ttmpNode = ixmlNodeList_item(SInfo->DeviceList, i);\n\t\t\tif (!tmpNode) {\n\t\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"Exiting new device list with i = %lu\\n\\n\",\n\t\t\t\t\t   i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdbgStr = ixmlNode_getNodeName(tmpNode);\n\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type once for %s\\n\",\n\t\t\t\t   dbgStr);\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tnodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"deviceType\");\n\t\t\tif (!nodeList)\n\t\t\t\tcontinue;\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting UDN for %s\\n\", dbgStr);\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type\\n\");\n\t\t\ttmpNode2 = ixmlNodeList_item(nodeList, 0lu);\n\t\t\tif (!tmpNode2)\n\t\t\t\tcontinue;\n\t\t\ttextNode = ixmlNode_getFirstChild(tmpNode2);\n\t\t\tif (!textNode)\n\t\t\t\tcontinue;\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type \\n\");\n\t\t\ttmpStr = ixmlNode_getNodeValue(textNode);\n\t\t\tif (!tmpStr)\n\t\t\t\tcontinue;\n\t\t\tstrncpy(devType, tmpStr, sizeof(devType) - 1);\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type = %s\\n\", devType);\n\t\t\tif (!tmpNode) {\n\t\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"TempNode is NULL\\n\");\n\t\t\t}\n\t\t\tdbgStr = ixmlNode_getNodeName(tmpNode);\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting UDN for %s\\n\", dbgStr);\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tnodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"UDN\");\n\t\t\tif (!nodeList) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttmpNode2 = ixmlNodeList_item(nodeList, 0lu);\n\t\t\tif (!tmpNode2) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttextNode = ixmlNode_getFirstChild(tmpNode2);\n\t\t\tif (!textNode) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttmpStr = ixmlNode_getNodeValue(textNode);\n\t\t\tif (!tmpStr) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tstrncpy(UDNstr, tmpStr, sizeof(UDNstr) - 1);\n\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t   \"Sending UDNStr = %s \\n\", UDNstr);\n\t\t\tif (AdFlag) {\n\t\t\t\t/* send the device advertisement */\n\t\t\t\tif (AdFlag == 1) {\n\t\t\t\t\tDeviceAdvertisement(devType, i == 0lu,\n\t\t\t\t\t\t\t    UDNstr,\n\t\t\t\t\t\t\t    SInfo->DescURL, Exp,\n\t\t\t\t\t\t\t    SInfo->DeviceAf,\n\t\t\t\t\t\t\t    SInfo->PowerState,\n\t                                                    SInfo->SleepPeriod,\n\t                                                    SInfo->RegistrationState);\n\t\t\t\t} else {\n\t\t\t\t\t/* AdFlag == -1 */\n\t\t\t\t\tDeviceShutdown(devType, i == 0lu, UDNstr,\n\t\t\t\t\t\t       SInfo->DescURL,\n\t\t\t\t\t\t       Exp, SInfo->DeviceAf,\n\t\t\t\t\t\t       SInfo->PowerState,\n\t\t\t\t\t\t       SInfo->SleepPeriod,\n\t\t\t\t\t\t       SInfo->RegistrationState);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch (SearchType) {\n\t\t\t\tcase SSDP_ALL:\n\t\t\t\t\tDeviceReply(DestAddr, devType, i == 0lu,\n\t\t\t\t\t\t    UDNstr, SInfo->DescURL,\n\t\t\t\t\t\t    defaultExp, SInfo->PowerState,\n\t\t\t\t\t\t    SInfo->SleepPeriod,\n\t\t\t\t\t\t    SInfo->RegistrationState);\n\t\t\t\t\tbreak;\n\t\t\t\tcase SSDP_ROOTDEVICE:\n\t\t\t\t\tif (i == 0lu) {\n\t\t\t\t\t\tSendReply(DestAddr, devType, 1,\n\t\t\t\t\t\t\t  UDNstr,\n\t\t\t\t\t\t\t  SInfo->DescURL,\n\t\t\t\t\t\t\t  defaultExp, 0,\n\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SSDP_DEVICEUDN: {\n\t\t\t\t\tif (DeviceUDN && strlen(DeviceUDN) != (size_t)0) {\n\t\t\t\t\t\tif (strcasecmp(DeviceUDN, UDNstr)) {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\"DeviceUDN=%s and search UDN=%s DID NOT match\\n\",\n\t\t\t\t\t\t\t\tUDNstr, DeviceUDN);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\"DeviceUDN=%s and search UDN=%s MATCH\\n\",\n\t\t\t\t\t\t\t\tUDNstr, DeviceUDN);\n\t\t\t\t\t\t\tSendReply(DestAddr, devType, 0, UDNstr, SInfo->DescURL, defaultExp, 0,\n\t\t\t\t\t\t\t\tSInfo->PowerState,\n\t\t\t\t\t\t\t\tSInfo->SleepPeriod,\n\t\t\t\t\t\t\t\tSInfo->RegistrationState);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcase SSDP_DEVICETYPE: {\n\t\t\t\t\tif (!strncasecmp(DeviceType, devType, strlen(DeviceType) - (size_t)2)) {\n\t\t\t\t\t\tif (atoi(strrchr(DeviceType, ':') + 1)\n\t\t\t\t\t\t    < atoi(&devType[strlen(devType) - (size_t)1])) {\n\t\t\t\t\t\t\t/* the requested version is lower than the device version\n\t\t\t\t\t\t\t * must reply with the lower version number and the lower\n\t\t\t\t\t\t\t * description URL */\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t\t\tSendReply(DestAddr, DeviceType, 0, UDNstr, SInfo->LowerDescURL,\n\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t} else if (atoi(strrchr(DeviceType, ':') + 1)\n\t\t\t\t\t\t\t   == atoi(&devType[strlen(devType) - (size_t)1])) {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t\t\tSendReply(DestAddr, DeviceType, 0, UDNstr, SInfo->DescURL,\n\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t/* send service advertisements for services corresponding\n\t\t\t * to the same device */\n\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t   \"Sending service Advertisement\\n\");\n\t\t\t/* Correct service traversal such that each device's serviceList\n\t\t\t * is directly traversed as a child of its parent device. This\n\t\t\t * ensures that the service's alive message uses the UDN of\n\t\t\t * the parent device. */\n\t\t\ttmpNode = ixmlNode_getFirstChild(tmpNode);\n\t\t\twhile (tmpNode) {\n\t\t\t\tdbgStr = ixmlNode_getNodeName(tmpNode);\n\t\t\t\tif (!strncmp\n\t\t\t\t    (dbgStr, SERVICELIST_STR,\n\t\t\t\t     sizeof SERVICELIST_STR)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ttmpNode = ixmlNode_getNextSibling(tmpNode);\n\t\t\t}\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tif (!tmpNode) {\n\t\t\t\tnodeList = NULL;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tnodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"service\");\n\t\t\tif (!nodeList) {\n\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"Service not found 3\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (j = 0lu;; j++) {\n\t\t\t\ttmpNode = ixmlNodeList_item(nodeList, j);\n\t\t\t\tif (!tmpNode) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tixmlNodeList_free(tmpNodeList);\n\t\t\t\ttmpNodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"serviceType\");\n\t\t\t\tif (!tmpNodeList) {\n\t\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t\t   __LINE__,\n\t\t\t\t\t\t   \"ServiceType not found \\n\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttmpNode2 = ixmlNodeList_item(tmpNodeList, 0lu);\n\t\t\t\tif (!tmpNode2)\n\t\t\t\t\tcontinue;\n\t\t\t\ttextNode = ixmlNode_getFirstChild(tmpNode2);\n\t\t\t\tif (!textNode)\n\t\t\t\t\tcontinue;\n\t\t\t\t/* servType is of format Servicetype:ServiceVersion */\n\t\t\t\ttmpStr = ixmlNode_getNodeValue(textNode);\n\t\t\t\tif (!tmpStr)\n\t\t\t\t\tcontinue;\n\t\t\t\tstrncpy(servType, tmpStr, sizeof(servType) - 1);\n\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"ServiceType = %s\\n\", servType);\n\t\t\t\tif (AdFlag) {\n\t\t\t\t\tif (AdFlag == 1) {\n\t\t\t\t\t\tServiceAdvertisement(UDNstr,\n\t\t\t\t\t\t\tservType, SInfo->DescURL,\n\t\t\t\t\t\t\tExp, SInfo->DeviceAf,\n\t\t\t\t\t\t\tSInfo->PowerState,\n\t\t\t\t\t\t\tSInfo->SleepPeriod,\n\t\t\t\t\t\t\tSInfo->RegistrationState);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* AdFlag == -1 */\n\t\t\t\t\t\tServiceShutdown(UDNstr,\n\t\t\t\t\t\t\tservType, SInfo->DescURL,\n\t\t\t\t\t\t\tExp, SInfo->DeviceAf,\n\t\t\t\t\t\t\tSInfo->PowerState,\n\t\t\t\t\t\t\tSInfo->SleepPeriod,\n\t\t\t\t\t\t\tSInfo->RegistrationState);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tswitch (SearchType) {\n\t\t\t\t\tcase SSDP_ALL:\n\t\t\t\t\t\tServiceReply(DestAddr, servType,\n\t\t\t\t\t\t\t     UDNstr,\n\t\t\t\t\t\t\t     SInfo->DescURL,\n\t\t\t\t\t\t\t     defaultExp,\n\t\t\t\t\t\t\t     SInfo->PowerState,\n\t\t\t\t\t\t\t     SInfo->SleepPeriod,\n\t\t\t\t\t\t\t     SInfo->RegistrationState);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SSDP_SERVICE:\n\t\t\t\t\t\tif (ServiceType) {\n\t\t\t\t\t\t\tif (!strncasecmp(ServiceType, servType, strlen(ServiceType) - (size_t)2)) {\n\t\t\t\t\t\t\t\tif (atoi(strrchr(ServiceType, ':') + 1) <\n\t\t\t\t\t\t\t\t    atoi(&servType[strlen(servType) - (size_t)1])) {\n\t\t\t\t\t\t\t\t\t/* the requested version is lower than the service version\n\t\t\t\t\t\t\t\t\t * must reply with the lower version number and the lower\n\t\t\t\t\t\t\t\t\t * description URL */\n\t\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t\t\tSendReply(DestAddr, ServiceType, 0, UDNstr, SInfo->LowerDescURL,\n\t\t\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t\t\t} else if (atoi(strrchr (ServiceType, ':') + 1) ==\n\t\t\t\t\t\t\t\t\t   atoi(&servType[strlen(servType) - (size_t)1])) {\n\t\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t\t\tSendReply(DestAddr, ServiceType, 0, UDNstr, SInfo->DescURL,\n\t\t\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tixmlNodeList_free(tmpNodeList);\n\t\t\ttmpNodeList = NULL;\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tnodeList = NULL;\n\t\t}\n\t}\n\nend_function:\n\tixmlNodeList_free(tmpNodeList);\n\tixmlNodeList_free(nodeList);\n\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t   \"Exiting AdvertiseAndReply.\\n\");\n\tHandleUnlock();\n\n\treturn retVal;\n}",
          "includes": [
            "#include <stdio.h>",
            "#include \"upnpapi.h\"",
            "#include \"ThreadPool.h\"",
            "#include \"sock.h\"",
            "#include \"miniserver.h\"",
            "#include \"membuffer.h\"",
            "#include \"httpreadwrite.h\"",
            "#include \"httpparser.h\"",
            "#include \"ssdplib.h\"",
            "#include \"config.h\"",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include \"upnpapi.h\"\n#include \"ThreadPool.h\"\n#include \"sock.h\"\n#include \"miniserver.h\"\n#include \"membuffer.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"ssdplib.h\"\n#include \"config.h\"\n#include <sys/param.h>\n\nint AdvertiseAndReply(int AdFlag, UpnpDevice_Handle Hnd,\n\t\t      enum SsdpSearchType SearchType,\n\t\t      struct sockaddr *DestAddr, char *DeviceType,\n\t\t      char *DeviceUDN, char *ServiceType, int Exp)\n{\n\tint retVal = UPNP_E_SUCCESS;\n\tlong unsigned int i;\n\tlong unsigned int j;\n\tint defaultExp = DEFAULT_MAXAGE;\n\tstruct Handle_Info *SInfo = NULL;\n\tchar UDNstr[100];\n\tchar devType[100];\n\tchar servType[100];\n\tIXML_NodeList *nodeList = NULL;\n\tIXML_NodeList *tmpNodeList = NULL;\n\tIXML_Node *tmpNode = NULL;\n\tIXML_Node *tmpNode2 = NULL;\n\tIXML_Node *textNode = NULL;\n\tconst DOMString tmpStr;\n\tconst DOMString dbgStr;\n\tint NumCopy = 0;\n\n\tmemset(UDNstr, 0, sizeof(UDNstr));\n\tmemset(devType, 0, sizeof(devType));\n\tmemset(servType, 0, sizeof(servType));\n\n\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t   \"Inside AdvertiseAndReply with AdFlag = %d\\n\", AdFlag);\n\n\t/* Use a read lock */\n\tHandleReadLock();\n\tif (GetHandleInfo(Hnd, &SInfo) != HND_DEVICE) {\n\t\tretVal = UPNP_E_INVALID_HANDLE;\n\t\tgoto end_function;\n\t}\n\tdefaultExp = SInfo->MaxAge;\n\t/* parse the device list and send advertisements/replies */\n\twhile (NumCopy == 0 || (AdFlag && NumCopy < NUM_SSDP_COPY)) {\n\t\tif (NumCopy != 0)\n\t\t\timillisleep(SSDP_PAUSE);\n\t\tNumCopy++;\n\t\tfor (i = 0lu;; i++) {\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Entering new device list with i = %lu\\n\\n\",\n\t\t\t\t   i);\n\t\t\ttmpNode = ixmlNodeList_item(SInfo->DeviceList, i);\n\t\t\tif (!tmpNode) {\n\t\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"Exiting new device list with i = %lu\\n\\n\",\n\t\t\t\t\t   i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdbgStr = ixmlNode_getNodeName(tmpNode);\n\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type once for %s\\n\",\n\t\t\t\t   dbgStr);\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tnodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"deviceType\");\n\t\t\tif (!nodeList)\n\t\t\t\tcontinue;\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting UDN for %s\\n\", dbgStr);\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type\\n\");\n\t\t\ttmpNode2 = ixmlNodeList_item(nodeList, 0lu);\n\t\t\tif (!tmpNode2)\n\t\t\t\tcontinue;\n\t\t\ttextNode = ixmlNode_getFirstChild(tmpNode2);\n\t\t\tif (!textNode)\n\t\t\t\tcontinue;\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type \\n\");\n\t\t\ttmpStr = ixmlNode_getNodeValue(textNode);\n\t\t\tif (!tmpStr)\n\t\t\t\tcontinue;\n\t\t\tstrncpy(devType, tmpStr, sizeof(devType) - 1);\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting device type = %s\\n\", devType);\n\t\t\tif (!tmpNode) {\n\t\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"TempNode is NULL\\n\");\n\t\t\t}\n\t\t\tdbgStr = ixmlNode_getNodeName(tmpNode);\n\t\t\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t\t\t   \"Extracting UDN for %s\\n\", dbgStr);\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tnodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"UDN\");\n\t\t\tif (!nodeList) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttmpNode2 = ixmlNodeList_item(nodeList, 0lu);\n\t\t\tif (!tmpNode2) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttextNode = ixmlNode_getFirstChild(tmpNode2);\n\t\t\tif (!textNode) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttmpStr = ixmlNode_getNodeValue(textNode);\n\t\t\tif (!tmpStr) {\n\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t   __LINE__, \"UDN not found!\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tstrncpy(UDNstr, tmpStr, sizeof(UDNstr) - 1);\n\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t   \"Sending UDNStr = %s \\n\", UDNstr);\n\t\t\tif (AdFlag) {\n\t\t\t\t/* send the device advertisement */\n\t\t\t\tif (AdFlag == 1) {\n\t\t\t\t\tDeviceAdvertisement(devType, i == 0lu,\n\t\t\t\t\t\t\t    UDNstr,\n\t\t\t\t\t\t\t    SInfo->DescURL, Exp,\n\t\t\t\t\t\t\t    SInfo->DeviceAf,\n\t\t\t\t\t\t\t    SInfo->PowerState,\n\t                                                    SInfo->SleepPeriod,\n\t                                                    SInfo->RegistrationState);\n\t\t\t\t} else {\n\t\t\t\t\t/* AdFlag == -1 */\n\t\t\t\t\tDeviceShutdown(devType, i == 0lu, UDNstr,\n\t\t\t\t\t\t       SInfo->DescURL,\n\t\t\t\t\t\t       Exp, SInfo->DeviceAf,\n\t\t\t\t\t\t       SInfo->PowerState,\n\t\t\t\t\t\t       SInfo->SleepPeriod,\n\t\t\t\t\t\t       SInfo->RegistrationState);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch (SearchType) {\n\t\t\t\tcase SSDP_ALL:\n\t\t\t\t\tDeviceReply(DestAddr, devType, i == 0lu,\n\t\t\t\t\t\t    UDNstr, SInfo->DescURL,\n\t\t\t\t\t\t    defaultExp, SInfo->PowerState,\n\t\t\t\t\t\t    SInfo->SleepPeriod,\n\t\t\t\t\t\t    SInfo->RegistrationState);\n\t\t\t\t\tbreak;\n\t\t\t\tcase SSDP_ROOTDEVICE:\n\t\t\t\t\tif (i == 0lu) {\n\t\t\t\t\t\tSendReply(DestAddr, devType, 1,\n\t\t\t\t\t\t\t  UDNstr,\n\t\t\t\t\t\t\t  SInfo->DescURL,\n\t\t\t\t\t\t\t  defaultExp, 0,\n\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SSDP_DEVICEUDN: {\n\t\t\t\t\tif (DeviceUDN && strlen(DeviceUDN) != (size_t)0) {\n\t\t\t\t\t\tif (strcasecmp(DeviceUDN, UDNstr)) {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\"DeviceUDN=%s and search UDN=%s DID NOT match\\n\",\n\t\t\t\t\t\t\t\tUDNstr, DeviceUDN);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\"DeviceUDN=%s and search UDN=%s MATCH\\n\",\n\t\t\t\t\t\t\t\tUDNstr, DeviceUDN);\n\t\t\t\t\t\t\tSendReply(DestAddr, devType, 0, UDNstr, SInfo->DescURL, defaultExp, 0,\n\t\t\t\t\t\t\t\tSInfo->PowerState,\n\t\t\t\t\t\t\t\tSInfo->SleepPeriod,\n\t\t\t\t\t\t\t\tSInfo->RegistrationState);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcase SSDP_DEVICETYPE: {\n\t\t\t\t\tif (!strncasecmp(DeviceType, devType, strlen(DeviceType) - (size_t)2)) {\n\t\t\t\t\t\tif (atoi(strrchr(DeviceType, ':') + 1)\n\t\t\t\t\t\t    < atoi(&devType[strlen(devType) - (size_t)1])) {\n\t\t\t\t\t\t\t/* the requested version is lower than the device version\n\t\t\t\t\t\t\t * must reply with the lower version number and the lower\n\t\t\t\t\t\t\t * description URL */\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t\t\tSendReply(DestAddr, DeviceType, 0, UDNstr, SInfo->LowerDescURL,\n\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t} else if (atoi(strrchr(DeviceType, ':') + 1)\n\t\t\t\t\t\t\t   == atoi(&devType[strlen(devType) - (size_t)1])) {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t\t\tSendReply(DestAddr, DeviceType, 0, UDNstr, SInfo->DescURL,\n\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t   \"DeviceType=%s and search devType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t   devType, DeviceType);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t/* send service advertisements for services corresponding\n\t\t\t * to the same device */\n\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t   \"Sending service Advertisement\\n\");\n\t\t\t/* Correct service traversal such that each device's serviceList\n\t\t\t * is directly traversed as a child of its parent device. This\n\t\t\t * ensures that the service's alive message uses the UDN of\n\t\t\t * the parent device. */\n\t\t\ttmpNode = ixmlNode_getFirstChild(tmpNode);\n\t\t\twhile (tmpNode) {\n\t\t\t\tdbgStr = ixmlNode_getNodeName(tmpNode);\n\t\t\t\tif (!strncmp\n\t\t\t\t    (dbgStr, SERVICELIST_STR,\n\t\t\t\t     sizeof SERVICELIST_STR)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ttmpNode = ixmlNode_getNextSibling(tmpNode);\n\t\t\t}\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tif (!tmpNode) {\n\t\t\t\tnodeList = NULL;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tnodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"service\");\n\t\t\tif (!nodeList) {\n\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"Service not found 3\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (j = 0lu;; j++) {\n\t\t\t\ttmpNode = ixmlNodeList_item(nodeList, j);\n\t\t\t\tif (!tmpNode) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tixmlNodeList_free(tmpNodeList);\n\t\t\t\ttmpNodeList = ixmlElement_getElementsByTagName((IXML_Element *) tmpNode, \"serviceType\");\n\t\t\t\tif (!tmpNodeList) {\n\t\t\t\t\tUpnpPrintf(UPNP_CRITICAL, API, __FILE__,\n\t\t\t\t\t\t   __LINE__,\n\t\t\t\t\t\t   \"ServiceType not found \\n\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttmpNode2 = ixmlNodeList_item(tmpNodeList, 0lu);\n\t\t\t\tif (!tmpNode2)\n\t\t\t\t\tcontinue;\n\t\t\t\ttextNode = ixmlNode_getFirstChild(tmpNode2);\n\t\t\t\tif (!textNode)\n\t\t\t\t\tcontinue;\n\t\t\t\t/* servType is of format Servicetype:ServiceVersion */\n\t\t\t\ttmpStr = ixmlNode_getNodeValue(textNode);\n\t\t\t\tif (!tmpStr)\n\t\t\t\t\tcontinue;\n\t\t\t\tstrncpy(servType, tmpStr, sizeof(servType) - 1);\n\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t   \"ServiceType = %s\\n\", servType);\n\t\t\t\tif (AdFlag) {\n\t\t\t\t\tif (AdFlag == 1) {\n\t\t\t\t\t\tServiceAdvertisement(UDNstr,\n\t\t\t\t\t\t\tservType, SInfo->DescURL,\n\t\t\t\t\t\t\tExp, SInfo->DeviceAf,\n\t\t\t\t\t\t\tSInfo->PowerState,\n\t\t\t\t\t\t\tSInfo->SleepPeriod,\n\t\t\t\t\t\t\tSInfo->RegistrationState);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* AdFlag == -1 */\n\t\t\t\t\t\tServiceShutdown(UDNstr,\n\t\t\t\t\t\t\tservType, SInfo->DescURL,\n\t\t\t\t\t\t\tExp, SInfo->DeviceAf,\n\t\t\t\t\t\t\tSInfo->PowerState,\n\t\t\t\t\t\t\tSInfo->SleepPeriod,\n\t\t\t\t\t\t\tSInfo->RegistrationState);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tswitch (SearchType) {\n\t\t\t\t\tcase SSDP_ALL:\n\t\t\t\t\t\tServiceReply(DestAddr, servType,\n\t\t\t\t\t\t\t     UDNstr,\n\t\t\t\t\t\t\t     SInfo->DescURL,\n\t\t\t\t\t\t\t     defaultExp,\n\t\t\t\t\t\t\t     SInfo->PowerState,\n\t\t\t\t\t\t\t     SInfo->SleepPeriod,\n\t\t\t\t\t\t\t     SInfo->RegistrationState);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SSDP_SERVICE:\n\t\t\t\t\t\tif (ServiceType) {\n\t\t\t\t\t\t\tif (!strncasecmp(ServiceType, servType, strlen(ServiceType) - (size_t)2)) {\n\t\t\t\t\t\t\t\tif (atoi(strrchr(ServiceType, ':') + 1) <\n\t\t\t\t\t\t\t\t    atoi(&servType[strlen(servType) - (size_t)1])) {\n\t\t\t\t\t\t\t\t\t/* the requested version is lower than the service version\n\t\t\t\t\t\t\t\t\t * must reply with the lower version number and the lower\n\t\t\t\t\t\t\t\t\t * description URL */\n\t\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t\t\tSendReply(DestAddr, ServiceType, 0, UDNstr, SInfo->LowerDescURL,\n\t\t\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t\t\t} else if (atoi(strrchr (ServiceType, ':') + 1) ==\n\t\t\t\t\t\t\t\t\t   atoi(&servType[strlen(servType) - (size_t)1])) {\n\t\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s MATCH\\n\",\n\t\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t\t\tSendReply(DestAddr, ServiceType, 0, UDNstr, SInfo->DescURL,\n\t\t\t\t\t\t\t\t\t\t  defaultExp, 1,\n\t\t\t\t\t\t\t\t\t\t  SInfo->PowerState,\n\t\t\t\t\t\t\t\t\t\t  SInfo->SleepPeriod,\n\t\t\t\t\t\t\t\t\t\t  SInfo->RegistrationState);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__,\n\t\t\t\t\t\t\t\t\t   \"ServiceType=%s and search servType=%s DID NOT MATCH\\n\",\n\t\t\t\t\t\t\t\t\t   ServiceType, servType);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tixmlNodeList_free(tmpNodeList);\n\t\t\ttmpNodeList = NULL;\n\t\t\tixmlNodeList_free(nodeList);\n\t\t\tnodeList = NULL;\n\t\t}\n\t}\n\nend_function:\n\tixmlNodeList_free(tmpNodeList);\n\tixmlNodeList_free(nodeList);\n\tUpnpPrintf(UPNP_ALL, API, __FILE__, __LINE__,\n\t\t   \"Exiting AdvertiseAndReply.\\n\");\n\tHandleUnlock();\n\n\treturn retVal;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <assert.h>\n#include \"UpnpInet.h\"\n#include \"upnpapi.h\"\n#include \"unixutil.h\"\n#include \"ThreadPool.h\"\n#include \"statcodes.h\"\n#include \"ssdplib.h\"\n#include \"httpreadwrite.h\"\n#include \"httpparser.h\"\n#include \"config.h\"\n\nvoid *advertiseAndReplyThread(void *data)\n{\n\tSsdpSearchReply *arg = (SsdpSearchReply *) data;\n\n\tAdvertiseAndReply(0, arg->handle,\n\t\t\t  arg->event.RequestType,\n\t\t\t  (struct sockaddr *)&arg->dest_addr,\n\t\t\t  arg->event.DeviceType,\n\t\t\t  arg->event.UDN, arg->event.ServiceType, arg->MaxAge);\n\tfree(arg);\n\n\treturn NULL;\n}"
  }
]