[
  {
    "function_name": "Tcl_AppInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/tcl_wrapper.c",
    "lines": "118-241",
    "snippet": "int Tcl_AppInit(interp)\n    Tcl_Interp *interp;\n{\n    int argc;\n    char **argv, **mostly_argv;\n    char *interp_argv, *interp_argv0, *request;\n    Tcl_CmdInfo cmdInfo;\n\n    if (Tcl_Init(interp) == TCL_ERROR)\n\treturn TCL_ERROR;\n    /*\n     * the following is, admittedly, sorta gross, but the only way\n     * to grab the original argc, argv once the interpreter is running\n     */\n    interp_argv = Tcl_GetVar(interp, \"argv\", 0);\n    if (interp_argv == NULL)\n\treturn TCL_ERROR;\n    else if (Tcl_SplitList(interp, interp_argv,\n\t\t\t   &argc, &mostly_argv) != TCL_OK)\n\treturn TCL_ERROR;\n    interp_argv0 = Tcl_GetVar(interp, \"argv0\", 0);\n    if (interp_argv0 == NULL)\n\treturn TCL_ERROR;\n    if ((argv = (char **)malloc((argc + 1) * sizeof (char *))) == NULL)\n\treturn TCL_ERROR;\n    argv[0] = interp_argv0;\n    memcpy(argv + 1, mostly_argv, argc++ * sizeof (char *));\n    /*\n     * set up a prompt\n     */\n    if (Tcl_SetVar(interp, \"tcl_prompt1\",\n\t\t   \"puts -nonewline \\\"kdb5_edit: \\\"\", 0) == NULL)\n\treturn TCL_ERROR;\n    /*\n     * we don't want arbitrary programs to get exec'd by accident\n     */\n    if (Tcl_SetVar(interp, \"auto_noexec\", \"{}\", 0) == NULL)\n\treturn TCL_ERROR;\n    request = kdb5_edit_Init(argc, argv);\n    Tcl_CallWhenDeleted(interp, doquit,\n\t\t\t(ClientData)0);\n    Tcl_CreateCommand(interp, \"quit\", doquit,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"exit\", doquit,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"list_requests\", list_requests,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"lr\", list_requests,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    if (Tcl_GetCommandInfo(interp, \"cd\", &cmdInfo)) {\n\tTcl_CreateCommand(interp, \"cwd\", cmdInfo.proc,\n\t\t\t  (ClientData)0,\n\t\t\t  (Tcl_CmdDeleteProc *)0);\n\tTcl_CreateCommand(interp, \"change_working_directory\", cmdInfo.proc,\n\t\t\t  (ClientData)0,\n\t\t\t  (Tcl_CmdDeleteProc *)0);\n    }\n    if (Tcl_GetCommandInfo(interp, \"pwd\", &cmdInfo)) {\n\tTcl_CreateCommand(interp, \"print_working_directory\", cmdInfo.proc,\n\t\t\t  (ClientData)0,\n\t\t\t  (Tcl_CmdDeleteProc *)0);\n    }\n    Tcl_CreateCommand(interp, \"show_principal\", wrapper, show_principal,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"show\", wrapper, show_principal,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"add_new_key\", wrapper, add_new_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ank\", wrapper, add_new_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"change_pwd_key\", wrapper, change_pwd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"cpw\", wrapper, change_pwd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"add_rnd_key\", wrapper, add_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ark\", wrapper, add_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"change_rnd_key\", wrapper, change_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"crk\", wrapper, change_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"delete_entry\", wrapper, delete_entry,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"delent\", wrapper, delete_entry,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"extract_srvtab\", wrapper, extract_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"xst\", wrapper, extract_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ex_st\", wrapper, extract_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"extract_v4_srvtab\", wrapper, extract_v4_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"xv4st\", wrapper, extract_v4_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"list_db\", wrapper, list_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ldb\", wrapper, list_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"dump_db\", wrapper, dump_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ddb\", wrapper, dump_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"load_db\", wrapper, load_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"lddb\", wrapper, load_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"set_dbname\", wrapper, set_dbname,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"sdbn\", wrapper, set_dbname,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"enter_master_key\", wrapper, enter_master_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"emk\", wrapper, enter_master_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    if (request && (Tcl_Eval(interp, request) == TCL_ERROR))\n\treturn TCL_ERROR;\n    return TCL_OK;\n}",
    "includes": [
      "#include <tcl/tcl.h>",
      "#include <tcl.h>",
      "#include \"kdb5_edit.h\"",
      "#include \"k5-int.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern Tcl_Interp *interp;",
      "void show_principal (int, char **);",
      "void add_new_key (int, char **);",
      "void change_pwd_key (int, char **);",
      "void add_rnd_key (int, char **);",
      "void change_rnd_key (int, char **);",
      "void delete_entry (int, char **);",
      "void extract_v4_srvtab (int, char **);",
      "void list_db (int, char **);",
      "void dump_db (int, char **);",
      "void load_db (int, char **);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "Tcl_Eval",
          "args": [
            "interp",
            "request"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"emk\"",
            "wrapper",
            "enter_master_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"enter_master_key\"",
            "wrapper",
            "enter_master_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"sdbn\"",
            "wrapper",
            "set_dbname",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"set_dbname\"",
            "wrapper",
            "set_dbname",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"lddb\"",
            "wrapper",
            "load_db",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"load_db\"",
            "wrapper",
            "load_db",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"ddb\"",
            "wrapper",
            "dump_db",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"dump_db\"",
            "wrapper",
            "dump_db",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"ldb\"",
            "wrapper",
            "list_db",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"list_db\"",
            "wrapper",
            "list_db",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"xv4st\"",
            "wrapper",
            "extract_v4_srvtab",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"extract_v4_srvtab\"",
            "wrapper",
            "extract_v4_srvtab",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"ex_st\"",
            "wrapper",
            "extract_srvtab",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"xst\"",
            "wrapper",
            "extract_srvtab",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"extract_srvtab\"",
            "wrapper",
            "extract_srvtab",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"delent\"",
            "wrapper",
            "delete_entry",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"delete_entry\"",
            "wrapper",
            "delete_entry",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"crk\"",
            "wrapper",
            "change_rnd_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"change_rnd_key\"",
            "wrapper",
            "change_rnd_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"ark\"",
            "wrapper",
            "add_rnd_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"add_rnd_key\"",
            "wrapper",
            "add_rnd_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"cpw\"",
            "wrapper",
            "change_pwd_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"change_pwd_key\"",
            "wrapper",
            "change_pwd_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"ank\"",
            "wrapper",
            "add_new_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"add_new_key\"",
            "wrapper",
            "add_new_key",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"show\"",
            "wrapper",
            "show_principal",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"show_principal\"",
            "wrapper",
            "show_principal",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"print_working_directory\"",
            "cmdInfo.proc",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_GetCommandInfo",
          "args": [
            "interp",
            "\"pwd\"",
            "&cmdInfo"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"change_working_directory\"",
            "cmdInfo.proc",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"cwd\"",
            "cmdInfo.proc",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_GetCommandInfo",
          "args": [
            "interp",
            "\"cd\"",
            "&cmdInfo"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"lr\"",
            "list_requests",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"list_requests\"",
            "list_requests",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"exit\"",
            "doquit",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CreateCommand",
          "args": [
            "interp",
            "\"quit\"",
            "doquit",
            "(ClientData)0",
            "(Tcl_CmdDeleteProc *)0"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_CallWhenDeleted",
          "args": [
            "interp",
            "doquit",
            "(ClientData)0"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdb5_edit_Init",
          "args": [
            "argc",
            "argv"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_SetVar",
          "args": [
            "interp",
            "\"auto_noexec\"",
            "\"{}\"",
            "0"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_SetVar",
          "args": [
            "interp",
            "\"tcl_prompt1\"",
            "\"puts -nonewline \\\"kdb5_edit: \\\"\"",
            "0"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "argv + 1",
            "mostly_argv",
            "argc++ * sizeof (char *)"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "(argc + 1) * sizeof (char *)"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_GetVar",
          "args": [
            "interp",
            "\"argv0\"",
            "0"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_SplitList",
          "args": [
            "interp",
            "interp_argv",
            "&argc",
            "&mostly_argv"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_GetVar",
          "args": [
            "interp",
            "\"argv\"",
            "0"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_Init",
          "args": [
            "interp"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <tcl/tcl.h>\n#include <tcl.h>\n#include \"kdb5_edit.h\"\n#include \"k5-int.h\"\n\nextern Tcl_Interp *interp;\nvoid show_principal (int, char **);\nvoid add_new_key (int, char **);\nvoid change_pwd_key (int, char **);\nvoid add_rnd_key (int, char **);\nvoid change_rnd_key (int, char **);\nvoid delete_entry (int, char **);\nvoid extract_v4_srvtab (int, char **);\nvoid list_db (int, char **);\nvoid dump_db (int, char **);\nvoid load_db (int, char **);\n\nint Tcl_AppInit(interp)\n    Tcl_Interp *interp;\n{\n    int argc;\n    char **argv, **mostly_argv;\n    char *interp_argv, *interp_argv0, *request;\n    Tcl_CmdInfo cmdInfo;\n\n    if (Tcl_Init(interp) == TCL_ERROR)\n\treturn TCL_ERROR;\n    /*\n     * the following is, admittedly, sorta gross, but the only way\n     * to grab the original argc, argv once the interpreter is running\n     */\n    interp_argv = Tcl_GetVar(interp, \"argv\", 0);\n    if (interp_argv == NULL)\n\treturn TCL_ERROR;\n    else if (Tcl_SplitList(interp, interp_argv,\n\t\t\t   &argc, &mostly_argv) != TCL_OK)\n\treturn TCL_ERROR;\n    interp_argv0 = Tcl_GetVar(interp, \"argv0\", 0);\n    if (interp_argv0 == NULL)\n\treturn TCL_ERROR;\n    if ((argv = (char **)malloc((argc + 1) * sizeof (char *))) == NULL)\n\treturn TCL_ERROR;\n    argv[0] = interp_argv0;\n    memcpy(argv + 1, mostly_argv, argc++ * sizeof (char *));\n    /*\n     * set up a prompt\n     */\n    if (Tcl_SetVar(interp, \"tcl_prompt1\",\n\t\t   \"puts -nonewline \\\"kdb5_edit: \\\"\", 0) == NULL)\n\treturn TCL_ERROR;\n    /*\n     * we don't want arbitrary programs to get exec'd by accident\n     */\n    if (Tcl_SetVar(interp, \"auto_noexec\", \"{}\", 0) == NULL)\n\treturn TCL_ERROR;\n    request = kdb5_edit_Init(argc, argv);\n    Tcl_CallWhenDeleted(interp, doquit,\n\t\t\t(ClientData)0);\n    Tcl_CreateCommand(interp, \"quit\", doquit,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"exit\", doquit,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"list_requests\", list_requests,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"lr\", list_requests,\n\t\t      (ClientData)0,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    if (Tcl_GetCommandInfo(interp, \"cd\", &cmdInfo)) {\n\tTcl_CreateCommand(interp, \"cwd\", cmdInfo.proc,\n\t\t\t  (ClientData)0,\n\t\t\t  (Tcl_CmdDeleteProc *)0);\n\tTcl_CreateCommand(interp, \"change_working_directory\", cmdInfo.proc,\n\t\t\t  (ClientData)0,\n\t\t\t  (Tcl_CmdDeleteProc *)0);\n    }\n    if (Tcl_GetCommandInfo(interp, \"pwd\", &cmdInfo)) {\n\tTcl_CreateCommand(interp, \"print_working_directory\", cmdInfo.proc,\n\t\t\t  (ClientData)0,\n\t\t\t  (Tcl_CmdDeleteProc *)0);\n    }\n    Tcl_CreateCommand(interp, \"show_principal\", wrapper, show_principal,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"show\", wrapper, show_principal,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"add_new_key\", wrapper, add_new_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ank\", wrapper, add_new_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"change_pwd_key\", wrapper, change_pwd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"cpw\", wrapper, change_pwd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"add_rnd_key\", wrapper, add_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ark\", wrapper, add_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"change_rnd_key\", wrapper, change_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"crk\", wrapper, change_rnd_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"delete_entry\", wrapper, delete_entry,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"delent\", wrapper, delete_entry,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"extract_srvtab\", wrapper, extract_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"xst\", wrapper, extract_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ex_st\", wrapper, extract_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"extract_v4_srvtab\", wrapper, extract_v4_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"xv4st\", wrapper, extract_v4_srvtab,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"list_db\", wrapper, list_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ldb\", wrapper, list_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"dump_db\", wrapper, dump_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"ddb\", wrapper, dump_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"load_db\", wrapper, load_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"lddb\", wrapper, load_db,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"set_dbname\", wrapper, set_dbname,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"sdbn\", wrapper, set_dbname,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"enter_master_key\", wrapper, enter_master_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    Tcl_CreateCommand(interp, \"emk\", wrapper, enter_master_key,\n\t\t      (Tcl_CmdDeleteProc *)0);\n    if (request && (Tcl_Eval(interp, request) == TCL_ERROR))\n\treturn TCL_ERROR;\n    return TCL_OK;\n}"
  },
  {
    "function_name": "wrapper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/tcl_wrapper.c",
    "lines": "108-116",
    "snippet": "int wrapper(func, interp, argc, argv)\n    void (*func)();\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    (*func)(argc, argv);\n    return TCL_OK;\n}",
    "includes": [
      "#include <tcl/tcl.h>",
      "#include <tcl.h>",
      "#include \"kdb5_edit.h\"",
      "#include \"k5-int.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern Tcl_Interp *interp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "argc",
            "argv"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <tcl/tcl.h>\n#include <tcl.h>\n#include \"kdb5_edit.h\"\n#include \"k5-int.h\"\n\nextern Tcl_Interp *interp;\n\nint wrapper(func, interp, argc, argv)\n    void (*func)();\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    (*func)(argc, argv);\n    return TCL_OK;\n}"
  },
  {
    "function_name": "list_requests",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/tcl_wrapper.c",
    "lines": "98-106",
    "snippet": "int list_requests(clientData, interp, argc, argv)\n    ClientData clientData;\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    Tcl_SetResult(interp, \"show_principal, show: Show the Kerberos database entry for a principal\\nadd_new_key, ank: Add new entry to the Kerberos database (prompting for password\\nchange_pwd_key, cpw: Change key of an entry in the Kerberos database (prompting for password)\\nadd_rnd_key, ark: Add new entry to Kerberos database, using a random key\\nchange_rnd_key, crk: Change key of an entry in the Kerberos database (select a random key)\\ndelete_entry, delent: Delete an entry from the database\\nextract_srvtab, xst, ex_st: Extract service key table\\nextract_v4_srvtab, xst4: Extract service key table\\nlist_db, ldb: List database entries\\nset_dbname, sdbn: Change database name\\nenter_master_key, emk: Enter the master key for a database\\nchange_working_directory, cwd, cd: Change working directory\\nprint_working_directory, pwd: Print working directory\\nlist_requests, lr: List available requests\\nquit, exit: Exit program\", TCL_STATIC);\n    return TCL_OK;\n}",
    "includes": [
      "#include <tcl/tcl.h>",
      "#include <tcl.h>",
      "#include \"kdb5_edit.h\"",
      "#include \"k5-int.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern Tcl_Interp *interp;",
      "void show_principal (int, char **);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "Tcl_SetResult",
          "args": [
            "interp",
            "\"show_principal, show: Show the Kerberos database entry for a principal\\nadd_new_key, ank: Add new entry to the Kerberos database (prompting for password\\nchange_pwd_key, cpw: Change key of an entry in the Kerberos database (prompting for password)\\nadd_rnd_key, ark: Add new entry to Kerberos database, using a random key\\nchange_rnd_key, crk: Change key of an entry in the Kerberos database (select a random key)\\ndelete_entry, delent: Delete an entry from the database\\nextract_srvtab, xst, ex_st: Extract service key table\\nextract_v4_srvtab, xst4: Extract service key table\\nlist_db, ldb: List database entries\\nset_dbname, sdbn: Change database name\\nenter_master_key, emk: Enter the master key for a database\\nchange_working_directory, cwd, cd: Change working directory\\nprint_working_directory, pwd: Print working directory\\nlist_requests, lr: List available requests\\nquit, exit: Exit program\"",
            "TCL_STATIC"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <tcl/tcl.h>\n#include <tcl.h>\n#include \"kdb5_edit.h\"\n#include \"k5-int.h\"\n\nextern Tcl_Interp *interp;\nvoid show_principal (int, char **);\n\nint list_requests(clientData, interp, argc, argv)\n    ClientData clientData;\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    Tcl_SetResult(interp, \"show_principal, show: Show the Kerberos database entry for a principal\\nadd_new_key, ank: Add new entry to the Kerberos database (prompting for password\\nchange_pwd_key, cpw: Change key of an entry in the Kerberos database (prompting for password)\\nadd_rnd_key, ark: Add new entry to Kerberos database, using a random key\\nchange_rnd_key, crk: Change key of an entry in the Kerberos database (select a random key)\\ndelete_entry, delent: Delete an entry from the database\\nextract_srvtab, xst, ex_st: Extract service key table\\nextract_v4_srvtab, xst4: Extract service key table\\nlist_db, ldb: List database entries\\nset_dbname, sdbn: Change database name\\nenter_master_key, emk: Enter the master key for a database\\nchange_working_directory, cwd, cd: Change working directory\\nprint_working_directory, pwd: Print working directory\\nlist_requests, lr: List available requests\\nquit, exit: Exit program\", TCL_STATIC);\n    return TCL_OK;\n}"
  },
  {
    "function_name": "doquit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/tcl_wrapper.c",
    "lines": "73-96",
    "snippet": "int doquit(clientData, interp, argc, argv)\n    ClientData clientData;\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    int value;\n\n    if ((argc != 1) && (argc != 2)) {\n\tTcl_AppendResult(interp, \"wrong # args: should be \\\"\", argv[0],\n\t\t\" ?returnCode?\\\"\", (char *) NULL);\n\treturn TCL_ERROR;\n    }\n    if (argc == 1) {\n\texit(quit() ? 1 : exit_status);\n    }\n    if (Tcl_GetInt(interp, argv[1], &value) != TCL_OK) {\n\treturn TCL_ERROR;\n    }\n    (void)quit();\n    exit(value);\n    /*NOTREACHED*/\n    return TCL_OK;\t\t\t/* Better not ever reach this! */\n}",
    "includes": [
      "#include <tcl/tcl.h>",
      "#include <tcl.h>",
      "#include \"kdb5_edit.h\"",
      "#include \"k5-int.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern Tcl_Interp *interp;",
      "extern int exit_status;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "value"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "request_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/ovsec_kadmd.c",
          "lines": "841-846",
          "snippet": "void request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}",
          "includes": [
            "#include    \"purify.h\"",
            "#include    \"misc.h\"",
            "#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */",
            "#include    <string.h>",
            "#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */",
            "#include    <krb5/adm_proto.h>",
            "#include    <kadm5/server_acl.h>",
            "#include    <kadm5/kadm_rpc.h>",
            "#include    <kadm5/admin.h>",
            "#include    <gssrpc/auth_gssapi.h>",
            "#include    \"gssapiP_krb5.h\" /* for kg_get_context */",
            "#include    <gssapi/gssapi.h>",
            "#include    <gssrpc/rpc.h>",
            "#include    <arpa/inet.h>  /* inet_ntoa */",
            "#include    <netinet/in.h>",
            "#include    <unistd.h>",
            "#include    <sys/socket.h>",
            "#include    <sys/time.h>",
            "#include    <sys/select.h>",
            "#include    <sys/types.h>",
            "#include    <syslog.h>",
            "#include    <signal.h>",
            "#include    <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "volatile int\tsignal_request_exit = 0;",
            "void\trequest_exit(int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include    \"purify.h\"\n#include    \"misc.h\"\n#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */\n#include    <string.h>\n#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */\n#include    <krb5/adm_proto.h>\n#include    <kadm5/server_acl.h>\n#include    <kadm5/kadm_rpc.h>\n#include    <kadm5/admin.h>\n#include    <gssrpc/auth_gssapi.h>\n#include    \"gssapiP_krb5.h\" /* for kg_get_context */\n#include    <gssapi/gssapi.h>\n#include    <gssrpc/rpc.h>\n#include    <arpa/inet.h>  /* inet_ntoa */\n#include    <netinet/in.h>\n#include    <unistd.h>\n#include    <sys/socket.h>\n#include    <sys/time.h>\n#include    <sys/select.h>\n#include    <sys/types.h>\n#include    <syslog.h>\n#include    <signal.h>\n#include    <stdio.h>\n\nvolatile int\tsignal_request_exit = 0;\nvoid\trequest_exit(int);\n\nvoid request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "quit",
          "args": [],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "doquit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/tcl_wrapper.c",
          "lines": "73-96",
          "snippet": "int doquit(clientData, interp, argc, argv)\n    ClientData clientData;\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    int value;\n\n    if ((argc != 1) && (argc != 2)) {\n\tTcl_AppendResult(interp, \"wrong # args: should be \\\"\", argv[0],\n\t\t\" ?returnCode?\\\"\", (char *) NULL);\n\treturn TCL_ERROR;\n    }\n    if (argc == 1) {\n\texit(quit() ? 1 : exit_status);\n    }\n    if (Tcl_GetInt(interp, argv[1], &value) != TCL_OK) {\n\treturn TCL_ERROR;\n    }\n    (void)quit();\n    exit(value);\n    /*NOTREACHED*/\n    return TCL_OK;\t\t\t/* Better not ever reach this! */\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "Tcl_GetInt",
          "args": [
            "interp",
            "argv[1]",
            "&value"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tcl_AppendResult",
          "args": [
            "interp",
            "\"wrong # args: should be \\\"\"",
            "argv[0]",
            "\" ?returnCode?\\\"\"",
            "(char *) NULL"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <tcl/tcl.h>\n#include <tcl.h>\n#include \"kdb5_edit.h\"\n#include \"k5-int.h\"\n\nextern Tcl_Interp *interp;\nextern int exit_status;\n\nint doquit(clientData, interp, argc, argv)\n    ClientData clientData;\n    Tcl_Interp *interp;\n    int argc;\n    char *argv[];\n{\n    int value;\n\n    if ((argc != 1) && (argc != 2)) {\n\tTcl_AppendResult(interp, \"wrong # args: should be \\\"\", argv[0],\n\t\t\" ?returnCode?\\\"\", (char *) NULL);\n\treturn TCL_ERROR;\n    }\n    if (argc == 1) {\n\texit(quit() ? 1 : exit_status);\n    }\n    if (Tcl_GetInt(interp, argv[1], &value) != TCL_OK) {\n\treturn TCL_ERROR;\n    }\n    (void)quit();\n    exit(value);\n    /*NOTREACHED*/\n    return TCL_OK;\t\t\t/* Better not ever reach this! */\n}"
  }
]