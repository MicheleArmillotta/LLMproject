[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/ss_wrapper.c",
    "lines": "38-64",
    "snippet": "int main(argc, argv)\n    int argc;\n    char *argv[];\n{\n    char *request;\n    krb5_error_code retval;\n    int sci_idx, code = 0;\n\n    whoami = ((whoami = strrchr(argv[0], '/')) ? whoami+1 : argv[0]);\n\n    request = kadmin_startup(argc, argv);\n    sci_idx = ss_create_invocation(whoami, \"5.0\", (char *) NULL,\n\t\t\t\t   &kadmin_cmds, &retval);\n    if (retval) {\n\tss_perror(sci_idx, retval, \"creating invocation\");\n\texit(1);\n    }\n    if (request) {\n\t    code = ss_execute_line(sci_idx, request);\n\t    if (code != 0) {\n\t\t    ss_perror(sci_idx, code, request);\n\t\t    exit_status++;\n\t    }\n    } else\n            retval = ss_listen(sci_idx);\n    return quit() ? 1 : exit_status;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <ss/ss.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "extern ss_request_table kadmin_cmds;",
      "extern int exit_status;",
      "extern char *whoami;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "quit",
          "args": [],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "quit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "463-486",
          "snippet": "int quit()\n{\n    kadm5_ret_t retval;\n\n    if (locked) {\n\tretval = kadm5_unlock(handle);\n\tif (retval) {\n\t    com_err(\"quit\", retval, \"while unlocking locked database\");\n\t    return 1;\n\t}\n\tlocked = 0;\n    }\n\n     kadm5_destroy(handle);\n     if (ccache_name != NULL) {\n\t  fprintf(stderr,\n\t\t  \"\\n\\a\\a\\aAdministration credentials NOT DESTROYED.\\n\");\n     }\n\n     /* insert more random cleanup here */\n     krb5_klog_close(context);\n     krb5_free_context(context);\n     return 0;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void *handle = NULL;",
            "krb5_context context;",
            "char *ccache_name = NULL;",
            "int locked = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nkrb5_context context;\nchar *ccache_name = NULL;\nint locked = 0;\n\nint quit()\n{\n    kadm5_ret_t retval;\n\n    if (locked) {\n\tretval = kadm5_unlock(handle);\n\tif (retval) {\n\t    com_err(\"quit\", retval, \"while unlocking locked database\");\n\t    return 1;\n\t}\n\tlocked = 0;\n    }\n\n     kadm5_destroy(handle);\n     if (ccache_name != NULL) {\n\t  fprintf(stderr,\n\t\t  \"\\n\\a\\a\\aAdministration credentials NOT DESTROYED.\\n\");\n     }\n\n     /* insert more random cleanup here */\n     krb5_klog_close(context);\n     krb5_free_context(context);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ss_listen",
          "args": [
            "sci_idx"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ss_perror",
          "args": [
            "sci_idx",
            "code",
            "request"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ss_execute_line",
          "args": [
            "sci_idx",
            "request"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "request_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/ovsec_kadmd.c",
          "lines": "841-846",
          "snippet": "void request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}",
          "includes": [
            "#include    \"purify.h\"",
            "#include    \"misc.h\"",
            "#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */",
            "#include    <string.h>",
            "#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */",
            "#include    <krb5/adm_proto.h>",
            "#include    <kadm5/server_acl.h>",
            "#include    <kadm5/kadm_rpc.h>",
            "#include    <kadm5/admin.h>",
            "#include    <gssrpc/auth_gssapi.h>",
            "#include    \"gssapiP_krb5.h\" /* for kg_get_context */",
            "#include    <gssapi/gssapi.h>",
            "#include    <gssrpc/rpc.h>",
            "#include    <arpa/inet.h>  /* inet_ntoa */",
            "#include    <netinet/in.h>",
            "#include    <unistd.h>",
            "#include    <sys/socket.h>",
            "#include    <sys/time.h>",
            "#include    <sys/select.h>",
            "#include    <sys/types.h>",
            "#include    <syslog.h>",
            "#include    <signal.h>",
            "#include    <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "volatile int\tsignal_request_exit = 0;",
            "void\trequest_exit(int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include    \"purify.h\"\n#include    \"misc.h\"\n#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */\n#include    <string.h>\n#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */\n#include    <krb5/adm_proto.h>\n#include    <kadm5/server_acl.h>\n#include    <kadm5/kadm_rpc.h>\n#include    <kadm5/admin.h>\n#include    <gssrpc/auth_gssapi.h>\n#include    \"gssapiP_krb5.h\" /* for kg_get_context */\n#include    <gssapi/gssapi.h>\n#include    <gssrpc/rpc.h>\n#include    <arpa/inet.h>  /* inet_ntoa */\n#include    <netinet/in.h>\n#include    <unistd.h>\n#include    <sys/socket.h>\n#include    <sys/time.h>\n#include    <sys/select.h>\n#include    <sys/types.h>\n#include    <syslog.h>\n#include    <signal.h>\n#include    <stdio.h>\n\nvolatile int\tsignal_request_exit = 0;\nvoid\trequest_exit(int);\n\nvoid request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ss_perror",
          "args": [
            "sci_idx",
            "retval",
            "\"creating invocation\""
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ss_create_invocation",
          "args": [
            "whoami",
            "\"5.0\"",
            "(char *) NULL",
            "&kadmin_cmds",
            "&retval"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_startup",
          "args": [
            "argc",
            "argv"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "argv[0]",
            "'/'"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <string.h>\n#include <stdio.h>\n#include <ss/ss.h>\n#include <krb5.h>\n\nextern ss_request_table kadmin_cmds;\nextern int exit_status;\nextern char *whoami;\n\nint main(argc, argv)\n    int argc;\n    char *argv[];\n{\n    char *request;\n    krb5_error_code retval;\n    int sci_idx, code = 0;\n\n    whoami = ((whoami = strrchr(argv[0], '/')) ? whoami+1 : argv[0]);\n\n    request = kadmin_startup(argc, argv);\n    sci_idx = ss_create_invocation(whoami, \"5.0\", (char *) NULL,\n\t\t\t\t   &kadmin_cmds, &retval);\n    if (retval) {\n\tss_perror(sci_idx, retval, \"creating invocation\");\n\texit(1);\n    }\n    if (request) {\n\t    code = ss_execute_line(sci_idx, request);\n\t    if (code != 0) {\n\t\t    ss_perror(sci_idx, code, request);\n\t\t    exit_status++;\n\t    }\n    } else\n            retval = ss_listen(sci_idx);\n    return quit() ? 1 : exit_status;\n}"
  }
]