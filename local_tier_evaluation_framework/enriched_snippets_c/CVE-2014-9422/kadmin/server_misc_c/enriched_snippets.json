[
  {
    "function_name": "randkey_principal_wrapper_3",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/misc.c",
    "lines": "111-160",
    "snippet": "kadm5_ret_t\nrandkey_principal_wrapper_3(void *server_handle,\n\t\t\t    krb5_principal principal,\n\t\t\t    krb5_boolean keepold,\n\t\t\t    int n_ks_tuple,\n\t\t\t    krb5_key_salt_tuple *ks_tuple,\n\t\t\t    krb5_keyblock **keys, int *n_keys)\n{\n\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal, \n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != OSA_ADB_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    return kadm5_randkey_principal_3(server_handle, principal,\n\t\t\t\t     keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t     keys, n_keys);\n}",
    "includes": [
      "#include    \"misc.h\"",
      "#include    <krb5/kdb.h>",
      "#include    <kadm5/server_internal.h>",
      "#include    <kadm5/adb.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kadm5_randkey_principal_3",
          "args": [
            "server_handle",
            "principal",
            "keepold",
            "n_ks_tuple",
            "ks_tuple",
            "keys",
            "n_keys"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_policy_ent",
          "args": [
            "handle->lhandle",
            "&pol"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_policy_ent",
          "args": [
            "handle->lhandle",
            "&pol"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policy",
          "args": [
            "handle->lhandle",
            "princ.policy",
            "&pol"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_get_policy_v1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_glue_v1.c",
          "lines": "28-32",
          "snippet": "kadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <kadm5/admin.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <kadm5/admin.h>\n\nkadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal",
          "args": [
            "handle->lhandle",
            "principal",
            "&princ",
            "KADM5_PRINCIPAL_NORMAL_MASK"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_get_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2091-2163",
          "snippet": "static int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_timeofday",
          "args": [
            "handle->context",
            "&now"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include    \"misc.h\"\n#include    <krb5/kdb.h>\n#include    <kadm5/server_internal.h>\n#include    <kadm5/adb.h>\n\nkadm5_ret_t\nrandkey_principal_wrapper_3(void *server_handle,\n\t\t\t    krb5_principal principal,\n\t\t\t    krb5_boolean keepold,\n\t\t\t    int n_ks_tuple,\n\t\t\t    krb5_key_salt_tuple *ks_tuple,\n\t\t\t    krb5_keyblock **keys, int *n_keys)\n{\n\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal, \n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != OSA_ADB_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    return kadm5_randkey_principal_3(server_handle, principal,\n\t\t\t\t     keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t     keys, n_keys);\n}"
  },
  {
    "function_name": "chpass_principal_wrapper_3",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/misc.c",
    "lines": "36-85",
    "snippet": "kadm5_ret_t\nchpass_principal_wrapper_3(void *server_handle,\n\t\t\t   krb5_principal principal,\n\t\t\t   krb5_boolean keepold,\n\t\t\t   int n_ks_tuple,\n\t\t\t   krb5_key_salt_tuple *ks_tuple,\n\t\t\t   char *password)\n{\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal,\n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != KADM5_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    \n    return kadm5_chpass_principal_3(server_handle, principal,\n\t\t\t\t    keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t    password);\n}",
    "includes": [
      "#include    \"misc.h\"",
      "#include    <krb5/kdb.h>",
      "#include    <kadm5/server_internal.h>",
      "#include    <kadm5/adb.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kadm5_chpass_principal_3",
          "args": [
            "server_handle",
            "principal",
            "keepold",
            "n_ks_tuple",
            "ks_tuple",
            "password"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_policy_ent",
          "args": [
            "handle->lhandle",
            "&pol"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_policy_ent",
          "args": [
            "handle->lhandle",
            "&pol"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&princ"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policy",
          "args": [
            "handle->lhandle",
            "princ.policy",
            "&pol"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_get_policy_v1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_glue_v1.c",
          "lines": "28-32",
          "snippet": "kadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <kadm5/admin.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <kadm5/admin.h>\n\nkadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal",
          "args": [
            "handle->lhandle",
            "principal",
            "&princ",
            "KADM5_PRINCIPAL_NORMAL_MASK"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_get_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2091-2163",
          "snippet": "static int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_timeofday",
          "args": [
            "handle->context",
            "&now"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include    \"misc.h\"\n#include    <krb5/kdb.h>\n#include    <kadm5/server_internal.h>\n#include    <kadm5/adb.h>\n\nkadm5_ret_t\nchpass_principal_wrapper_3(void *server_handle,\n\t\t\t   krb5_principal principal,\n\t\t\t   krb5_boolean keepold,\n\t\t\t   int n_ks_tuple,\n\t\t\t   krb5_key_salt_tuple *ks_tuple,\n\t\t\t   char *password)\n{\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal,\n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != KADM5_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    \n    return kadm5_chpass_principal_3(server_handle, principal,\n\t\t\t\t    keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t    password);\n}"
  }
]