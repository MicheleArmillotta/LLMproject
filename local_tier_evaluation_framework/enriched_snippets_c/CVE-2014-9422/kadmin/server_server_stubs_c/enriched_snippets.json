[
  {
    "function_name": "rqst2name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1483-1491",
    "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
  },
  {
    "function_name": "init_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1446-1481",
    "snippet": "generic_ret *init_1_svc(krb5_ui_4 *arg, struct svc_req *rqstp)\n{\n     static generic_ret\t\tret;\n     gss_buffer_desc\t\tclient_name,\n\t \t\t\tservice_name;\n     kadm5_server_handle_t\thandle;\n     OM_uint32\t\t\tminor_stat;\n\n     xdr_free(xdr_generic_ret, &ret);\n\n     if ((ret.code = new_server_handle(*arg, rqstp, &handle)))\n\t  return &ret;\n     if (! (ret.code = check_handle((void *)handle))) {\n\t ret.api_version = handle->api_version;\n     }\n\n     free_server_handle(handle);\n\n     if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t  ret.code = KADM5_FAILURE;\n\t  return &ret;\n     }\n\n     krb5_klog_syslog(LOG_NOTICE, LOG_DONE \", flavor=%d\",\n\t    (ret.api_version == KADM5_API_VERSION_1 ?\n\t     \"kadm5_init (V1)\" : \"kadm5_init\"),\n\t    client_name.value,\n\t    (ret.code == 0) ? \"success\" : error_message(ret.code),\n\t    client_name.value, service_name.value,\n\t    inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr),\n\t    rqstp->rq_cred.oa_flavor);\n     gss_release_buffer(&minor_stat, &client_name);\n     gss_release_buffer(&minor_stat, &service_name);\n\t    \n     return(&ret);\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE \", flavor=%d\"",
            "(ret.api_version == KADM5_API_VERSION_1 ?\n\t     \"kadm5_init (V1)\" : \"kadm5_init\")",
            "client_name.value",
            "(ret.code == 0) ? \"success\" : error_message(ret.code)",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)",
            "rqstp->rq_cred.oa_flavor"
          ],
          "line": 1469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1464
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1462
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1458
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "*arg",
            "rqstp",
            "&handle"
          ],
          "line": 1456
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *init_1_svc(krb5_ui_4 *arg, struct svc_req *rqstp)\n{\n     static generic_ret\t\tret;\n     gss_buffer_desc\t\tclient_name,\n\t \t\t\tservice_name;\n     kadm5_server_handle_t\thandle;\n     OM_uint32\t\t\tminor_stat;\n\n     xdr_free(xdr_generic_ret, &ret);\n\n     if ((ret.code = new_server_handle(*arg, rqstp, &handle)))\n\t  return &ret;\n     if (! (ret.code = check_handle((void *)handle))) {\n\t ret.api_version = handle->api_version;\n     }\n\n     free_server_handle(handle);\n\n     if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t  ret.code = KADM5_FAILURE;\n\t  return &ret;\n     }\n\n     krb5_klog_syslog(LOG_NOTICE, LOG_DONE \", flavor=%d\",\n\t    (ret.api_version == KADM5_API_VERSION_1 ?\n\t     \"kadm5_init (V1)\" : \"kadm5_init\"),\n\t    client_name.value,\n\t    (ret.code == 0) ? \"success\" : error_message(ret.code),\n\t    client_name.value, service_name.value,\n\t    inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr),\n\t    rqstp->rq_cred.oa_flavor);\n     gss_release_buffer(&minor_stat, &client_name);\n     gss_release_buffer(&minor_stat, &service_name);\n\t    \n     return(&ret);\n}"
  },
  {
    "function_name": "get_privs_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1410-1444",
    "snippet": "getprivs_ret * get_privs_1_svc(krb5_ui_4 *arg, struct svc_req *rqstp)\n{\n     static getprivs_ret\t    ret;\n     gss_buffer_desc\t\t    client_name, service_name;\n     OM_uint32\t\t\t    minor_stat;\n     kadm5_server_handle_t\t    handle;\n\n     xdr_free(xdr_getprivs_ret, &ret);\n\n     if ((ret.code = new_server_handle(*arg, rqstp, &handle)))\n\t  return &ret;\n\n     if ((ret.code = check_handle((void *)handle))) {\n\t  free_server_handle(handle);\n\t  return &ret;\n     }\n\n     ret.api_version = handle->api_version;\n\n     if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t  ret.code = KADM5_FAILURE;\n\t  return &ret;\n     }\n\n     ret.code = kadm5_get_privs((void *)handle, &ret.privs);\n     krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_get_privs\",\n\t    client_name.value, \n\t    ((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t    client_name.value, service_name.value,\n\t    inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n     free_server_handle(handle);\n     gss_release_buffer(&minor_stat, &client_name);\n     gss_release_buffer(&minor_stat, &service_name);\n     return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1440
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_get_privs\"",
            "client_name.value",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_privs",
          "args": [
            "(void *)handle",
            "&ret.privs"
          ],
          "line": 1434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1429
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1422
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "*arg",
            "rqstp",
            "&handle"
          ],
          "line": 1419
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_getprivs_ret",
            "&ret"
          ],
          "line": 1417
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngetprivs_ret * get_privs_1_svc(krb5_ui_4 *arg, struct svc_req *rqstp)\n{\n     static getprivs_ret\t    ret;\n     gss_buffer_desc\t\t    client_name, service_name;\n     OM_uint32\t\t\t    minor_stat;\n     kadm5_server_handle_t\t    handle;\n\n     xdr_free(xdr_getprivs_ret, &ret);\n\n     if ((ret.code = new_server_handle(*arg, rqstp, &handle)))\n\t  return &ret;\n\n     if ((ret.code = check_handle((void *)handle))) {\n\t  free_server_handle(handle);\n\t  return &ret;\n     }\n\n     ret.api_version = handle->api_version;\n\n     if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t  ret.code = KADM5_FAILURE;\n\t  return &ret;\n     }\n\n     ret.code = kadm5_get_privs((void *)handle, &ret.privs);\n     krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_get_privs\",\n\t    client_name.value, \n\t    ((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t    client_name.value, service_name.value,\n\t    inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n     free_server_handle(handle);\n     gss_release_buffer(&minor_stat, &client_name);\n     gss_release_buffer(&minor_stat, &service_name);\n     return &ret;\n}"
  },
  {
    "function_name": "get_pols_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1357-1408",
    "snippet": "gpols_ret *\nget_pols_1_svc(gpols_arg *arg, struct svc_req *rqstp)\n{\n    static gpols_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_gpols_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->exp;\n    if (prime_arg == NULL)\n\t prime_arg = \"*\";\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_LIST, NULL, NULL)) {\n\t ret.code = KADM5_AUTH_LIST;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_get_policies\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code  = kadm5_get_policies((void *)handle,\n\t\t\t\t\t       arg->exp, &ret.pols,\n\t\t\t\t\t       &ret.count);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_get_policies\",\n\t\tprime_arg,  \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1404
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_get_policies\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policies",
          "args": [
            "(void *)handle",
            "arg->exp",
            "&ret.pols",
            "&ret.count"
          ],
          "line": 1395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_get_policies\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_LIST",
            "NULL",
            "NULL"
          ],
          "line": 1387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1388
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1379
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1372
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 1369
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_gpols_ret",
            "&ret"
          ],
          "line": 1367
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngpols_ret *\nget_pols_1_svc(gpols_arg *arg, struct svc_req *rqstp)\n{\n    static gpols_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_gpols_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->exp;\n    if (prime_arg == NULL)\n\t prime_arg = \"*\";\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_LIST, NULL, NULL)) {\n\t ret.code = KADM5_AUTH_LIST;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_get_policies\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code  = kadm5_get_policies((void *)handle,\n\t\t\t\t\t       arg->exp, &ret.pols,\n\t\t\t\t\t       &ret.count);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_get_policies\",\n\t\tprime_arg,  \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "get_policy_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1273-1355",
    "snippet": "gpol_ret * \nget_policy_1_svc(gpol_arg *arg, struct svc_req *rqstp)\n{\n    static gpol_ret\t\tret;\n    kadm5_ret_t\t\tret2;\n    char\t\t\t*prime_arg, *funcname;\n    gss_buffer_desc\t\tclient_name,\n\t\t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;    \n    kadm5_policy_ent_t\te;\n    kadm5_principal_ent_rec\tcaller_ent;\n    kadm5_server_handle_t\thandle;\n\n    xdr_free(xdr_gpol_ret,  &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_get_policy (V1)\" : \"kadm5_get_policy\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->name;\n\n    ret.code = KADM5_AUTH_GET;\n    if (!CHANGEPW_SERVICE(rqstp) && acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_INQUIRE, NULL, NULL))\n\t ret.code = KADM5_OK;\n    else {\n\t ret.code = kadm5_get_principal(handle->lhandle,\n\t\t\t\t\thandle->current_caller,\n\t\t\t\t\t&caller_ent,\n\t\t\t\t\tKADM5_PRINCIPAL_NORMAL_MASK);\n\t if (ret.code == KADM5_OK) {\n\t      if (caller_ent.aux_attributes & KADM5_POLICY &&\n\t\t  strcmp(caller_ent.policy, arg->name) == 0) {\n\t\t   ret.code = KADM5_OK;\n\t      } else ret.code = KADM5_AUTH_GET;\n\t      ret2 = kadm5_free_principal_ent(handle->lhandle,\n\t\t\t\t\t      &caller_ent);\n\t      ret.code = ret.code ? ret.code : ret2;\n\t }\n    }\n    \n    if (ret.code == KADM5_OK) {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      ret.code  = kadm5_get_policy_v1((void *)handle, arg->name, &e);\n\t      if(ret.code == KADM5_OK) {\n\t\t   memcpy(&ret.rec, e, sizeof(kadm5_policy_ent_rec));\n\t\t   free(e);\n\t      }\n\t } else {\n\t      ret.code = kadm5_get_policy((void *)handle, arg->name,\n\t\t\t\t\t  &ret.rec);\n\t }\n\t \n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t \n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1350
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "funcname",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "funcname",
            "((prime_arg == NULL) ? \"(null)\" : prime_arg)",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policy",
          "args": [
            "(void *)handle",
            "arg->name",
            "&ret.rec"
          ],
          "line": 1336
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_get_policy_v1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_glue_v1.c",
          "lines": "28-32",
          "snippet": "kadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <kadm5/admin.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <kadm5/admin.h>\n\nkadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&ret.rec",
            "e",
            "sizeof(kadm5_policy_ent_rec)"
          ],
          "line": 1332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle->lhandle",
            "&caller_ent"
          ],
          "line": 1322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "caller_ent.policy",
            "arg->name"
          ],
          "line": 1319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal",
          "args": [
            "handle->lhandle",
            "handle->current_caller",
            "&caller_ent",
            "KADM5_PRINCIPAL_NORMAL_MASK"
          ],
          "line": 1313
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_get_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2091-2163",
          "snippet": "static int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_INQUIRE",
            "NULL",
            "NULL"
          ],
          "line": 1308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1309
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1301
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1291
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 1288
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_gpol_ret",
            "&ret"
          ],
          "line": 1286
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngpol_ret * \nget_policy_1_svc(gpol_arg *arg, struct svc_req *rqstp)\n{\n    static gpol_ret\t\tret;\n    kadm5_ret_t\t\tret2;\n    char\t\t\t*prime_arg, *funcname;\n    gss_buffer_desc\t\tclient_name,\n\t\t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;    \n    kadm5_policy_ent_t\te;\n    kadm5_principal_ent_rec\tcaller_ent;\n    kadm5_server_handle_t\thandle;\n\n    xdr_free(xdr_gpol_ret,  &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_get_policy (V1)\" : \"kadm5_get_policy\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->name;\n\n    ret.code = KADM5_AUTH_GET;\n    if (!CHANGEPW_SERVICE(rqstp) && acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_INQUIRE, NULL, NULL))\n\t ret.code = KADM5_OK;\n    else {\n\t ret.code = kadm5_get_principal(handle->lhandle,\n\t\t\t\t\thandle->current_caller,\n\t\t\t\t\t&caller_ent,\n\t\t\t\t\tKADM5_PRINCIPAL_NORMAL_MASK);\n\t if (ret.code == KADM5_OK) {\n\t      if (caller_ent.aux_attributes & KADM5_POLICY &&\n\t\t  strcmp(caller_ent.policy, arg->name) == 0) {\n\t\t   ret.code = KADM5_OK;\n\t      } else ret.code = KADM5_AUTH_GET;\n\t      ret2 = kadm5_free_principal_ent(handle->lhandle,\n\t\t\t\t\t      &caller_ent);\n\t      ret.code = ret.code ? ret.code : ret2;\n\t }\n    }\n    \n    if (ret.code == KADM5_OK) {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      ret.code  = kadm5_get_policy_v1((void *)handle, arg->name, &e);\n\t      if(ret.code == KADM5_OK) {\n\t\t   memcpy(&ret.rec, e, sizeof(kadm5_policy_ent_rec));\n\t\t   free(e);\n\t      }\n\t } else {\n\t      ret.code = kadm5_get_policy((void *)handle, arg->name,\n\t\t\t\t\t  &ret.rec);\n\t }\n\t \n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t \n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n\n}"
  },
  {
    "function_name": "modify_policy_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1223-1271",
    "snippet": "generic_ret *\nmodify_policy_1_svc(mpol_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;    \n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->rec.policy;\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_MODIFY, NULL, NULL)) {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_modify_policy\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_MODIFY;\n    } else {\n\t ret.code = kadm5_modify_policy((void *)handle, &arg->rec,\n\t\t\t\t\t     arg->mask);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_modify_policy\",\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\t    \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1267
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_modify_policy\"",
            "((prime_arg == NULL) ? \"(null)\" : prime_arg)",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_modify_policy",
          "args": [
            "(void *)handle",
            "&arg->rec",
            "arg->mask"
          ],
          "line": 1259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_modify_policy\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_MODIFY",
            "NULL",
            "NULL"
          ],
          "line": 1251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1252
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1245
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1238
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 1235
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 1233
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nmodify_policy_1_svc(mpol_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;    \n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->rec.policy;\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_MODIFY, NULL, NULL)) {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_modify_policy\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_MODIFY;\n    } else {\n\t ret.code = kadm5_modify_policy((void *)handle, &arg->rec,\n\t\t\t\t\t     arg->mask);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_modify_policy\",\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\t    \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "delete_policy_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1174-1221",
    "snippet": "generic_ret *\ndelete_policy_1_svc(dpol_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;    \n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->name;\n    \n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_DELETE, NULL, NULL)) {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_delete_policy\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_DELETE;\n    } else {\n\t ret.code = kadm5_delete_policy((void *)handle, arg->name);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_delete_policy\",\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t \n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1217
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_delete_policy\"",
            "((prime_arg == NULL) ? \"(null)\" : prime_arg)",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_delete_policy",
          "args": [
            "(void *)handle",
            "arg->name"
          ],
          "line": 1210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_delete_policy\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_DELETE",
            "NULL",
            "NULL"
          ],
          "line": 1202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1203
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1196
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1189
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 1184
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\ndelete_policy_1_svc(dpol_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;    \n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->name;\n    \n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_DELETE, NULL, NULL)) {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_delete_policy\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_DELETE;\n    } else {\n\t ret.code = kadm5_delete_policy((void *)handle, arg->name);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_delete_policy\",\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t \n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "create_policy_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1123-1172",
    "snippet": "generic_ret *\ncreate_policy_1_svc(cpol_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;    \n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->rec.policy;\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_ADD, NULL, NULL)) {\n\t ret.code = KADM5_AUTH_ADD;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_create_policy\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t \n    } else {\n\t ret.code = kadm5_create_policy((void *)handle, &arg->rec,\n\t\t\t\t\t     arg->mask);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_create_policy\",\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t \n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 1168
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_create_policy\"",
            "((prime_arg == NULL) ? \"(null)\" : prime_arg)",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_policy",
          "args": [
            "(void *)handle",
            "&arg->rec",
            "arg->mask"
          ],
          "line": 1160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_create_policy\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_ADD",
            "NULL",
            "NULL"
          ],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1152
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1145
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1138
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 1135
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 1133
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\ncreate_policy_1_svc(cpol_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;    \n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->rec.policy;\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_ADD, NULL, NULL)) {\n\t ret.code = KADM5_AUTH_ADD;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_create_policy\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t \n    } else {\n\t ret.code = kadm5_create_policy((void *)handle, &arg->rec,\n\t\t\t\t\t     arg->mask);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_create_policy\",\n\t\t((prime_arg == NULL) ? \"(null)\" : prime_arg),\n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\t \n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "chrand_principal3_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "1041-1121",
    "snippet": "chrand_ret *\nchrand_principal3_1_svc(chrand3_arg *arg, struct svc_req *rqstp)\n{\n    static chrand_ret\t\tret;\n    krb5_keyblock\t\t*k;\n    int\t\t\t\tnkeys;\n    char\t\t\t*prime_arg, *funcname;\n    gss_buffer_desc\t\tclient_name,\n\t    \t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n\n    xdr_free(xdr_chrand_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_randkey_principal (V1)\" : \"kadm5_randkey_principal\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t free_server_handle(handle);\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = randkey_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t\targ->keepold,\n\t\t\t\t\t\targ->n_ks_tuple,\n\t\t\t\t\t\targ->ks_tuple,\n\t\t\t\t\t\t&k, &nkeys);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_randkey_principal_3((void *)handle, arg->princ,\n\t\t\t\t\t      arg->keepold,\n\t\t\t\t\t      arg->n_ks_tuple,\n\t\t\t\t\t      arg->ks_tuple,\n\t\t\t\t\t      &k, &nkeys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code == KADM5_OK) {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      krb5_copy_keyblock_contents(handle->context, k, &ret.key);\n\t      krb5_free_keyblock(handle->context, k);\n\t } else {\n\t      ret.keys = k;\n\t      ret.n_keys = nkeys;\n\t }\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 1117
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "funcname",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_keyblock",
          "args": [
            "handle->context",
            "k"
          ],
          "line": 1102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_copy_keyblock_contents",
          "args": [
            "handle->context",
            "k",
            "&ret.key"
          ],
          "line": 1101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "funcname",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1095
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keepold",
            "arg->n_ks_tuple",
            "arg->ks_tuple",
            "&k",
            "&nkeys"
          ],
          "line": 1087
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_CHANGEPW",
            "arg->princ",
            "NULL"
          ],
          "line": 1085
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1085
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "randkey_principal_wrapper_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keepold",
            "arg->n_ks_tuple",
            "arg->ks_tuple",
            "&k",
            "&nkeys"
          ],
          "line": 1079
        },
        "resolved": true,
        "details": {
          "function_name": "randkey_principal_wrapper_3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/misc.c",
          "lines": "111-160",
          "snippet": "kadm5_ret_t\nrandkey_principal_wrapper_3(void *server_handle,\n\t\t\t    krb5_principal principal,\n\t\t\t    krb5_boolean keepold,\n\t\t\t    int n_ks_tuple,\n\t\t\t    krb5_key_salt_tuple *ks_tuple,\n\t\t\t    krb5_keyblock **keys, int *n_keys)\n{\n\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal, \n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != OSA_ADB_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    return kadm5_randkey_principal_3(server_handle, principal,\n\t\t\t\t     keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t     keys, n_keys);\n}",
          "includes": [
            "#include    \"misc.h\"",
            "#include    <krb5/kdb.h>",
            "#include    <kadm5/server_internal.h>",
            "#include    <kadm5/adb.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include    \"misc.h\"\n#include    <krb5/kdb.h>\n#include    <kadm5/server_internal.h>\n#include    <kadm5/adb.h>\n\nkadm5_ret_t\nrandkey_principal_wrapper_3(void *server_handle,\n\t\t\t    krb5_principal principal,\n\t\t\t    krb5_boolean keepold,\n\t\t\t    int n_ks_tuple,\n\t\t\t    krb5_key_salt_tuple *ks_tuple,\n\t\t\t    krb5_keyblock **keys, int *n_keys)\n{\n\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal, \n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != OSA_ADB_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    return kadm5_randkey_principal_3(server_handle, principal,\n\t\t\t\t     keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t     keys, n_keys);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmp_gss_krb5_name",
          "args": [
            "handle",
            "rqst2name(rqstp)",
            "arg->princ"
          ],
          "line": 1078
        },
        "resolved": true,
        "details": {
          "function_name": "cmp_gss_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "199-210",
          "snippet": "static int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 1068
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 1058
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 1055
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_chrand_ret",
            "&ret"
          ],
          "line": 1053
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nchrand_ret *\nchrand_principal3_1_svc(chrand3_arg *arg, struct svc_req *rqstp)\n{\n    static chrand_ret\t\tret;\n    krb5_keyblock\t\t*k;\n    int\t\t\t\tnkeys;\n    char\t\t\t*prime_arg, *funcname;\n    gss_buffer_desc\t\tclient_name,\n\t    \t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n\n    xdr_free(xdr_chrand_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_randkey_principal (V1)\" : \"kadm5_randkey_principal\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t free_server_handle(handle);\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = randkey_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t\targ->keepold,\n\t\t\t\t\t\targ->n_ks_tuple,\n\t\t\t\t\t\targ->ks_tuple,\n\t\t\t\t\t\t&k, &nkeys);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_randkey_principal_3((void *)handle, arg->princ,\n\t\t\t\t\t      arg->keepold,\n\t\t\t\t\t      arg->n_ks_tuple,\n\t\t\t\t\t      arg->ks_tuple,\n\t\t\t\t\t      &k, &nkeys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code == KADM5_OK) {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      krb5_copy_keyblock_contents(handle->context, k, &ret.key);\n\t      krb5_free_keyblock(handle->context, k);\n\t } else {\n\t      ret.keys = k;\n\t      ret.n_keys = nkeys;\n\t }\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "chrand_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "965-1039",
    "snippet": "chrand_ret *\nchrand_principal_1_svc(chrand_arg *arg, struct svc_req *rqstp)\n{\n    static chrand_ret\t\tret;\n    krb5_keyblock\t\t*k;\n    int\t\t\t\tnkeys;\n    char\t\t\t*prime_arg, *funcname;\n    gss_buffer_desc\t\tclient_name,\n\t    \t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n\n    xdr_free(xdr_chrand_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_randkey_principal (V1)\" : \"kadm5_randkey_principal\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t free_server_handle(handle);\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = randkey_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t\tFALSE, 0, NULL, &k, &nkeys);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_randkey_principal((void *)handle, arg->princ,\n\t\t\t\t\t    &k, &nkeys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code == KADM5_OK) {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      krb5_copy_keyblock_contents(handle->context, k, &ret.key);\n\t      krb5_free_keyblock(handle->context, k);\n\t } else {\n\t      ret.keys = k;\n\t      ret.n_keys = nkeys;\n\t }\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 1037
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 1036
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 1035
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "funcname",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1032
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 1030
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_keyblock",
          "args": [
            "handle->context",
            "k"
          ],
          "line": 1020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_copy_keyblock_contents",
          "args": [
            "handle->context",
            "k",
            "&ret.key"
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "funcname",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 1011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 1013
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal",
          "args": [
            "(void *)handle",
            "arg->princ",
            "&k",
            "&nkeys"
          ],
          "line": 1008
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_randkey_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2017-2087",
          "snippet": "static int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_CHANGEPW",
            "arg->princ",
            "NULL"
          ],
          "line": 1006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 1006
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 1005
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "randkey_principal_wrapper_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "FALSE",
            "0",
            "NULL",
            "&k",
            "&nkeys"
          ],
          "line": 1003
        },
        "resolved": true,
        "details": {
          "function_name": "randkey_principal_wrapper_3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/misc.c",
          "lines": "111-160",
          "snippet": "kadm5_ret_t\nrandkey_principal_wrapper_3(void *server_handle,\n\t\t\t    krb5_principal principal,\n\t\t\t    krb5_boolean keepold,\n\t\t\t    int n_ks_tuple,\n\t\t\t    krb5_key_salt_tuple *ks_tuple,\n\t\t\t    krb5_keyblock **keys, int *n_keys)\n{\n\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal, \n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != OSA_ADB_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    return kadm5_randkey_principal_3(server_handle, principal,\n\t\t\t\t     keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t     keys, n_keys);\n}",
          "includes": [
            "#include    \"misc.h\"",
            "#include    <krb5/kdb.h>",
            "#include    <kadm5/server_internal.h>",
            "#include    <kadm5/adb.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include    \"misc.h\"\n#include    <krb5/kdb.h>\n#include    <kadm5/server_internal.h>\n#include    <kadm5/adb.h>\n\nkadm5_ret_t\nrandkey_principal_wrapper_3(void *server_handle,\n\t\t\t    krb5_principal principal,\n\t\t\t    krb5_boolean keepold,\n\t\t\t    int n_ks_tuple,\n\t\t\t    krb5_key_salt_tuple *ks_tuple,\n\t\t\t    krb5_keyblock **keys, int *n_keys)\n{\n\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal, \n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != OSA_ADB_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    return kadm5_randkey_principal_3(server_handle, principal,\n\t\t\t\t     keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t     keys, n_keys);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmp_gss_krb5_name",
          "args": [
            "handle",
            "rqst2name(rqstp)",
            "arg->princ"
          ],
          "line": 1002
        },
        "resolved": true,
        "details": {
          "function_name": "cmp_gss_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "199-210",
          "snippet": "static int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 992
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 982
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_chrand_ret",
            "&ret"
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nchrand_ret *\nchrand_principal_1_svc(chrand_arg *arg, struct svc_req *rqstp)\n{\n    static chrand_ret\t\tret;\n    krb5_keyblock\t\t*k;\n    int\t\t\t\tnkeys;\n    char\t\t\t*prime_arg, *funcname;\n    gss_buffer_desc\t\tclient_name,\n\t    \t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n\n    xdr_free(xdr_chrand_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_randkey_principal (V1)\" : \"kadm5_randkey_principal\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t free_server_handle(handle);\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = randkey_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t\tFALSE, 0, NULL, &k, &nkeys);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_randkey_principal((void *)handle, arg->princ,\n\t\t\t\t\t    &k, &nkeys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code == KADM5_OK) {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      krb5_copy_keyblock_contents(handle->context, k, &ret.key);\n\t      krb5_free_keyblock(handle->context, k);\n\t } else {\n\t      ret.keys = k;\n\t      ret.n_keys = nkeys;\n\t }\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "setkey_principal3_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "904-963",
    "snippet": "generic_ret *\nsetkey_principal3_1_svc(setkey3_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_SETKEY, arg->princ, NULL)) {\n\t ret.code = kadm5_setkey_principal_3((void *)handle, arg->princ,\n\t\t\t\t\t     arg->keepold,\n\t\t\t\t\t     arg->n_ks_tuple,\n\t\t\t\t\t     arg->ks_tuple,\n\t\t\t\t\t     arg->keyblocks, arg->n_keys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_setkey_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_SETKEY;\n    }\n\n    if(ret.code != KADM5_AUTH_SETKEY) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_setkey_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 959
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_setkey_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 951
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 955
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 953
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_setkey_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_setkey_principal_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keepold",
            "arg->n_ks_tuple",
            "arg->ks_tuple",
            "arg->keyblocks",
            "arg->n_keys"
          ],
          "line": 938
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_SETKEY",
            "arg->princ",
            "NULL"
          ],
          "line": 936
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 926
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 919
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 916
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nsetkey_principal3_1_svc(setkey3_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_SETKEY, arg->princ, NULL)) {\n\t ret.code = kadm5_setkey_principal_3((void *)handle, arg->princ,\n\t\t\t\t\t     arg->keepold,\n\t\t\t\t\t     arg->n_ks_tuple,\n\t\t\t\t\t     arg->ks_tuple,\n\t\t\t\t\t     arg->keyblocks, arg->n_keys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_setkey_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_SETKEY;\n    }\n\n    if(ret.code != KADM5_AUTH_SETKEY) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_setkey_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "setkey_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "846-902",
    "snippet": "generic_ret *\nsetkey_principal_1_svc(setkey_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_SETKEY, arg->princ, NULL)) {\n\t ret.code = kadm5_setkey_principal((void *)handle, arg->princ,\n\t\t\t\t\t   arg->keyblocks, arg->n_keys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_setkey_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_SETKEY;\n    }\n\n    if(ret.code != KADM5_AUTH_SETKEY) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_setkey_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 900
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 898
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_setkey_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 890
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 894
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 892
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_setkey_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_setkey_principal",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keyblocks",
            "arg->n_keys"
          ],
          "line": 880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_SETKEY",
            "arg->princ",
            "NULL"
          ],
          "line": 878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 878
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 877
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 861
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 858
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 856
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nsetkey_principal_1_svc(setkey_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_SETKEY, arg->princ, NULL)) {\n\t ret.code = kadm5_setkey_principal((void *)handle, arg->princ,\n\t\t\t\t\t   arg->keyblocks, arg->n_keys);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_setkey_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_SETKEY;\n    }\n\n    if(ret.code != KADM5_AUTH_SETKEY) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_setkey_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "setv4key_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "788-844",
    "snippet": "generic_ret *\nsetv4key_principal_1_svc(setv4key_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_SETKEY, arg->princ, NULL)) {\n\t ret.code = kadm5_setv4key_principal((void *)handle, arg->princ,\n\t\t\t\t\t     arg->keyblock);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_setv4key_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_SETKEY;\n    }\n\n    if(ret.code != KADM5_AUTH_SETKEY) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_setv4key_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 842
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 840
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_setv4key_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 836
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_setv4key_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_setv4key_principal",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keyblock"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_SETKEY",
            "arg->princ",
            "NULL"
          ],
          "line": 820
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 820
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 819
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 810
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 803
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 800
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 798
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nsetv4key_principal_1_svc(setv4key_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_SETKEY, arg->princ, NULL)) {\n\t ret.code = kadm5_setv4key_principal((void *)handle, arg->princ,\n\t\t\t\t\t     arg->keyblock);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_setv4key_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_SETKEY;\n    }\n\n    if(ret.code != KADM5_AUTH_SETKEY) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_setv4key_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "chpass_principal3_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "721-786",
    "snippet": "generic_ret *\nchpass_principal3_1_svc(chpass3_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = chpass_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t       arg->keepold,\n\t\t\t\t\t       arg->n_ks_tuple,\n\t\t\t\t\t       arg->ks_tuple,\n\t\t\t\t\t       arg->pass);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_chpass_principal_3((void *)handle, arg->princ,\n\t\t\t\t\t     arg->keepold,\n\t\t\t\t\t     arg->n_ks_tuple,\n\t\t\t\t\t     arg->ks_tuple,\n\t\t\t\t\t     arg->pass);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_chpass_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_chpass_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 782
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_chpass_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_chpass_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 769
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_chpass_principal_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keepold",
            "arg->n_ks_tuple",
            "arg->ks_tuple",
            "arg->pass"
          ],
          "line": 761
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_CHANGEPW",
            "arg->princ",
            "NULL"
          ],
          "line": 759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chpass_principal_wrapper_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->keepold",
            "arg->n_ks_tuple",
            "arg->ks_tuple",
            "arg->pass"
          ],
          "line": 753
        },
        "resolved": true,
        "details": {
          "function_name": "chpass_principal_wrapper_3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/misc.c",
          "lines": "36-85",
          "snippet": "kadm5_ret_t\nchpass_principal_wrapper_3(void *server_handle,\n\t\t\t   krb5_principal principal,\n\t\t\t   krb5_boolean keepold,\n\t\t\t   int n_ks_tuple,\n\t\t\t   krb5_key_salt_tuple *ks_tuple,\n\t\t\t   char *password)\n{\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal,\n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != KADM5_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    \n    return kadm5_chpass_principal_3(server_handle, principal,\n\t\t\t\t    keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t    password);\n}",
          "includes": [
            "#include    \"misc.h\"",
            "#include    <krb5/kdb.h>",
            "#include    <kadm5/server_internal.h>",
            "#include    <kadm5/adb.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include    \"misc.h\"\n#include    <krb5/kdb.h>\n#include    <kadm5/server_internal.h>\n#include    <kadm5/adb.h>\n\nkadm5_ret_t\nchpass_principal_wrapper_3(void *server_handle,\n\t\t\t   krb5_principal principal,\n\t\t\t   krb5_boolean keepold,\n\t\t\t   int n_ks_tuple,\n\t\t\t   krb5_key_salt_tuple *ks_tuple,\n\t\t\t   char *password)\n{\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal,\n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != KADM5_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    \n    return kadm5_chpass_principal_3(server_handle, principal,\n\t\t\t\t    keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t    password);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmp_gss_krb5_name",
          "args": [
            "handle",
            "rqst2name(rqstp)",
            "arg->princ"
          ],
          "line": 752
        },
        "resolved": true,
        "details": {
          "function_name": "cmp_gss_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "199-210",
          "snippet": "static int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 743
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 736
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 733
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 731
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nchpass_principal3_1_svc(chpass3_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = chpass_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t       arg->keepold,\n\t\t\t\t\t       arg->n_ks_tuple,\n\t\t\t\t\t       arg->ks_tuple,\n\t\t\t\t\t       arg->pass);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_chpass_principal_3((void *)handle, arg->princ,\n\t\t\t\t\t     arg->keepold,\n\t\t\t\t\t     arg->n_ks_tuple,\n\t\t\t\t\t     arg->ks_tuple,\n\t\t\t\t\t     arg->pass);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_chpass_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_chpass_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "chpass_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "660-719",
    "snippet": "generic_ret *\nchpass_principal_1_svc(chpass_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = chpass_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t       FALSE, 0, NULL, arg->pass);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_chpass_principal((void *)handle, arg->princ,\n\t\t\t\t\t\targ->pass);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_chpass_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_chpass_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_chpass_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_chpass_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_chpass_principal",
          "args": [
            "(void *)handle",
            "arg->princ",
            "arg->pass"
          ],
          "line": 697
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_CHANGEPW",
            "arg->princ",
            "NULL"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 695
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chpass_principal_wrapper_3",
          "args": [
            "(void *)handle",
            "arg->princ",
            "FALSE",
            "0",
            "NULL",
            "arg->pass"
          ],
          "line": 692
        },
        "resolved": true,
        "details": {
          "function_name": "chpass_principal_wrapper_3",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/misc.c",
          "lines": "36-85",
          "snippet": "kadm5_ret_t\nchpass_principal_wrapper_3(void *server_handle,\n\t\t\t   krb5_principal principal,\n\t\t\t   krb5_boolean keepold,\n\t\t\t   int n_ks_tuple,\n\t\t\t   krb5_key_salt_tuple *ks_tuple,\n\t\t\t   char *password)\n{\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal,\n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != KADM5_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    \n    return kadm5_chpass_principal_3(server_handle, principal,\n\t\t\t\t    keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t    password);\n}",
          "includes": [
            "#include    \"misc.h\"",
            "#include    <krb5/kdb.h>",
            "#include    <kadm5/server_internal.h>",
            "#include    <kadm5/adb.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include    \"misc.h\"\n#include    <krb5/kdb.h>\n#include    <kadm5/server_internal.h>\n#include    <kadm5/adb.h>\n\nkadm5_ret_t\nchpass_principal_wrapper_3(void *server_handle,\n\t\t\t   krb5_principal principal,\n\t\t\t   krb5_boolean keepold,\n\t\t\t   int n_ks_tuple,\n\t\t\t   krb5_key_salt_tuple *ks_tuple,\n\t\t\t   char *password)\n{\n    krb5_int32\t\t\tnow;\n    kadm5_ret_t\t\t\tret;\n    kadm5_policy_ent_rec\tpol;\n    kadm5_principal_ent_rec\tprinc;\n    kadm5_server_handle_t\thandle = server_handle;\n\n    ret = krb5_timeofday(handle->context, &now);\n    if (ret)\n\treturn ret;\n\n    ret = kadm5_get_principal(handle->lhandle, principal,\n\t\t\t      &princ, KADM5_PRINCIPAL_NORMAL_MASK);\n    if(ret != KADM5_OK) \n\t return ret;\n    if(princ.aux_attributes & KADM5_POLICY) {\n\tif((ret=kadm5_get_policy(handle->lhandle,\n\t\t\t\t princ.policy, &pol)) != KADM5_OK) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n\t}\n\tif((now - princ.last_pwd_change) < pol.pw_min_life &&\n\t   !(princ.attributes & KRB5_KDB_REQUIRES_PWCHANGE)) {\n\t    (void) kadm5_free_policy_ent(handle->lhandle, &pol);\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return KADM5_PASS_TOOSOON;\n\t}\n\n\tret = kadm5_free_policy_ent(handle->lhandle, &pol);\n\tif (ret) {\n\t    (void) kadm5_free_principal_ent(handle->lhandle, &princ);\n\t    return ret;\n        }\n    }\n\n    ret = kadm5_free_principal_ent(handle->lhandle, &princ);\n    if (ret)\n\t return ret;\n    \n    return kadm5_chpass_principal_3(server_handle, principal,\n\t\t\t\t    keepold, n_ks_tuple, ks_tuple,\n\t\t\t\t    password);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmp_gss_krb5_name",
          "args": [
            "handle",
            "rqst2name(rqstp)",
            "arg->princ"
          ],
          "line": 691
        },
        "resolved": true,
        "details": {
          "function_name": "cmp_gss_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "199-210",
          "snippet": "static int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 672
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 670
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nchpass_principal_1_svc(chpass_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ)) {\n\t ret.code = chpass_principal_wrapper_3((void *)handle, arg->princ,\n\t\t\t\t\t       FALSE, 0, NULL, arg->pass);\n    } else if (!(CHANGEPW_SERVICE(rqstp)) &&\n\t       acl_check(handle->context, rqst2name(rqstp),\n\t\t\t ACL_CHANGEPW, arg->princ, NULL)) {\n\t ret.code = kadm5_chpass_principal((void *)handle, arg->princ,\n\t\t\t\t\t\targ->pass);\n    } else {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_chpass_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n\t ret.code = KADM5_AUTH_CHANGEPW;\n    }\n\n    if(ret.code != KADM5_AUTH_CHANGEPW) {\n\tkrb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_chpass_principal\", \n\t       prime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t       client_name.value, service_name.value,\n\t       inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "get_princs_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "605-658",
    "snippet": "gprincs_ret *\nget_princs_1_svc(gprincs_arg *arg, struct svc_req *rqstp)\n{\n    static gprincs_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_gprincs_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->exp;\n    if (prime_arg == NULL)\n\t prime_arg = \"*\";\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_LIST,\n\t\t\t\t\t      NULL,\n\t\t\t\t\t      NULL)) {\n\t ret.code = KADM5_AUTH_LIST;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_get_principals\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code  = kadm5_get_principals((void *)handle,\n\t\t\t\t\t       arg->exp, &ret.princs,\n\t\t\t\t\t       &ret.count);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_get_principals\",\n\t\tprime_arg,  \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 654
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_get_principals\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 648
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principals",
          "args": [
            "(void *)handle",
            "arg->exp",
            "&ret.princs",
            "&ret.count"
          ],
          "line": 645
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_get_principals\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 641
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 643
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_LIST",
            "NULL",
            "NULL"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 636
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 627
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 620
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_gprincs_ret",
            "&ret"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngprincs_ret *\nget_princs_1_svc(gprincs_arg *arg, struct svc_req *rqstp)\n{\n    static gprincs_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_gprincs_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    prime_arg = arg->exp;\n    if (prime_arg == NULL)\n\t prime_arg = \"*\";\n\n    if (CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t      rqst2name(rqstp),\n\t\t\t\t\t      ACL_LIST,\n\t\t\t\t\t      NULL,\n\t\t\t\t\t      NULL)) {\n\t ret.code = KADM5_AUTH_LIST;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_get_principals\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code  = kadm5_get_principals((void *)handle,\n\t\t\t\t\t       arg->exp, &ret.princs,\n\t\t\t\t\t       &ret.count);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_get_principals\",\n\t\tprime_arg,  \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "get_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "533-603",
    "snippet": "gprinc_ret *\nget_principal_1_svc(gprinc_arg *arg, struct svc_req *rqstp)\n{\n    static gprinc_ret\t\t    ret;\n    kadm5_principal_ent_t_v1\t    e;\n    char\t\t\t    *prime_arg, *funcname;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_gprinc_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_get_principal (V1)\" : \"kadm5_get_principal\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (! cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ) &&\n\t(CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t       rqst2name(rqstp),\n\t\t\t\t\t       ACL_INQUIRE,\n\t\t\t\t\t       arg->princ,\n\t\t\t\t\t       NULL))) {\n\t ret.code = KADM5_AUTH_GET;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      ret.code  = kadm5_get_principal_v1((void *)handle,\n\t\t\t\t\t\t arg->princ, &e); \n\t      if(ret.code == KADM5_OK) {\n\t\t   memcpy(&ret.rec, e, sizeof(kadm5_principal_ent_rec_v1));\n\t\t   free(e);\n\t      }\n\t } else {\n\t      ret.code  = kadm5_get_principal((void *)handle,\n\t\t\t\t\t      arg->princ, &ret.rec,\n\t\t\t\t\t      arg->mask);\n\t }\n\t \n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t\tprime_arg,  \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 601
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 599
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "funcname",
            "prime_arg",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal",
          "args": [
            "(void *)handle",
            "arg->princ",
            "&ret.rec",
            "arg->mask"
          ],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_get_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2091-2163",
          "snippet": "static int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&ret.rec",
            "e",
            "sizeof(kadm5_principal_ent_rec_v1)"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal_v1",
          "args": [
            "(void *)handle",
            "arg->princ",
            "&e"
          ],
          "line": 580
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_get_principal_v1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_glue_v1.c",
          "lines": "21-26",
          "snippet": "kadm5_ret_t kadm5_get_principal_v1(void *server_handle,\n\t\t\t\t  krb5_principal principal, \n\t\t\t\t  kadm5_principal_ent_t_v1 *ent)\n{\n     return kadm5_get_principal(server_handle, principal, ent);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <kadm5/admin.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <kadm5/admin.h>\n\nkadm5_ret_t kadm5_get_principal_v1(void *server_handle,\n\t\t\t\t  krb5_principal principal, \n\t\t\t\t  kadm5_principal_ent_t_v1 *ent)\n{\n     return kadm5_get_principal(server_handle, principal, ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "funcname",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_INQUIRE",
            "arg->princ",
            "NULL"
          ],
          "line": 569
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 569
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cmp_gss_krb5_name",
          "args": [
            "handle",
            "rqst2name(rqstp)",
            "arg->princ"
          ],
          "line": 568
        },
        "resolved": true,
        "details": {
          "function_name": "cmp_gss_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "199-210",
          "snippet": "static int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 559
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 549
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 546
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_gprinc_ret",
            "&ret"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngprinc_ret *\nget_principal_1_svc(gprinc_arg *arg, struct svc_req *rqstp)\n{\n    static gprinc_ret\t\t    ret;\n    kadm5_principal_ent_t_v1\t    e;\n    char\t\t\t    *prime_arg, *funcname;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_gprinc_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    funcname = handle->api_version == KADM5_API_VERSION_1 ?\n\t \"kadm5_get_principal (V1)\" : \"kadm5_get_principal\";\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (! cmp_gss_krb5_name(handle, rqst2name(rqstp), arg->princ) &&\n\t(CHANGEPW_SERVICE(rqstp) || !acl_check(handle->context,\n\t\t\t\t\t       rqst2name(rqstp),\n\t\t\t\t\t       ACL_INQUIRE,\n\t\t\t\t\t       arg->princ,\n\t\t\t\t\t       NULL))) {\n\t ret.code = KADM5_AUTH_GET;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, funcname,\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t if (handle->api_version == KADM5_API_VERSION_1) {\n\t      ret.code  = kadm5_get_principal_v1((void *)handle,\n\t\t\t\t\t\t arg->princ, &e); \n\t      if(ret.code == KADM5_OK) {\n\t\t   memcpy(&ret.rec, e, sizeof(kadm5_principal_ent_rec_v1));\n\t\t   free(e);\n\t      }\n\t } else {\n\t      ret.code  = kadm5_get_principal((void *)handle,\n\t\t\t\t\t      arg->princ, &ret.rec,\n\t\t\t\t\t      arg->mask);\n\t }\n\t \n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, funcname,\n\t\tprime_arg,  \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "rename_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "463-531",
    "snippet": "generic_ret *\nrename_principal_1_svc(rprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\tret;\n    char\t\t\t*prime_arg1,\n\t\t\t\t*prime_arg2;\n    char\t\t\tprime_arg[BUFSIZ];\n    gss_buffer_desc\t\tclient_name,\n\t\t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n    restriction_t\t\t*rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->src, &prime_arg1) ||\n        krb5_unparse_name(handle->context, arg->dest, &prime_arg2)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n    sprintf(prime_arg, \"%s to %s\", prime_arg1, prime_arg2);\n\n    ret.code = KADM5_OK;\n    if (! CHANGEPW_SERVICE(rqstp)) {\n\t if (!acl_check(handle->context, rqst2name(rqstp),\n\t\t\tACL_DELETE, arg->src, NULL))\n\t      ret.code = KADM5_AUTH_DELETE;\n\t /* any restrictions at all on the ADD kills the RENAME */\n\t if (!acl_check(handle->context, rqst2name(rqstp),\n\t\t\tACL_ADD, arg->dest, &rp) || rp) {\n\t      if (ret.code == KADM5_AUTH_DELETE)\n\t\t   ret.code = KADM5_AUTH_INSUFFICIENT;\n\t      else\n\t\t   ret.code = KADM5_AUTH_ADD;\n\t }\n    } else\n\t ret.code = KADM5_AUTH_INSUFFICIENT;\n    if (ret.code != KADM5_OK) {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_rename_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_rename_principal((void *)handle, arg->src,\n\t\t\t\t\t\targ->dest);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_rename_principal\",\n\t\tprime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t    error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg1);\n    free(prime_arg2);    \n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg2"
          ],
          "line": 527
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_rename_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t    error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_rename_principal",
          "args": [
            "(void *)handle",
            "arg->src",
            "arg->dest"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_rename_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_ADD",
            "arg->dest",
            "&rp"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 503
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_DELETE",
            "arg->src",
            "NULL"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "prime_arg",
            "\"%s to %s\"",
            "prime_arg1",
            "prime_arg2"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->dest",
            "&prime_arg2"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->src",
            "&prime_arg1"
          ],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 486
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 481
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nrename_principal_1_svc(rprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\tret;\n    char\t\t\t*prime_arg1,\n\t\t\t\t*prime_arg2;\n    char\t\t\tprime_arg[BUFSIZ];\n    gss_buffer_desc\t\tclient_name,\n\t\t\t\tservice_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n    restriction_t\t\t*rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->src, &prime_arg1) ||\n        krb5_unparse_name(handle->context, arg->dest, &prime_arg2)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n    sprintf(prime_arg, \"%s to %s\", prime_arg1, prime_arg2);\n\n    ret.code = KADM5_OK;\n    if (! CHANGEPW_SERVICE(rqstp)) {\n\t if (!acl_check(handle->context, rqst2name(rqstp),\n\t\t\tACL_DELETE, arg->src, NULL))\n\t      ret.code = KADM5_AUTH_DELETE;\n\t /* any restrictions at all on the ADD kills the RENAME */\n\t if (!acl_check(handle->context, rqst2name(rqstp),\n\t\t\tACL_ADD, arg->dest, &rp) || rp) {\n\t      if (ret.code == KADM5_AUTH_DELETE)\n\t\t   ret.code = KADM5_AUTH_INSUFFICIENT;\n\t      else\n\t\t   ret.code = KADM5_AUTH_ADD;\n\t }\n    } else\n\t ret.code = KADM5_AUTH_INSUFFICIENT;\n    if (ret.code != KADM5_OK) {\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_rename_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_rename_principal((void *)handle, arg->src,\n\t\t\t\t\t\targ->dest);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_rename_principal\",\n\t\tprime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t    error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg1);\n    free(prime_arg2);    \n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "modify_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "408-461",
    "snippet": "generic_ret *\nmodify_principal_1_svc(mprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n    restriction_t\t\t    *rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->rec.principal, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_MODIFY,\n\t\t      arg->rec.principal, &rp)\n\t|| acl_impose_restrictions(handle->context,\n\t\t\t\t   &arg->rec, &arg->mask, rp)) {\n\t ret.code = KADM5_AUTH_MODIFY;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_modify_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_modify_principal((void *)handle, &arg->rec,\n\t\t\t\t\t\targ->mask);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_modify_principal\",\n\t\tprime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t    error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 457
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_modify_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t    error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_modify_principal",
          "args": [
            "(void *)handle",
            "&arg->rec",
            "arg->mask"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_modify_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_impose_restrictions",
          "args": [
            "handle->context",
            "&arg->rec",
            "&arg->mask",
            "rp"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_MODIFY",
            "arg->rec.principal",
            "&rp"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 439
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->rec.principal",
            "&prime_arg"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 429
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 424
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 421
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\nmodify_principal_1_svc(mprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n    restriction_t\t\t    *rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->rec.principal, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_MODIFY,\n\t\t      arg->rec.principal, &rp)\n\t|| acl_impose_restrictions(handle->context,\n\t\t\t\t   &arg->rec, &arg->mask, rp)) {\n\t ret.code = KADM5_AUTH_MODIFY;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_modify_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_modify_principal((void *)handle, &arg->rec,\n\t\t\t\t\t\targ->mask);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_modify_principal\",\n\t\tprime_arg, ((ret.code == 0) ? \"success\" :\n\t\t\t    error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "delete_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "356-406",
    "snippet": "generic_ret *\ndelete_principal_1_svc(dprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n    \n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_DELETE,\n\t\t      arg->princ, NULL)) {\n\t ret.code = KADM5_AUTH_DELETE;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_delete_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_delete_principal((void *)handle, arg->princ);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_delete_principal\", prime_arg, \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free(prime_arg);\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free_server_handle",
          "args": [
            "handle"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_delete_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" : error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_delete_principal",
          "args": [
            "(void *)handle",
            "arg->princ"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_delete_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_DELETE",
            "arg->princ",
            "NULL"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 388
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->princ",
            "&prime_arg"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 378
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\ndelete_principal_1_svc(dprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\t    ret;\n    char\t\t\t    *prime_arg;\n    gss_buffer_desc\t\t    client_name,\n\t\t\t\t    service_name;\n    OM_uint32\t\t\t    minor_stat;\n    kadm5_server_handle_t\t    handle;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->princ, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n    \n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_DELETE,\n\t\t      arg->princ, NULL)) {\n\t ret.code = KADM5_AUTH_DELETE;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_delete_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_delete_principal((void *)handle, arg->princ);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_delete_principal\", prime_arg, \n\t\t((ret.code == 0) ? \"success\" : error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free(prime_arg);\n    free_server_handle(handle);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "create_principal3_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "297-354",
    "snippet": "generic_ret *\ncreate_principal3_1_svc(cprinc3_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\tret;\n    char\t\t\t*prime_arg;\n    gss_buffer_desc\t\tclient_name, service_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n    restriction_t\t\t*rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->rec.principal, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_ADD,\n\t\t      arg->rec.principal, &rp)\n\t|| acl_impose_restrictions(handle->context,\n\t\t\t\t   &arg->rec, &arg->mask, rp)) {\n\t ret.code = KADM5_AUTH_ADD;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_create_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_create_principal_3((void *)handle,\n\t\t\t\t\t     &arg->rec, arg->mask,\n\t\t\t\t\t     arg->n_ks_tuple,\n\t\t\t\t\t     arg->ks_tuple,\n\t\t\t\t\t     arg->passwd);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_create_principal\",\n\t\tprime_arg,((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_create_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_principal_3",
          "args": [
            "(void *)handle",
            "&arg->rec",
            "arg->mask",
            "arg->n_ks_tuple",
            "arg->ks_tuple",
            "arg->passwd"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_create_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_impose_restrictions",
          "args": [
            "handle->context",
            "&arg->rec",
            "&arg->mask",
            "rp"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_ADD",
            "arg->rec.principal",
            "&rp"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 329
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->rec.principal",
            "&prime_arg"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\ncreate_principal3_1_svc(cprinc3_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\tret;\n    char\t\t\t*prime_arg;\n    gss_buffer_desc\t\tclient_name, service_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n    restriction_t\t\t*rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->rec.principal, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_ADD,\n\t\t      arg->rec.principal, &rp)\n\t|| acl_impose_restrictions(handle->context,\n\t\t\t\t   &arg->rec, &arg->mask, rp)) {\n\t ret.code = KADM5_AUTH_ADD;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_create_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_create_principal_3((void *)handle,\n\t\t\t\t\t     &arg->rec, arg->mask,\n\t\t\t\t\t     arg->n_ks_tuple,\n\t\t\t\t\t     arg->ks_tuple,\n\t\t\t\t\t     arg->passwd);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_create_principal\",\n\t\tprime_arg,((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "create_principal_1_svc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "240-295",
    "snippet": "generic_ret *\ncreate_principal_1_svc(cprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\tret;\n    char\t\t\t*prime_arg;\n    gss_buffer_desc\t\tclient_name, service_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n    restriction_t\t\t*rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->rec.principal, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_ADD,\n\t\t      arg->rec.principal, &rp)\n\t|| acl_impose_restrictions(handle->context,\n\t\t\t\t   &arg->rec, &arg->mask, rp)) {\n\t ret.code = KADM5_AUTH_ADD;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_create_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_create_principal((void *)handle,\n\t\t\t\t\t\t&arg->rec, arg->mask,\n\t\t\t\t\t\targ->passwd);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_create_principal\",\n\t\tprime_arg,((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [
      "#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"",
      "#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\""
    ],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&service_name"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&client_name"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prime_arg"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_DONE",
            "\"kadm5_create_principal\"",
            "prime_arg",
            "((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code))",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error_message",
          "args": [
            "ret.code"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_principal",
          "args": [
            "(void *)handle",
            "&arg->rec",
            "arg->mask",
            "arg->passwd"
          ],
          "line": 281
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_create_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "1680-1746",
          "snippet": "static int tcl_kadm5_create_principal(ClientData clientData, \n\t\t\t\t      Tcl_Interp *interp,\n\t\t\t\t      int argc, char *argv[])\n{\n     int tcl_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n     char *princ_string;\n     kadm5_principal_ent_t princ = 0;\n     krb5_int32 mask;\n     char *pw;\n#ifdef OVERRIDE     \n     int override_qual;\n#endif     \n\n     GET_HANDLE(3, 0);\n\n     if ((tcl_ret = parse_str(interp, argv[0], &princ_string)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal\");\n\t  return tcl_ret;\n     }\n\n     if (princ_string &&\n\t ((tcl_ret = parse_principal_ent(interp, princ_string, &princ))\n\t  != TCL_OK)) {\n\t  return tcl_ret;\n     }\n\n     if ((tcl_ret = parse_principal_mask(interp, argv[1], &mask)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n\n     if ((tcl_ret = parse_str(interp, argv[2], &pw)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#ifdef OVERRIDE\n     if ((tcl_ret = Tcl_GetBoolean(interp, argv[3], &override_qual)) !=\n\t TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#endif     \n\n#ifdef OVERRIDE\n     ret = kadm5_create_principal(server_handle, princ, mask, pw,\n\t\t\t\t       override_qual);\n#else\n     ret = kadm5_create_principal(server_handle, princ, mask, pw);\n#endif     \n\n     if (ret != KADM5_OK) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     else {\n\t  set_ok(interp, \"Principal created.\");\n     }\n\nfinished:\n     if (princ) {\n\t  free_principal_ent(&princ);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic int tcl_kadm5_create_principal(ClientData clientData, \n\t\t\t\t      Tcl_Interp *interp,\n\t\t\t\t      int argc, char *argv[])\n{\n     int tcl_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n     char *princ_string;\n     kadm5_principal_ent_t princ = 0;\n     krb5_int32 mask;\n     char *pw;\n#ifdef OVERRIDE     \n     int override_qual;\n#endif     \n\n     GET_HANDLE(3, 0);\n\n     if ((tcl_ret = parse_str(interp, argv[0], &princ_string)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal\");\n\t  return tcl_ret;\n     }\n\n     if (princ_string &&\n\t ((tcl_ret = parse_principal_ent(interp, princ_string, &princ))\n\t  != TCL_OK)) {\n\t  return tcl_ret;\n     }\n\n     if ((tcl_ret = parse_principal_mask(interp, argv[1], &mask)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n\n     if ((tcl_ret = parse_str(interp, argv[2], &pw)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#ifdef OVERRIDE\n     if ((tcl_ret = Tcl_GetBoolean(interp, argv[3], &override_qual)) !=\n\t TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#endif     \n\n#ifdef OVERRIDE\n     ret = kadm5_create_principal(server_handle, princ, mask, pw,\n\t\t\t\t       override_qual);\n#else\n     ret = kadm5_create_principal(server_handle, princ, mask, pw);\n#endif     \n\n     if (ret != KADM5_OK) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     else {\n\t  set_ok(interp, \"Principal created.\");\n     }\n\nfinished:\n     if (princ) {\n\t  free_principal_ent(&princ);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_klog_syslog",
          "args": [
            "LOG_NOTICE",
            "LOG_UNAUTH",
            "\"kadm5_create_principal\"",
            "prime_arg",
            "client_name.value",
            "service_name.value",
            "inet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr)"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "inet_ntoa",
          "args": [
            "rqstp->rq_xprt->xp_raddr.sin_addr"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_impose_restrictions",
          "args": [
            "handle->context",
            "&arg->rec",
            "&arg->mask",
            "rp"
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "acl_check",
          "args": [
            "handle->context",
            "rqst2name(rqstp)",
            "ACL_ADD",
            "arg->rec.principal",
            "&rp"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CHANGEPW_SERVICE",
          "args": [
            "rqstp"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "handle->context",
            "arg->rec.principal",
            "&prime_arg"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setup_gss_names",
          "args": [
            "rqstp",
            "&client_name",
            "&service_name"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "setup_gss_names",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "160-185",
          "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "check_handle",
          "args": [
            "(void *)handle"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "check_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "75-79",
          "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_server_handle",
          "args": [
            "arg->api_version",
            "rqstp",
            "&handle"
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "new_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "105-127",
          "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "extern void *\t\t\t\tglobal_server_handle;",
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xdr_free",
          "args": [
            "xdr_generic_ret",
            "&ret"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\n#define\tLOG_DONE    \"Request: %s, %s, %s, client=%s, service=%s, addr=%s\"\n#define LOG_UNAUTH  \"Unauthorized request: %s, %s, client=%s, service=%s, addr=%s\"\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\ngeneric_ret *\ncreate_principal_1_svc(cprinc_arg *arg, struct svc_req *rqstp)\n{\n    static generic_ret\t\tret;\n    char\t\t\t*prime_arg;\n    gss_buffer_desc\t\tclient_name, service_name;\n    OM_uint32\t\t\tminor_stat;\n    kadm5_server_handle_t\thandle;\n    restriction_t\t\t*rp;\n\n    xdr_free(xdr_generic_ret, &ret);\n\n    if ((ret.code = new_server_handle(arg->api_version, rqstp, &handle)))\n\t return &ret;\n\n    if ((ret.code = check_handle((void *)handle))) {\n\t free_server_handle(handle);\n\t return &ret;\n    }\n\n    ret.api_version = handle->api_version;\n\n    if (setup_gss_names(rqstp, &client_name, &service_name) < 0) {\n\t ret.code = KADM5_FAILURE;\n\t return &ret;\n    }\n    if (krb5_unparse_name(handle->context, arg->rec.principal, &prime_arg)) {\n\t ret.code = KADM5_BAD_PRINCIPAL;\n\t return &ret;\n    }\n\n    if (CHANGEPW_SERVICE(rqstp)\n\t|| !acl_check(handle->context, rqst2name(rqstp), ACL_ADD,\n\t\t      arg->rec.principal, &rp)\n\t|| acl_impose_restrictions(handle->context,\n\t\t\t\t   &arg->rec, &arg->mask, rp)) {\n\t ret.code = KADM5_AUTH_ADD;\n\t krb5_klog_syslog(LOG_NOTICE, LOG_UNAUTH, \"kadm5_create_principal\",\n\t\tprime_arg, client_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    } else {\n\t ret.code = kadm5_create_principal((void *)handle,\n\t\t\t\t\t\t&arg->rec, arg->mask,\n\t\t\t\t\t\targ->passwd);\n\t krb5_klog_syslog(LOG_NOTICE, LOG_DONE, \"kadm5_create_principal\",\n\t\tprime_arg,((ret.code == 0) ? \"success\" :\n\t\t\t   error_message(ret.code)), \n\t\tclient_name.value, service_name.value,\n\t\tinet_ntoa(rqstp->rq_xprt->xp_raddr.sin_addr));\n    }\n    free_server_handle(handle);\n    free(prime_arg);\n    gss_release_buffer(&minor_stat, &client_name);\n    gss_release_buffer(&minor_stat, &service_name);\n    return &ret;\n}"
  },
  {
    "function_name": "gss_name_to_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "228-238",
    "snippet": "static int\ngss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str)\n{\n     OM_uint32 status, minor_stat;\n     gss_OID gss_type;\n\n     status = gss_display_name(&minor_stat, gss_name, str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 1;\n     return 0;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int gss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_display_name",
          "args": [
            "&minor_stat",
            "gss_name",
            "str",
            "&gss_type"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str);\n\nstatic int\ngss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str)\n{\n     OM_uint32 status, minor_stat;\n     gss_OID gss_type;\n\n     status = gss_display_name(&minor_stat, gss_name, str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 1;\n     return 0;\n}"
  },
  {
    "function_name": "gss_to_krb5_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "212-226",
    "snippet": "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ)\n{\n     OM_uint32 status, minor_stat;\n     gss_buffer_desc gss_str;\n     gss_OID gss_type;\n     int success;\n\n     status = gss_display_name(&minor_stat, gss_name, &gss_str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 0;\n     success = (krb5_parse_name(handle->context, gss_str.value, princ) == 0);\n     gss_release_buffer(&minor_stat, &gss_str);\n     return success;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&minor_stat",
            "&gss_str"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_parse_name",
          "args": [
            "handle->context",
            "gss_str.value",
            "princ"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_display_name",
          "args": [
            "&minor_stat",
            "gss_name",
            "&gss_str",
            "&gss_type"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ)\n{\n     OM_uint32 status, minor_stat;\n     gss_buffer_desc gss_str;\n     gss_OID gss_type;\n     int success;\n\n     status = gss_display_name(&minor_stat, gss_name, &gss_str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 0;\n     success = (krb5_parse_name(handle->context, gss_str.value, princ) == 0);\n     gss_release_buffer(&minor_stat, &gss_str);\n     return success;\n}"
  },
  {
    "function_name": "cmp_gss_krb5_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "199-210",
    "snippet": "static int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
      "static gss_name_t acceptor_name(gss_ctx_id_t context);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "handle->context",
            "princ2"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_principal_compare",
          "args": [
            "handle->context",
            "princ",
            "princ2"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_to_krb5_name",
          "args": [
            "handle",
            "gss_name",
            "&princ2"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "gss_to_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "212-226",
          "snippet": "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ)\n{\n     OM_uint32 status, minor_stat;\n     gss_buffer_desc gss_str;\n     gss_OID gss_type;\n     int success;\n\n     status = gss_display_name(&minor_stat, gss_name, &gss_str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 0;\n     success = (krb5_parse_name(handle->context, gss_str.value, princ) == 0);\n     gss_release_buffer(&minor_stat, &gss_str);\n     return success;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ)\n{\n     OM_uint32 status, minor_stat;\n     gss_buffer_desc gss_str;\n     gss_OID gss_type;\n     int success;\n\n     status = gss_display_name(&minor_stat, gss_name, &gss_str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 0;\n     success = (krb5_parse_name(handle->context, gss_str.value, princ) == 0);\n     gss_release_buffer(&minor_stat, &gss_str);\n     return success;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int cmp_gss_krb5_name(kadm5_server_handle_t handle,\n\t\t      gss_name_t gss_name, krb5_principal princ)\n{\n     krb5_principal princ2;\n     int status;\n\n     if (! gss_to_krb5_name(handle, gss_name, &princ2))\n\t  return 0;\n     status = krb5_principal_compare(handle->context, princ, princ2);\n     krb5_free_principal(handle->context, princ2);\n     return status;\n}"
  },
  {
    "function_name": "acceptor_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "187-197",
    "snippet": "static gss_name_t acceptor_name(gss_ctx_id_t context)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t name;\n     \n     maj_stat = gss_inquire_context(&min_stat, context, NULL, &name,\n\t\t\t\t    NULL, NULL, NULL, NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE)\n\t  return NULL;\n     return name;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_inquire_context",
          "args": [
            "&min_stat",
            "context",
            "NULL",
            "&name",
            "NULL",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t name;\n     \n     maj_stat = gss_inquire_context(&min_stat, context, NULL, &name,\n\t\t\t\t    NULL, NULL, NULL, NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE)\n\t  return NULL;\n     return name;\n}"
  },
  {
    "function_name": "setup_gss_names",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "160-185",
    "snippet": "static \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_name",
          "args": [
            "&min_stat",
            "&server_gss_name"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_name",
          "args": [
            "&min_stat",
            "&server_gss_name"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&min_stat",
            "client_name"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_name_to_string",
          "args": [
            "server_gss_name",
            "server_name"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "gss_name_to_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "228-238",
          "snippet": "static int\ngss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str)\n{\n     OM_uint32 status, minor_stat;\n     gss_OID gss_type;\n\n     status = gss_display_name(&minor_stat, gss_name, str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 1;\n     return 0;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str);\n\nstatic int\ngss_name_to_string(gss_name_t gss_name, gss_buffer_desc *str)\n{\n     OM_uint32 status, minor_stat;\n     gss_OID gss_type;\n\n     status = gss_display_name(&minor_stat, gss_name, str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 1;\n     return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gss_release_name",
          "args": [
            "&min_stat",
            "&server_gss_name"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&min_stat",
            "client_name"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_inquire_context",
          "args": [
            "&min_stat",
            "rqstp->rq_svccred",
            "NULL",
            "&server_gss_name",
            "NULL",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic \nint setup_gss_names(struct svc_req *rqstp,\n\t\t    gss_buffer_desc *client_name,\n\t\t    gss_buffer_desc *server_name)\n{\n     OM_uint32 maj_stat, min_stat;\n     gss_name_t server_gss_name;\n\n     if (gss_name_to_string(rqst2name(rqstp), client_name) != 0)\n\t  return -1;\n     maj_stat = gss_inquire_context(&min_stat, rqstp->rq_svccred, NULL,\n\t\t\t\t    &server_gss_name, NULL, NULL, NULL,\n\t\t\t\t    NULL, NULL);\n     if (maj_stat != GSS_S_COMPLETE) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     if (gss_name_to_string(server_gss_name, server_name) != 0) {\n\t  gss_release_buffer(&min_stat, client_name);\n          gss_release_name(&min_stat, &server_gss_name);\n\t  return -1;\n     }\n     gss_release_name(&min_stat, &server_gss_name);\n     return 0;\n}"
  },
  {
    "function_name": "free_server_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "137-141",
    "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static gss_name_t acceptor_name(gss_ctx_id_t context);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "handle"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "handle->context",
            "handle->current_caller"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
  },
  {
    "function_name": "new_server_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "105-127",
    "snippet": "static kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "extern void *\t\t\t\tglobal_server_handle;",
      "static gss_name_t rqst2name(struct svc_req *rqstp);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "handle"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "free_server_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "137-141",
          "snippet": "static void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic void free_server_handle(kadm5_server_handle_t handle)\n{\n     krb5_free_principal(handle->context, handle->current_caller);\n     free(handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gss_to_krb5_name",
          "args": [
            "handle",
            "rqst2name(rqstp)",
            "&handle->current_caller"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "gss_to_krb5_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "212-226",
          "snippet": "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ)\n{\n     OM_uint32 status, minor_stat;\n     gss_buffer_desc gss_str;\n     gss_OID gss_type;\n     int success;\n\n     status = gss_display_name(&minor_stat, gss_name, &gss_str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 0;\n     success = (krb5_parse_name(handle->context, gss_str.value, princ) == 0);\n     gss_release_buffer(&minor_stat, &gss_str);\n     return success;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);",
            "static gss_name_t acceptor_name(gss_ctx_id_t context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ);\nstatic gss_name_t acceptor_name(gss_ctx_id_t context);\n\nstatic int gss_to_krb5_name(kadm5_server_handle_t handle,\n\t\t     gss_name_t gss_name, krb5_principal *princ)\n{\n     OM_uint32 status, minor_stat;\n     gss_buffer_desc gss_str;\n     gss_OID gss_type;\n     int success;\n\n     status = gss_display_name(&minor_stat, gss_name, &gss_str, &gss_type);\n     if ((status != GSS_S_COMPLETE) || (gss_type != gss_nt_krb5_name))\n\t  return 0;\n     success = (krb5_parse_name(handle->context, gss_str.value, princ) == 0);\n     gss_release_buffer(&minor_stat, &gss_str);\n     return success;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rqst2name",
          "args": [
            "rqstp"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "rqst2name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "1483-1491",
          "snippet": "static gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
            "#include <arpa/inet.h>  /* inet_ntoa */",
            "#include <syslog.h>",
            "#include <kadm5/server_acl.h>",
            "#include <kadm5/server_internal.h>",
            "#include <kadm5/kadm_rpc.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>",
            "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
            "#include <gssapi/gssapi.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gss_name_t rqst2name(struct svc_req *rqstp);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic gss_name_t\nrqst2name(struct svc_req *rqstp)\n{\n\n     if (rqstp->rq_cred.oa_flavor == RPCSEC_GSS)\n\t  return rqstp->rq_clntname;\n     else\n\t  return rqstp->rq_clntcred;\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(*handle)"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nextern void *\t\t\t\tglobal_server_handle;\nstatic gss_name_t rqst2name(struct svc_req *rqstp);\n\nstatic kadm5_ret_t new_server_handle(krb5_ui_4 api_version,\n\t\t\t\t\t  struct svc_req *rqstp,\n\t\t\t\t\t  kadm5_server_handle_t\n\t\t\t\t\t  *out_handle)\n{\n     kadm5_server_handle_t handle;\n\n     if (! (handle = (kadm5_server_handle_t)\n\t    malloc(sizeof(*handle))))\n\t  return ENOMEM;\n\n     *handle = *(kadm5_server_handle_t)global_server_handle;\n     handle->api_version = api_version;\n\n     if (! gss_to_krb5_name(handle, rqst2name(rqstp),\n\t\t\t    &handle->current_caller)) {\n\t  free(handle);\n\t  return KADM5_FAILURE;\n     }\n\n     *out_handle = handle;\n     return 0;\n}"
  },
  {
    "function_name": "check_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "75-79",
    "snippet": "static int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CHECK_HANDLE",
          "args": [
            "handle"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int check_handle(void *handle)\n{\n     CHECK_HANDLE(handle);\n     return 0;\n}"
  },
  {
    "function_name": "cmp_gss_names_rel_1",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "54-62",
    "snippet": "static int cmp_gss_names_rel_1(gss_name_t n1, gss_name_t n2)\n{\n   OM_uint32 min_stat;\n   int ret;\n\n   ret = cmp_gss_names(n1, n2);\n   if (n1) (void) gss_release_name(&min_stat, &n1);\n   return ret;\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gss_release_name",
          "args": [
            "&min_stat",
            "&n1"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cmp_gss_names",
          "args": [
            "n1",
            "n2"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "cmp_gss_names_rel_1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
          "lines": "54-62",
          "snippet": "static int cmp_gss_names_rel_1(gss_name_t n1, gss_name_t n2)\n{\n   OM_uint32 min_stat;\n   int ret;\n\n   ret = cmp_gss_names(n1, n2);\n   if (n1) (void) gss_release_name(&min_stat, &n1);\n   return ret;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int cmp_gss_names_rel_1(gss_name_t n1, gss_name_t n2)\n{\n   OM_uint32 min_stat;\n   int ret;\n\n   ret = cmp_gss_names(n1, n2);\n   if (n1) (void) gss_release_name(&min_stat, &n1);\n   return ret;\n}"
  },
  {
    "function_name": "cmp_gss_names",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_stubs.c",
    "lines": "41-50",
    "snippet": "static int cmp_gss_names(gss_name_t n1, gss_name_t n2)\n{\n   OM_uint32 emaj, emin;\n   int equal;\n\n   if (GSS_ERROR(emaj = gss_compare_name(&emin, n1, n2, &equal)))\n      return(0);\n\n   return(equal);\n}",
    "includes": [
      "#include \"misc.h\"",
      "#include <krb5/adm_proto.h>  /* krb5_klog_syslog */",
      "#include <arpa/inet.h>  /* inet_ntoa */",
      "#include <syslog.h>",
      "#include <kadm5/server_acl.h>",
      "#include <kadm5/server_internal.h>",
      "#include <kadm5/kadm_rpc.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>",
      "#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */",
      "#include <gssapi/gssapi.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GSS_ERROR",
          "args": [
            "emaj = gss_compare_name(&emin, n1, n2, &equal)"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_compare_name",
          "args": [
            "&emin",
            "n1",
            "n2",
            "&equal"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"misc.h\"\n#include <krb5/adm_proto.h>  /* krb5_klog_syslog */\n#include <arpa/inet.h>  /* inet_ntoa */\n#include <syslog.h>\n#include <kadm5/server_acl.h>\n#include <kadm5/server_internal.h>\n#include <kadm5/kadm_rpc.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n#include <gssapi/gssapi_krb5.h> /* for gss_nt_krb5_name */\n#include <gssapi/gssapi.h>\n\nstatic int cmp_gss_names(gss_name_t n1, gss_name_t n2)\n{\n   OM_uint32 emaj, emin;\n   int equal;\n\n   if (GSS_ERROR(emaj = gss_compare_name(&emin, n1, n2, &equal)))\n      return(0);\n\n   return(equal);\n}"
  }
]