[
  {
    "function_name": "add_admin_princ",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
    "lines": "246-299",
    "snippet": "int add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime)\n{\n     char *fullname;\n     krb5_error_code ret;\n     kadm5_principal_ent_rec ent;\n\n     memset(&ent, 0, sizeof(ent));\n\n     fullname = build_name_with_realm(name, realm);\n     ret = krb5_parse_name(context, fullname, &ent.principal);\n     if (ret) {\n\t  com_err(progname, ret, str_PARSE_NAME);\n\t  return(ERR);\n     }\n     ent.max_life = lifetime;\n     ent.attributes = attrs | KRB5_KDB_DISALLOW_ALL_TIX;\n     \n     ret = kadm5_create_principal(handle, &ent,\n\t\t\t\t  (KADM5_PRINCIPAL | KADM5_MAX_LIFE |\n\t\t\t\t   KADM5_ATTRIBUTES),\n\t\t\t\t  \"to-be-random\");\n     if (ret) {\n\t  if (ret != KADM5_DUP) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     } else {\n\t  /* only randomize key if we created the principal */\n\t  ret = kadm5_randkey_principal(handle, ent.principal, NULL, NULL);\n\t  if (ret) {\n\t       com_err(progname, ret, str_RANDOM_KEY, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n\t  \n\t  ent.attributes = attrs;\n\t  ret = kadm5_modify_principal(handle, &ent, KADM5_ATTRIBUTES);\n\t  if (ret) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     }\n     \n     krb5_free_principal(context, ent.principal);\n     free(fullname);\n\n     return OK;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <krb5/kdb.h>",
      "#include <krb5.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <kadm5/adb.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include \"string_table.h\""
    ],
    "macros_used": [
      "#define OK 0",
      "#define ERR 1"
    ],
    "globals_used": [
      "static int add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime);",
      "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fullname"
          ],
          "line": 296
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "ent.principal"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "ent.principal"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "ret",
            "str_PUT_PRINC",
            "fullname"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_modify_principal",
          "args": [
            "handle",
            "&ent",
            "KADM5_ATTRIBUTES"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "ent.principal"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "ret",
            "str_RANDOM_KEY",
            "fullname"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal",
          "args": [
            "handle",
            "ent.principal",
            "NULL",
            "NULL"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_randkey_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2017-2087",
          "snippet": "static int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "ent.principal"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "ret",
            "str_PUT_PRINC",
            "fullname"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_principal",
          "args": [
            "handle",
            "&ent",
            "(KADM5_PRINCIPAL | KADM5_MAX_LIFE |\n\t\t\t\t   KADM5_ATTRIBUTES)",
            "\"to-be-random\""
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_create_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "1680-1746",
          "snippet": "static int tcl_kadm5_create_principal(ClientData clientData, \n\t\t\t\t      Tcl_Interp *interp,\n\t\t\t\t      int argc, char *argv[])\n{\n     int tcl_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n     char *princ_string;\n     kadm5_principal_ent_t princ = 0;\n     krb5_int32 mask;\n     char *pw;\n#ifdef OVERRIDE     \n     int override_qual;\n#endif     \n\n     GET_HANDLE(3, 0);\n\n     if ((tcl_ret = parse_str(interp, argv[0], &princ_string)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal\");\n\t  return tcl_ret;\n     }\n\n     if (princ_string &&\n\t ((tcl_ret = parse_principal_ent(interp, princ_string, &princ))\n\t  != TCL_OK)) {\n\t  return tcl_ret;\n     }\n\n     if ((tcl_ret = parse_principal_mask(interp, argv[1], &mask)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n\n     if ((tcl_ret = parse_str(interp, argv[2], &pw)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#ifdef OVERRIDE\n     if ((tcl_ret = Tcl_GetBoolean(interp, argv[3], &override_qual)) !=\n\t TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#endif     \n\n#ifdef OVERRIDE\n     ret = kadm5_create_principal(server_handle, princ, mask, pw,\n\t\t\t\t       override_qual);\n#else\n     ret = kadm5_create_principal(server_handle, princ, mask, pw);\n#endif     \n\n     if (ret != KADM5_OK) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     else {\n\t  set_ok(interp, \"Principal created.\");\n     }\n\nfinished:\n     if (princ) {\n\t  free_principal_ent(&princ);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic int tcl_kadm5_create_principal(ClientData clientData, \n\t\t\t\t      Tcl_Interp *interp,\n\t\t\t\t      int argc, char *argv[])\n{\n     int tcl_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n     char *princ_string;\n     kadm5_principal_ent_t princ = 0;\n     krb5_int32 mask;\n     char *pw;\n#ifdef OVERRIDE     \n     int override_qual;\n#endif     \n\n     GET_HANDLE(3, 0);\n\n     if ((tcl_ret = parse_str(interp, argv[0], &princ_string)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal\");\n\t  return tcl_ret;\n     }\n\n     if (princ_string &&\n\t ((tcl_ret = parse_principal_ent(interp, princ_string, &princ))\n\t  != TCL_OK)) {\n\t  return tcl_ret;\n     }\n\n     if ((tcl_ret = parse_principal_mask(interp, argv[1], &mask)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n\n     if ((tcl_ret = parse_str(interp, argv[2], &pw)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#ifdef OVERRIDE\n     if ((tcl_ret = Tcl_GetBoolean(interp, argv[3], &override_qual)) !=\n\t TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#endif     \n\n#ifdef OVERRIDE\n     ret = kadm5_create_principal(server_handle, princ, mask, pw,\n\t\t\t\t       override_qual);\n#else\n     ret = kadm5_create_principal(server_handle, princ, mask, pw);\n#endif     \n\n     if (ret != KADM5_OK) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     else {\n\t  set_ok(interp, \"Principal created.\");\n     }\n\nfinished:\n     if (princ) {\n\t  free_principal_ent(&princ);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "ret",
            "str_PARSE_NAME"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_parse_name",
          "args": [
            "context",
            "fullname",
            "&ent.principal"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "build_name_with_realm",
          "args": [
            "name",
            "realm"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "build_name_with_realm",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
          "lines": "144-151",
          "snippet": "static char *build_name_with_realm(char *name, char *realm)\n{\n     char *n;\n\n     n = (char *) malloc(strlen(name) + strlen(realm) + 2);\n     sprintf(n, \"%s@%s\", name, realm);\n     return n;\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <krb5/kdb.h>",
            "#include <krb5.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <kadm5/adb.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include \"string_table.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nstatic char *build_name_with_realm(char *name, char *realm)\n{\n     char *n;\n\n     n = (char *) malloc(strlen(name) + strlen(realm) + 2);\n     sprintf(n, \"%s@%s\", name, realm);\n     return n;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ent",
            "0",
            "sizeof(ent)"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\n#define OK 0\n#define ERR 1\n\nstatic int add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime);\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nint add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime)\n{\n     char *fullname;\n     krb5_error_code ret;\n     kadm5_principal_ent_rec ent;\n\n     memset(&ent, 0, sizeof(ent));\n\n     fullname = build_name_with_realm(name, realm);\n     ret = krb5_parse_name(context, fullname, &ent.principal);\n     if (ret) {\n\t  com_err(progname, ret, str_PARSE_NAME);\n\t  return(ERR);\n     }\n     ent.max_life = lifetime;\n     ent.attributes = attrs | KRB5_KDB_DISALLOW_ALL_TIX;\n     \n     ret = kadm5_create_principal(handle, &ent,\n\t\t\t\t  (KADM5_PRINCIPAL | KADM5_MAX_LIFE |\n\t\t\t\t   KADM5_ATTRIBUTES),\n\t\t\t\t  \"to-be-random\");\n     if (ret) {\n\t  if (ret != KADM5_DUP) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     } else {\n\t  /* only randomize key if we created the principal */\n\t  ret = kadm5_randkey_principal(handle, ent.principal, NULL, NULL);\n\t  if (ret) {\n\t       com_err(progname, ret, str_RANDOM_KEY, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n\t  \n\t  ent.attributes = attrs;\n\t  ret = kadm5_modify_principal(handle, &ent, KADM5_ATTRIBUTES);\n\t  if (ret) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     }\n     \n     krb5_free_principal(context, ent.principal);\n     free(fullname);\n\n     return OK;\n}"
  },
  {
    "function_name": "add_admin_princs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
    "lines": "173-215",
    "snippet": "static int add_admin_princs(void *handle, krb5_context context, char *realm)\n{\n  krb5_error_code ret = 0;\n  char service_name[MAXHOSTNAMELEN + 8];\n  char localname[MAXHOSTNAMELEN];\n  struct hostent *hp;\n\n  if (gethostname(localname, MAXHOSTNAMELEN)) {\n      ret = errno;\n      perror(\"gethostname\");\n      goto clean_and_exit;\n  }\n  hp = gethostbyname(localname);\n  if (hp == NULL) {\n      ret = errno;\n      perror(\"gethostbyname\");\n      goto clean_and_exit;\n  }\n  sprintf(service_name, \"kadmin/%s\", hp->h_name);\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     service_name, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n      goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     KADM5_ADMIN_SERVICE, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n       goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context, \n\t\t\t     KADM5_CHANGEPW_SERVICE, realm, \n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED |\n\t\t\t     KRB5_KDB_PWCHANGE_SERVICE,\n\t\t\t     CHANGEPW_LIFETIME)))\n       goto clean_and_exit;\n  \nclean_and_exit:\n\n  return ret;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <krb5/kdb.h>",
      "#include <krb5.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <kadm5/adb.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include \"string_table.h\""
    ],
    "macros_used": [
      "#define CHANGEPW_LIFETIME 60*5 /* 5 minutes */",
      "#define ADMIN_LIFETIME 60*60*3 /* 3 hours */"
    ],
    "globals_used": [
      "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "add_admin_princ",
          "args": [
            "handle",
            "context",
            "KADM5_CHANGEPW_SERVICE",
            "realm",
            "KRB5_KDB_DISALLOW_TGT_BASED |\n\t\t\t     KRB5_KDB_PWCHANGE_SERVICE",
            "CHANGEPW_LIFETIME"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "add_admin_princ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
          "lines": "246-299",
          "snippet": "int add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime)\n{\n     char *fullname;\n     krb5_error_code ret;\n     kadm5_principal_ent_rec ent;\n\n     memset(&ent, 0, sizeof(ent));\n\n     fullname = build_name_with_realm(name, realm);\n     ret = krb5_parse_name(context, fullname, &ent.principal);\n     if (ret) {\n\t  com_err(progname, ret, str_PARSE_NAME);\n\t  return(ERR);\n     }\n     ent.max_life = lifetime;\n     ent.attributes = attrs | KRB5_KDB_DISALLOW_ALL_TIX;\n     \n     ret = kadm5_create_principal(handle, &ent,\n\t\t\t\t  (KADM5_PRINCIPAL | KADM5_MAX_LIFE |\n\t\t\t\t   KADM5_ATTRIBUTES),\n\t\t\t\t  \"to-be-random\");\n     if (ret) {\n\t  if (ret != KADM5_DUP) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     } else {\n\t  /* only randomize key if we created the principal */\n\t  ret = kadm5_randkey_principal(handle, ent.principal, NULL, NULL);\n\t  if (ret) {\n\t       com_err(progname, ret, str_RANDOM_KEY, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n\t  \n\t  ent.attributes = attrs;\n\t  ret = kadm5_modify_principal(handle, &ent, KADM5_ATTRIBUTES);\n\t  if (ret) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     }\n     \n     krb5_free_principal(context, ent.principal);\n     free(fullname);\n\n     return OK;\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <krb5/kdb.h>",
            "#include <krb5.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <kadm5/adb.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include \"string_table.h\""
          ],
          "macros_used": [
            "#define OK 0",
            "#define ERR 1"
          ],
          "globals_used": [
            "static int add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime);",
            "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\n#define OK 0\n#define ERR 1\n\nstatic int add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime);\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nint add_admin_princ(void *handle, krb5_context context,\n\t\t    char *name, char *realm, int attrs, int lifetime)\n{\n     char *fullname;\n     krb5_error_code ret;\n     kadm5_principal_ent_rec ent;\n\n     memset(&ent, 0, sizeof(ent));\n\n     fullname = build_name_with_realm(name, realm);\n     ret = krb5_parse_name(context, fullname, &ent.principal);\n     if (ret) {\n\t  com_err(progname, ret, str_PARSE_NAME);\n\t  return(ERR);\n     }\n     ent.max_life = lifetime;\n     ent.attributes = attrs | KRB5_KDB_DISALLOW_ALL_TIX;\n     \n     ret = kadm5_create_principal(handle, &ent,\n\t\t\t\t  (KADM5_PRINCIPAL | KADM5_MAX_LIFE |\n\t\t\t\t   KADM5_ATTRIBUTES),\n\t\t\t\t  \"to-be-random\");\n     if (ret) {\n\t  if (ret != KADM5_DUP) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     } else {\n\t  /* only randomize key if we created the principal */\n\t  ret = kadm5_randkey_principal(handle, ent.principal, NULL, NULL);\n\t  if (ret) {\n\t       com_err(progname, ret, str_RANDOM_KEY, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n\t  \n\t  ent.attributes = attrs;\n\t  ret = kadm5_modify_principal(handle, &ent, KADM5_ATTRIBUTES);\n\t  if (ret) {\n\t       com_err(progname, ret, str_PUT_PRINC, fullname);\n\t       krb5_free_principal(context, ent.principal);\n\t       free(fullname);\n\t       return ERR;\n\t  }\n     }\n     \n     krb5_free_principal(context, ent.principal);\n     free(fullname);\n\n     return OK;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "service_name",
            "\"kadmin/%s\"",
            "hp->h_name"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"gethostbyname\""
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gethostbyname",
          "args": [
            "localname"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"gethostname\""
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gethostname",
          "args": [
            "localname",
            "MAXHOSTNAMELEN"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\n#define CHANGEPW_LIFETIME 60*5 /* 5 minutes */\n#define ADMIN_LIFETIME 60*60*3 /* 3 hours */\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm)\n{\n  krb5_error_code ret = 0;\n  char service_name[MAXHOSTNAMELEN + 8];\n  char localname[MAXHOSTNAMELEN];\n  struct hostent *hp;\n\n  if (gethostname(localname, MAXHOSTNAMELEN)) {\n      ret = errno;\n      perror(\"gethostname\");\n      goto clean_and_exit;\n  }\n  hp = gethostbyname(localname);\n  if (hp == NULL) {\n      ret = errno;\n      perror(\"gethostbyname\");\n      goto clean_and_exit;\n  }\n  sprintf(service_name, \"kadmin/%s\", hp->h_name);\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     service_name, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n      goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     KADM5_ADMIN_SERVICE, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n       goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context, \n\t\t\t     KADM5_CHANGEPW_SERVICE, realm, \n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED |\n\t\t\t     KRB5_KDB_PWCHANGE_SERVICE,\n\t\t\t     CHANGEPW_LIFETIME)))\n       goto clean_and_exit;\n  \nclean_and_exit:\n\n  return ret;\n}"
  },
  {
    "function_name": "build_name_with_realm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
    "lines": "144-151",
    "snippet": "static char *build_name_with_realm(char *name, char *realm)\n{\n     char *n;\n\n     n = (char *) malloc(strlen(name) + strlen(realm) + 2);\n     sprintf(n, \"%s@%s\", name, realm);\n     return n;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <krb5/kdb.h>",
      "#include <krb5.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <kadm5/adb.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include \"string_table.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "n",
            "\"%s@%s\"",
            "name",
            "realm"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "strlen(name) + strlen(realm) + 2"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "realm"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nstatic char *build_name_with_realm(char *name, char *realm)\n{\n     char *n;\n\n     n = (char *) malloc(strlen(name) + strlen(realm) + 2);\n     sprintf(n, \"%s@%s\", name, realm);\n     return n;\n}"
  },
  {
    "function_name": "kadm5_create_magic_princs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
    "lines": "101-125",
    "snippet": "int kadm5_create_magic_princs(kadm5_config_params *params,\n\t\t\t      krb5_context context)\n{\n     int retval;\n     void *handle;\n     \n     retval = krb5_klog_init(context, \"admin_server\", progname, 0);\n     if (retval)\n\t  return retval;\n     if ((retval = kadm5_init(progname, NULL, NULL, params,\n\t\t\t      KADM5_STRUCT_VERSION,\n\t\t\t      KADM5_API_VERSION_2,\n\t\t\t      &handle))) {\n\t  com_err(progname, retval, \"while initializing the Kerberos admin interface\");\n\t  return retval;\n     }\n\n     retval = add_admin_princs(handle, context, params->realm);\n\n     kadm5_destroy(handle);\n\n     krb5_klog_close(context);\n\n     return retval;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <krb5/kdb.h>",
      "#include <krb5.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <kadm5/adb.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include \"string_table.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "krb5_klog_close",
          "args": [
            "context"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_destroy",
          "args": [
            "handle"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "add_admin_princs",
          "args": [
            "handle",
            "context",
            "params->realm"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "add_admin_princs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
          "lines": "173-215",
          "snippet": "static int add_admin_princs(void *handle, krb5_context context, char *realm)\n{\n  krb5_error_code ret = 0;\n  char service_name[MAXHOSTNAMELEN + 8];\n  char localname[MAXHOSTNAMELEN];\n  struct hostent *hp;\n\n  if (gethostname(localname, MAXHOSTNAMELEN)) {\n      ret = errno;\n      perror(\"gethostname\");\n      goto clean_and_exit;\n  }\n  hp = gethostbyname(localname);\n  if (hp == NULL) {\n      ret = errno;\n      perror(\"gethostbyname\");\n      goto clean_and_exit;\n  }\n  sprintf(service_name, \"kadmin/%s\", hp->h_name);\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     service_name, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n      goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     KADM5_ADMIN_SERVICE, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n       goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context, \n\t\t\t     KADM5_CHANGEPW_SERVICE, realm, \n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED |\n\t\t\t     KRB5_KDB_PWCHANGE_SERVICE,\n\t\t\t     CHANGEPW_LIFETIME)))\n       goto clean_and_exit;\n  \nclean_and_exit:\n\n  return ret;\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <krb5/kdb.h>",
            "#include <krb5.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <kadm5/adb.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include \"string_table.h\""
          ],
          "macros_used": [
            "#define CHANGEPW_LIFETIME 60*5 /* 5 minutes */",
            "#define ADMIN_LIFETIME 60*60*3 /* 3 hours */"
          ],
          "globals_used": [
            "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\n#define CHANGEPW_LIFETIME 60*5 /* 5 minutes */\n#define ADMIN_LIFETIME 60*60*3 /* 3 hours */\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm)\n{\n  krb5_error_code ret = 0;\n  char service_name[MAXHOSTNAMELEN + 8];\n  char localname[MAXHOSTNAMELEN];\n  struct hostent *hp;\n\n  if (gethostname(localname, MAXHOSTNAMELEN)) {\n      ret = errno;\n      perror(\"gethostname\");\n      goto clean_and_exit;\n  }\n  hp = gethostbyname(localname);\n  if (hp == NULL) {\n      ret = errno;\n      perror(\"gethostbyname\");\n      goto clean_and_exit;\n  }\n  sprintf(service_name, \"kadmin/%s\", hp->h_name);\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     service_name, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n      goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context,\n\t\t\t     KADM5_ADMIN_SERVICE, realm,\n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED,\n\t\t\t     ADMIN_LIFETIME)))\n       goto clean_and_exit;\n\n  if ((ret = add_admin_princ(handle, context, \n\t\t\t     KADM5_CHANGEPW_SERVICE, realm, \n\t\t\t     KRB5_KDB_DISALLOW_TGT_BASED |\n\t\t\t     KRB5_KDB_PWCHANGE_SERVICE,\n\t\t\t     CHANGEPW_LIFETIME)))\n       goto clean_and_exit;\n  \nclean_and_exit:\n\n  return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while initializing the Kerberos admin interface\""
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_init",
          "args": [
            "progname",
            "NULL",
            "NULL",
            "params",
            "KADM5_STRUCT_VERSION",
            "KADM5_API_VERSION_2",
            "&handle"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_init",
          "args": [
            "context",
            "\"admin_server\"",
            "progname",
            "0"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nint kadm5_create_magic_princs(kadm5_config_params *params,\n\t\t\t      krb5_context context)\n{\n     int retval;\n     void *handle;\n     \n     retval = krb5_klog_init(context, \"admin_server\", progname, 0);\n     if (retval)\n\t  return retval;\n     if ((retval = kadm5_init(progname, NULL, NULL, params,\n\t\t\t      KADM5_STRUCT_VERSION,\n\t\t\t      KADM5_API_VERSION_2,\n\t\t\t      &handle))) {\n\t  com_err(progname, retval, \"while initializing the Kerberos admin interface\");\n\t  return retval;\n     }\n\n     retval = add_admin_princs(handle, context, params->realm);\n\n     kadm5_destroy(handle);\n\n     krb5_klog_close(context);\n\n     return retval;\n}"
  },
  {
    "function_name": "kadm5_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
    "lines": "68-99",
    "snippet": "int kadm5_create(kadm5_config_params *params)\n{\n     int retval;\n     krb5_context context;\n\n     kadm5_config_params lparams;\n\n     if ((retval = krb5_init_context(&context)))\n\t  exit(ERR);\n\n     /*\n      * The lock file has to exist before calling kadm5_init, but\n      * params->admin_lockfile may not be set yet...\n      */\n     if ((retval = kadm5_get_config_params(context, NULL, NULL,\n\t\t\t\t\t   params, &lparams))) {\n\t  com_err(progname, retval, \"while looking up the Kerberos configuration\");\n\t  return 1;\n     }\n\n     if ((retval = osa_adb_create_policy_db(&lparams))) {\n\t  com_err(progname, retval, str_CREATING_POLICY_DB);\n\t  return 1;\n     }\n\n     retval = kadm5_create_magic_princs(&lparams, context);\n\n     kadm5_free_config_params(context, &lparams);\n     krb5_free_context(context);\n\n     return retval;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <krb5/kdb.h>",
      "#include <krb5.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <kadm5/adb.h>",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include \"string_table.h\""
    ],
    "macros_used": [
      "#define ERR 1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "krb5_free_context",
          "args": [
            "context"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_config_params",
          "args": [
            "context",
            "&lparams"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_magic_princs",
          "args": [
            "&lparams",
            "context"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_create_magic_princs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kadm5_create.c",
          "lines": "101-125",
          "snippet": "int kadm5_create_magic_princs(kadm5_config_params *params,\n\t\t\t      krb5_context context)\n{\n     int retval;\n     void *handle;\n     \n     retval = krb5_klog_init(context, \"admin_server\", progname, 0);\n     if (retval)\n\t  return retval;\n     if ((retval = kadm5_init(progname, NULL, NULL, params,\n\t\t\t      KADM5_STRUCT_VERSION,\n\t\t\t      KADM5_API_VERSION_2,\n\t\t\t      &handle))) {\n\t  com_err(progname, retval, \"while initializing the Kerberos admin interface\");\n\t  return retval;\n     }\n\n     retval = add_admin_princs(handle, context, params->realm);\n\n     kadm5_destroy(handle);\n\n     krb5_klog_close(context);\n\n     return retval;\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <krb5/kdb.h>",
            "#include <krb5.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <kadm5/adb.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include \"string_table.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int add_admin_princs(void *handle, krb5_context context, char *realm);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\nstatic int add_admin_princs(void *handle, krb5_context context, char *realm);\n\nint kadm5_create_magic_princs(kadm5_config_params *params,\n\t\t\t      krb5_context context)\n{\n     int retval;\n     void *handle;\n     \n     retval = krb5_klog_init(context, \"admin_server\", progname, 0);\n     if (retval)\n\t  return retval;\n     if ((retval = kadm5_init(progname, NULL, NULL, params,\n\t\t\t      KADM5_STRUCT_VERSION,\n\t\t\t      KADM5_API_VERSION_2,\n\t\t\t      &handle))) {\n\t  com_err(progname, retval, \"while initializing the Kerberos admin interface\");\n\t  return retval;\n     }\n\n     retval = add_admin_princs(handle, context, params->realm);\n\n     kadm5_destroy(handle);\n\n     krb5_klog_close(context);\n\n     return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "str_CREATING_POLICY_DB"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osa_adb_create_policy_db",
          "args": [
            "&lparams"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while looking up the Kerberos configuration\""
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_config_params",
          "args": [
            "context",
            "NULL",
            "NULL",
            "params",
            "&lparams"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "ERR"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "request_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/ovsec_kadmd.c",
          "lines": "841-846",
          "snippet": "void request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}",
          "includes": [
            "#include    \"purify.h\"",
            "#include    \"misc.h\"",
            "#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */",
            "#include    <string.h>",
            "#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */",
            "#include    <krb5/adm_proto.h>",
            "#include    <kadm5/server_acl.h>",
            "#include    <kadm5/kadm_rpc.h>",
            "#include    <kadm5/admin.h>",
            "#include    <gssrpc/auth_gssapi.h>",
            "#include    \"gssapiP_krb5.h\" /* for kg_get_context */",
            "#include    <gssapi/gssapi.h>",
            "#include    <gssrpc/rpc.h>",
            "#include    <arpa/inet.h>  /* inet_ntoa */",
            "#include    <netinet/in.h>",
            "#include    <unistd.h>",
            "#include    <sys/socket.h>",
            "#include    <sys/time.h>",
            "#include    <sys/select.h>",
            "#include    <sys/types.h>",
            "#include    <syslog.h>",
            "#include    <signal.h>",
            "#include    <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "volatile int\tsignal_request_exit = 0;",
            "void\trequest_exit(int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include    \"purify.h\"\n#include    \"misc.h\"\n#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */\n#include    <string.h>\n#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */\n#include    <krb5/adm_proto.h>\n#include    <kadm5/server_acl.h>\n#include    <kadm5/kadm_rpc.h>\n#include    <kadm5/admin.h>\n#include    <gssrpc/auth_gssapi.h>\n#include    \"gssapiP_krb5.h\" /* for kg_get_context */\n#include    <gssapi/gssapi.h>\n#include    <gssrpc/rpc.h>\n#include    <arpa/inet.h>  /* inet_ntoa */\n#include    <netinet/in.h>\n#include    <unistd.h>\n#include    <sys/socket.h>\n#include    <sys/time.h>\n#include    <sys/select.h>\n#include    <sys/types.h>\n#include    <syslog.h>\n#include    <signal.h>\n#include    <stdio.h>\n\nvolatile int\tsignal_request_exit = 0;\nvoid\trequest_exit(int);\n\nvoid request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_init_context",
          "args": [
            "&context"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <krb5/kdb.h>\n#include <krb5.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <kadm5/adb.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include \"string_table.h\"\n\n#define ERR 1\n\nint kadm5_create(kadm5_config_params *params)\n{\n     int retval;\n     krb5_context context;\n\n     kadm5_config_params lparams;\n\n     if ((retval = krb5_init_context(&context)))\n\t  exit(ERR);\n\n     /*\n      * The lock file has to exist before calling kadm5_init, but\n      * params->admin_lockfile may not be set yet...\n      */\n     if ((retval = kadm5_get_config_params(context, NULL, NULL,\n\t\t\t\t\t   params, &lparams))) {\n\t  com_err(progname, retval, \"while looking up the Kerberos configuration\");\n\t  return 1;\n     }\n\n     if ((retval = osa_adb_create_policy_db(&lparams))) {\n\t  com_err(progname, retval, str_CREATING_POLICY_DB);\n\t  return 1;\n     }\n\n     retval = kadm5_create_magic_princs(&lparams, context);\n\n     kadm5_free_config_params(context, &lparams);\n     krb5_free_context(context);\n\n     return retval;\n}"
  }
]