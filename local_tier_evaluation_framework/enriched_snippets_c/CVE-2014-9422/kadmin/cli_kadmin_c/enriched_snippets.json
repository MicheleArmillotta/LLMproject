[
  {
    "function_name": "kadmin_getprivs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1532-1557",
    "snippet": "void kadmin_getprivs(argc, argv)\n    int argc;\n    char *argv[];\n{\n    static char *privs[] = {\"GET\", \"ADD\", \"MODIFY\", \"DELETE\"};\n    krb5_error_code retval;\n    int i;\n    long plist;\n\n    if (argc != 1) {\n\tfprintf(stderr, \"usage: get_privs\\n\");\n\treturn;\n    }\n    retval = kadm5_get_privs(handle, &plist);\n    if (retval) {\n\tcom_err(\"get_privs\", retval, \"while retrieving privileges\");\n\treturn;\n    }\n    printf(\"current privileges:\");\n    for (i = 0; i < sizeof (privs) / sizeof (char *); i++) {\n\tif (plist & 1 << i)\n\t    printf(\" %s\", privs[i]);\n    }\n    printf(\"\\n\");\n    return;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 1555
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" %s\"",
            "privs[i]"
          ],
          "line": 1553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"current privileges:\""
          ],
          "line": 1550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_privs\"",
            "retval",
            "\"while retrieving privileges\""
          ],
          "line": 1547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_privs",
          "args": [
            "handle",
            "&plist"
          ],
          "line": 1545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: get_privs\\n\""
          ],
          "line": 1542
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_getprivs(argc, argv)\n    int argc;\n    char *argv[];\n{\n    static char *privs[] = {\"GET\", \"ADD\", \"MODIFY\", \"DELETE\"};\n    krb5_error_code retval;\n    int i;\n    long plist;\n\n    if (argc != 1) {\n\tfprintf(stderr, \"usage: get_privs\\n\");\n\treturn;\n    }\n    retval = kadm5_get_privs(handle, &plist);\n    if (retval) {\n\tcom_err(\"get_privs\", retval, \"while retrieving privileges\");\n\treturn;\n    }\n    printf(\"current privileges:\");\n    for (i = 0; i < sizeof (privs) / sizeof (char *); i++) {\n\tif (plist & 1 << i)\n\t    printf(\" %s\", privs[i]);\n    }\n    printf(\"\\n\");\n    return;\n}"
  },
  {
    "function_name": "kadmin_getpols",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1509-1530",
    "snippet": "void kadmin_getpols(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    char *expr, **names;\n    int i, count;\n\n    expr = NULL;\n    if (! (argc == 1 || (argc == 2 && (expr = argv[1])))) {\n\tfprintf(stderr, \"usage: get_policies [expression]\\n\");\n\treturn;\n    }\n    retval = kadm5_get_policies(handle, expr, &names, &count);\n    if (retval) {\n\tcom_err(\"get_policies\", retval, \"while retrieving list.\");\n\treturn;\n    }\n    for (i = 0; i < count; i++)\n\t printf(\"%s\\n\", names[i]);\n    kadm5_free_name_list(handle, names, count);\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "kadm5_free_name_list",
          "args": [
            "handle",
            "names",
            "count"
          ],
          "line": 1529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s\\n\"",
            "names[i]"
          ],
          "line": 1528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_policies\"",
            "retval",
            "\"while retrieving list.\""
          ],
          "line": 1524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policies",
          "args": [
            "handle",
            "expr",
            "&names",
            "&count"
          ],
          "line": 1522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: get_policies [expression]\\n\""
          ],
          "line": 1519
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_getpols(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    char *expr, **names;\n    int i, count;\n\n    expr = NULL;\n    if (! (argc == 1 || (argc == 2 && (expr = argv[1])))) {\n\tfprintf(stderr, \"usage: get_policies [expression]\\n\");\n\treturn;\n    }\n    retval = kadm5_get_policies(handle, expr, &names, &count);\n    if (retval) {\n\tcom_err(\"get_policies\", retval, \"while retrieving list.\");\n\treturn;\n    }\n    for (i = 0; i < count; i++)\n\t printf(\"%s\\n\", names[i]);\n    kadm5_free_name_list(handle, names, count);\n}"
  },
  {
    "function_name": "kadmin_getpol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1472-1507",
    "snippet": "void kadmin_getpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    kadm5_policy_ent_rec policy;\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-terse\", argv[1])))) {\n\tfprintf(stderr, \"usage: get_policy [-terse] policy\\n\");\n\treturn;\n    }\n    retval = kadm5_get_policy(handle, argv[argc - 1], &policy);\n    if (retval) {\n\tcom_err(\"get_policy\", retval, \"while retrieving policy \\\"%s\\\".\",\n\t\targv[argc - 1]);\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Policy: %s\\n\", policy.policy);\n\tprintf(\"Maximum password life: %ld\\n\", policy.pw_max_life);\n\tprintf(\"Minimum password life: %ld\\n\", policy.pw_min_life);\n\tprintf(\"Minimum password length: %ld\\n\", policy.pw_min_length);\n\tprintf(\"Minimum number of password character classes: %ld\\n\",\n\t       policy.pw_min_classes);\n\tprintf(\"Number of old keys kept: %ld\\n\", policy.pw_history_num);\n\tprintf(\"Reference count: %ld\\n\", policy.policy_refcnt);\n    } else {\n\tprintf(\"\\\"%s\\\"\\t%ld\\t%ld\\t%ld\\t%ld\\t%ld\\t%ld\\n\",\n\t       policy.policy, policy.pw_max_life, policy.pw_min_life,\n\t       policy.pw_min_length, policy.pw_min_classes,\n\t       policy.pw_history_num, policy.policy_refcnt);\n    }\n    kadm5_free_policy_ent(handle, &policy);\n    return;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "kadm5_free_policy_ent",
          "args": [
            "handle",
            "&policy"
          ],
          "line": 1505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\\"%s\\\"\\t%ld\\t%ld\\t%ld\\t%ld\\t%ld\\t%ld\\n\"",
            "policy.policy",
            "policy.pw_max_life",
            "policy.pw_min_life",
            "policy.pw_min_length",
            "policy.pw_min_classes",
            "policy.pw_history_num",
            "policy.policy_refcnt"
          ],
          "line": 1500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Reference count: %ld\\n\"",
            "policy.policy_refcnt"
          ],
          "line": 1498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Number of old keys kept: %ld\\n\"",
            "policy.pw_history_num"
          ],
          "line": 1497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Minimum number of password character classes: %ld\\n\"",
            "policy.pw_min_classes"
          ],
          "line": 1495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Minimum password length: %ld\\n\"",
            "policy.pw_min_length"
          ],
          "line": 1494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Minimum password life: %ld\\n\"",
            "policy.pw_min_life"
          ],
          "line": 1493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Maximum password life: %ld\\n\"",
            "policy.pw_max_life"
          ],
          "line": 1492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Policy: %s\\n\"",
            "policy.policy"
          ],
          "line": 1491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_policy\"",
            "retval",
            "\"while retrieving policy \\\"%s\\\".\"",
            "argv[argc - 1]"
          ],
          "line": 1486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policy",
          "args": [
            "handle",
            "argv[argc - 1]",
            "&policy"
          ],
          "line": 1484
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_get_policy_v1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_glue_v1.c",
          "lines": "28-32",
          "snippet": "kadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <kadm5/admin.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <kadm5/admin.h>\n\nkadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: get_policy [-terse] policy\\n\""
          ],
          "line": 1481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-terse\"",
            "argv[1]"
          ],
          "line": 1480
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_getpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    kadm5_policy_ent_rec policy;\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-terse\", argv[1])))) {\n\tfprintf(stderr, \"usage: get_policy [-terse] policy\\n\");\n\treturn;\n    }\n    retval = kadm5_get_policy(handle, argv[argc - 1], &policy);\n    if (retval) {\n\tcom_err(\"get_policy\", retval, \"while retrieving policy \\\"%s\\\".\",\n\t\targv[argc - 1]);\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Policy: %s\\n\", policy.policy);\n\tprintf(\"Maximum password life: %ld\\n\", policy.pw_max_life);\n\tprintf(\"Minimum password life: %ld\\n\", policy.pw_min_life);\n\tprintf(\"Minimum password length: %ld\\n\", policy.pw_min_length);\n\tprintf(\"Minimum number of password character classes: %ld\\n\",\n\t       policy.pw_min_classes);\n\tprintf(\"Number of old keys kept: %ld\\n\", policy.pw_history_num);\n\tprintf(\"Reference count: %ld\\n\", policy.policy_refcnt);\n    } else {\n\tprintf(\"\\\"%s\\\"\\t%ld\\t%ld\\t%ld\\t%ld\\t%ld\\t%ld\\n\",\n\t       policy.policy, policy.pw_max_life, policy.pw_min_life,\n\t       policy.pw_min_length, policy.pw_min_classes,\n\t       policy.pw_history_num, policy.policy_refcnt);\n    }\n    kadm5_free_policy_ent(handle, &policy);\n    return;\n}"
  },
  {
    "function_name": "kadmin_delpol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1443-1470",
    "snippet": "void kadmin_delpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    char reply[5];\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-force\", argv[1])))) {\n\tfprintf(stderr, \"usage: delete_policy [-force] policy\\n\");\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Are you sure you want to delete the policy \\\"%s\\\"? (yes/no): \", argv[1]);\n\tfgets(reply, sizeof (reply), stdin);\n\tif (strcmp(\"yes\\n\", reply)) {\n\t    fprintf(stderr, \"Policy \\\"%s\\\" not deleted.\\n\", argv[1]);\n\t    return;\n\t}\n    }\n    retval = kadm5_delete_policy(handle, argv[argc - 1]);\n    if (retval) {\n\tcom_err(\"delete_policy:\", retval, \"while deleting policy \\\"%s\\\"\",\n\t\targv[argc - 1]);\n\treturn;\n    }\n    return;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"delete_policy:\"",
            "retval",
            "\"while deleting policy \\\"%s\\\"\"",
            "argv[argc - 1]"
          ],
          "line": 1465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_delete_policy",
          "args": [
            "handle",
            "argv[argc - 1]"
          ],
          "line": 1463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Policy \\\"%s\\\" not deleted.\\n\"",
            "argv[1]"
          ],
          "line": 1459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"yes\\n\"",
            "reply"
          ],
          "line": 1458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "reply",
            "sizeof (reply)",
            "stdin"
          ],
          "line": 1457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Are you sure you want to delete the policy \\\"%s\\\"? (yes/no): \"",
            "argv[1]"
          ],
          "line": 1456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: delete_policy [-force] policy\\n\""
          ],
          "line": 1452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-force\"",
            "argv[1]"
          ],
          "line": 1451
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_delpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    char reply[5];\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-force\", argv[1])))) {\n\tfprintf(stderr, \"usage: delete_policy [-force] policy\\n\");\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Are you sure you want to delete the policy \\\"%s\\\"? (yes/no): \", argv[1]);\n\tfgets(reply, sizeof (reply), stdin);\n\tif (strcmp(\"yes\\n\", reply)) {\n\t    fprintf(stderr, \"Policy \\\"%s\\\" not deleted.\\n\", argv[1]);\n\t    return;\n\t}\n    }\n    retval = kadm5_delete_policy(handle, argv[argc - 1]);\n    if (retval) {\n\tcom_err(\"delete_policy:\", retval, \"while deleting policy \\\"%s\\\"\",\n\t\targv[argc - 1]);\n\treturn;\n    }\n    return;\n}"
  },
  {
    "function_name": "kadmin_modpol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1418-1441",
    "snippet": "void kadmin_modpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    long mask;\n    kadm5_policy_ent_rec policy;\n\n    memset(&policy, 0, sizeof(policy));\n    if (kadmin_parse_policy_args(argc, argv, &policy, &mask,\n\t\t\t\t \"modify_policy\")) {\n\tkadmin_addmodpol_usage(\"modify_policy\");\n\treturn;\n    } else {\n\tpolicy.policy = argv[argc - 1];\n\tretval = kadm5_modify_policy(handle, &policy, mask);\n\tif (retval) {\n\t    com_err(\"modify_policy\", retval, \"while modifying policy \\\"%s\\\".\",\n\t\t    policy.policy);\n\t    return;\n\t}\n    }\n    return;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"modify_policy\"",
            "retval",
            "\"while modifying policy \\\"%s\\\".\"",
            "policy.policy"
          ],
          "line": 1435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_modify_policy",
          "args": [
            "handle",
            "&policy",
            "mask"
          ],
          "line": 1433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_addmodpol_usage",
          "args": [
            "\"modify_policy\""
          ],
          "line": 1429
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_addmodpol_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "1384-1391",
          "snippet": "static void \nkadmin_addmodpol_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage; %s [options] policy\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\");\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_addmodpol_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage; %s [options] policy\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadmin_parse_policy_args",
          "args": [
            "argc",
            "argv",
            "&policy",
            "&mask",
            "\"modify_policy\""
          ],
          "line": 1427
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_policy_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "1302-1382",
          "snippet": "static int \nkadmin_parse_policy_args(argc, argv, policy, mask, caller)\n    int argc;\n    char *argv[];\n    kadm5_policy_ent_t policy;\n    long *mask;\n    char *caller;\n{\n    int i;\n    time_t now;\n    time_t date;\n\n    time(&now);\n    *mask = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(argv[i], \"-maxlife\")) {\n\t    if (++i > argc -2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_max_life = date - now;\n\t\t*mask |= KADM5_PW_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-minlife\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_min_life = date - now;\n\t\t*mask |= KADM5_PW_MIN_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 10 &&\n\t    !strcmp(argv[i], \"-minlength\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_length = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_LENGTH;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 11 &&\n\t\t   !strcmp(argv[i], \"-minclasses\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_classes = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_CLASSES;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-history\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_history_num = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_HISTORY_NUM;\n\t\tcontinue;\n\t    }\n\t} else\n\t    return -1;\n    }\n    if (i != argc -1) {\n\tfprintf(stderr, \"%s: parser lost count!\\n\", caller);\n\treturn -1;\n    } else\n\treturn 0;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *kadmin_startup(argc, argv)\n    int argc;",
            "char *argv[];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nstatic int \nkadmin_parse_policy_args(argc, argv, policy, mask, caller)\n    int argc;\n    char *argv[];\n    kadm5_policy_ent_t policy;\n    long *mask;\n    char *caller;\n{\n    int i;\n    time_t now;\n    time_t date;\n\n    time(&now);\n    *mask = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(argv[i], \"-maxlife\")) {\n\t    if (++i > argc -2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_max_life = date - now;\n\t\t*mask |= KADM5_PW_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-minlife\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_min_life = date - now;\n\t\t*mask |= KADM5_PW_MIN_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 10 &&\n\t    !strcmp(argv[i], \"-minlength\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_length = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_LENGTH;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 11 &&\n\t\t   !strcmp(argv[i], \"-minclasses\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_classes = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_CLASSES;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-history\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_history_num = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_HISTORY_NUM;\n\t\tcontinue;\n\t    }\n\t} else\n\t    return -1;\n    }\n    if (i != argc -1) {\n\tfprintf(stderr, \"%s: parser lost count!\\n\", caller);\n\treturn -1;\n    } else\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&policy",
            "0",
            "sizeof(policy)"
          ],
          "line": 1426
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_modpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    long mask;\n    kadm5_policy_ent_rec policy;\n\n    memset(&policy, 0, sizeof(policy));\n    if (kadmin_parse_policy_args(argc, argv, &policy, &mask,\n\t\t\t\t \"modify_policy\")) {\n\tkadmin_addmodpol_usage(\"modify_policy\");\n\treturn;\n    } else {\n\tpolicy.policy = argv[argc - 1];\n\tretval = kadm5_modify_policy(handle, &policy, mask);\n\tif (retval) {\n\t    com_err(\"modify_policy\", retval, \"while modifying policy \\\"%s\\\".\",\n\t\t    policy.policy);\n\t    return;\n\t}\n    }\n    return;\n}"
  },
  {
    "function_name": "kadmin_addpol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1393-1416",
    "snippet": "void kadmin_addpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    long mask;\n    kadm5_policy_ent_rec policy;\n\n    memset(&policy, 0, sizeof(policy));\n    if (kadmin_parse_policy_args(argc, argv, &policy, &mask, \"add_policy\")) {\n\t kadmin_addmodpol_usage(\"add_policy\");\n\t return;\n    } else {\n\tpolicy.policy = argv[argc - 1];\n\tmask |= KADM5_POLICY;\n\tretval = kadm5_create_policy(handle, &policy, mask);\n\tif (retval) {\n\t    com_err(\"add_policy\", retval, \"while creating policy \\\"%s\\\".\",\n\t\t    policy.policy);\n\t    return;\n\t}\n    }\n    return;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"add_policy\"",
            "retval",
            "\"while creating policy \\\"%s\\\".\"",
            "policy.policy"
          ],
          "line": 1410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_policy",
          "args": [
            "handle",
            "&policy",
            "mask"
          ],
          "line": 1408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_addmodpol_usage",
          "args": [
            "\"add_policy\""
          ],
          "line": 1403
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_addmodpol_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "1384-1391",
          "snippet": "static void \nkadmin_addmodpol_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage; %s [options] policy\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\");\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_addmodpol_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage; %s [options] policy\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadmin_parse_policy_args",
          "args": [
            "argc",
            "argv",
            "&policy",
            "&mask",
            "\"add_policy\""
          ],
          "line": 1402
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_policy_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "1302-1382",
          "snippet": "static int \nkadmin_parse_policy_args(argc, argv, policy, mask, caller)\n    int argc;\n    char *argv[];\n    kadm5_policy_ent_t policy;\n    long *mask;\n    char *caller;\n{\n    int i;\n    time_t now;\n    time_t date;\n\n    time(&now);\n    *mask = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(argv[i], \"-maxlife\")) {\n\t    if (++i > argc -2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_max_life = date - now;\n\t\t*mask |= KADM5_PW_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-minlife\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_min_life = date - now;\n\t\t*mask |= KADM5_PW_MIN_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 10 &&\n\t    !strcmp(argv[i], \"-minlength\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_length = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_LENGTH;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 11 &&\n\t\t   !strcmp(argv[i], \"-minclasses\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_classes = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_CLASSES;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-history\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_history_num = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_HISTORY_NUM;\n\t\tcontinue;\n\t    }\n\t} else\n\t    return -1;\n    }\n    if (i != argc -1) {\n\tfprintf(stderr, \"%s: parser lost count!\\n\", caller);\n\treturn -1;\n    } else\n\treturn 0;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *kadmin_startup(argc, argv)\n    int argc;",
            "char *argv[];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nstatic int \nkadmin_parse_policy_args(argc, argv, policy, mask, caller)\n    int argc;\n    char *argv[];\n    kadm5_policy_ent_t policy;\n    long *mask;\n    char *caller;\n{\n    int i;\n    time_t now;\n    time_t date;\n\n    time(&now);\n    *mask = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(argv[i], \"-maxlife\")) {\n\t    if (++i > argc -2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_max_life = date - now;\n\t\t*mask |= KADM5_PW_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-minlife\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_min_life = date - now;\n\t\t*mask |= KADM5_PW_MIN_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 10 &&\n\t    !strcmp(argv[i], \"-minlength\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_length = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_LENGTH;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 11 &&\n\t\t   !strcmp(argv[i], \"-minclasses\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_classes = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_CLASSES;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-history\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_history_num = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_HISTORY_NUM;\n\t\tcontinue;\n\t    }\n\t} else\n\t    return -1;\n    }\n    if (i != argc -1) {\n\tfprintf(stderr, \"%s: parser lost count!\\n\", caller);\n\treturn -1;\n    } else\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&policy",
            "0",
            "sizeof(policy)"
          ],
          "line": 1401
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_addpol(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    long mask;\n    kadm5_policy_ent_rec policy;\n\n    memset(&policy, 0, sizeof(policy));\n    if (kadmin_parse_policy_args(argc, argv, &policy, &mask, \"add_policy\")) {\n\t kadmin_addmodpol_usage(\"add_policy\");\n\t return;\n    } else {\n\tpolicy.policy = argv[argc - 1];\n\tmask |= KADM5_POLICY;\n\tretval = kadm5_create_policy(handle, &policy, mask);\n\tif (retval) {\n\t    com_err(\"add_policy\", retval, \"while creating policy \\\"%s\\\".\",\n\t\t    policy.policy);\n\t    return;\n\t}\n    }\n    return;\n}"
  },
  {
    "function_name": "kadmin_addmodpol_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1384-1391",
    "snippet": "static void \nkadmin_addmodpol_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage; %s [options] policy\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\");\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\""
          ],
          "line": 1390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\toptions are:\\n\""
          ],
          "line": 1389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage; %s [options] policy\\n\"",
            "func"
          ],
          "line": 1388
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_addmodpol_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage; %s [options] policy\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-maxlife time] [-minlife time] [-minlength length]\\n\\t\\t[-minclasses number] [-history number]\\n\");\n}"
  },
  {
    "function_name": "kadmin_parse_policy_args",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1302-1382",
    "snippet": "static int \nkadmin_parse_policy_args(argc, argv, policy, mask, caller)\n    int argc;\n    char *argv[];\n    kadm5_policy_ent_t policy;\n    long *mask;\n    char *caller;\n{\n    int i;\n    time_t now;\n    time_t date;\n\n    time(&now);\n    *mask = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(argv[i], \"-maxlife\")) {\n\t    if (++i > argc -2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_max_life = date - now;\n\t\t*mask |= KADM5_PW_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-minlife\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_min_life = date - now;\n\t\t*mask |= KADM5_PW_MIN_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 10 &&\n\t    !strcmp(argv[i], \"-minlength\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_length = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_LENGTH;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 11 &&\n\t\t   !strcmp(argv[i], \"-minclasses\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_classes = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_CLASSES;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-history\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_history_num = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_HISTORY_NUM;\n\t\tcontinue;\n\t    }\n\t} else\n\t    return -1;\n    }\n    if (i != argc -1) {\n\tfprintf(stderr, \"%s: parser lost count!\\n\", caller);\n\treturn -1;\n    } else\n\treturn 0;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s: parser lost count!\\n\"",
            "caller"
          ],
          "line": 1378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "argv[i]"
          ],
          "line": 1370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"-history\""
          ],
          "line": 1366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 1365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "argv[i]"
          ],
          "line": 1361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"-minclasses\""
          ],
          "line": 1357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 1356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "argv[i]"
          ],
          "line": 1352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"-minlength\""
          ],
          "line": 1348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 1347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Invalid date specification \\\"%s\\\".\\n\"",
            "argv[i]"
          ],
          "line": 1339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_date",
          "args": [
            "argv[i]"
          ],
          "line": 1337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"-minlife\""
          ],
          "line": 1333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 1332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Invalid date specification \\\"%s\\\".\\n\"",
            "argv[i]"
          ],
          "line": 1324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_date",
          "args": [
            "argv[i]"
          ],
          "line": 1322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"-maxlife\""
          ],
          "line": 1318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 1317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&now"
          ],
          "line": 1314
        },
        "resolved": true,
        "details": {
          "function_name": "strftime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/strftime.c",
          "lines": "102-121",
          "snippet": "size_t\nstrftime(s, maxsize, format, t)\n\tchar *s;\n\tsize_t maxsize;\n\tconst char *format;\n\tconst struct tm *t;\n{\n\tchar *pt;\n\n\ttzset();\n\tif (maxsize < 1)\n\t\treturn (0);\n\n\tpt = s;\n\tif (_fmt(format, t, &pt, s + maxsize)) {\n\t\t*pt = '\\0';\n\t\treturn (pt - s);\n\t} else\n\t\treturn (0);\n}",
          "includes": [
            "#include <time.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static\tsize_t _fmt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <string.h>\n\nstatic\tsize_t _fmt;\n\nsize_t\nstrftime(s, maxsize, format, t)\n\tchar *s;\n\tsize_t maxsize;\n\tconst char *format;\n\tconst struct tm *t;\n{\n\tchar *pt;\n\n\ttzset();\n\tif (maxsize < 1)\n\t\treturn (0);\n\n\tpt = s;\n\tif (_fmt(format, t, &pt, s + maxsize)) {\n\t\t*pt = '\\0';\n\t\treturn (pt - s);\n\t} else\n\t\treturn (0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nstatic int \nkadmin_parse_policy_args(argc, argv, policy, mask, caller)\n    int argc;\n    char *argv[];\n    kadm5_policy_ent_t policy;\n    long *mask;\n    char *caller;\n{\n    int i;\n    time_t now;\n    time_t date;\n\n    time(&now);\n    *mask = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(argv[i], \"-maxlife\")) {\n\t    if (++i > argc -2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_max_life = date - now;\n\t\t*mask |= KADM5_PW_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-minlife\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\tpolicy->pw_min_life = date - now;\n\t\t*mask |= KADM5_PW_MIN_LIFE;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 10 &&\n\t    !strcmp(argv[i], \"-minlength\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_length = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_LENGTH;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 11 &&\n\t\t   !strcmp(argv[i], \"-minclasses\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_min_classes = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_MIN_CLASSES;\n\t\tcontinue;\n\t    }\n\t} else if (strlen(argv[i]) == 8 &&\n\t\t   !strcmp(argv[i], \"-history\")) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tpolicy->pw_history_num = atoi(argv[i]);\n\t\t*mask |= KADM5_PW_HISTORY_NUM;\n\t\tcontinue;\n\t    }\n\t} else\n\t    return -1;\n    }\n    if (i != argc -1) {\n\tfprintf(stderr, \"%s: parser lost count!\\n\", caller);\n\treturn -1;\n    } else\n\treturn 0;\n}"
  },
  {
    "function_name": "kadmin_getprincs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1279-1300",
    "snippet": "void kadmin_getprincs(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    char *expr, **names;\n    int i, count;\n\n    expr = NULL;\n    if (! (argc == 1 || (argc == 2 && (expr = argv[1])))) {\n\tfprintf(stderr, \"usage: get_principals [expression]\\n\");\n\treturn;\n    }\n    retval = kadm5_get_principals(handle, expr, &names, &count);\n    if (retval) {\n\tcom_err(\"get_principals\", retval, \"while retrieving list.\");\n\treturn;\n    }\n    for (i = 0; i < count; i++)\n\t printf(\"%s\\n\", names[i]);\n    kadm5_free_name_list(handle, names, count);\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "kadm5_free_name_list",
          "args": [
            "handle",
            "names",
            "count"
          ],
          "line": 1299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s\\n\"",
            "names[i]"
          ],
          "line": 1298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_principals\"",
            "retval",
            "\"while retrieving list.\""
          ],
          "line": 1294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principals",
          "args": [
            "handle",
            "expr",
            "&names",
            "&count"
          ],
          "line": 1292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: get_principals [expression]\\n\""
          ],
          "line": 1289
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_getprincs(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n    char *expr, **names;\n    int i, count;\n\n    expr = NULL;\n    if (! (argc == 1 || (argc == 2 && (expr = argv[1])))) {\n\tfprintf(stderr, \"usage: get_principals [expression]\\n\");\n\treturn;\n    }\n    retval = kadm5_get_principals(handle, expr, &names, &count);\n    if (retval) {\n\tcom_err(\"get_principals\", retval, \"while retrieving list.\");\n\treturn;\n    }\n    for (i = 0; i < count; i++)\n\t printf(\"%s\\n\", names[i]);\n    kadm5_free_name_list(handle, names, count);\n}"
  },
  {
    "function_name": "kadmin_getprinc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1163-1277",
    "snippet": "void kadmin_getprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_principal_ent_rec dprinc;\n    krb5_principal princ;\n    krb5_error_code retval;\n    char *canon, *modcanon;\n    int i;\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-terse\", argv[1])))) {\n\tfprintf(stderr, \"usage: get_principal [-terse] principal\\n\");\n\treturn;\n    }\n\n\n    memset(&dprinc, 0, sizeof(dprinc));\n    memset(&princ, 0, sizeof(princ));\n\n    retval = kadmin_parse_name(argv[argc - 1], &princ);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while parsing principal\");\n\treturn;\n    }\n    retval = krb5_unparse_name(context, princ, &canon);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ);\n\treturn;\n    }\n    retval = kadm5_get_principal(handle, princ, &dprinc,\n\t\t\t\t KADM5_PRINCIPAL_NORMAL_MASK | KADM5_KEY_DATA);\n    krb5_free_principal(context, princ);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while retrieving \\\"%s\\\".\", canon);\n\tfree(canon);\n\treturn;\n    }\n    retval = krb5_unparse_name(context, dprinc.mod_name, &modcanon);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while unparsing modname\");\n\tkadm5_free_principal_ent(handle, &dprinc);\n\tfree(canon);\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Principal: %s\\n\", canon);\n\tprintf(\"Expiration date: %s\\n\", dprinc.princ_expire_time ?\n\t       strdate(dprinc.princ_expire_time) : \"[never]\");\n\tprintf(\"Last password change: %s\\n\", dprinc.last_pwd_change ? \n\t       strdate(dprinc.last_pwd_change) : \"[never]\");\n\tprintf(\"Password expiration date: %s\\n\",\n\t       dprinc.pw_expiration ?\n\t       strdate(dprinc.pw_expiration) : \"[none]\");\n\tprintf(\"Maximum ticket life: %s\\n\", strdur(dprinc.max_life));\n\tprintf(\"Maximum renewable life: %s\\n\", strdur(dprinc.max_renewable_life));\n\tprintf(\"Last modified: %s (%s)\\n\", strdate(dprinc.mod_date), modcanon);\n\tprintf(\"Last successful authentication: %s\\n\",\n\t       dprinc.last_success ? strdate(dprinc.last_success) :\n\t       \"[never]\"); \n\tprintf(\"Last failed authentication: %s\\n\",\n\t       dprinc.last_failed ? strdate(dprinc.last_failed) :\n\t       \"[never]\");\n\tprintf(\"Failed password attempts: %d\\n\",\n\t       dprinc.fail_auth_count);\n\tprintf(\"Number of keys: %d\\n\", dprinc.n_key_data);\n\tfor (i = 0; i < dprinc.n_key_data; i++) {\n\t     krb5_key_data *key_data = &dprinc.key_data[i];\n\t     char enctype[BUFSIZ], salttype[BUFSIZ];\n\t     \n\t     if (krb5_enctype_to_string(key_data->key_data_type[0],\n\t\t\t\t\tenctype, sizeof(enctype)))\n\t\t  sprintf(enctype, \"<Encryption type 0x%x>\",\n\t\t\t  key_data->key_data_type[0]);\n\t     printf(\"Key: vno %d, %s, \", key_data->key_data_kvno, enctype);\n\t     if (key_data->key_data_ver > 1) {\n\t\t  if (krb5_salttype_to_string(key_data->key_data_type[1],\n\t\t\t\t\t      salttype, sizeof(salttype)))\n\t\t       sprintf(salttype, \"<Salt type 0x%x>\",\n\t\t\t       key_data->key_data_type[1]);\n\t\t  printf(\"%s\\n\", salttype);\n\t     } else\n\t\t  printf(\"no salt\\n\");\n\t}\n\t\n\tprintf(\"Attributes:\");\n\tfor (i = 0; i < sizeof (prflags) / sizeof (char *); i++) {\n\t    if (dprinc.attributes & (krb5_flags) 1 << i)\n\t\tprintf(\" %s\", prflags[i]);\n\t}\n\tprintf(\"\\n\");\n\tprintf(\"Policy: %s\\n\", dprinc.policy ? dprinc.policy : \"[none]\");\n    } else {\n\tprintf(\"\\\"%s\\\"\\t%d\\t%d\\t%d\\t%d\\t\\\"%s\\\"\\t%d\\t%d\\t%d\\t%d\\t\\\"%s\\\"\"\n\t       \"\\t%d\\t%d\\t%d\\t%d\\t%d\",\n\t       canon, dprinc.princ_expire_time, dprinc.last_pwd_change,\n\t       dprinc.pw_expiration, dprinc.max_life, modcanon,\n\t       dprinc.mod_date, dprinc.attributes, dprinc.kvno,\n\t       dprinc.mkvno, dprinc.policy ? dprinc.policy : \"[none]\",\n\t       dprinc.max_renewable_life, dprinc.last_success,\n\t       dprinc.last_failed, dprinc.fail_auth_count,\n\t       dprinc.n_key_data);\n\tfor (i = 0; i < dprinc.n_key_data; i++)\n\t     printf(\"\\t%d\\t%d\\t%d\\t%d\",\n\t\t    dprinc.key_data[i].key_data_ver,\n\t\t    dprinc.key_data[i].key_data_kvno,\n\t\t    dprinc.key_data[i].key_data_type[0],\n\t\t    dprinc.key_data[i].key_data_type[1]);\n\tprintf(\"\\n\");\n   }\n    free(modcanon);\n    kadm5_free_principal_ent(handle, &dprinc);\n    free(canon);\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char *prflags[] = {\n    \"DISALLOW_POSTDATED\",\t/* 0x00000001 */\n    \"DISALLOW_FORWARDABLE\",\t/* 0x00000002 */\n    \"DISALLOW_TGT_BASED\",\t/* 0x00000004 */\n    \"DISALLOW_RENEWABLE\",\t/* 0x00000008 */\n    \"DISALLOW_PROXIABLE\",\t/* 0x00000010 */\n    \"DISALLOW_DUP_SKEY\",\t/* 0x00000020 */\n    \"DISALLOW_ALL_TIX\",\t\t/* 0x00000040 */\n    \"REQUIRES_PRE_AUTH\",\t/* 0x00000080 */\n    \"REQUIRES_HW_AUTH\",\t\t/* 0x00000100 */\n    \"REQUIRES_PWCHANGE\",\t/* 0x00000200 */\n    \"UNKNOWN_0x00000400\",\t/* 0x00000400 */\n    \"UNKNOWN_0x00000800\",\t/* 0x00000800 */\n    \"DISALLOW_SVR\",\t\t/* 0x00001000 */\n    \"PWCHANGE_SERVICE\",\t\t/* 0x00002000 */\n    \"SUPPORT_DESMD5\",\t\t/* 0x00004000 */\n    \"NEW_PRINC\",\t\t/* 0x00008000 */\n};",
      "void *handle = NULL;",
      "krb5_context context;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "canon"
          ],
          "line": 1276
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle",
            "&dprinc"
          ],
          "line": 1275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 1272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\t%d\\t%d\\t%d\\t%d\"",
            "dprinc.key_data[i].key_data_ver",
            "dprinc.key_data[i].key_data_kvno",
            "dprinc.key_data[i].key_data_type[0]",
            "dprinc.key_data[i].key_data_type[1]"
          ],
          "line": 1267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\\"%s\\\"\\t%d\\t%d\\t%d\\t%d\\t\\\"%s\\\"\\t%d\\t%d\\t%d\\t%d\\t\\\"%s\\\"\"\n\t       \"\\t%d\\t%d\\t%d\\t%d\\t%d\"",
            "canon",
            "dprinc.princ_expire_time",
            "dprinc.last_pwd_change",
            "dprinc.pw_expiration",
            "dprinc.max_life",
            "modcanon",
            "dprinc.mod_date",
            "dprinc.attributes",
            "dprinc.kvno",
            "dprinc.mkvno",
            "dprinc.policy ? dprinc.policy : \"[none]\"",
            "dprinc.max_renewable_life",
            "dprinc.last_success",
            "dprinc.last_failed",
            "dprinc.fail_auth_count",
            "dprinc.n_key_data"
          ],
          "line": 1257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Policy: %s\\n\"",
            "dprinc.policy ? dprinc.policy : \"[none]\""
          ],
          "line": 1255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 1254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" %s\"",
            "prflags[i]"
          ],
          "line": 1252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Attributes:\""
          ],
          "line": 1249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"no salt\\n\""
          ],
          "line": 1246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s\\n\"",
            "salttype"
          ],
          "line": 1244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "salttype",
            "\"<Salt type 0x%x>\"",
            "key_data->key_data_type[1]"
          ],
          "line": 1242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_salttype_to_string",
          "args": [
            "key_data->key_data_type[1]",
            "salttype",
            "sizeof(salttype)"
          ],
          "line": 1240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Key: vno %d, %s, \"",
            "key_data->key_data_kvno",
            "enctype"
          ],
          "line": 1238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "enctype",
            "\"<Encryption type 0x%x>\"",
            "key_data->key_data_type[0]"
          ],
          "line": 1236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_enctype_to_string",
          "args": [
            "key_data->key_data_type[0]",
            "enctype",
            "sizeof(enctype)"
          ],
          "line": 1234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Number of keys: %d\\n\"",
            "dprinc.n_key_data"
          ],
          "line": 1229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Failed password attempts: %d\\n\"",
            "dprinc.fail_auth_count"
          ],
          "line": 1227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Last failed authentication: %s\\n\"",
            "dprinc.last_failed ? strdate(dprinc.last_failed) :\n\t       \"[never]\""
          ],
          "line": 1224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdate",
          "args": [
            "dprinc.last_failed"
          ],
          "line": 1225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Last successful authentication: %s\\n\"",
            "dprinc.last_success ? strdate(dprinc.last_success) :\n\t       \"[never]\""
          ],
          "line": 1221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdate",
          "args": [
            "dprinc.last_success"
          ],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Last modified: %s (%s)\\n\"",
            "strdate(dprinc.mod_date)",
            "modcanon"
          ],
          "line": 1220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdate",
          "args": [
            "dprinc.mod_date"
          ],
          "line": 1220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Maximum renewable life: %s\\n\"",
            "strdur(dprinc.max_renewable_life)"
          ],
          "line": 1219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdur",
          "args": [
            "dprinc.max_renewable_life"
          ],
          "line": 1219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Maximum ticket life: %s\\n\"",
            "strdur(dprinc.max_life)"
          ],
          "line": 1218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdur",
          "args": [
            "dprinc.max_life"
          ],
          "line": 1218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Password expiration date: %s\\n\"",
            "dprinc.pw_expiration ?\n\t       strdate(dprinc.pw_expiration) : \"[none]\""
          ],
          "line": 1215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdate",
          "args": [
            "dprinc.pw_expiration"
          ],
          "line": 1217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Last password change: %s\\n\"",
            "dprinc.last_pwd_change ? \n\t       strdate(dprinc.last_pwd_change) : \"[never]\""
          ],
          "line": 1213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdate",
          "args": [
            "dprinc.last_pwd_change"
          ],
          "line": 1214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Expiration date: %s\\n\"",
            "dprinc.princ_expire_time ?\n\t       strdate(dprinc.princ_expire_time) : \"[never]\""
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdate",
          "args": [
            "dprinc.princ_expire_time"
          ],
          "line": 1212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Principal: %s\\n\"",
            "canon"
          ],
          "line": 1210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle",
            "&dprinc"
          ],
          "line": 1205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_principal\"",
            "retval",
            "\"while unparsing modname\""
          ],
          "line": 1204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "context",
            "dprinc.mod_name",
            "&modcanon"
          ],
          "line": 1202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_principal\"",
            "retval",
            "\"while retrieving \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 1196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal",
          "args": [
            "handle",
            "princ",
            "&dprinc",
            "KADM5_PRINCIPAL_NORMAL_MASK | KADM5_KEY_DATA"
          ],
          "line": 1194
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_get_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2091-2163",
          "snippet": "static int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 1191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_principal\"",
            "retval",
            "\"while canonicalizing principal\""
          ],
          "line": 1190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "context",
            "princ",
            "&canon"
          ],
          "line": 1188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"get_principal\"",
            "retval",
            "\"while parsing principal\""
          ],
          "line": 1185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_parse_name",
          "args": [
            "argv[argc - 1]",
            "&princ"
          ],
          "line": 1183
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "143-170",
          "snippet": "static krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *def_realm = NULL;",
            "krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *def_realm = NULL;\nkrb5_context context;\n\nstatic krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&princ",
            "0",
            "sizeof(princ)"
          ],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&dprinc",
            "0",
            "sizeof(dprinc)"
          ],
          "line": 1180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: get_principal [-terse] principal\\n\""
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-terse\"",
            "argv[1]"
          ],
          "line": 1174
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic char *prflags[] = {\n    \"DISALLOW_POSTDATED\",\t/* 0x00000001 */\n    \"DISALLOW_FORWARDABLE\",\t/* 0x00000002 */\n    \"DISALLOW_TGT_BASED\",\t/* 0x00000004 */\n    \"DISALLOW_RENEWABLE\",\t/* 0x00000008 */\n    \"DISALLOW_PROXIABLE\",\t/* 0x00000010 */\n    \"DISALLOW_DUP_SKEY\",\t/* 0x00000020 */\n    \"DISALLOW_ALL_TIX\",\t\t/* 0x00000040 */\n    \"REQUIRES_PRE_AUTH\",\t/* 0x00000080 */\n    \"REQUIRES_HW_AUTH\",\t\t/* 0x00000100 */\n    \"REQUIRES_PWCHANGE\",\t/* 0x00000200 */\n    \"UNKNOWN_0x00000400\",\t/* 0x00000400 */\n    \"UNKNOWN_0x00000800\",\t/* 0x00000800 */\n    \"DISALLOW_SVR\",\t\t/* 0x00001000 */\n    \"PWCHANGE_SERVICE\",\t\t/* 0x00002000 */\n    \"SUPPORT_DESMD5\",\t\t/* 0x00004000 */\n    \"NEW_PRINC\",\t\t/* 0x00008000 */\n};\nvoid *handle = NULL;\nkrb5_context context;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_getprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_principal_ent_rec dprinc;\n    krb5_principal princ;\n    krb5_error_code retval;\n    char *canon, *modcanon;\n    int i;\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-terse\", argv[1])))) {\n\tfprintf(stderr, \"usage: get_principal [-terse] principal\\n\");\n\treturn;\n    }\n\n\n    memset(&dprinc, 0, sizeof(dprinc));\n    memset(&princ, 0, sizeof(princ));\n\n    retval = kadmin_parse_name(argv[argc - 1], &princ);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while parsing principal\");\n\treturn;\n    }\n    retval = krb5_unparse_name(context, princ, &canon);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ);\n\treturn;\n    }\n    retval = kadm5_get_principal(handle, princ, &dprinc,\n\t\t\t\t KADM5_PRINCIPAL_NORMAL_MASK | KADM5_KEY_DATA);\n    krb5_free_principal(context, princ);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while retrieving \\\"%s\\\".\", canon);\n\tfree(canon);\n\treturn;\n    }\n    retval = krb5_unparse_name(context, dprinc.mod_name, &modcanon);\n    if (retval) {\n\tcom_err(\"get_principal\", retval, \"while unparsing modname\");\n\tkadm5_free_principal_ent(handle, &dprinc);\n\tfree(canon);\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Principal: %s\\n\", canon);\n\tprintf(\"Expiration date: %s\\n\", dprinc.princ_expire_time ?\n\t       strdate(dprinc.princ_expire_time) : \"[never]\");\n\tprintf(\"Last password change: %s\\n\", dprinc.last_pwd_change ? \n\t       strdate(dprinc.last_pwd_change) : \"[never]\");\n\tprintf(\"Password expiration date: %s\\n\",\n\t       dprinc.pw_expiration ?\n\t       strdate(dprinc.pw_expiration) : \"[none]\");\n\tprintf(\"Maximum ticket life: %s\\n\", strdur(dprinc.max_life));\n\tprintf(\"Maximum renewable life: %s\\n\", strdur(dprinc.max_renewable_life));\n\tprintf(\"Last modified: %s (%s)\\n\", strdate(dprinc.mod_date), modcanon);\n\tprintf(\"Last successful authentication: %s\\n\",\n\t       dprinc.last_success ? strdate(dprinc.last_success) :\n\t       \"[never]\"); \n\tprintf(\"Last failed authentication: %s\\n\",\n\t       dprinc.last_failed ? strdate(dprinc.last_failed) :\n\t       \"[never]\");\n\tprintf(\"Failed password attempts: %d\\n\",\n\t       dprinc.fail_auth_count);\n\tprintf(\"Number of keys: %d\\n\", dprinc.n_key_data);\n\tfor (i = 0; i < dprinc.n_key_data; i++) {\n\t     krb5_key_data *key_data = &dprinc.key_data[i];\n\t     char enctype[BUFSIZ], salttype[BUFSIZ];\n\t     \n\t     if (krb5_enctype_to_string(key_data->key_data_type[0],\n\t\t\t\t\tenctype, sizeof(enctype)))\n\t\t  sprintf(enctype, \"<Encryption type 0x%x>\",\n\t\t\t  key_data->key_data_type[0]);\n\t     printf(\"Key: vno %d, %s, \", key_data->key_data_kvno, enctype);\n\t     if (key_data->key_data_ver > 1) {\n\t\t  if (krb5_salttype_to_string(key_data->key_data_type[1],\n\t\t\t\t\t      salttype, sizeof(salttype)))\n\t\t       sprintf(salttype, \"<Salt type 0x%x>\",\n\t\t\t       key_data->key_data_type[1]);\n\t\t  printf(\"%s\\n\", salttype);\n\t     } else\n\t\t  printf(\"no salt\\n\");\n\t}\n\t\n\tprintf(\"Attributes:\");\n\tfor (i = 0; i < sizeof (prflags) / sizeof (char *); i++) {\n\t    if (dprinc.attributes & (krb5_flags) 1 << i)\n\t\tprintf(\" %s\", prflags[i]);\n\t}\n\tprintf(\"\\n\");\n\tprintf(\"Policy: %s\\n\", dprinc.policy ? dprinc.policy : \"[none]\");\n    } else {\n\tprintf(\"\\\"%s\\\"\\t%d\\t%d\\t%d\\t%d\\t\\\"%s\\\"\\t%d\\t%d\\t%d\\t%d\\t\\\"%s\\\"\"\n\t       \"\\t%d\\t%d\\t%d\\t%d\\t%d\",\n\t       canon, dprinc.princ_expire_time, dprinc.last_pwd_change,\n\t       dprinc.pw_expiration, dprinc.max_life, modcanon,\n\t       dprinc.mod_date, dprinc.attributes, dprinc.kvno,\n\t       dprinc.mkvno, dprinc.policy ? dprinc.policy : \"[none]\",\n\t       dprinc.max_renewable_life, dprinc.last_success,\n\t       dprinc.last_failed, dprinc.fail_auth_count,\n\t       dprinc.n_key_data);\n\tfor (i = 0; i < dprinc.n_key_data; i++)\n\t     printf(\"\\t%d\\t%d\\t%d\\t%d\",\n\t\t    dprinc.key_data[i].key_data_ver,\n\t\t    dprinc.key_data[i].key_data_kvno,\n\t\t    dprinc.key_data[i].key_data_type[0],\n\t\t    dprinc.key_data[i].key_data_type[1]);\n\tprintf(\"\\n\");\n   }\n    free(modcanon);\n    kadm5_free_principal_ent(handle, &dprinc);\n    free(canon);\n}"
  },
  {
    "function_name": "kadmin_modprinc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "1078-1161",
    "snippet": "void kadmin_modprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_principal_ent_rec princ, oldprinc;\n    krb5_principal kprinc;\n    long mask;\n    krb5_error_code retval;\n    char *pass, *canon;\n    int randkey = 0;\n    int n_ks_tuple = 0;\n    krb5_key_salt_tuple *ks_tuple;\n\n    if (argc < 2) {\n\t kadmin_modprinc_usage(\"modify_principal\");\n\t return;\n    }\n\n    memset(&oldprinc, 0, sizeof(oldprinc));\n    memset(&princ, 0, sizeof(princ));\n\n    retval = kadmin_parse_name(argv[argc - 1], &kprinc);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval, \"while parsing principal\");\n\treturn;\n    }\n    retval = krb5_unparse_name(context, kprinc, &canon);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval,\n\t\t\"while canonicalizing principal\");\n\tkrb5_free_principal(context, kprinc);\n\treturn;\n    }\n    retval = kadm5_get_principal(handle, kprinc, &oldprinc,\n\t\t\t\t KADM5_PRINCIPAL_NORMAL_MASK);\n    krb5_free_principal(context, kprinc);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval, \"while getting \\\"%s\\\".\",\n\t\tcanon);\n\tfree(canon);\n\treturn;\n    }\n    princ.attributes = oldprinc.attributes;\n    kadm5_free_principal_ent(handle, &oldprinc);\n    retval = kadmin_parse_princ_args(argc, argv,\n\t\t\t\t     &princ, &mask,\n\t\t\t\t     &pass, &randkey,\n\t\t\t\t     &ks_tuple, &n_ks_tuple,\n\t\t\t\t     \"modify_principal\");\n    if (ks_tuple != NULL) {\n\tfree(ks_tuple);\n\tkadmin_modprinc_usage(\"modify_principal\");\n\tfree(canon);\n\treturn;\n    }\n    if (retval) {\n\tkadmin_modprinc_usage(\"modify_principal\");\n\tfree(canon);\n\treturn;\n    }\n    if (randkey) {\n\tfprintf(stderr, \"modify_principal: -randkey not allowed\\n\");\n\tkrb5_free_principal(context, princ.principal);\n\tfree(canon);\n\treturn;\n    }\n    if (pass) {\n\tfprintf(stderr,\n\t\t\"modify_principal: -pw not allowed; use change_password\\n\");\n\tkrb5_free_principal(context, princ.principal);\n\tfree(canon);\n\treturn;\n    }\n    retval = kadm5_modify_principal(handle, &princ, mask);\n    krb5_free_principal(context, princ.principal);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval,\n\t\t\"while modifying \\\"%s\\\".\", canon);\n\tfree(canon);\n\treturn;\n    }\n    printf(\"Principal \\\"%s\\\" modified.\\n\", canon);\n    free(canon);\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "krb5_context context;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "canon"
          ],
          "line": 1160
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Principal \\\"%s\\\" modified.\\n\"",
            "canon"
          ],
          "line": 1159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"modify_principal\"",
            "retval",
            "\"while modifying \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_modify_principal",
          "args": [
            "handle",
            "&princ",
            "mask"
          ],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"modify_principal: -pw not allowed; use change_password\\n\""
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"modify_principal: -randkey not allowed\\n\""
          ],
          "line": 1139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_modprinc_usage",
          "args": [
            "\"modify_principal\""
          ],
          "line": 1134
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_modprinc_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "922-934",
          "snippet": "static void \nkadmin_modprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-clearpolicy]\\n\\t\\t[-maxrenewlife maxrenewlife] [{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_modprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-clearpolicy]\\n\\t\\t[-maxrenewlife maxrenewlife] [{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadmin_parse_princ_args",
          "args": [
            "argc",
            "argv",
            "&princ",
            "&mask",
            "&pass",
            "&randkey",
            "&ks_tuple",
            "&n_ks_tuple",
            "\"modify_principal\""
          ],
          "line": 1122
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_princ_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "729-906",
          "snippet": "static int \nkadmin_parse_princ_args(argc, argv, oprinc, mask, pass, randkey,\n\t\t\tks_tuple, n_ks_tuple, caller)\n    int argc;\n    char *argv[];\n    kadm5_principal_ent_t oprinc;\n    long *mask;\n    char **pass;\n    int *randkey;\n    krb5_key_salt_tuple **ks_tuple;\n    int *n_ks_tuple;\n    char *caller;\n{\n    int i, j, attrib_set;\n    time_t date;\n    time_t now;\n    krb5_error_code retval;\n    \n    *mask = 0;\n    *pass = NULL;\n    *n_ks_tuple = 0;\n    *ks_tuple = NULL;\n    time(&now);\n    *randkey = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tattrib_set = 0;\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-expire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->princ_expire_time = date;\n\t\t*mask |= KADM5_PRINC_EXPIRE_TIME;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 9 &&\n\t    !strcmp(\"-pwexpire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->pw_expiration = date;\n\t\t*mask |= KADM5_PW_EXPIRATION;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-maxlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_life = date - now;\n\t\t*mask |= KADM5_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 13 &&\n\t    !strcmp(\"-maxrenewlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_renewable_life = date - now;\n\t\t*mask |= KADM5_MAX_RLIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 5 &&\n\t    !strcmp(\"-kvno\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->kvno = atoi(argv[i]);\n\t\t*mask |= KADM5_KVNO;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-policy\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->policy = argv[i];\n\t\t*mask |= KADM5_POLICY;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 12 &&\n\t    !strcmp(\"-clearpolicy\", argv[i])) {\n\t    oprinc->policy = NULL;\n\t    *mask |= KADM5_POLICY_CLR;\n\t    continue;\n\t}\n\tif (strlen(argv[i]) == 3 &&\n\t    !strcmp(\"-pw\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\t*pass = argv[i];\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-randkey\", argv[i])) {\n\t    ++*randkey;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tretval = krb5_string_to_keysalts(argv[i], \", \\t\", \":.-\", 0,\n\t\t\t\t\t\t ks_tuple, n_ks_tuple);\n\t\tif (retval) {\n\t\t    com_err(caller, retval,\n\t\t\t    \"while parsing keysalts %s\", argv[i]);\n\t\t    return -1;\n\t\t}\n\t    }\n\t    continue;\n\t}\n\tfor (j = 0; j < sizeof (flags) / sizeof (struct pflag); j++) {\n\t    if (strlen(argv[i]) == flags[j].flaglen + 1 &&\n\t\t!strcmp(flags[j].flagname,\n\t\t\t&argv[i][1] /* strip off leading + or - */)) {\n\t\tif ((flags[j].set && argv[i][0] == '-') ||\n\t\t    (!flags[j].set && argv[i][0] == '+')) {\n\t\t    oprinc->attributes |= flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else if ((flags[j].set && argv[i][0] == '+') ||\n\t\t\t   (!flags[j].set && argv[i][0] == '-')) {\n\t\t    oprinc->attributes &= ~flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else {\n\t\t    return -1;\n\t\t}\n\t    }\n\t}\n\tif (!attrib_set)\n\t    return -1;\t\t/* nothing was parsed */\n    }\n    if (i != argc - 1) {\n\treturn -1;\n    }\n    retval = kadmin_parse_name(argv[i], &oprinc->principal);\n    if (retval) {\n\tcom_err(caller, retval, \"while parsing principal\");\n\treturn -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct pflag flags[] = {\n{\"allow_postdated\",\t15,\tKRB5_KDB_DISALLOW_POSTDATED,\t1},\n{\"allow_forwardable\",\t17,\tKRB5_KDB_DISALLOW_FORWARDABLE,\t1},\n{\"allow_tgs_req\",\t13,\tKRB5_KDB_DISALLOW_TGT_BASED,\t1},\n{\"allow_renewable\",\t15,\tKRB5_KDB_DISALLOW_RENEWABLE,\t1},\n{\"allow_proxiable\",\t15,\tKRB5_KDB_DISALLOW_PROXIABLE,\t1},\n{\"allow_dup_skey\",\t14,\tKRB5_KDB_DISALLOW_DUP_SKEY,\t1},\n{\"allow_tix\",\t\t9,\tKRB5_KDB_DISALLOW_ALL_TIX,\t1},\n{\"requires_preauth\",\t16,\tKRB5_KDB_REQUIRES_PRE_AUTH,\t0},\n{\"requires_hwauth\",\t15,\tKRB5_KDB_REQUIRES_HW_AUTH,\t0},\n{\"needchange\",\t\t10,\tKRB5_KDB_REQUIRES_PWCHANGE,\t0},\n{\"allow_svr\",\t\t9,\tKRB5_KDB_DISALLOW_SVR,\t\t1},\n{\"password_changing_service\",\t25,\tKRB5_KDB_PWCHANGE_SERVICE,\t0 },\n{\"support_desmd5\",\t14,\tKRB5_KDB_SUPPORT_DESMD5,\t0 }\n};",
            "char *kadmin_startup(argc, argv)\n    int argc;",
            "char *argv[];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic struct pflag flags[] = {\n{\"allow_postdated\",\t15,\tKRB5_KDB_DISALLOW_POSTDATED,\t1},\n{\"allow_forwardable\",\t17,\tKRB5_KDB_DISALLOW_FORWARDABLE,\t1},\n{\"allow_tgs_req\",\t13,\tKRB5_KDB_DISALLOW_TGT_BASED,\t1},\n{\"allow_renewable\",\t15,\tKRB5_KDB_DISALLOW_RENEWABLE,\t1},\n{\"allow_proxiable\",\t15,\tKRB5_KDB_DISALLOW_PROXIABLE,\t1},\n{\"allow_dup_skey\",\t14,\tKRB5_KDB_DISALLOW_DUP_SKEY,\t1},\n{\"allow_tix\",\t\t9,\tKRB5_KDB_DISALLOW_ALL_TIX,\t1},\n{\"requires_preauth\",\t16,\tKRB5_KDB_REQUIRES_PRE_AUTH,\t0},\n{\"requires_hwauth\",\t15,\tKRB5_KDB_REQUIRES_HW_AUTH,\t0},\n{\"needchange\",\t\t10,\tKRB5_KDB_REQUIRES_PWCHANGE,\t0},\n{\"allow_svr\",\t\t9,\tKRB5_KDB_DISALLOW_SVR,\t\t1},\n{\"password_changing_service\",\t25,\tKRB5_KDB_PWCHANGE_SERVICE,\t0 },\n{\"support_desmd5\",\t14,\tKRB5_KDB_SUPPORT_DESMD5,\t0 }\n};\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nstatic int \nkadmin_parse_princ_args(argc, argv, oprinc, mask, pass, randkey,\n\t\t\tks_tuple, n_ks_tuple, caller)\n    int argc;\n    char *argv[];\n    kadm5_principal_ent_t oprinc;\n    long *mask;\n    char **pass;\n    int *randkey;\n    krb5_key_salt_tuple **ks_tuple;\n    int *n_ks_tuple;\n    char *caller;\n{\n    int i, j, attrib_set;\n    time_t date;\n    time_t now;\n    krb5_error_code retval;\n    \n    *mask = 0;\n    *pass = NULL;\n    *n_ks_tuple = 0;\n    *ks_tuple = NULL;\n    time(&now);\n    *randkey = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tattrib_set = 0;\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-expire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->princ_expire_time = date;\n\t\t*mask |= KADM5_PRINC_EXPIRE_TIME;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 9 &&\n\t    !strcmp(\"-pwexpire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->pw_expiration = date;\n\t\t*mask |= KADM5_PW_EXPIRATION;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-maxlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_life = date - now;\n\t\t*mask |= KADM5_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 13 &&\n\t    !strcmp(\"-maxrenewlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_renewable_life = date - now;\n\t\t*mask |= KADM5_MAX_RLIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 5 &&\n\t    !strcmp(\"-kvno\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->kvno = atoi(argv[i]);\n\t\t*mask |= KADM5_KVNO;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-policy\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->policy = argv[i];\n\t\t*mask |= KADM5_POLICY;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 12 &&\n\t    !strcmp(\"-clearpolicy\", argv[i])) {\n\t    oprinc->policy = NULL;\n\t    *mask |= KADM5_POLICY_CLR;\n\t    continue;\n\t}\n\tif (strlen(argv[i]) == 3 &&\n\t    !strcmp(\"-pw\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\t*pass = argv[i];\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-randkey\", argv[i])) {\n\t    ++*randkey;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tretval = krb5_string_to_keysalts(argv[i], \", \\t\", \":.-\", 0,\n\t\t\t\t\t\t ks_tuple, n_ks_tuple);\n\t\tif (retval) {\n\t\t    com_err(caller, retval,\n\t\t\t    \"while parsing keysalts %s\", argv[i]);\n\t\t    return -1;\n\t\t}\n\t    }\n\t    continue;\n\t}\n\tfor (j = 0; j < sizeof (flags) / sizeof (struct pflag); j++) {\n\t    if (strlen(argv[i]) == flags[j].flaglen + 1 &&\n\t\t!strcmp(flags[j].flagname,\n\t\t\t&argv[i][1] /* strip off leading + or - */)) {\n\t\tif ((flags[j].set && argv[i][0] == '-') ||\n\t\t    (!flags[j].set && argv[i][0] == '+')) {\n\t\t    oprinc->attributes |= flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else if ((flags[j].set && argv[i][0] == '+') ||\n\t\t\t   (!flags[j].set && argv[i][0] == '-')) {\n\t\t    oprinc->attributes &= ~flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else {\n\t\t    return -1;\n\t\t}\n\t    }\n\t}\n\tif (!attrib_set)\n\t    return -1;\t\t/* nothing was parsed */\n    }\n    if (i != argc - 1) {\n\treturn -1;\n    }\n    retval = kadmin_parse_name(argv[i], &oprinc->principal);\n    if (retval) {\n\tcom_err(caller, retval, \"while parsing principal\");\n\treturn -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_free_principal_ent",
          "args": [
            "handle",
            "&oldprinc"
          ],
          "line": 1121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"modify_principal\"",
            "retval",
            "\"while getting \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "kprinc"
          ],
          "line": 1113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_principal",
          "args": [
            "handle",
            "kprinc",
            "&oldprinc",
            "KADM5_PRINCIPAL_NORMAL_MASK"
          ],
          "line": 1111
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_get_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2091-2163",
          "snippet": "static int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_get_principal(ClientData clientData, Tcl_Interp *interp,\n\t\t\t\t   int argc, char *argv[])\n{\n     krb5_principal princ;\n     kadm5_principal_ent_rec ent;\n     Tcl_DString *ent_dstring = 0;\n     char *ent_var;\n     char *name;\n     krb5_error_code krb5_ret;\n     int tcl_ret;\n     kadm5_ret_t ret = -1;\n     krb5_int32 mask;\n     int retcode = TCL_OK;\n     \n     GET_HANDLE(3, 1);\n\n     if((tcl_ret = parse_str(interp, argv[0], &name)) != TCL_OK)\n\treturn tcl_ret;\n     if(name != NULL) {\n\tif ((krb5_ret = krb5_parse_name(context, name, &princ)) != 0) {\n\t    stash_error(interp, krb5_ret);\n\t    Tcl_AppendElement(interp, \"while parsing principal name\");\n\t    return TCL_ERROR;\n\t}\n     } else princ = NULL;\n\n     if ((tcl_ret = parse_str(interp, argv[1], &ent_var)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing entry variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if ((tcl_ret = parse_principal_mask(interp, argv[2], &mask)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal mask\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     \n     ret = kadm5_get_principal(server_handle, princ, ent_var ? &ent : 0,\n\t\t\t       mask);\n\n     if (ret == KADM5_OK) {\n\t  if (ent_var) {\n\t       ent_dstring = unparse_principal_ent(&ent, mask);\n\t       if (! Tcl_SetVar(interp, ent_var, ent_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting entry variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t       set_ok(interp, \"Principal retrieved.\");\n\t  }\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     if (ent_dstring) {\n\t  Tcl_DStringFree(ent_dstring);\n\t  free(ent_dstring);\n     }\n     if(princ != NULL)\n\tkrb5_free_principal(context, princ);\n     if (ret == KADM5_OK && ent_var &&\n\t (ret = kadm5_free_principal_ent(server_handle, &ent)) &&\n\t (retcode == TCL_OK)) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "kprinc"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"modify_principal\"",
            "retval",
            "\"while canonicalizing principal\""
          ],
          "line": 1106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "context",
            "kprinc",
            "&canon"
          ],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"modify_principal\"",
            "retval",
            "\"while parsing principal\""
          ],
          "line": 1101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_parse_name",
          "args": [
            "argv[argc - 1]",
            "&kprinc"
          ],
          "line": 1099
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "143-170",
          "snippet": "static krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *def_realm = NULL;",
            "krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *def_realm = NULL;\nkrb5_context context;\n\nstatic krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&princ",
            "0",
            "sizeof(princ)"
          ],
          "line": 1097
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&oldprinc",
            "0",
            "sizeof(oldprinc)"
          ],
          "line": 1096
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nkrb5_context context;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_modprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_principal_ent_rec princ, oldprinc;\n    krb5_principal kprinc;\n    long mask;\n    krb5_error_code retval;\n    char *pass, *canon;\n    int randkey = 0;\n    int n_ks_tuple = 0;\n    krb5_key_salt_tuple *ks_tuple;\n\n    if (argc < 2) {\n\t kadmin_modprinc_usage(\"modify_principal\");\n\t return;\n    }\n\n    memset(&oldprinc, 0, sizeof(oldprinc));\n    memset(&princ, 0, sizeof(princ));\n\n    retval = kadmin_parse_name(argv[argc - 1], &kprinc);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval, \"while parsing principal\");\n\treturn;\n    }\n    retval = krb5_unparse_name(context, kprinc, &canon);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval,\n\t\t\"while canonicalizing principal\");\n\tkrb5_free_principal(context, kprinc);\n\treturn;\n    }\n    retval = kadm5_get_principal(handle, kprinc, &oldprinc,\n\t\t\t\t KADM5_PRINCIPAL_NORMAL_MASK);\n    krb5_free_principal(context, kprinc);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval, \"while getting \\\"%s\\\".\",\n\t\tcanon);\n\tfree(canon);\n\treturn;\n    }\n    princ.attributes = oldprinc.attributes;\n    kadm5_free_principal_ent(handle, &oldprinc);\n    retval = kadmin_parse_princ_args(argc, argv,\n\t\t\t\t     &princ, &mask,\n\t\t\t\t     &pass, &randkey,\n\t\t\t\t     &ks_tuple, &n_ks_tuple,\n\t\t\t\t     \"modify_principal\");\n    if (ks_tuple != NULL) {\n\tfree(ks_tuple);\n\tkadmin_modprinc_usage(\"modify_principal\");\n\tfree(canon);\n\treturn;\n    }\n    if (retval) {\n\tkadmin_modprinc_usage(\"modify_principal\");\n\tfree(canon);\n\treturn;\n    }\n    if (randkey) {\n\tfprintf(stderr, \"modify_principal: -randkey not allowed\\n\");\n\tkrb5_free_principal(context, princ.principal);\n\tfree(canon);\n\treturn;\n    }\n    if (pass) {\n\tfprintf(stderr,\n\t\t\"modify_principal: -pw not allowed; use change_password\\n\");\n\tkrb5_free_principal(context, princ.principal);\n\tfree(canon);\n\treturn;\n    }\n    retval = kadm5_modify_principal(handle, &princ, mask);\n    krb5_free_principal(context, princ.principal);\n    if (retval) {\n\tcom_err(\"modify_principal\", retval,\n\t\t\"while modifying \\\"%s\\\".\", canon);\n\tfree(canon);\n\treturn;\n    }\n    printf(\"Principal \\\"%s\\\" modified.\\n\", canon);\n    free(canon);\n}"
  },
  {
    "function_name": "kadmin_addprinc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "936-1076",
    "snippet": "void kadmin_addprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_principal_ent_rec princ;\n    kadm5_policy_ent_rec defpol;\n    long mask;\n    int randkey = 0, i;\n    int n_ks_tuple;\n    krb5_key_salt_tuple *ks_tuple;\n    char *pass, *canon;\n    krb5_error_code retval;\n    static char newpw[1024], dummybuf[256];\n    static char prompt1[1024], prompt2[1024];\n\n    if (dummybuf[0] == 0) {\n\t for (i = 0; i < 256; i++)\n\t      dummybuf[i] = (i+1) % 256;\n    }\n    \n    /* Zero all fields in request structure */\n    memset(&princ, 0, sizeof(princ));\n\n    princ.attributes = 0;\n    if (kadmin_parse_princ_args(argc, argv,\n\t\t\t\t&princ, &mask, &pass, &randkey,\n\t\t\t\t&ks_tuple, &n_ks_tuple,\n\t\t\t\t\"add_principal\")) {\n\t kadmin_addprinc_usage(\"add_principal\");\n\t return;\n    }\n\n    retval = krb5_unparse_name(context, princ.principal, &canon);\n    if (retval) {\n\tcom_err(\"add_principal\",\n\t\tretval, \"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ.principal);\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n\n    /*\n     * If -policy was not specified, and -clearpolicy was not\n     * specified, and the policy \"default\" exists, assign it.  If\n     * -clearpolicy was specified, then KADM5_POLICY_CLR should be\n     * unset, since it is never valid for kadm5_create_principal.\n     */\n    if ((! (mask & KADM5_POLICY)) &&\n\t(! (mask & KADM5_POLICY_CLR))) {\n\t if (! kadm5_get_policy(handle, \"default\", &defpol)) {\n\t      fprintf(stderr,\n\t\t\"NOTICE: no policy specified for %s; assigning \\\"default\\\"\\n\",\n\t\t      canon);\n\t      princ.policy = \"default\";\n\t      mask |= KADM5_POLICY;\n\t      (void) kadm5_free_policy_ent(handle, &defpol);\n\t } else\n\t      fprintf(stderr,\n\t     \"WARNING: no policy specified for %s; defaulting to no policy\\n\",\n\t\t      canon);\n    }\n    mask &= ~KADM5_POLICY_CLR;\n    \n    if (randkey) {\t\t/* do special stuff if -randkey specified */\n\tprinc.attributes |= KRB5_KDB_DISALLOW_ALL_TIX; /* set notix */\n\tmask |= KADM5_ATTRIBUTES;\n\tpass = dummybuf;\n    } else if (pass == NULL) {\n\tunsigned int sz = sizeof (newpw) - 1;\n\t\n\tsprintf(prompt1, \"Enter password for principal \\\"%.900s\\\"\",\n\t\tcanon);\n\tsprintf(prompt2,\n\t\t\"Re-enter password for principal \\\"%.900s\\\"\",\n\t\tcanon);\n\tretval = krb5_read_password(context, prompt1, prompt2,\n\t\t\t\t    newpw, &sz);\n\tif (retval) {\n\t    com_err(\"add_principal\", retval,\n\t\t    \"while reading password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    krb5_free_principal(context, princ.principal);\n\t    return;\n\t}\n\tpass = newpw;\n    }\n    mask |= KADM5_PRINCIPAL;\n    if (ks_tuple != NULL) {\n\tretval = kadm5_create_principal_3(handle, &princ, mask,\n\t\t\t\t\t  n_ks_tuple, ks_tuple, pass);\n    } else {\n\tretval = kadm5_create_principal(handle, &princ, mask, pass);\n    }\n    if (retval) {\n\tcom_err(\"add_principal\", retval, \"while creating \\\"%s\\\".\",\n\t\tcanon);\n\tkrb5_free_principal(context, princ.principal);\n\tfree(canon);\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n    if (randkey) {\t\t/* more special stuff for -randkey */\n\tif (ks_tuple != NULL) {\n\t    retval = kadm5_randkey_principal_3(handle, princ.principal,\n\t\t\t\t\t       FALSE,\n\t\t\t\t\t       n_ks_tuple, ks_tuple,\n\t\t\t\t\t       NULL, NULL);\n\t} else {\n\t    retval = kadm5_randkey_principal(handle, princ.principal,\n\t\t\t\t\t     NULL, NULL);\n\t}\n\tif (retval) {\n\t    com_err(\"add_principal\", retval,\n\t\t    \"while randomizing key for \\\"%s\\\".\", canon);\n\t    krb5_free_principal(context, princ.principal);\n\t    free(canon);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t    return;\n\t}\n\tprinc.attributes &= ~KRB5_KDB_DISALLOW_ALL_TIX;\t/* clear notix */\n\tmask = KADM5_ATTRIBUTES;\n\tretval = kadm5_modify_principal(handle, &princ, mask);\n\tif (retval) {\n\t    com_err(\"add_principal\", retval,\n\t\t    \"while clearing DISALLOW_ALL_TIX for \\\"%s\\\".\", canon);\n\t    krb5_free_principal(context, princ.principal);\n\t    free(canon);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t    return;\n\t}\n    }\n    krb5_free_principal(context, princ.principal);\n    printf(\"Principal \\\"%s\\\" created.\\n\", canon);\n    if (ks_tuple != NULL)\n\tfree(ks_tuple);\n    free(canon);\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "krb5_context context;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "canon"
          ],
          "line": 1075
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Principal \\\"%s\\\" created.\\n\"",
            "canon"
          ],
          "line": 1072
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1071
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1064
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"add_principal\"",
            "retval",
            "\"while clearing DISALLOW_ALL_TIX for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_modify_principal",
          "args": [
            "handle",
            "&princ",
            "mask"
          ],
          "line": 1060
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1052
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"add_principal\"",
            "retval",
            "\"while randomizing key for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal",
          "args": [
            "handle",
            "princ.principal",
            "NULL",
            "NULL"
          ],
          "line": 1046
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_randkey_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2017-2087",
          "snippet": "static int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal_3",
          "args": [
            "handle",
            "princ.principal",
            "FALSE",
            "n_ks_tuple",
            "ks_tuple",
            "NULL",
            "NULL"
          ],
          "line": 1041
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"add_principal\"",
            "retval",
            "\"while creating \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1031
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_create_principal",
          "args": [
            "handle",
            "&princ",
            "mask",
            "pass"
          ],
          "line": 1028
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_create_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "1680-1746",
          "snippet": "static int tcl_kadm5_create_principal(ClientData clientData, \n\t\t\t\t      Tcl_Interp *interp,\n\t\t\t\t      int argc, char *argv[])\n{\n     int tcl_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n     char *princ_string;\n     kadm5_principal_ent_t princ = 0;\n     krb5_int32 mask;\n     char *pw;\n#ifdef OVERRIDE     \n     int override_qual;\n#endif     \n\n     GET_HANDLE(3, 0);\n\n     if ((tcl_ret = parse_str(interp, argv[0], &princ_string)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal\");\n\t  return tcl_ret;\n     }\n\n     if (princ_string &&\n\t ((tcl_ret = parse_principal_ent(interp, princ_string, &princ))\n\t  != TCL_OK)) {\n\t  return tcl_ret;\n     }\n\n     if ((tcl_ret = parse_principal_mask(interp, argv[1], &mask)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n\n     if ((tcl_ret = parse_str(interp, argv[2], &pw)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#ifdef OVERRIDE\n     if ((tcl_ret = Tcl_GetBoolean(interp, argv[3], &override_qual)) !=\n\t TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#endif     \n\n#ifdef OVERRIDE\n     ret = kadm5_create_principal(server_handle, princ, mask, pw,\n\t\t\t\t       override_qual);\n#else\n     ret = kadm5_create_principal(server_handle, princ, mask, pw);\n#endif     \n\n     if (ret != KADM5_OK) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     else {\n\t  set_ok(interp, \"Principal created.\");\n     }\n\nfinished:\n     if (princ) {\n\t  free_principal_ent(&princ);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic int tcl_kadm5_create_principal(ClientData clientData, \n\t\t\t\t      Tcl_Interp *interp,\n\t\t\t\t      int argc, char *argv[])\n{\n     int tcl_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n     char *princ_string;\n     kadm5_principal_ent_t princ = 0;\n     krb5_int32 mask;\n     char *pw;\n#ifdef OVERRIDE     \n     int override_qual;\n#endif     \n\n     GET_HANDLE(3, 0);\n\n     if ((tcl_ret = parse_str(interp, argv[0], &princ_string)) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing principal\");\n\t  return tcl_ret;\n     }\n\n     if (princ_string &&\n\t ((tcl_ret = parse_principal_ent(interp, princ_string, &princ))\n\t  != TCL_OK)) {\n\t  return tcl_ret;\n     }\n\n     if ((tcl_ret = parse_principal_mask(interp, argv[1], &mask)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n\n     if ((tcl_ret = parse_str(interp, argv[2], &pw)) != TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#ifdef OVERRIDE\n     if ((tcl_ret = Tcl_GetBoolean(interp, argv[3], &override_qual)) !=\n\t TCL_OK) {\n\t  retcode = tcl_ret;\n\t  goto finished;\n     }\n#endif     \n\n#ifdef OVERRIDE\n     ret = kadm5_create_principal(server_handle, princ, mask, pw,\n\t\t\t\t       override_qual);\n#else\n     ret = kadm5_create_principal(server_handle, princ, mask, pw);\n#endif     \n\n     if (ret != KADM5_OK) {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     else {\n\t  set_ok(interp, \"Principal created.\");\n     }\n\nfinished:\n     if (princ) {\n\t  free_principal_ent(&princ);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_create_principal_3",
          "args": [
            "handle",
            "&princ",
            "mask",
            "n_ks_tuple",
            "ks_tuple",
            "pass"
          ],
          "line": 1025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"add_principal\"",
            "retval",
            "\"while reading password for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 1015
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_read_password",
          "args": [
            "context",
            "prompt1",
            "prompt2",
            "newpw",
            "&sz"
          ],
          "line": 1012
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "prompt2",
            "\"Re-enter password for principal \\\"%.900s\\\"\"",
            "canon"
          ],
          "line": 1009
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "prompt1",
            "\"Enter password for principal \\\"%.900s\\\"\"",
            "canon"
          ],
          "line": 1007
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"WARNING: no policy specified for %s; defaulting to no policy\\n\"",
            "canon"
          ],
          "line": 994
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_policy_ent",
          "args": [
            "handle",
            "&defpol"
          ],
          "line": 992
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"NOTICE: no policy specified for %s; assigning \\\"default\\\"\\n\"",
            "canon"
          ],
          "line": 987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_policy",
          "args": [
            "handle",
            "\"default\"",
            "&defpol"
          ],
          "line": 986
        },
        "resolved": true,
        "details": {
          "function_name": "kadm5_get_policy_v1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/server_glue_v1.c",
          "lines": "28-32",
          "snippet": "kadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}",
          "includes": [
            "#include \"misc.h\"",
            "#include <kadm5/admin.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"misc.h\"\n#include <kadm5/admin.h>\n\nkadm5_ret_t kadm5_get_policy_v1(void *server_handle, kadm5_policy_t name,\n\t\t\t\tkadm5_policy_ent_t *ent)\n{\n     return kadm5_get_policy(server_handle, name, ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ.principal"
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"add_principal\"",
            "retval",
            "\"while canonicalizing principal\""
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "context",
            "princ.principal",
            "&canon"
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_addprinc_usage",
          "args": [
            "\"add_principal\""
          ],
          "line": 964
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_addprinc_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "908-920",
          "snippet": "static void \nkadmin_addprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-randkey] [-pw password]\\n\\t\\t[-maxrenewlife maxrenewlife]\\n\\t\\t[-e keysaltlist]\\n\\t\\t[{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_addprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-randkey] [-pw password]\\n\\t\\t[-maxrenewlife maxrenewlife]\\n\\t\\t[-e keysaltlist]\\n\\t\\t[{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadmin_parse_princ_args",
          "args": [
            "argc",
            "argv",
            "&princ",
            "&mask",
            "&pass",
            "&randkey",
            "&ks_tuple",
            "&n_ks_tuple",
            "\"add_principal\""
          ],
          "line": 960
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_princ_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "729-906",
          "snippet": "static int \nkadmin_parse_princ_args(argc, argv, oprinc, mask, pass, randkey,\n\t\t\tks_tuple, n_ks_tuple, caller)\n    int argc;\n    char *argv[];\n    kadm5_principal_ent_t oprinc;\n    long *mask;\n    char **pass;\n    int *randkey;\n    krb5_key_salt_tuple **ks_tuple;\n    int *n_ks_tuple;\n    char *caller;\n{\n    int i, j, attrib_set;\n    time_t date;\n    time_t now;\n    krb5_error_code retval;\n    \n    *mask = 0;\n    *pass = NULL;\n    *n_ks_tuple = 0;\n    *ks_tuple = NULL;\n    time(&now);\n    *randkey = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tattrib_set = 0;\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-expire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->princ_expire_time = date;\n\t\t*mask |= KADM5_PRINC_EXPIRE_TIME;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 9 &&\n\t    !strcmp(\"-pwexpire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->pw_expiration = date;\n\t\t*mask |= KADM5_PW_EXPIRATION;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-maxlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_life = date - now;\n\t\t*mask |= KADM5_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 13 &&\n\t    !strcmp(\"-maxrenewlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_renewable_life = date - now;\n\t\t*mask |= KADM5_MAX_RLIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 5 &&\n\t    !strcmp(\"-kvno\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->kvno = atoi(argv[i]);\n\t\t*mask |= KADM5_KVNO;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-policy\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->policy = argv[i];\n\t\t*mask |= KADM5_POLICY;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 12 &&\n\t    !strcmp(\"-clearpolicy\", argv[i])) {\n\t    oprinc->policy = NULL;\n\t    *mask |= KADM5_POLICY_CLR;\n\t    continue;\n\t}\n\tif (strlen(argv[i]) == 3 &&\n\t    !strcmp(\"-pw\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\t*pass = argv[i];\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-randkey\", argv[i])) {\n\t    ++*randkey;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tretval = krb5_string_to_keysalts(argv[i], \", \\t\", \":.-\", 0,\n\t\t\t\t\t\t ks_tuple, n_ks_tuple);\n\t\tif (retval) {\n\t\t    com_err(caller, retval,\n\t\t\t    \"while parsing keysalts %s\", argv[i]);\n\t\t    return -1;\n\t\t}\n\t    }\n\t    continue;\n\t}\n\tfor (j = 0; j < sizeof (flags) / sizeof (struct pflag); j++) {\n\t    if (strlen(argv[i]) == flags[j].flaglen + 1 &&\n\t\t!strcmp(flags[j].flagname,\n\t\t\t&argv[i][1] /* strip off leading + or - */)) {\n\t\tif ((flags[j].set && argv[i][0] == '-') ||\n\t\t    (!flags[j].set && argv[i][0] == '+')) {\n\t\t    oprinc->attributes |= flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else if ((flags[j].set && argv[i][0] == '+') ||\n\t\t\t   (!flags[j].set && argv[i][0] == '-')) {\n\t\t    oprinc->attributes &= ~flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else {\n\t\t    return -1;\n\t\t}\n\t    }\n\t}\n\tif (!attrib_set)\n\t    return -1;\t\t/* nothing was parsed */\n    }\n    if (i != argc - 1) {\n\treturn -1;\n    }\n    retval = kadmin_parse_name(argv[i], &oprinc->principal);\n    if (retval) {\n\tcom_err(caller, retval, \"while parsing principal\");\n\treturn -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct pflag flags[] = {\n{\"allow_postdated\",\t15,\tKRB5_KDB_DISALLOW_POSTDATED,\t1},\n{\"allow_forwardable\",\t17,\tKRB5_KDB_DISALLOW_FORWARDABLE,\t1},\n{\"allow_tgs_req\",\t13,\tKRB5_KDB_DISALLOW_TGT_BASED,\t1},\n{\"allow_renewable\",\t15,\tKRB5_KDB_DISALLOW_RENEWABLE,\t1},\n{\"allow_proxiable\",\t15,\tKRB5_KDB_DISALLOW_PROXIABLE,\t1},\n{\"allow_dup_skey\",\t14,\tKRB5_KDB_DISALLOW_DUP_SKEY,\t1},\n{\"allow_tix\",\t\t9,\tKRB5_KDB_DISALLOW_ALL_TIX,\t1},\n{\"requires_preauth\",\t16,\tKRB5_KDB_REQUIRES_PRE_AUTH,\t0},\n{\"requires_hwauth\",\t15,\tKRB5_KDB_REQUIRES_HW_AUTH,\t0},\n{\"needchange\",\t\t10,\tKRB5_KDB_REQUIRES_PWCHANGE,\t0},\n{\"allow_svr\",\t\t9,\tKRB5_KDB_DISALLOW_SVR,\t\t1},\n{\"password_changing_service\",\t25,\tKRB5_KDB_PWCHANGE_SERVICE,\t0 },\n{\"support_desmd5\",\t14,\tKRB5_KDB_SUPPORT_DESMD5,\t0 }\n};",
            "char *kadmin_startup(argc, argv)\n    int argc;",
            "char *argv[];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic struct pflag flags[] = {\n{\"allow_postdated\",\t15,\tKRB5_KDB_DISALLOW_POSTDATED,\t1},\n{\"allow_forwardable\",\t17,\tKRB5_KDB_DISALLOW_FORWARDABLE,\t1},\n{\"allow_tgs_req\",\t13,\tKRB5_KDB_DISALLOW_TGT_BASED,\t1},\n{\"allow_renewable\",\t15,\tKRB5_KDB_DISALLOW_RENEWABLE,\t1},\n{\"allow_proxiable\",\t15,\tKRB5_KDB_DISALLOW_PROXIABLE,\t1},\n{\"allow_dup_skey\",\t14,\tKRB5_KDB_DISALLOW_DUP_SKEY,\t1},\n{\"allow_tix\",\t\t9,\tKRB5_KDB_DISALLOW_ALL_TIX,\t1},\n{\"requires_preauth\",\t16,\tKRB5_KDB_REQUIRES_PRE_AUTH,\t0},\n{\"requires_hwauth\",\t15,\tKRB5_KDB_REQUIRES_HW_AUTH,\t0},\n{\"needchange\",\t\t10,\tKRB5_KDB_REQUIRES_PWCHANGE,\t0},\n{\"allow_svr\",\t\t9,\tKRB5_KDB_DISALLOW_SVR,\t\t1},\n{\"password_changing_service\",\t25,\tKRB5_KDB_PWCHANGE_SERVICE,\t0 },\n{\"support_desmd5\",\t14,\tKRB5_KDB_SUPPORT_DESMD5,\t0 }\n};\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nstatic int \nkadmin_parse_princ_args(argc, argv, oprinc, mask, pass, randkey,\n\t\t\tks_tuple, n_ks_tuple, caller)\n    int argc;\n    char *argv[];\n    kadm5_principal_ent_t oprinc;\n    long *mask;\n    char **pass;\n    int *randkey;\n    krb5_key_salt_tuple **ks_tuple;\n    int *n_ks_tuple;\n    char *caller;\n{\n    int i, j, attrib_set;\n    time_t date;\n    time_t now;\n    krb5_error_code retval;\n    \n    *mask = 0;\n    *pass = NULL;\n    *n_ks_tuple = 0;\n    *ks_tuple = NULL;\n    time(&now);\n    *randkey = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tattrib_set = 0;\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-expire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->princ_expire_time = date;\n\t\t*mask |= KADM5_PRINC_EXPIRE_TIME;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 9 &&\n\t    !strcmp(\"-pwexpire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->pw_expiration = date;\n\t\t*mask |= KADM5_PW_EXPIRATION;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-maxlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_life = date - now;\n\t\t*mask |= KADM5_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 13 &&\n\t    !strcmp(\"-maxrenewlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_renewable_life = date - now;\n\t\t*mask |= KADM5_MAX_RLIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 5 &&\n\t    !strcmp(\"-kvno\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->kvno = atoi(argv[i]);\n\t\t*mask |= KADM5_KVNO;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-policy\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->policy = argv[i];\n\t\t*mask |= KADM5_POLICY;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 12 &&\n\t    !strcmp(\"-clearpolicy\", argv[i])) {\n\t    oprinc->policy = NULL;\n\t    *mask |= KADM5_POLICY_CLR;\n\t    continue;\n\t}\n\tif (strlen(argv[i]) == 3 &&\n\t    !strcmp(\"-pw\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\t*pass = argv[i];\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-randkey\", argv[i])) {\n\t    ++*randkey;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tretval = krb5_string_to_keysalts(argv[i], \", \\t\", \":.-\", 0,\n\t\t\t\t\t\t ks_tuple, n_ks_tuple);\n\t\tif (retval) {\n\t\t    com_err(caller, retval,\n\t\t\t    \"while parsing keysalts %s\", argv[i]);\n\t\t    return -1;\n\t\t}\n\t    }\n\t    continue;\n\t}\n\tfor (j = 0; j < sizeof (flags) / sizeof (struct pflag); j++) {\n\t    if (strlen(argv[i]) == flags[j].flaglen + 1 &&\n\t\t!strcmp(flags[j].flagname,\n\t\t\t&argv[i][1] /* strip off leading + or - */)) {\n\t\tif ((flags[j].set && argv[i][0] == '-') ||\n\t\t    (!flags[j].set && argv[i][0] == '+')) {\n\t\t    oprinc->attributes |= flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else if ((flags[j].set && argv[i][0] == '+') ||\n\t\t\t   (!flags[j].set && argv[i][0] == '-')) {\n\t\t    oprinc->attributes &= ~flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else {\n\t\t    return -1;\n\t\t}\n\t    }\n\t}\n\tif (!attrib_set)\n\t    return -1;\t\t/* nothing was parsed */\n    }\n    if (i != argc - 1) {\n\treturn -1;\n    }\n    retval = kadmin_parse_name(argv[i], &oprinc->principal);\n    if (retval) {\n\tcom_err(caller, retval, \"while parsing principal\");\n\treturn -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&princ",
            "0",
            "sizeof(princ)"
          ],
          "line": 957
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nkrb5_context context;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_addprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_principal_ent_rec princ;\n    kadm5_policy_ent_rec defpol;\n    long mask;\n    int randkey = 0, i;\n    int n_ks_tuple;\n    krb5_key_salt_tuple *ks_tuple;\n    char *pass, *canon;\n    krb5_error_code retval;\n    static char newpw[1024], dummybuf[256];\n    static char prompt1[1024], prompt2[1024];\n\n    if (dummybuf[0] == 0) {\n\t for (i = 0; i < 256; i++)\n\t      dummybuf[i] = (i+1) % 256;\n    }\n    \n    /* Zero all fields in request structure */\n    memset(&princ, 0, sizeof(princ));\n\n    princ.attributes = 0;\n    if (kadmin_parse_princ_args(argc, argv,\n\t\t\t\t&princ, &mask, &pass, &randkey,\n\t\t\t\t&ks_tuple, &n_ks_tuple,\n\t\t\t\t\"add_principal\")) {\n\t kadmin_addprinc_usage(\"add_principal\");\n\t return;\n    }\n\n    retval = krb5_unparse_name(context, princ.principal, &canon);\n    if (retval) {\n\tcom_err(\"add_principal\",\n\t\tretval, \"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ.principal);\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n\n    /*\n     * If -policy was not specified, and -clearpolicy was not\n     * specified, and the policy \"default\" exists, assign it.  If\n     * -clearpolicy was specified, then KADM5_POLICY_CLR should be\n     * unset, since it is never valid for kadm5_create_principal.\n     */\n    if ((! (mask & KADM5_POLICY)) &&\n\t(! (mask & KADM5_POLICY_CLR))) {\n\t if (! kadm5_get_policy(handle, \"default\", &defpol)) {\n\t      fprintf(stderr,\n\t\t\"NOTICE: no policy specified for %s; assigning \\\"default\\\"\\n\",\n\t\t      canon);\n\t      princ.policy = \"default\";\n\t      mask |= KADM5_POLICY;\n\t      (void) kadm5_free_policy_ent(handle, &defpol);\n\t } else\n\t      fprintf(stderr,\n\t     \"WARNING: no policy specified for %s; defaulting to no policy\\n\",\n\t\t      canon);\n    }\n    mask &= ~KADM5_POLICY_CLR;\n    \n    if (randkey) {\t\t/* do special stuff if -randkey specified */\n\tprinc.attributes |= KRB5_KDB_DISALLOW_ALL_TIX; /* set notix */\n\tmask |= KADM5_ATTRIBUTES;\n\tpass = dummybuf;\n    } else if (pass == NULL) {\n\tunsigned int sz = sizeof (newpw) - 1;\n\t\n\tsprintf(prompt1, \"Enter password for principal \\\"%.900s\\\"\",\n\t\tcanon);\n\tsprintf(prompt2,\n\t\t\"Re-enter password for principal \\\"%.900s\\\"\",\n\t\tcanon);\n\tretval = krb5_read_password(context, prompt1, prompt2,\n\t\t\t\t    newpw, &sz);\n\tif (retval) {\n\t    com_err(\"add_principal\", retval,\n\t\t    \"while reading password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    krb5_free_principal(context, princ.principal);\n\t    return;\n\t}\n\tpass = newpw;\n    }\n    mask |= KADM5_PRINCIPAL;\n    if (ks_tuple != NULL) {\n\tretval = kadm5_create_principal_3(handle, &princ, mask,\n\t\t\t\t\t  n_ks_tuple, ks_tuple, pass);\n    } else {\n\tretval = kadm5_create_principal(handle, &princ, mask, pass);\n    }\n    if (retval) {\n\tcom_err(\"add_principal\", retval, \"while creating \\\"%s\\\".\",\n\t\tcanon);\n\tkrb5_free_principal(context, princ.principal);\n\tfree(canon);\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n    if (randkey) {\t\t/* more special stuff for -randkey */\n\tif (ks_tuple != NULL) {\n\t    retval = kadm5_randkey_principal_3(handle, princ.principal,\n\t\t\t\t\t       FALSE,\n\t\t\t\t\t       n_ks_tuple, ks_tuple,\n\t\t\t\t\t       NULL, NULL);\n\t} else {\n\t    retval = kadm5_randkey_principal(handle, princ.principal,\n\t\t\t\t\t     NULL, NULL);\n\t}\n\tif (retval) {\n\t    com_err(\"add_principal\", retval,\n\t\t    \"while randomizing key for \\\"%s\\\".\", canon);\n\t    krb5_free_principal(context, princ.principal);\n\t    free(canon);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t    return;\n\t}\n\tprinc.attributes &= ~KRB5_KDB_DISALLOW_ALL_TIX;\t/* clear notix */\n\tmask = KADM5_ATTRIBUTES;\n\tretval = kadm5_modify_principal(handle, &princ, mask);\n\tif (retval) {\n\t    com_err(\"add_principal\", retval,\n\t\t    \"while clearing DISALLOW_ALL_TIX for \\\"%s\\\".\", canon);\n\t    krb5_free_principal(context, princ.principal);\n\t    free(canon);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t    return;\n\t}\n    }\n    krb5_free_principal(context, princ.principal);\n    printf(\"Principal \\\"%s\\\" created.\\n\", canon);\n    if (ks_tuple != NULL)\n\tfree(ks_tuple);\n    free(canon);\n}"
  },
  {
    "function_name": "kadmin_modprinc_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "922-934",
    "snippet": "static void \nkadmin_modprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-clearpolicy]\\n\\t\\t[-maxrenewlife maxrenewlife] [{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s%s%s\"",
            "\"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\"",
            "\"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\"",
            "\"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\""
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\tattributes are:\\n\""
          ],
          "line": 929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-clearpolicy]\\n\\t\\t[-maxrenewlife maxrenewlife] [{+|-}attribute]\\n\""
          ],
          "line": 928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\toptions are:\\n\""
          ],
          "line": 927
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: %s [options] principal\\n\"",
            "func"
          ],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_modprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-clearpolicy]\\n\\t\\t[-maxrenewlife maxrenewlife] [{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}"
  },
  {
    "function_name": "kadmin_addprinc_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "908-920",
    "snippet": "static void \nkadmin_addprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-randkey] [-pw password]\\n\\t\\t[-maxrenewlife maxrenewlife]\\n\\t\\t[-e keysaltlist]\\n\\t\\t[{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s%s%s\"",
            "\"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\"",
            "\"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\"",
            "\"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\""
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\tattributes are:\\n\""
          ],
          "line": 915
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-randkey] [-pw password]\\n\\t\\t[-maxrenewlife maxrenewlife]\\n\\t\\t[-e keysaltlist]\\n\\t\\t[{+|-}attribute]\\n\""
          ],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\toptions are:\\n\""
          ],
          "line": 913
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: %s [options] principal\\n\"",
            "func"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic void \nkadmin_addprinc_usage(func)\n   char *func;\n{\n     fprintf(stderr, \"usage: %s [options] principal\\n\", func);\n     fprintf(stderr, \"\\toptions are:\\n\");\n     fprintf(stderr, \"\\t\\t[-expire expdate] [-pwexpire pwexpdate] [-maxlife maxtixlife]\\n\\t\\t[-kvno kvno] [-policy policy] [-randkey] [-pw password]\\n\\t\\t[-maxrenewlife maxrenewlife]\\n\\t\\t[-e keysaltlist]\\n\\t\\t[{+|-}attribute]\\n\");\n     fprintf(stderr, \"\\tattributes are:\\n\");\n     fprintf(stderr, \"%s%s%s\",\n\t     \"\\t\\tallow_postdated allow_forwardable allow_tgs_req allow_renewable\\n\",\n\t     \"\\t\\tallow_proxiable allow_dup_skey allow_tix requires_preauth\\n\",\n\t     \"\\t\\trequires_hwauth needchange allow_svr password_changing_service\\n\");\n}"
  },
  {
    "function_name": "kadmin_parse_princ_args",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "729-906",
    "snippet": "static int \nkadmin_parse_princ_args(argc, argv, oprinc, mask, pass, randkey,\n\t\t\tks_tuple, n_ks_tuple, caller)\n    int argc;\n    char *argv[];\n    kadm5_principal_ent_t oprinc;\n    long *mask;\n    char **pass;\n    int *randkey;\n    krb5_key_salt_tuple **ks_tuple;\n    int *n_ks_tuple;\n    char *caller;\n{\n    int i, j, attrib_set;\n    time_t date;\n    time_t now;\n    krb5_error_code retval;\n    \n    *mask = 0;\n    *pass = NULL;\n    *n_ks_tuple = 0;\n    *ks_tuple = NULL;\n    time(&now);\n    *randkey = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tattrib_set = 0;\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-expire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->princ_expire_time = date;\n\t\t*mask |= KADM5_PRINC_EXPIRE_TIME;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 9 &&\n\t    !strcmp(\"-pwexpire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->pw_expiration = date;\n\t\t*mask |= KADM5_PW_EXPIRATION;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-maxlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_life = date - now;\n\t\t*mask |= KADM5_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 13 &&\n\t    !strcmp(\"-maxrenewlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_renewable_life = date - now;\n\t\t*mask |= KADM5_MAX_RLIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 5 &&\n\t    !strcmp(\"-kvno\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->kvno = atoi(argv[i]);\n\t\t*mask |= KADM5_KVNO;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-policy\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->policy = argv[i];\n\t\t*mask |= KADM5_POLICY;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 12 &&\n\t    !strcmp(\"-clearpolicy\", argv[i])) {\n\t    oprinc->policy = NULL;\n\t    *mask |= KADM5_POLICY_CLR;\n\t    continue;\n\t}\n\tif (strlen(argv[i]) == 3 &&\n\t    !strcmp(\"-pw\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\t*pass = argv[i];\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-randkey\", argv[i])) {\n\t    ++*randkey;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tretval = krb5_string_to_keysalts(argv[i], \", \\t\", \":.-\", 0,\n\t\t\t\t\t\t ks_tuple, n_ks_tuple);\n\t\tif (retval) {\n\t\t    com_err(caller, retval,\n\t\t\t    \"while parsing keysalts %s\", argv[i]);\n\t\t    return -1;\n\t\t}\n\t    }\n\t    continue;\n\t}\n\tfor (j = 0; j < sizeof (flags) / sizeof (struct pflag); j++) {\n\t    if (strlen(argv[i]) == flags[j].flaglen + 1 &&\n\t\t!strcmp(flags[j].flagname,\n\t\t\t&argv[i][1] /* strip off leading + or - */)) {\n\t\tif ((flags[j].set && argv[i][0] == '-') ||\n\t\t    (!flags[j].set && argv[i][0] == '+')) {\n\t\t    oprinc->attributes |= flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else if ((flags[j].set && argv[i][0] == '+') ||\n\t\t\t   (!flags[j].set && argv[i][0] == '-')) {\n\t\t    oprinc->attributes &= ~flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else {\n\t\t    return -1;\n\t\t}\n\t    }\n\t}\n\tif (!attrib_set)\n\t    return -1;\t\t/* nothing was parsed */\n    }\n    if (i != argc - 1) {\n\treturn -1;\n    }\n    retval = kadmin_parse_name(argv[i], &oprinc->principal);\n    if (retval) {\n\tcom_err(caller, retval, \"while parsing principal\");\n\treturn -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct pflag flags[] = {\n{\"allow_postdated\",\t15,\tKRB5_KDB_DISALLOW_POSTDATED,\t1},\n{\"allow_forwardable\",\t17,\tKRB5_KDB_DISALLOW_FORWARDABLE,\t1},\n{\"allow_tgs_req\",\t13,\tKRB5_KDB_DISALLOW_TGT_BASED,\t1},\n{\"allow_renewable\",\t15,\tKRB5_KDB_DISALLOW_RENEWABLE,\t1},\n{\"allow_proxiable\",\t15,\tKRB5_KDB_DISALLOW_PROXIABLE,\t1},\n{\"allow_dup_skey\",\t14,\tKRB5_KDB_DISALLOW_DUP_SKEY,\t1},\n{\"allow_tix\",\t\t9,\tKRB5_KDB_DISALLOW_ALL_TIX,\t1},\n{\"requires_preauth\",\t16,\tKRB5_KDB_REQUIRES_PRE_AUTH,\t0},\n{\"requires_hwauth\",\t15,\tKRB5_KDB_REQUIRES_HW_AUTH,\t0},\n{\"needchange\",\t\t10,\tKRB5_KDB_REQUIRES_PWCHANGE,\t0},\n{\"allow_svr\",\t\t9,\tKRB5_KDB_DISALLOW_SVR,\t\t1},\n{\"password_changing_service\",\t25,\tKRB5_KDB_PWCHANGE_SERVICE,\t0 },\n{\"support_desmd5\",\t14,\tKRB5_KDB_SUPPORT_DESMD5,\t0 }\n};",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "caller",
            "retval",
            "\"while parsing principal\""
          ],
          "line": 902
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_parse_name",
          "args": [
            "argv[i]",
            "&oprinc->principal"
          ],
          "line": 900
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "143-170",
          "snippet": "static krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *def_realm = NULL;",
            "krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *def_realm = NULL;\nkrb5_context context;\n\nstatic krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "flags[j].flagname",
            "&argv[i][1]/* strip off leading + or - */"
          ],
          "line": 875
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "caller",
            "retval",
            "\"while parsing keysalts %s\"",
            "argv[i]"
          ],
          "line": 866
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_string_to_keysalts",
          "args": [
            "argv[i]",
            "\", \\t\"",
            "\":.-\"",
            "0",
            "ks_tuple",
            "n_ks_tuple"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-e\"",
            "argv[i]"
          ],
          "line": 859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-randkey\"",
            "argv[i]"
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 854
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-pw\"",
            "argv[i]"
          ],
          "line": 846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 845
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-clearpolicy\"",
            "argv[i]"
          ],
          "line": 840
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-policy\"",
            "argv[i]"
          ],
          "line": 830
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "argv[i]"
          ],
          "line": 824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-kvno\"",
            "argv[i]"
          ],
          "line": 820
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 819
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Invalid date specification \\\"%s\\\".\\n\"",
            "argv[i]"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_date",
          "args": [
            "argv[i]"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-maxrenewlife\"",
            "argv[i]"
          ],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 803
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Invalid date specification \\\"%s\\\".\\n\"",
            "argv[i]"
          ],
          "line": 794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_date",
          "args": [
            "argv[i]"
          ],
          "line": 792
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-maxlife\"",
            "argv[i]"
          ],
          "line": 788
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Invalid date specification \\\"%s\\\".\\n\"",
            "argv[i]"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_date",
          "args": [
            "argv[i]"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-pwexpire\"",
            "argv[i]"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Invalid date specification \\\"%s\\\".\\n\"",
            "argv[i]"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_date",
          "args": [
            "argv[i]"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-expire\"",
            "argv[i]"
          ],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&now"
          ],
          "line": 751
        },
        "resolved": true,
        "details": {
          "function_name": "strftime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/strftime.c",
          "lines": "102-121",
          "snippet": "size_t\nstrftime(s, maxsize, format, t)\n\tchar *s;\n\tsize_t maxsize;\n\tconst char *format;\n\tconst struct tm *t;\n{\n\tchar *pt;\n\n\ttzset();\n\tif (maxsize < 1)\n\t\treturn (0);\n\n\tpt = s;\n\tif (_fmt(format, t, &pt, s + maxsize)) {\n\t\t*pt = '\\0';\n\t\treturn (pt - s);\n\t} else\n\t\treturn (0);\n}",
          "includes": [
            "#include <time.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static\tsize_t _fmt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <string.h>\n\nstatic\tsize_t _fmt;\n\nsize_t\nstrftime(s, maxsize, format, t)\n\tchar *s;\n\tsize_t maxsize;\n\tconst char *format;\n\tconst struct tm *t;\n{\n\tchar *pt;\n\n\ttzset();\n\tif (maxsize < 1)\n\t\treturn (0);\n\n\tpt = s;\n\tif (_fmt(format, t, &pt, s + maxsize)) {\n\t\t*pt = '\\0';\n\t\treturn (pt - s);\n\t} else\n\t\treturn (0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nstatic struct pflag flags[] = {\n{\"allow_postdated\",\t15,\tKRB5_KDB_DISALLOW_POSTDATED,\t1},\n{\"allow_forwardable\",\t17,\tKRB5_KDB_DISALLOW_FORWARDABLE,\t1},\n{\"allow_tgs_req\",\t13,\tKRB5_KDB_DISALLOW_TGT_BASED,\t1},\n{\"allow_renewable\",\t15,\tKRB5_KDB_DISALLOW_RENEWABLE,\t1},\n{\"allow_proxiable\",\t15,\tKRB5_KDB_DISALLOW_PROXIABLE,\t1},\n{\"allow_dup_skey\",\t14,\tKRB5_KDB_DISALLOW_DUP_SKEY,\t1},\n{\"allow_tix\",\t\t9,\tKRB5_KDB_DISALLOW_ALL_TIX,\t1},\n{\"requires_preauth\",\t16,\tKRB5_KDB_REQUIRES_PRE_AUTH,\t0},\n{\"requires_hwauth\",\t15,\tKRB5_KDB_REQUIRES_HW_AUTH,\t0},\n{\"needchange\",\t\t10,\tKRB5_KDB_REQUIRES_PWCHANGE,\t0},\n{\"allow_svr\",\t\t9,\tKRB5_KDB_DISALLOW_SVR,\t\t1},\n{\"password_changing_service\",\t25,\tKRB5_KDB_PWCHANGE_SERVICE,\t0 },\n{\"support_desmd5\",\t14,\tKRB5_KDB_SUPPORT_DESMD5,\t0 }\n};\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nstatic int \nkadmin_parse_princ_args(argc, argv, oprinc, mask, pass, randkey,\n\t\t\tks_tuple, n_ks_tuple, caller)\n    int argc;\n    char *argv[];\n    kadm5_principal_ent_t oprinc;\n    long *mask;\n    char **pass;\n    int *randkey;\n    krb5_key_salt_tuple **ks_tuple;\n    int *n_ks_tuple;\n    char *caller;\n{\n    int i, j, attrib_set;\n    time_t date;\n    time_t now;\n    krb5_error_code retval;\n    \n    *mask = 0;\n    *pass = NULL;\n    *n_ks_tuple = 0;\n    *ks_tuple = NULL;\n    time(&now);\n    *randkey = 0;\n    for (i = 1; i < argc - 1; i++) {\n\tattrib_set = 0;\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-expire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->princ_expire_time = date;\n\t\t*mask |= KADM5_PRINC_EXPIRE_TIME;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 9 &&\n\t    !strcmp(\"-pwexpire\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->pw_expiration = date;\n\t\t*mask |= KADM5_PW_EXPIRATION;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-maxlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_life = date - now;\n\t\t*mask |= KADM5_MAX_LIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 13 &&\n\t    !strcmp(\"-maxrenewlife\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tdate = get_date(argv[i]);\n \t\tif (date == (time_t)-1) {\n\t\t     fprintf(stderr, \"Invalid date specification \\\"%s\\\".\\n\",\n\t\t\t     argv[i]);\n\t\t     return -1;\n \t\t}\n\t\toprinc->max_renewable_life = date - now;\n\t\t*mask |= KADM5_MAX_RLIFE;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 5 &&\n\t    !strcmp(\"-kvno\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->kvno = atoi(argv[i]);\n\t\t*mask |= KADM5_KVNO;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 7 &&\n\t    !strcmp(\"-policy\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\toprinc->policy = argv[i];\n\t\t*mask |= KADM5_POLICY;\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 12 &&\n\t    !strcmp(\"-clearpolicy\", argv[i])) {\n\t    oprinc->policy = NULL;\n\t    *mask |= KADM5_POLICY_CLR;\n\t    continue;\n\t}\n\tif (strlen(argv[i]) == 3 &&\n\t    !strcmp(\"-pw\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\t*pass = argv[i];\n\t\tcontinue;\n\t    }\n\t}\n\tif (strlen(argv[i]) == 8 &&\n\t    !strcmp(\"-randkey\", argv[i])) {\n\t    ++*randkey;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", argv[i])) {\n\t    if (++i > argc - 2)\n\t\treturn -1;\n\t    else {\n\t\tretval = krb5_string_to_keysalts(argv[i], \", \\t\", \":.-\", 0,\n\t\t\t\t\t\t ks_tuple, n_ks_tuple);\n\t\tif (retval) {\n\t\t    com_err(caller, retval,\n\t\t\t    \"while parsing keysalts %s\", argv[i]);\n\t\t    return -1;\n\t\t}\n\t    }\n\t    continue;\n\t}\n\tfor (j = 0; j < sizeof (flags) / sizeof (struct pflag); j++) {\n\t    if (strlen(argv[i]) == flags[j].flaglen + 1 &&\n\t\t!strcmp(flags[j].flagname,\n\t\t\t&argv[i][1] /* strip off leading + or - */)) {\n\t\tif ((flags[j].set && argv[i][0] == '-') ||\n\t\t    (!flags[j].set && argv[i][0] == '+')) {\n\t\t    oprinc->attributes |= flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else if ((flags[j].set && argv[i][0] == '+') ||\n\t\t\t   (!flags[j].set && argv[i][0] == '-')) {\n\t\t    oprinc->attributes &= ~flags[j].theflag;\n\t\t    *mask |= KADM5_ATTRIBUTES;\n\t\t    attrib_set++;\n\t\t    break;\n\t\t} else {\n\t\t    return -1;\n\t\t}\n\t    }\n\t}\n\tif (!attrib_set)\n\t    return -1;\t\t/* nothing was parsed */\n    }\n    if (i != argc - 1) {\n\treturn -1;\n    }\n    retval = kadmin_parse_name(argv[i], &oprinc->principal);\n    if (retval) {\n\tcom_err(caller, retval, \"while parsing principal\");\n\treturn -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "kadmin_cpw",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "569-727",
    "snippet": "void kadmin_cpw(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n    static char newpw[1024];\n    static char prompt1[1024], prompt2[1024];\n    char *canon;\n    char *pwarg = NULL;\n    int n_ks_tuple = 0, randkey = 0;\n    krb5_boolean keepold = FALSE;\n    krb5_key_salt_tuple *ks_tuple = NULL;\n    krb5_principal princ;\n    \n    if (argc < 2) {\n\t goto usage;\n    }\n    for (argv++, argc--; argc > 1; argc--, argv++) {\n\tif (!strcmp(\"-pw\", *argv)) {\n\t    argc--;\n\t    if (argc < 1) {\n\t\tfprintf(stderr, \"change_password: missing password arg\\n\");\n\t\tgoto usage;\n\t    }\n\t    pwarg = *++argv;\n\t    continue;\n\t}\n\tif (!strcmp(\"-randkey\", *argv)) {\n\t    randkey++;\n\t    continue;\n\t}\n\tif (!strcmp(\"-keepold\", *argv)) {\n\t    keepold = TRUE;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", *argv)) {\n\t    argc--;\n\t    if (argc < 1) {\n\t\tfprintf(stderr,\n\t\t\t\"change_password: missing keysaltlist arg\\n\");\n\t\tgoto usage;\n\t    }\n\t    retval = krb5_string_to_keysalts(*++argv, \", \\t\", \":.-\", 0,\n\t\t\t\t\t     &ks_tuple, &n_ks_tuple);\n\t    if (retval) {\n\t\tcom_err(\"change_password\", retval,\n\t\t\t\"while parsing keysalts %s\", *argv);\n\t\treturn;\n\t    }\n\t    continue;\n\t}\n\tgoto usage;\n    }\n    retval = kadmin_parse_name(*argv, &princ);\n    if (retval) {\n\tcom_err(\"change_password\", retval, \"while parsing principal name\");\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n    retval = krb5_unparse_name(context, princ, &canon);\n    if (retval) {\n\tcom_err(\"change_password\", retval, \"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ);\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n    if (pwarg != NULL) {\n\tif (keepold || ks_tuple != NULL) {\n\t    retval = kadm5_chpass_principal_3(handle, princ, keepold,\n\t\t\t\t\t      n_ks_tuple, ks_tuple, pwarg);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t} else {\n\t    retval = kadm5_chpass_principal(handle, princ, pwarg);\n\t}\n\tkrb5_free_principal(context, princ);\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while changing password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    return;\n\t}\n\tprintf(\"Password for \\\"%s\\\" changed.\\n\", canon);\n\tfree(canon);\n\treturn;\n    } else if (randkey) {\n\tif (keepold || ks_tuple != NULL) {\n\t    retval = kadm5_randkey_principal_3(handle, princ, keepold,\n\t\t\t\t\t       n_ks_tuple, ks_tuple,\n\t\t\t\t\t       NULL, NULL);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t} else {\n\t    retval = kadm5_randkey_principal(handle, princ, NULL, NULL);\n\t}\n\tkrb5_free_principal(context, princ);\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while randomizing key for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    return;\n\t}\n\tprintf(\"Key for \\\"%s\\\" randomized.\\n\", canon);\n\tfree(canon);\n\treturn;\n    } else if (argc == 1) {\n\tunsigned int i = sizeof (newpw) - 1;\n\t\n\tsprintf(prompt1, \"Enter password for principal \\\"%.900s\\\"\",\n\t\t*argv);\n\tsprintf(prompt2,\n\t\t\"Re-enter password for principal \\\"%.900s\\\"\",\n\t\t*argv);\n\tretval = krb5_read_password(context, prompt1, prompt2,\n\t\t\t\t    newpw, &i);\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while reading password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t    krb5_free_principal(context, princ);\n\t    return;\n\t}\n\tif (keepold || ks_tuple != NULL) {\n\t    retval = kadm5_chpass_principal_3(handle, princ, keepold,\n\t\t\t\t\t      n_ks_tuple, ks_tuple,\n\t\t\t\t\t      newpw);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t} else {\n\t    retval = kadm5_chpass_principal(handle, princ, newpw);\n\t}\n\tkrb5_free_principal(context, princ);\n\tmemset(newpw, 0, sizeof (newpw));\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while changing password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    return;\n\t}\n\tprintf(\"Password for \\\"%s\\\" changed.\\n\", canon);\n\tfree(canon);\n\treturn;\n   } else {\n\tfree(canon);\n\tkrb5_free_principal(context, princ);\n   usage:\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\tfprintf(stderr,\n\t\t\"usage: change_password [-randkey] [-keepold] \"\n\t\t\"[-e keysaltlist] [-pw password] \"\n\t\t\"principal\\n\");\n\treturn;\n   }\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "krb5_context context;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: change_password [-randkey] [-keepold] \"\n\t\t\"[-e keysaltlist] [-pw password] \"\n\t\t\"principal\\n\""
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ks_tuple"
          ],
          "line": 720
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Password for \\\"%s\\\" changed.\\n\"",
            "canon"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while changing password for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "newpw",
            "0",
            "sizeof (newpw)"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 704
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_chpass_principal",
          "args": [
            "handle",
            "princ",
            "newpw"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_chpass_principal_3",
          "args": [
            "handle",
            "princ",
            "keepold",
            "n_ks_tuple",
            "ks_tuple",
            "newpw"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while reading password for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 687
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_read_password",
          "args": [
            "context",
            "prompt1",
            "prompt2",
            "newpw",
            "&i"
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "prompt2",
            "\"Re-enter password for principal \\\"%.900s\\\"\"",
            "*argv"
          ],
          "line": 681
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "prompt1",
            "\"Enter password for principal \\\"%.900s\\\"\"",
            "*argv"
          ],
          "line": 679
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Key for \\\"%s\\\" randomized.\\n\"",
            "canon"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while randomizing key for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal",
          "args": [
            "handle",
            "princ",
            "NULL",
            "NULL"
          ],
          "line": 664
        },
        "resolved": true,
        "details": {
          "function_name": "tcl_kadm5_randkey_principal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_kadm5.c",
          "lines": "2017-2087",
          "snippet": "static int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic krb5_context context;\n\nstatic int tcl_kadm5_randkey_principal(ClientData clientData, \n\t\t\t\t       Tcl_Interp *interp,\n\t\t\t\t       int argc, char *argv[])\n{\n     krb5_principal princ;\n     krb5_keyblock *keyblocks;\n     int num_keys;\n     char *keyblock_var, *num_var, buf[50];\n     Tcl_DString *keyblock_dstring = 0;\n     krb5_error_code krb5_ret;\n     kadm5_ret_t ret;\n     int retcode = TCL_OK;\n\n     GET_HANDLE(3, 0);\n\n     if ((krb5_ret = krb5_parse_name(context, argv[0], &princ)) != 0) {\n\t  stash_error(interp, krb5_ret);\n\t  Tcl_AppendElement(interp, \"while parsing principal name\");\n\t  return TCL_ERROR;\n     }\n\n     if (parse_str(interp, argv[1], &keyblock_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n     if (parse_str(interp, argv[2], &num_var) != TCL_OK) {\n\t  Tcl_AppendElement(interp, \"while parsing keyblock variable name\");\n\t  retcode = TCL_ERROR;\n\t  goto finished;\n     }\n\n     ret = kadm5_randkey_principal(server_handle,\n\t\t\t\t   princ, keyblock_var ? &keyblocks : 0,\n\t\t\t\t   num_var ? &num_keys : 0);\n\n     if (ret == KADM5_OK) {\n\t  if (keyblock_var) {\n\t       keyblock_dstring = unparse_keyblocks(keyblocks, num_keys);\n\t       if (! Tcl_SetVar(interp, keyblock_var,\n\t\t\t\tkeyblock_dstring->string,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting keyblock variable\");\n\t\t    retcode = TCL_ERROR;\n\t\t    goto finished;\n\t       }\n\t  }\n\t  if (num_var) {\n\t       sprintf(buf, \"%d\", num_keys);\n\t       if (! Tcl_SetVar(interp, num_var, buf,\n\t\t\t\tTCL_LEAVE_ERR_MSG)) {\n\t\t    Tcl_AppendElement(interp,\n\t\t\t\t      \"while setting num_keys variable\");\n\t       }\n\t  }\n\t  set_ok(interp, \"Key randomized.\");\n     }\n     else {\n\t  stash_error(interp, ret);\n\t  retcode = TCL_ERROR;\n     }\n\nfinished:\n     krb5_free_principal(context, princ);\n     if (keyblock_dstring) {\n\t  Tcl_DStringFree(keyblock_dstring);\n\t  free(keyblock_dstring);\n     }\n     return retcode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kadm5_randkey_principal_3",
          "args": [
            "handle",
            "princ",
            "keepold",
            "n_ks_tuple",
            "ks_tuple",
            "NULL",
            "NULL"
          ],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Password for \\\"%s\\\" changed.\\n\"",
            "canon"
          ],
          "line": 653
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while changing password for \\\"%s\\\".\"",
            "canon"
          ],
          "line": 648
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 646
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_chpass_principal",
          "args": [
            "handle",
            "princ",
            "pwarg"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_chpass_principal_3",
          "args": [
            "handle",
            "princ",
            "keepold",
            "n_ks_tuple",
            "ks_tuple",
            "pwarg"
          ],
          "line": 639
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while canonicalizing principal\""
          ],
          "line": 631
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "context",
            "princ",
            "&canon"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while parsing principal name\""
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_parse_name",
          "args": [
            "*argv",
            "&princ"
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "143-170",
          "snippet": "static krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *def_realm = NULL;",
            "krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *def_realm = NULL;\nkrb5_context context;\n\nstatic krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"change_password\"",
            "retval",
            "\"while parsing keysalts %s\"",
            "*argv"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_string_to_keysalts",
          "args": [
            "*++argv",
            "\", \\t\"",
            "\":.-\"",
            "0",
            "&ks_tuple",
            "&n_ks_tuple"
          ],
          "line": 611
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"change_password: missing keysaltlist arg\\n\""
          ],
          "line": 607
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-e\"",
            "*argv"
          ],
          "line": 604
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-keepold\"",
            "*argv"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-randkey\"",
            "*argv"
          ],
          "line": 596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"change_password: missing password arg\\n\""
          ],
          "line": 590
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-pw\"",
            "*argv"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nkrb5_context context;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_cpw(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n    static char newpw[1024];\n    static char prompt1[1024], prompt2[1024];\n    char *canon;\n    char *pwarg = NULL;\n    int n_ks_tuple = 0, randkey = 0;\n    krb5_boolean keepold = FALSE;\n    krb5_key_salt_tuple *ks_tuple = NULL;\n    krb5_principal princ;\n    \n    if (argc < 2) {\n\t goto usage;\n    }\n    for (argv++, argc--; argc > 1; argc--, argv++) {\n\tif (!strcmp(\"-pw\", *argv)) {\n\t    argc--;\n\t    if (argc < 1) {\n\t\tfprintf(stderr, \"change_password: missing password arg\\n\");\n\t\tgoto usage;\n\t    }\n\t    pwarg = *++argv;\n\t    continue;\n\t}\n\tif (!strcmp(\"-randkey\", *argv)) {\n\t    randkey++;\n\t    continue;\n\t}\n\tif (!strcmp(\"-keepold\", *argv)) {\n\t    keepold = TRUE;\n\t    continue;\n\t}\n\tif (!strcmp(\"-e\", *argv)) {\n\t    argc--;\n\t    if (argc < 1) {\n\t\tfprintf(stderr,\n\t\t\t\"change_password: missing keysaltlist arg\\n\");\n\t\tgoto usage;\n\t    }\n\t    retval = krb5_string_to_keysalts(*++argv, \", \\t\", \":.-\", 0,\n\t\t\t\t\t     &ks_tuple, &n_ks_tuple);\n\t    if (retval) {\n\t\tcom_err(\"change_password\", retval,\n\t\t\t\"while parsing keysalts %s\", *argv);\n\t\treturn;\n\t    }\n\t    continue;\n\t}\n\tgoto usage;\n    }\n    retval = kadmin_parse_name(*argv, &princ);\n    if (retval) {\n\tcom_err(\"change_password\", retval, \"while parsing principal name\");\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n    retval = krb5_unparse_name(context, princ, &canon);\n    if (retval) {\n\tcom_err(\"change_password\", retval, \"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ);\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\treturn;\n    }\n    if (pwarg != NULL) {\n\tif (keepold || ks_tuple != NULL) {\n\t    retval = kadm5_chpass_principal_3(handle, princ, keepold,\n\t\t\t\t\t      n_ks_tuple, ks_tuple, pwarg);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t} else {\n\t    retval = kadm5_chpass_principal(handle, princ, pwarg);\n\t}\n\tkrb5_free_principal(context, princ);\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while changing password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    return;\n\t}\n\tprintf(\"Password for \\\"%s\\\" changed.\\n\", canon);\n\tfree(canon);\n\treturn;\n    } else if (randkey) {\n\tif (keepold || ks_tuple != NULL) {\n\t    retval = kadm5_randkey_principal_3(handle, princ, keepold,\n\t\t\t\t\t       n_ks_tuple, ks_tuple,\n\t\t\t\t\t       NULL, NULL);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t} else {\n\t    retval = kadm5_randkey_principal(handle, princ, NULL, NULL);\n\t}\n\tkrb5_free_principal(context, princ);\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while randomizing key for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    return;\n\t}\n\tprintf(\"Key for \\\"%s\\\" randomized.\\n\", canon);\n\tfree(canon);\n\treturn;\n    } else if (argc == 1) {\n\tunsigned int i = sizeof (newpw) - 1;\n\t\n\tsprintf(prompt1, \"Enter password for principal \\\"%.900s\\\"\",\n\t\t*argv);\n\tsprintf(prompt2,\n\t\t\"Re-enter password for principal \\\"%.900s\\\"\",\n\t\t*argv);\n\tretval = krb5_read_password(context, prompt1, prompt2,\n\t\t\t\t    newpw, &i);\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while reading password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t    krb5_free_principal(context, princ);\n\t    return;\n\t}\n\tif (keepold || ks_tuple != NULL) {\n\t    retval = kadm5_chpass_principal_3(handle, princ, keepold,\n\t\t\t\t\t      n_ks_tuple, ks_tuple,\n\t\t\t\t\t      newpw);\n\t    if (ks_tuple != NULL)\n\t\tfree(ks_tuple);\n\t} else {\n\t    retval = kadm5_chpass_principal(handle, princ, newpw);\n\t}\n\tkrb5_free_principal(context, princ);\n\tmemset(newpw, 0, sizeof (newpw));\n\tif (retval) {\n\t    com_err(\"change_password\", retval,\n\t\t    \"while changing password for \\\"%s\\\".\", canon);\n\t    free(canon);\n\t    return;\n\t}\n\tprintf(\"Password for \\\"%s\\\" changed.\\n\", canon);\n\tfree(canon);\n\treturn;\n   } else {\n\tfree(canon);\n\tkrb5_free_principal(context, princ);\n   usage:\n\tif (ks_tuple != NULL)\n\t    free(ks_tuple);\n\tfprintf(stderr,\n\t\t\"usage: change_password [-randkey] [-keepold] \"\n\t\t\"[-e keysaltlist] [-pw password] \"\n\t\t\"principal\\n\");\n\treturn;\n   }\n}"
  },
  {
    "function_name": "kadmin_delprinc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "520-567",
    "snippet": "void kadmin_delprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n    krb5_principal princ;\n    char *canon;\n    char reply[5];\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-force\", argv[1])))) {\n\tfprintf(stderr, \"usage: delete_principal [-force] principal\\n\");\n\treturn;\n    }\n    retval = kadmin_parse_name(argv[argc - 1], &princ);\n    if (retval) {\n\tcom_err(\"delete_principal\", retval, \"while parsing principal name\");\n\treturn;\n    }\n    retval = krb5_unparse_name(context, princ, &canon);\n    if (retval) {\n\tcom_err(\"delete_principal\", retval,\n\t\t\"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ);\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Are you sure you want to delete the principal \\\"%s\\\"? (yes/no): \", canon);\n\tfgets(reply, sizeof (reply), stdin);\n\tif (strcmp(\"yes\\n\", reply)) {\n\t    fprintf(stderr, \"Principal \\\"%s\\\" not deleted\\n\", canon);\n\t    free(canon);\n\t    krb5_free_principal(context, princ);\n\t    return;\n\t}\n    }\n    retval = kadm5_delete_principal(handle, princ);\n    krb5_free_principal(context, princ);\n    if (retval) {\n\tcom_err(\"delete_principal\", retval,\n\t\t\"while deleteing principal \\\"%s\\\"\", canon);\n\tfree(canon);\n\treturn;\n    }\n    printf(\"Principal \\\"%s\\\" deleted.\\nMake sure that you have removed this principal from all ACLs before reusing.\\n\", canon);\n    free(canon);\n    return;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "krb5_context context;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "canon"
          ],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Principal \\\"%s\\\" deleted.\\nMake sure that you have removed this principal from all ACLs before reusing.\\n\"",
            "canon"
          ],
          "line": 564
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"delete_principal\"",
            "retval",
            "\"while deleteing principal \\\"%s\\\"\"",
            "canon"
          ],
          "line": 559
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_delete_principal",
          "args": [
            "handle",
            "princ"
          ],
          "line": 556
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Principal \\\"%s\\\" not deleted\\n\"",
            "canon"
          ],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"yes\\n\"",
            "reply"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "reply",
            "sizeof (reply)",
            "stdin"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Are you sure you want to delete the principal \\\"%s\\\"? (yes/no): \"",
            "canon"
          ],
          "line": 547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "context",
            "princ"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"delete_principal\"",
            "retval",
            "\"while canonicalizing principal\""
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_unparse_name",
          "args": [
            "context",
            "princ",
            "&canon"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"delete_principal\"",
            "retval",
            "\"while parsing principal name\""
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadmin_parse_name",
          "args": [
            "argv[argc - 1]",
            "&princ"
          ],
          "line": 534
        },
        "resolved": true,
        "details": {
          "function_name": "kadmin_parse_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
          "lines": "143-170",
          "snippet": "static krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}",
          "includes": [
            "#include \"kadmin.h\"",
            "#include <time.h>",
            "#include <pwd.h>",
            "#include <unistd.h>",
            "#include <math.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <krb5.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *def_realm = NULL;",
            "krb5_context context;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *def_realm = NULL;\nkrb5_context context;\n\nstatic krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"usage: delete_principal [-force] principal\\n\""
          ],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"-force\"",
            "argv[1]"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nkrb5_context context;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_delprinc(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n    krb5_principal princ;\n    char *canon;\n    char reply[5];\n    \n    if (! (argc == 2 ||\n\t   (argc == 3 && !strcmp(\"-force\", argv[1])))) {\n\tfprintf(stderr, \"usage: delete_principal [-force] principal\\n\");\n\treturn;\n    }\n    retval = kadmin_parse_name(argv[argc - 1], &princ);\n    if (retval) {\n\tcom_err(\"delete_principal\", retval, \"while parsing principal name\");\n\treturn;\n    }\n    retval = krb5_unparse_name(context, princ, &canon);\n    if (retval) {\n\tcom_err(\"delete_principal\", retval,\n\t\t\"while canonicalizing principal\");\n\tkrb5_free_principal(context, princ);\n\treturn;\n    }\n    if (argc == 2) {\n\tprintf(\"Are you sure you want to delete the principal \\\"%s\\\"? (yes/no): \", canon);\n\tfgets(reply, sizeof (reply), stdin);\n\tif (strcmp(\"yes\\n\", reply)) {\n\t    fprintf(stderr, \"Principal \\\"%s\\\" not deleted\\n\", canon);\n\t    free(canon);\n\t    krb5_free_principal(context, princ);\n\t    return;\n\t}\n    }\n    retval = kadm5_delete_principal(handle, princ);\n    krb5_free_principal(context, princ);\n    if (retval) {\n\tcom_err(\"delete_principal\", retval,\n\t\t\"while deleteing principal \\\"%s\\\"\", canon);\n\tfree(canon);\n\treturn;\n    }\n    printf(\"Principal \\\"%s\\\" deleted.\\nMake sure that you have removed this principal from all ACLs before reusing.\\n\", canon);\n    free(canon);\n    return;\n}"
  },
  {
    "function_name": "kadmin_unlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "504-518",
    "snippet": "void kadmin_unlock(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n\n    if (!locked)\n\treturn;\n    retval = kadm5_lock(handle);\n    if (retval) {\n\tcom_err(\"unlock\", retval, \"\");\n\treturn;\n    }\n    locked = 0;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "int locked = 0;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"unlock\"",
            "retval",
            "\"\""
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_lock",
          "args": [
            "handle"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nint locked = 0;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_unlock(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n\n    if (!locked)\n\treturn;\n    retval = kadm5_lock(handle);\n    if (retval) {\n\tcom_err(\"unlock\", retval, \"\");\n\treturn;\n    }\n    locked = 0;\n}"
  },
  {
    "function_name": "kadmin_lock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "488-502",
    "snippet": "void kadmin_lock(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n\n    if (locked)\n\treturn;\n    retval = kadm5_lock(handle);\n    if (retval) {\n\tcom_err(\"lock\", retval, \"\");\n\treturn;\n    }\n    locked = 1;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "int locked = 0;",
      "char *kadmin_startup(argc, argv)\n    int argc;",
      "char *argv[];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"lock\"",
            "retval",
            "\"\""
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_lock",
          "args": [
            "handle"
          ],
          "line": 496
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nint locked = 0;\nchar *kadmin_startup(argc, argv)\n    int argc;\nchar *argv[];\n\nvoid kadmin_lock(argc, argv)\n    int argc;\n    char *argv[];\n{\n    kadm5_ret_t retval;\n\n    if (locked)\n\treturn;\n    retval = kadm5_lock(handle);\n    if (retval) {\n\tcom_err(\"lock\", retval, \"\");\n\treturn;\n    }\n    locked = 1;\n}"
  },
  {
    "function_name": "quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "463-486",
    "snippet": "int quit()\n{\n    kadm5_ret_t retval;\n\n    if (locked) {\n\tretval = kadm5_unlock(handle);\n\tif (retval) {\n\t    com_err(\"quit\", retval, \"while unlocking locked database\");\n\t    return 1;\n\t}\n\tlocked = 0;\n    }\n\n     kadm5_destroy(handle);\n     if (ccache_name != NULL) {\n\t  fprintf(stderr,\n\t\t  \"\\n\\a\\a\\aAdministration credentials NOT DESTROYED.\\n\");\n     }\n\n     /* insert more random cleanup here */\n     krb5_klog_close(context);\n     krb5_free_context(context);\n     return 0;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void *handle = NULL;",
      "krb5_context context;",
      "char *ccache_name = NULL;",
      "int locked = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "krb5_free_context",
          "args": [
            "context"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_klog_close",
          "args": [
            "context"
          ],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\n\\a\\a\\aAdministration credentials NOT DESTROYED.\\n\""
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_destroy",
          "args": [
            "handle"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "\"quit\"",
            "retval",
            "\"while unlocking locked database\""
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_unlock",
          "args": [
            "handle"
          ],
          "line": 468
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nvoid *handle = NULL;\nkrb5_context context;\nchar *ccache_name = NULL;\nint locked = 0;\n\nint quit()\n{\n    kadm5_ret_t retval;\n\n    if (locked) {\n\tretval = kadm5_unlock(handle);\n\tif (retval) {\n\t    com_err(\"quit\", retval, \"while unlocking locked database\");\n\t    return 1;\n\t}\n\tlocked = 0;\n    }\n\n     kadm5_destroy(handle);\n     if (ccache_name != NULL) {\n\t  fprintf(stderr,\n\t\t  \"\\n\\a\\a\\aAdministration credentials NOT DESTROYED.\\n\");\n     }\n\n     /* insert more random cleanup here */\n     krb5_klog_close(context);\n     krb5_free_context(context);\n     return 0;\n}"
  },
  {
    "function_name": "kadmin_parse_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "143-170",
    "snippet": "static krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "char *def_realm = NULL;",
      "krb5_context context;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fullname"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_parse_name",
          "args": [
            "context",
            "fullname",
            "principal"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcat",
          "args": [
            "fullname",
            "def_realm"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcat",
          "args": [
            "fullname",
            "\"@\""
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "cp + 1",
            "'@'"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "fullname",
            "'@'"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fullname",
            "name"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "strlen(name) + 1 + strlen(def_realm) + 1"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "def_realm"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *def_realm = NULL;\nkrb5_context context;\n\nstatic krb5_error_code \nkadmin_parse_name(name, principal)\n    char *name;\n    krb5_principal *principal;\n{\n    char *cp, *fullname;\n    krb5_error_code retval;\n    \n    /* assumes def_realm is initialized! */\n    fullname = (char *)malloc(strlen(name) + 1 + strlen(def_realm) + 1);\n    if (fullname == NULL)\n\treturn ENOMEM;\n    strcpy(fullname, name);\n    cp = strchr(fullname, '@');\n    while (cp) {\n\tif (cp - fullname && *(cp - 1) != '\\\\')\n\t    break;\n\telse\n\t    cp = strchr(cp + 1, '@');\n    }\n    if (cp == NULL) {\n\tstrcat(fullname, \"@\");\n\tstrcat(fullname, def_realm);\n    }\n    retval = krb5_parse_name(context, fullname, principal);\n    free(fullname);\n    return retval;\n}"
  },
  {
    "function_name": "usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/cli/kadmin.c",
    "lines": "96-103",
    "snippet": "static void usage()\n{\n    fprintf(stderr,\n\t \"Usage: %s [-r realm] [-p principal] [-q query] [clnt|local args]\\n\"\n    \"\\tclnt args: [-s admin_server[:port]] [[-c ccache]|[-k [-t keytab]]]\\n\"\n\t \"\\tlocal args: [-d dbname] [-e \\\"enc:salt ...\\\"] [-m]\\n\", whoami);\n    exit(1);\n}",
    "includes": [
      "#include \"kadmin.h\"",
      "#include <time.h>",
      "#include <pwd.h>",
      "#include <unistd.h>",
      "#include <math.h>",
      "#include <sys/types.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <krb5.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "char *whoami = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "request_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/ovsec_kadmd.c",
          "lines": "841-846",
          "snippet": "void request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}",
          "includes": [
            "#include    \"purify.h\"",
            "#include    \"misc.h\"",
            "#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */",
            "#include    <string.h>",
            "#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */",
            "#include    <krb5/adm_proto.h>",
            "#include    <kadm5/server_acl.h>",
            "#include    <kadm5/kadm_rpc.h>",
            "#include    <kadm5/admin.h>",
            "#include    <gssrpc/auth_gssapi.h>",
            "#include    \"gssapiP_krb5.h\" /* for kg_get_context */",
            "#include    <gssapi/gssapi.h>",
            "#include    <gssrpc/rpc.h>",
            "#include    <arpa/inet.h>  /* inet_ntoa */",
            "#include    <netinet/in.h>",
            "#include    <unistd.h>",
            "#include    <sys/socket.h>",
            "#include    <sys/time.h>",
            "#include    <sys/select.h>",
            "#include    <sys/types.h>",
            "#include    <syslog.h>",
            "#include    <signal.h>",
            "#include    <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "volatile int\tsignal_request_exit = 0;",
            "void\trequest_exit(int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include    \"purify.h\"\n#include    \"misc.h\"\n#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */\n#include    <string.h>\n#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */\n#include    <krb5/adm_proto.h>\n#include    <kadm5/server_acl.h>\n#include    <kadm5/kadm_rpc.h>\n#include    <kadm5/admin.h>\n#include    <gssrpc/auth_gssapi.h>\n#include    \"gssapiP_krb5.h\" /* for kg_get_context */\n#include    <gssapi/gssapi.h>\n#include    <gssrpc/rpc.h>\n#include    <arpa/inet.h>  /* inet_ntoa */\n#include    <netinet/in.h>\n#include    <unistd.h>\n#include    <sys/socket.h>\n#include    <sys/time.h>\n#include    <sys/select.h>\n#include    <sys/types.h>\n#include    <syslog.h>\n#include    <signal.h>\n#include    <stdio.h>\n\nvolatile int\tsignal_request_exit = 0;\nvoid\trequest_exit(int);\n\nvoid request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Usage: %s [-r realm] [-p principal] [-q query] [clnt|local args]\\n\"\n    \"\\tclnt args: [-s admin_server[:port]] [[-c ccache]|[-k [-t keytab]]]\\n\"\n\t \"\\tlocal args: [-d dbname] [-e \\\"enc:salt ...\\\"] [-m]\\n\"",
            "whoami"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kadmin.h\"\n#include <time.h>\n#include <pwd.h>\n#include <unistd.h>\n#include <math.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <krb5.h>\n\nchar *whoami = NULL;\n\nstatic void usage()\n{\n    fprintf(stderr,\n\t \"Usage: %s [-r realm] [-p principal] [-q query] [clnt|local args]\\n\"\n    \"\\tclnt args: [-s admin_server[:port]] [[-c ccache]|[-k [-t keytab]]]\\n\"\n\t \"\\tlocal args: [-d dbname] [-e \\\"enc:salt ...\\\"] [-m]\\n\", whoami);\n    exit(1);\n}"
  }
]