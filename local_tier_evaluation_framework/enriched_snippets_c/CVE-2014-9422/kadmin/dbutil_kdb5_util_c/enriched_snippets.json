[
  {
    "function_name": "add_random_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
    "lines": "446-553",
    "snippet": "static void\nadd_random_key(argc, argv)\n    int argc;\n    char **argv;\n{\n    krb5_error_code ret;\n    krb5_principal princ;\n    krb5_db_entry dbent;\n    int n;\n    krb5_boolean more;\n    krb5_timestamp now;\n\n    krb5_key_salt_tuple *keysalts = NULL;\n    krb5_int32 num_keysalts = 0;\n\n    int free_keysalts;\n    char *me = argv[0];\n    char *ks_str = NULL;\n    char *pr_str;\n\n    if (argc < 2)\n\tusage();\n    for (argv++, argc--; *argv; argv++, argc--) {\n\tif (!strcmp(*argv, \"-e\")) {\n\t    argv++; argc--;\n\t    ks_str = *argv;\n\t    continue;\n\t} else\n\t    break;\n    }\n    if (argc < 1)\n\tusage();\n    pr_str = *argv;\n    ret = krb5_parse_name(util_context, pr_str, &princ);\n    if (ret) {\n\tcom_err(me, ret, \"while parsing principal name %s\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    n = 1;\n    ret = krb5_db_get_principal(util_context, princ, &dbent,\n\t\t\t\t&n, &more);\n    if (ret) {\n\tcom_err(me, ret, \"while fetching principal %s\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    if (n != 1) {\n\tfprintf(stderr, \"principal %s not found\\n\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    if (more) {\n\tfprintf(stderr, \"principal %s not unique\\n\", pr_str);\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    ret = krb5_string_to_keysalts(ks_str,\n\t\t\t\t  \", \\t\", \":.-\", 0,\n\t\t\t\t  &keysalts,\n\t\t\t\t  &num_keysalts);\n    if (ret) {\n\tcom_err(me, ret, \"while parsing keysalts %s\", ks_str);\n\texit_status++;\n\treturn;\n    }\n    if (!num_keysalts || keysalts == NULL) {\n\tnum_keysalts = global_params.num_keysalts;\n\tkeysalts = global_params.keysalts;\n\tfree_keysalts = 0;\n    } else\n\tfree_keysalts = 1;\n    ret = krb5_dbe_ark(util_context, &master_keyblock,\n\t\t       keysalts, num_keysalts,\n\t\t       &dbent);\n    if (free_keysalts)\n\tfree(keysalts);\n    if (ret) {\n\tcom_err(me, ret, \"while randomizing principal %s\", pr_str);\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    dbent.attributes &= ~KRB5_KDB_REQUIRES_PWCHANGE;\n    ret = krb5_timeofday(util_context, &now);\n    if (ret) {\n\tcom_err(me, ret, \"while getting time\");\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    ret = krb5_dbe_update_last_pwd_change(util_context, &dbent, now);\n    if (ret) {\n\tcom_err(me, ret, \"while setting changetime\");\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    ret = krb5_db_put_principal(util_context, &dbent, &n);\n    krb5_dbe_free_contents(util_context, &dbent);\n    if (ret) {\n\tcom_err(me, ret, \"while saving principal %s\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    printf(\"%s changed\\n\", pr_str);\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <time.h>",
      "#include <kadm5/adb.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <k5-int.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int exit_status = 0;",
      "krb5_context util_context;",
      "kadm5_config_params global_params;",
      "extern krb5_keyblock master_keyblock;",
      "static void add_random_key(int, char **);",
      "static struct _cmd_table *cmd_lookup(name)\n   char *name;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s changed\\n\"",
            "pr_str"
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while saving principal %s\"",
            "pr_str"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_dbe_free_contents",
          "args": [
            "util_context",
            "&dbent"
          ],
          "line": 546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_put_principal",
          "args": [
            "util_context",
            "&dbent",
            "&n"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_dbe_free_contents",
          "args": [
            "util_context",
            "&dbent"
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while setting changetime\""
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_dbe_update_last_pwd_change",
          "args": [
            "util_context",
            "&dbent",
            "now"
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_dbe_free_contents",
          "args": [
            "util_context",
            "&dbent"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while getting time\""
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_timeofday",
          "args": [
            "util_context",
            "&now"
          ],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_dbe_free_contents",
          "args": [
            "util_context",
            "&dbent"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while randomizing principal %s\"",
            "pr_str"
          ],
          "line": 525
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "keysalts"
          ],
          "line": 523
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "krb5_dbe_ark",
          "args": [
            "util_context",
            "&master_keyblock",
            "keysalts",
            "num_keysalts",
            "&dbent"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while parsing keysalts %s\"",
            "ks_str"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_string_to_keysalts",
          "args": [
            "ks_str",
            "\", \\t\"",
            "\":.-\"",
            "0",
            "&keysalts",
            "&num_keysalts"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_dbe_free_contents",
          "args": [
            "util_context",
            "&dbent"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"principal %s not unique\\n\"",
            "pr_str"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"principal %s not found\\n\"",
            "pr_str"
          ],
          "line": 494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while fetching principal %s\"",
            "pr_str"
          ],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_get_principal",
          "args": [
            "util_context",
            "princ",
            "&dbent",
            "&n",
            "&more"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "me",
            "ret",
            "\"while parsing principal name %s\"",
            "pr_str"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_parse_name",
          "args": [
            "util_context",
            "pr_str",
            "&princ"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "usage",
          "args": [],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
          "lines": "82-98",
          "snippet": "void usage()\n{\n     fprintf(stderr, \"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\");\n     exit(1);\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <time.h>",
            "#include <kadm5/adb.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <k5-int.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nvoid usage()\n{\n     fprintf(stderr, \"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\");\n     exit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-e\""
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nint exit_status = 0;\nkrb5_context util_context;\nkadm5_config_params global_params;\nextern krb5_keyblock master_keyblock;\nstatic void add_random_key(int, char **);\nstatic struct _cmd_table *cmd_lookup(name)\n   char *name;\n\nstatic void\nadd_random_key(argc, argv)\n    int argc;\n    char **argv;\n{\n    krb5_error_code ret;\n    krb5_principal princ;\n    krb5_db_entry dbent;\n    int n;\n    krb5_boolean more;\n    krb5_timestamp now;\n\n    krb5_key_salt_tuple *keysalts = NULL;\n    krb5_int32 num_keysalts = 0;\n\n    int free_keysalts;\n    char *me = argv[0];\n    char *ks_str = NULL;\n    char *pr_str;\n\n    if (argc < 2)\n\tusage();\n    for (argv++, argc--; *argv; argv++, argc--) {\n\tif (!strcmp(*argv, \"-e\")) {\n\t    argv++; argc--;\n\t    ks_str = *argv;\n\t    continue;\n\t} else\n\t    break;\n    }\n    if (argc < 1)\n\tusage();\n    pr_str = *argv;\n    ret = krb5_parse_name(util_context, pr_str, &princ);\n    if (ret) {\n\tcom_err(me, ret, \"while parsing principal name %s\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    n = 1;\n    ret = krb5_db_get_principal(util_context, princ, &dbent,\n\t\t\t\t&n, &more);\n    if (ret) {\n\tcom_err(me, ret, \"while fetching principal %s\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    if (n != 1) {\n\tfprintf(stderr, \"principal %s not found\\n\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    if (more) {\n\tfprintf(stderr, \"principal %s not unique\\n\", pr_str);\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    ret = krb5_string_to_keysalts(ks_str,\n\t\t\t\t  \", \\t\", \":.-\", 0,\n\t\t\t\t  &keysalts,\n\t\t\t\t  &num_keysalts);\n    if (ret) {\n\tcom_err(me, ret, \"while parsing keysalts %s\", ks_str);\n\texit_status++;\n\treturn;\n    }\n    if (!num_keysalts || keysalts == NULL) {\n\tnum_keysalts = global_params.num_keysalts;\n\tkeysalts = global_params.keysalts;\n\tfree_keysalts = 0;\n    } else\n\tfree_keysalts = 1;\n    ret = krb5_dbe_ark(util_context, &master_keyblock,\n\t\t       keysalts, num_keysalts,\n\t\t       &dbent);\n    if (free_keysalts)\n\tfree(keysalts);\n    if (ret) {\n\tcom_err(me, ret, \"while randomizing principal %s\", pr_str);\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    dbent.attributes &= ~KRB5_KDB_REQUIRES_PWCHANGE;\n    ret = krb5_timeofday(util_context, &now);\n    if (ret) {\n\tcom_err(me, ret, \"while getting time\");\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    ret = krb5_dbe_update_last_pwd_change(util_context, &dbent, now);\n    if (ret) {\n\tcom_err(me, ret, \"while setting changetime\");\n\tkrb5_dbe_free_contents(util_context, &dbent);\n\texit_status++;\n\treturn;\n    }\n    ret = krb5_db_put_principal(util_context, &dbent, &n);\n    krb5_dbe_free_contents(util_context, &dbent);\n    if (ret) {\n\tcom_err(me, ret, \"while saving principal %s\", pr_str);\n\texit_status++;\n\treturn;\n    }\n    printf(\"%s changed\\n\", pr_str);\n}"
  },
  {
    "function_name": "quit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
    "lines": "427-444",
    "snippet": "int \nquit()\n{\n    krb5_error_code retval;\n    static krb5_boolean finished = 0;\n\n    if (finished)\n\treturn 0;\n    retval = krb5_db_fini(util_context);\n    memset((char *)master_keyblock.contents, 0, master_keyblock.length);\n    finished = TRUE;\n    if (retval && retval != KRB5_KDB_DBNOTINITED) {\n\tcom_err(progname, retval, \"while closing database\");\n\texit_status++;\n\treturn 1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <time.h>",
      "#include <kadm5/adb.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <k5-int.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int exit_status = 0;",
      "krb5_context util_context;",
      "extern krb5_keyblock master_keyblock;",
      "char *progname;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while closing database\""
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "(char *)master_keyblock.contents",
            "0",
            "master_keyblock.length"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_fini",
          "args": [
            "util_context"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nint exit_status = 0;\nkrb5_context util_context;\nextern krb5_keyblock master_keyblock;\nchar *progname;\n\nint \nquit()\n{\n    krb5_error_code retval;\n    static krb5_boolean finished = 0;\n\n    if (finished)\n\treturn 0;\n    retval = krb5_db_fini(util_context);\n    memset((char *)master_keyblock.contents, 0, master_keyblock.length);\n    finished = TRUE;\n    if (retval && retval != KRB5_KDB_DBNOTINITED) {\n\tcom_err(progname, retval, \"while closing database\");\n\texit_status++;\n\treturn 1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "open_db_and_mkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
    "lines": "300-421",
    "snippet": "static int open_db_and_mkey()\n{\n    krb5_error_code retval;\n    int nentries;\n    krb5_boolean more;\n    krb5_data scratch, pwd, seed;\n\n    dbactive = FALSE;\n    valid_master_key = 0;\n\n    if ((retval = krb5_db_set_name(util_context, global_params.dbname))) {\n\tcom_err(progname, retval, \"while setting active database to '%s'\",\n\t\tglobal_params.dbname);\n\texit_status++;\n\treturn(1);\n    } \n    if ((retval = krb5_db_init(util_context))) {\n\tcom_err(progname, retval, \"while initializing database\");\n\texit_status++;\n\treturn(1);\n    }\n    if ((retval = osa_adb_open_policy(&policy_db, &global_params))) {\n\tcom_err(progname, retval, \"opening policy database\");\n\texit_status++;\n\treturn (1);\n    }\n\n   /* assemble & parse the master key name */\n\n    if ((retval = krb5_db_setup_mkey_name(util_context,\n\t\t\t\t\t  global_params.mkey_name,\n\t\t\t\t\t  global_params.realm, \n\t\t\t\t\t  0, &master_princ))) {\n\tcom_err(progname, retval, \"while setting up master key name\");\n\texit_status++;\n\treturn(1);\n    }\n    nentries = 1;\n    if ((retval = krb5_db_get_principal(util_context, master_princ, \n\t\t\t\t\t&master_entry, &nentries, &more))) {\n\tcom_err(progname, retval, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (more) {\n\tcom_err(progname, KRB5KDC_ERR_PRINCIPAL_NOT_UNIQUE,\n\t\t\"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (!nentries) {\n\tcom_err(progname, KRB5_KDB_NOENTRY, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    }\n\n    krb5_db_free_principal(util_context, &master_entry, nentries);\n\n    /* the databases are now open, and the master principal exists */\n    dbactive = TRUE;\n    \n    if (mkey_password) {\n\tpwd.data = mkey_password;\n\tpwd.length = strlen(mkey_password);\n\tretval = krb5_principal2salt(util_context, master_princ, &scratch);\n\tif (retval) {\n\t    com_err(progname, retval, \"while calculated master key salt\");\n\t    return(1);\n\t}\n\n\t/* If no encryption type is set, use the default */\n\tif (master_keyblock.enctype == ENCTYPE_UNKNOWN) {\n\t    master_keyblock.enctype = DEFAULT_KDC_ENCTYPE;\n\t    if (!krb5_c_valid_enctype(master_keyblock.enctype))\n\t\tcom_err(progname, KRB5_PROG_KEYTYPE_NOSUPP,\n\t\t\t\"while setting up enctype %d\",\n\t\t\tmaster_keyblock.enctype);\n\t}\n\n\tretval = krb5_c_string_to_key(util_context, master_keyblock.enctype, \n\t\t\t\t      &pwd, &scratch, &master_keyblock);\n\tif (retval) {\n\t    com_err(progname, retval,\n\t\t    \"while transforming master key from password\");\n\t    return(1);\n\t}\n\tfree(scratch.data);\n\tmkey_password = 0;\n    } else if ((retval = krb5_db_fetch_mkey(util_context, master_princ, \n\t\t\t\t\t    master_keyblock.enctype,\n\t\t\t\t\t    manual_mkey, FALSE,\n\t\t\t\t\t    global_params.stash_file,\n\t\t\t\t\t    0, &master_keyblock))) {\n\tcom_err(progname, retval, \"while reading master key\");\n\tcom_err(progname, 0, \"Warning: proceeding without master key\");\n\texit_status++;\n\treturn(0);\n    }\n    if ((retval = krb5_db_verify_master_key(util_context, master_princ, \n\t\t\t\t\t    &master_keyblock))) {\n\tcom_err(progname, retval, \"while verifying master key\");\n\texit_status++;\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    seed.length = master_keyblock.length;\n    seed.data = master_keyblock.contents;\n\n    if ((retval = krb5_c_random_seed(util_context, &seed))) {\n\tcom_err(progname, retval, \"while seeding random number generator\");\n\texit_status++;\n\tmemset((char *)master_keyblock.contents, 0, master_keyblock.length);\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    valid_master_key = 1;\n    dbactive = TRUE;\n    return 0;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <time.h>",
      "#include <kadm5/adb.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <k5-int.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "char *mkey_password = 0;",
      "int exit_status = 0;",
      "krb5_context util_context;",
      "osa_adb_policy_t policy_db;",
      "kadm5_config_params global_params;",
      "extern krb5_keyblock master_keyblock;",
      "extern krb5_principal master_princ;",
      "krb5_db_entry master_entry;",
      "int\tvalid_master_key = 0;",
      "char *progname;",
      "krb5_boolean manual_mkey = FALSE;",
      "krb5_boolean dbactive = FALSE;",
      "static int open_db_and_mkey(void);",
      "static struct _cmd_table *cmd_lookup(name)\n   char *name;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "krb5_free_keyblock_contents",
          "args": [
            "util_context",
            "&master_keyblock"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "(char *)master_keyblock.contents",
            "0",
            "master_keyblock.length"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while seeding random number generator\""
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_c_random_seed",
          "args": [
            "util_context",
            "&seed"
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_keyblock_contents",
          "args": [
            "util_context",
            "&master_keyblock"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while verifying master key\""
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_verify_master_key",
          "args": [
            "util_context",
            "master_princ",
            "&master_keyblock"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "0",
            "\"Warning: proceeding without master key\""
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while reading master key\""
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_fetch_mkey",
          "args": [
            "util_context",
            "master_princ",
            "master_keyblock.enctype",
            "manual_mkey",
            "FALSE",
            "global_params.stash_file",
            "0",
            "&master_keyblock"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "scratch.data"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "free_policy_ent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/testing/util/tcl_ovsec_kadm.c",
          "lines": "939-943",
          "snippet": "static void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}",
          "includes": [
            "#include \"tcl_kadm5.h\"",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <k5-int.h>",
            "#include <com_err.h>",
            "#include <kadm5/admin.h>",
            "#include <tcl/tcl.h>",
            "#include <tcl.h>",
            "#include <string.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"tcl_kadm5.h\"\n#include <stdlib.h>\n#include <errno.h>\n#include <k5-int.h>\n#include <com_err.h>\n#include <kadm5/admin.h>\n#include <tcl/tcl.h>\n#include <tcl.h>\n#include <string.h>\n#include <stdio.h>\n\nstatic void free_policy_ent(ovsec_kadm_policy_ent_t *policy)\n{\n     free(*policy);\n     *policy = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while transforming master key from password\""
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_c_string_to_key",
          "args": [
            "util_context",
            "master_keyblock.enctype",
            "&pwd",
            "&scratch",
            "&master_keyblock"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "KRB5_PROG_KEYTYPE_NOSUPP",
            "\"while setting up enctype %d\"",
            "master_keyblock.enctype"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_c_valid_enctype",
          "args": [
            "master_keyblock.enctype"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while calculated master key salt\""
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_principal2salt",
          "args": [
            "util_context",
            "master_princ",
            "&scratch"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "mkey_password"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_free_principal",
          "args": [
            "util_context",
            "&master_entry",
            "nentries"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_fini",
          "args": [
            "util_context"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "KRB5_KDB_NOENTRY",
            "\"while retrieving master entry\""
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_fini",
          "args": [
            "util_context"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "KRB5KDC_ERR_PRINCIPAL_NOT_UNIQUE",
            "\"while retrieving master entry\""
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_fini",
          "args": [
            "util_context"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while retrieving master entry\""
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_get_principal",
          "args": [
            "util_context",
            "master_princ",
            "&master_entry",
            "&nentries",
            "&more"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while setting up master key name\""
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_setup_mkey_name",
          "args": [
            "util_context",
            "global_params.mkey_name",
            "global_params.realm",
            "0",
            "&master_princ"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"opening policy database\""
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osa_adb_open_policy",
          "args": [
            "&policy_db",
            "&global_params"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while initializing database\""
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_init",
          "args": [
            "util_context"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while setting active database to '%s'\"",
            "global_params.dbname"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_set_name",
          "args": [
            "util_context",
            "global_params.dbname"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nchar *mkey_password = 0;\nint exit_status = 0;\nkrb5_context util_context;\nosa_adb_policy_t policy_db;\nkadm5_config_params global_params;\nextern krb5_keyblock master_keyblock;\nextern krb5_principal master_princ;\nkrb5_db_entry master_entry;\nint\tvalid_master_key = 0;\nchar *progname;\nkrb5_boolean manual_mkey = FALSE;\nkrb5_boolean dbactive = FALSE;\nstatic int open_db_and_mkey(void);\nstatic struct _cmd_table *cmd_lookup(name)\n   char *name;\n\nstatic int open_db_and_mkey()\n{\n    krb5_error_code retval;\n    int nentries;\n    krb5_boolean more;\n    krb5_data scratch, pwd, seed;\n\n    dbactive = FALSE;\n    valid_master_key = 0;\n\n    if ((retval = krb5_db_set_name(util_context, global_params.dbname))) {\n\tcom_err(progname, retval, \"while setting active database to '%s'\",\n\t\tglobal_params.dbname);\n\texit_status++;\n\treturn(1);\n    } \n    if ((retval = krb5_db_init(util_context))) {\n\tcom_err(progname, retval, \"while initializing database\");\n\texit_status++;\n\treturn(1);\n    }\n    if ((retval = osa_adb_open_policy(&policy_db, &global_params))) {\n\tcom_err(progname, retval, \"opening policy database\");\n\texit_status++;\n\treturn (1);\n    }\n\n   /* assemble & parse the master key name */\n\n    if ((retval = krb5_db_setup_mkey_name(util_context,\n\t\t\t\t\t  global_params.mkey_name,\n\t\t\t\t\t  global_params.realm, \n\t\t\t\t\t  0, &master_princ))) {\n\tcom_err(progname, retval, \"while setting up master key name\");\n\texit_status++;\n\treturn(1);\n    }\n    nentries = 1;\n    if ((retval = krb5_db_get_principal(util_context, master_princ, \n\t\t\t\t\t&master_entry, &nentries, &more))) {\n\tcom_err(progname, retval, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (more) {\n\tcom_err(progname, KRB5KDC_ERR_PRINCIPAL_NOT_UNIQUE,\n\t\t\"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (!nentries) {\n\tcom_err(progname, KRB5_KDB_NOENTRY, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    }\n\n    krb5_db_free_principal(util_context, &master_entry, nentries);\n\n    /* the databases are now open, and the master principal exists */\n    dbactive = TRUE;\n    \n    if (mkey_password) {\n\tpwd.data = mkey_password;\n\tpwd.length = strlen(mkey_password);\n\tretval = krb5_principal2salt(util_context, master_princ, &scratch);\n\tif (retval) {\n\t    com_err(progname, retval, \"while calculated master key salt\");\n\t    return(1);\n\t}\n\n\t/* If no encryption type is set, use the default */\n\tif (master_keyblock.enctype == ENCTYPE_UNKNOWN) {\n\t    master_keyblock.enctype = DEFAULT_KDC_ENCTYPE;\n\t    if (!krb5_c_valid_enctype(master_keyblock.enctype))\n\t\tcom_err(progname, KRB5_PROG_KEYTYPE_NOSUPP,\n\t\t\t\"while setting up enctype %d\",\n\t\t\tmaster_keyblock.enctype);\n\t}\n\n\tretval = krb5_c_string_to_key(util_context, master_keyblock.enctype, \n\t\t\t\t      &pwd, &scratch, &master_keyblock);\n\tif (retval) {\n\t    com_err(progname, retval,\n\t\t    \"while transforming master key from password\");\n\t    return(1);\n\t}\n\tfree(scratch.data);\n\tmkey_password = 0;\n    } else if ((retval = krb5_db_fetch_mkey(util_context, master_princ, \n\t\t\t\t\t    master_keyblock.enctype,\n\t\t\t\t\t    manual_mkey, FALSE,\n\t\t\t\t\t    global_params.stash_file,\n\t\t\t\t\t    0, &master_keyblock))) {\n\tcom_err(progname, retval, \"while reading master key\");\n\tcom_err(progname, 0, \"Warning: proceeding without master key\");\n\texit_status++;\n\treturn(0);\n    }\n    if ((retval = krb5_db_verify_master_key(util_context, master_princ, \n\t\t\t\t\t    &master_keyblock))) {\n\tcom_err(progname, retval, \"while verifying master key\");\n\texit_status++;\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    seed.length = master_keyblock.length;\n    seed.data = master_keyblock.contents;\n\n    if ((retval = krb5_c_random_seed(util_context, &seed))) {\n\tcom_err(progname, retval, \"while seeding random number generator\");\n\texit_status++;\n\tmemset((char *)master_keyblock.contents, 0, master_keyblock.length);\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    valid_master_key = 1;\n    dbactive = TRUE;\n    return 0;\n}"
  },
  {
    "function_name": "set_dbname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
    "lines": "259-288",
    "snippet": "void set_dbname(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n\n    if (argc < 3) {\n\tcom_err(argv[0], 0, \"Too few arguments\");\n\tcom_err(argv[0], 0, \"Usage: %s dbpathname realmname\", argv[0]);\n\texit_status++;\n\treturn;\n    }\n    if (dbactive) {\n\tif ((retval = krb5_db_fini(util_context)) && retval!= KRB5_KDB_DBNOTINITED) {\n\t    com_err(argv[0], retval, \"while closing previous database\");\n\t    exit_status++;\n\t    return;\n\t}\n\tif (valid_master_key) {\n\t    krb5_free_keyblock_contents(util_context, &master_keyblock);\n\t    master_keyblock.contents = NULL;\n\t    valid_master_key = 0;\n\t}\n\tkrb5_free_principal(util_context, master_princ);\n\tdbactive = FALSE;\n    }\n\n    (void) set_dbname_help(argv[0], argv[1]);\n    return;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <time.h>",
      "#include <kadm5/adb.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <k5-int.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int exit_status = 0;",
      "krb5_context util_context;",
      "extern krb5_keyblock master_keyblock;",
      "extern krb5_principal master_princ;",
      "int\tvalid_master_key = 0;",
      "krb5_boolean dbactive = FALSE;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_dbname_help",
          "args": [
            "argv[0]",
            "argv[1]"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_principal",
          "args": [
            "util_context",
            "master_princ"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_free_keyblock_contents",
          "args": [
            "util_context",
            "&master_keyblock"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "argv[0]",
            "retval",
            "\"while closing previous database\""
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_db_fini",
          "args": [
            "util_context"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "argv[0]",
            "0",
            "\"Usage: %s dbpathname realmname\"",
            "argv[0]"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "argv[0]",
            "0",
            "\"Too few arguments\""
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nint exit_status = 0;\nkrb5_context util_context;\nextern krb5_keyblock master_keyblock;\nextern krb5_principal master_princ;\nint\tvalid_master_key = 0;\nkrb5_boolean dbactive = FALSE;\n\nvoid set_dbname(argc, argv)\n    int argc;\n    char *argv[];\n{\n    krb5_error_code retval;\n\n    if (argc < 3) {\n\tcom_err(argv[0], 0, \"Too few arguments\");\n\tcom_err(argv[0], 0, \"Usage: %s dbpathname realmname\", argv[0]);\n\texit_status++;\n\treturn;\n    }\n    if (dbactive) {\n\tif ((retval = krb5_db_fini(util_context)) && retval!= KRB5_KDB_DBNOTINITED) {\n\t    com_err(argv[0], retval, \"while closing previous database\");\n\t    exit_status++;\n\t    return;\n\t}\n\tif (valid_master_key) {\n\t    krb5_free_keyblock_contents(util_context, &master_keyblock);\n\t    master_keyblock.contents = NULL;\n\t    valid_master_key = 0;\n\t}\n\tkrb5_free_principal(util_context, master_princ);\n\tdbactive = FALSE;\n    }\n\n    (void) set_dbname_help(argv[0], argv[1]);\n    return;\n}"
  },
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
    "lines": "148-252",
    "snippet": "int main(argc, argv)\n    int argc;\n    char *argv[];\n{\n    struct _cmd_table *cmd = NULL;\n    char *koptarg, **cmd_argv;\t\n    int cmd_argc;\n    krb5_error_code retval;\n\n    retval = krb5_init_context(&util_context);\n    if (retval) {\n\t    com_err (progname, retval, \"while initializing Kerberos code\");\n\t    exit(1);\n    }\n    initialize_adb_error_table();\n\n    progname = (strrchr(argv[0], '/') ? strrchr(argv[0], '/')+1 : argv[0]);\n\n    cmd_argv = (char **) malloc(sizeof(char *)*argc);\n    if (cmd_argv == NULL) {\n\t com_err(progname, ENOMEM, \"while creating sub-command arguments\");\n\t exit(1);\n    }\n    memset(cmd_argv, 0, sizeof(char *)*argc);\n    cmd_argc = 1;\n\t \n    argv++; argc--;\n    while (*argv) {\n       if (strcmp(*argv, \"-P\") == 0 && ARG_VAL) {\n\t    mkey_password = koptarg;\n\t    manual_mkey = TRUE;\n       } else if (strcmp(*argv, \"-d\") == 0 && ARG_VAL) {\n\t    global_params.dbname = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_DBNAME;\n       } else if (strcmp(*argv, \"-r\") == 0 && ARG_VAL) {\n\t    global_params.realm = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_REALM;\n\t    /* not sure this is really necessary */\n\t    if ((retval = krb5_set_default_realm(util_context,\n\t\t\t\t\t\t global_params.realm))) {\n\t\t com_err(progname, retval, \"while setting default realm name\");\n\t\t exit(1);\n\t    }\n       } else if (strcmp(*argv, \"-k\") == 0 && ARG_VAL) {\n\t    if (krb5_string_to_enctype(koptarg, &global_params.enctype))\n\t\t com_err(argv[0], 0, \"%s is an invalid enctype\", koptarg);\n\t    else\n\t\t global_params.mask |= KADM5_CONFIG_ENCTYPE;\n       } else if (strcmp(*argv, \"-M\") == 0 && ARG_VAL) {\n\t    global_params.mkey_name = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_MKEY_NAME;\n       } else if (strcmp(*argv, \"-sf\") == 0 && ARG_VAL) {\n\t    global_params.stash_file = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_STASH_FILE;\n       } else if (strcmp(*argv, \"-m\") == 0) {\n\t    manual_mkey = TRUE;\n\t    global_params.mkey_from_kbd = 1;\n\t    global_params.mask |= KADM5_CONFIG_MKEY_FROM_KBD;\n       } else if (cmd_lookup(*argv) != NULL) {\n\t    if (cmd_argv[0] == NULL)\n\t\t cmd_argv[0] = *argv;\n\t    else\n\t\t usage();\n       } else {\n\t    cmd_argv[cmd_argc++] = *argv;\n       }\n       argv++; argc--;\n    }\n\n    if (cmd_argv[0] == NULL)\n\t usage();\n    \n    retval = kadm5_get_config_params(util_context, NULL, NULL,\n\t\t\t\t     &global_params, &global_params);\n    if (retval) {\n\t com_err(argv[0], retval, \"while retreiving configuration parameters\");\n\t exit(1);\n    }\n\n    /*\n     * Dump creates files which should not be world-readable.  It is\n     * easiest to do a single umask call here.\n     */\n    (void) umask(077);\n\n    master_keyblock.enctype = global_params.enctype;\n    if ((master_keyblock.enctype != ENCTYPE_UNKNOWN) &&\n\t(!krb5_c_valid_enctype(master_keyblock.enctype))) {\n\tcom_err(argv[0], KRB5_PROG_KEYTYPE_NOSUPP,\n\t\t\"while setting up enctype %d\", master_keyblock.enctype);\n    }\n\n    cmd = cmd_lookup(cmd_argv[0]);\n    if (cmd->opendb && open_db_and_mkey())\n\t return exit_status;\n\n    (*cmd->func)(cmd_argc, cmd_argv);\n\n    if(close_policy_db) {\n         (void) osa_adb_close_policy(policy_db);\n    }      \n    kadm5_free_config_params(util_context, &global_params);\n    krb5_free_context(util_context);\n    return exit_status;\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <time.h>",
      "#include <kadm5/adb.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <k5-int.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [
      "#define ARG_VAL (--argc > 0 ? (koptarg = *(++argv)) : (char *)(usage(), NULL))"
    ],
    "globals_used": [
      "char *mkey_password = 0;",
      "int exit_status = 0;",
      "krb5_context util_context;",
      "osa_adb_policy_t policy_db;",
      "kadm5_config_params global_params;",
      "extern krb5_keyblock master_keyblock;",
      "int     close_policy_db = 0;",
      "char *progname;",
      "krb5_boolean manual_mkey = FALSE;",
      "static int open_db_and_mkey(void);",
      "static struct _cmd_table *cmd_lookup(name)\n   char *name;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "krb5_free_context",
          "args": [
            "util_context"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_free_config_params",
          "args": [
            "util_context",
            "&global_params"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "osa_adb_close_policy",
          "args": [
            "policy_db"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "cmd_argc",
            "cmd_argv"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open_db_and_mkey",
          "args": [],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "open_db_and_mkey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
          "lines": "300-421",
          "snippet": "static int open_db_and_mkey()\n{\n    krb5_error_code retval;\n    int nentries;\n    krb5_boolean more;\n    krb5_data scratch, pwd, seed;\n\n    dbactive = FALSE;\n    valid_master_key = 0;\n\n    if ((retval = krb5_db_set_name(util_context, global_params.dbname))) {\n\tcom_err(progname, retval, \"while setting active database to '%s'\",\n\t\tglobal_params.dbname);\n\texit_status++;\n\treturn(1);\n    } \n    if ((retval = krb5_db_init(util_context))) {\n\tcom_err(progname, retval, \"while initializing database\");\n\texit_status++;\n\treturn(1);\n    }\n    if ((retval = osa_adb_open_policy(&policy_db, &global_params))) {\n\tcom_err(progname, retval, \"opening policy database\");\n\texit_status++;\n\treturn (1);\n    }\n\n   /* assemble & parse the master key name */\n\n    if ((retval = krb5_db_setup_mkey_name(util_context,\n\t\t\t\t\t  global_params.mkey_name,\n\t\t\t\t\t  global_params.realm, \n\t\t\t\t\t  0, &master_princ))) {\n\tcom_err(progname, retval, \"while setting up master key name\");\n\texit_status++;\n\treturn(1);\n    }\n    nentries = 1;\n    if ((retval = krb5_db_get_principal(util_context, master_princ, \n\t\t\t\t\t&master_entry, &nentries, &more))) {\n\tcom_err(progname, retval, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (more) {\n\tcom_err(progname, KRB5KDC_ERR_PRINCIPAL_NOT_UNIQUE,\n\t\t\"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (!nentries) {\n\tcom_err(progname, KRB5_KDB_NOENTRY, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    }\n\n    krb5_db_free_principal(util_context, &master_entry, nentries);\n\n    /* the databases are now open, and the master principal exists */\n    dbactive = TRUE;\n    \n    if (mkey_password) {\n\tpwd.data = mkey_password;\n\tpwd.length = strlen(mkey_password);\n\tretval = krb5_principal2salt(util_context, master_princ, &scratch);\n\tif (retval) {\n\t    com_err(progname, retval, \"while calculated master key salt\");\n\t    return(1);\n\t}\n\n\t/* If no encryption type is set, use the default */\n\tif (master_keyblock.enctype == ENCTYPE_UNKNOWN) {\n\t    master_keyblock.enctype = DEFAULT_KDC_ENCTYPE;\n\t    if (!krb5_c_valid_enctype(master_keyblock.enctype))\n\t\tcom_err(progname, KRB5_PROG_KEYTYPE_NOSUPP,\n\t\t\t\"while setting up enctype %d\",\n\t\t\tmaster_keyblock.enctype);\n\t}\n\n\tretval = krb5_c_string_to_key(util_context, master_keyblock.enctype, \n\t\t\t\t      &pwd, &scratch, &master_keyblock);\n\tif (retval) {\n\t    com_err(progname, retval,\n\t\t    \"while transforming master key from password\");\n\t    return(1);\n\t}\n\tfree(scratch.data);\n\tmkey_password = 0;\n    } else if ((retval = krb5_db_fetch_mkey(util_context, master_princ, \n\t\t\t\t\t    master_keyblock.enctype,\n\t\t\t\t\t    manual_mkey, FALSE,\n\t\t\t\t\t    global_params.stash_file,\n\t\t\t\t\t    0, &master_keyblock))) {\n\tcom_err(progname, retval, \"while reading master key\");\n\tcom_err(progname, 0, \"Warning: proceeding without master key\");\n\texit_status++;\n\treturn(0);\n    }\n    if ((retval = krb5_db_verify_master_key(util_context, master_princ, \n\t\t\t\t\t    &master_keyblock))) {\n\tcom_err(progname, retval, \"while verifying master key\");\n\texit_status++;\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    seed.length = master_keyblock.length;\n    seed.data = master_keyblock.contents;\n\n    if ((retval = krb5_c_random_seed(util_context, &seed))) {\n\tcom_err(progname, retval, \"while seeding random number generator\");\n\texit_status++;\n\tmemset((char *)master_keyblock.contents, 0, master_keyblock.length);\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    valid_master_key = 1;\n    dbactive = TRUE;\n    return 0;\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <time.h>",
            "#include <kadm5/adb.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <k5-int.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "char *mkey_password = 0;",
            "int exit_status = 0;",
            "krb5_context util_context;",
            "osa_adb_policy_t policy_db;",
            "kadm5_config_params global_params;",
            "extern krb5_keyblock master_keyblock;",
            "extern krb5_principal master_princ;",
            "krb5_db_entry master_entry;",
            "int\tvalid_master_key = 0;",
            "char *progname;",
            "krb5_boolean manual_mkey = FALSE;",
            "krb5_boolean dbactive = FALSE;",
            "static int open_db_and_mkey(void);",
            "static struct _cmd_table *cmd_lookup(name)\n   char *name;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nchar *mkey_password = 0;\nint exit_status = 0;\nkrb5_context util_context;\nosa_adb_policy_t policy_db;\nkadm5_config_params global_params;\nextern krb5_keyblock master_keyblock;\nextern krb5_principal master_princ;\nkrb5_db_entry master_entry;\nint\tvalid_master_key = 0;\nchar *progname;\nkrb5_boolean manual_mkey = FALSE;\nkrb5_boolean dbactive = FALSE;\nstatic int open_db_and_mkey(void);\nstatic struct _cmd_table *cmd_lookup(name)\n   char *name;\n\nstatic int open_db_and_mkey()\n{\n    krb5_error_code retval;\n    int nentries;\n    krb5_boolean more;\n    krb5_data scratch, pwd, seed;\n\n    dbactive = FALSE;\n    valid_master_key = 0;\n\n    if ((retval = krb5_db_set_name(util_context, global_params.dbname))) {\n\tcom_err(progname, retval, \"while setting active database to '%s'\",\n\t\tglobal_params.dbname);\n\texit_status++;\n\treturn(1);\n    } \n    if ((retval = krb5_db_init(util_context))) {\n\tcom_err(progname, retval, \"while initializing database\");\n\texit_status++;\n\treturn(1);\n    }\n    if ((retval = osa_adb_open_policy(&policy_db, &global_params))) {\n\tcom_err(progname, retval, \"opening policy database\");\n\texit_status++;\n\treturn (1);\n    }\n\n   /* assemble & parse the master key name */\n\n    if ((retval = krb5_db_setup_mkey_name(util_context,\n\t\t\t\t\t  global_params.mkey_name,\n\t\t\t\t\t  global_params.realm, \n\t\t\t\t\t  0, &master_princ))) {\n\tcom_err(progname, retval, \"while setting up master key name\");\n\texit_status++;\n\treturn(1);\n    }\n    nentries = 1;\n    if ((retval = krb5_db_get_principal(util_context, master_princ, \n\t\t\t\t\t&master_entry, &nentries, &more))) {\n\tcom_err(progname, retval, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (more) {\n\tcom_err(progname, KRB5KDC_ERR_PRINCIPAL_NOT_UNIQUE,\n\t\t\"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    } else if (!nentries) {\n\tcom_err(progname, KRB5_KDB_NOENTRY, \"while retrieving master entry\");\n\texit_status++;\n\t(void) krb5_db_fini(util_context);\n\treturn(1);\n    }\n\n    krb5_db_free_principal(util_context, &master_entry, nentries);\n\n    /* the databases are now open, and the master principal exists */\n    dbactive = TRUE;\n    \n    if (mkey_password) {\n\tpwd.data = mkey_password;\n\tpwd.length = strlen(mkey_password);\n\tretval = krb5_principal2salt(util_context, master_princ, &scratch);\n\tif (retval) {\n\t    com_err(progname, retval, \"while calculated master key salt\");\n\t    return(1);\n\t}\n\n\t/* If no encryption type is set, use the default */\n\tif (master_keyblock.enctype == ENCTYPE_UNKNOWN) {\n\t    master_keyblock.enctype = DEFAULT_KDC_ENCTYPE;\n\t    if (!krb5_c_valid_enctype(master_keyblock.enctype))\n\t\tcom_err(progname, KRB5_PROG_KEYTYPE_NOSUPP,\n\t\t\t\"while setting up enctype %d\",\n\t\t\tmaster_keyblock.enctype);\n\t}\n\n\tretval = krb5_c_string_to_key(util_context, master_keyblock.enctype, \n\t\t\t\t      &pwd, &scratch, &master_keyblock);\n\tif (retval) {\n\t    com_err(progname, retval,\n\t\t    \"while transforming master key from password\");\n\t    return(1);\n\t}\n\tfree(scratch.data);\n\tmkey_password = 0;\n    } else if ((retval = krb5_db_fetch_mkey(util_context, master_princ, \n\t\t\t\t\t    master_keyblock.enctype,\n\t\t\t\t\t    manual_mkey, FALSE,\n\t\t\t\t\t    global_params.stash_file,\n\t\t\t\t\t    0, &master_keyblock))) {\n\tcom_err(progname, retval, \"while reading master key\");\n\tcom_err(progname, 0, \"Warning: proceeding without master key\");\n\texit_status++;\n\treturn(0);\n    }\n    if ((retval = krb5_db_verify_master_key(util_context, master_princ, \n\t\t\t\t\t    &master_keyblock))) {\n\tcom_err(progname, retval, \"while verifying master key\");\n\texit_status++;\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    seed.length = master_keyblock.length;\n    seed.data = master_keyblock.contents;\n\n    if ((retval = krb5_c_random_seed(util_context, &seed))) {\n\tcom_err(progname, retval, \"while seeding random number generator\");\n\texit_status++;\n\tmemset((char *)master_keyblock.contents, 0, master_keyblock.length);\n\tkrb5_free_keyblock_contents(util_context, &master_keyblock);\n\treturn(1);\n    }\n\n    valid_master_key = 1;\n    dbactive = TRUE;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd_lookup",
          "args": [
            "cmd_argv[0]"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "argv[0]",
            "KRB5_PROG_KEYTYPE_NOSUPP",
            "\"while setting up enctype %d\"",
            "master_keyblock.enctype"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_c_valid_enctype",
          "args": [
            "master_keyblock.enctype"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "077"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "request_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/ovsec_kadmd.c",
          "lines": "841-846",
          "snippet": "void request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}",
          "includes": [
            "#include    \"purify.h\"",
            "#include    \"misc.h\"",
            "#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */",
            "#include    <string.h>",
            "#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */",
            "#include    <krb5/adm_proto.h>",
            "#include    <kadm5/server_acl.h>",
            "#include    <kadm5/kadm_rpc.h>",
            "#include    <kadm5/admin.h>",
            "#include    <gssrpc/auth_gssapi.h>",
            "#include    \"gssapiP_krb5.h\" /* for kg_get_context */",
            "#include    <gssapi/gssapi.h>",
            "#include    <gssrpc/rpc.h>",
            "#include    <arpa/inet.h>  /* inet_ntoa */",
            "#include    <netinet/in.h>",
            "#include    <unistd.h>",
            "#include    <sys/socket.h>",
            "#include    <sys/time.h>",
            "#include    <sys/select.h>",
            "#include    <sys/types.h>",
            "#include    <syslog.h>",
            "#include    <signal.h>",
            "#include    <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "volatile int\tsignal_request_exit = 0;",
            "void\trequest_exit(int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include    \"purify.h\"\n#include    \"misc.h\"\n#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */\n#include    <string.h>\n#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */\n#include    <krb5/adm_proto.h>\n#include    <kadm5/server_acl.h>\n#include    <kadm5/kadm_rpc.h>\n#include    <kadm5/admin.h>\n#include    <gssrpc/auth_gssapi.h>\n#include    \"gssapiP_krb5.h\" /* for kg_get_context */\n#include    <gssapi/gssapi.h>\n#include    <gssrpc/rpc.h>\n#include    <arpa/inet.h>  /* inet_ntoa */\n#include    <netinet/in.h>\n#include    <unistd.h>\n#include    <sys/socket.h>\n#include    <sys/time.h>\n#include    <sys/select.h>\n#include    <sys/types.h>\n#include    <syslog.h>\n#include    <signal.h>\n#include    <stdio.h>\n\nvolatile int\tsignal_request_exit = 0;\nvoid\trequest_exit(int);\n\nvoid request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "argv[0]",
            "retval",
            "\"while retreiving configuration parameters\""
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kadm5_get_config_params",
          "args": [
            "util_context",
            "NULL",
            "NULL",
            "&global_params",
            "&global_params"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "usage",
          "args": [],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
          "lines": "82-98",
          "snippet": "void usage()\n{\n     fprintf(stderr, \"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\");\n     exit(1);\n}",
          "includes": [
            "#include \"kdb5_util.h\"",
            "#include <time.h>",
            "#include <kadm5/adb.h>",
            "#include <krb5/adm_proto.h>",
            "#include <kadm5/admin.h>",
            "#include <k5-int.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nvoid usage()\n{\n     fprintf(stderr, \"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\");\n     exit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd_lookup",
          "args": [
            "*argv"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-m\""
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-sf\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-M\""
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "argv[0]",
            "0",
            "\"%s is an invalid enctype\"",
            "koptarg"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_string_to_enctype",
          "args": [
            "koptarg",
            "&global_params.enctype"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-k\""
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while setting default realm name\""
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_set_default_realm",
          "args": [
            "util_context",
            "global_params.realm"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-r\""
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-d\""
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "*argv",
            "\"-P\""
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "cmd_argv",
            "0",
            "sizeof(char *)*argc"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "ENOMEM",
            "\"while creating sub-command arguments\""
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(char *)*argc"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "argv[0]",
            "'/'"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "argv[0]",
            "'/'"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "initialize_adb_error_table",
          "args": [],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "com_err",
          "args": [
            "progname",
            "retval",
            "\"while initializing Kerberos code\""
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "krb5_init_context",
          "args": [
            "&util_context"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\n#define ARG_VAL (--argc > 0 ? (koptarg = *(++argv)) : (char *)(usage(), NULL))\n\nchar *mkey_password = 0;\nint exit_status = 0;\nkrb5_context util_context;\nosa_adb_policy_t policy_db;\nkadm5_config_params global_params;\nextern krb5_keyblock master_keyblock;\nint     close_policy_db = 0;\nchar *progname;\nkrb5_boolean manual_mkey = FALSE;\nstatic int open_db_and_mkey(void);\nstatic struct _cmd_table *cmd_lookup(name)\n   char *name;\n\nint main(argc, argv)\n    int argc;\n    char *argv[];\n{\n    struct _cmd_table *cmd = NULL;\n    char *koptarg, **cmd_argv;\t\n    int cmd_argc;\n    krb5_error_code retval;\n\n    retval = krb5_init_context(&util_context);\n    if (retval) {\n\t    com_err (progname, retval, \"while initializing Kerberos code\");\n\t    exit(1);\n    }\n    initialize_adb_error_table();\n\n    progname = (strrchr(argv[0], '/') ? strrchr(argv[0], '/')+1 : argv[0]);\n\n    cmd_argv = (char **) malloc(sizeof(char *)*argc);\n    if (cmd_argv == NULL) {\n\t com_err(progname, ENOMEM, \"while creating sub-command arguments\");\n\t exit(1);\n    }\n    memset(cmd_argv, 0, sizeof(char *)*argc);\n    cmd_argc = 1;\n\t \n    argv++; argc--;\n    while (*argv) {\n       if (strcmp(*argv, \"-P\") == 0 && ARG_VAL) {\n\t    mkey_password = koptarg;\n\t    manual_mkey = TRUE;\n       } else if (strcmp(*argv, \"-d\") == 0 && ARG_VAL) {\n\t    global_params.dbname = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_DBNAME;\n       } else if (strcmp(*argv, \"-r\") == 0 && ARG_VAL) {\n\t    global_params.realm = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_REALM;\n\t    /* not sure this is really necessary */\n\t    if ((retval = krb5_set_default_realm(util_context,\n\t\t\t\t\t\t global_params.realm))) {\n\t\t com_err(progname, retval, \"while setting default realm name\");\n\t\t exit(1);\n\t    }\n       } else if (strcmp(*argv, \"-k\") == 0 && ARG_VAL) {\n\t    if (krb5_string_to_enctype(koptarg, &global_params.enctype))\n\t\t com_err(argv[0], 0, \"%s is an invalid enctype\", koptarg);\n\t    else\n\t\t global_params.mask |= KADM5_CONFIG_ENCTYPE;\n       } else if (strcmp(*argv, \"-M\") == 0 && ARG_VAL) {\n\t    global_params.mkey_name = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_MKEY_NAME;\n       } else if (strcmp(*argv, \"-sf\") == 0 && ARG_VAL) {\n\t    global_params.stash_file = koptarg;\n\t    global_params.mask |= KADM5_CONFIG_STASH_FILE;\n       } else if (strcmp(*argv, \"-m\") == 0) {\n\t    manual_mkey = TRUE;\n\t    global_params.mkey_from_kbd = 1;\n\t    global_params.mask |= KADM5_CONFIG_MKEY_FROM_KBD;\n       } else if (cmd_lookup(*argv) != NULL) {\n\t    if (cmd_argv[0] == NULL)\n\t\t cmd_argv[0] = *argv;\n\t    else\n\t\t usage();\n       } else {\n\t    cmd_argv[cmd_argc++] = *argv;\n       }\n       argv++; argc--;\n    }\n\n    if (cmd_argv[0] == NULL)\n\t usage();\n    \n    retval = kadm5_get_config_params(util_context, NULL, NULL,\n\t\t\t\t     &global_params, &global_params);\n    if (retval) {\n\t com_err(argv[0], retval, \"while retreiving configuration parameters\");\n\t exit(1);\n    }\n\n    /*\n     * Dump creates files which should not be world-readable.  It is\n     * easiest to do a single umask call here.\n     */\n    (void) umask(077);\n\n    master_keyblock.enctype = global_params.enctype;\n    if ((master_keyblock.enctype != ENCTYPE_UNKNOWN) &&\n\t(!krb5_c_valid_enctype(master_keyblock.enctype))) {\n\tcom_err(argv[0], KRB5_PROG_KEYTYPE_NOSUPP,\n\t\t\"while setting up enctype %d\", master_keyblock.enctype);\n    }\n\n    cmd = cmd_lookup(cmd_argv[0]);\n    if (cmd->opendb && open_db_and_mkey())\n\t return exit_status;\n\n    (*cmd->func)(cmd_argc, cmd_argv);\n\n    if(close_policy_db) {\n         (void) osa_adb_close_policy(policy_db);\n    }      \n    kadm5_free_config_params(util_context, &global_params);\n    krb5_free_context(util_context);\n    return exit_status;\n}"
  },
  {
    "function_name": "usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/dbutil/kdb5_util.c",
    "lines": "82-98",
    "snippet": "void usage()\n{\n     fprintf(stderr, \"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\");\n     exit(1);\n}",
    "includes": [
      "#include \"kdb5_util.h\"",
      "#include <time.h>",
      "#include <kadm5/adb.h>",
      "#include <krb5/adm_proto.h>",
      "#include <kadm5/admin.h>",
      "#include <k5-int.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "request_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp_ICV/CVE-2014-9422/repo/src/kadmin/server/ovsec_kadmd.c",
          "lines": "841-846",
          "snippet": "void request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}",
          "includes": [
            "#include    \"purify.h\"",
            "#include    \"misc.h\"",
            "#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */",
            "#include    <string.h>",
            "#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */",
            "#include    <krb5/adm_proto.h>",
            "#include    <kadm5/server_acl.h>",
            "#include    <kadm5/kadm_rpc.h>",
            "#include    <kadm5/admin.h>",
            "#include    <gssrpc/auth_gssapi.h>",
            "#include    \"gssapiP_krb5.h\" /* for kg_get_context */",
            "#include    <gssapi/gssapi.h>",
            "#include    <gssrpc/rpc.h>",
            "#include    <arpa/inet.h>  /* inet_ntoa */",
            "#include    <netinet/in.h>",
            "#include    <unistd.h>",
            "#include    <sys/socket.h>",
            "#include    <sys/time.h>",
            "#include    <sys/select.h>",
            "#include    <sys/types.h>",
            "#include    <syslog.h>",
            "#include    <signal.h>",
            "#include    <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "volatile int\tsignal_request_exit = 0;",
            "void\trequest_exit(int);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include    \"purify.h\"\n#include    \"misc.h\"\n#include    \"kadm5/server_internal.h\" /* XXX for kadm5_server_handle_t */\n#include    <string.h>\n#include    \"krb5/kdb_kt.h\"\t/* for krb5_ktkdb_set_context */\n#include    <krb5/adm_proto.h>\n#include    <kadm5/server_acl.h>\n#include    <kadm5/kadm_rpc.h>\n#include    <kadm5/admin.h>\n#include    <gssrpc/auth_gssapi.h>\n#include    \"gssapiP_krb5.h\" /* for kg_get_context */\n#include    <gssapi/gssapi.h>\n#include    <gssrpc/rpc.h>\n#include    <arpa/inet.h>  /* inet_ntoa */\n#include    <netinet/in.h>\n#include    <unistd.h>\n#include    <sys/socket.h>\n#include    <sys/time.h>\n#include    <sys/select.h>\n#include    <sys/types.h>\n#include    <syslog.h>\n#include    <signal.h>\n#include    <stdio.h>\n\nvolatile int\tsignal_request_exit = 0;\nvoid\trequest_exit(int);\n\nvoid request_exit(int signum)\n{\n     krb5_klog_syslog(LOG_DEBUG, \"Got signal to request exit\");\n     signal_request_exit = 1;\n     return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\""
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"kdb5_util.h\"\n#include <time.h>\n#include <kadm5/adb.h>\n#include <krb5/adm_proto.h>\n#include <kadm5/admin.h>\n#include <k5-int.h>\n#include <stdio.h>\n\nvoid usage()\n{\n     fprintf(stderr, \"Usage: \"\n\t   \"kdb5_util [-r realm] [-d dbname] [-k mkeytype] [-M mkeyname]\\n\"\n\t     \"\\t        [-sf stashfilename] [-m] cmd [cmd_options]\\n\"\n\t     \"\\tcreate\t[-s]\\n\"\n\t     \"\\tdestroy\t[-f]\\n\"\n\t     \"\\tstash\t[-f keyfile]\\n\"\n\t     \"\\tdump\t[-old] [-ov] [-b6] [-verbose]\\n\"\n\t     \"\\t\t[-mkey_convert] [-new_mkey_file mkey_file]\\n\"\n\t     \"\\t\t[-rev] [-recurse] [filename [princs...]]\\n\"\n\t     \"\\tload\t[-old] [-ov] [-b6] [-verbose] [-update] filename\\n\"\n\t     \"\\tdump_v4\t[-S] [filename]\\n\"\n\t     \"\\tload_v4\t[-S] [-t] [-n] [-v] [-K] [-s stashfile] inputfile\\n\"\n\t     \"\\tark\t[-e etype_list] principal\\n\");\n     exit(1);\n}"
  }
]