[
  {
    "function_name": "pg_backend_random",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
    "lines": "102-155",
    "snippet": "bool\npg_backend_random(char *dst, int len)\n{\n\tint\t\t\ti;\n\tchar\t   *end = dst + len;\n\n\t/* should not be called in postmaster */\n\tAssert(IsUnderPostmaster || !IsPostmasterEnvironment);\n\n\tLWLockAcquire(BackendRandomLock, LW_EXCLUSIVE);\n\n\t/*\n\t * Seed the PRNG on the first use.\n\t */\n\tif (!BackendRandomShmem->initialized)\n\t{\n\t\tstruct timeval now;\n\n\t\tgettimeofday(&now, NULL);\n\n\t\tBackendRandomShmem->seed[0] = now.tv_sec;\n\t\tBackendRandomShmem->seed[1] = (unsigned short) (now.tv_usec);\n\t\tBackendRandomShmem->seed[2] = (unsigned short) (now.tv_usec >> 16);\n\n\t\t/*\n\t\t * Mix in the cancel key, generated by the postmaster. This adds what\n\t\t * little entropy the postmaster had to the seed.\n\t\t */\n\t\tBackendRandomShmem->seed[0] ^= (MyCancelKey);\n\t\tBackendRandomShmem->seed[1] ^= (MyCancelKey >> 16);\n\n\t\tBackendRandomShmem->initialized = true;\n\t}\n\n\tfor (i = 0; dst < end; i++)\n\t{\n\t\tuint32\t\tr;\n\t\tint\t\t\tj;\n\n\t\t/*\n\t\t * pg_jrand48 returns a 32-bit integer. Fill the next 4 bytes from it.\n\t\t */\n\t\tr = (uint32) pg_jrand48(BackendRandomShmem->seed);\n\n\t\tfor (j = 0; j < 4 && dst < end; j++)\n\t\t{\n\t\t\t*(dst++) = (char) (r & 0xFF);\n\t\t\tr >>= 8;\n\t\t}\n\t}\n\tLWLockRelease(BackendRandomLock);\n\n\treturn true;\n}",
    "includes": [
      "#include \"utils/timestamp.h\"",
      "#include \"utils/backend_random.h\"",
      "#include \"storage/shmem.h\"",
      "#include \"storage/lwlock.h\"",
      "#include \"miscadmin.h\"",
      "#include <sys/time.h>",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "LWLockRelease",
          "args": [
            "BackendRandomLock"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pg_jrand48",
          "args": [
            "BackendRandomShmem->seed"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gettimeofday",
          "args": [
            "&now",
            "NULL"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LWLockAcquire",
          "args": [
            "BackendRandomLock",
            "LW_EXCLUSIVE"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "IsUnderPostmaster || !IsPostmasterEnvironment"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nbool\npg_backend_random(char *dst, int len)\n{\n\tint\t\t\ti;\n\tchar\t   *end = dst + len;\n\n\t/* should not be called in postmaster */\n\tAssert(IsUnderPostmaster || !IsPostmasterEnvironment);\n\n\tLWLockAcquire(BackendRandomLock, LW_EXCLUSIVE);\n\n\t/*\n\t * Seed the PRNG on the first use.\n\t */\n\tif (!BackendRandomShmem->initialized)\n\t{\n\t\tstruct timeval now;\n\n\t\tgettimeofday(&now, NULL);\n\n\t\tBackendRandomShmem->seed[0] = now.tv_sec;\n\t\tBackendRandomShmem->seed[1] = (unsigned short) (now.tv_usec);\n\t\tBackendRandomShmem->seed[2] = (unsigned short) (now.tv_usec >> 16);\n\n\t\t/*\n\t\t * Mix in the cancel key, generated by the postmaster. This adds what\n\t\t * little entropy the postmaster had to the seed.\n\t\t */\n\t\tBackendRandomShmem->seed[0] ^= (MyCancelKey);\n\t\tBackendRandomShmem->seed[1] ^= (MyCancelKey >> 16);\n\n\t\tBackendRandomShmem->initialized = true;\n\t}\n\n\tfor (i = 0; dst < end; i++)\n\t{\n\t\tuint32\t\tr;\n\t\tint\t\t\tj;\n\n\t\t/*\n\t\t * pg_jrand48 returns a 32-bit integer. Fill the next 4 bytes from it.\n\t\t */\n\t\tr = (uint32) pg_jrand48(BackendRandomShmem->seed);\n\n\t\tfor (j = 0; j < 4 && dst < end; j++)\n\t\t{\n\t\t\t*(dst++) = (char) (r & 0xFF);\n\t\t\tr >>= 8;\n\t\t}\n\t}\n\tLWLockRelease(BackendRandomLock);\n\n\treturn true;\n}"
  },
  {
    "function_name": "BackendRandomShmemInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
    "lines": "82-100",
    "snippet": "void\nBackendRandomShmemInit(void)\n{\n\tbool\t\tfound;\n\n\tBackendRandomShmem = (BackendRandomShmemStruct *)\n\t\tShmemInitStruct(\"Backend PRNG state\",\n\t\t\t\t\t\tBackendRandomShmemSize(),\n\t\t\t\t\t\t&found);\n\n\tif (!IsUnderPostmaster)\n\t{\n\t\tAssert(!found);\n\n\t\tBackendRandomShmem->initialized = false;\n\t}\n\telse\n\t\tAssert(found);\n}",
    "includes": [
      "#include \"utils/timestamp.h\"",
      "#include \"utils/backend_random.h\"",
      "#include \"storage/shmem.h\"",
      "#include \"storage/lwlock.h\"",
      "#include \"miscadmin.h\"",
      "#include <sys/time.h>",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "found"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "!found"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ShmemInitStruct",
          "args": [
            "\"Backend PRNG state\"",
            "BackendRandomShmemSize()",
            "&found"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BackendRandomShmemSize",
          "args": [],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "BackendRandomShmemSize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
          "lines": "76-80",
          "snippet": "Size\nBackendRandomShmemSize(void)\n{\n\treturn sizeof(BackendRandomShmemStruct);\n}",
          "includes": [
            "#include \"utils/timestamp.h\"",
            "#include \"utils/backend_random.h\"",
            "#include \"storage/shmem.h\"",
            "#include \"storage/lwlock.h\"",
            "#include \"miscadmin.h\"",
            "#include <sys/time.h>",
            "#include \"postgres.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nSize\nBackendRandomShmemSize(void)\n{\n\treturn sizeof(BackendRandomShmemStruct);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nvoid\nBackendRandomShmemInit(void)\n{\n\tbool\t\tfound;\n\n\tBackendRandomShmem = (BackendRandomShmemStruct *)\n\t\tShmemInitStruct(\"Backend PRNG state\",\n\t\t\t\t\t\tBackendRandomShmemSize(),\n\t\t\t\t\t\t&found);\n\n\tif (!IsUnderPostmaster)\n\t{\n\t\tAssert(!found);\n\n\t\tBackendRandomShmem->initialized = false;\n\t}\n\telse\n\t\tAssert(found);\n}"
  },
  {
    "function_name": "BackendRandomShmemSize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
    "lines": "76-80",
    "snippet": "Size\nBackendRandomShmemSize(void)\n{\n\treturn sizeof(BackendRandomShmemStruct);\n}",
    "includes": [
      "#include \"utils/timestamp.h\"",
      "#include \"utils/backend_random.h\"",
      "#include \"storage/shmem.h\"",
      "#include \"storage/lwlock.h\"",
      "#include \"miscadmin.h\"",
      "#include <sys/time.h>",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nSize\nBackendRandomShmemSize(void)\n{\n\treturn sizeof(BackendRandomShmemStruct);\n}"
  },
  {
    "function_name": "pg_backend_random",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
    "lines": "52-59",
    "snippet": "bool\npg_backend_random(char *dst, int len)\n{\n\t/* should not be called in postmaster */\n\tAssert(IsUnderPostmaster || !IsPostmasterEnvironment);\n\n\treturn pg_strong_random(dst, len);\n}",
    "includes": [
      "#include \"utils/timestamp.h\"",
      "#include \"utils/backend_random.h\"",
      "#include \"storage/shmem.h\"",
      "#include \"storage/lwlock.h\"",
      "#include \"miscadmin.h\"",
      "#include <sys/time.h>",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pg_strong_random",
          "args": [
            "dst",
            "len"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "IsUnderPostmaster || !IsPostmasterEnvironment"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nbool\npg_backend_random(char *dst, int len)\n{\n\t/* should not be called in postmaster */\n\tAssert(IsUnderPostmaster || !IsPostmasterEnvironment);\n\n\treturn pg_strong_random(dst, len);\n}"
  },
  {
    "function_name": "BackendRandomShmemInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
    "lines": "46-50",
    "snippet": "void\nBackendRandomShmemInit(void)\n{\n\t/* do nothing */\n}",
    "includes": [
      "#include \"utils/timestamp.h\"",
      "#include \"utils/backend_random.h\"",
      "#include \"storage/shmem.h\"",
      "#include \"storage/lwlock.h\"",
      "#include \"miscadmin.h\"",
      "#include <sys/time.h>",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nvoid\nBackendRandomShmemInit(void)\n{\n\t/* do nothing */\n}"
  },
  {
    "function_name": "BackendRandomShmemSize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/backend_random.c",
    "lines": "40-44",
    "snippet": "Size\nBackendRandomShmemSize(void)\n{\n\treturn 0;\n}",
    "includes": [
      "#include \"utils/timestamp.h\"",
      "#include \"utils/backend_random.h\"",
      "#include \"storage/shmem.h\"",
      "#include \"storage/lwlock.h\"",
      "#include \"miscadmin.h\"",
      "#include <sys/time.h>",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"utils/timestamp.h\"\n#include \"utils/backend_random.h\"\n#include \"storage/shmem.h\"\n#include \"storage/lwlock.h\"\n#include \"miscadmin.h\"\n#include <sys/time.h>\n#include \"postgres.h\"\n\nSize\nBackendRandomShmemSize(void)\n{\n\treturn 0;\n}"
  }
]