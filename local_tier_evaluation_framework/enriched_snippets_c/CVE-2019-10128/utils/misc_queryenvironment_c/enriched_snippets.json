[
  {
    "function_name": "ENRMetadataGetTupDesc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
    "lines": "124-144",
    "snippet": "TupleDesc\nENRMetadataGetTupDesc(EphemeralNamedRelationMetadata enrmd)\n{\n\tTupleDesc\ttupdesc;\n\n\t/* One, and only one, of these fields must be filled. */\n\tAssert((enrmd->reliddesc == InvalidOid) != (enrmd->tupdesc == NULL));\n\n\tif (enrmd->tupdesc != NULL)\n\t\ttupdesc = enrmd->tupdesc;\n\telse\n\t{\n\t\tRelation\trelation;\n\n\t\trelation = heap_open(enrmd->reliddesc, NoLock);\n\t\ttupdesc = relation->rd_att;\n\t\theap_close(relation, NoLock);\n\t}\n\n\treturn tupdesc;\n}",
    "includes": [
      "#include \"utils/rel.h\"",
      "#include \"utils/queryenvironment.h\"",
      "#include \"access/heapam.h\"",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "heap_close",
          "args": [
            "relation",
            "NoLock"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "heap_open",
          "args": [
            "enrmd->reliddesc",
            "NoLock"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "(enrmd->reliddesc == InvalidOid) != (enrmd->tupdesc == NULL)"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nTupleDesc\nENRMetadataGetTupDesc(EphemeralNamedRelationMetadata enrmd)\n{\n\tTupleDesc\ttupdesc;\n\n\t/* One, and only one, of these fields must be filled. */\n\tAssert((enrmd->reliddesc == InvalidOid) != (enrmd->tupdesc == NULL));\n\n\tif (enrmd->tupdesc != NULL)\n\t\ttupdesc = enrmd->tupdesc;\n\telse\n\t{\n\t\tRelation\trelation;\n\n\t\trelation = heap_open(enrmd->reliddesc, NoLock);\n\t\ttupdesc = relation->rd_att;\n\t\theap_close(relation, NoLock);\n\t}\n\n\treturn tupdesc;\n}"
  },
  {
    "function_name": "get_ENR",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
    "lines": "95-114",
    "snippet": "EphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"utils/rel.h\"",
      "#include \"utils/queryenvironment.h\"",
      "#include \"access/heapam.h\"",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "enr->md.name",
            "name"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "namestrcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/adt/name.c",
          "lines": "246-256",
          "snippet": "int\nnamestrcmp(Name name, const char *str)\n{\n\tif (!name && !str)\n\t\treturn 0;\n\tif (!name)\n\t\treturn -1;\t\t\t\t/* NULL < anything */\n\tif (!str)\n\t\treturn 1;\t\t\t\t/* NULL < anything */\n\treturn strncmp(NameStr(*name), str, NAMEDATALEN);\n}",
          "includes": [
            "#include \"utils/lsyscache.h\"",
            "#include \"utils/builtins.h\"",
            "#include \"utils/array.h\"",
            "#include \"miscadmin.h\"",
            "#include \"mb/pg_wchar.h\"",
            "#include \"libpq/pqformat.h\"",
            "#include \"catalog/pg_type.h\"",
            "#include \"catalog/namespace.h\"",
            "#include \"postgres.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils/lsyscache.h\"\n#include \"utils/builtins.h\"\n#include \"utils/array.h\"\n#include \"miscadmin.h\"\n#include \"mb/pg_wchar.h\"\n#include \"libpq/pqformat.h\"\n#include \"catalog/pg_type.h\"\n#include \"catalog/namespace.h\"\n#include \"postgres.h\"\n\nint\nnamestrcmp(Name name, const char *str)\n{\n\tif (!name && !str)\n\t\treturn 0;\n\tif (!name)\n\t\treturn -1;\t\t\t\t/* NULL < anything */\n\tif (!str)\n\t\treturn 1;\t\t\t\t/* NULL < anything */\n\treturn strncmp(NameStr(*name), str, NAMEDATALEN);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lfirst",
          "args": [
            "lc"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "foreach",
          "args": [
            "lc",
            "queryEnv->namedRelList"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "name != NULL"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nEphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "unregister_ENR",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
    "lines": "81-89",
    "snippet": "void\nunregister_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tEphemeralNamedRelation match;\n\n\tmatch = get_ENR(queryEnv, name);\n\tif (match)\n\t\tqueryEnv->namedRelList = list_delete(queryEnv->namedRelList, match);\n}",
    "includes": [
      "#include \"utils/rel.h\"",
      "#include \"utils/queryenvironment.h\"",
      "#include \"access/heapam.h\"",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "list_delete",
          "args": [
            "queryEnv->namedRelList",
            "match"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_ENR",
          "args": [
            "queryEnv",
            "name"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "get_ENR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
          "lines": "95-114",
          "snippet": "EphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"utils/rel.h\"",
            "#include \"utils/queryenvironment.h\"",
            "#include \"access/heapam.h\"",
            "#include \"postgres.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nEphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nvoid\nunregister_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tEphemeralNamedRelation match;\n\n\tmatch = get_ENR(queryEnv, name);\n\tif (match)\n\t\tqueryEnv->namedRelList = list_delete(queryEnv->namedRelList, match);\n}"
  },
  {
    "function_name": "register_ENR",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
    "lines": "68-75",
    "snippet": "void\nregister_ENR(QueryEnvironment *queryEnv, EphemeralNamedRelation enr)\n{\n\tAssert(enr != NULL);\n\tAssert(get_ENR(queryEnv, enr->md.name) == NULL);\n\n\tqueryEnv->namedRelList = lappend(queryEnv->namedRelList, enr);\n}",
    "includes": [
      "#include \"utils/rel.h\"",
      "#include \"utils/queryenvironment.h\"",
      "#include \"access/heapam.h\"",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lappend",
          "args": [
            "queryEnv->namedRelList",
            "enr"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "get_ENR(queryEnv, enr->md.name) == NULL"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_ENR",
          "args": [
            "queryEnv",
            "enr->md.name"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "get_ENR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
          "lines": "95-114",
          "snippet": "EphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"utils/rel.h\"",
            "#include \"utils/queryenvironment.h\"",
            "#include \"access/heapam.h\"",
            "#include \"postgres.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nEphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "enr != NULL"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nvoid\nregister_ENR(QueryEnvironment *queryEnv, EphemeralNamedRelation enr)\n{\n\tAssert(enr != NULL);\n\tAssert(get_ENR(queryEnv, enr->md.name) == NULL);\n\n\tqueryEnv->namedRelList = lappend(queryEnv->namedRelList, enr);\n}"
  },
  {
    "function_name": "get_visible_ENR_metadata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
    "lines": "44-60",
    "snippet": "EphemeralNamedRelationMetadata\nget_visible_ENR_metadata(QueryEnvironment *queryEnv, const char *refname)\n{\n\tEphemeralNamedRelation enr;\n\n\tAssert(refname != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tenr = get_ENR(queryEnv, refname);\n\n\tif (enr)\n\t\treturn &(enr->md);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"utils/rel.h\"",
      "#include \"utils/queryenvironment.h\"",
      "#include \"access/heapam.h\"",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_ENR",
          "args": [
            "queryEnv",
            "refname"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "get_ENR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
          "lines": "95-114",
          "snippet": "EphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"utils/rel.h\"",
            "#include \"utils/queryenvironment.h\"",
            "#include \"access/heapam.h\"",
            "#include \"postgres.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nEphemeralNamedRelation\nget_ENR(QueryEnvironment *queryEnv, const char *name)\n{\n\tListCell   *lc;\n\n\tAssert(name != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tforeach(lc, queryEnv->namedRelList)\n\t{\n\t\tEphemeralNamedRelation enr = (EphemeralNamedRelation) lfirst(lc);\n\n\t\tif (strcmp(enr->md.name, name) == 0)\n\t\t\treturn enr;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "Assert",
          "args": [
            "refname != NULL"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nEphemeralNamedRelationMetadata\nget_visible_ENR_metadata(QueryEnvironment *queryEnv, const char *refname)\n{\n\tEphemeralNamedRelation enr;\n\n\tAssert(refname != NULL);\n\n\tif (queryEnv == NULL)\n\t\treturn NULL;\n\n\tenr = get_ENR(queryEnv, refname);\n\n\tif (enr)\n\t\treturn &(enr->md);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "create_queryEnv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/misc/queryenvironment.c",
    "lines": "38-42",
    "snippet": "QueryEnvironment *\ncreate_queryEnv()\n{\n\treturn (QueryEnvironment *) palloc0(sizeof(QueryEnvironment));\n}",
    "includes": [
      "#include \"utils/rel.h\"",
      "#include \"utils/queryenvironment.h\"",
      "#include \"access/heapam.h\"",
      "#include \"postgres.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "palloc0",
          "args": [
            "sizeof(QueryEnvironment)"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "palloc0",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-10128/repo/src/backend/utils/mmgr/mcxt.c",
          "lines": "954-985",
          "snippet": "void *\npalloc0(Size size)\n{\n\t/* duplicates MemoryContextAllocZero to avoid increased overhead */\n\tvoid\t   *ret;\n\tMemoryContext context = CurrentMemoryContext;\n\n\tAssertArg(MemoryContextIsValid(context));\n\tAssertNotInCriticalSection(context);\n\n\tif (!AllocSizeIsValid(size))\n\t\telog(ERROR, \"invalid memory alloc request size %zu\", size);\n\n\tcontext->isReset = false;\n\n\tret = context->methods->alloc(context, size);\n\tif (unlikely(ret == NULL))\n\t{\n\t\tMemoryContextStats(TopMemoryContext);\n\t\tereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t errmsg(\"out of memory\"),\n\t\t\t\t errdetail(\"Failed on request of size %zu in memory context \\\"%s\\\".\",\n\t\t\t\t\t\t   size, context->name)));\n\t}\n\n\tVALGRIND_MEMPOOL_ALLOC(context, ret, size);\n\n\tMemSetAligned(ret, 0, size);\n\n\treturn ret;\n}",
          "includes": [
            "#include \"utils/memutils.h\"",
            "#include \"utils/memdebug.h\"",
            "#include \"miscadmin.h\"",
            "#include \"mb/pg_wchar.h\"",
            "#include \"postgres.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "MemoryContext CurrentMemoryContext = NULL;",
            "MemoryContext TopMemoryContext = NULL;",
            "static void MemoryContextCallResetCallbacks(MemoryContext context);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"utils/memutils.h\"\n#include \"utils/memdebug.h\"\n#include \"miscadmin.h\"\n#include \"mb/pg_wchar.h\"\n#include \"postgres.h\"\n\nMemoryContext CurrentMemoryContext = NULL;\nMemoryContext TopMemoryContext = NULL;\nstatic void MemoryContextCallResetCallbacks(MemoryContext context);\n\nvoid *\npalloc0(Size size)\n{\n\t/* duplicates MemoryContextAllocZero to avoid increased overhead */\n\tvoid\t   *ret;\n\tMemoryContext context = CurrentMemoryContext;\n\n\tAssertArg(MemoryContextIsValid(context));\n\tAssertNotInCriticalSection(context);\n\n\tif (!AllocSizeIsValid(size))\n\t\telog(ERROR, \"invalid memory alloc request size %zu\", size);\n\n\tcontext->isReset = false;\n\n\tret = context->methods->alloc(context, size);\n\tif (unlikely(ret == NULL))\n\t{\n\t\tMemoryContextStats(TopMemoryContext);\n\t\tereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t errmsg(\"out of memory\"),\n\t\t\t\t errdetail(\"Failed on request of size %zu in memory context \\\"%s\\\".\",\n\t\t\t\t\t\t   size, context->name)));\n\t}\n\n\tVALGRIND_MEMPOOL_ALLOC(context, ret, size);\n\n\tMemSetAligned(ret, 0, size);\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"utils/rel.h\"\n#include \"utils/queryenvironment.h\"\n#include \"access/heapam.h\"\n#include \"postgres.h\"\n\nQueryEnvironment *\ncreate_queryEnv()\n{\n\treturn (QueryEnvironment *) palloc0(sizeof(QueryEnvironment));\n}"
  }
]