[
  {
    "function_name": "do_clock_gettime",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "73-92",
    "snippet": "int do_clock_gettime(clockid_t which_clock, struct timespec64 *tp)\n{\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\t\tktime_get_real_ts64(tp);\n\t\tbreak;\n\tcase CLOCK_MONOTONIC:\n\t\tktime_get_ts64(tp);\n\t\ttimens_add_monotonic(tp);\n\t\tbreak;\n\tcase CLOCK_BOOTTIME:\n\t\tktime_get_boottime_ts64(tp);\n\t\ttimens_add_boottime(tp);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "timens_add_boottime",
          "args": [
            "tp"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ktime_get_boottime_ts64",
          "args": [
            "tp"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "timens_add_monotonic",
          "args": [
            "tp"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ktime_get_ts64",
          "args": [
            "tp"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "ktime_get_ts64",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timekeeping.c",
          "lines": "950-970",
          "snippet": "void ktime_get_ts64(struct timespec64 *ts)\n{\n\tstruct timekeeper *tk = &tk_core.timekeeper;\n\tstruct timespec64 tomono;\n\tunsigned int seq;\n\tu64 nsec;\n\n\tWARN_ON(timekeeping_suspended);\n\n\tdo {\n\t\tseq = read_seqcount_begin(&tk_core.seq);\n\t\tts->tv_sec = tk->xtime_sec;\n\t\tnsec = timekeeping_get_ns(&tk->tkr_mono);\n\t\ttomono = tk->wall_to_monotonic;\n\n\t} while (read_seqcount_retry(&tk_core.seq, seq));\n\n\tts->tv_sec += tomono.tv_sec;\n\tts->tv_nsec = 0;\n\ttimespec64_add_ns(ts, nsec + tomono.tv_nsec);\n}",
          "includes": [
            "#include \"timekeeping_internal.h\"",
            "#include \"ntp_internal.h\"",
            "#include \"tick-internal.h\"",
            "#include <linux/audit.h>",
            "#include <linux/compiler.h>",
            "#include <linux/pvclock_gtod.h>",
            "#include <linux/stop_machine.h>",
            "#include <linux/tick.h>",
            "#include <linux/time.h>",
            "#include <linux/jiffies.h>",
            "#include <linux/clocksource.h>",
            "#include <linux/syscore_ops.h>",
            "#include <linux/sched/clock.h>",
            "#include <linux/sched/loadavg.h>",
            "#include <linux/sched.h>",
            "#include <linux/nmi.h>",
            "#include <linux/mm.h>",
            "#include <linux/init.h>",
            "#include <linux/percpu.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/module.h>",
            "#include <linux/timekeeper_internal.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timekeeping_internal.h\"\n#include \"ntp_internal.h\"\n#include \"tick-internal.h\"\n#include <linux/audit.h>\n#include <linux/compiler.h>\n#include <linux/pvclock_gtod.h>\n#include <linux/stop_machine.h>\n#include <linux/tick.h>\n#include <linux/time.h>\n#include <linux/jiffies.h>\n#include <linux/clocksource.h>\n#include <linux/syscore_ops.h>\n#include <linux/sched/clock.h>\n#include <linux/sched/loadavg.h>\n#include <linux/sched.h>\n#include <linux/nmi.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n#include <linux/percpu.h>\n#include <linux/interrupt.h>\n#include <linux/module.h>\n#include <linux/timekeeper_internal.h>\n\nvoid ktime_get_ts64(struct timespec64 *ts)\n{\n\tstruct timekeeper *tk = &tk_core.timekeeper;\n\tstruct timespec64 tomono;\n\tunsigned int seq;\n\tu64 nsec;\n\n\tWARN_ON(timekeeping_suspended);\n\n\tdo {\n\t\tseq = read_seqcount_begin(&tk_core.seq);\n\t\tts->tv_sec = tk->xtime_sec;\n\t\tnsec = timekeeping_get_ns(&tk->tkr_mono);\n\t\ttomono = tk->wall_to_monotonic;\n\n\t} while (read_seqcount_retry(&tk_core.seq, seq));\n\n\tts->tv_sec += tomono.tv_sec;\n\tts->tv_nsec = 0;\n\ttimespec64_add_ns(ts, nsec + tomono.tv_nsec);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ktime_get_real_ts64",
          "args": [
            "tp"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "ktime_get_real_ts64",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timekeeping.c",
          "lines": "796-814",
          "snippet": "void ktime_get_real_ts64(struct timespec64 *ts)\n{\n\tstruct timekeeper *tk = &tk_core.timekeeper;\n\tunsigned int seq;\n\tu64 nsecs;\n\n\tWARN_ON(timekeeping_suspended);\n\n\tdo {\n\t\tseq = read_seqcount_begin(&tk_core.seq);\n\n\t\tts->tv_sec = tk->xtime_sec;\n\t\tnsecs = timekeeping_get_ns(&tk->tkr_mono);\n\n\t} while (read_seqcount_retry(&tk_core.seq, seq));\n\n\tts->tv_nsec = 0;\n\ttimespec64_add_ns(ts, nsecs);\n}",
          "includes": [
            "#include \"timekeeping_internal.h\"",
            "#include \"ntp_internal.h\"",
            "#include \"tick-internal.h\"",
            "#include <linux/audit.h>",
            "#include <linux/compiler.h>",
            "#include <linux/pvclock_gtod.h>",
            "#include <linux/stop_machine.h>",
            "#include <linux/tick.h>",
            "#include <linux/time.h>",
            "#include <linux/jiffies.h>",
            "#include <linux/clocksource.h>",
            "#include <linux/syscore_ops.h>",
            "#include <linux/sched/clock.h>",
            "#include <linux/sched/loadavg.h>",
            "#include <linux/sched.h>",
            "#include <linux/nmi.h>",
            "#include <linux/mm.h>",
            "#include <linux/init.h>",
            "#include <linux/percpu.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/module.h>",
            "#include <linux/timekeeper_internal.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timekeeping_internal.h\"\n#include \"ntp_internal.h\"\n#include \"tick-internal.h\"\n#include <linux/audit.h>\n#include <linux/compiler.h>\n#include <linux/pvclock_gtod.h>\n#include <linux/stop_machine.h>\n#include <linux/tick.h>\n#include <linux/time.h>\n#include <linux/jiffies.h>\n#include <linux/clocksource.h>\n#include <linux/syscore_ops.h>\n#include <linux/sched/clock.h>\n#include <linux/sched/loadavg.h>\n#include <linux/sched.h>\n#include <linux/nmi.h>\n#include <linux/mm.h>\n#include <linux/init.h>\n#include <linux/percpu.h>\n#include <linux/interrupt.h>\n#include <linux/module.h>\n#include <linux/timekeeper_internal.h>\n\nvoid ktime_get_real_ts64(struct timespec64 *ts)\n{\n\tstruct timekeeper *tk = &tk_core.timekeeper;\n\tunsigned int seq;\n\tu64 nsecs;\n\n\tWARN_ON(timekeeping_suspended);\n\n\tdo {\n\t\tseq = read_seqcount_begin(&tk_core.seq);\n\n\t\tts->tv_sec = tk->xtime_sec;\n\t\tnsecs = timekeeping_get_ns(&tk->tkr_mono);\n\n\t} while (read_seqcount_retry(&tk_core.seq, seq));\n\n\tts->tv_nsec = 0;\n\ttimespec64_add_ns(ts, nsecs);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nint do_clock_gettime(clockid_t which_clock, struct timespec64 *tp)\n{\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\t\tktime_get_real_ts64(tp);\n\t\tbreak;\n\tcase CLOCK_MONOTONIC:\n\t\tktime_get_ts64(tp);\n\t\ttimens_add_monotonic(tp);\n\t\tbreak;\n\tcase CLOCK_BOOTTIME:\n\t\tktime_get_boottime_ts64(tp);\n\t\ttimens_add_boottime(tp);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sys_ni_posix_timers",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "25-31",
    "snippet": "asmlinkage long sys_ni_posix_timers(void)\n{\n\tpr_err_once(\"process %d (%s) attempted a POSIX timer syscall \"\n\t\t    \"while CONFIG_POSIX_TIMERS is not set\\n\",\n\t\t    current->pid, current->comm);\n\treturn -ENOSYS;\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_err_once",
          "args": [
            "\"process %d (%s) attempted a POSIX timer syscall \"\n\t\t    \"while CONFIG_POSIX_TIMERS is not set\\n\"",
            "current->pid",
            "current->comm"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nasmlinkage long sys_ni_posix_timers(void)\n{\n\tpr_err_once(\"process %d (%s) attempted a POSIX timer syscall \"\n\t\t    \"while CONFIG_POSIX_TIMERS is not set\\n\",\n\t\t    current->pid, current->comm);\n\treturn -ENOSYS;\n}"
  },
  {
    "function_name": "clock_settime",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "60-71",
    "snippet": "SYSCALL_DEFINE2(clock_settime, const clockid_t, which_clock,\n\t\tconst struct __kernel_timespec __user *, tp)\n{\n\tstruct timespec64 new_tp;\n\n\tif (which_clock != CLOCK_REALTIME)\n\t\treturn -EINVAL;\n\tif (get_timespec64(&new_tp, tp))\n\t\treturn -EFAULT;\n\n\treturn do_sys_settimeofday64(&new_tp, NULL);\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE2(clock_settime, const clockid_t, which_clock,\n\t\tconst struct __kernel_timespec __user *, tp)\n{\n\tstruct timespec64 new_tp;\n\n\tif (which_clock != CLOCK_REALTIME)\n\t\treturn -EINVAL;\n\tif (get_timespec64(&new_tp, tp))\n\t\treturn -EFAULT;\n\n\treturn do_sys_settimeofday64(&new_tp, NULL);\n}"
  },
  {
    "function_name": "clock_gettime",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "93-106",
    "snippet": "SYSCALL_DEFINE2(clock_gettime, const clockid_t, which_clock,\n\t\tstruct __kernel_timespec __user *, tp)\n{\n\tint ret;\n\tstruct timespec64 kernel_tp;\n\n\tret = do_clock_gettime(which_clock, &kernel_tp);\n\tif (ret)\n\t\treturn ret;\n\n\tif (put_timespec64(&kernel_tp, tp))\n\t\treturn -EFAULT;\n\treturn 0;\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE2(clock_gettime, const clockid_t, which_clock,\n\t\tstruct __kernel_timespec __user *, tp)\n{\n\tint ret;\n\tstruct timespec64 kernel_tp;\n\n\tret = do_clock_gettime(which_clock, &kernel_tp);\n\tif (ret)\n\t\treturn ret;\n\n\tif (put_timespec64(&kernel_tp, tp))\n\t\treturn -EFAULT;\n\treturn 0;\n}"
  },
  {
    "function_name": "clock_getres",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "108-125",
    "snippet": "SYSCALL_DEFINE2(clock_getres, const clockid_t, which_clock, struct __kernel_timespec __user *, tp)\n{\n\tstruct timespec64 rtn_tp = {\n\t\t.tv_sec = 0,\n\t\t.tv_nsec = hrtimer_resolution,\n\t};\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tif (put_timespec64(&rtn_tp, tp))\n\t\t\treturn -EFAULT;\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE2(clock_getres, const clockid_t, which_clock, struct __kernel_timespec __user *, tp)\n{\n\tstruct timespec64 rtn_tp = {\n\t\t.tv_sec = 0,\n\t\t.tv_nsec = hrtimer_resolution,\n\t};\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tif (put_timespec64(&rtn_tp, tp))\n\t\t\treturn -EFAULT;\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}"
  },
  {
    "function_name": "clock_nanosleep",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "127-157",
    "snippet": "SYSCALL_DEFINE4(clock_nanosleep, const clockid_t, which_clock, int, flags,\n\t\tconst struct __kernel_timespec __user *, rqtp,\n\t\tstruct __kernel_timespec __user *, rmtp)\n{\n\tstruct timespec64 t;\n\tktime_t texp;\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (get_timespec64(&t, rqtp))\n\t\treturn -EFAULT;\n\tif (!timespec64_valid(&t))\n\t\treturn -EINVAL;\n\tif (flags & TIMER_ABSTIME)\n\t\trmtp = NULL;\n\tcurrent->restart_block.nanosleep.type = rmtp ? TT_NATIVE : TT_NONE;\n\tcurrent->restart_block.nanosleep.rmtp = rmtp;\n\ttexp = timespec64_to_ktime(t);\n\tif (flags & TIMER_ABSTIME)\n\t\ttexp = timens_ktime_to_host(which_clock, texp);\n\treturn hrtimer_nanosleep(texp, flags & TIMER_ABSTIME ?\n\t\t\t\t HRTIMER_MODE_ABS : HRTIMER_MODE_REL,\n\t\t\t\t which_clock);\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE4(clock_nanosleep, const clockid_t, which_clock, int, flags,\n\t\tconst struct __kernel_timespec __user *, rqtp,\n\t\tstruct __kernel_timespec __user *, rmtp)\n{\n\tstruct timespec64 t;\n\tktime_t texp;\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (get_timespec64(&t, rqtp))\n\t\treturn -EFAULT;\n\tif (!timespec64_valid(&t))\n\t\treturn -EINVAL;\n\tif (flags & TIMER_ABSTIME)\n\t\trmtp = NULL;\n\tcurrent->restart_block.nanosleep.type = rmtp ? TT_NATIVE : TT_NONE;\n\tcurrent->restart_block.nanosleep.rmtp = rmtp;\n\ttexp = timespec64_to_ktime(t);\n\tif (flags & TIMER_ABSTIME)\n\t\ttexp = timens_ktime_to_host(which_clock, texp);\n\treturn hrtimer_nanosleep(texp, flags & TIMER_ABSTIME ?\n\t\t\t\t HRTIMER_MODE_ABS : HRTIMER_MODE_REL,\n\t\t\t\t which_clock);\n}"
  },
  {
    "function_name": "clock_settime32",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "172-183",
    "snippet": "SYSCALL_DEFINE2(clock_settime32, const clockid_t, which_clock,\n\t\tstruct old_timespec32 __user *, tp)\n{\n\tstruct timespec64 new_tp;\n\n\tif (which_clock != CLOCK_REALTIME)\n\t\treturn -EINVAL;\n\tif (get_old_timespec32(&new_tp, tp))\n\t\treturn -EFAULT;\n\n\treturn do_sys_settimeofday64(&new_tp, NULL);\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE2(clock_settime32, const clockid_t, which_clock,\n\t\tstruct old_timespec32 __user *, tp)\n{\n\tstruct timespec64 new_tp;\n\n\tif (which_clock != CLOCK_REALTIME)\n\t\treturn -EINVAL;\n\tif (get_old_timespec32(&new_tp, tp))\n\t\treturn -EFAULT;\n\n\treturn do_sys_settimeofday64(&new_tp, NULL);\n}"
  },
  {
    "function_name": "clock_gettime32",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "185-198",
    "snippet": "SYSCALL_DEFINE2(clock_gettime32, clockid_t, which_clock,\n\t\tstruct old_timespec32 __user *, tp)\n{\n\tint ret;\n\tstruct timespec64 kernel_tp;\n\n\tret = do_clock_gettime(which_clock, &kernel_tp);\n\tif (ret)\n\t\treturn ret;\n\n\tif (put_old_timespec32(&kernel_tp, tp))\n\t\treturn -EFAULT;\n\treturn 0;\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE2(clock_gettime32, clockid_t, which_clock,\n\t\tstruct old_timespec32 __user *, tp)\n{\n\tint ret;\n\tstruct timespec64 kernel_tp;\n\n\tret = do_clock_gettime(which_clock, &kernel_tp);\n\tif (ret)\n\t\treturn ret;\n\n\tif (put_old_timespec32(&kernel_tp, tp))\n\t\treturn -EFAULT;\n\treturn 0;\n}"
  },
  {
    "function_name": "clock_getres_time32",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "200-218",
    "snippet": "SYSCALL_DEFINE2(clock_getres_time32, clockid_t, which_clock,\n\t\tstruct old_timespec32 __user *, tp)\n{\n\tstruct timespec64 rtn_tp = {\n\t\t.tv_sec = 0,\n\t\t.tv_nsec = hrtimer_resolution,\n\t};\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tif (put_old_timespec32(&rtn_tp, tp))\n\t\t\treturn -EFAULT;\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE2(clock_getres_time32, clockid_t, which_clock,\n\t\tstruct old_timespec32 __user *, tp)\n{\n\tstruct timespec64 rtn_tp = {\n\t\t.tv_sec = 0,\n\t\t.tv_nsec = hrtimer_resolution,\n\t};\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tif (put_old_timespec32(&rtn_tp, tp))\n\t\t\treturn -EFAULT;\n\t\treturn 0;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}"
  },
  {
    "function_name": "clock_nanosleep_time32",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/posix-stubs.c",
    "lines": "220-250",
    "snippet": "SYSCALL_DEFINE4(clock_nanosleep_time32, clockid_t, which_clock, int, flags,\n\t\tstruct old_timespec32 __user *, rqtp,\n\t\tstruct old_timespec32 __user *, rmtp)\n{\n\tstruct timespec64 t;\n\tktime_t texp;\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (get_old_timespec32(&t, rqtp))\n\t\treturn -EFAULT;\n\tif (!timespec64_valid(&t))\n\t\treturn -EINVAL;\n\tif (flags & TIMER_ABSTIME)\n\t\trmtp = NULL;\n\tcurrent->restart_block.nanosleep.type = rmtp ? TT_COMPAT : TT_NONE;\n\tcurrent->restart_block.nanosleep.compat_rmtp = rmtp;\n\ttexp = timespec64_to_ktime(t);\n\tif (flags & TIMER_ABSTIME)\n\t\ttexp = timens_ktime_to_host(which_clock, texp);\n\treturn hrtimer_nanosleep(texp, flags & TIMER_ABSTIME ?\n\t\t\t\t HRTIMER_MODE_ABS : HRTIMER_MODE_REL,\n\t\t\t\t which_clock);\n}",
    "includes": [
      "#include <asm/syscall_wrapper.h>",
      "#include <linux/compat.h>",
      "#include <linux/time_namespace.h>",
      "#include <linux/posix-timers.h>",
      "#include <linux/timekeeping.h>",
      "#include <linux/ktime.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/errno.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/linkage.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/syscall_wrapper.h>\n#include <linux/compat.h>\n#include <linux/time_namespace.h>\n#include <linux/posix-timers.h>\n#include <linux/timekeeping.h>\n#include <linux/ktime.h>\n#include <linux/syscalls.h>\n#include <linux/errno.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/linkage.h>\n\nSYSCALL_DEFINE4(clock_nanosleep_time32, clockid_t, which_clock, int, flags,\n\t\tstruct old_timespec32 __user *, rqtp,\n\t\tstruct old_timespec32 __user *, rmtp)\n{\n\tstruct timespec64 t;\n\tktime_t texp;\n\n\tswitch (which_clock) {\n\tcase CLOCK_REALTIME:\n\tcase CLOCK_MONOTONIC:\n\tcase CLOCK_BOOTTIME:\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (get_old_timespec32(&t, rqtp))\n\t\treturn -EFAULT;\n\tif (!timespec64_valid(&t))\n\t\treturn -EINVAL;\n\tif (flags & TIMER_ABSTIME)\n\t\trmtp = NULL;\n\tcurrent->restart_block.nanosleep.type = rmtp ? TT_COMPAT : TT_NONE;\n\tcurrent->restart_block.nanosleep.compat_rmtp = rmtp;\n\ttexp = timespec64_to_ktime(t);\n\tif (flags & TIMER_ABSTIME)\n\t\ttexp = timens_ktime_to_host(which_clock, texp);\n\treturn hrtimer_nanosleep(texp, flags & TIMER_ABSTIME ?\n\t\t\t\t HRTIMER_MODE_ABS : HRTIMER_MODE_REL,\n\t\t\t\t which_clock);\n}"
  }
]