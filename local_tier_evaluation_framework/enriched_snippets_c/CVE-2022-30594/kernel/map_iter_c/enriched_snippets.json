[
  {
    "function_name": "bpf_map_iter_init",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "183-193",
    "snippet": "static int __init bpf_map_iter_init(void)\n{\n\tint ret;\n\n\tbpf_map_reg_info.ctx_arg_info[0].btf_id = *btf_bpf_map_id;\n\tret = bpf_iter_reg_target(&bpf_map_reg_info);\n\tif (ret)\n\t\treturn ret;\n\n\treturn bpf_iter_reg_target(&bpf_map_elem_reg_info);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct bpf_iter_reg bpf_map_reg_info = {\n\t.target\t\t\t= \"bpf_map\",\n\t.ctx_arg_info_size\t= 1,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_map, map),\n\t\t  PTR_TO_BTF_ID_OR_NULL },\n\t},\n\t.seq_info\t\t= &bpf_map_seq_info,\n};",
      "static const struct bpf_iter_reg bpf_map_elem_reg_info = {\n\t.target\t\t\t= \"bpf_map_elem\",\n\t.attach_target\t\t= bpf_iter_attach_map,\n\t.detach_target\t\t= bpf_iter_detach_map,\n\t.show_fdinfo\t\t= bpf_iter_map_show_fdinfo,\n\t.fill_link_info\t\t= bpf_iter_map_fill_link_info,\n\t.ctx_arg_info_size\t= 2,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_map_elem, key),\n\t\t  PTR_TO_BUF | PTR_MAYBE_NULL | MEM_RDONLY },\n\t\t{ offsetof(struct bpf_iter__bpf_map_elem, value),\n\t\t  PTR_TO_BUF | PTR_MAYBE_NULL },\n\t},\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_iter_reg_target",
          "args": [
            "&bpf_map_elem_reg_info"
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_iter_reg_target",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/bpf_iter.c",
          "lines": "286-302",
          "snippet": "int bpf_iter_reg_target(const struct bpf_iter_reg *reg_info)\n{\n\tstruct bpf_iter_target_info *tinfo;\n\n\ttinfo = kzalloc(sizeof(*tinfo), GFP_KERNEL);\n\tif (!tinfo)\n\t\treturn -ENOMEM;\n\n\ttinfo->reg_info = reg_info;\n\tINIT_LIST_HEAD(&tinfo->list);\n\n\tmutex_lock(&targets_mutex);\n\tlist_add(&tinfo->list, &targets);\n\tmutex_unlock(&targets_mutex);\n\n\treturn 0;\n}",
          "includes": [
            "#include <linux/bpf.h>",
            "#include <linux/filter.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct list_head targets = LIST_HEAD_INIT(targets);",
            "static DEFINE_MUTEX(targets_mutex);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/anon_inodes.h>\n#include <linux/fs.h>\n\nstatic struct list_head targets = LIST_HEAD_INIT(targets);\nstatic DEFINE_MUTEX(targets_mutex);\n\nint bpf_iter_reg_target(const struct bpf_iter_reg *reg_info)\n{\n\tstruct bpf_iter_target_info *tinfo;\n\n\ttinfo = kzalloc(sizeof(*tinfo), GFP_KERNEL);\n\tif (!tinfo)\n\t\treturn -ENOMEM;\n\n\ttinfo->reg_info = reg_info;\n\tINIT_LIST_HEAD(&tinfo->list);\n\n\tmutex_lock(&targets_mutex);\n\tlist_add(&tinfo->list, &targets);\n\tmutex_unlock(&targets_mutex);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic struct bpf_iter_reg bpf_map_reg_info = {\n\t.target\t\t\t= \"bpf_map\",\n\t.ctx_arg_info_size\t= 1,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_map, map),\n\t\t  PTR_TO_BTF_ID_OR_NULL },\n\t},\n\t.seq_info\t\t= &bpf_map_seq_info,\n};\nstatic const struct bpf_iter_reg bpf_map_elem_reg_info = {\n\t.target\t\t\t= \"bpf_map_elem\",\n\t.attach_target\t\t= bpf_iter_attach_map,\n\t.detach_target\t\t= bpf_iter_detach_map,\n\t.show_fdinfo\t\t= bpf_iter_map_show_fdinfo,\n\t.fill_link_info\t\t= bpf_iter_map_fill_link_info,\n\t.ctx_arg_info_size\t= 2,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_map_elem, key),\n\t\t  PTR_TO_BUF | PTR_MAYBE_NULL | MEM_RDONLY },\n\t\t{ offsetof(struct bpf_iter__bpf_map_elem, value),\n\t\t  PTR_TO_BUF | PTR_MAYBE_NULL },\n\t},\n};\n\nstatic int __init bpf_map_iter_init(void)\n{\n\tint ret;\n\n\tbpf_map_reg_info.ctx_arg_info[0].btf_id = *btf_bpf_map_id;\n\tret = bpf_iter_reg_target(&bpf_map_reg_info);\n\tif (ret)\n\t\treturn ret;\n\n\treturn bpf_iter_reg_target(&bpf_map_elem_reg_info);\n}"
  },
  {
    "function_name": "bpf_iter_map_fill_link_info",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "158-163",
    "snippet": "int bpf_iter_map_fill_link_info(const struct bpf_iter_aux_info *aux,\n\t\t\t\tstruct bpf_link_info *info)\n{\n\tinfo->iter.map.map_id = aux->map->id;\n\treturn 0;\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nint bpf_iter_map_fill_link_info(const struct bpf_iter_aux_info *aux,\n\t\t\t\tstruct bpf_link_info *info)\n{\n\tinfo->iter.map.map_id = aux->map->id;\n\treturn 0;\n}"
  },
  {
    "function_name": "bpf_iter_map_show_fdinfo",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "152-156",
    "snippet": "void bpf_iter_map_show_fdinfo(const struct bpf_iter_aux_info *aux,\n\t\t\t      struct seq_file *seq)\n{\n\tseq_printf(seq, \"map_id:\\t%u\\n\", aux->map->id);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "seq_printf",
          "args": [
            "seq",
            "\"map_id:\\t%u\\n\"",
            "aux->map->id"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "trace_seq_printf",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/trace/trace_seq.c",
          "lines": "81-100",
          "snippet": "void trace_seq_printf(struct trace_seq *s, const char *fmt, ...)\n{\n\tunsigned int save_len = s->seq.len;\n\tva_list ap;\n\n\tif (s->full)\n\t\treturn;\n\n\t__trace_seq_init(s);\n\n\tva_start(ap, fmt);\n\tseq_buf_vprintf(&s->seq, fmt, ap);\n\tva_end(ap);\n\n\t/* If we can't write it all, don't bother writing anything */\n\tif (unlikely(seq_buf_has_overflowed(&s->seq))) {\n\t\ts->seq.len = save_len;\n\t\ts->full = 1;\n\t}\n}",
          "includes": [
            "#include <linux/trace_seq.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/uaccess.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/trace_seq.h>\n#include <linux/seq_file.h>\n#include <linux/uaccess.h>\n\nvoid trace_seq_printf(struct trace_seq *s, const char *fmt, ...)\n{\n\tunsigned int save_len = s->seq.len;\n\tva_list ap;\n\n\tif (s->full)\n\t\treturn;\n\n\t__trace_seq_init(s);\n\n\tva_start(ap, fmt);\n\tseq_buf_vprintf(&s->seq, fmt, ap);\n\tva_end(ap);\n\n\t/* If we can't write it all, don't bother writing anything */\n\tif (unlikely(seq_buf_has_overflowed(&s->seq))) {\n\t\ts->seq.len = save_len;\n\t\ts->full = 1;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nvoid bpf_iter_map_show_fdinfo(const struct bpf_iter_aux_info *aux,\n\t\t\t      struct seq_file *seq)\n{\n\tseq_printf(seq, \"map_id:\\t%u\\n\", aux->map->id);\n}"
  },
  {
    "function_name": "bpf_iter_detach_map",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "147-150",
    "snippet": "static void bpf_iter_detach_map(struct bpf_iter_aux_info *aux)\n{\n\tbpf_map_put_with_uref(aux->map);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_map_put_with_uref",
          "args": [
            "aux->map"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_put_with_uref",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "514-518",
          "snippet": "void bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nvoid bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void bpf_iter_detach_map(struct bpf_iter_aux_info *aux)\n{\n\tbpf_map_put_with_uref(aux->map);\n}"
  },
  {
    "function_name": "bpf_iter_attach_map",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "101-145",
    "snippet": "static int bpf_iter_attach_map(struct bpf_prog *prog,\n\t\t\t       union bpf_iter_link_info *linfo,\n\t\t\t       struct bpf_iter_aux_info *aux)\n{\n\tu32 key_acc_size, value_acc_size, key_size, value_size;\n\tstruct bpf_map *map;\n\tbool is_percpu = false;\n\tint err = -EINVAL;\n\n\tif (!linfo->map.map_fd)\n\t\treturn -EBADF;\n\n\tmap = bpf_map_get_with_uref(linfo->map.map_fd);\n\tif (IS_ERR(map))\n\t\treturn PTR_ERR(map);\n\n\tif (map->map_type == BPF_MAP_TYPE_PERCPU_HASH ||\n\t    map->map_type == BPF_MAP_TYPE_LRU_PERCPU_HASH ||\n\t    map->map_type == BPF_MAP_TYPE_PERCPU_ARRAY)\n\t\tis_percpu = true;\n\telse if (map->map_type != BPF_MAP_TYPE_HASH &&\n\t\t map->map_type != BPF_MAP_TYPE_LRU_HASH &&\n\t\t map->map_type != BPF_MAP_TYPE_ARRAY)\n\t\tgoto put_map;\n\n\tkey_acc_size = prog->aux->max_rdonly_access;\n\tvalue_acc_size = prog->aux->max_rdwr_access;\n\tkey_size = map->key_size;\n\tif (!is_percpu)\n\t\tvalue_size = map->value_size;\n\telse\n\t\tvalue_size = round_up(map->value_size, 8) * num_possible_cpus();\n\n\tif (key_acc_size > key_size || value_acc_size > value_size) {\n\t\terr = -EACCES;\n\t\tgoto put_map;\n\t}\n\n\taux->map = map;\n\treturn 0;\n\nput_map:\n\tbpf_map_put_with_uref(map);\n\treturn err;\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_map_put_with_uref",
          "args": [
            "map"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_put_with_uref",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "514-518",
          "snippet": "void bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nvoid bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}"
        }
      },
      {
        "call_info": {
          "callee": "num_possible_cpus",
          "args": [],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "round_up",
          "args": [
            "map->value_size",
            "8"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "map"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "map"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bpf_map_get_with_uref",
          "args": [
            "linfo->map.map_fd"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_get_with_uref",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "990-1003",
          "snippet": "struct bpf_map *bpf_map_get_with_uref(u32 ufd)\n{\n\tstruct fd f = fdget(ufd);\n\tstruct bpf_map *map;\n\n\tmap = __bpf_map_get(f);\n\tif (IS_ERR(map))\n\t\treturn map;\n\n\tbpf_map_inc_with_uref(map);\n\tfdput(f);\n\n\treturn map;\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nstruct bpf_map *bpf_map_get_with_uref(u32 ufd)\n{\n\tstruct fd f = fdget(ufd);\n\tstruct bpf_map *map;\n\n\tmap = __bpf_map_get(f);\n\tif (IS_ERR(map))\n\t\treturn map;\n\n\tbpf_map_inc_with_uref(map);\n\tfdput(f);\n\n\treturn map;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int bpf_iter_attach_map(struct bpf_prog *prog,\n\t\t\t       union bpf_iter_link_info *linfo,\n\t\t\t       struct bpf_iter_aux_info *aux)\n{\n\tu32 key_acc_size, value_acc_size, key_size, value_size;\n\tstruct bpf_map *map;\n\tbool is_percpu = false;\n\tint err = -EINVAL;\n\n\tif (!linfo->map.map_fd)\n\t\treturn -EBADF;\n\n\tmap = bpf_map_get_with_uref(linfo->map.map_fd);\n\tif (IS_ERR(map))\n\t\treturn PTR_ERR(map);\n\n\tif (map->map_type == BPF_MAP_TYPE_PERCPU_HASH ||\n\t    map->map_type == BPF_MAP_TYPE_LRU_PERCPU_HASH ||\n\t    map->map_type == BPF_MAP_TYPE_PERCPU_ARRAY)\n\t\tis_percpu = true;\n\telse if (map->map_type != BPF_MAP_TYPE_HASH &&\n\t\t map->map_type != BPF_MAP_TYPE_LRU_HASH &&\n\t\t map->map_type != BPF_MAP_TYPE_ARRAY)\n\t\tgoto put_map;\n\n\tkey_acc_size = prog->aux->max_rdonly_access;\n\tvalue_acc_size = prog->aux->max_rdwr_access;\n\tkey_size = map->key_size;\n\tif (!is_percpu)\n\t\tvalue_size = map->value_size;\n\telse\n\t\tvalue_size = round_up(map->value_size, 8) * num_possible_cpus();\n\n\tif (key_acc_size > key_size || value_acc_size > value_size) {\n\t\terr = -EACCES;\n\t\tgoto put_map;\n\t}\n\n\taux->map = map;\n\treturn 0;\n\nput_map:\n\tbpf_map_put_with_uref(map);\n\treturn err;\n}"
  },
  {
    "function_name": "bpf_map_seq_stop",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "66-72",
    "snippet": "static void bpf_map_seq_stop(struct seq_file *seq, void *v)\n{\n\tif (!v)\n\t\t(void)__bpf_map_seq_show(seq, v, true);\n\telse\n\t\tbpf_map_put((struct bpf_map *)v);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_map_put",
          "args": [
            "(struct bpf_map *)v"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_put_with_uref",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "514-518",
          "snippet": "void bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nvoid bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__bpf_map_seq_show",
          "args": [
            "seq",
            "v",
            "true"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "__bpf_map_seq_show",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
          "lines": "44-59",
          "snippet": "static int __bpf_map_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_map ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.map = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}",
          "includes": [
            "#include <linux/btf_ids.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/fs.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int __bpf_map_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_map ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.map = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void bpf_map_seq_stop(struct seq_file *seq, void *v)\n{\n\tif (!v)\n\t\t(void)__bpf_map_seq_show(seq, v, true);\n\telse\n\t\tbpf_map_put((struct bpf_map *)v);\n}"
  },
  {
    "function_name": "bpf_map_seq_show",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "61-64",
    "snippet": "static int bpf_map_seq_show(struct seq_file *seq, void *v)\n{\n\treturn __bpf_map_seq_show(seq, v, false);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__bpf_map_seq_show",
          "args": [
            "seq",
            "v",
            "false"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "__bpf_map_seq_show",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
          "lines": "44-59",
          "snippet": "static int __bpf_map_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_map ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.map = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}",
          "includes": [
            "#include <linux/btf_ids.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/fs.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int __bpf_map_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_map ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.map = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int bpf_map_seq_show(struct seq_file *seq, void *v)\n{\n\treturn __bpf_map_seq_show(seq, v, false);\n}"
  },
  {
    "function_name": "__bpf_map_seq_show",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "44-59",
    "snippet": "static int __bpf_map_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_map ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.map = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_iter_run_prog",
          "args": [
            "prog",
            "&ctx"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_iter_run_prog",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/bpf_iter.c",
          "lines": "683-700",
          "snippet": "int bpf_iter_run_prog(struct bpf_prog *prog, void *ctx)\n{\n\tint ret;\n\n\trcu_read_lock();\n\tmigrate_disable();\n\tret = bpf_prog_run(prog, ctx);\n\tmigrate_enable();\n\trcu_read_unlock();\n\n\t/* bpf program can only return 0 or 1:\n\t *  0 : okay\n\t *  1 : retry the same object\n\t * The bpf_iter_run_prog() return value\n\t * will be seq_ops->show() return value.\n\t */\n\treturn ret == 0 ? 0 : -EAGAIN;\n}",
          "includes": [
            "#include <linux/bpf.h>",
            "#include <linux/filter.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/anon_inodes.h>\n#include <linux/fs.h>\n\nint bpf_iter_run_prog(struct bpf_prog *prog, void *ctx)\n{\n\tint ret;\n\n\trcu_read_lock();\n\tmigrate_disable();\n\tret = bpf_prog_run(prog, ctx);\n\tmigrate_enable();\n\trcu_read_unlock();\n\n\t/* bpf program can only return 0 or 1:\n\t *  0 : okay\n\t *  1 : retry the same object\n\t * The bpf_iter_run_prog() return value\n\t * will be seq_ops->show() return value.\n\t */\n\treturn ret == 0 ? 0 : -EAGAIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bpf_iter_get_info",
          "args": [
            "&meta",
            "in_stop"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_iter_get_info",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/bpf_iter.c",
          "lines": "660-681",
          "snippet": "struct bpf_prog *bpf_iter_get_info(struct bpf_iter_meta *meta, bool in_stop)\n{\n\tstruct bpf_iter_priv_data *iter_priv;\n\tstruct seq_file *seq;\n\tvoid *seq_priv;\n\n\tseq = meta->seq;\n\tif (seq->file->f_op != &bpf_iter_fops)\n\t\treturn NULL;\n\n\tseq_priv = seq->private;\n\titer_priv = container_of(seq_priv, struct bpf_iter_priv_data,\n\t\t\t\t target_private);\n\n\tif (in_stop && iter_priv->done_stop)\n\t\treturn NULL;\n\n\tmeta->session_id = iter_priv->session_id;\n\tmeta->seq_num = iter_priv->seq_num;\n\n\treturn iter_priv->prog;\n}",
          "includes": [
            "#include <linux/bpf.h>",
            "#include <linux/filter.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static atomic64_t session_id;",
            "const struct file_operations bpf_iter_fops = {\n\t.open\t\t= iter_open,\n\t.llseek\t\t= no_llseek,\n\t.read\t\t= bpf_seq_read,\n\t.release\t= iter_release,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/anon_inodes.h>\n#include <linux/fs.h>\n\nstatic atomic64_t session_id;\nconst struct file_operations bpf_iter_fops = {\n\t.open\t\t= iter_open,\n\t.llseek\t\t= no_llseek,\n\t.read\t\t= bpf_seq_read,\n\t.release\t= iter_release,\n};\n\nstruct bpf_prog *bpf_iter_get_info(struct bpf_iter_meta *meta, bool in_stop)\n{\n\tstruct bpf_iter_priv_data *iter_priv;\n\tstruct seq_file *seq;\n\tvoid *seq_priv;\n\n\tseq = meta->seq;\n\tif (seq->file->f_op != &bpf_iter_fops)\n\t\treturn NULL;\n\n\tseq_priv = seq->private;\n\titer_priv = container_of(seq_priv, struct bpf_iter_priv_data,\n\t\t\t\t target_private);\n\n\tif (in_stop && iter_priv->done_stop)\n\t\treturn NULL;\n\n\tmeta->session_id = iter_priv->session_id;\n\tmeta->seq_num = iter_priv->seq_num;\n\n\treturn iter_priv->prog;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int __bpf_map_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_map ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.map = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "bpf_map_seq_next",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "27-35",
    "snippet": "static void *bpf_map_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct bpf_iter_seq_map_info *info = seq->private;\n\n\t++*pos;\n\t++info->map_id;\n\tbpf_map_put((struct bpf_map *)v);\n\treturn bpf_map_get_curr_or_next(&info->map_id);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_map_get_curr_or_next",
          "args": [
            "&info->map_id"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_get_curr_or_next",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "3384-3401",
          "snippet": "struct bpf_map *bpf_map_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_map *map;\n\n\tspin_lock_bh(&map_idr_lock);\nagain:\n\tmap = idr_get_next(&map_idr, id);\n\tif (map) {\n\t\tmap = __bpf_map_inc_not_zero(map, false);\n\t\tif (IS_ERR(map)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&map_idr_lock);\n\n\treturn map;\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_IDR(map_idr);",
            "static DEFINE_SPINLOCK(map_idr_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nstatic DEFINE_IDR(map_idr);\nstatic DEFINE_SPINLOCK(map_idr_lock);\n\nstruct bpf_map *bpf_map_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_map *map;\n\n\tspin_lock_bh(&map_idr_lock);\nagain:\n\tmap = idr_get_next(&map_idr, id);\n\tif (map) {\n\t\tmap = __bpf_map_inc_not_zero(map, false);\n\t\tif (IS_ERR(map)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&map_idr_lock);\n\n\treturn map;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bpf_map_put",
          "args": [
            "(struct bpf_map *)v"
          ],
          "line": 33
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_put_with_uref",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "514-518",
          "snippet": "void bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nvoid bpf_map_put_with_uref(struct bpf_map *map)\n{\n\tbpf_map_put_uref(map);\n\tbpf_map_put(map);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void *bpf_map_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct bpf_iter_seq_map_info *info = seq->private;\n\n\t++*pos;\n\t++info->map_id;\n\tbpf_map_put((struct bpf_map *)v);\n\treturn bpf_map_get_curr_or_next(&info->map_id);\n}"
  },
  {
    "function_name": "bpf_map_seq_start",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/map_iter.c",
    "lines": "13-25",
    "snippet": "static void *bpf_map_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct bpf_iter_seq_map_info *info = seq->private;\n\tstruct bpf_map *map;\n\n\tmap = bpf_map_get_curr_or_next(&info->map_id);\n\tif (!map)\n\t\treturn NULL;\n\n\tif (*pos == 0)\n\t\t++*pos;\n\treturn map;\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_map_get_curr_or_next",
          "args": [
            "&info->map_id"
          ],
          "line": 18
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_map_get_curr_or_next",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "3384-3401",
          "snippet": "struct bpf_map *bpf_map_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_map *map;\n\n\tspin_lock_bh(&map_idr_lock);\nagain:\n\tmap = idr_get_next(&map_idr, id);\n\tif (map) {\n\t\tmap = __bpf_map_inc_not_zero(map, false);\n\t\tif (IS_ERR(map)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&map_idr_lock);\n\n\treturn map;\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_IDR(map_idr);",
            "static DEFINE_SPINLOCK(map_idr_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nstatic DEFINE_IDR(map_idr);\nstatic DEFINE_SPINLOCK(map_idr_lock);\n\nstruct bpf_map *bpf_map_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_map *map;\n\n\tspin_lock_bh(&map_idr_lock);\nagain:\n\tmap = idr_get_next(&map_idr, id);\n\tif (map) {\n\t\tmap = __bpf_map_inc_not_zero(map, false);\n\t\tif (IS_ERR(map)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&map_idr_lock);\n\n\treturn map;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void *bpf_map_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct bpf_iter_seq_map_info *info = seq->private;\n\tstruct bpf_map *map;\n\n\tmap = bpf_map_get_curr_or_next(&info->map_id);\n\tif (!map)\n\t\treturn NULL;\n\n\tif (*pos == 0)\n\t\t++*pos;\n\treturn map;\n}"
  }
]