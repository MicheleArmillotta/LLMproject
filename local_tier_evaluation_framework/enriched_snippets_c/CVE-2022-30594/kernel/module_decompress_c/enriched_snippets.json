[
  {
    "function_name": "module_decompress_sysfs_init",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "260-270",
    "snippet": "static int __init module_decompress_sysfs_init(void)\n{\n\tint error;\n\n\terror = sysfs_create_file(&module_kset->kobj,\n\t\t\t\t  &module_compression_attr.attr);\n\tif (error)\n\t\tpr_warn(\"Failed to create 'compression' attribute\");\n\n\treturn 0;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct kobj_attribute module_compression_attr = __ATTR_RO(compression);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_warn",
          "args": [
            "\"Failed to create 'compression' attribute\""
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysfs_create_file",
          "args": [
            "&module_kset->kobj",
            "&module_compression_attr.attr"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic struct kobj_attribute module_compression_attr = __ATTR_RO(compression);\n\nstatic int __init module_decompress_sysfs_init(void)\n{\n\tint error;\n\n\terror = sysfs_create_file(&module_kset->kobj,\n\t\t\t\t  &module_compression_attr.attr);\n\tif (error)\n\t\tpr_warn(\"Failed to create 'compression' attribute\");\n\n\treturn 0;\n}"
  },
  {
    "function_name": "compression_show",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "253-257",
    "snippet": "static ssize_t compression_show(struct kobject *kobj,\n\t\t\t\tstruct kobj_attribute *attr, char *buf)\n{\n\treturn sysfs_emit(buf, \"%s\\n\", __stringify(MODULE_COMPRESSION));\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [
      "#define MODULE_COMPRESSION\txz",
      "#define MODULE_COMPRESSION\tgzip"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sysfs_emit",
          "args": [
            "buf",
            "\"%s\\n\"",
            "__stringify(MODULE_COMPRESSION)"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__stringify",
          "args": [
            "MODULE_COMPRESSION"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\n#define MODULE_COMPRESSION\txz\n#define MODULE_COMPRESSION\tgzip\n\nstatic ssize_t compression_show(struct kobject *kobj,\n\t\t\t\tstruct kobj_attribute *attr, char *buf)\n{\n\treturn sysfs_emit(buf, \"%s\\n\", __stringify(MODULE_COMPRESSION));\n}"
  },
  {
    "function_name": "module_decompress_cleanup",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "237-251",
    "snippet": "void module_decompress_cleanup(struct load_info *info)\n{\n\tint i;\n\n\tif (info->hdr)\n\t\tvunmap(info->hdr);\n\n\tfor (i = 0; i < info->used_pages; i++)\n\t\t__free_page(info->pages[i]);\n\n\tkvfree(info->pages);\n\n\tinfo->pages = NULL;\n\tinfo->max_pages = info->used_pages = 0;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvfree",
          "args": [
            "info->pages"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__free_page",
          "args": [
            "info->pages[i]"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vunmap",
          "args": [
            "info->hdr"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nvoid module_decompress_cleanup(struct load_info *info)\n{\n\tint i;\n\n\tif (info->hdr)\n\t\tvunmap(info->hdr);\n\n\tfor (i = 0; i < info->used_pages; i++)\n\t\t__free_page(info->pages[i]);\n\n\tkvfree(info->pages);\n\n\tinfo->pages = NULL;\n\tinfo->max_pages = info->used_pages = 0;\n}"
  },
  {
    "function_name": "module_decompress",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "204-235",
    "snippet": "int module_decompress(struct load_info *info, const void *buf, size_t size)\n{\n\tunsigned int n_pages;\n\tssize_t data_size;\n\tint error;\n\n\t/*\n\t * Start with number of pages twice as big as needed for\n\t * compressed data.\n\t */\n\tn_pages = DIV_ROUND_UP(size, PAGE_SIZE) * 2;\n\terror = module_extend_max_pages(info, n_pages);\n\n\tdata_size = MODULE_DECOMPRESS_FN(info, buf, size);\n\tif (data_size < 0) {\n\t\terror = data_size;\n\t\tgoto err;\n\t}\n\n\tinfo->hdr = vmap(info->pages, info->used_pages, VM_MAP, PAGE_KERNEL);\n\tif (!info->hdr) {\n\t\terror = -ENOMEM;\n\t\tgoto err;\n\t}\n\n\tinfo->len = data_size;\n\treturn 0;\n\nerr:\n\tmodule_decompress_cleanup(info);\n\treturn error;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [
      "#define MODULE_DECOMPRESS_FN\tmodule_xz_decompress",
      "#define MODULE_DECOMPRESS_FN\tmodule_gzip_decompress"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "module_decompress_cleanup",
          "args": [
            "info"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "module_decompress_cleanup",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
          "lines": "237-251",
          "snippet": "void module_decompress_cleanup(struct load_info *info)\n{\n\tint i;\n\n\tif (info->hdr)\n\t\tvunmap(info->hdr);\n\n\tfor (i = 0; i < info->used_pages; i++)\n\t\t__free_page(info->pages[i]);\n\n\tkvfree(info->pages);\n\n\tinfo->pages = NULL;\n\tinfo->max_pages = info->used_pages = 0;\n}",
          "includes": [
            "#include <linux/xz.h>",
            "#include <linux/zlib.h>",
            "#include \"module-internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/kobject.h>",
            "#include <linux/highmem.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nvoid module_decompress_cleanup(struct load_info *info)\n{\n\tint i;\n\n\tif (info->hdr)\n\t\tvunmap(info->hdr);\n\n\tfor (i = 0; i < info->used_pages; i++)\n\t\t__free_page(info->pages[i]);\n\n\tkvfree(info->pages);\n\n\tinfo->pages = NULL;\n\tinfo->max_pages = info->used_pages = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "vmap",
          "args": [
            "info->pages",
            "info->used_pages",
            "VM_MAP",
            "PAGE_KERNEL"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MODULE_DECOMPRESS_FN",
          "args": [
            "info",
            "buf",
            "size"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "module_extend_max_pages",
          "args": [
            "info",
            "n_pages"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "module_extend_max_pages",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
          "lines": "17-32",
          "snippet": "static int module_extend_max_pages(struct load_info *info, unsigned int extent)\n{\n\tstruct page **new_pages;\n\n\tnew_pages = kvmalloc_array(info->max_pages + extent,\n\t\t\t\t   sizeof(info->pages), GFP_KERNEL);\n\tif (!new_pages)\n\t\treturn -ENOMEM;\n\n\tmemcpy(new_pages, info->pages, info->max_pages * sizeof(info->pages));\n\tkvfree(info->pages);\n\tinfo->pages = new_pages;\n\tinfo->max_pages += extent;\n\n\treturn 0;\n}",
          "includes": [
            "#include <linux/xz.h>",
            "#include <linux/zlib.h>",
            "#include \"module-internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/kobject.h>",
            "#include <linux/highmem.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic int module_extend_max_pages(struct load_info *info, unsigned int extent)\n{\n\tstruct page **new_pages;\n\n\tnew_pages = kvmalloc_array(info->max_pages + extent,\n\t\t\t\t   sizeof(info->pages), GFP_KERNEL);\n\tif (!new_pages)\n\t\treturn -ENOMEM;\n\n\tmemcpy(new_pages, info->pages, info->max_pages * sizeof(info->pages));\n\tkvfree(info->pages);\n\tinfo->pages = new_pages;\n\tinfo->max_pages += extent;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DIV_ROUND_UP",
          "args": [
            "size",
            "PAGE_SIZE"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\n#define MODULE_DECOMPRESS_FN\tmodule_xz_decompress\n#define MODULE_DECOMPRESS_FN\tmodule_gzip_decompress\n\nint module_decompress(struct load_info *info, const void *buf, size_t size)\n{\n\tunsigned int n_pages;\n\tssize_t data_size;\n\tint error;\n\n\t/*\n\t * Start with number of pages twice as big as needed for\n\t * compressed data.\n\t */\n\tn_pages = DIV_ROUND_UP(size, PAGE_SIZE) * 2;\n\terror = module_extend_max_pages(info, n_pages);\n\n\tdata_size = MODULE_DECOMPRESS_FN(info, buf, size);\n\tif (data_size < 0) {\n\t\terror = data_size;\n\t\tgoto err;\n\t}\n\n\tinfo->hdr = vmap(info->pages, info->used_pages, VM_MAP, PAGE_KERNEL);\n\tif (!info->hdr) {\n\t\terror = -ENOMEM;\n\t\tgoto err;\n\t}\n\n\tinfo->len = data_size;\n\treturn 0;\n\nerr:\n\tmodule_decompress_cleanup(info);\n\treturn error;\n}"
  },
  {
    "function_name": "module_xz_decompress",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "148-199",
    "snippet": "static ssize_t module_xz_decompress(struct load_info *info,\n\t\t\t\t    const void *buf, size_t size)\n{\n\tstatic const u8 signature[] = { 0xfd, '7', 'z', 'X', 'Z', 0 };\n\tstruct xz_dec *xz_dec;\n\tstruct xz_buf xz_buf;\n\tenum xz_ret xz_ret;\n\tsize_t new_size = 0;\n\tssize_t retval;\n\n\tif (size < sizeof(signature) ||\n\t    memcmp(buf, signature, sizeof(signature))) {\n\t\tpr_err(\"not an xz compressed module\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\txz_dec = xz_dec_init(XZ_DYNALLOC, (u32)-1);\n\tif (!xz_dec)\n\t\treturn -ENOMEM;\n\n\txz_buf.in_size = size;\n\txz_buf.in = buf;\n\txz_buf.in_pos = 0;\n\n\tdo {\n\t\tstruct page *page = module_get_next_page(info);\n\t\tif (!page) {\n\t\t\tretval = -ENOMEM;\n\t\t\tgoto out;\n\t\t}\n\n\t\txz_buf.out = kmap(page);\n\t\txz_buf.out_pos = 0;\n\t\txz_buf.out_size = PAGE_SIZE;\n\t\txz_ret = xz_dec_run(xz_dec, &xz_buf);\n\t\tkunmap(page);\n\n\t\tnew_size += xz_buf.out_pos;\n\t} while (xz_buf.out_pos == PAGE_SIZE && xz_ret == XZ_OK);\n\n\tif (xz_ret != XZ_STREAM_END) {\n\t\tpr_err(\"decompression failed with status %d\\n\", xz_ret);\n\t\tretval = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tretval = new_size;\n\n out:\n\txz_dec_end(xz_dec);\n\treturn retval;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xz_dec_end",
          "args": [
            "xz_dec"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"decompression failed with status %d\\n\"",
            "xz_ret"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap",
          "args": [
            "page"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xz_dec_run",
          "args": [
            "xz_dec",
            "&xz_buf"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap",
          "args": [
            "page"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "module_get_next_page",
          "args": [
            "info"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "module_get_next_page",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
          "lines": "34-51",
          "snippet": "static struct page *module_get_next_page(struct load_info *info)\n{\n\tstruct page *page;\n\tint error;\n\n\tif (info->max_pages == info->used_pages) {\n\t\terror = module_extend_max_pages(info, info->used_pages);\n\t\tif (error)\n\t\t\treturn ERR_PTR(error);\n\t}\n\n\tpage = alloc_page(GFP_KERNEL | __GFP_HIGHMEM);\n\tif (!page)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinfo->pages[info->used_pages++] = page;\n\treturn page;\n}",
          "includes": [
            "#include <linux/xz.h>",
            "#include <linux/zlib.h>",
            "#include \"module-internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/kobject.h>",
            "#include <linux/highmem.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic struct page *module_get_next_page(struct load_info *info)\n{\n\tstruct page *page;\n\tint error;\n\n\tif (info->max_pages == info->used_pages) {\n\t\terror = module_extend_max_pages(info, info->used_pages);\n\t\tif (error)\n\t\t\treturn ERR_PTR(error);\n\t}\n\n\tpage = alloc_page(GFP_KERNEL | __GFP_HIGHMEM);\n\tif (!page)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinfo->pages[info->used_pages++] = page;\n\treturn page;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xz_dec_init",
          "args": [
            "XZ_DYNALLOC",
            "(u32)-1"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"not an xz compressed module\\n\""
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "buf",
            "signature",
            "sizeof(signature)"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic ssize_t module_xz_decompress(struct load_info *info,\n\t\t\t\t    const void *buf, size_t size)\n{\n\tstatic const u8 signature[] = { 0xfd, '7', 'z', 'X', 'Z', 0 };\n\tstruct xz_dec *xz_dec;\n\tstruct xz_buf xz_buf;\n\tenum xz_ret xz_ret;\n\tsize_t new_size = 0;\n\tssize_t retval;\n\n\tif (size < sizeof(signature) ||\n\t    memcmp(buf, signature, sizeof(signature))) {\n\t\tpr_err(\"not an xz compressed module\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\txz_dec = xz_dec_init(XZ_DYNALLOC, (u32)-1);\n\tif (!xz_dec)\n\t\treturn -ENOMEM;\n\n\txz_buf.in_size = size;\n\txz_buf.in = buf;\n\txz_buf.in_pos = 0;\n\n\tdo {\n\t\tstruct page *page = module_get_next_page(info);\n\t\tif (!page) {\n\t\t\tretval = -ENOMEM;\n\t\t\tgoto out;\n\t\t}\n\n\t\txz_buf.out = kmap(page);\n\t\txz_buf.out_pos = 0;\n\t\txz_buf.out_size = PAGE_SIZE;\n\t\txz_ret = xz_dec_run(xz_dec, &xz_buf);\n\t\tkunmap(page);\n\n\t\tnew_size += xz_buf.out_pos;\n\t} while (xz_buf.out_pos == PAGE_SIZE && xz_ret == XZ_OK);\n\n\tif (xz_ret != XZ_STREAM_END) {\n\t\tpr_err(\"decompression failed with status %d\\n\", xz_ret);\n\t\tretval = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tretval = new_size;\n\n out:\n\txz_dec_end(xz_dec);\n\treturn retval;\n}"
  },
  {
    "function_name": "module_gzip_decompress",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "85-142",
    "snippet": "static ssize_t module_gzip_decompress(struct load_info *info,\n\t\t\t\t      const void *buf, size_t size)\n{\n\tstruct z_stream_s s = { 0 };\n\tsize_t new_size = 0;\n\tsize_t gzip_hdr_len;\n\tssize_t retval;\n\tint rc;\n\n\tgzip_hdr_len = module_gzip_header_len(buf, size);\n\tif (!gzip_hdr_len) {\n\t\tpr_err(\"not a gzip compressed module\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\ts.next_in = buf + gzip_hdr_len;\n\ts.avail_in = size - gzip_hdr_len;\n\n\ts.workspace = kmalloc(zlib_inflate_workspacesize(), GFP_KERNEL);\n\tif (!s.workspace)\n\t\treturn -ENOMEM;\n\n\trc = zlib_inflateInit2(&s, -MAX_WBITS);\n\tif (rc != Z_OK) {\n\t\tpr_err(\"failed to initialize decompressor: %d\\n\", rc);\n\t\tretval = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tdo {\n\t\tstruct page *page = module_get_next_page(info);\n\t\tif (!page) {\n\t\t\tretval = -ENOMEM;\n\t\t\tgoto out_inflate_end;\n\t\t}\n\n\t\ts.next_out = kmap(page);\n\t\ts.avail_out = PAGE_SIZE;\n\t\trc = zlib_inflate(&s, 0);\n\t\tkunmap(page);\n\n\t\tnew_size += PAGE_SIZE - s.avail_out;\n\t} while (rc == Z_OK);\n\n\tif (rc != Z_STREAM_END) {\n\t\tpr_err(\"decompression failed with status %d\\n\", rc);\n\t\tretval = -EINVAL;\n\t\tgoto out_inflate_end;\n\t}\n\n\tretval = new_size;\n\nout_inflate_end:\n\tzlib_inflateEnd(&s);\nout:\n\tkfree(s.workspace);\n\treturn retval;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "s.workspace"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "maybe_kfree_parameter",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/params.c",
          "lines": "62-75",
          "snippet": "static void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}",
          "includes": [
            "#include <linux/security.h>",
            "#include <linux/ctype.h>",
            "#include <linux/slab.h>",
            "#include <linux/err.h>",
            "#include <linux/device.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(kmalloced_params);",
            "static DEFINE_SPINLOCK(kmalloced_params_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/security.h>\n#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/device.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic LIST_HEAD(kmalloced_params);\nstatic DEFINE_SPINLOCK(kmalloced_params_lock);\n\nstatic void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "zlib_inflateEnd",
          "args": [
            "&s"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"decompression failed with status %d\\n\"",
            "rc"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kunmap",
          "args": [
            "page"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "zlib_inflate",
          "args": [
            "&s",
            "0"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmap",
          "args": [
            "page"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "module_get_next_page",
          "args": [
            "info"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "module_get_next_page",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
          "lines": "34-51",
          "snippet": "static struct page *module_get_next_page(struct load_info *info)\n{\n\tstruct page *page;\n\tint error;\n\n\tif (info->max_pages == info->used_pages) {\n\t\terror = module_extend_max_pages(info, info->used_pages);\n\t\tif (error)\n\t\t\treturn ERR_PTR(error);\n\t}\n\n\tpage = alloc_page(GFP_KERNEL | __GFP_HIGHMEM);\n\tif (!page)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinfo->pages[info->used_pages++] = page;\n\treturn page;\n}",
          "includes": [
            "#include <linux/xz.h>",
            "#include <linux/zlib.h>",
            "#include \"module-internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/kobject.h>",
            "#include <linux/highmem.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic struct page *module_get_next_page(struct load_info *info)\n{\n\tstruct page *page;\n\tint error;\n\n\tif (info->max_pages == info->used_pages) {\n\t\terror = module_extend_max_pages(info, info->used_pages);\n\t\tif (error)\n\t\t\treturn ERR_PTR(error);\n\t}\n\n\tpage = alloc_page(GFP_KERNEL | __GFP_HIGHMEM);\n\tif (!page)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinfo->pages[info->used_pages++] = page;\n\treturn page;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"failed to initialize decompressor: %d\\n\"",
            "rc"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "zlib_inflateInit2",
          "args": [
            "&s",
            "-MAX_WBITS"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmalloc",
          "args": [
            "zlib_inflate_workspacesize()",
            "GFP_KERNEL"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "zlib_inflate_workspacesize",
          "args": [],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"not a gzip compressed module\\n\""
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "module_gzip_header_len",
          "args": [
            "buf",
            "size"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "module_gzip_header_len",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
          "lines": "63-83",
          "snippet": "static size_t module_gzip_header_len(const u8 *buf, size_t size)\n{\n\tconst u8 signature[] = { 0x1f, 0x8b, 0x08 };\n\tsize_t len = 10;\n\n\tif (size < len || memcmp(buf, signature, sizeof(signature)))\n\t\treturn 0;\n\n\tif (buf[3] & 0x08) {\n\t\tdo {\n\t\t\t/*\n\t\t\t * If we can't find the end of the file name we must\n\t\t\t * be dealing with a corrupted file.\n\t\t\t */\n\t\t\tif (len == size)\n\t\t\t\treturn 0;\n\t\t} while (buf[len++] != '\\0');\n\t}\n\n\treturn len;\n}",
          "includes": [
            "#include <linux/xz.h>",
            "#include <linux/zlib.h>",
            "#include \"module-internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/kobject.h>",
            "#include <linux/highmem.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic size_t module_gzip_header_len(const u8 *buf, size_t size)\n{\n\tconst u8 signature[] = { 0x1f, 0x8b, 0x08 };\n\tsize_t len = 10;\n\n\tif (size < len || memcmp(buf, signature, sizeof(signature)))\n\t\treturn 0;\n\n\tif (buf[3] & 0x08) {\n\t\tdo {\n\t\t\t/*\n\t\t\t * If we can't find the end of the file name we must\n\t\t\t * be dealing with a corrupted file.\n\t\t\t */\n\t\t\tif (len == size)\n\t\t\t\treturn 0;\n\t\t} while (buf[len++] != '\\0');\n\t}\n\n\treturn len;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic ssize_t module_gzip_decompress(struct load_info *info,\n\t\t\t\t      const void *buf, size_t size)\n{\n\tstruct z_stream_s s = { 0 };\n\tsize_t new_size = 0;\n\tsize_t gzip_hdr_len;\n\tssize_t retval;\n\tint rc;\n\n\tgzip_hdr_len = module_gzip_header_len(buf, size);\n\tif (!gzip_hdr_len) {\n\t\tpr_err(\"not a gzip compressed module\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\ts.next_in = buf + gzip_hdr_len;\n\ts.avail_in = size - gzip_hdr_len;\n\n\ts.workspace = kmalloc(zlib_inflate_workspacesize(), GFP_KERNEL);\n\tif (!s.workspace)\n\t\treturn -ENOMEM;\n\n\trc = zlib_inflateInit2(&s, -MAX_WBITS);\n\tif (rc != Z_OK) {\n\t\tpr_err(\"failed to initialize decompressor: %d\\n\", rc);\n\t\tretval = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tdo {\n\t\tstruct page *page = module_get_next_page(info);\n\t\tif (!page) {\n\t\t\tretval = -ENOMEM;\n\t\t\tgoto out_inflate_end;\n\t\t}\n\n\t\ts.next_out = kmap(page);\n\t\ts.avail_out = PAGE_SIZE;\n\t\trc = zlib_inflate(&s, 0);\n\t\tkunmap(page);\n\n\t\tnew_size += PAGE_SIZE - s.avail_out;\n\t} while (rc == Z_OK);\n\n\tif (rc != Z_STREAM_END) {\n\t\tpr_err(\"decompression failed with status %d\\n\", rc);\n\t\tretval = -EINVAL;\n\t\tgoto out_inflate_end;\n\t}\n\n\tretval = new_size;\n\nout_inflate_end:\n\tzlib_inflateEnd(&s);\nout:\n\tkfree(s.workspace);\n\treturn retval;\n}"
  },
  {
    "function_name": "module_gzip_header_len",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "63-83",
    "snippet": "static size_t module_gzip_header_len(const u8 *buf, size_t size)\n{\n\tconst u8 signature[] = { 0x1f, 0x8b, 0x08 };\n\tsize_t len = 10;\n\n\tif (size < len || memcmp(buf, signature, sizeof(signature)))\n\t\treturn 0;\n\n\tif (buf[3] & 0x08) {\n\t\tdo {\n\t\t\t/*\n\t\t\t * If we can't find the end of the file name we must\n\t\t\t * be dealing with a corrupted file.\n\t\t\t */\n\t\t\tif (len == size)\n\t\t\t\treturn 0;\n\t\t} while (buf[len++] != '\\0');\n\t}\n\n\treturn len;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "buf",
            "signature",
            "sizeof(signature)"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic size_t module_gzip_header_len(const u8 *buf, size_t size)\n{\n\tconst u8 signature[] = { 0x1f, 0x8b, 0x08 };\n\tsize_t len = 10;\n\n\tif (size < len || memcmp(buf, signature, sizeof(signature)))\n\t\treturn 0;\n\n\tif (buf[3] & 0x08) {\n\t\tdo {\n\t\t\t/*\n\t\t\t * If we can't find the end of the file name we must\n\t\t\t * be dealing with a corrupted file.\n\t\t\t */\n\t\t\tif (len == size)\n\t\t\t\treturn 0;\n\t\t} while (buf[len++] != '\\0');\n\t}\n\n\treturn len;\n}"
  },
  {
    "function_name": "module_get_next_page",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "34-51",
    "snippet": "static struct page *module_get_next_page(struct load_info *info)\n{\n\tstruct page *page;\n\tint error;\n\n\tif (info->max_pages == info->used_pages) {\n\t\terror = module_extend_max_pages(info, info->used_pages);\n\t\tif (error)\n\t\t\treturn ERR_PTR(error);\n\t}\n\n\tpage = alloc_page(GFP_KERNEL | __GFP_HIGHMEM);\n\tif (!page)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinfo->pages[info->used_pages++] = page;\n\treturn page;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-ENOMEM"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alloc_page",
          "args": [
            "GFP_KERNEL | __GFP_HIGHMEM"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "relay_alloc_page_array",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/relay.c",
          "lines": "61-67",
          "snippet": "static struct page **relay_alloc_page_array(unsigned int n_pages)\n{\n\tconst size_t pa_size = n_pages * sizeof(struct page *);\n\tif (pa_size > PAGE_SIZE)\n\t\treturn vzalloc(pa_size);\n\treturn kzalloc(pa_size, GFP_KERNEL);\n}",
          "includes": [
            "#include <linux/splice.h>",
            "#include <linux/cpu.h>",
            "#include <linux/mm.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/relay.h>",
            "#include <linux/string.h>",
            "#include <linux/export.h>",
            "#include <linux/slab.h>",
            "#include <linux/stddef.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/splice.h>\n#include <linux/cpu.h>\n#include <linux/mm.h>\n#include <linux/vmalloc.h>\n#include <linux/relay.h>\n#include <linux/string.h>\n#include <linux/export.h>\n#include <linux/slab.h>\n#include <linux/stddef.h>\n#include <linux/errno.h>\n\nstatic struct page **relay_alloc_page_array(unsigned int n_pages)\n{\n\tconst size_t pa_size = n_pages * sizeof(struct page *);\n\tif (pa_size > PAGE_SIZE)\n\t\treturn vzalloc(pa_size);\n\treturn kzalloc(pa_size, GFP_KERNEL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "error"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "module_extend_max_pages",
          "args": [
            "info",
            "info->used_pages"
          ],
          "line": 40
        },
        "resolved": true,
        "details": {
          "function_name": "module_extend_max_pages",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
          "lines": "17-32",
          "snippet": "static int module_extend_max_pages(struct load_info *info, unsigned int extent)\n{\n\tstruct page **new_pages;\n\n\tnew_pages = kvmalloc_array(info->max_pages + extent,\n\t\t\t\t   sizeof(info->pages), GFP_KERNEL);\n\tif (!new_pages)\n\t\treturn -ENOMEM;\n\n\tmemcpy(new_pages, info->pages, info->max_pages * sizeof(info->pages));\n\tkvfree(info->pages);\n\tinfo->pages = new_pages;\n\tinfo->max_pages += extent;\n\n\treturn 0;\n}",
          "includes": [
            "#include <linux/xz.h>",
            "#include <linux/zlib.h>",
            "#include \"module-internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/sysfs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/kobject.h>",
            "#include <linux/highmem.h>",
            "#include <linux/init.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic int module_extend_max_pages(struct load_info *info, unsigned int extent)\n{\n\tstruct page **new_pages;\n\n\tnew_pages = kvmalloc_array(info->max_pages + extent,\n\t\t\t\t   sizeof(info->pages), GFP_KERNEL);\n\tif (!new_pages)\n\t\treturn -ENOMEM;\n\n\tmemcpy(new_pages, info->pages, info->max_pages * sizeof(info->pages));\n\tkvfree(info->pages);\n\tinfo->pages = new_pages;\n\tinfo->max_pages += extent;\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic struct page *module_get_next_page(struct load_info *info)\n{\n\tstruct page *page;\n\tint error;\n\n\tif (info->max_pages == info->used_pages) {\n\t\terror = module_extend_max_pages(info, info->used_pages);\n\t\tif (error)\n\t\t\treturn ERR_PTR(error);\n\t}\n\n\tpage = alloc_page(GFP_KERNEL | __GFP_HIGHMEM);\n\tif (!page)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinfo->pages[info->used_pages++] = page;\n\treturn page;\n}"
  },
  {
    "function_name": "module_extend_max_pages",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/module_decompress.c",
    "lines": "17-32",
    "snippet": "static int module_extend_max_pages(struct load_info *info, unsigned int extent)\n{\n\tstruct page **new_pages;\n\n\tnew_pages = kvmalloc_array(info->max_pages + extent,\n\t\t\t\t   sizeof(info->pages), GFP_KERNEL);\n\tif (!new_pages)\n\t\treturn -ENOMEM;\n\n\tmemcpy(new_pages, info->pages, info->max_pages * sizeof(info->pages));\n\tkvfree(info->pages);\n\tinfo->pages = new_pages;\n\tinfo->max_pages += extent;\n\n\treturn 0;\n}",
    "includes": [
      "#include <linux/xz.h>",
      "#include <linux/zlib.h>",
      "#include \"module-internal.h\"",
      "#include <linux/vmalloc.h>",
      "#include <linux/sysfs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>",
      "#include <linux/mm.h>",
      "#include <linux/kobject.h>",
      "#include <linux/highmem.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvfree",
          "args": [
            "info->pages"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_pages",
            "info->pages",
            "info->max_pages * sizeof(info->pages)"
          ],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "memcpy_skip",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/events/internal.h",
          "lines": "180-184",
          "snippet": "static inline unsigned long\nmemcpy_skip(void *dst, const void *src, unsigned long n)\n{\n\treturn 0;\n}",
          "includes": [
            "#include <linux/refcount.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/hardirq.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/refcount.h>\n#include <linux/uaccess.h>\n#include <linux/hardirq.h>\n\nstatic inline unsigned long\nmemcpy_skip(void *dst, const void *src, unsigned long n)\n{\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kvmalloc_array",
          "args": [
            "info->max_pages + extent",
            "sizeof(info->pages)",
            "GFP_KERNEL"
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/xz.h>\n#include <linux/zlib.h>\n#include \"module-internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/sysfs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/kobject.h>\n#include <linux/highmem.h>\n#include <linux/init.h>\n\nstatic int module_extend_max_pages(struct load_info *info, unsigned int extent)\n{\n\tstruct page **new_pages;\n\n\tnew_pages = kvmalloc_array(info->max_pages + extent,\n\t\t\t\t   sizeof(info->pages), GFP_KERNEL);\n\tif (!new_pages)\n\t\treturn -ENOMEM;\n\n\tmemcpy(new_pages, info->pages, info->max_pages * sizeof(info->pages));\n\tkvfree(info->pages);\n\tinfo->pages = new_pages;\n\tinfo->max_pages += extent;\n\n\treturn 0;\n}"
  }
]