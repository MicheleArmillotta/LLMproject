[
  {
    "function_name": "dma_common_free_remap",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/remap.c",
    "lines": "60-70",
    "snippet": "void dma_common_free_remap(void *cpu_addr, size_t size)\n{\n\tstruct vm_struct *area = find_vm_area(cpu_addr);\n\n\tif (!area || area->flags != VM_DMA_COHERENT) {\n\t\tWARN(1, \"trying to free invalid coherent area: %p\\n\", cpu_addr);\n\t\treturn;\n\t}\n\n\tvunmap(cpu_addr);\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/dma-map-ops.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vunmap",
          "args": [
            "cpu_addr"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN",
          "args": [
            "1",
            "\"trying to free invalid coherent area: %p\\n\"",
            "cpu_addr"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_vm_area",
          "args": [
            "cpu_addr"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/dma-map-ops.h>\n\nvoid dma_common_free_remap(void *cpu_addr, size_t size)\n{\n\tstruct vm_struct *area = find_vm_area(cpu_addr);\n\n\tif (!area || area->flags != VM_DMA_COHERENT) {\n\t\tWARN(1, \"trying to free invalid coherent area: %p\\n\", cpu_addr);\n\t\treturn;\n\t}\n\n\tvunmap(cpu_addr);\n}"
  },
  {
    "function_name": "dma_common_contiguous_remap",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/remap.c",
    "lines": "38-55",
    "snippet": "void *dma_common_contiguous_remap(struct page *page, size_t size,\n\t\t\tpgprot_t prot, const void *caller)\n{\n\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\tstruct page **pages;\n\tvoid *vaddr;\n\tint i;\n\n\tpages = kmalloc_array(count, sizeof(struct page *), GFP_KERNEL);\n\tif (!pages)\n\t\treturn NULL;\n\tfor (i = 0; i < count; i++)\n\t\tpages[i] = nth_page(page, i);\n\tvaddr = vmap(pages, count, VM_DMA_COHERENT, prot);\n\tkfree(pages);\n\n\treturn vaddr;\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/dma-map-ops.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "pages"
          ],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "maybe_kfree_parameter",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/params.c",
          "lines": "62-75",
          "snippet": "static void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}",
          "includes": [
            "#include <linux/security.h>",
            "#include <linux/ctype.h>",
            "#include <linux/slab.h>",
            "#include <linux/err.h>",
            "#include <linux/device.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(kmalloced_params);",
            "static DEFINE_SPINLOCK(kmalloced_params_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/security.h>\n#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/device.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic LIST_HEAD(kmalloced_params);\nstatic DEFINE_SPINLOCK(kmalloced_params_lock);\n\nstatic void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "vmap",
          "args": [
            "pages",
            "count",
            "VM_DMA_COHERENT",
            "prot"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nth_page",
          "args": [
            "page",
            "i"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmalloc_array",
          "args": [
            "count",
            "sizeof(struct page *)",
            "GFP_KERNEL"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "size"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/dma-map-ops.h>\n\nvoid *dma_common_contiguous_remap(struct page *page, size_t size,\n\t\t\tpgprot_t prot, const void *caller)\n{\n\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\tstruct page **pages;\n\tvoid *vaddr;\n\tint i;\n\n\tpages = kmalloc_array(count, sizeof(struct page *), GFP_KERNEL);\n\tif (!pages)\n\t\treturn NULL;\n\tfor (i = 0; i < count; i++)\n\t\tpages[i] = nth_page(page, i);\n\tvaddr = vmap(pages, count, VM_DMA_COHERENT, prot);\n\tkfree(pages);\n\n\treturn vaddr;\n}"
  },
  {
    "function_name": "dma_common_pages_remap",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/remap.c",
    "lines": "22-32",
    "snippet": "void *dma_common_pages_remap(struct page **pages, size_t size,\n\t\t\t pgprot_t prot, const void *caller)\n{\n\tvoid *vaddr;\n\n\tvaddr = vmap(pages, PAGE_ALIGN(size) >> PAGE_SHIFT,\n\t\t     VM_DMA_COHERENT, prot);\n\tif (vaddr)\n\t\tfind_vm_area(vaddr)->pages = pages;\n\treturn vaddr;\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/dma-map-ops.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "find_vm_area",
          "args": [
            "vaddr"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmap",
          "args": [
            "pages",
            "PAGE_ALIGN(size) >> PAGE_SHIFT",
            "VM_DMA_COHERENT",
            "prot"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "size"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/dma-map-ops.h>\n\nvoid *dma_common_pages_remap(struct page **pages, size_t size,\n\t\t\t pgprot_t prot, const void *caller)\n{\n\tvoid *vaddr;\n\n\tvaddr = vmap(pages, PAGE_ALIGN(size) >> PAGE_SHIFT,\n\t\t     VM_DMA_COHERENT, prot);\n\tif (vaddr)\n\t\tfind_vm_area(vaddr)->pages = pages;\n\treturn vaddr;\n}"
  },
  {
    "function_name": "dma_common_find_pages",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/remap.c",
    "lines": "9-16",
    "snippet": "struct page **dma_common_find_pages(void *cpu_addr)\n{\n\tstruct vm_struct *area = find_vm_area(cpu_addr);\n\n\tif (!area || area->flags != VM_DMA_COHERENT)\n\t\treturn NULL;\n\treturn area->pages;\n}",
    "includes": [
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/dma-map-ops.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "find_vm_area",
          "args": [
            "cpu_addr"
          ],
          "line": 11
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/dma-map-ops.h>\n\nstruct page **dma_common_find_pages(void *cpu_addr)\n{\n\tstruct vm_struct *area = find_vm_area(cpu_addr);\n\n\tif (!area || area->flags != VM_DMA_COHERENT)\n\t\treturn NULL;\n\treturn area->pages;\n}"
  }
]