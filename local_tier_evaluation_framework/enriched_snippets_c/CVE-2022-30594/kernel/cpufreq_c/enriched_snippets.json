[
  {
    "function_name": "cpufreq_this_cpu_can_update",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/sched/cpufreq.c",
    "lines": "72-77",
    "snippet": "bool cpufreq_this_cpu_can_update(struct cpufreq_policy *policy)\n{\n\treturn cpumask_test_cpu(smp_processor_id(), policy->cpus) ||\n\t\t(policy->dvfs_possible_from_any_cpu &&\n\t\t rcu_dereference_sched(*this_cpu_ptr(&cpufreq_update_util_data)));\n}",
    "includes": [
      "#include \"sched.h\"",
      "#include <linux/cpufreq.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_dereference_sched",
          "args": [
            "*this_cpu_ptr(&cpufreq_update_util_data)"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "this_cpu_ptr",
          "args": [
            "&cpufreq_update_util_data"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpumask_test_cpu",
          "args": [
            "smp_processor_id()",
            "policy->cpus"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "smp_processor_id",
          "args": [],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sched.h\"\n#include <linux/cpufreq.h>\n\nbool cpufreq_this_cpu_can_update(struct cpufreq_policy *policy)\n{\n\treturn cpumask_test_cpu(smp_processor_id(), policy->cpus) ||\n\t\t(policy->dvfs_possible_from_any_cpu &&\n\t\t rcu_dereference_sched(*this_cpu_ptr(&cpufreq_update_util_data)));\n}"
  },
  {
    "function_name": "cpufreq_remove_update_util_hook",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/sched/cpufreq.c",
    "lines": "57-60",
    "snippet": "void cpufreq_remove_update_util_hook(int cpu)\n{\n\trcu_assign_pointer(per_cpu(cpufreq_update_util_data, cpu), NULL);\n}",
    "includes": [
      "#include \"sched.h\"",
      "#include <linux/cpufreq.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "per_cpu(cpufreq_update_util_data, cpu)",
            "NULL"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "per_cpu",
          "args": [
            "cpufreq_update_util_data",
            "cpu"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "kthread_set_per_cpu",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/kthread.c",
          "lines": "588-603",
          "snippet": "void kthread_set_per_cpu(struct task_struct *k, int cpu)\n{\n\tstruct kthread *kthread = to_kthread(k);\n\tif (!kthread)\n\t\treturn;\n\n\tWARN_ON_ONCE(!(k->flags & PF_NO_SETAFFINITY));\n\n\tif (cpu < 0) {\n\t\tclear_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n\t\treturn;\n\t}\n\n\tkthread->cpu = cpu;\n\tset_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include <linux/sched/isolation.h>",
            "#include <linux/numa.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/ptrace.h>",
            "#include <linux/freezer.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/export.h>",
            "#include <linux/file.h>",
            "#include <linux/unistd.h>",
            "#include <linux/cpuset.h>",
            "#include <linux/cgroup.h>",
            "#include <linux/err.h>",
            "#include <linux/completion.h>",
            "#include <linux/kthread.h>",
            "#include <linux/sched/task.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/sched.h>",
            "#include <linux/mmu_context.h>",
            "#include <linux/mm.h>",
            "#include <uapi/linux/sched/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include <linux/sched/isolation.h>\n#include <linux/numa.h>\n#include <linux/uaccess.h>\n#include <linux/ptrace.h>\n#include <linux/freezer.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/export.h>\n#include <linux/file.h>\n#include <linux/unistd.h>\n#include <linux/cpuset.h>\n#include <linux/cgroup.h>\n#include <linux/err.h>\n#include <linux/completion.h>\n#include <linux/kthread.h>\n#include <linux/sched/task.h>\n#include <linux/sched/mm.h>\n#include <linux/sched.h>\n#include <linux/mmu_context.h>\n#include <linux/mm.h>\n#include <uapi/linux/sched/types.h>\n\nvoid kthread_set_per_cpu(struct task_struct *k, int cpu)\n{\n\tstruct kthread *kthread = to_kthread(k);\n\tif (!kthread)\n\t\treturn;\n\n\tWARN_ON_ONCE(!(k->flags & PF_NO_SETAFFINITY));\n\n\tif (cpu < 0) {\n\t\tclear_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n\t\treturn;\n\t}\n\n\tkthread->cpu = cpu;\n\tset_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sched.h\"\n#include <linux/cpufreq.h>\n\nvoid cpufreq_remove_update_util_hook(int cpu)\n{\n\trcu_assign_pointer(per_cpu(cpufreq_update_util_data, cpu), NULL);\n}"
  },
  {
    "function_name": "cpufreq_add_update_util_hook",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/sched/cpufreq.c",
    "lines": "32-44",
    "snippet": "void cpufreq_add_update_util_hook(int cpu, struct update_util_data *data,\n\t\t\tvoid (*func)(struct update_util_data *data, u64 time,\n\t\t\t\t     unsigned int flags))\n{\n\tif (WARN_ON(!data || !func))\n\t\treturn;\n\n\tif (WARN_ON(per_cpu(cpufreq_update_util_data, cpu)))\n\t\treturn;\n\n\tdata->func = func;\n\trcu_assign_pointer(per_cpu(cpufreq_update_util_data, cpu), data);\n}",
    "includes": [
      "#include \"sched.h\"",
      "#include <linux/cpufreq.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rcu_assign_pointer",
          "args": [
            "per_cpu(cpufreq_update_util_data, cpu)",
            "data"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "per_cpu",
          "args": [
            "cpufreq_update_util_data",
            "cpu"
          ],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "kthread_set_per_cpu",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/kthread.c",
          "lines": "588-603",
          "snippet": "void kthread_set_per_cpu(struct task_struct *k, int cpu)\n{\n\tstruct kthread *kthread = to_kthread(k);\n\tif (!kthread)\n\t\treturn;\n\n\tWARN_ON_ONCE(!(k->flags & PF_NO_SETAFFINITY));\n\n\tif (cpu < 0) {\n\t\tclear_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n\t\treturn;\n\t}\n\n\tkthread->cpu = cpu;\n\tset_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include <linux/sched/isolation.h>",
            "#include <linux/numa.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/ptrace.h>",
            "#include <linux/freezer.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/export.h>",
            "#include <linux/file.h>",
            "#include <linux/unistd.h>",
            "#include <linux/cpuset.h>",
            "#include <linux/cgroup.h>",
            "#include <linux/err.h>",
            "#include <linux/completion.h>",
            "#include <linux/kthread.h>",
            "#include <linux/sched/task.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/sched.h>",
            "#include <linux/mmu_context.h>",
            "#include <linux/mm.h>",
            "#include <uapi/linux/sched/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include <linux/sched/isolation.h>\n#include <linux/numa.h>\n#include <linux/uaccess.h>\n#include <linux/ptrace.h>\n#include <linux/freezer.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/export.h>\n#include <linux/file.h>\n#include <linux/unistd.h>\n#include <linux/cpuset.h>\n#include <linux/cgroup.h>\n#include <linux/err.h>\n#include <linux/completion.h>\n#include <linux/kthread.h>\n#include <linux/sched/task.h>\n#include <linux/sched/mm.h>\n#include <linux/sched.h>\n#include <linux/mmu_context.h>\n#include <linux/mm.h>\n#include <uapi/linux/sched/types.h>\n\nvoid kthread_set_per_cpu(struct task_struct *k, int cpu)\n{\n\tstruct kthread *kthread = to_kthread(k);\n\tif (!kthread)\n\t\treturn;\n\n\tWARN_ON_ONCE(!(k->flags & PF_NO_SETAFFINITY));\n\n\tif (cpu < 0) {\n\t\tclear_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n\t\treturn;\n\t}\n\n\tkthread->cpu = cpu;\n\tset_bit(KTHREAD_IS_PER_CPU, &kthread->flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "per_cpu(cpufreq_update_util_data, cpu)"
          ],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "!data || !func"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sched.h\"\n#include <linux/cpufreq.h>\n\nvoid cpufreq_add_update_util_hook(int cpu, struct update_util_data *data,\n\t\t\tvoid (*func)(struct update_util_data *data, u64 time,\n\t\t\t\t     unsigned int flags))\n{\n\tif (WARN_ON(!data || !func))\n\t\treturn;\n\n\tif (WARN_ON(per_cpu(cpufreq_update_util_data, cpu)))\n\t\treturn;\n\n\tdata->func = func;\n\trcu_assign_pointer(per_cpu(cpufreq_update_util_data, cpu), data);\n}"
  }
]