[
  {
    "function_name": "dump_bpf_prog",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/preload/iterators/iterators.bpf.c",
    "lines": "94-112",
    "snippet": "int dump_bpf_prog(struct bpf_iter__bpf_prog *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\t__u64 seq_num = ctx->meta->seq_num;\n\tstruct bpf_prog *prog = ctx->prog;\n\tstruct bpf_prog_aux *aux;\n\n\tif (!prog)\n\t\treturn 0;\n\n\taux = prog->aux;\n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"  id name             attached\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%4u %-16s %s %s\\n\", aux->id,\n\t\t       get_name(aux->btf, aux->func_info[0].type_id, aux->name),\n\t\t       aux->attach_func_name, aux->dst_prog->aux->name);\n\treturn 0;\n}",
    "includes": [
      "#include <bpf/bpf_core_read.h>",
      "#include <bpf/bpf_helpers.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BPF_SEQ_PRINTF",
          "args": [
            "seq",
            "\"%4u %-16s %s %s\\n\"",
            "aux->id",
            "get_name(aux->btf, aux->func_info[0].type_id, aux->name)",
            "aux->attach_func_name",
            "aux->dst_prog->aux->name"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_name",
          "args": [
            "aux->btf",
            "aux->func_info[0].type_id",
            "aux->name"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "get_name",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/preload/iterators/iterators.bpf.c",
          "lines": "59-74",
          "snippet": "static const char *get_name(struct btf *btf, long btf_id, const char *fallback)\n{\n\tstruct btf_type **types, *t;\n\tunsigned int name_off;\n\tconst char *str;\n\n\tif (!btf)\n\t\treturn fallback;\n\tstr = btf->strings;\n\ttypes = btf->types;\n\tbpf_probe_read_kernel(&t, sizeof(t), types + btf_id);\n\tname_off = BPF_CORE_READ(t, name_off);\n\tif (name_off >= btf->hdr.str_len)\n\t\treturn fallback;\n\treturn str + name_off;\n}",
          "includes": [
            "#include <bpf/bpf_core_read.h>",
            "#include <bpf/bpf_helpers.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <bpf/bpf_core_read.h>\n#include <bpf/bpf_helpers.h>\n#include <linux/bpf.h>\n\nstatic const char *get_name(struct btf *btf, long btf_id, const char *fallback)\n{\n\tstruct btf_type **types, *t;\n\tunsigned int name_off;\n\tconst char *str;\n\n\tif (!btf)\n\t\treturn fallback;\n\tstr = btf->strings;\n\ttypes = btf->types;\n\tbpf_probe_read_kernel(&t, sizeof(t), types + btf_id);\n\tname_off = BPF_CORE_READ(t, name_off);\n\tif (name_off >= btf->hdr.str_len)\n\t\treturn fallback;\n\treturn str + name_off;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BPF_SEQ_PRINTF",
          "args": [
            "seq",
            "\"  id name             attached\\n\""
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <bpf/bpf_core_read.h>\n#include <bpf/bpf_helpers.h>\n#include <linux/bpf.h>\n\nint dump_bpf_prog(struct bpf_iter__bpf_prog *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\t__u64 seq_num = ctx->meta->seq_num;\n\tstruct bpf_prog *prog = ctx->prog;\n\tstruct bpf_prog_aux *aux;\n\n\tif (!prog)\n\t\treturn 0;\n\n\taux = prog->aux;\n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"  id name             attached\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%4u %-16s %s %s\\n\", aux->id,\n\t\t       get_name(aux->btf, aux->func_info[0].type_id, aux->name),\n\t\t       aux->attach_func_name, aux->dst_prog->aux->name);\n\treturn 0;\n}"
  },
  {
    "function_name": "dump_bpf_map",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/preload/iterators/iterators.bpf.c",
    "lines": "77-91",
    "snippet": "int dump_bpf_map(struct bpf_iter__bpf_map *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\t__u64 seq_num = ctx->meta->seq_num;\n\tstruct bpf_map *map = ctx->map;\n\n\tif (!map)\n\t\treturn 0;\n\n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"  id name             max_entries\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%4u %-16s%6d\\n\", map->id, map->name, map->max_entries);\n\treturn 0;\n}",
    "includes": [
      "#include <bpf/bpf_core_read.h>",
      "#include <bpf/bpf_helpers.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BPF_SEQ_PRINTF",
          "args": [
            "seq",
            "\"%4u %-16s%6d\\n\"",
            "map->id",
            "map->name",
            "map->max_entries"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BPF_SEQ_PRINTF",
          "args": [
            "seq",
            "\"  id name             max_entries\\n\""
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <bpf/bpf_core_read.h>\n#include <bpf/bpf_helpers.h>\n#include <linux/bpf.h>\n\nint dump_bpf_map(struct bpf_iter__bpf_map *ctx)\n{\n\tstruct seq_file *seq = ctx->meta->seq;\n\t__u64 seq_num = ctx->meta->seq_num;\n\tstruct bpf_map *map = ctx->map;\n\n\tif (!map)\n\t\treturn 0;\n\n\tif (seq_num == 0)\n\t\tBPF_SEQ_PRINTF(seq, \"  id name             max_entries\\n\");\n\n\tBPF_SEQ_PRINTF(seq, \"%4u %-16s%6d\\n\", map->id, map->name, map->max_entries);\n\treturn 0;\n}"
  },
  {
    "function_name": "get_name",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/preload/iterators/iterators.bpf.c",
    "lines": "59-74",
    "snippet": "static const char *get_name(struct btf *btf, long btf_id, const char *fallback)\n{\n\tstruct btf_type **types, *t;\n\tunsigned int name_off;\n\tconst char *str;\n\n\tif (!btf)\n\t\treturn fallback;\n\tstr = btf->strings;\n\ttypes = btf->types;\n\tbpf_probe_read_kernel(&t, sizeof(t), types + btf_id);\n\tname_off = BPF_CORE_READ(t, name_off);\n\tif (name_off >= btf->hdr.str_len)\n\t\treturn fallback;\n\treturn str + name_off;\n}",
    "includes": [
      "#include <bpf/bpf_core_read.h>",
      "#include <bpf/bpf_helpers.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BPF_CORE_READ",
          "args": [
            "t",
            "name_off"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bpf_probe_read_kernel",
          "args": [
            "&t",
            "sizeof(t)",
            "types + btf_id"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_probe_read_kernel",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/core.c",
          "lines": "1368-1372",
          "snippet": "u64 __weak bpf_probe_read_kernel(void *dst, u32 size, const void *unsafe_ptr)\n{\n\tmemset(dst, 0, size);\n\treturn -EFAULT;\n}",
          "includes": [
            "#include <linux/bpf_trace.h>",
            "#include <asm/unaligned.h>",
            "#include <asm/barrier.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/log2.h>",
            "#include <linux/extable.h>",
            "#include <linux/perf_event.h>",
            "#include <linux/rcupdate.h>",
            "#include <linux/kallsyms.h>",
            "#include <linux/rbtree_latch.h>",
            "#include <linux/objtool.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf.h>",
            "#include <linux/moduleloader.h>",
            "#include <linux/random.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/skbuff.h>",
            "#include <linux/filter.h>",
            "#include <uapi/linux/btf.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "const struct bpf_func_proto bpf_map_lookup_elem_proto __weak;",
            "const struct bpf_func_proto bpf_map_update_elem_proto __weak;",
            "const struct bpf_func_proto bpf_map_delete_elem_proto __weak;",
            "const struct bpf_func_proto bpf_map_push_elem_proto __weak;",
            "const struct bpf_func_proto bpf_map_pop_elem_proto __weak;",
            "const struct bpf_func_proto bpf_map_peek_elem_proto __weak;",
            "const struct bpf_func_proto bpf_spin_lock_proto __weak;",
            "const struct bpf_func_proto bpf_spin_unlock_proto __weak;",
            "const struct bpf_func_proto bpf_jiffies64_proto __weak;",
            "const struct bpf_func_proto bpf_get_prandom_u32_proto __weak;",
            "const struct bpf_func_proto bpf_get_smp_processor_id_proto __weak;",
            "const struct bpf_func_proto bpf_get_numa_node_id_proto __weak;",
            "const struct bpf_func_proto bpf_ktime_get_ns_proto __weak;",
            "const struct bpf_func_proto bpf_ktime_get_boot_ns_proto __weak;",
            "const struct bpf_func_proto bpf_ktime_get_coarse_ns_proto __weak;",
            "const struct bpf_func_proto bpf_get_current_pid_tgid_proto __weak;",
            "const struct bpf_func_proto bpf_get_current_uid_gid_proto __weak;",
            "const struct bpf_func_proto bpf_get_current_comm_proto __weak;",
            "const struct bpf_func_proto bpf_get_current_cgroup_id_proto __weak;",
            "const struct bpf_func_proto bpf_get_current_ancestor_cgroup_id_proto __weak;",
            "const struct bpf_func_proto bpf_get_local_storage_proto __weak;",
            "const struct bpf_func_proto bpf_get_ns_current_pid_tgid_proto __weak;",
            "const struct bpf_func_proto bpf_snprintf_btf_proto __weak;",
            "const struct bpf_func_proto bpf_seq_printf_btf_proto __weak;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf_trace.h>\n#include <asm/unaligned.h>\n#include <asm/barrier.h>\n#include <linux/bpf_verifier.h>\n#include <linux/log2.h>\n#include <linux/extable.h>\n#include <linux/perf_event.h>\n#include <linux/rcupdate.h>\n#include <linux/kallsyms.h>\n#include <linux/rbtree_latch.h>\n#include <linux/objtool.h>\n#include <linux/btf.h>\n#include <linux/bpf.h>\n#include <linux/moduleloader.h>\n#include <linux/random.h>\n#include <linux/vmalloc.h>\n#include <linux/skbuff.h>\n#include <linux/filter.h>\n#include <uapi/linux/btf.h>\n\nconst struct bpf_func_proto bpf_map_lookup_elem_proto __weak;\nconst struct bpf_func_proto bpf_map_update_elem_proto __weak;\nconst struct bpf_func_proto bpf_map_delete_elem_proto __weak;\nconst struct bpf_func_proto bpf_map_push_elem_proto __weak;\nconst struct bpf_func_proto bpf_map_pop_elem_proto __weak;\nconst struct bpf_func_proto bpf_map_peek_elem_proto __weak;\nconst struct bpf_func_proto bpf_spin_lock_proto __weak;\nconst struct bpf_func_proto bpf_spin_unlock_proto __weak;\nconst struct bpf_func_proto bpf_jiffies64_proto __weak;\nconst struct bpf_func_proto bpf_get_prandom_u32_proto __weak;\nconst struct bpf_func_proto bpf_get_smp_processor_id_proto __weak;\nconst struct bpf_func_proto bpf_get_numa_node_id_proto __weak;\nconst struct bpf_func_proto bpf_ktime_get_ns_proto __weak;\nconst struct bpf_func_proto bpf_ktime_get_boot_ns_proto __weak;\nconst struct bpf_func_proto bpf_ktime_get_coarse_ns_proto __weak;\nconst struct bpf_func_proto bpf_get_current_pid_tgid_proto __weak;\nconst struct bpf_func_proto bpf_get_current_uid_gid_proto __weak;\nconst struct bpf_func_proto bpf_get_current_comm_proto __weak;\nconst struct bpf_func_proto bpf_get_current_cgroup_id_proto __weak;\nconst struct bpf_func_proto bpf_get_current_ancestor_cgroup_id_proto __weak;\nconst struct bpf_func_proto bpf_get_local_storage_proto __weak;\nconst struct bpf_func_proto bpf_get_ns_current_pid_tgid_proto __weak;\nconst struct bpf_func_proto bpf_snprintf_btf_proto __weak;\nconst struct bpf_func_proto bpf_seq_printf_btf_proto __weak;\n\nu64 __weak bpf_probe_read_kernel(void *dst, u32 size, const void *unsafe_ptr)\n{\n\tmemset(dst, 0, size);\n\treturn -EFAULT;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <bpf/bpf_core_read.h>\n#include <bpf/bpf_helpers.h>\n#include <linux/bpf.h>\n\nstatic const char *get_name(struct btf *btf, long btf_id, const char *fallback)\n{\n\tstruct btf_type **types, *t;\n\tunsigned int name_off;\n\tconst char *str;\n\n\tif (!btf)\n\t\treturn fallback;\n\tstr = btf->strings;\n\ttypes = btf->types;\n\tbpf_probe_read_kernel(&t, sizeof(t), types + btf_id);\n\tname_off = BPF_CORE_READ(t, name_off);\n\tif (name_off >= btf->hdr.str_len)\n\t\treturn fallback;\n\treturn str + name_off;\n}"
  }
]