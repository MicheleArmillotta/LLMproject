[
  {
    "function_name": "timecounter_cyc2time",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
    "lines": "79-98",
    "snippet": "u64 timecounter_cyc2time(const struct timecounter *tc,\n\t\t\t u64 cycle_tstamp)\n{\n\tu64 delta = (cycle_tstamp - tc->cycle_last) & tc->cc->mask;\n\tu64 nsec = tc->nsec, frac = tc->frac;\n\n\t/*\n\t * Instead of always treating cycle_tstamp as more recent\n\t * than tc->cycle_last, detect when it is too far in the\n\t * future and treat it as old time stamp instead.\n\t */\n\tif (delta > tc->cc->mask / 2) {\n\t\tdelta = (tc->cycle_last - cycle_tstamp) & tc->cc->mask;\n\t\tnsec -= cc_cyc2ns_backwards(tc->cc, delta, tc->mask, frac);\n\t} else {\n\t\tnsec += cyclecounter_cyc2ns(tc->cc, delta, tc->mask, &frac);\n\t}\n\n\treturn nsec;\n}",
    "includes": [
      "#include <linux/timecounter.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cyclecounter_cyc2ns",
          "args": [
            "tc->cc",
            "delta",
            "tc->mask",
            "&frac"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cc_cyc2ns_backwards",
          "args": [
            "tc->cc",
            "delta",
            "tc->mask",
            "frac"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "cc_cyc2ns_backwards",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
          "lines": "69-77",
          "snippet": "static u64 cc_cyc2ns_backwards(const struct cyclecounter *cc,\n\t\t\t       u64 cycles, u64 mask, u64 frac)\n{\n\tu64 ns = (u64) cycles;\n\n\tns = ((ns * cc->mult) - frac) >> cc->shift;\n\n\treturn ns;\n}",
          "includes": [
            "#include <linux/timecounter.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nstatic u64 cc_cyc2ns_backwards(const struct cyclecounter *cc,\n\t\t\t       u64 cycles, u64 mask, u64 frac)\n{\n\tu64 ns = (u64) cycles;\n\n\tns = ((ns * cc->mult) - frac) >> cc->shift;\n\n\treturn ns;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nu64 timecounter_cyc2time(const struct timecounter *tc,\n\t\t\t u64 cycle_tstamp)\n{\n\tu64 delta = (cycle_tstamp - tc->cycle_last) & tc->cc->mask;\n\tu64 nsec = tc->nsec, frac = tc->frac;\n\n\t/*\n\t * Instead of always treating cycle_tstamp as more recent\n\t * than tc->cycle_last, detect when it is too far in the\n\t * future and treat it as old time stamp instead.\n\t */\n\tif (delta > tc->cc->mask / 2) {\n\t\tdelta = (tc->cycle_last - cycle_tstamp) & tc->cc->mask;\n\t\tnsec -= cc_cyc2ns_backwards(tc->cc, delta, tc->mask, frac);\n\t} else {\n\t\tnsec += cyclecounter_cyc2ns(tc->cc, delta, tc->mask, &frac);\n\t}\n\n\treturn nsec;\n}"
  },
  {
    "function_name": "cc_cyc2ns_backwards",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
    "lines": "69-77",
    "snippet": "static u64 cc_cyc2ns_backwards(const struct cyclecounter *cc,\n\t\t\t       u64 cycles, u64 mask, u64 frac)\n{\n\tu64 ns = (u64) cycles;\n\n\tns = ((ns * cc->mult) - frac) >> cc->shift;\n\n\treturn ns;\n}",
    "includes": [
      "#include <linux/timecounter.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nstatic u64 cc_cyc2ns_backwards(const struct cyclecounter *cc,\n\t\t\t       u64 cycles, u64 mask, u64 frac)\n{\n\tu64 ns = (u64) cycles;\n\n\tns = ((ns * cc->mult) - frac) >> cc->shift;\n\n\treturn ns;\n}"
  },
  {
    "function_name": "timecounter_read",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
    "lines": "52-62",
    "snippet": "u64 timecounter_read(struct timecounter *tc)\n{\n\tu64 nsec;\n\n\t/* increment time by nanoseconds since last call */\n\tnsec = timecounter_read_delta(tc);\n\tnsec += tc->nsec;\n\ttc->nsec = nsec;\n\n\treturn nsec;\n}",
    "includes": [
      "#include <linux/timecounter.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "timecounter_read_delta",
          "args": [
            "tc"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "timecounter_read_delta",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
          "lines": "31-50",
          "snippet": "static u64 timecounter_read_delta(struct timecounter *tc)\n{\n\tu64 cycle_now, cycle_delta;\n\tu64 ns_offset;\n\n\t/* read cycle counter: */\n\tcycle_now = tc->cc->read(tc->cc);\n\n\t/* calculate the delta since the last timecounter_read_delta(): */\n\tcycle_delta = (cycle_now - tc->cycle_last) & tc->cc->mask;\n\n\t/* convert to nanoseconds: */\n\tns_offset = cyclecounter_cyc2ns(tc->cc, cycle_delta,\n\t\t\t\t\ttc->mask, &tc->frac);\n\n\t/* update time stamp of timecounter_read_delta() call: */\n\ttc->cycle_last = cycle_now;\n\n\treturn ns_offset;\n}",
          "includes": [
            "#include <linux/timecounter.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nstatic u64 timecounter_read_delta(struct timecounter *tc)\n{\n\tu64 cycle_now, cycle_delta;\n\tu64 ns_offset;\n\n\t/* read cycle counter: */\n\tcycle_now = tc->cc->read(tc->cc);\n\n\t/* calculate the delta since the last timecounter_read_delta(): */\n\tcycle_delta = (cycle_now - tc->cycle_last) & tc->cc->mask;\n\n\t/* convert to nanoseconds: */\n\tns_offset = cyclecounter_cyc2ns(tc->cc, cycle_delta,\n\t\t\t\t\ttc->mask, &tc->frac);\n\n\t/* update time stamp of timecounter_read_delta() call: */\n\ttc->cycle_last = cycle_now;\n\n\treturn ns_offset;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nu64 timecounter_read(struct timecounter *tc)\n{\n\tu64 nsec;\n\n\t/* increment time by nanoseconds since last call */\n\tnsec = timecounter_read_delta(tc);\n\tnsec += tc->nsec;\n\ttc->nsec = nsec;\n\n\treturn nsec;\n}"
  },
  {
    "function_name": "timecounter_read_delta",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
    "lines": "31-50",
    "snippet": "static u64 timecounter_read_delta(struct timecounter *tc)\n{\n\tu64 cycle_now, cycle_delta;\n\tu64 ns_offset;\n\n\t/* read cycle counter: */\n\tcycle_now = tc->cc->read(tc->cc);\n\n\t/* calculate the delta since the last timecounter_read_delta(): */\n\tcycle_delta = (cycle_now - tc->cycle_last) & tc->cc->mask;\n\n\t/* convert to nanoseconds: */\n\tns_offset = cyclecounter_cyc2ns(tc->cc, cycle_delta,\n\t\t\t\t\ttc->mask, &tc->frac);\n\n\t/* update time stamp of timecounter_read_delta() call: */\n\ttc->cycle_last = cycle_now;\n\n\treturn ns_offset;\n}",
    "includes": [
      "#include <linux/timecounter.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cyclecounter_cyc2ns",
          "args": [
            "tc->cc",
            "cycle_delta",
            "tc->mask",
            "&tc->frac"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tc->cc->read",
          "args": [
            "tc->cc"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nstatic u64 timecounter_read_delta(struct timecounter *tc)\n{\n\tu64 cycle_now, cycle_delta;\n\tu64 ns_offset;\n\n\t/* read cycle counter: */\n\tcycle_now = tc->cc->read(tc->cc);\n\n\t/* calculate the delta since the last timecounter_read_delta(): */\n\tcycle_delta = (cycle_now - tc->cycle_last) & tc->cc->mask;\n\n\t/* convert to nanoseconds: */\n\tns_offset = cyclecounter_cyc2ns(tc->cc, cycle_delta,\n\t\t\t\t\ttc->mask, &tc->frac);\n\n\t/* update time stamp of timecounter_read_delta() call: */\n\ttc->cycle_last = cycle_now;\n\n\treturn ns_offset;\n}"
  },
  {
    "function_name": "timecounter_init",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/time/timecounter.c",
    "lines": "8-17",
    "snippet": "void timecounter_init(struct timecounter *tc,\n\t\t      const struct cyclecounter *cc,\n\t\t      u64 start_tstamp)\n{\n\ttc->cc = cc;\n\ttc->cycle_last = cc->read(cc);\n\ttc->nsec = start_tstamp;\n\ttc->mask = (1ULL << cc->shift) - 1;\n\ttc->frac = 0;\n}",
    "includes": [
      "#include <linux/timecounter.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cc->read",
          "args": [
            "cc"
          ],
          "line": 13
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/timecounter.h>\n#include <linux/export.h>\n\nvoid timecounter_init(struct timecounter *tc,\n\t\t      const struct cyclecounter *cc,\n\t\t      u64 start_tstamp)\n{\n\ttc->cc = cc;\n\ttc->cycle_last = cc->read(cc);\n\ttc->nsec = start_tstamp;\n\ttc->mask = (1ULL << cc->shift) - 1;\n\ttc->frac = 0;\n}"
  }
]