[
  {
    "function_name": "dma_init_reserved_memory",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "384-390",
    "snippet": "static int __init dma_init_reserved_memory(void)\n{\n\tif (!dma_reserved_default_memory)\n\t\treturn -ENOMEM;\n\treturn dma_init_global_coherent(dma_reserved_default_memory->base,\n\t\t\t\t\tdma_reserved_default_memory->size);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dma_init_global_coherent",
          "args": [
            "dma_reserved_default_memory->base",
            "dma_reserved_default_memory->size"
          ],
          "line": 388
        },
        "resolved": true,
        "details": {
          "function_name": "dma_init_global_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "303-313",
          "snippet": "int dma_init_global_coherent(phys_addr_t phys_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem;\n\n\tmem = dma_init_coherent_memory(phys_addr, phys_addr, size, true);\n\tif (IS_ERR(mem))\n\t\treturn PTR_ERR(mem);\n\tdma_coherent_default_memory = mem;\n\tpr_info(\"DMA: default coherent area is set\\n\");\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_init_global_coherent(phys_addr_t phys_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem;\n\n\tmem = dma_init_coherent_memory(phys_addr, phys_addr, size, true);\n\tif (IS_ERR(mem))\n\t\treturn PTR_ERR(mem);\n\tdma_coherent_default_memory = mem;\n\tpr_info(\"DMA: default coherent area is set\\n\");\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __init dma_init_reserved_memory(void)\n{\n\tif (!dma_reserved_default_memory)\n\t\treturn -ENOMEM;\n\treturn dma_init_global_coherent(dma_reserved_default_memory->base,\n\t\t\t\t\tdma_reserved_default_memory->size);\n}"
  },
  {
    "function_name": "rmem_dma_setup",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "355-381",
    "snippet": "static int __init rmem_dma_setup(struct reserved_mem *rmem)\n{\n\tunsigned long node = rmem->fdt_node;\n\n\tif (of_get_flat_dt_prop(node, \"reusable\", NULL))\n\t\treturn -EINVAL;\n\n#ifdef CONFIG_ARM\n\tif (!of_get_flat_dt_prop(node, \"no-map\", NULL)) {\n\t\tpr_err(\"Reserved memory: regions without no-map are not yet supported\\n\");\n\t\treturn -EINVAL;\n\t}\n#endif\n\n#ifdef CONFIG_DMA_GLOBAL_POOL\n\tif (of_get_flat_dt_prop(node, \"linux,dma-default\", NULL)) {\n\t\tWARN(dma_reserved_default_memory,\n\t\t     \"Reserved memory: region for default DMA coherent area is redefined\\n\");\n\t\tdma_reserved_default_memory = rmem;\n\t}\n#endif\n\n\trmem->ops = &rmem_dma_ops;\n\tpr_info(\"Reserved memory: created DMA memory pool at %pa, size %ld MiB\\n\",\n\t\t&rmem->base, (unsigned long)rmem->size / SZ_1M);\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_info",
          "args": [
            "\"Reserved memory: created DMA memory pool at %pa, size %ld MiB\\n\"",
            "&rmem->base",
            "(unsigned long)rmem->size / SZ_1M"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN",
          "args": [
            "dma_reserved_default_memory",
            "\"Reserved memory: region for default DMA coherent area is redefined\\n\""
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "of_get_flat_dt_prop",
          "args": [
            "node",
            "\"linux,dma-default\"",
            "NULL"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"Reserved memory: regions without no-map are not yet supported\\n\""
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "of_get_flat_dt_prop",
          "args": [
            "node",
            "\"no-map\"",
            "NULL"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "of_get_flat_dt_prop",
          "args": [
            "node",
            "\"reusable\"",
            "NULL"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __init rmem_dma_setup(struct reserved_mem *rmem)\n{\n\tunsigned long node = rmem->fdt_node;\n\n\tif (of_get_flat_dt_prop(node, \"reusable\", NULL))\n\t\treturn -EINVAL;\n\n#ifdef CONFIG_ARM\n\tif (!of_get_flat_dt_prop(node, \"no-map\", NULL)) {\n\t\tpr_err(\"Reserved memory: regions without no-map are not yet supported\\n\");\n\t\treturn -EINVAL;\n\t}\n#endif\n\n#ifdef CONFIG_DMA_GLOBAL_POOL\n\tif (of_get_flat_dt_prop(node, \"linux,dma-default\", NULL)) {\n\t\tWARN(dma_reserved_default_memory,\n\t\t     \"Reserved memory: region for default DMA coherent area is redefined\\n\");\n\t\tdma_reserved_default_memory = rmem;\n\t}\n#endif\n\n\trmem->ops = &rmem_dma_ops;\n\tpr_info(\"Reserved memory: created DMA memory pool at %pa, size %ld MiB\\n\",\n\t\t&rmem->base, (unsigned long)rmem->size / SZ_1M);\n\treturn 0;\n}"
  },
  {
    "function_name": "rmem_dma_device_release",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "343-348",
    "snippet": "static void rmem_dma_device_release(struct reserved_mem *rmem,\n\t\t\t\t    struct device *dev)\n{\n\tif (dev)\n\t\tdev->dma_mem = NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void rmem_dma_device_release(struct reserved_mem *rmem,\n\t\t\t\t    struct device *dev)\n{\n\tif (dev)\n\t\tdev->dma_mem = NULL;\n}"
  },
  {
    "function_name": "rmem_dma_device_init",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "328-341",
    "snippet": "static int rmem_dma_device_init(struct reserved_mem *rmem, struct device *dev)\n{\n\tif (!rmem->priv) {\n\t\tstruct dma_coherent_mem *mem;\n\n\t\tmem = dma_init_coherent_memory(rmem->base, rmem->base,\n\t\t\t\t\t       rmem->size, true);\n\t\tif (IS_ERR(mem))\n\t\t\treturn PTR_ERR(mem);\n\t\trmem->priv = mem;\n\t}\n\tdma_assign_coherent_memory(dev, rmem->priv);\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dma_assign_coherent_memory",
          "args": [
            "dev",
            "rmem->priv"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "dma_assign_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "87-98",
          "snippet": "static int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "mem"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "mem"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_init_coherent_memory",
          "args": [
            "rmem->base",
            "rmem->base",
            "rmem->size",
            "true"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "dma_init_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "38-75",
          "snippet": "static struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int rmem_dma_device_init(struct reserved_mem *rmem, struct device *dev)\n{\n\tif (!rmem->priv) {\n\t\tstruct dma_coherent_mem *mem;\n\n\t\tmem = dma_init_coherent_memory(rmem->base, rmem->base,\n\t\t\t\t\t       rmem->size, true);\n\t\tif (IS_ERR(mem))\n\t\t\treturn PTR_ERR(mem);\n\t\trmem->priv = mem;\n\t}\n\tdma_assign_coherent_memory(dev, rmem->priv);\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_init_global_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "303-313",
    "snippet": "int dma_init_global_coherent(phys_addr_t phys_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem;\n\n\tmem = dma_init_coherent_memory(phys_addr, phys_addr, size, true);\n\tif (IS_ERR(mem))\n\t\treturn PTR_ERR(mem);\n\tdma_coherent_default_memory = mem;\n\tpr_info(\"DMA: default coherent area is set\\n\");\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_info",
          "args": [
            "\"DMA: default coherent area is set\\n\""
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "mem"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "mem"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_init_coherent_memory",
          "args": [
            "phys_addr",
            "phys_addr",
            "size",
            "true"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "dma_init_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "38-75",
          "snippet": "static struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_init_global_coherent(phys_addr_t phys_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem;\n\n\tmem = dma_init_coherent_memory(phys_addr, phys_addr, size, true);\n\tif (IS_ERR(mem))\n\t\treturn PTR_ERR(mem);\n\tdma_coherent_default_memory = mem;\n\tpr_info(\"DMA: default coherent area is set\\n\");\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_mmap_from_global_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "293-301",
    "snippet": "int dma_mmap_from_global_coherent(struct vm_area_struct *vma, void *vaddr,\n\t\t\t\t   size_t size, int *ret)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_mmap_from_coherent(dma_coherent_default_memory, vma,\n\t\t\t\t\tvaddr, size, ret);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_mmap_from_coherent",
          "args": [
            "dma_coherent_default_memory",
            "vma",
            "vaddr",
            "size",
            "ret"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_mmap_from_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "226-246",
          "snippet": "static int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_mmap_from_global_coherent(struct vm_area_struct *vma, void *vaddr,\n\t\t\t\t   size_t size, int *ret)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_mmap_from_coherent(dma_coherent_default_memory, vma,\n\t\t\t\t\tvaddr, size, ret);\n}"
  },
  {
    "function_name": "dma_release_from_global_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "284-291",
    "snippet": "int dma_release_from_global_coherent(int order, void *vaddr)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_release_from_coherent(dma_coherent_default_memory, order,\n\t\t\tvaddr);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_release_from_coherent",
          "args": [
            "dma_coherent_default_memory",
            "order",
            "vaddr"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_release_from_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "191-205",
          "snippet": "static int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_release_from_global_coherent(int order, void *vaddr)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_release_from_coherent(dma_coherent_default_memory, order,\n\t\t\tvaddr);\n}"
  },
  {
    "function_name": "dma_alloc_from_global_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "274-282",
    "snippet": "void *dma_alloc_from_global_coherent(struct device *dev, ssize_t size,\n\t\t\t\t     dma_addr_t *dma_handle)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn NULL;\n\n\treturn __dma_alloc_from_coherent(dev, dma_coherent_default_memory, size,\n\t\t\t\t\t dma_handle);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_alloc_from_coherent",
          "args": [
            "dev",
            "dma_coherent_default_memory",
            "size",
            "dma_handle"
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_alloc_from_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "133-163",
          "snippet": "static void *__dma_alloc_from_coherent(struct device *dev,\n\t\t\t\t       struct dma_coherent_mem *mem,\n\t\t\t\t       ssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > ((dma_addr_t)mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = dma_get_device_base(dev, mem) +\n\t\t\t((dma_addr_t)pageno << PAGE_SHIFT);\n\tret = mem->virt_base + ((dma_addr_t)pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void *__dma_alloc_from_coherent(struct device *dev,\n\t\t\t\t       struct dma_coherent_mem *mem,\n\t\t\t\t       ssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > ((dma_addr_t)mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = dma_get_device_base(dev, mem) +\n\t\t\t((dma_addr_t)pageno << PAGE_SHIFT);\n\tret = mem->virt_base + ((dma_addr_t)pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nvoid *dma_alloc_from_global_coherent(struct device *dev, ssize_t size,\n\t\t\t\t     dma_addr_t *dma_handle)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn NULL;\n\n\treturn __dma_alloc_from_coherent(dev, dma_coherent_default_memory, size,\n\t\t\t\t\t dma_handle);\n}"
  },
  {
    "function_name": "dma_mmap_from_dev_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "263-269",
    "snippet": "int dma_mmap_from_dev_coherent(struct device *dev, struct vm_area_struct *vma,\n\t\t\t   void *vaddr, size_t size, int *ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_mmap_from_coherent(mem, vma, vaddr, size, ret);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_mmap_from_coherent",
          "args": [
            "mem",
            "vma",
            "vaddr",
            "size",
            "ret"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_mmap_from_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "226-246",
          "snippet": "static int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dev_get_coherent_memory",
          "args": [
            "dev"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "dev_get_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "23-28",
          "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_mmap_from_dev_coherent(struct device *dev, struct vm_area_struct *vma,\n\t\t\t   void *vaddr, size_t size, int *ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_mmap_from_coherent(mem, vma, vaddr, size, ret);\n}"
  },
  {
    "function_name": "__dma_mmap_from_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "226-246",
    "snippet": "static int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "remap_pfn_range",
          "args": [
            "vma",
            "vma->vm_start",
            "pfn",
            "user_count << PAGE_SHIFT",
            "vma->vm_page_prot"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "size"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vma_pages",
          "args": [
            "vma"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_release_from_dev_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "219-224",
    "snippet": "int dma_release_from_dev_coherent(struct device *dev, int order, void *vaddr)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_release_from_coherent(mem, order, vaddr);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_release_from_coherent",
          "args": [
            "mem",
            "order",
            "vaddr"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_release_from_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "191-205",
          "snippet": "static int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dev_get_coherent_memory",
          "args": [
            "dev"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "dev_get_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "23-28",
          "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_release_from_dev_coherent(struct device *dev, int order, void *vaddr)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_release_from_coherent(mem, order, vaddr);\n}"
  },
  {
    "function_name": "__dma_release_from_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "191-205",
    "snippet": "static int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock_irqrestore",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_unlock_irqrestore",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/locking/spinlock.c",
          "lines": "192-195",
          "snippet": "void __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nvoid __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bitmap_release_region",
          "args": [
            "mem->bitmap",
            "page",
            "order"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock_irqsave",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_lock_irqsave_nested",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/locking/spinlock.c",
          "lines": "383-393",
          "snippet": "unsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n\treturn flags;\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nunsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n\treturn flags;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + ((dma_addr_t)mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_alloc_from_dev_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "179-189",
    "snippet": "int dma_alloc_from_dev_coherent(struct device *dev, ssize_t size,\n\t\tdma_addr_t *dma_handle, void **ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\tif (!mem)\n\t\treturn 0;\n\n\t*ret = __dma_alloc_from_coherent(dev, mem, size, dma_handle);\n\treturn 1;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_alloc_from_coherent",
          "args": [
            "dev",
            "mem",
            "size",
            "dma_handle"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_alloc_from_coherent",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "133-163",
          "snippet": "static void *__dma_alloc_from_coherent(struct device *dev,\n\t\t\t\t       struct dma_coherent_mem *mem,\n\t\t\t\t       ssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > ((dma_addr_t)mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = dma_get_device_base(dev, mem) +\n\t\t\t((dma_addr_t)pageno << PAGE_SHIFT);\n\tret = mem->virt_base + ((dma_addr_t)pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void *__dma_alloc_from_coherent(struct device *dev,\n\t\t\t\t       struct dma_coherent_mem *mem,\n\t\t\t\t       ssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > ((dma_addr_t)mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = dma_get_device_base(dev, mem) +\n\t\t\t((dma_addr_t)pageno << PAGE_SHIFT);\n\tret = mem->virt_base + ((dma_addr_t)pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dev_get_coherent_memory",
          "args": [
            "dev"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "dev_get_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "23-28",
          "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_alloc_from_dev_coherent(struct device *dev, ssize_t size,\n\t\tdma_addr_t *dma_handle, void **ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\tif (!mem)\n\t\treturn 0;\n\n\t*ret = __dma_alloc_from_coherent(dev, mem, size, dma_handle);\n\treturn 1;\n}"
  },
  {
    "function_name": "__dma_alloc_from_coherent",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "133-163",
    "snippet": "static void *__dma_alloc_from_coherent(struct device *dev,\n\t\t\t\t       struct dma_coherent_mem *mem,\n\t\t\t\t       ssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > ((dma_addr_t)mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = dma_get_device_base(dev, mem) +\n\t\t\t((dma_addr_t)pageno << PAGE_SHIFT);\n\tret = mem->virt_base + ((dma_addr_t)pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock_irqrestore",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_unlock_irqrestore",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/locking/spinlock.c",
          "lines": "192-195",
          "snippet": "void __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nvoid __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ret",
            "0",
            "size"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_get_device_base",
          "args": [
            "dev",
            "mem"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "dma_get_device_base",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "30-36",
          "snippet": "static inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn phys_to_dma(dev, PFN_PHYS(mem->pfn_base));\n\treturn mem->device_base;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn phys_to_dma(dev, PFN_PHYS(mem->pfn_base));\n\treturn mem->device_base;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "pageno < 0"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitmap_find_free_region",
          "args": [
            "mem->bitmap",
            "mem->size",
            "order"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "size > ((dma_addr_t)mem->size << PAGE_SHIFT)"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock_irqsave",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_lock_irqsave_nested",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/locking/spinlock.c",
          "lines": "383-393",
          "snippet": "unsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n\treturn flags;\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nunsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);\n\treturn flags;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_order",
          "args": [
            "size"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void *__dma_alloc_from_coherent(struct device *dev,\n\t\t\t\t       struct dma_coherent_mem *mem,\n\t\t\t\t       ssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > ((dma_addr_t)mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = dma_get_device_base(dev, mem) +\n\t\t\t((dma_addr_t)pageno << PAGE_SHIFT);\n\tret = mem->virt_base + ((dma_addr_t)pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}"
  },
  {
    "function_name": "dma_declare_coherent_memory",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "117-131",
    "snippet": "int dma_declare_coherent_memory(struct device *dev, phys_addr_t phys_addr,\n\t\t\t\tdma_addr_t device_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem;\n\tint ret;\n\n\tmem = dma_init_coherent_memory(phys_addr, device_addr, size, false);\n\tif (IS_ERR(mem))\n\t\treturn PTR_ERR(mem);\n\n\tret = dma_assign_coherent_memory(dev, mem);\n\tif (ret)\n\t\tdma_release_coherent_memory(mem);\n\treturn ret;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dma_release_coherent_memory",
          "args": [
            "mem"
          ],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "dma_release_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "77-85",
          "snippet": "static void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tbitmap_free(mem->bitmap);\n\tkfree(mem);\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tbitmap_free(mem->bitmap);\n\tkfree(mem);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dma_assign_coherent_memory",
          "args": [
            "dev",
            "mem"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "dma_assign_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "87-98",
          "snippet": "static int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "mem"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "mem"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_init_coherent_memory",
          "args": [
            "phys_addr",
            "device_addr",
            "size",
            "false"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "dma_init_coherent_memory",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
          "lines": "38-75",
          "snippet": "static struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/dma-direct.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_declare_coherent_memory(struct device *dev, phys_addr_t phys_addr,\n\t\t\t\tdma_addr_t device_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem;\n\tint ret;\n\n\tmem = dma_init_coherent_memory(phys_addr, device_addr, size, false);\n\tif (IS_ERR(mem))\n\t\treturn PTR_ERR(mem);\n\n\tret = dma_assign_coherent_memory(dev, mem);\n\tif (ret)\n\t\tdma_release_coherent_memory(mem);\n\treturn ret;\n}"
  },
  {
    "function_name": "dma_assign_coherent_memory",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "87-98",
    "snippet": "static int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_release_coherent_memory",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "77-85",
    "snippet": "static void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tbitmap_free(mem->bitmap);\n\tkfree(mem);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "mem"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "maybe_kfree_parameter",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/params.c",
          "lines": "62-75",
          "snippet": "static void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}",
          "includes": [
            "#include <linux/security.h>",
            "#include <linux/ctype.h>",
            "#include <linux/slab.h>",
            "#include <linux/err.h>",
            "#include <linux/device.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(kmalloced_params);",
            "static DEFINE_SPINLOCK(kmalloced_params_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/security.h>\n#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/device.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic LIST_HEAD(kmalloced_params);\nstatic DEFINE_SPINLOCK(kmalloced_params_lock);\n\nstatic void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bitmap_free",
          "args": [
            "mem->bitmap"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memunmap",
          "args": [
            "mem->virt_base"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "memunmap",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/iomem.c",
          "lines": "122-126",
          "snippet": "void memunmap(void *addr)\n{\n\tif (is_ioremap_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}",
          "includes": [
            "#include <linux/mm.h>",
            "#include <linux/io.h>",
            "#include <linux/types.h>",
            "#include <linux/device.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/mm.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\nvoid memunmap(void *addr)\n{\n\tif (is_ioremap_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tbitmap_free(mem->bitmap);\n\tkfree(mem);\n}"
  },
  {
    "function_name": "dma_init_coherent_memory",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "38-75",
    "snippet": "static struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-ENOMEM"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\"",
            "&phys_addr",
            "size / SZ_1M"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memunmap",
          "args": [
            "mem_base"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "memunmap",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/iomem.c",
          "lines": "122-126",
          "snippet": "void memunmap(void *addr)\n{\n\tif (is_ioremap_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}",
          "includes": [
            "#include <linux/mm.h>",
            "#include <linux/io.h>",
            "#include <linux/types.h>",
            "#include <linux/device.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/mm.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\nvoid memunmap(void *addr)\n{\n\tif (is_ioremap_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "dma_mem"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "maybe_kfree_parameter",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/params.c",
          "lines": "62-75",
          "snippet": "static void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}",
          "includes": [
            "#include <linux/security.h>",
            "#include <linux/ctype.h>",
            "#include <linux/slab.h>",
            "#include <linux/err.h>",
            "#include <linux/device.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(kmalloced_params);",
            "static DEFINE_SPINLOCK(kmalloced_params_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/security.h>\n#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/device.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic LIST_HEAD(kmalloced_params);\nstatic DEFINE_SPINLOCK(kmalloced_params_lock);\n\nstatic void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock_init",
          "args": [
            "&dma_mem->spinlock"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PFN_DOWN",
          "args": [
            "phys_addr"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitmap_zalloc",
          "args": [
            "pages",
            "GFP_KERNEL"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "sizeof(struct dma_coherent_mem)",
            "GFP_KERNEL"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EINVAL"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memremap",
          "args": [
            "phys_addr",
            "size",
            "MEMREMAP_WC"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "devm_memremap_match",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/iomem.c",
          "lines": "134-137",
          "snippet": "static int devm_memremap_match(struct device *dev, void *res, void *match_data)\n{\n\treturn *(void **)res == match_data;\n}",
          "includes": [
            "#include <linux/mm.h>",
            "#include <linux/io.h>",
            "#include <linux/types.h>",
            "#include <linux/device.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/mm.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\nstatic int devm_memremap_match(struct device *dev, void *res, void *match_data)\n{\n\treturn *(void **)res == match_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EINVAL"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_init_coherent_memory(phys_addr_t phys_addr,\n\t\tdma_addr_t device_addr, size_t size, bool use_dma_pfn_offset)\n{\n\tstruct dma_coherent_mem *dma_mem;\n\tint pages = size >> PAGE_SHIFT;\n\tvoid *mem_base;\n\n\tif (!size)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem)\n\t\tgoto out_unmap_membase;\n\tdma_mem->bitmap = bitmap_zalloc(pages, GFP_KERNEL);\n\tif (!dma_mem->bitmap)\n\t\tgoto out_free_dma_mem;\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->use_dev_dma_pfn_offset = use_dma_pfn_offset;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\treturn dma_mem;\n\nout_free_dma_mem:\n\tkfree(dma_mem);\nout_unmap_membase:\n\tmemunmap(mem_base);\n\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %zd MiB\\n\",\n\t\t&phys_addr, size / SZ_1M);\n\treturn ERR_PTR(-ENOMEM);\n}"
  },
  {
    "function_name": "dma_get_device_base",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "30-36",
    "snippet": "static inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn phys_to_dma(dev, PFN_PHYS(mem->pfn_base));\n\treturn mem->device_base;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "phys_to_dma",
          "args": [
            "dev",
            "PFN_PHYS(mem->pfn_base)"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "phys_to_dma_direct",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/direct.c",
          "lines": "25-31",
          "snippet": "static inline dma_addr_t phys_to_dma_direct(struct device *dev,\n\t\tphys_addr_t phys)\n{\n\tif (force_dma_unencrypted(dev))\n\t\treturn phys_to_dma_unencrypted(dev, phys);\n\treturn phys_to_dma(dev, phys);\n}",
          "includes": [
            "#include \"direct.h\"",
            "#include <linux/slab.h>",
            "#include <linux/set_memory.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/pfn.h>",
            "#include <linux/scatterlist.h>",
            "#include <linux/dma-map-ops.h>",
            "#include <linux/mm.h>",
            "#include <linux/export.h>",
            "#include <linux/memblock.h> /* for max_pfn */"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"direct.h\"\n#include <linux/slab.h>\n#include <linux/set_memory.h>\n#include <linux/vmalloc.h>\n#include <linux/pfn.h>\n#include <linux/scatterlist.h>\n#include <linux/dma-map-ops.h>\n#include <linux/mm.h>\n#include <linux/export.h>\n#include <linux/memblock.h> /* for max_pfn */\n\nstatic inline dma_addr_t phys_to_dma_direct(struct device *dev,\n\t\tphys_addr_t phys)\n{\n\tif (force_dma_unencrypted(dev))\n\t\treturn phys_to_dma_unencrypted(dev, phys);\n\treturn phys_to_dma(dev, phys);\n}"
        }
      },
      {
        "call_info": {
          "callee": "PFN_PHYS",
          "args": [
            "mem->pfn_base"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn phys_to_dma(dev, PFN_PHYS(mem->pfn_base));\n\treturn mem->device_base;\n}"
  },
  {
    "function_name": "dev_get_coherent_memory",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/dma/coherent.c",
    "lines": "23-28",
    "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-map-ops.h>",
      "#include <linux/dma-direct.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-map-ops.h>\n#include <linux/dma-direct.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
  }
]