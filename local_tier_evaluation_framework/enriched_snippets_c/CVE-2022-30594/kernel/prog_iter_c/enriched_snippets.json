[
  {
    "function_name": "bpf_prog_iter_init",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
    "lines": "101-105",
    "snippet": "static int __init bpf_prog_iter_init(void)\n{\n\tbpf_prog_reg_info.ctx_arg_info[0].btf_id = *btf_bpf_prog_id;\n\treturn bpf_iter_reg_target(&bpf_prog_reg_info);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct bpf_iter_reg bpf_prog_reg_info = {\n\t.target\t\t\t= \"bpf_prog\",\n\t.ctx_arg_info_size\t= 1,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_prog, prog),\n\t\t  PTR_TO_BTF_ID_OR_NULL },\n\t},\n\t.seq_info\t\t= &bpf_prog_seq_info,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_iter_reg_target",
          "args": [
            "&bpf_prog_reg_info"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_iter_reg_target",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/bpf_iter.c",
          "lines": "286-302",
          "snippet": "int bpf_iter_reg_target(const struct bpf_iter_reg *reg_info)\n{\n\tstruct bpf_iter_target_info *tinfo;\n\n\ttinfo = kzalloc(sizeof(*tinfo), GFP_KERNEL);\n\tif (!tinfo)\n\t\treturn -ENOMEM;\n\n\ttinfo->reg_info = reg_info;\n\tINIT_LIST_HEAD(&tinfo->list);\n\n\tmutex_lock(&targets_mutex);\n\tlist_add(&tinfo->list, &targets);\n\tmutex_unlock(&targets_mutex);\n\n\treturn 0;\n}",
          "includes": [
            "#include <linux/bpf.h>",
            "#include <linux/filter.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct list_head targets = LIST_HEAD_INIT(targets);",
            "static DEFINE_MUTEX(targets_mutex);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/anon_inodes.h>\n#include <linux/fs.h>\n\nstatic struct list_head targets = LIST_HEAD_INIT(targets);\nstatic DEFINE_MUTEX(targets_mutex);\n\nint bpf_iter_reg_target(const struct bpf_iter_reg *reg_info)\n{\n\tstruct bpf_iter_target_info *tinfo;\n\n\ttinfo = kzalloc(sizeof(*tinfo), GFP_KERNEL);\n\tif (!tinfo)\n\t\treturn -ENOMEM;\n\n\ttinfo->reg_info = reg_info;\n\tINIT_LIST_HEAD(&tinfo->list);\n\n\tmutex_lock(&targets_mutex);\n\tlist_add(&tinfo->list, &targets);\n\tmutex_unlock(&targets_mutex);\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic struct bpf_iter_reg bpf_prog_reg_info = {\n\t.target\t\t\t= \"bpf_prog\",\n\t.ctx_arg_info_size\t= 1,\n\t.ctx_arg_info\t\t= {\n\t\t{ offsetof(struct bpf_iter__bpf_prog, prog),\n\t\t  PTR_TO_BTF_ID_OR_NULL },\n\t},\n\t.seq_info\t\t= &bpf_prog_seq_info,\n};\n\nstatic int __init bpf_prog_iter_init(void)\n{\n\tbpf_prog_reg_info.ctx_arg_info[0].btf_id = *btf_bpf_prog_id;\n\treturn bpf_iter_reg_target(&bpf_prog_reg_info);\n}"
  },
  {
    "function_name": "bpf_prog_seq_stop",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
    "lines": "66-72",
    "snippet": "static void bpf_prog_seq_stop(struct seq_file *seq, void *v)\n{\n\tif (!v)\n\t\t(void)__bpf_prog_seq_show(seq, v, true);\n\telse\n\t\tbpf_prog_put((struct bpf_prog *)v);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_prog_put",
          "args": [
            "(struct bpf_prog *)v"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_prog_put",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "1828-1831",
          "snippet": "void bpf_prog_put(struct bpf_prog *prog)\n{\n\t__bpf_prog_put(prog, true);\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nvoid bpf_prog_put(struct bpf_prog *prog)\n{\n\t__bpf_prog_put(prog, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__bpf_prog_seq_show",
          "args": [
            "seq",
            "v",
            "true"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "__bpf_prog_seq_show",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
          "lines": "44-59",
          "snippet": "static int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}",
          "includes": [
            "#include <linux/btf_ids.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/fs.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void bpf_prog_seq_stop(struct seq_file *seq, void *v)\n{\n\tif (!v)\n\t\t(void)__bpf_prog_seq_show(seq, v, true);\n\telse\n\t\tbpf_prog_put((struct bpf_prog *)v);\n}"
  },
  {
    "function_name": "bpf_prog_seq_show",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
    "lines": "61-64",
    "snippet": "static int bpf_prog_seq_show(struct seq_file *seq, void *v)\n{\n\treturn __bpf_prog_seq_show(seq, v, false);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__bpf_prog_seq_show",
          "args": [
            "seq",
            "v",
            "false"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "__bpf_prog_seq_show",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
          "lines": "44-59",
          "snippet": "static int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}",
          "includes": [
            "#include <linux/btf_ids.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/fs.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int bpf_prog_seq_show(struct seq_file *seq, void *v)\n{\n\treturn __bpf_prog_seq_show(seq, v, false);\n}"
  },
  {
    "function_name": "__bpf_prog_seq_show",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
    "lines": "44-59",
    "snippet": "static int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_iter_run_prog",
          "args": [
            "prog",
            "&ctx"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_iter_run_prog",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/bpf_iter.c",
          "lines": "683-700",
          "snippet": "int bpf_iter_run_prog(struct bpf_prog *prog, void *ctx)\n{\n\tint ret;\n\n\trcu_read_lock();\n\tmigrate_disable();\n\tret = bpf_prog_run(prog, ctx);\n\tmigrate_enable();\n\trcu_read_unlock();\n\n\t/* bpf program can only return 0 or 1:\n\t *  0 : okay\n\t *  1 : retry the same object\n\t * The bpf_iter_run_prog() return value\n\t * will be seq_ops->show() return value.\n\t */\n\treturn ret == 0 ? 0 : -EAGAIN;\n}",
          "includes": [
            "#include <linux/bpf.h>",
            "#include <linux/filter.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/anon_inodes.h>\n#include <linux/fs.h>\n\nint bpf_iter_run_prog(struct bpf_prog *prog, void *ctx)\n{\n\tint ret;\n\n\trcu_read_lock();\n\tmigrate_disable();\n\tret = bpf_prog_run(prog, ctx);\n\tmigrate_enable();\n\trcu_read_unlock();\n\n\t/* bpf program can only return 0 or 1:\n\t *  0 : okay\n\t *  1 : retry the same object\n\t * The bpf_iter_run_prog() return value\n\t * will be seq_ops->show() return value.\n\t */\n\treturn ret == 0 ? 0 : -EAGAIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bpf_iter_get_info",
          "args": [
            "&meta",
            "in_stop"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_iter_get_info",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/bpf_iter.c",
          "lines": "660-681",
          "snippet": "struct bpf_prog *bpf_iter_get_info(struct bpf_iter_meta *meta, bool in_stop)\n{\n\tstruct bpf_iter_priv_data *iter_priv;\n\tstruct seq_file *seq;\n\tvoid *seq_priv;\n\n\tseq = meta->seq;\n\tif (seq->file->f_op != &bpf_iter_fops)\n\t\treturn NULL;\n\n\tseq_priv = seq->private;\n\titer_priv = container_of(seq_priv, struct bpf_iter_priv_data,\n\t\t\t\t target_private);\n\n\tif (in_stop && iter_priv->done_stop)\n\t\treturn NULL;\n\n\tmeta->session_id = iter_priv->session_id;\n\tmeta->seq_num = iter_priv->seq_num;\n\n\treturn iter_priv->prog;\n}",
          "includes": [
            "#include <linux/bpf.h>",
            "#include <linux/filter.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static atomic64_t session_id;",
            "const struct file_operations bpf_iter_fops = {\n\t.open\t\t= iter_open,\n\t.llseek\t\t= no_llseek,\n\t.read\t\t= bpf_seq_read,\n\t.release\t= iter_release,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/bpf.h>\n#include <linux/filter.h>\n#include <linux/anon_inodes.h>\n#include <linux/fs.h>\n\nstatic atomic64_t session_id;\nconst struct file_operations bpf_iter_fops = {\n\t.open\t\t= iter_open,\n\t.llseek\t\t= no_llseek,\n\t.read\t\t= bpf_seq_read,\n\t.release\t= iter_release,\n};\n\nstruct bpf_prog *bpf_iter_get_info(struct bpf_iter_meta *meta, bool in_stop)\n{\n\tstruct bpf_iter_priv_data *iter_priv;\n\tstruct seq_file *seq;\n\tvoid *seq_priv;\n\n\tseq = meta->seq;\n\tif (seq->file->f_op != &bpf_iter_fops)\n\t\treturn NULL;\n\n\tseq_priv = seq->private;\n\titer_priv = container_of(seq_priv, struct bpf_iter_priv_data,\n\t\t\t\t target_private);\n\n\tif (in_stop && iter_priv->done_stop)\n\t\treturn NULL;\n\n\tmeta->session_id = iter_priv->session_id;\n\tmeta->seq_num = iter_priv->seq_num;\n\n\treturn iter_priv->prog;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic int __bpf_prog_seq_show(struct seq_file *seq, void *v, bool in_stop)\n{\n\tstruct bpf_iter__bpf_prog ctx;\n\tstruct bpf_iter_meta meta;\n\tstruct bpf_prog *prog;\n\tint ret = 0;\n\n\tctx.meta = &meta;\n\tctx.prog = v;\n\tmeta.seq = seq;\n\tprog = bpf_iter_get_info(&meta, in_stop);\n\tif (prog)\n\t\tret = bpf_iter_run_prog(prog, &ctx);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "bpf_prog_seq_next",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
    "lines": "27-35",
    "snippet": "static void *bpf_prog_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct bpf_iter_seq_prog_info *info = seq->private;\n\n\t++*pos;\n\t++info->prog_id;\n\tbpf_prog_put((struct bpf_prog *)v);\n\treturn bpf_prog_get_curr_or_next(&info->prog_id);\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_prog_get_curr_or_next",
          "args": [
            "&info->prog_id"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_prog_get_curr_or_next",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "3403-3420",
          "snippet": "struct bpf_prog *bpf_prog_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_prog *prog;\n\n\tspin_lock_bh(&prog_idr_lock);\nagain:\n\tprog = idr_get_next(&prog_idr, id);\n\tif (prog) {\n\t\tprog = bpf_prog_inc_not_zero(prog);\n\t\tif (IS_ERR(prog)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&prog_idr_lock);\n\n\treturn prog;\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_IDR(prog_idr);",
            "static DEFINE_SPINLOCK(prog_idr_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nstatic DEFINE_IDR(prog_idr);\nstatic DEFINE_SPINLOCK(prog_idr_lock);\n\nstruct bpf_prog *bpf_prog_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_prog *prog;\n\n\tspin_lock_bh(&prog_idr_lock);\nagain:\n\tprog = idr_get_next(&prog_idr, id);\n\tif (prog) {\n\t\tprog = bpf_prog_inc_not_zero(prog);\n\t\tif (IS_ERR(prog)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&prog_idr_lock);\n\n\treturn prog;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bpf_prog_put",
          "args": [
            "(struct bpf_prog *)v"
          ],
          "line": 33
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_prog_put",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "1828-1831",
          "snippet": "void bpf_prog_put(struct bpf_prog *prog)\n{\n\t__bpf_prog_put(prog, true);\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nvoid bpf_prog_put(struct bpf_prog *prog)\n{\n\t__bpf_prog_put(prog, true);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void *bpf_prog_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n{\n\tstruct bpf_iter_seq_prog_info *info = seq->private;\n\n\t++*pos;\n\t++info->prog_id;\n\tbpf_prog_put((struct bpf_prog *)v);\n\treturn bpf_prog_get_curr_or_next(&info->prog_id);\n}"
  },
  {
    "function_name": "bpf_prog_seq_start",
    "container": null,
    "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/prog_iter.c",
    "lines": "13-25",
    "snippet": "static void *bpf_prog_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct bpf_iter_seq_prog_info *info = seq->private;\n\tstruct bpf_prog *prog;\n\n\tprog = bpf_prog_get_curr_or_next(&info->prog_id);\n\tif (!prog)\n\t\treturn NULL;\n\n\tif (*pos == 0)\n\t\t++*pos;\n\treturn prog;\n}",
    "includes": [
      "#include <linux/btf_ids.h>",
      "#include <linux/kernel.h>",
      "#include <linux/filter.h>",
      "#include <linux/fs.h>",
      "#include <linux/bpf.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bpf_prog_get_curr_or_next",
          "args": [
            "&info->prog_id"
          ],
          "line": 18
        },
        "resolved": true,
        "details": {
          "function_name": "bpf_prog_get_curr_or_next",
          "container": null,
          "file": "output_repos_c/CVE-2022-30594/repo/kernel/bpf/syscall.c",
          "lines": "3403-3420",
          "snippet": "struct bpf_prog *bpf_prog_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_prog *prog;\n\n\tspin_lock_bh(&prog_idr_lock);\nagain:\n\tprog = idr_get_next(&prog_idr, id);\n\tif (prog) {\n\t\tprog = bpf_prog_inc_not_zero(prog);\n\t\tif (IS_ERR(prog)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&prog_idr_lock);\n\n\treturn prog;\n}",
          "includes": [
            "#include <linux/memcontrol.h>",
            "#include <linux/rcupdate_trace.h>",
            "#include <linux/bpf-netns.h>",
            "#include <linux/poll.h>",
            "#include <linux/bpf_lsm.h>",
            "#include <linux/pgtable.h>",
            "#include <uapi/linux/btf.h>",
            "#include <linux/audit.h>",
            "#include <linux/nospec.h>",
            "#include <linux/ctype.h>",
            "#include <linux/timekeeping.h>",
            "#include <linux/cred.h>",
            "#include <linux/idr.h>",
            "#include <linux/kernel.h>",
            "#include <linux/filter.h>",
            "#include <linux/license.h>",
            "#include <linux/fs.h>",
            "#include <linux/file.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/anon_inodes.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/sched/signal.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/btf.h>",
            "#include <linux/bpf_verifier.h>",
            "#include <linux/bpf_lirc.h>",
            "#include <linux/bpf_trace.h>",
            "#include <linux/bpf-cgroup.h>",
            "#include <linux/bpf.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DEFINE_IDR(prog_idr);",
            "static DEFINE_SPINLOCK(prog_idr_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/memcontrol.h>\n#include <linux/rcupdate_trace.h>\n#include <linux/bpf-netns.h>\n#include <linux/poll.h>\n#include <linux/bpf_lsm.h>\n#include <linux/pgtable.h>\n#include <uapi/linux/btf.h>\n#include <linux/audit.h>\n#include <linux/nospec.h>\n#include <linux/ctype.h>\n#include <linux/timekeeping.h>\n#include <linux/cred.h>\n#include <linux/idr.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/license.h>\n#include <linux/fs.h>\n#include <linux/file.h>\n#include <linux/fdtable.h>\n#include <linux/anon_inodes.h>\n#include <linux/mmzone.h>\n#include <linux/vmalloc.h>\n#include <linux/sched/signal.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/btf.h>\n#include <linux/bpf_verifier.h>\n#include <linux/bpf_lirc.h>\n#include <linux/bpf_trace.h>\n#include <linux/bpf-cgroup.h>\n#include <linux/bpf.h>\n\nstatic DEFINE_IDR(prog_idr);\nstatic DEFINE_SPINLOCK(prog_idr_lock);\n\nstruct bpf_prog *bpf_prog_get_curr_or_next(u32 *id)\n{\n\tstruct bpf_prog *prog;\n\n\tspin_lock_bh(&prog_idr_lock);\nagain:\n\tprog = idr_get_next(&prog_idr, id);\n\tif (prog) {\n\t\tprog = bpf_prog_inc_not_zero(prog);\n\t\tif (IS_ERR(prog)) {\n\t\t\t(*id)++;\n\t\t\tgoto again;\n\t\t}\n\t}\n\tspin_unlock_bh(&prog_idr_lock);\n\n\treturn prog;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/btf_ids.h>\n#include <linux/kernel.h>\n#include <linux/filter.h>\n#include <linux/fs.h>\n#include <linux/bpf.h>\n\nstatic void *bpf_prog_seq_start(struct seq_file *seq, loff_t *pos)\n{\n\tstruct bpf_iter_seq_prog_info *info = seq->private;\n\tstruct bpf_prog *prog;\n\n\tprog = bpf_prog_get_curr_or_next(&info->prog_id);\n\tif (!prog)\n\t\treturn NULL;\n\n\tif (*pos == 0)\n\t\t++*pos;\n\treturn prog;\n}"
  }
]