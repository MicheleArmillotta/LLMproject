[
  {
    "function_name": "wsemul_sun_resetop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "641-664",
    "snippet": "void\nwsemul_sun_resetop(cookie, op)\n\tvoid *cookie;\n\tenum wsemul_resetops op;\n{\n\tstruct wsemul_sun_emuldata *edp = cookie;\n\n\tswitch (op) {\n\tcase WSEMUL_RESET:\n\t\tedp->state = SUN_EMUL_STATE_NORMAL;\n\t\tedp->scrolldist = 1;\n\t\tedp->rendflags = 0;\n\t\tedp->curattr = edp->defattr;\n\t\tbreak;\n\tcase WSEMUL_CLEARSCREEN:\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\t\t   edp->defattr);\n\t\tedp->ccol = edp->crow = 0;\n\t\t(*edp->emulops->cursor)(edp->emulcookie, 1, 0, 0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [
      "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
    ],
    "globals_used": [
      "void\twsemul_sun_resetop",
      "void *cookie;",
      "int ccol, crow;",
      "long defattr;",
      "void *cookie;",
      "int ccol, crow;",
      "long defattr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "1",
            "0",
            "0"
          ],
          "line": 659
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "0",
            "edp->nrows",
            "edp->defattr"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nvoid\twsemul_sun_resetop;\nvoid *cookie;\nint ccol, crow;\nlong defattr;\nvoid *cookie;\nint ccol, crow;\nlong defattr;\n\nvoid\nwsemul_sun_resetop(cookie, op)\n\tvoid *cookie;\n\tenum wsemul_resetops op;\n{\n\tstruct wsemul_sun_emuldata *edp = cookie;\n\n\tswitch (op) {\n\tcase WSEMUL_RESET:\n\t\tedp->state = SUN_EMUL_STATE_NORMAL;\n\t\tedp->scrolldist = 1;\n\t\tedp->rendflags = 0;\n\t\tedp->curattr = edp->defattr;\n\t\tbreak;\n\tcase WSEMUL_CLEARSCREEN:\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\t\t   edp->defattr);\n\t\tedp->ccol = edp->crow = 0;\n\t\t(*edp->emulops->cursor)(edp->emulcookie, 1, 0, 0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "wsemul_sun_detach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "628-639",
    "snippet": "void\nwsemul_sun_detach(cookie, crowp, ccolp)\n\tvoid *cookie;\n\tu_int *crowp, *ccolp;\n{\n\tstruct wsemul_sun_emuldata *edp = cookie;\n\n\t*crowp = edp->crow;\n\t*ccolp = edp->ccol;\n\tif (edp != &wsemul_sun_console_emuldata)\n\t\tfree(edp, M_DEVBUF);\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\twsemul_sun_detach",
      "struct wsemul_sun_emuldata wsemul_sun_console_emuldata;",
      "void *cookie;",
      "int ccol, crow;",
      "void *cookie;",
      "int ccol, crow;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "edp",
            "M_DEVBUF"
          ],
          "line": 638
        },
        "resolved": true,
        "details": {
          "function_name": "wskbd_pickfree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wskbd.c",
          "lines": "1057-1070",
          "snippet": "int\nwskbd_pickfree()\n{\n\tint i;\n\tstruct wskbd_softc *sc;\n\n\tfor (i = 0; i < wskbd_cd.cd_ndevs; i++) {\n\t\tif ((sc = wskbd_cd.cd_devs[i]) == NULL)\n\t\t\tcontinue;\n\t\tif (sc->sc_displaydv == NULL)\n\t\t\treturn (i);\n\t}\n\treturn (-1);\n}",
          "includes": [
            "#include <dev/wscons/wsmuxvar.h>",
            "#include \"wsmux.h\"",
            "#include \"wsdisplay.h\"",
            "#include <dev/wscons/wscons_callbacks.h>",
            "#include <dev/wscons/wseventvar.h>",
            "#include <dev/wscons/wsksymvar.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wskbdvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/errno.h>",
            "#include <sys/signalvar.h>",
            "#include <sys/tty.h>",
            "#include <sys/malloc.h>",
            "#include <sys/timeout.h>",
            "#include <sys/systm.h>",
            "#include <sys/syslog.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/device.h>",
            "#include <sys/conf.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct cfdriver wskbd_cd = {\n\tNULL, \"wskbd\", DV_TTY\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/wsmuxvar.h>\n#include \"wsmux.h\"\n#include \"wsdisplay.h\"\n#include <dev/wscons/wscons_callbacks.h>\n#include <dev/wscons/wseventvar.h>\n#include <dev/wscons/wsksymvar.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wskbdvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/errno.h>\n#include <sys/signalvar.h>\n#include <sys/tty.h>\n#include <sys/malloc.h>\n#include <sys/timeout.h>\n#include <sys/systm.h>\n#include <sys/syslog.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/ioctl.h>\n#include <sys/device.h>\n#include <sys/conf.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\nstruct cfdriver wskbd_cd = {\n\tNULL, \"wskbd\", DV_TTY\n};\n\nint\nwskbd_pickfree()\n{\n\tint i;\n\tstruct wskbd_softc *sc;\n\n\tfor (i = 0; i < wskbd_cd.cd_ndevs; i++) {\n\t\tif ((sc = wskbd_cd.cd_devs[i]) == NULL)\n\t\t\tcontinue;\n\t\tif (sc->sc_displaydv == NULL)\n\t\t\treturn (i);\n\t}\n\treturn (-1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\nvoid\twsemul_sun_detach;\nstruct wsemul_sun_emuldata wsemul_sun_console_emuldata;\nvoid *cookie;\nint ccol, crow;\nvoid *cookie;\nint ccol, crow;\n\nvoid\nwsemul_sun_detach(cookie, crowp, ccolp)\n\tvoid *cookie;\n\tu_int *crowp, *ccolp;\n{\n\tstruct wsemul_sun_emuldata *edp = cookie;\n\n\t*crowp = edp->crow;\n\t*ccolp = edp->ccol;\n\tif (edp != &wsemul_sun_console_emuldata)\n\t\tfree(edp, M_DEVBUF);\n}"
  },
  {
    "function_name": "wsemul_sun_translate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "564-626",
    "snippet": "int\nwsemul_sun_translate(cookie, in, out)\n\tvoid *cookie;\n\tkeysym_t in;\n\tchar **out;\n{\n\tstatic char c;\n\n\tif (KS_GROUP(in) == KS_GROUP_Keypad && (in & 0x80) == 0) {\n\t\tc = in & 0xff; /* turn into ASCII */\n\t\t*out = &c;\n\t\treturn (1);\n\t}\n\n\tif (in >= KS_f1 && in <= KS_f10) {\n\t\t*out = sun_fkeys[in - KS_f1];\n\t\treturn (6);\n\t}\n\tif (in >= KS_F1 && in <= KS_F10) {\n\t\t*out = sun_fkeys[in - KS_F1];\n\t\treturn (6);\n\t}\n\tif (in >= KS_KP_F1 && in <= KS_KP_F4) {\n\t\t*out = sun_fkeys[in - KS_KP_F1];\n\t\treturn (6);\n\t}\n\n\tswitch (in) {\n\t    case KS_Home:\n\t    case KS_KP_Home:\n\t    case KS_KP_Begin:\n\t\t*out = \"\\033[214z\";\n\t\treturn (6);\n\t    case KS_Prior:\n\t    case KS_KP_Prior:\n\t\t*out = \"\\033[216z\";\n\t\treturn (6);\n\t    case KS_Next:\n\t    case KS_KP_Next:\n\t\t*out = \"\\033[222z\";\n\t\treturn (6);\n\t    case KS_Up:\n\t    case KS_KP_Up:\n\t\t*out = \"\\033[A\";\n\t\treturn (3);\n\t    case KS_Down:\n\t    case KS_KP_Down:\n\t\t*out = \"\\033[B\";\n\t\treturn (3);\n\t    case KS_Left:\n\t    case KS_KP_Left:\n\t\t*out = \"\\033[D\";\n\t\treturn (3);\n\t    case KS_Right:\n\t    case KS_KP_Right:\n\t\t*out = \"\\033[C\";\n\t\treturn (3);\n\t    case KS_KP_Delete:\n\t\t*out = \"\\177\";\n\t\treturn (1);\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\twsemul_sun_translate",
      "void *cookie;",
      "void *cookie;",
      "static char *sun_fkeys[] = {\n\t\"\\033[224z\",\t/* F1 */\n\t\"\\033[225z\",\n\t\"\\033[226z\",\n\t\"\\033[227z\",\n\t\"\\033[228z\",\n\t\"\\033[229z\",\n\t\"\\033[230z\",\n\t\"\\033[231z\",\n\t\"\\033[232z\",\n\t\"\\033[233z\",\t/* F10 */\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "KS_GROUP",
          "args": [
            "in"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\nint\twsemul_sun_translate;\nvoid *cookie;\nvoid *cookie;\nstatic char *sun_fkeys[] = {\n\t\"\\033[224z\",\t/* F1 */\n\t\"\\033[225z\",\n\t\"\\033[226z\",\n\t\"\\033[227z\",\n\t\"\\033[228z\",\n\t\"\\033[229z\",\n\t\"\\033[230z\",\n\t\"\\033[231z\",\n\t\"\\033[232z\",\n\t\"\\033[233z\",\t/* F10 */\n};\n\nint\nwsemul_sun_translate(cookie, in, out)\n\tvoid *cookie;\n\tkeysym_t in;\n\tchar **out;\n{\n\tstatic char c;\n\n\tif (KS_GROUP(in) == KS_GROUP_Keypad && (in & 0x80) == 0) {\n\t\tc = in & 0xff; /* turn into ASCII */\n\t\t*out = &c;\n\t\treturn (1);\n\t}\n\n\tif (in >= KS_f1 && in <= KS_f10) {\n\t\t*out = sun_fkeys[in - KS_f1];\n\t\treturn (6);\n\t}\n\tif (in >= KS_F1 && in <= KS_F10) {\n\t\t*out = sun_fkeys[in - KS_F1];\n\t\treturn (6);\n\t}\n\tif (in >= KS_KP_F1 && in <= KS_KP_F4) {\n\t\t*out = sun_fkeys[in - KS_KP_F1];\n\t\treturn (6);\n\t}\n\n\tswitch (in) {\n\t    case KS_Home:\n\t    case KS_KP_Home:\n\t    case KS_KP_Begin:\n\t\t*out = \"\\033[214z\";\n\t\treturn (6);\n\t    case KS_Prior:\n\t    case KS_KP_Prior:\n\t\t*out = \"\\033[216z\";\n\t\treturn (6);\n\t    case KS_Next:\n\t    case KS_KP_Next:\n\t\t*out = \"\\033[222z\";\n\t\treturn (6);\n\t    case KS_Up:\n\t    case KS_KP_Up:\n\t\t*out = \"\\033[A\";\n\t\treturn (3);\n\t    case KS_Down:\n\t    case KS_KP_Down:\n\t\t*out = \"\\033[B\";\n\t\treturn (3);\n\t    case KS_Left:\n\t    case KS_KP_Left:\n\t\t*out = \"\\033[D\";\n\t\treturn (3);\n\t    case KS_Right:\n\t    case KS_KP_Right:\n\t\t*out = \"\\033[C\";\n\t\treturn (3);\n\t    case KS_KP_Delete:\n\t\t*out = \"\\177\";\n\t\treturn (1);\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "wsemul_sun_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "504-549",
    "snippet": "void\nwsemul_sun_output(cookie, data, count, kernel)\n\tvoid *cookie;\n\tconst u_char *data;\n\tu_int count;\n\tint kernel;\n{\n\tstruct wsemul_sun_emuldata *edp = cookie;\n\tu_int newstate;\n\n#ifdef DIAGNOSTIC\n\tif (kernel && !edp->console)\n\t\tpanic(\"wsemul_sun_output: kernel output, not console\");\n#endif\n\n\t/* XXX */\n\t(*edp->emulops->cursor)(edp->emulcookie, 0, edp->crow, edp->ccol);\n\tfor (; count > 0; data++, count--) {\n\t\tif (kernel) {\n\t\t\twsemul_sun_output_normal(edp, *data, 1);\n\t\t\tcontinue;\n\t\t}\n\t\tswitch (edp->state) {\n\t\tcase SUN_EMUL_STATE_NORMAL:\n\t\t\t/* XXX SCAN INPUT FOR NEWLINES, DO PRESCROLLING */\n\t\t\tnewstate = wsemul_sun_output_normal(edp, *data, 0);\n\t\t\tbreak;\n\t\tcase SUN_EMUL_STATE_HAVEESC:\n\t\t\tnewstate = wsemul_sun_output_haveesc(edp, *data);\n\t\t\tbreak;\n\t\tcase SUN_EMUL_STATE_CONTROL:\n\t\t\tnewstate = wsemul_sun_output_control(edp, *data);\n\t\t\tbreak;\n\t\tdefault:\n#ifdef DIAGNOSTIC\n\t\t\tpanic(\"wsemul_sun: invalid state %d\\n\", edp->state);\n#endif\n                        /* try to recover, if things get screwed up... */\n\t\t\tnewstate = wsemul_sun_output_normal(edp, *data, 0);\n                        break;\n\t\t}\n\t\tedp->state = newstate;\n\t}\n\t/* XXX */\n\t(*edp->emulops->cursor)(edp->emulcookie, 1, edp->crow, edp->ccol);\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [
      "#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */",
      "#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */",
      "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
    ],
    "globals_used": [
      "void\twsemul_sun_output",
      "static u_int\twsemul_sun_output_normal",
      "static u_int\twsemul_sun_output_haveesc",
      "static u_int\twsemul_sun_output_control",
      "void *cookie;",
      "int ccol, crow;",
      "void *\nwsemul_sun_attach(console, type, cookie, ccol, crow, cbcookie, defattr)\n\tint console;",
      "void *cookie;",
      "int ccol, crow;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "1",
            "edp->crow",
            "edp->ccol"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wsemul_sun_output_normal",
          "args": [
            "edp",
            "*data",
            "0"
          ],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "wsemul_sun_output_normal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
          "lines": "228-327",
          "snippet": "static inline u_int\nwsemul_sun_output_normal(edp, c, kernel)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n\tint kernel;\n{\n\tu_int newstate = SUN_EMUL_STATE_NORMAL;\n\tu_int n;\n\n\tswitch (c) {\n\tcase ASCII_BEL:\t\t/* \"Bell (BEL)\" */\n\t\twsdisplay_emulbell(edp->cbcookie);\n\t\tbreak;\n\n\tcase ASCII_BS:\t\t/* \"Backspace (BS)\" */\n\t\tif (edp->ccol > 0)\n\t\t\tedp->ccol--;\n\t\tbreak;\n\n\tcase ASCII_CR:\t\t/* \"Return (CR)\" */\n\t\tedp->ccol = 0;\n\t\tbreak;\n\n\tcase ASCII_HT:\t\t/* \"Tab (TAB)\" */\n\t\tn = min(8 - (edp->ccol & 7), COLS_LEFT);\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t\t\tedp->ccol, n,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol += n;\n\t\tbreak;\n\n\tcase ASCII_FF:\t\t/* \"Form Feed (FF)\" */\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\t\t\t/* XXX possible in kernel output? */\n\t\tedp->ccol = 0;\n\t\tedp->crow = 0;\n\t\tbreak;\n\n\tcase ASCII_VT:\t\t/* \"Reverse Line Feed\" */\n\t\tif (edp->crow > 0)\n\t\t\tedp->crow--;\n\t\tbreak;\n\n\tcase ASCII_ESC:\t\t/* \"Escape (ESC)\" */\n#ifdef DIAGNOSTIC\n\t\tif (kernel)\n\t\t\tpanic(\"ESC in kernel output\");\n#endif\n\t\tif (edp->state == SUN_EMUL_STATE_NORMAL) {\n\t\t\tnewstate = SUN_EMUL_STATE_HAVEESC;\n\t\t\tbreak;\n\t\t}\n\t\t/* special case: fall through, we're printing one out */\n\t\t/* FALLTHRU */\n\n\tdefault:\t\t/* normal character */\n\t\t(*edp->emulops->putchar)(edp->emulcookie, edp->crow, edp->ccol,\n\t\t    c, kernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol++;\n\n\t\t/* if cur col is still on cur line, done. */\n\t\tif (edp->ccol < edp->ncols)\n\t\t\tbreak;\n\n\t\t/* wrap the column around. */\n\t\tedp->ccol = 0;\n\n               \t/* FALLTHRU */\n\n\tcase ASCII_LF:\t\t/* \"Line Feed (LF)\" */\n                /* if the cur line isn't the last, incr and leave. */\n\t\tif (edp->crow < edp->nrows - 1) {\n\t\t\tedp->crow++;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*\n\t\t * if we're in wrap-around mode, go to the first\n\t\t * line and clear it.\n\t\t */\n\t\tif (edp->scrolldist == 0) {\n\t\t\tedp->crow = 0;\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, 1,\n\t\t\t\t\t\t   edp->curattr);\n\t\t\tbreak;\n\t\t}\n\n\t\t/* scroll by the scrolling distance. */\n\t\t(*edp->emulops->copyrows)(edp->emulcookie, edp->scrolldist, 0,\n\t\t    edp->nrows - edp->scrolldist);\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    edp->nrows - edp->scrolldist, edp->scrolldist,\n\t\t\t\t\t   edp->curattr);\n\t\tedp->crow -= edp->scrolldist - 1;\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}",
          "includes": [
            "#include <dev/wscons/ascii.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wsemulvar.h>",
            "#include <dev/wscons/wsdisplayvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/malloc.h>",
            "#include <sys/time.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [
            "#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)",
            "#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */",
            "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
          ],
          "globals_used": [
            "static u_int\twsemul_sun_output_normal",
            "int ccol, crow;",
            "int ccol, crow;",
            "void *cbcookie;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)\n#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nstatic u_int\twsemul_sun_output_normal;\nint ccol, crow;\nint ccol, crow;\nvoid *cbcookie;\n\nstatic inline u_int\nwsemul_sun_output_normal(edp, c, kernel)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n\tint kernel;\n{\n\tu_int newstate = SUN_EMUL_STATE_NORMAL;\n\tu_int n;\n\n\tswitch (c) {\n\tcase ASCII_BEL:\t\t/* \"Bell (BEL)\" */\n\t\twsdisplay_emulbell(edp->cbcookie);\n\t\tbreak;\n\n\tcase ASCII_BS:\t\t/* \"Backspace (BS)\" */\n\t\tif (edp->ccol > 0)\n\t\t\tedp->ccol--;\n\t\tbreak;\n\n\tcase ASCII_CR:\t\t/* \"Return (CR)\" */\n\t\tedp->ccol = 0;\n\t\tbreak;\n\n\tcase ASCII_HT:\t\t/* \"Tab (TAB)\" */\n\t\tn = min(8 - (edp->ccol & 7), COLS_LEFT);\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t\t\tedp->ccol, n,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol += n;\n\t\tbreak;\n\n\tcase ASCII_FF:\t\t/* \"Form Feed (FF)\" */\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\t\t\t/* XXX possible in kernel output? */\n\t\tedp->ccol = 0;\n\t\tedp->crow = 0;\n\t\tbreak;\n\n\tcase ASCII_VT:\t\t/* \"Reverse Line Feed\" */\n\t\tif (edp->crow > 0)\n\t\t\tedp->crow--;\n\t\tbreak;\n\n\tcase ASCII_ESC:\t\t/* \"Escape (ESC)\" */\n#ifdef DIAGNOSTIC\n\t\tif (kernel)\n\t\t\tpanic(\"ESC in kernel output\");\n#endif\n\t\tif (edp->state == SUN_EMUL_STATE_NORMAL) {\n\t\t\tnewstate = SUN_EMUL_STATE_HAVEESC;\n\t\t\tbreak;\n\t\t}\n\t\t/* special case: fall through, we're printing one out */\n\t\t/* FALLTHRU */\n\n\tdefault:\t\t/* normal character */\n\t\t(*edp->emulops->putchar)(edp->emulcookie, edp->crow, edp->ccol,\n\t\t    c, kernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol++;\n\n\t\t/* if cur col is still on cur line, done. */\n\t\tif (edp->ccol < edp->ncols)\n\t\t\tbreak;\n\n\t\t/* wrap the column around. */\n\t\tedp->ccol = 0;\n\n               \t/* FALLTHRU */\n\n\tcase ASCII_LF:\t\t/* \"Line Feed (LF)\" */\n                /* if the cur line isn't the last, incr and leave. */\n\t\tif (edp->crow < edp->nrows - 1) {\n\t\t\tedp->crow++;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*\n\t\t * if we're in wrap-around mode, go to the first\n\t\t * line and clear it.\n\t\t */\n\t\tif (edp->scrolldist == 0) {\n\t\t\tedp->crow = 0;\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, 1,\n\t\t\t\t\t\t   edp->curattr);\n\t\t\tbreak;\n\t\t}\n\n\t\t/* scroll by the scrolling distance. */\n\t\t(*edp->emulops->copyrows)(edp->emulcookie, edp->scrolldist, 0,\n\t\t    edp->nrows - edp->scrolldist);\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    edp->nrows - edp->scrolldist, edp->scrolldist,\n\t\t\t\t\t   edp->curattr);\n\t\tedp->crow -= edp->scrolldist - 1;\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}"
        }
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"wsemul_sun: invalid state %d\\n\"",
            "edp->state"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wsemul_sun_output_control",
          "args": [
            "edp",
            "*data"
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "wsemul_sun_output_control",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
          "lines": "476-502",
          "snippet": "static inline u_int\nwsemul_sun_output_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate = SUN_EMUL_STATE_CONTROL;\n\tu_int i;\n\n\tswitch (c) {\n\tcase '0': case '1': case '2': case '3': case '4': /* argument digit */\n\tcase '5': case '6': case '7': case '8': case '9':\n\t\tedp->args[0] = (edp->args[0] * 10) + (c - '0');\n                break;\n\n\tcase ';':\t\t/* argument terminator */\n\t\tfor (i = 1; i < SUN_EMUL_NARGS; i++)\n\t\t\tedp->args[i] = edp->args[i - 1];\n\t\tedp->args[0] = 0;\n\t\tbreak;\n\n\tdefault:\t\t/* end of escape sequence */\n\t\twsemul_sun_control(edp, c);\n\t\tnewstate = SUN_EMUL_STATE_NORMAL;\n\t\tbreak;\n\t}\n\treturn (newstate);\n}",
          "includes": [
            "#include <dev/wscons/ascii.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wsemulvar.h>",
            "#include <dev/wscons/wsdisplayvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/malloc.h>",
            "#include <sys/time.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [
            "#define\tSUN_EMUL_NARGS\t2\t\t/* max # of args to a command */",
            "#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */",
            "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
          ],
          "globals_used": [
            "static u_int\twsemul_sun_output_control",
            "static void\twsemul_sun_control"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tSUN_EMUL_NARGS\t2\t\t/* max # of args to a command */\n#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nstatic u_int\twsemul_sun_output_control;\nstatic void\twsemul_sun_control;\n\nstatic inline u_int\nwsemul_sun_output_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate = SUN_EMUL_STATE_CONTROL;\n\tu_int i;\n\n\tswitch (c) {\n\tcase '0': case '1': case '2': case '3': case '4': /* argument digit */\n\tcase '5': case '6': case '7': case '8': case '9':\n\t\tedp->args[0] = (edp->args[0] * 10) + (c - '0');\n                break;\n\n\tcase ';':\t\t/* argument terminator */\n\t\tfor (i = 1; i < SUN_EMUL_NARGS; i++)\n\t\t\tedp->args[i] = edp->args[i - 1];\n\t\tedp->args[0] = 0;\n\t\tbreak;\n\n\tdefault:\t\t/* end of escape sequence */\n\t\twsemul_sun_control(edp, c);\n\t\tnewstate = SUN_EMUL_STATE_NORMAL;\n\t\tbreak;\n\t}\n\treturn (newstate);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wsemul_sun_output_haveesc",
          "args": [
            "edp",
            "*data"
          ],
          "line": 532
        },
        "resolved": true,
        "details": {
          "function_name": "wsemul_sun_output_haveesc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
          "lines": "329-350",
          "snippet": "static inline u_int\nwsemul_sun_output_haveesc(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate;\n\n\tswitch (c) {\n\tcase '[':\t\t/* continuation of multi-char sequence */\n\t\tbzero(edp->args, sizeof (edp->args));\n\t\tnewstate = SUN_EMUL_STATE_CONTROL;\n\t\tbreak;\n\n\tdefault:\n\t\t/* spit out the escape char (???), then the new character */\n\t\twsemul_sun_output_normal(edp, ASCII_ESC, 0);\t/* ??? */\n\t\tnewstate = wsemul_sun_output_normal(edp, c, 0);\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}",
          "includes": [
            "#include <dev/wscons/ascii.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wsemulvar.h>",
            "#include <dev/wscons/wsdisplayvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/malloc.h>",
            "#include <sys/time.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [
            "#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */"
          ],
          "globals_used": [
            "static u_int\twsemul_sun_output_normal",
            "static u_int\twsemul_sun_output_haveesc"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */\n\nstatic u_int\twsemul_sun_output_normal;\nstatic u_int\twsemul_sun_output_haveesc;\n\nstatic inline u_int\nwsemul_sun_output_haveesc(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate;\n\n\tswitch (c) {\n\tcase '[':\t\t/* continuation of multi-char sequence */\n\t\tbzero(edp->args, sizeof (edp->args));\n\t\tnewstate = SUN_EMUL_STATE_CONTROL;\n\t\tbreak;\n\n\tdefault:\n\t\t/* spit out the escape char (???), then the new character */\n\t\twsemul_sun_output_normal(edp, ASCII_ESC, 0);\t/* ??? */\n\t\tnewstate = wsemul_sun_output_normal(edp, c, 0);\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "0",
            "edp->crow",
            "edp->ccol"
          ],
          "line": 520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"wsemul_sun_output: kernel output, not console\""
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */\n#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nvoid\twsemul_sun_output;\nstatic u_int\twsemul_sun_output_normal;\nstatic u_int\twsemul_sun_output_haveesc;\nstatic u_int\twsemul_sun_output_control;\nvoid *cookie;\nint ccol, crow;\nvoid *\nwsemul_sun_attach(console, type, cookie, ccol, crow, cbcookie, defattr)\n\tint console;\nvoid *cookie;\nint ccol, crow;\n\nvoid\nwsemul_sun_output(cookie, data, count, kernel)\n\tvoid *cookie;\n\tconst u_char *data;\n\tu_int count;\n\tint kernel;\n{\n\tstruct wsemul_sun_emuldata *edp = cookie;\n\tu_int newstate;\n\n#ifdef DIAGNOSTIC\n\tif (kernel && !edp->console)\n\t\tpanic(\"wsemul_sun_output: kernel output, not console\");\n#endif\n\n\t/* XXX */\n\t(*edp->emulops->cursor)(edp->emulcookie, 0, edp->crow, edp->ccol);\n\tfor (; count > 0; data++, count--) {\n\t\tif (kernel) {\n\t\t\twsemul_sun_output_normal(edp, *data, 1);\n\t\t\tcontinue;\n\t\t}\n\t\tswitch (edp->state) {\n\t\tcase SUN_EMUL_STATE_NORMAL:\n\t\t\t/* XXX SCAN INPUT FOR NEWLINES, DO PRESCROLLING */\n\t\t\tnewstate = wsemul_sun_output_normal(edp, *data, 0);\n\t\t\tbreak;\n\t\tcase SUN_EMUL_STATE_HAVEESC:\n\t\t\tnewstate = wsemul_sun_output_haveesc(edp, *data);\n\t\t\tbreak;\n\t\tcase SUN_EMUL_STATE_CONTROL:\n\t\t\tnewstate = wsemul_sun_output_control(edp, *data);\n\t\t\tbreak;\n\t\tdefault:\n#ifdef DIAGNOSTIC\n\t\t\tpanic(\"wsemul_sun: invalid state %d\\n\", edp->state);\n#endif\n                        /* try to recover, if things get screwed up... */\n\t\t\tnewstate = wsemul_sun_output_normal(edp, *data, 0);\n                        break;\n\t\t}\n\t\tedp->state = newstate;\n\t}\n\t/* XXX */\n\t(*edp->emulops->cursor)(edp->emulcookie, 1, edp->crow, edp->ccol);\n}"
  },
  {
    "function_name": "wsemul_sun_output_control",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "476-502",
    "snippet": "static inline u_int\nwsemul_sun_output_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate = SUN_EMUL_STATE_CONTROL;\n\tu_int i;\n\n\tswitch (c) {\n\tcase '0': case '1': case '2': case '3': case '4': /* argument digit */\n\tcase '5': case '6': case '7': case '8': case '9':\n\t\tedp->args[0] = (edp->args[0] * 10) + (c - '0');\n                break;\n\n\tcase ';':\t\t/* argument terminator */\n\t\tfor (i = 1; i < SUN_EMUL_NARGS; i++)\n\t\t\tedp->args[i] = edp->args[i - 1];\n\t\tedp->args[0] = 0;\n\t\tbreak;\n\n\tdefault:\t\t/* end of escape sequence */\n\t\twsemul_sun_control(edp, c);\n\t\tnewstate = SUN_EMUL_STATE_NORMAL;\n\t\tbreak;\n\t}\n\treturn (newstate);\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [
      "#define\tSUN_EMUL_NARGS\t2\t\t/* max # of args to a command */",
      "#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */",
      "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
    ],
    "globals_used": [
      "static u_int\twsemul_sun_output_control",
      "static void\twsemul_sun_control"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wsemul_sun_control",
          "args": [
            "edp",
            "c"
          ],
          "line": 497
        },
        "resolved": true,
        "details": {
          "function_name": "wsemul_sun_control",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
          "lines": "352-474",
          "snippet": "static inline void\nwsemul_sun_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int n, src, dst;\n\n\tswitch (c) {\n\tcase '@':\t\t/* \"Insert Character (ICH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol;\n\t\tdst = edp->ccol + n;\n\t\tif (dst < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - dst);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'A':\t\t/* \"Cursor Up (CUU)\" */\n\t\tedp->crow -= min(NORMALIZE_ARG(0), edp->crow);\n\t\tbreak;\n\n\tcase 'E':\t\t/* \"Cursor Next Line (CNL)\" */\n\t\tedp->ccol = 0;\n\t\t/* FALLTHRU */\n\tcase 'B':\t\t/* \"Cursor Down (CUD)\" */\n\t\tedp->crow += min(NORMALIZE_ARG(0), ROWS_LEFT);\n\t\tbreak;\n\n\tcase 'C':\t\t/* \"Cursor Forward (CUF)\" */\n\t\tedp->ccol += min(NORMALIZE_ARG(0), COLS_LEFT);\n\t\tbreak;\n\n\tcase 'D':\t\t/* \"Cursor Backward (CUB)\" */\n\t\tedp->ccol -= min(NORMALIZE_ARG(0), edp->ccol);\n\t\tbreak;\n\n\tcase 'f':\t\t/* \"Horizontal And Vertical Position (HVP)\" */\n\tcase 'H':\t\t/* \"Cursor Position (CUP)\" */\n\t\tedp->crow = min(NORMALIZE_ARG(1), edp->nrows) - 1;\n\t\tedp->ccol = min(NORMALIZE_ARG(0), edp->ncols) - 1;\n\t\tbreak;\n\n\tcase 'J':\t\t/* \"Erase in Display (ED)\" */\n\t\tif (ROWS_LEFT > 0) {\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t\t     edp->crow + 1, ROWS_LEFT, edp->curattr);\n\t\t}\n\t\t/* FALLTHRU */\n\tcase 'K':\t\t/* \"Erase in Line (EL)\" */\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    edp->ccol, COLS_LEFT + 1, edp->curattr);\n\t\tbreak;\n\n\tcase 'L':\t\t/* \"Insert Line (IL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow;\n\t\tdst = edp->crow + n;\n\t\tif (dst < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - dst);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'M':\t\t/* \"Delete Line (DL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow + n;\n\t\tdst = edp->crow;\n\t\tif (src < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - src);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    dst + edp->nrows - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'P':\t\t/* \"Delete Character (DCH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol + n;\n\t\tdst = edp->ccol;\n\t\tif (src < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - src);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    dst + edp->ncols - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'm':\t\t/* \"Select Graphic Rendition (SGR)\" */\n\t\tif (ARG(0))\n\t\t\tedp->rendflags |= REND_SO;\n\t\telse\n\t\t\tedp->rendflags &= ~REND_SO;\n\t\tgoto setattr;\n\n\tcase 'p':\t\t/* \"Black On White (SUNBOW)\" */\n\t\tedp->rendflags |= REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'q':\t\t/* \"White On Black (SUNWOB)\" */\n\t\tedp->rendflags &= ~REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'r':\t\t/* \"Set Scrolling (SUNSCRL)\" */\n\t\tedp->scrolldist = min(ARG(0), edp->nrows);\n\t\tbreak;\n\n\tcase 's':\t\t/* \"Reset Terminal Emulator (SUNRESET)\" */\n\t\tedp->scrolldist = 1;\n\t\tedp->rendflags = 0;\nsetattr:\n\t\tif (((edp->rendflags & REND_BOW) != 0) ^\n\t\t    ((edp->rendflags & REND_SO) != 0))\n\t\t\tedp->curattr = edp->bowattr;\n\t\telse\n\t\t\tedp->curattr = edp->defattr;\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/wscons/ascii.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wsemulvar.h>",
            "#include <dev/wscons/wsdisplayvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/malloc.h>",
            "#include <sys/time.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [
            "#define\tROWS_LEFT\t\t(edp->nrows - edp->crow - 1)",
            "#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)",
            "#define REND_SO 2",
            "#define REND_BOW 1"
          ],
          "globals_used": [
            "static void\twsemul_sun_control",
            "int ccol, crow;",
            "long defattr;",
            "int ccol, crow;",
            "long defattr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tROWS_LEFT\t\t(edp->nrows - edp->crow - 1)\n#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)\n#define REND_SO 2\n#define REND_BOW 1\n\nstatic void\twsemul_sun_control;\nint ccol, crow;\nlong defattr;\nint ccol, crow;\nlong defattr;\n\nstatic inline void\nwsemul_sun_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int n, src, dst;\n\n\tswitch (c) {\n\tcase '@':\t\t/* \"Insert Character (ICH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol;\n\t\tdst = edp->ccol + n;\n\t\tif (dst < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - dst);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'A':\t\t/* \"Cursor Up (CUU)\" */\n\t\tedp->crow -= min(NORMALIZE_ARG(0), edp->crow);\n\t\tbreak;\n\n\tcase 'E':\t\t/* \"Cursor Next Line (CNL)\" */\n\t\tedp->ccol = 0;\n\t\t/* FALLTHRU */\n\tcase 'B':\t\t/* \"Cursor Down (CUD)\" */\n\t\tedp->crow += min(NORMALIZE_ARG(0), ROWS_LEFT);\n\t\tbreak;\n\n\tcase 'C':\t\t/* \"Cursor Forward (CUF)\" */\n\t\tedp->ccol += min(NORMALIZE_ARG(0), COLS_LEFT);\n\t\tbreak;\n\n\tcase 'D':\t\t/* \"Cursor Backward (CUB)\" */\n\t\tedp->ccol -= min(NORMALIZE_ARG(0), edp->ccol);\n\t\tbreak;\n\n\tcase 'f':\t\t/* \"Horizontal And Vertical Position (HVP)\" */\n\tcase 'H':\t\t/* \"Cursor Position (CUP)\" */\n\t\tedp->crow = min(NORMALIZE_ARG(1), edp->nrows) - 1;\n\t\tedp->ccol = min(NORMALIZE_ARG(0), edp->ncols) - 1;\n\t\tbreak;\n\n\tcase 'J':\t\t/* \"Erase in Display (ED)\" */\n\t\tif (ROWS_LEFT > 0) {\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t\t     edp->crow + 1, ROWS_LEFT, edp->curattr);\n\t\t}\n\t\t/* FALLTHRU */\n\tcase 'K':\t\t/* \"Erase in Line (EL)\" */\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    edp->ccol, COLS_LEFT + 1, edp->curattr);\n\t\tbreak;\n\n\tcase 'L':\t\t/* \"Insert Line (IL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow;\n\t\tdst = edp->crow + n;\n\t\tif (dst < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - dst);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'M':\t\t/* \"Delete Line (DL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow + n;\n\t\tdst = edp->crow;\n\t\tif (src < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - src);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    dst + edp->nrows - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'P':\t\t/* \"Delete Character (DCH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol + n;\n\t\tdst = edp->ccol;\n\t\tif (src < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - src);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    dst + edp->ncols - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'm':\t\t/* \"Select Graphic Rendition (SGR)\" */\n\t\tif (ARG(0))\n\t\t\tedp->rendflags |= REND_SO;\n\t\telse\n\t\t\tedp->rendflags &= ~REND_SO;\n\t\tgoto setattr;\n\n\tcase 'p':\t\t/* \"Black On White (SUNBOW)\" */\n\t\tedp->rendflags |= REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'q':\t\t/* \"White On Black (SUNWOB)\" */\n\t\tedp->rendflags &= ~REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'r':\t\t/* \"Set Scrolling (SUNSCRL)\" */\n\t\tedp->scrolldist = min(ARG(0), edp->nrows);\n\t\tbreak;\n\n\tcase 's':\t\t/* \"Reset Terminal Emulator (SUNRESET)\" */\n\t\tedp->scrolldist = 1;\n\t\tedp->rendflags = 0;\nsetattr:\n\t\tif (((edp->rendflags & REND_BOW) != 0) ^\n\t\t    ((edp->rendflags & REND_SO) != 0))\n\t\t\tedp->curattr = edp->bowattr;\n\t\telse\n\t\t\tedp->curattr = edp->defattr;\n\t\tbreak;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tSUN_EMUL_NARGS\t2\t\t/* max # of args to a command */\n#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nstatic u_int\twsemul_sun_output_control;\nstatic void\twsemul_sun_control;\n\nstatic inline u_int\nwsemul_sun_output_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate = SUN_EMUL_STATE_CONTROL;\n\tu_int i;\n\n\tswitch (c) {\n\tcase '0': case '1': case '2': case '3': case '4': /* argument digit */\n\tcase '5': case '6': case '7': case '8': case '9':\n\t\tedp->args[0] = (edp->args[0] * 10) + (c - '0');\n                break;\n\n\tcase ';':\t\t/* argument terminator */\n\t\tfor (i = 1; i < SUN_EMUL_NARGS; i++)\n\t\t\tedp->args[i] = edp->args[i - 1];\n\t\tedp->args[0] = 0;\n\t\tbreak;\n\n\tdefault:\t\t/* end of escape sequence */\n\t\twsemul_sun_control(edp, c);\n\t\tnewstate = SUN_EMUL_STATE_NORMAL;\n\t\tbreak;\n\t}\n\treturn (newstate);\n}"
  },
  {
    "function_name": "wsemul_sun_control",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "352-474",
    "snippet": "static inline void\nwsemul_sun_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int n, src, dst;\n\n\tswitch (c) {\n\tcase '@':\t\t/* \"Insert Character (ICH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol;\n\t\tdst = edp->ccol + n;\n\t\tif (dst < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - dst);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'A':\t\t/* \"Cursor Up (CUU)\" */\n\t\tedp->crow -= min(NORMALIZE_ARG(0), edp->crow);\n\t\tbreak;\n\n\tcase 'E':\t\t/* \"Cursor Next Line (CNL)\" */\n\t\tedp->ccol = 0;\n\t\t/* FALLTHRU */\n\tcase 'B':\t\t/* \"Cursor Down (CUD)\" */\n\t\tedp->crow += min(NORMALIZE_ARG(0), ROWS_LEFT);\n\t\tbreak;\n\n\tcase 'C':\t\t/* \"Cursor Forward (CUF)\" */\n\t\tedp->ccol += min(NORMALIZE_ARG(0), COLS_LEFT);\n\t\tbreak;\n\n\tcase 'D':\t\t/* \"Cursor Backward (CUB)\" */\n\t\tedp->ccol -= min(NORMALIZE_ARG(0), edp->ccol);\n\t\tbreak;\n\n\tcase 'f':\t\t/* \"Horizontal And Vertical Position (HVP)\" */\n\tcase 'H':\t\t/* \"Cursor Position (CUP)\" */\n\t\tedp->crow = min(NORMALIZE_ARG(1), edp->nrows) - 1;\n\t\tedp->ccol = min(NORMALIZE_ARG(0), edp->ncols) - 1;\n\t\tbreak;\n\n\tcase 'J':\t\t/* \"Erase in Display (ED)\" */\n\t\tif (ROWS_LEFT > 0) {\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t\t     edp->crow + 1, ROWS_LEFT, edp->curattr);\n\t\t}\n\t\t/* FALLTHRU */\n\tcase 'K':\t\t/* \"Erase in Line (EL)\" */\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    edp->ccol, COLS_LEFT + 1, edp->curattr);\n\t\tbreak;\n\n\tcase 'L':\t\t/* \"Insert Line (IL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow;\n\t\tdst = edp->crow + n;\n\t\tif (dst < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - dst);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'M':\t\t/* \"Delete Line (DL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow + n;\n\t\tdst = edp->crow;\n\t\tif (src < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - src);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    dst + edp->nrows - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'P':\t\t/* \"Delete Character (DCH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol + n;\n\t\tdst = edp->ccol;\n\t\tif (src < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - src);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    dst + edp->ncols - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'm':\t\t/* \"Select Graphic Rendition (SGR)\" */\n\t\tif (ARG(0))\n\t\t\tedp->rendflags |= REND_SO;\n\t\telse\n\t\t\tedp->rendflags &= ~REND_SO;\n\t\tgoto setattr;\n\n\tcase 'p':\t\t/* \"Black On White (SUNBOW)\" */\n\t\tedp->rendflags |= REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'q':\t\t/* \"White On Black (SUNWOB)\" */\n\t\tedp->rendflags &= ~REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'r':\t\t/* \"Set Scrolling (SUNSCRL)\" */\n\t\tedp->scrolldist = min(ARG(0), edp->nrows);\n\t\tbreak;\n\n\tcase 's':\t\t/* \"Reset Terminal Emulator (SUNRESET)\" */\n\t\tedp->scrolldist = 1;\n\t\tedp->rendflags = 0;\nsetattr:\n\t\tif (((edp->rendflags & REND_BOW) != 0) ^\n\t\t    ((edp->rendflags & REND_SO) != 0))\n\t\t\tedp->curattr = edp->bowattr;\n\t\telse\n\t\t\tedp->curattr = edp->defattr;\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [
      "#define\tROWS_LEFT\t\t(edp->nrows - edp->crow - 1)",
      "#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)",
      "#define REND_SO 2",
      "#define REND_BOW 1"
    ],
    "globals_used": [
      "static void\twsemul_sun_control",
      "int ccol, crow;",
      "long defattr;",
      "int ccol, crow;",
      "long defattr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "min",
          "args": [
            "ARG(0)",
            "edp->nrows"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "seq_do_timing",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/sequencer.c",
          "lines": "804-819",
          "snippet": "int\nseq_do_timing(sc, b)\n\tstruct sequencer_softc *sc;\n\tseq_event_rec *b;\n{\n\tunion {\n\t\tint32_t i;\n\t\tu_int8_t b[4];\n\t} u;\n\n\tu.b[0] = b->arr[4];\n\tu.b[1] = b->arr[5];\n\tu.b[2] = b->arr[6];\n\tu.b[3] = b->arr[7];\n\treturn (seq_timer(sc, SEQ_TCMD(b), u.i, b));\n}",
          "includes": [
            "#include \"midi.h\"",
            "#include <dev/sequencervar.h>",
            "#include <dev/midivar.h>",
            "#include <dev/midi_if.h>",
            "#include <sys/device.h>",
            "#include <sys/midiio.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/signalvar.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/proc.h>",
            "#include <sys/malloc.h>",
            "#include <sys/poll.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>",
            "#include \"sequencer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"midi.h\"\n#include <dev/sequencervar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/signalvar.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/proc.h>\n#include <sys/malloc.h>\n#include <sys/poll.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n#include \"sequencer.h\"\n\nint\nseq_do_timing(sc, b)\n\tstruct sequencer_softc *sc;\n\tseq_event_rec *b;\n{\n\tunion {\n\t\tint32_t i;\n\t\tu_int8_t b[4];\n\t} u;\n\n\tu.b[0] = b->arr[4];\n\tu.b[1] = b->arr[5];\n\tu.b[2] = b->arr[6];\n\tu.b[3] = b->arr[7];\n\treturn (seq_timer(sc, SEQ_TCMD(b), u.i, b));\n}"
        }
      },
      {
        "call_info": {
          "callee": "ARG",
          "args": [
            "0"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ARG",
          "args": [
            "0"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "dst + edp->ncols - src",
            "src - dst",
            "edp->curattr"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "src",
            "dst",
            "edp->ncols - src"
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "dst + edp->nrows - src",
            "src - dst",
            "edp->curattr"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "src",
            "dst",
            "edp->nrows - src"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "src",
            "dst - src",
            "edp->curattr"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "src",
            "dst",
            "edp->nrows - dst"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "edp->ccol",
            "COLS_LEFT + 1",
            "edp->curattr"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow + 1",
            "ROWS_LEFT",
            "edp->curattr"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "1"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "src",
            "dst - src",
            "edp->curattr"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "src",
            "dst",
            "edp->ncols - dst"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NORMALIZE_ARG",
          "args": [
            "0"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tROWS_LEFT\t\t(edp->nrows - edp->crow - 1)\n#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)\n#define REND_SO 2\n#define REND_BOW 1\n\nstatic void\twsemul_sun_control;\nint ccol, crow;\nlong defattr;\nint ccol, crow;\nlong defattr;\n\nstatic inline void\nwsemul_sun_control(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int n, src, dst;\n\n\tswitch (c) {\n\tcase '@':\t\t/* \"Insert Character (ICH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol;\n\t\tdst = edp->ccol + n;\n\t\tif (dst < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - dst);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'A':\t\t/* \"Cursor Up (CUU)\" */\n\t\tedp->crow -= min(NORMALIZE_ARG(0), edp->crow);\n\t\tbreak;\n\n\tcase 'E':\t\t/* \"Cursor Next Line (CNL)\" */\n\t\tedp->ccol = 0;\n\t\t/* FALLTHRU */\n\tcase 'B':\t\t/* \"Cursor Down (CUD)\" */\n\t\tedp->crow += min(NORMALIZE_ARG(0), ROWS_LEFT);\n\t\tbreak;\n\n\tcase 'C':\t\t/* \"Cursor Forward (CUF)\" */\n\t\tedp->ccol += min(NORMALIZE_ARG(0), COLS_LEFT);\n\t\tbreak;\n\n\tcase 'D':\t\t/* \"Cursor Backward (CUB)\" */\n\t\tedp->ccol -= min(NORMALIZE_ARG(0), edp->ccol);\n\t\tbreak;\n\n\tcase 'f':\t\t/* \"Horizontal And Vertical Position (HVP)\" */\n\tcase 'H':\t\t/* \"Cursor Position (CUP)\" */\n\t\tedp->crow = min(NORMALIZE_ARG(1), edp->nrows) - 1;\n\t\tedp->ccol = min(NORMALIZE_ARG(0), edp->ncols) - 1;\n\t\tbreak;\n\n\tcase 'J':\t\t/* \"Erase in Display (ED)\" */\n\t\tif (ROWS_LEFT > 0) {\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t\t     edp->crow + 1, ROWS_LEFT, edp->curattr);\n\t\t}\n\t\t/* FALLTHRU */\n\tcase 'K':\t\t/* \"Erase in Line (EL)\" */\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    edp->ccol, COLS_LEFT + 1, edp->curattr);\n\t\tbreak;\n\n\tcase 'L':\t\t/* \"Insert Line (IL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow;\n\t\tdst = edp->crow + n;\n\t\tif (dst < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - dst);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    src, dst - src, edp->curattr);\n\t\tbreak;\n\n\tcase 'M':\t\t/* \"Delete Line (DL)\" */\n\t\tn = min(NORMALIZE_ARG(0), ROWS_LEFT + 1);\n\t\tsrc = edp->crow + n;\n\t\tdst = edp->crow;\n\t\tif (src < edp->nrows) {\n\t\t\t(*edp->emulops->copyrows)(edp->emulcookie,\n\t\t\t    src, dst, edp->nrows - src);\n\t\t}\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    dst + edp->nrows - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'P':\t\t/* \"Delete Character (DCH)\" */\n\t\tn = min(NORMALIZE_ARG(0), COLS_LEFT + 1);\n\t\tsrc = edp->ccol + n;\n\t\tdst = edp->ccol;\n\t\tif (src < edp->ncols) {\n\t\t\t(*edp->emulops->copycols)(edp->emulcookie, edp->crow,\n\t\t\t    src, dst, edp->ncols - src);\n\t\t}\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t    dst + edp->ncols - src, src - dst, edp->curattr);\n\t\tbreak;\n\n\tcase 'm':\t\t/* \"Select Graphic Rendition (SGR)\" */\n\t\tif (ARG(0))\n\t\t\tedp->rendflags |= REND_SO;\n\t\telse\n\t\t\tedp->rendflags &= ~REND_SO;\n\t\tgoto setattr;\n\n\tcase 'p':\t\t/* \"Black On White (SUNBOW)\" */\n\t\tedp->rendflags |= REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'q':\t\t/* \"White On Black (SUNWOB)\" */\n\t\tedp->rendflags &= ~REND_BOW;\n\t\tgoto setattr;\n\n\tcase 'r':\t\t/* \"Set Scrolling (SUNSCRL)\" */\n\t\tedp->scrolldist = min(ARG(0), edp->nrows);\n\t\tbreak;\n\n\tcase 's':\t\t/* \"Reset Terminal Emulator (SUNRESET)\" */\n\t\tedp->scrolldist = 1;\n\t\tedp->rendflags = 0;\nsetattr:\n\t\tif (((edp->rendflags & REND_BOW) != 0) ^\n\t\t    ((edp->rendflags & REND_SO) != 0))\n\t\t\tedp->curattr = edp->bowattr;\n\t\telse\n\t\t\tedp->curattr = edp->defattr;\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "wsemul_sun_output_haveesc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "329-350",
    "snippet": "static inline u_int\nwsemul_sun_output_haveesc(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate;\n\n\tswitch (c) {\n\tcase '[':\t\t/* continuation of multi-char sequence */\n\t\tbzero(edp->args, sizeof (edp->args));\n\t\tnewstate = SUN_EMUL_STATE_CONTROL;\n\t\tbreak;\n\n\tdefault:\n\t\t/* spit out the escape char (???), then the new character */\n\t\twsemul_sun_output_normal(edp, ASCII_ESC, 0);\t/* ??? */\n\t\tnewstate = wsemul_sun_output_normal(edp, c, 0);\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [
      "#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */"
    ],
    "globals_used": [
      "static u_int\twsemul_sun_output_normal",
      "static u_int\twsemul_sun_output_haveesc"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wsemul_sun_output_normal",
          "args": [
            "edp",
            "c",
            "0"
          ],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "wsemul_sun_output_normal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
          "lines": "228-327",
          "snippet": "static inline u_int\nwsemul_sun_output_normal(edp, c, kernel)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n\tint kernel;\n{\n\tu_int newstate = SUN_EMUL_STATE_NORMAL;\n\tu_int n;\n\n\tswitch (c) {\n\tcase ASCII_BEL:\t\t/* \"Bell (BEL)\" */\n\t\twsdisplay_emulbell(edp->cbcookie);\n\t\tbreak;\n\n\tcase ASCII_BS:\t\t/* \"Backspace (BS)\" */\n\t\tif (edp->ccol > 0)\n\t\t\tedp->ccol--;\n\t\tbreak;\n\n\tcase ASCII_CR:\t\t/* \"Return (CR)\" */\n\t\tedp->ccol = 0;\n\t\tbreak;\n\n\tcase ASCII_HT:\t\t/* \"Tab (TAB)\" */\n\t\tn = min(8 - (edp->ccol & 7), COLS_LEFT);\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t\t\tedp->ccol, n,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol += n;\n\t\tbreak;\n\n\tcase ASCII_FF:\t\t/* \"Form Feed (FF)\" */\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\t\t\t/* XXX possible in kernel output? */\n\t\tedp->ccol = 0;\n\t\tedp->crow = 0;\n\t\tbreak;\n\n\tcase ASCII_VT:\t\t/* \"Reverse Line Feed\" */\n\t\tif (edp->crow > 0)\n\t\t\tedp->crow--;\n\t\tbreak;\n\n\tcase ASCII_ESC:\t\t/* \"Escape (ESC)\" */\n#ifdef DIAGNOSTIC\n\t\tif (kernel)\n\t\t\tpanic(\"ESC in kernel output\");\n#endif\n\t\tif (edp->state == SUN_EMUL_STATE_NORMAL) {\n\t\t\tnewstate = SUN_EMUL_STATE_HAVEESC;\n\t\t\tbreak;\n\t\t}\n\t\t/* special case: fall through, we're printing one out */\n\t\t/* FALLTHRU */\n\n\tdefault:\t\t/* normal character */\n\t\t(*edp->emulops->putchar)(edp->emulcookie, edp->crow, edp->ccol,\n\t\t    c, kernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol++;\n\n\t\t/* if cur col is still on cur line, done. */\n\t\tif (edp->ccol < edp->ncols)\n\t\t\tbreak;\n\n\t\t/* wrap the column around. */\n\t\tedp->ccol = 0;\n\n               \t/* FALLTHRU */\n\n\tcase ASCII_LF:\t\t/* \"Line Feed (LF)\" */\n                /* if the cur line isn't the last, incr and leave. */\n\t\tif (edp->crow < edp->nrows - 1) {\n\t\t\tedp->crow++;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*\n\t\t * if we're in wrap-around mode, go to the first\n\t\t * line and clear it.\n\t\t */\n\t\tif (edp->scrolldist == 0) {\n\t\t\tedp->crow = 0;\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, 1,\n\t\t\t\t\t\t   edp->curattr);\n\t\t\tbreak;\n\t\t}\n\n\t\t/* scroll by the scrolling distance. */\n\t\t(*edp->emulops->copyrows)(edp->emulcookie, edp->scrolldist, 0,\n\t\t    edp->nrows - edp->scrolldist);\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    edp->nrows - edp->scrolldist, edp->scrolldist,\n\t\t\t\t\t   edp->curattr);\n\t\tedp->crow -= edp->scrolldist - 1;\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}",
          "includes": [
            "#include <dev/wscons/ascii.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wsemulvar.h>",
            "#include <dev/wscons/wsdisplayvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/malloc.h>",
            "#include <sys/time.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [
            "#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)",
            "#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */",
            "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
          ],
          "globals_used": [
            "static u_int\twsemul_sun_output_normal",
            "int ccol, crow;",
            "int ccol, crow;",
            "void *cbcookie;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)\n#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nstatic u_int\twsemul_sun_output_normal;\nint ccol, crow;\nint ccol, crow;\nvoid *cbcookie;\n\nstatic inline u_int\nwsemul_sun_output_normal(edp, c, kernel)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n\tint kernel;\n{\n\tu_int newstate = SUN_EMUL_STATE_NORMAL;\n\tu_int n;\n\n\tswitch (c) {\n\tcase ASCII_BEL:\t\t/* \"Bell (BEL)\" */\n\t\twsdisplay_emulbell(edp->cbcookie);\n\t\tbreak;\n\n\tcase ASCII_BS:\t\t/* \"Backspace (BS)\" */\n\t\tif (edp->ccol > 0)\n\t\t\tedp->ccol--;\n\t\tbreak;\n\n\tcase ASCII_CR:\t\t/* \"Return (CR)\" */\n\t\tedp->ccol = 0;\n\t\tbreak;\n\n\tcase ASCII_HT:\t\t/* \"Tab (TAB)\" */\n\t\tn = min(8 - (edp->ccol & 7), COLS_LEFT);\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t\t\tedp->ccol, n,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol += n;\n\t\tbreak;\n\n\tcase ASCII_FF:\t\t/* \"Form Feed (FF)\" */\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\t\t\t/* XXX possible in kernel output? */\n\t\tedp->ccol = 0;\n\t\tedp->crow = 0;\n\t\tbreak;\n\n\tcase ASCII_VT:\t\t/* \"Reverse Line Feed\" */\n\t\tif (edp->crow > 0)\n\t\t\tedp->crow--;\n\t\tbreak;\n\n\tcase ASCII_ESC:\t\t/* \"Escape (ESC)\" */\n#ifdef DIAGNOSTIC\n\t\tif (kernel)\n\t\t\tpanic(\"ESC in kernel output\");\n#endif\n\t\tif (edp->state == SUN_EMUL_STATE_NORMAL) {\n\t\t\tnewstate = SUN_EMUL_STATE_HAVEESC;\n\t\t\tbreak;\n\t\t}\n\t\t/* special case: fall through, we're printing one out */\n\t\t/* FALLTHRU */\n\n\tdefault:\t\t/* normal character */\n\t\t(*edp->emulops->putchar)(edp->emulcookie, edp->crow, edp->ccol,\n\t\t    c, kernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol++;\n\n\t\t/* if cur col is still on cur line, done. */\n\t\tif (edp->ccol < edp->ncols)\n\t\t\tbreak;\n\n\t\t/* wrap the column around. */\n\t\tedp->ccol = 0;\n\n               \t/* FALLTHRU */\n\n\tcase ASCII_LF:\t\t/* \"Line Feed (LF)\" */\n                /* if the cur line isn't the last, incr and leave. */\n\t\tif (edp->crow < edp->nrows - 1) {\n\t\t\tedp->crow++;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*\n\t\t * if we're in wrap-around mode, go to the first\n\t\t * line and clear it.\n\t\t */\n\t\tif (edp->scrolldist == 0) {\n\t\t\tedp->crow = 0;\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, 1,\n\t\t\t\t\t\t   edp->curattr);\n\t\t\tbreak;\n\t\t}\n\n\t\t/* scroll by the scrolling distance. */\n\t\t(*edp->emulops->copyrows)(edp->emulcookie, edp->scrolldist, 0,\n\t\t    edp->nrows - edp->scrolldist);\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    edp->nrows - edp->scrolldist, edp->scrolldist,\n\t\t\t\t\t   edp->curattr);\n\t\tedp->crow -= edp->scrolldist - 1;\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bzero",
          "args": [
            "edp->args",
            "sizeof (edp->args)"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tSUN_EMUL_STATE_CONTROL\t2\t/* processing ctl seq */\n\nstatic u_int\twsemul_sun_output_normal;\nstatic u_int\twsemul_sun_output_haveesc;\n\nstatic inline u_int\nwsemul_sun_output_haveesc(edp, c)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n{\n\tu_int newstate;\n\n\tswitch (c) {\n\tcase '[':\t\t/* continuation of multi-char sequence */\n\t\tbzero(edp->args, sizeof (edp->args));\n\t\tnewstate = SUN_EMUL_STATE_CONTROL;\n\t\tbreak;\n\n\tdefault:\n\t\t/* spit out the escape char (???), then the new character */\n\t\twsemul_sun_output_normal(edp, ASCII_ESC, 0);\t/* ??? */\n\t\tnewstate = wsemul_sun_output_normal(edp, c, 0);\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}"
  },
  {
    "function_name": "wsemul_sun_output_normal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsemul_sun.c",
    "lines": "228-327",
    "snippet": "static inline u_int\nwsemul_sun_output_normal(edp, c, kernel)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n\tint kernel;\n{\n\tu_int newstate = SUN_EMUL_STATE_NORMAL;\n\tu_int n;\n\n\tswitch (c) {\n\tcase ASCII_BEL:\t\t/* \"Bell (BEL)\" */\n\t\twsdisplay_emulbell(edp->cbcookie);\n\t\tbreak;\n\n\tcase ASCII_BS:\t\t/* \"Backspace (BS)\" */\n\t\tif (edp->ccol > 0)\n\t\t\tedp->ccol--;\n\t\tbreak;\n\n\tcase ASCII_CR:\t\t/* \"Return (CR)\" */\n\t\tedp->ccol = 0;\n\t\tbreak;\n\n\tcase ASCII_HT:\t\t/* \"Tab (TAB)\" */\n\t\tn = min(8 - (edp->ccol & 7), COLS_LEFT);\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t\t\tedp->ccol, n,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol += n;\n\t\tbreak;\n\n\tcase ASCII_FF:\t\t/* \"Form Feed (FF)\" */\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\t\t\t/* XXX possible in kernel output? */\n\t\tedp->ccol = 0;\n\t\tedp->crow = 0;\n\t\tbreak;\n\n\tcase ASCII_VT:\t\t/* \"Reverse Line Feed\" */\n\t\tif (edp->crow > 0)\n\t\t\tedp->crow--;\n\t\tbreak;\n\n\tcase ASCII_ESC:\t\t/* \"Escape (ESC)\" */\n#ifdef DIAGNOSTIC\n\t\tif (kernel)\n\t\t\tpanic(\"ESC in kernel output\");\n#endif\n\t\tif (edp->state == SUN_EMUL_STATE_NORMAL) {\n\t\t\tnewstate = SUN_EMUL_STATE_HAVEESC;\n\t\t\tbreak;\n\t\t}\n\t\t/* special case: fall through, we're printing one out */\n\t\t/* FALLTHRU */\n\n\tdefault:\t\t/* normal character */\n\t\t(*edp->emulops->putchar)(edp->emulcookie, edp->crow, edp->ccol,\n\t\t    c, kernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol++;\n\n\t\t/* if cur col is still on cur line, done. */\n\t\tif (edp->ccol < edp->ncols)\n\t\t\tbreak;\n\n\t\t/* wrap the column around. */\n\t\tedp->ccol = 0;\n\n               \t/* FALLTHRU */\n\n\tcase ASCII_LF:\t\t/* \"Line Feed (LF)\" */\n                /* if the cur line isn't the last, incr and leave. */\n\t\tif (edp->crow < edp->nrows - 1) {\n\t\t\tedp->crow++;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*\n\t\t * if we're in wrap-around mode, go to the first\n\t\t * line and clear it.\n\t\t */\n\t\tif (edp->scrolldist == 0) {\n\t\t\tedp->crow = 0;\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, 1,\n\t\t\t\t\t\t   edp->curattr);\n\t\t\tbreak;\n\t\t}\n\n\t\t/* scroll by the scrolling distance. */\n\t\t(*edp->emulops->copyrows)(edp->emulcookie, edp->scrolldist, 0,\n\t\t    edp->nrows - edp->scrolldist);\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    edp->nrows - edp->scrolldist, edp->scrolldist,\n\t\t\t\t\t   edp->curattr);\n\t\tedp->crow -= edp->scrolldist - 1;\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}",
    "includes": [
      "#include <dev/wscons/ascii.h>",
      "#include <dev/wscons/wsksymdef.h>",
      "#include <dev/wscons/wsemulvar.h>",
      "#include <dev/wscons/wsdisplayvar.h>",
      "#include <dev/wscons/wsconsio.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/malloc.h>",
      "#include <sys/time.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/cdefs.h>"
    ],
    "macros_used": [
      "#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)",
      "#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */",
      "#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */"
    ],
    "globals_used": [
      "static u_int\twsemul_sun_output_normal",
      "int ccol, crow;",
      "int ccol, crow;",
      "void *cbcookie;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->nrows - edp->scrolldist",
            "edp->scrolldist",
            "edp->curattr"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->scrolldist",
            "0",
            "edp->nrows - edp->scrolldist"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "0",
            "1",
            "edp->curattr"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "edp->ccol",
            "c",
            "kernel ? edp->kernattr : edp->curattr"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"ESC in kernel output\""
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "0",
            "edp->nrows",
            "kernel ? edp->kernattr : edp->curattr"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "edp->emulcookie",
            "edp->crow",
            "edp->ccol",
            "n",
            "kernel ? edp->kernattr : edp->curattr"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "min",
          "args": [
            "8 - (edp->ccol & 7)",
            "COLS_LEFT"
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "seq_do_timing",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/sequencer.c",
          "lines": "804-819",
          "snippet": "int\nseq_do_timing(sc, b)\n\tstruct sequencer_softc *sc;\n\tseq_event_rec *b;\n{\n\tunion {\n\t\tint32_t i;\n\t\tu_int8_t b[4];\n\t} u;\n\n\tu.b[0] = b->arr[4];\n\tu.b[1] = b->arr[5];\n\tu.b[2] = b->arr[6];\n\tu.b[3] = b->arr[7];\n\treturn (seq_timer(sc, SEQ_TCMD(b), u.i, b));\n}",
          "includes": [
            "#include \"midi.h\"",
            "#include <dev/sequencervar.h>",
            "#include <dev/midivar.h>",
            "#include <dev/midi_if.h>",
            "#include <sys/device.h>",
            "#include <sys/midiio.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/signalvar.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/proc.h>",
            "#include <sys/malloc.h>",
            "#include <sys/poll.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>",
            "#include \"sequencer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"midi.h\"\n#include <dev/sequencervar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/signalvar.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/proc.h>\n#include <sys/malloc.h>\n#include <sys/poll.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n#include \"sequencer.h\"\n\nint\nseq_do_timing(sc, b)\n\tstruct sequencer_softc *sc;\n\tseq_event_rec *b;\n{\n\tunion {\n\t\tint32_t i;\n\t\tu_int8_t b[4];\n\t} u;\n\n\tu.b[0] = b->arr[4];\n\tu.b[1] = b->arr[5];\n\tu.b[2] = b->arr[6];\n\tu.b[3] = b->arr[7];\n\treturn (seq_timer(sc, SEQ_TCMD(b), u.i, b));\n}"
        }
      },
      {
        "call_info": {
          "callee": "wsdisplay_emulbell",
          "args": [
            "edp->cbcookie"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "wsdisplay_emulbell",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/wscons/wsdisplay.c",
          "lines": "1249-1263",
          "snippet": "void\nwsdisplay_emulbell(v)\n\tvoid *v;\n{\n\tstruct wsscreen *scr = v;\n\n\tif (scr == NULL)\t\t/* console, before real attach */\n\t\treturn;\n\n\tif (scr->scr_flags & SCR_GRAPHICS) /* can this happen? */\n\t\treturn;\n\n\t(void) wsdisplay_internal_ioctl(scr->sc, scr, WSKBDIO_BELL, NULL,\n\t\t\t\t\tFWRITE, NULL);\n}",
          "includes": [
            "#include <dev/wscons/wsmuxvar.h>",
            "#include <dev/wscons/wseventvar.h>",
            "#include \"wsmux.h\"",
            "#include \"wskbd.h\"",
            "#include <dev/cons.h>",
            "#include <dev/wscons/wscons_callbacks.h>",
            "#include <dev/wscons/wsemulvar.h>",
            "#include <dev/wscons/wsksymdef.h>",
            "#include <dev/wscons/wsksymvar.h>",
            "#include <dev/wscons/wsdisplayvar.h>",
            "#include <dev/wscons/wsconsio.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/errno.h>",
            "#include <sys/signalvar.h>",
            "#include <sys/tty.h>",
            "#include <sys/systm.h>",
            "#include <sys/syslog.h>",
            "#include <sys/malloc.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/device.h>",
            "#include <sys/conf.h>",
            "#include <sys/param.h>",
            "#include <sys/cdefs.h>"
          ],
          "macros_used": [
            "#define SCR_GRAPHICS 4\t\t/* graphics mode, no text (emulation) output */"
          ],
          "globals_used": [
            "struct wsscreen *\nwsscreen_attach(sc, console, emul, type, cookie, ccol, crow, defattr)\n\tstruct wsdisplay_softc *sc;",
            "int console;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/wscons/wsmuxvar.h>\n#include <dev/wscons/wseventvar.h>\n#include \"wsmux.h\"\n#include \"wskbd.h\"\n#include <dev/cons.h>\n#include <dev/wscons/wscons_callbacks.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsksymvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/errno.h>\n#include <sys/signalvar.h>\n#include <sys/tty.h>\n#include <sys/systm.h>\n#include <sys/syslog.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/ioctl.h>\n#include <sys/device.h>\n#include <sys/conf.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define SCR_GRAPHICS 4\t\t/* graphics mode, no text (emulation) output */\n\nstruct wsscreen *\nwsscreen_attach(sc, console, emul, type, cookie, ccol, crow, defattr)\n\tstruct wsdisplay_softc *sc;\nint console;\n\nvoid\nwsdisplay_emulbell(v)\n\tvoid *v;\n{\n\tstruct wsscreen *scr = v;\n\n\tif (scr == NULL)\t\t/* console, before real attach */\n\t\treturn;\n\n\tif (scr->scr_flags & SCR_GRAPHICS) /* can this happen? */\n\t\treturn;\n\n\t(void) wsdisplay_internal_ioctl(scr->sc, scr, WSKBDIO_BELL, NULL,\n\t\t\t\t\tFWRITE, NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/wscons/ascii.h>\n#include <dev/wscons/wsksymdef.h>\n#include <dev/wscons/wsemulvar.h>\n#include <dev/wscons/wsdisplayvar.h>\n#include <dev/wscons/wsconsio.h>\n#include <sys/fcntl.h>\n#include <sys/malloc.h>\n#include <sys/time.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/cdefs.h>\n\n#define\tCOLS_LEFT\t\t(edp->ncols - edp->ccol - 1)\n#define\tSUN_EMUL_STATE_HAVEESC\t1\t/* seen start of ctl seq */\n#define\tSUN_EMUL_STATE_NORMAL\t0\t/* normal processing */\n\nstatic u_int\twsemul_sun_output_normal;\nint ccol, crow;\nint ccol, crow;\nvoid *cbcookie;\n\nstatic inline u_int\nwsemul_sun_output_normal(edp, c, kernel)\n\tstruct wsemul_sun_emuldata *edp;\n\tu_char c;\n\tint kernel;\n{\n\tu_int newstate = SUN_EMUL_STATE_NORMAL;\n\tu_int n;\n\n\tswitch (c) {\n\tcase ASCII_BEL:\t\t/* \"Bell (BEL)\" */\n\t\twsdisplay_emulbell(edp->cbcookie);\n\t\tbreak;\n\n\tcase ASCII_BS:\t\t/* \"Backspace (BS)\" */\n\t\tif (edp->ccol > 0)\n\t\t\tedp->ccol--;\n\t\tbreak;\n\n\tcase ASCII_CR:\t\t/* \"Return (CR)\" */\n\t\tedp->ccol = 0;\n\t\tbreak;\n\n\tcase ASCII_HT:\t\t/* \"Tab (TAB)\" */\n\t\tn = min(8 - (edp->ccol & 7), COLS_LEFT);\n\t\t(*edp->emulops->erasecols)(edp->emulcookie, edp->crow,\n\t\t\t\tedp->ccol, n,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol += n;\n\t\tbreak;\n\n\tcase ASCII_FF:\t\t/* \"Form Feed (FF)\" */\n\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, edp->nrows,\n\t\t\t\tkernel ? edp->kernattr : edp->curattr);\n\t\t\t\t/* XXX possible in kernel output? */\n\t\tedp->ccol = 0;\n\t\tedp->crow = 0;\n\t\tbreak;\n\n\tcase ASCII_VT:\t\t/* \"Reverse Line Feed\" */\n\t\tif (edp->crow > 0)\n\t\t\tedp->crow--;\n\t\tbreak;\n\n\tcase ASCII_ESC:\t\t/* \"Escape (ESC)\" */\n#ifdef DIAGNOSTIC\n\t\tif (kernel)\n\t\t\tpanic(\"ESC in kernel output\");\n#endif\n\t\tif (edp->state == SUN_EMUL_STATE_NORMAL) {\n\t\t\tnewstate = SUN_EMUL_STATE_HAVEESC;\n\t\t\tbreak;\n\t\t}\n\t\t/* special case: fall through, we're printing one out */\n\t\t/* FALLTHRU */\n\n\tdefault:\t\t/* normal character */\n\t\t(*edp->emulops->putchar)(edp->emulcookie, edp->crow, edp->ccol,\n\t\t    c, kernel ? edp->kernattr : edp->curattr);\n\t\tedp->ccol++;\n\n\t\t/* if cur col is still on cur line, done. */\n\t\tif (edp->ccol < edp->ncols)\n\t\t\tbreak;\n\n\t\t/* wrap the column around. */\n\t\tedp->ccol = 0;\n\n               \t/* FALLTHRU */\n\n\tcase ASCII_LF:\t\t/* \"Line Feed (LF)\" */\n                /* if the cur line isn't the last, incr and leave. */\n\t\tif (edp->crow < edp->nrows - 1) {\n\t\t\tedp->crow++;\n\t\t\tbreak;\n\t\t}\n\n\t\t/*\n\t\t * if we're in wrap-around mode, go to the first\n\t\t * line and clear it.\n\t\t */\n\t\tif (edp->scrolldist == 0) {\n\t\t\tedp->crow = 0;\n\t\t\t(*edp->emulops->eraserows)(edp->emulcookie, 0, 1,\n\t\t\t\t\t\t   edp->curattr);\n\t\t\tbreak;\n\t\t}\n\n\t\t/* scroll by the scrolling distance. */\n\t\t(*edp->emulops->copyrows)(edp->emulcookie, edp->scrolldist, 0,\n\t\t    edp->nrows - edp->scrolldist);\n\t\t(*edp->emulops->eraserows)(edp->emulcookie,\n\t\t    edp->nrows - edp->scrolldist, edp->scrolldist,\n\t\t\t\t\t   edp->curattr);\n\t\tedp->crow -= edp->scrolldist - 1;\n\t\tbreak;\n\t}\n\n\treturn (newstate);\n}"
  }
]