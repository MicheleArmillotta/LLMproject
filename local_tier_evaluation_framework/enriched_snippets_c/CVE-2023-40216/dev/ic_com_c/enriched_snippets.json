[
  {
    "function_name": "comcnpollc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1818-1824",
    "snippet": "void\ncomcnpollc(dev, on)\n\tdev_t dev;\n\tint on;\n{\n\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct tty *\ncomtty(dev)\n\tdev_t dev;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\n\nvoid\ncomcnpollc(dev, on)\n\tdev_t dev;\n\tint on;\n{\n\n}"
  },
  {
    "function_name": "comcnputc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1784-1816",
    "snippet": "void\ncomcnputc(dev, c)\n\tdev_t dev;\n\tint c;\n{\n\tint s = splhigh();\n\tbus_space_tag_t iot = comconsiot;\n\tbus_space_handle_t ioh = comconsioh;\n\tu_char stat;\n\tregister int timo;\n\n#ifdef KGDB\n\tif (dev != kgdb_dev)\n#endif\n\tif (comconsinit == 0) {\n\t\tcominit(iot, ioh, comdefaultrate);\n\t\tcomconsinit = 1;\n\t}\n\t/* wait for any pending transmission to finish */\n\ttimo = 50000;\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_TXRDY) && --timo)\n\t\t;\n\tbus_space_write_1(iot, ioh, com_data, c);\n\t/* wait for this transmission to complete */\n\ttimo = 1500000;\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_TXRDY) && --timo)\n\t\t;\n#if 0 /* I don't think sooooo (pefo) */\n\t/* clear any interrupts generated by this transmission */\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n#endif\n\tsplx(s);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tcomconsinit;",
      "bus_space_tag_t comconsiot;",
      "bus_space_handle_t comconsioh;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_iir"
          ],
          "line": 1813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "stat = bus_space_read_1(iot, ioh, com_lsr)",
            "LSR_TXRDY"
          ],
          "line": 1809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_lsr"
          ],
          "line": 1809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_data",
            "c"
          ],
          "line": 1806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "stat = bus_space_read_1(iot, ioh, com_lsr)",
            "LSR_TXRDY"
          ],
          "line": 1804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_lsr"
          ],
          "line": 1804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cominit",
          "args": [
            "iot",
            "ioh",
            "comdefaultrate"
          ],
          "line": 1799
        },
        "resolved": true,
        "details": {
          "function_name": "cominit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "1744-1762",
          "snippet": "void\ncominit(iot, ioh, rate)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint rate;\n{\n\tint s = splhigh();\n\tu_char stat;\n\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_DLAB);\n\trate = comspeed(comdefaultrate);\n\tbus_space_write_1(iot, ioh, com_dlbl, rate);\n\tbus_space_write_1(iot, ioh, com_dlbh, rate >> 8);\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_8BITS);\n\tbus_space_write_1(iot, ioh, com_ier, IER_ERXRDY | IER_ETXRDY);\n\tbus_space_write_1(iot, ioh, com_fifo, FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nvoid\ncominit(iot, ioh, rate)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint rate;\n{\n\tint s = splhigh();\n\tu_char stat;\n\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_DLAB);\n\trate = comspeed(comdefaultrate);\n\tbus_space_write_1(iot, ioh, com_dlbl, rate);\n\tbus_space_write_1(iot, ioh, com_dlbh, rate >> 8);\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_8BITS);\n\tbus_space_write_1(iot, ioh, com_ier, IER_ERXRDY | IER_ETXRDY);\n\tbus_space_write_1(iot, ioh, com_fifo, FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "splhigh",
          "args": [],
          "line": 1789
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\tcomconsinit;\nbus_space_tag_t comconsiot;\nbus_space_handle_t comconsioh;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nvoid\ncomcnputc(dev, c)\n\tdev_t dev;\n\tint c;\n{\n\tint s = splhigh();\n\tbus_space_tag_t iot = comconsiot;\n\tbus_space_handle_t ioh = comconsioh;\n\tu_char stat;\n\tregister int timo;\n\n#ifdef KGDB\n\tif (dev != kgdb_dev)\n#endif\n\tif (comconsinit == 0) {\n\t\tcominit(iot, ioh, comdefaultrate);\n\t\tcomconsinit = 1;\n\t}\n\t/* wait for any pending transmission to finish */\n\ttimo = 50000;\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_TXRDY) && --timo)\n\t\t;\n\tbus_space_write_1(iot, ioh, com_data, c);\n\t/* wait for this transmission to complete */\n\ttimo = 1500000;\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_TXRDY) && --timo)\n\t\t;\n#if 0 /* I don't think sooooo (pefo) */\n\t/* clear any interrupts generated by this transmission */\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n#endif\n\tsplx(s);\n}"
  },
  {
    "function_name": "comcngetc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1764-1779",
    "snippet": "int\ncomcngetc(dev)\n\tdev_t dev;\n{\n\tint s = splhigh();\n\tbus_space_tag_t iot = comconsiot;\n\tbus_space_handle_t ioh = comconsioh;\n\tu_char stat, c;\n\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_RXRDY))\n\t\t;\n\tc = bus_space_read_1(iot, ioh, com_data);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n\treturn c;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "bus_space_tag_t comconsiot;",
      "bus_space_handle_t comconsioh;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_iir"
          ],
          "line": 1776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_data"
          ],
          "line": 1775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "stat = bus_space_read_1(iot, ioh, com_lsr)",
            "LSR_RXRDY"
          ],
          "line": 1773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_lsr"
          ],
          "line": 1773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splhigh",
          "args": [],
          "line": 1768
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nbus_space_tag_t comconsiot;\nbus_space_handle_t comconsioh;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomcngetc(dev)\n\tdev_t dev;\n{\n\tint s = splhigh();\n\tbus_space_tag_t iot = comconsiot;\n\tbus_space_handle_t ioh = comconsioh;\n\tu_char stat, c;\n\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_RXRDY))\n\t\t;\n\tc = bus_space_read_1(iot, ioh, com_data);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n\treturn c;\n}"
  },
  {
    "function_name": "cominit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1744-1762",
    "snippet": "void\ncominit(iot, ioh, rate)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint rate;\n{\n\tint s = splhigh();\n\tu_char stat;\n\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_DLAB);\n\trate = comspeed(comdefaultrate);\n\tbus_space_write_1(iot, ioh, com_dlbl, rate);\n\tbus_space_write_1(iot, ioh, com_dlbh, rate >> 8);\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_8BITS);\n\tbus_space_write_1(iot, ioh, com_ier, IER_ERXRDY | IER_ETXRDY);\n\tbus_space_write_1(iot, ioh, com_fifo, FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tcom_lcr\tcom_cfcr"
    ],
    "globals_used": [
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1761
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_iir"
          ],
          "line": 1760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4"
          ],
          "line": 1759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "IER_ERXRDY | IER_ETXRDY"
          ],
          "line": 1758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "LCR_8BITS"
          ],
          "line": 1757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_dlbh",
            "rate >> 8"
          ],
          "line": 1756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_dlbl",
            "rate"
          ],
          "line": 1755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comspeed",
          "args": [
            "comdefaultrate"
          ],
          "line": 1754
        },
        "resolved": true,
        "details": {
          "function_name": "comspeed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "195-218",
          "snippet": "int\ncomspeed(speed)\n\tlong speed;\n{\n#define\tdivrnd(n, q)\t(((n)*2/(q)+1)/2)\t/* divide and round off */\n\n\tint x, err;\n\n\tif (speed == 0)\n\t\treturn 0;\n\tif (speed < 0)\n\t\treturn -1;\n\tx = divrnd((COM_FREQ / 16), speed);\n\tif (x <= 0)\n\t\treturn -1;\n\terr = divrnd((COM_FREQ / 16) * 1000, speed * x) - 1000;\n\tif (err < 0)\n\t\terr = -err;\n\tif (err > COM_TOLERANCE)\n\t\treturn -1;\n\treturn x;\n\n#undef\tdivrnd(n, q)\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\ncomspeed(speed)\n\tlong speed;\n{\n#define\tdivrnd(n, q)\t(((n)*2/(q)+1)/2)\t/* divide and round off */\n\n\tint x, err;\n\n\tif (speed == 0)\n\t\treturn 0;\n\tif (speed < 0)\n\t\treturn -1;\n\tx = divrnd((COM_FREQ / 16), speed);\n\tif (x <= 0)\n\t\treturn -1;\n\terr = divrnd((COM_FREQ / 16) * 1000, speed * x) - 1000;\n\tif (err < 0)\n\t\terr = -err;\n\tif (err > COM_TOLERANCE)\n\t\treturn -1;\n\treturn x;\n\n#undef\tdivrnd(n, q)\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "LCR_DLAB"
          ],
          "line": 1753
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splhigh",
          "args": [],
          "line": 1750
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nvoid\ncominit(iot, ioh, rate)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint rate;\n{\n\tint s = splhigh();\n\tu_char stat;\n\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_DLAB);\n\trate = comspeed(comdefaultrate);\n\tbus_space_write_1(iot, ioh, com_dlbl, rate);\n\tbus_space_write_1(iot, ioh, com_dlbh, rate >> 8);\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_8BITS);\n\tbus_space_write_1(iot, ioh, com_ier, IER_ERXRDY | IER_ETXRDY);\n\tbus_space_write_1(iot, ioh, com_fifo, FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n}"
  },
  {
    "function_name": "comcninit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1731-1742",
    "snippet": "void\ncomcninit(cp)\n\tstruct consdev *cp;\n{\n\n\tif (bus_space_map(comconsiot, CONADDR, COM_NPORTS, 0, &comconsioh))\n\t\tpanic(\"comcninit: mapping failed\");\n\n\tcominit(comconsiot, comconsioh, comdefaultrate);\n\tcomconsaddr = CONADDR;\n\tcomconsinit = 0;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tcomconsaddr;",
      "int\tcomconsinit;",
      "bus_space_tag_t comconsiot;",
      "bus_space_handle_t comconsioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "cominit",
          "args": [
            "comconsiot",
            "comconsioh",
            "comdefaultrate"
          ],
          "line": 1739
        },
        "resolved": true,
        "details": {
          "function_name": "cominit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "1744-1762",
          "snippet": "void\ncominit(iot, ioh, rate)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint rate;\n{\n\tint s = splhigh();\n\tu_char stat;\n\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_DLAB);\n\trate = comspeed(comdefaultrate);\n\tbus_space_write_1(iot, ioh, com_dlbl, rate);\n\tbus_space_write_1(iot, ioh, com_dlbh, rate >> 8);\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_8BITS);\n\tbus_space_write_1(iot, ioh, com_ier, IER_ERXRDY | IER_ETXRDY);\n\tbus_space_write_1(iot, ioh, com_fifo, FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nvoid\ncominit(iot, ioh, rate)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint rate;\n{\n\tint s = splhigh();\n\tu_char stat;\n\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_DLAB);\n\trate = comspeed(comdefaultrate);\n\tbus_space_write_1(iot, ioh, com_dlbl, rate);\n\tbus_space_write_1(iot, ioh, com_dlbh, rate >> 8);\n\tbus_space_write_1(iot, ioh, com_lcr, LCR_8BITS);\n\tbus_space_write_1(iot, ioh, com_ier, IER_ERXRDY | IER_ETXRDY);\n\tbus_space_write_1(iot, ioh, com_fifo, FIFO_ENABLE | FIFO_RCV_RST | FIFO_XMT_RST | FIFO_TRIGGER_4);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"comcninit: mapping failed\""
          ],
          "line": 1737
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "comconsiot",
            "CONADDR",
            "COM_NPORTS",
            "0",
            "&comconsioh"
          ],
          "line": 1736
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\tcomconsaddr;\nint\tcomconsinit;\nbus_space_tag_t comconsiot;\nbus_space_handle_t comconsioh;\n\nvoid\ncomcninit(cp)\n\tstruct consdev *cp;\n{\n\n\tif (bus_space_map(comconsiot, CONADDR, COM_NPORTS, 0, &comconsioh))\n\t\tpanic(\"comcninit: mapping failed\");\n\n\tcominit(comconsiot, comconsioh, comdefaultrate);\n\tcomconsaddr = CONADDR;\n\tcomconsinit = 0;\n}"
  },
  {
    "function_name": "comcnprobe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1683-1729",
    "snippet": "void\ncomcnprobe(cp)\n\tstruct consdev *cp;\n{\n\t/* XXX NEEDS TO BE FIXED XXX */\n#if defined(arc)\n\tbus_space_tag_t iot = &arc_bus_io;\n#elif defined(powerpc)\n\tbus_space_tag_t iot = &ppc_isa_io;\n#elif defined(hppa)\n\tbus_space_tag_t iot = &hppa_bustag;\n#else\n\tbus_space_tag_t iot = 0;\n#endif\n\tbus_space_handle_t ioh;\n\tint found;\n\n\tif(CONADDR == 0) {\n\t\tcp->cn_pri = CN_DEAD;\n\t\treturn;\n\t}\n\n\tcomconsiot = iot;\n\tif (bus_space_map(iot, CONADDR, COM_NPORTS, 0, &ioh)) {\n\t\tcp->cn_pri = CN_DEAD;\n\t\treturn;\n\t}\n\tfound = comprobe1(iot, ioh);\n\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\tif (!found) {\n\t\tcp->cn_pri = CN_DEAD;\n\t\treturn;\n\t}\n\n\t/* locate the major number */\n\tfor (commajor = 0; commajor < nchrdev; commajor++)\n\t\tif (cdevsw[commajor].d_open == comopen)\n\t\t\tbreak;\n\n\t/* initialize required fields */\n\tcp->cn_dev = makedev(commajor, CONUNIT);\n#ifdef\tCOMCONSOLE\n\tcp->cn_pri = CN_REMOTE;\t\t/* Force a serial port console */\n#else\n\tcp->cn_pri = CN_NORMAL;\n#endif\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "bus_space_tag_t comconsiot;",
      "int\tcommajor;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "makedev",
          "args": [
            "commajor",
            "CONUNIT"
          ],
          "line": 1723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_unmap",
          "args": [
            "iot",
            "ioh",
            "COM_NPORTS"
          ],
          "line": 1711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comprobe1",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1710
        },
        "resolved": true,
        "details": {
          "function_name": "comprobe1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "220-241",
          "snippet": "int\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "CONADDR",
            "COM_NPORTS",
            "0",
            "&ioh"
          ],
          "line": 1706
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nbus_space_tag_t comconsiot;\nint\tcommajor;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nvoid\ncomcnprobe(cp)\n\tstruct consdev *cp;\n{\n\t/* XXX NEEDS TO BE FIXED XXX */\n#if defined(arc)\n\tbus_space_tag_t iot = &arc_bus_io;\n#elif defined(powerpc)\n\tbus_space_tag_t iot = &ppc_isa_io;\n#elif defined(hppa)\n\tbus_space_tag_t iot = &hppa_bustag;\n#else\n\tbus_space_tag_t iot = 0;\n#endif\n\tbus_space_handle_t ioh;\n\tint found;\n\n\tif(CONADDR == 0) {\n\t\tcp->cn_pri = CN_DEAD;\n\t\treturn;\n\t}\n\n\tcomconsiot = iot;\n\tif (bus_space_map(iot, CONADDR, COM_NPORTS, 0, &ioh)) {\n\t\tcp->cn_pri = CN_DEAD;\n\t\treturn;\n\t}\n\tfound = comprobe1(iot, ioh);\n\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\tif (!found) {\n\t\tcp->cn_pri = CN_DEAD;\n\t\treturn;\n\t}\n\n\t/* locate the major number */\n\tfor (commajor = 0; commajor < nchrdev; commajor++)\n\t\tif (cdevsw[commajor].d_open == comopen)\n\t\t\tbreak;\n\n\t/* initialize required fields */\n\tcp->cn_dev = makedev(commajor, CONUNIT);\n#ifdef\tCOMCONSOLE\n\tcp->cn_pri = CN_REMOTE;\t\t/* Force a serial port console */\n#else\n\tcp->cn_pri = CN_NORMAL;\n#endif\n}"
  },
  {
    "function_name": "compoll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1430-1508",
    "snippet": "void\ncompoll(arg)\n\tvoid *arg;\n{\n\tint unit;\n\tstruct com_softc *sc;\n\tstruct tty *tp;\n\tregister u_char *ibufp;\n\tu_char *ibufend;\n\tregister int c;\n\tint s;\n\tstatic int lsrmap[8] = {\n\t\t0,      TTY_PE,\n\t\tTTY_FE, TTY_PE|TTY_FE,\n\t\tTTY_FE, TTY_PE|TTY_FE,\n\t\tTTY_FE, TTY_PE|TTY_FE\n\t};\n\n\ts = spltty();\n\tif (comevents == 0) {\n\t\tsplx(s);\n\t\tgoto out;\n\t}\n\tcomevents = 0;\n\tsplx(s);\n\n\tfor (unit = 0; unit < com_cd.cd_ndevs; unit++) {\n\t\tsc = com_cd.cd_devs[unit];\n\t\tif (sc == 0 || sc->sc_ibufp == sc->sc_ibuf)\n\t\t\tcontinue;\n\n\t\ttp = sc->sc_tty;\n\n\t\ts = spltty();\n\n\t\tibufp = sc->sc_ibuf;\n\t\tibufend = sc->sc_ibufp;\n\n\t\tif (ibufp == ibufend) {\n\t\t\tsplx(s);\n\t\t\tcontinue;\n\t\t}\n\n\t\tsc->sc_ibufp = sc->sc_ibuf = (ibufp == sc->sc_ibufs[0]) ?\n\t\t\t\t\t     sc->sc_ibufs[1] : sc->sc_ibufs[0];\n\t\tsc->sc_ibufhigh = sc->sc_ibuf + COM_IHIGHWATER;\n\t\tsc->sc_ibufend = sc->sc_ibuf + COM_IBUFSIZE;\n\n\t\tif (tp == 0 || !ISSET(tp->t_state, TS_ISOPEN)) {\n\t\t\tsplx(s);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (ISSET(tp->t_cflag, CRTSCTS) &&\n\t\t    !ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t/* XXX */\n\t\t\tSET(sc->sc_mcr, MCR_RTS);\n\t\t\tbus_space_write_1(sc->sc_iot, sc->sc_ioh, com_mcr,\n\t\t\t    sc->sc_mcr);\n\t\t}\n\n\t\tsplx(s);\n\n\t\twhile (ibufp < ibufend) {\n\t\t\tc = *ibufp++;\n\t\t\tif (*ibufp & LSR_OE) {\n\t\t\t\tsc->sc_overflows++;\n\t\t\t\tif (sc->sc_errors++ == 0)\n\t\t\t\t\ttimeout(comdiag, sc, 60 * hz);\n\t\t\t}\n\t\t\t/* This is ugly, but fast. */\n\t\t\tc |= lsrmap[(*ibufp++ & (LSR_BI|LSR_FE|LSR_PE)) >> 2];\n\t\t\t(*linesw[tp->t_line].l_rint)(c, tp);\n\t\t}\n\t}\n\nout:\n\ttimeout(compoll, NULL, 1);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "int\tcomevents = 0;",
      "struct com_softc *sc = (void *)self;",
      "void *arg;",
      "struct com_softc *sc = arg;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "timeout",
          "args": [
            "compoll",
            "NULL",
            "1"
          ],
          "line": 1507
        },
        "resolved": true,
        "details": {
          "function_name": "wdctimeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/wdc.c",
          "lines": "952-980",
          "snippet": "void\nwdctimeout(arg)\n\tvoid *arg;\n{\n\tstruct channel_softc *chp = (struct channel_softc *)arg;\n\tstruct wdc_xfer *xfer = chp->ch_queue->sc_xfer.tqh_first;\n\tint s;\n\n\tWDCDEBUG_PRINT((\"wdctimeout\\n\"), DEBUG_FUNCS);\n\n\ts = splbio();\n\tif ((chp->ch_flags & WDCF_IRQ_WAIT) != 0) {\n\t\t__wdcerror(chp, \"timeout\");\n\t\tprintf(\"\\ttype: %s\\n\", (xfer->c_flags & C_ATAPI) ?\n\t\t    \"atapi\":\"ata\");\n\t\tprintf(\"\\tc_bcount: %d\\n\", xfer->c_bcount);\n\t\tprintf(\"\\tc_skip: %d\\n\", xfer->c_skip);\n\t\t/*\n\t\t * Call the interrupt routine. If we just missed and interrupt,\n\t\t * it will do what's needed. Else, it will take the needed\n\t\t * action (reset the device).\n\t\t */\n\t\txfer->c_flags |= C_TIMEOU;\n\t\tchp->ch_flags &= ~WDCF_IRQ_WAIT;\n\t\txfer->c_intr(chp, xfer, 1);\n\t} else\n\t\t__wdcerror(chp, \"missing untimeout\");\n\tsplx(s);\n}",
          "includes": [
            "#include \"atapiscsi.h\"",
            "#include <dev/ic/wdcvar.h>",
            "#include <dev/ic/wdcreg.h>",
            "#include <dev/ata/atareg.h>",
            "#include <dev/ata/atavar.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <vm/vm.h>",
            "#include <sys/proc.h>",
            "#include <sys/syslog.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/buf.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define DEBUG_FUNCS  0x08"
          ],
          "globals_used": [
            "static void  __wdcerror"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"atapiscsi.h\"\n#include <dev/ic/wdcvar.h>\n#include <dev/ic/wdcreg.h>\n#include <dev/ata/atareg.h>\n#include <dev/ata/atavar.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <vm/vm.h>\n#include <sys/proc.h>\n#include <sys/syslog.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/buf.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define DEBUG_FUNCS  0x08\n\nstatic void  __wdcerror;\n\nvoid\nwdctimeout(arg)\n\tvoid *arg;\n{\n\tstruct channel_softc *chp = (struct channel_softc *)arg;\n\tstruct wdc_xfer *xfer = chp->ch_queue->sc_xfer.tqh_first;\n\tint s;\n\n\tWDCDEBUG_PRINT((\"wdctimeout\\n\"), DEBUG_FUNCS);\n\n\ts = splbio();\n\tif ((chp->ch_flags & WDCF_IRQ_WAIT) != 0) {\n\t\t__wdcerror(chp, \"timeout\");\n\t\tprintf(\"\\ttype: %s\\n\", (xfer->c_flags & C_ATAPI) ?\n\t\t    \"atapi\":\"ata\");\n\t\tprintf(\"\\tc_bcount: %d\\n\", xfer->c_bcount);\n\t\tprintf(\"\\tc_skip: %d\\n\", xfer->c_skip);\n\t\t/*\n\t\t * Call the interrupt routine. If we just missed and interrupt,\n\t\t * it will do what's needed. Else, it will take the needed\n\t\t * action (reset the device).\n\t\t */\n\t\txfer->c_flags |= C_TIMEOU;\n\t\tchp->ch_flags &= ~WDCF_IRQ_WAIT;\n\t\txfer->c_intr(chp, xfer, 1);\n\t} else\n\t\t__wdcerror(chp, \"missing untimeout\");\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "c",
            "tp"
          ],
          "line": 1502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "sc->sc_iot",
            "sc->sc_ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "MCR_RTS"
          ],
          "line": 1486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_mcr",
            "MCR_RTS"
          ],
          "line": 1484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_cflag",
            "CRTSCTS"
          ],
          "line": 1483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_ISOPEN"
          ],
          "line": 1478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 1463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 1448
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nint\tcomevents = 0;\nstruct com_softc *sc = (void *)self;\nvoid *arg;\nstruct com_softc *sc = arg;\nstruct tty *tp;\n\nvoid\ncompoll(arg)\n\tvoid *arg;\n{\n\tint unit;\n\tstruct com_softc *sc;\n\tstruct tty *tp;\n\tregister u_char *ibufp;\n\tu_char *ibufend;\n\tregister int c;\n\tint s;\n\tstatic int lsrmap[8] = {\n\t\t0,      TTY_PE,\n\t\tTTY_FE, TTY_PE|TTY_FE,\n\t\tTTY_FE, TTY_PE|TTY_FE,\n\t\tTTY_FE, TTY_PE|TTY_FE\n\t};\n\n\ts = spltty();\n\tif (comevents == 0) {\n\t\tsplx(s);\n\t\tgoto out;\n\t}\n\tcomevents = 0;\n\tsplx(s);\n\n\tfor (unit = 0; unit < com_cd.cd_ndevs; unit++) {\n\t\tsc = com_cd.cd_devs[unit];\n\t\tif (sc == 0 || sc->sc_ibufp == sc->sc_ibuf)\n\t\t\tcontinue;\n\n\t\ttp = sc->sc_tty;\n\n\t\ts = spltty();\n\n\t\tibufp = sc->sc_ibuf;\n\t\tibufend = sc->sc_ibufp;\n\n\t\tif (ibufp == ibufend) {\n\t\t\tsplx(s);\n\t\t\tcontinue;\n\t\t}\n\n\t\tsc->sc_ibufp = sc->sc_ibuf = (ibufp == sc->sc_ibufs[0]) ?\n\t\t\t\t\t     sc->sc_ibufs[1] : sc->sc_ibufs[0];\n\t\tsc->sc_ibufhigh = sc->sc_ibuf + COM_IHIGHWATER;\n\t\tsc->sc_ibufend = sc->sc_ibuf + COM_IBUFSIZE;\n\n\t\tif (tp == 0 || !ISSET(tp->t_state, TS_ISOPEN)) {\n\t\t\tsplx(s);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (ISSET(tp->t_cflag, CRTSCTS) &&\n\t\t    !ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t/* XXX */\n\t\t\tSET(sc->sc_mcr, MCR_RTS);\n\t\t\tbus_space_write_1(sc->sc_iot, sc->sc_ioh, com_mcr,\n\t\t\t    sc->sc_mcr);\n\t\t}\n\n\t\tsplx(s);\n\n\t\twhile (ibufp < ibufend) {\n\t\t\tc = *ibufp++;\n\t\t\tif (*ibufp & LSR_OE) {\n\t\t\t\tsc->sc_overflows++;\n\t\t\t\tif (sc->sc_errors++ == 0)\n\t\t\t\t\ttimeout(comdiag, sc, 60 * hz);\n\t\t\t}\n\t\t\t/* This is ugly, but fast. */\n\t\t\tc |= lsrmap[(*ibufp++ & (LSR_BI|LSR_FE|LSR_PE)) >> 2];\n\t\t\t(*linesw[tp->t_line].l_rint)(c, tp);\n\t\t}\n\t}\n\nout:\n\ttimeout(compoll, NULL, 1);\n}"
  },
  {
    "function_name": "comdiag",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1408-1428",
    "snippet": "void\ncomdiag(arg)\n\tvoid *arg;\n{\n\tstruct com_softc *sc = arg;\n\tint overflows, floods;\n\tint s;\n\n\ts = spltty();\n\tsc->sc_errors = 0;\n\toverflows = sc->sc_overflows;\n\tsc->sc_overflows = 0;\n\tfloods = sc->sc_floods;\n\tsc->sc_floods = 0;\n\tsplx(s);\n\n\tlog(LOG_WARNING, \"%s: %d silo overflow%s, %d ibuf overflow%s\\n\",\n\t    sc->sc_dev.dv_xname,\n\t    overflows, overflows == 1 ? \"\" : \"s\",\n\t    floods, floods == 1 ? \"\" : \"s\");\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct com_softc *sc = (void *)self;",
      "void *arg;",
      "struct com_softc *sc = arg;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "log",
          "args": [
            "LOG_WARNING",
            "\"%s: %d silo overflow%s, %d ibuf overflow%s\\n\"",
            "sc->sc_dev.dv_xname",
            "overflows",
            "overflows == 1 ? \"\" : \"s\"",
            "floods",
            "floods == 1 ? \"\" : \"s\""
          ],
          "line": 1424
        },
        "resolved": true,
        "details": {
          "function_name": "tcic_log2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/tcic2.c",
          "lines": "1387-1401",
          "snippet": "int\ntcic_log2(val)\n\tu_int val;\n{\n\tint i, l2;\n\n\tl2 = i = 0;\n\twhile (val) {\n\t\tif (val & 1)\n\t\t\tl2 = i;\n\t\ti++;\n\t\tval >>= 1;\n\t}\n\treturn l2;\n}",
          "includes": [
            "#include <dev/ic/tcic2var.h>",
            "#include <dev/ic/tcic2reg.h>",
            "#include <dev/pcmcia/pcmciavar.h>",
            "#include <dev/pcmcia/pcmciareg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/kthread.h>",
            "#include <sys/malloc.h>",
            "#include <sys/extent.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/tcic2var.h>\n#include <dev/ic/tcic2reg.h>\n#include <dev/pcmcia/pcmciavar.h>\n#include <dev/pcmcia/pcmciareg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/kthread.h>\n#include <sys/malloc.h>\n#include <sys/extent.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\ntcic_log2(val)\n\tu_int val;\n{\n\tint i, l2;\n\n\tl2 = i = 0;\n\twhile (val) {\n\t\tif (val & 1)\n\t\t\tl2 = i;\n\t\ti++;\n\t\tval >>= 1;\n\t}\n\treturn l2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 1416
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct com_softc *sc = (void *)self;\nvoid *arg;\nstruct com_softc *sc = arg;\n\nvoid\ncomdiag(arg)\n\tvoid *arg;\n{\n\tstruct com_softc *sc = arg;\n\tint overflows, floods;\n\tint s;\n\n\ts = spltty();\n\tsc->sc_errors = 0;\n\toverflows = sc->sc_overflows;\n\tsc->sc_overflows = 0;\n\tfloods = sc->sc_floods;\n\tsc->sc_floods = 0;\n\tsplx(s);\n\n\tlog(LOG_WARNING, \"%s: %d silo overflow%s, %d ibuf overflow%s\\n\",\n\t    sc->sc_dev.dv_xname,\n\t    overflows, overflows == 1 ? \"\" : \"s\",\n\t    floods, floods == 1 ? \"\" : \"s\");\n}"
  },
  {
    "function_name": "comstop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1393-1406",
    "snippet": "int\ncomstop(tp, flag)\n\tstruct tty *tp;\n\tint flag;\n{\n\tint s;\n\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_BUSY))\n\t\tif (!ISSET(tp->t_state, TS_TTSTOP))\n\t\t\tSET(tp->t_state, TS_FLUSH);\n\tsplx(s);\n\treturn 0;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_state",
            "TS_FLUSH"
          ],
          "line": 1403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_TTSTOP"
          ],
          "line": 1402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_BUSY"
          ],
          "line": 1401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 1400
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct tty *tp;\n\nint\ncomstop(tp, flag)\n\tstruct tty *tp;\n\tint flag;\n{\n\tint s;\n\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_BUSY))\n\t\tif (!ISSET(tp->t_state, TS_TTSTOP))\n\t\t\tSET(tp->t_state, TS_FLUSH);\n\tsplx(s);\n\treturn 0;\n}"
  },
  {
    "function_name": "comstart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1335-1388",
    "snippet": "void\ncomstart(tp)\n\tstruct tty *tp;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_BUSY))\n\t\tgoto out;\n\tif (ISSET(tp->t_state, TS_TIMEOUT | TS_TTSTOP) || sc->sc_halt > 0)\n\t\tgoto stopped;\n\tif (ISSET(tp->t_cflag, CRTSCTS) && !ISSET(sc->sc_msr, MSR_CTS))\n\t\tgoto stopped;\n\tif (tp->t_outq.c_cc <= tp->t_lowat) {\n\t\tif (ISSET(tp->t_state, TS_ASLEEP)) {\n\t\t\tCLR(tp->t_state, TS_ASLEEP);\n\t\t\twakeup(&tp->t_outq);\n\t\t}\n\t\tif (tp->t_outq.c_cc == 0)\n\t\t\tgoto stopped;\n\t\tselwakeup(&tp->t_wsel);\n\t}\n\tSET(tp->t_state, TS_BUSY);\n\n\tif (!ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tSET(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tif (ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n#ifdef COM_HAYESP\n\t\tu_char buffer[1024];\t/* XXX: largest fifo */\n#else\n\t\tu_char buffer[64];\t/* XXX: largest fifo */\n#endif\n\t\tu_char *cp = buffer;\n\t\tint n = q_to_b(&tp->t_outq, cp, sc->sc_fifolen);\n\t\tdo {\n\t\t\tbus_space_write_1(iot, ioh, com_data, *cp++);\n\t\t} while (--n);\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_data, getc(&tp->t_outq));\nout:\n\tsplx(s);\n\treturn;\nstopped:\n\tif (ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tCLR(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tsplx(s);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "sc->sc_ier"
          ],
          "line": 1385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_ier",
            "IER_ETXRDY"
          ],
          "line": 1384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_ier",
            "IER_ETXRDY"
          ],
          "line": 1383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_data",
            "getc(&tp->t_outq)"
          ],
          "line": 1378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getc",
          "args": [
            "&tp->t_outq"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "comcngetc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "1764-1779",
          "snippet": "int\ncomcngetc(dev)\n\tdev_t dev;\n{\n\tint s = splhigh();\n\tbus_space_tag_t iot = comconsiot;\n\tbus_space_handle_t ioh = comconsioh;\n\tu_char stat, c;\n\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_RXRDY))\n\t\t;\n\tc = bus_space_read_1(iot, ioh, com_data);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n\treturn c;\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "bus_space_tag_t comconsiot;",
            "bus_space_handle_t comconsioh;",
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "struct tty *\ncomtty(dev)\n\tdev_t dev;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nbus_space_tag_t comconsiot;\nbus_space_handle_t comconsioh;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomcngetc(dev)\n\tdev_t dev;\n{\n\tint s = splhigh();\n\tbus_space_tag_t iot = comconsiot;\n\tbus_space_handle_t ioh = comconsioh;\n\tu_char stat, c;\n\n\twhile (!ISSET(stat = bus_space_read_1(iot, ioh, com_lsr), LSR_RXRDY))\n\t\t;\n\tc = bus_space_read_1(iot, ioh, com_data);\n\tstat = bus_space_read_1(iot, ioh, com_iir);\n\tsplx(s);\n\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_data",
            "*cp++"
          ],
          "line": 1375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "q_to_b",
          "args": [
            "&tp->t_outq",
            "cp",
            "sc->sc_fifolen"
          ],
          "line": 1373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_FIFO"
          ],
          "line": 1366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "sc->sc_ier"
          ],
          "line": 1364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_ier",
            "IER_ETXRDY"
          ],
          "line": 1363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_ier",
            "IER_ETXRDY"
          ],
          "line": 1362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_state",
            "TS_BUSY"
          ],
          "line": 1360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "selwakeup",
          "args": [
            "&tp->t_wsel"
          ],
          "line": 1358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wakeup",
          "args": [
            "&tp->t_outq"
          ],
          "line": 1354
        },
        "resolved": true,
        "details": {
          "function_name": "rln_wakeup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/rlnsubr.c",
          "lines": "171-214",
          "snippet": "u_int8_t\nrln_wakeup(sc, wnew)\n\tstruct rln_softc *\tsc;\n\tu_int8_t\t\twnew;\n{\n\tu_int8_t\t\twold, s;\n\tint\t\t\ti;\n\n\t/* Save what the last-written values were. */\n\twold = (sc->sc_status & RLN_STATUS_WAKEUP) |\n\t    (sc->sc_control & RLN_CONTROL_RESET);\n\n\tif (wnew == RLN_WAKEUP_SET) {\n\t\t/* SetWakeupBit() */\n\t\tdprintf(\" Ws[\");\n\t\trln_status_set(sc, RLN_STATUS_WAKEUP);\n\t\tif (0/*LLDInactivityTimeOut &&\n\t\t    (sc->sc_cardtype & RLN_CTYPE_OEM)*/) {\n\t\t\tdprintf (\" 167ms\");\n\t\t\tDELAY(167000);\n\t\t} else {\n\t\t\tdprintf (\" .1ms\");\n\t\t\tDELAY(100);\n\t\t}\n\t\ts = rln_status_read(sc);\n\t\trln_control_set(sc, RLN_CONTROL_RESET);\n\t\tif ((s & RLN_STATUS_WAKEUP) != 0)\n\t\t\tfor (i = 0; i < 9; i++) {\n\t\t\t\tdprintf(\" 2ms\");\n\t\t\t\tDELAY(2000);\n\t\t\t\trln_status_set(sc, RLN_STATUS_WAKEUP);\n\t\t\t}\n\t\tdprintf(\"]\");\n\t} else {\n\t\t/* ClearWakeupBit() */\n\t\tdprintf(\" Wc[\");\n\t\tif ((wnew & RLN_STATUS_WAKEUP) == 0)\n\t\t\trln_status_clear(sc, RLN_STATUS_WAKEUP);\n\t\tif ((wnew & RLN_CONTROL_RESET) == 0)\n\t\t\trln_control_clear(sc, RLN_CONTROL_RESET);\n\t\tdprintf(\"]\");\n\t}\n\treturn (wold);\n}",
          "includes": [
            "#include <dev/ic/rlncmd.h>",
            "#include <dev/ic/rlnreg.h>",
            "#include <dev/ic/rlnvar.h>",
            "#include <dev/ic/rln.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <netinet/if_ether.h>",
            "#include <netinet/in.h>",
            "#include <net/if.h>",
            "#include <sys/kernel.h>",
            "#include <sys/proc.h>",
            "#include <sys/queue.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/rlncmd.h>\n#include <dev/ic/rlnreg.h>\n#include <dev/ic/rlnvar.h>\n#include <dev/ic/rln.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <netinet/if_ether.h>\n#include <netinet/in.h>\n#include <net/if.h>\n#include <sys/kernel.h>\n#include <sys/proc.h>\n#include <sys/queue.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nu_int8_t\nrln_wakeup(sc, wnew)\n\tstruct rln_softc *\tsc;\n\tu_int8_t\t\twnew;\n{\n\tu_int8_t\t\twold, s;\n\tint\t\t\ti;\n\n\t/* Save what the last-written values were. */\n\twold = (sc->sc_status & RLN_STATUS_WAKEUP) |\n\t    (sc->sc_control & RLN_CONTROL_RESET);\n\n\tif (wnew == RLN_WAKEUP_SET) {\n\t\t/* SetWakeupBit() */\n\t\tdprintf(\" Ws[\");\n\t\trln_status_set(sc, RLN_STATUS_WAKEUP);\n\t\tif (0/*LLDInactivityTimeOut &&\n\t\t    (sc->sc_cardtype & RLN_CTYPE_OEM)*/) {\n\t\t\tdprintf (\" 167ms\");\n\t\t\tDELAY(167000);\n\t\t} else {\n\t\t\tdprintf (\" .1ms\");\n\t\t\tDELAY(100);\n\t\t}\n\t\ts = rln_status_read(sc);\n\t\trln_control_set(sc, RLN_CONTROL_RESET);\n\t\tif ((s & RLN_STATUS_WAKEUP) != 0)\n\t\t\tfor (i = 0; i < 9; i++) {\n\t\t\t\tdprintf(\" 2ms\");\n\t\t\t\tDELAY(2000);\n\t\t\t\trln_status_set(sc, RLN_STATUS_WAKEUP);\n\t\t\t}\n\t\tdprintf(\"]\");\n\t} else {\n\t\t/* ClearWakeupBit() */\n\t\tdprintf(\" Wc[\");\n\t\tif ((wnew & RLN_STATUS_WAKEUP) == 0)\n\t\t\trln_status_clear(sc, RLN_STATUS_WAKEUP);\n\t\tif ((wnew & RLN_CONTROL_RESET) == 0)\n\t\t\trln_control_clear(sc, RLN_CONTROL_RESET);\n\t\tdprintf(\"]\");\n\t}\n\treturn (wold);\n}"
        }
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "tp->t_state",
            "TS_ASLEEP"
          ],
          "line": 1353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_ASLEEP"
          ],
          "line": 1352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_msr",
            "MSR_CTS"
          ],
          "line": 1349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_cflag",
            "CRTSCTS"
          ],
          "line": 1349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_TIMEOUT | TS_TTSTOP"
          ],
          "line": 1347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_BUSY"
          ],
          "line": 1345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 1344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "tp->t_dev"
          ],
          "line": 1339
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nvoid\ncomstart(tp)\n\tstruct tty *tp;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_BUSY))\n\t\tgoto out;\n\tif (ISSET(tp->t_state, TS_TIMEOUT | TS_TTSTOP) || sc->sc_halt > 0)\n\t\tgoto stopped;\n\tif (ISSET(tp->t_cflag, CRTSCTS) && !ISSET(sc->sc_msr, MSR_CTS))\n\t\tgoto stopped;\n\tif (tp->t_outq.c_cc <= tp->t_lowat) {\n\t\tif (ISSET(tp->t_state, TS_ASLEEP)) {\n\t\t\tCLR(tp->t_state, TS_ASLEEP);\n\t\t\twakeup(&tp->t_outq);\n\t\t}\n\t\tif (tp->t_outq.c_cc == 0)\n\t\t\tgoto stopped;\n\t\tselwakeup(&tp->t_wsel);\n\t}\n\tSET(tp->t_state, TS_BUSY);\n\n\tif (!ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tSET(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tif (ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n#ifdef COM_HAYESP\n\t\tu_char buffer[1024];\t/* XXX: largest fifo */\n#else\n\t\tu_char buffer[64];\t/* XXX: largest fifo */\n#endif\n\t\tu_char *cp = buffer;\n\t\tint n = q_to_b(&tp->t_outq, cp, sc->sc_fifolen);\n\t\tdo {\n\t\t\tbus_space_write_1(iot, ioh, com_data, *cp++);\n\t\t} while (--n);\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_data, getc(&tp->t_outq));\nout:\n\tsplx(s);\n\treturn;\nstopped:\n\tif (ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tCLR(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tsplx(s);\n}"
  },
  {
    "function_name": "comparam",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1188-1333",
    "snippet": "int\ncomparam(tp, t)\n\tstruct tty *tp;\n\tstruct termios *t;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint ospeed = comspeed(t->c_ospeed);\n\tu_char lcr;\n\ttcflag_t oldcflag;\n\tint s;\n\n\t/* check requested parameters */\n\tif (ospeed < 0 || (t->c_ispeed && t->c_ispeed != t->c_ospeed))\n\t\treturn EINVAL;\n\n\tlcr = ISSET(sc->sc_lcr, LCR_SBREAK);\n\n\tswitch (ISSET(t->c_cflag, CSIZE)) {\n\tcase CS5:\n\t\tSET(lcr, LCR_5BITS);\n\t\tbreak;\n\tcase CS6:\n\t\tSET(lcr, LCR_6BITS);\n\t\tbreak;\n\tcase CS7:\n\t\tSET(lcr, LCR_7BITS);\n\t\tbreak;\n\tcase CS8:\n\t\tSET(lcr, LCR_8BITS);\n\t\tbreak;\n\t}\n\tif (ISSET(t->c_cflag, PARENB)) {\n\t\tSET(lcr, LCR_PENAB);\n\t\tif (!ISSET(t->c_cflag, PARODD))\n\t\t\tSET(lcr, LCR_PEVEN);\n\t}\n\tif (ISSET(t->c_cflag, CSTOPB))\n\t\tSET(lcr, LCR_STOPB);\n\n\tsc->sc_lcr = lcr;\n\n\ts = spltty();\n\n\tif (ospeed == 0) {\n\t\tCLR(sc->sc_mcr, MCR_DTR);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Set the FIFO threshold based on the receive speed, if we are\n\t * changing it.\n\t */\n\tif (sc->sc_initialize || (tp->t_ispeed != t->c_ispeed)) {\n\t\tsc->sc_initialize = 0;\n\n\t\tif (ospeed != 0) {\n\t\t\t/*\n\t\t\t * Make sure the transmit FIFO is empty before\n\t\t\t * proceeding.  If we don't do this, some revisions\n\t\t\t * of the UART will hang.  Interestingly enough,\n\t\t\t * even if we do this while the last character is\n\t\t\t * still being pushed out, they don't hang.  This\n\t\t\t * seems good enough.\n\t\t\t */\n\t\t\twhile (ISSET(tp->t_state, TS_BUSY)) {\n\t\t\t\tint error;\n\n\t\t\t\t++sc->sc_halt;\n\t\t\t\terror = ttysleep(tp, &tp->t_outq,\n\t\t\t\t    TTOPRI | PCATCH, \"comprm\", 0);\n\t\t\t\t--sc->sc_halt;\n\t\t\t\tif (error) {\n\t\t\t\t\tsplx(s);\n\t\t\t\t\tcomstart(tp);\n\t\t\t\t\treturn (error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr | LCR_DLAB);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbl, ospeed);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbh, ospeed >> 8);\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\tSET(sc->sc_mcr, MCR_DTR);\n\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t} else\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t\tif (!ISSET(sc->sc_hwflags, COM_HW_HAYESP) &&\n\t\t    ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750) {\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr,\n\t\t\t\t    lcr | LCR_DLAB);\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE | FIFO_ENABLE_64BYTE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\t} else\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t}\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t/* When not using CRTSCTS, RTS follows DTR. */\n\tif (!ISSET(t->c_cflag, CRTSCTS)) {\n\t\tif (ISSET(sc->sc_mcr, MCR_DTR)) {\n\t\t\tif (!ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tSET(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t} else {\n\t\t\tif (ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tCLR(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t}\n\t\tsc->sc_dtr = MCR_DTR | MCR_RTS;\n\t} else\n\t\tsc->sc_dtr = MCR_DTR;\n\n\t/* and copy to tty */\n\ttp->t_ispeed = t->c_ispeed;\n\ttp->t_ospeed = t->c_ospeed;\n\toldcflag = tp->t_cflag;\n\ttp->t_cflag = t->c_cflag;\n\n\t/*\n\t * If DCD is off and MDMBUF is changed, ask the tty layer if we should\n\t * stop the device.\n\t */\n\tif (!ISSET(sc->sc_msr, MSR_DCD) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR) &&\n\t    ISSET(oldcflag, MDMBUF) != ISSET(tp->t_cflag, MDMBUF) &&\n\t    (*linesw[tp->t_line].l_modem)(tp, 0) == 0) {\n\t\tCLR(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/* Just to be sure... */\n\tsplx(s);\n\tcomstart(tp);\n\treturn 0;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tcom_lcr\tcom_cfcr"
    ],
    "globals_used": [
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "u_int8_t lcr;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "comstart",
          "args": [
            "tp"
          ],
          "line": 1331
        },
        "resolved": true,
        "details": {
          "function_name": "comstart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "1335-1388",
          "snippet": "void\ncomstart(tp)\n\tstruct tty *tp;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_BUSY))\n\t\tgoto out;\n\tif (ISSET(tp->t_state, TS_TIMEOUT | TS_TTSTOP) || sc->sc_halt > 0)\n\t\tgoto stopped;\n\tif (ISSET(tp->t_cflag, CRTSCTS) && !ISSET(sc->sc_msr, MSR_CTS))\n\t\tgoto stopped;\n\tif (tp->t_outq.c_cc <= tp->t_lowat) {\n\t\tif (ISSET(tp->t_state, TS_ASLEEP)) {\n\t\t\tCLR(tp->t_state, TS_ASLEEP);\n\t\t\twakeup(&tp->t_outq);\n\t\t}\n\t\tif (tp->t_outq.c_cc == 0)\n\t\t\tgoto stopped;\n\t\tselwakeup(&tp->t_wsel);\n\t}\n\tSET(tp->t_state, TS_BUSY);\n\n\tif (!ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tSET(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tif (ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n#ifdef COM_HAYESP\n\t\tu_char buffer[1024];\t/* XXX: largest fifo */\n#else\n\t\tu_char buffer[64];\t/* XXX: largest fifo */\n#endif\n\t\tu_char *cp = buffer;\n\t\tint n = q_to_b(&tp->t_outq, cp, sc->sc_fifolen);\n\t\tdo {\n\t\t\tbus_space_write_1(iot, ioh, com_data, *cp++);\n\t\t} while (--n);\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_data, getc(&tp->t_outq));\nout:\n\tsplx(s);\n\treturn;\nstopped:\n\tif (ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tCLR(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
            "struct com_softc *sc = (void *)self;",
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "struct com_softc *sc = arg;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;",
            "struct tty *tp;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nvoid\ncomstart(tp)\n\tstruct tty *tp;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_BUSY))\n\t\tgoto out;\n\tif (ISSET(tp->t_state, TS_TIMEOUT | TS_TTSTOP) || sc->sc_halt > 0)\n\t\tgoto stopped;\n\tif (ISSET(tp->t_cflag, CRTSCTS) && !ISSET(sc->sc_msr, MSR_CTS))\n\t\tgoto stopped;\n\tif (tp->t_outq.c_cc <= tp->t_lowat) {\n\t\tif (ISSET(tp->t_state, TS_ASLEEP)) {\n\t\t\tCLR(tp->t_state, TS_ASLEEP);\n\t\t\twakeup(&tp->t_outq);\n\t\t}\n\t\tif (tp->t_outq.c_cc == 0)\n\t\t\tgoto stopped;\n\t\tselwakeup(&tp->t_wsel);\n\t}\n\tSET(tp->t_state, TS_BUSY);\n\n\tif (!ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tSET(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tif (ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n#ifdef COM_HAYESP\n\t\tu_char buffer[1024];\t/* XXX: largest fifo */\n#else\n\t\tu_char buffer[64];\t/* XXX: largest fifo */\n#endif\n\t\tu_char *cp = buffer;\n\t\tint n = q_to_b(&tp->t_outq, cp, sc->sc_fifolen);\n\t\tdo {\n\t\t\tbus_space_write_1(iot, ioh, com_data, *cp++);\n\t\t} while (--n);\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_data, getc(&tp->t_outq));\nout:\n\tsplx(s);\n\treturn;\nstopped:\n\tif (ISSET(sc->sc_ier, IER_ETXRDY)) {\n\t\tCLR(sc->sc_ier, IER_ETXRDY);\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\t}\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "sc->sc_dtr"
          ],
          "line": 1325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "tp",
            "0"
          ],
          "line": 1324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_cflag",
            "MDMBUF"
          ],
          "line": 1323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "oldcflag",
            "MDMBUF"
          ],
          "line": 1323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_swflags",
            "COM_SW_SOFTCAR"
          ],
          "line": 1322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_msr",
            "MSR_DCD"
          ],
          "line": 1321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "MCR_RTS"
          ],
          "line": 1303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_mcr",
            "MCR_RTS"
          ],
          "line": 1302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "MCR_RTS"
          ],
          "line": 1298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_mcr",
            "MCR_RTS"
          ],
          "line": 1297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_mcr",
            "MCR_DTR"
          ],
          "line": 1296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "t->c_cflag",
            "CRTSCTS"
          ],
          "line": 1295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr"
          ],
          "line": 1292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "FIFO_ENABLE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8)"
          ],
          "line": 1287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr"
          ],
          "line": 1285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "FIFO_ENABLE | FIFO_ENABLE_64BYTE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8)"
          ],
          "line": 1282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr | LCR_DLAB"
          ],
          "line": 1280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_FIFO"
          ],
          "line": 1278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_HAYESP"
          ],
          "line": 1277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr"
          ],
          "line": 1275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "MCR_DTR"
          ],
          "line": 1272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr"
          ],
          "line": 1271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_dlbh",
            "ospeed >> 8"
          ],
          "line": 1270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_dlbl",
            "ospeed"
          ],
          "line": 1269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr | LCR_DLAB"
          ],
          "line": 1268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 1262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ttysleep",
          "args": [
            "tp",
            "&tp->t_outq",
            "TTOPRI | PCATCH",
            "\"comprm\"",
            "0"
          ],
          "line": 1258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_BUSY"
          ],
          "line": 1254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "MCR_DTR"
          ],
          "line": 1234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 1231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_STOPB"
          ],
          "line": 1227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "t->c_cflag",
            "CSTOPB"
          ],
          "line": 1226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_PEVEN"
          ],
          "line": 1224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "t->c_cflag",
            "PARODD"
          ],
          "line": 1223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_PENAB"
          ],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "t->c_cflag",
            "PARENB"
          ],
          "line": 1221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_8BITS"
          ],
          "line": 1218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_7BITS"
          ],
          "line": 1215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_6BITS"
          ],
          "line": 1212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "lcr",
            "LCR_5BITS"
          ],
          "line": 1209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "t->c_cflag",
            "CSIZE"
          ],
          "line": 1207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_lcr",
            "LCR_SBREAK"
          ],
          "line": 1205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comspeed",
          "args": [
            "t->c_ospeed"
          ],
          "line": 1196
        },
        "resolved": true,
        "details": {
          "function_name": "comspeed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "195-218",
          "snippet": "int\ncomspeed(speed)\n\tlong speed;\n{\n#define\tdivrnd(n, q)\t(((n)*2/(q)+1)/2)\t/* divide and round off */\n\n\tint x, err;\n\n\tif (speed == 0)\n\t\treturn 0;\n\tif (speed < 0)\n\t\treturn -1;\n\tx = divrnd((COM_FREQ / 16), speed);\n\tif (x <= 0)\n\t\treturn -1;\n\terr = divrnd((COM_FREQ / 16) * 1000, speed * x) - 1000;\n\tif (err < 0)\n\t\terr = -err;\n\tif (err > COM_TOLERANCE)\n\t\treturn -1;\n\treturn x;\n\n#undef\tdivrnd(n, q)\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\ncomspeed(speed)\n\tlong speed;\n{\n#define\tdivrnd(n, q)\t(((n)*2/(q)+1)/2)\t/* divide and round off */\n\n\tint x, err;\n\n\tif (speed == 0)\n\t\treturn 0;\n\tif (speed < 0)\n\t\treturn -1;\n\tx = divrnd((COM_FREQ / 16), speed);\n\tif (x <= 0)\n\t\treturn -1;\n\terr = divrnd((COM_FREQ / 16) * 1000, speed * x) - 1000;\n\tif (err < 0)\n\t\terr = -err;\n\tif (err > COM_TOLERANCE)\n\t\treturn -1;\n\treturn x;\n\n#undef\tdivrnd(n, q)\n}"
        }
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "tp->t_dev"
          ],
          "line": 1193
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nu_int8_t lcr;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nint\ncomparam(tp, t)\n\tstruct tty *tp;\n\tstruct termios *t;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint ospeed = comspeed(t->c_ospeed);\n\tu_char lcr;\n\ttcflag_t oldcflag;\n\tint s;\n\n\t/* check requested parameters */\n\tif (ospeed < 0 || (t->c_ispeed && t->c_ispeed != t->c_ospeed))\n\t\treturn EINVAL;\n\n\tlcr = ISSET(sc->sc_lcr, LCR_SBREAK);\n\n\tswitch (ISSET(t->c_cflag, CSIZE)) {\n\tcase CS5:\n\t\tSET(lcr, LCR_5BITS);\n\t\tbreak;\n\tcase CS6:\n\t\tSET(lcr, LCR_6BITS);\n\t\tbreak;\n\tcase CS7:\n\t\tSET(lcr, LCR_7BITS);\n\t\tbreak;\n\tcase CS8:\n\t\tSET(lcr, LCR_8BITS);\n\t\tbreak;\n\t}\n\tif (ISSET(t->c_cflag, PARENB)) {\n\t\tSET(lcr, LCR_PENAB);\n\t\tif (!ISSET(t->c_cflag, PARODD))\n\t\t\tSET(lcr, LCR_PEVEN);\n\t}\n\tif (ISSET(t->c_cflag, CSTOPB))\n\t\tSET(lcr, LCR_STOPB);\n\n\tsc->sc_lcr = lcr;\n\n\ts = spltty();\n\n\tif (ospeed == 0) {\n\t\tCLR(sc->sc_mcr, MCR_DTR);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Set the FIFO threshold based on the receive speed, if we are\n\t * changing it.\n\t */\n\tif (sc->sc_initialize || (tp->t_ispeed != t->c_ispeed)) {\n\t\tsc->sc_initialize = 0;\n\n\t\tif (ospeed != 0) {\n\t\t\t/*\n\t\t\t * Make sure the transmit FIFO is empty before\n\t\t\t * proceeding.  If we don't do this, some revisions\n\t\t\t * of the UART will hang.  Interestingly enough,\n\t\t\t * even if we do this while the last character is\n\t\t\t * still being pushed out, they don't hang.  This\n\t\t\t * seems good enough.\n\t\t\t */\n\t\t\twhile (ISSET(tp->t_state, TS_BUSY)) {\n\t\t\t\tint error;\n\n\t\t\t\t++sc->sc_halt;\n\t\t\t\terror = ttysleep(tp, &tp->t_outq,\n\t\t\t\t    TTOPRI | PCATCH, \"comprm\", 0);\n\t\t\t\t--sc->sc_halt;\n\t\t\t\tif (error) {\n\t\t\t\t\tsplx(s);\n\t\t\t\t\tcomstart(tp);\n\t\t\t\t\treturn (error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr | LCR_DLAB);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbl, ospeed);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbh, ospeed >> 8);\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\tSET(sc->sc_mcr, MCR_DTR);\n\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t} else\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t\tif (!ISSET(sc->sc_hwflags, COM_HW_HAYESP) &&\n\t\t    ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750) {\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr,\n\t\t\t\t    lcr | LCR_DLAB);\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE | FIFO_ENABLE_64BYTE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\t} else\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t}\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t/* When not using CRTSCTS, RTS follows DTR. */\n\tif (!ISSET(t->c_cflag, CRTSCTS)) {\n\t\tif (ISSET(sc->sc_mcr, MCR_DTR)) {\n\t\t\tif (!ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tSET(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t} else {\n\t\t\tif (ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tCLR(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t}\n\t\tsc->sc_dtr = MCR_DTR | MCR_RTS;\n\t} else\n\t\tsc->sc_dtr = MCR_DTR;\n\n\t/* and copy to tty */\n\ttp->t_ispeed = t->c_ispeed;\n\ttp->t_ospeed = t->c_ospeed;\n\toldcflag = tp->t_cflag;\n\ttp->t_cflag = t->c_cflag;\n\n\t/*\n\t * If DCD is off and MDMBUF is changed, ask the tty layer if we should\n\t * stop the device.\n\t */\n\tif (!ISSET(sc->sc_msr, MSR_DCD) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR) &&\n\t    ISSET(oldcflag, MDMBUF) != ISSET(tp->t_cflag, MDMBUF) &&\n\t    (*linesw[tp->t_line].l_modem)(tp, 0) == 0) {\n\t\tCLR(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/* Just to be sure... */\n\tsplx(s);\n\tcomstart(tp);\n\treturn 0;\n}"
  },
  {
    "function_name": "comioctl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1068-1186",
    "snippet": "int\ncomioctl(dev, cmd, data, flag, p)\n\tdev_t dev;\n\tu_long cmd;\n\tcaddr_t data;\n\tint flag;\n\tstruct proc *p;\n{\n\tint unit = DEVUNIT(dev);\n\tstruct com_softc *sc = com_cd.cd_devs[unit];\n\tstruct tty *tp = sc->sc_tty;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint error;\n\n\terror = (*linesw[tp->t_line].l_ioctl)(tp, cmd, data, flag, p);\n\tif (error >= 0)\n\t\treturn error;\n\terror = ttioctl(tp, cmd, data, flag, p);\n\tif (error >= 0)\n\t\treturn error;\n\n\tswitch (cmd) {\n\tcase TIOCSBRK:\n\t\tSET(sc->sc_lcr, LCR_SBREAK);\n\t\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\t\tbreak;\n\tcase TIOCCBRK:\n\t\tCLR(sc->sc_lcr, LCR_SBREAK);\n\t\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\t\tbreak;\n\tcase TIOCSDTR:\n\t\tSET(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCCDTR:\n\t\tCLR(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCMSET:\n\t\tCLR(sc->sc_mcr, MCR_DTR | MCR_RTS);\n\tcase TIOCMBIS:\n\t\tSET(sc->sc_mcr, tiocm_xxx2mcr(*(int *)data));\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCMBIC:\n\t\tCLR(sc->sc_mcr, tiocm_xxx2mcr(*(int *)data));\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCMGET: {\n\t\tu_char m;\n\t\tint bits = 0;\n\n\t\tm = sc->sc_mcr;\n\t\tif (ISSET(m, MCR_DTR))\n\t\t\tSET(bits, TIOCM_DTR);\n\t\tif (ISSET(m, MCR_RTS))\n\t\t\tSET(bits, TIOCM_RTS);\n\t\tm = sc->sc_msr;\n\t\tif (ISSET(m, MSR_DCD))\n\t\t\tSET(bits, TIOCM_CD);\n\t\tif (ISSET(m, MSR_CTS))\n\t\t\tSET(bits, TIOCM_CTS);\n\t\tif (ISSET(m, MSR_DSR))\n\t\t\tSET(bits, TIOCM_DSR);\n\t\tif (ISSET(m, MSR_RI | MSR_TERI))\n\t\t\tSET(bits, TIOCM_RI);\n\t\tif (bus_space_read_1(iot, ioh, com_ier))\n\t\t\tSET(bits, TIOCM_LE);\n\t\t*(int *)data = bits;\n\t\tbreak;\n\t}\n\tcase TIOCGFLAGS: {\n\t\tint driverbits, userbits = 0;\n\n\t\tdriverbits = sc->sc_swflags;\n\t\tif (ISSET(driverbits, COM_SW_SOFTCAR))\n\t\t\tSET(userbits, TIOCFLAG_SOFTCAR);\n\t\tif (ISSET(driverbits, COM_SW_CLOCAL))\n\t\t\tSET(userbits, TIOCFLAG_CLOCAL);\n\t\tif (ISSET(driverbits, COM_SW_CRTSCTS))\n\t\t\tSET(userbits, TIOCFLAG_CRTSCTS);\n\t\tif (ISSET(driverbits, COM_SW_MDMBUF))\n\t\t\tSET(userbits, TIOCFLAG_MDMBUF);\n\t\tif (ISSET(driverbits, COM_SW_PPS))\n\t\t\tSET(userbits, TIOCFLAG_PPS);\n\n\t\t*(int *)data = userbits;\n\t\tbreak;\n\t}\n\tcase TIOCSFLAGS: {\n\t\tint userbits, driverbits = 0;\n\n\t\terror = suser(p->p_ucred, &p->p_acflag); \n\t\tif (error != 0)\n\t\t\treturn(EPERM); \n\n\t\tuserbits = *(int *)data;\n\t\tif (ISSET(userbits, TIOCFLAG_SOFTCAR) ||\n\t\t    ISSET(sc->sc_hwflags, COM_HW_CONSOLE))\n\t\t\tSET(driverbits, COM_SW_SOFTCAR);\n\t\tif (ISSET(userbits, TIOCFLAG_CLOCAL))\n\t\t\tSET(driverbits, COM_SW_CLOCAL);\n\t\tif (ISSET(userbits, TIOCFLAG_CRTSCTS))\n\t\t\tSET(driverbits, COM_SW_CRTSCTS);\n\t\tif (ISSET(userbits, TIOCFLAG_MDMBUF))\n\t\t\tSET(driverbits, COM_SW_MDMBUF);\n\t\tif (ISSET(userbits, TIOCFLAG_PPS))\n\t\t\tSET(driverbits, COM_SW_PPS);\n\n\t\tsc->sc_swflags = driverbits;\n\t\tbreak;\n\t}\n\tdefault:\n\t\treturn ENOTTY;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tcom_lcr\tcom_cfcr"
    ],
    "globals_used": [
      "static u_char tiocm_xxx2mcr",
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "driverbits",
            "COM_SW_PPS"
          ],
          "line": 1176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "userbits",
            "TIOCFLAG_PPS"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "driverbits",
            "COM_SW_MDMBUF"
          ],
          "line": 1174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "userbits",
            "TIOCFLAG_MDMBUF"
          ],
          "line": 1173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "driverbits",
            "COM_SW_CRTSCTS"
          ],
          "line": 1172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "userbits",
            "TIOCFLAG_CRTSCTS"
          ],
          "line": 1171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "driverbits",
            "COM_SW_CLOCAL"
          ],
          "line": 1170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "userbits",
            "TIOCFLAG_CLOCAL"
          ],
          "line": 1169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "driverbits",
            "COM_SW_SOFTCAR"
          ],
          "line": 1168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_CONSOLE"
          ],
          "line": 1167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "userbits",
            "TIOCFLAG_SOFTCAR"
          ],
          "line": 1166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "suser",
          "args": [
            "p->p_ucred",
            "&p->p_acflag"
          ],
          "line": 1161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "userbits",
            "TIOCFLAG_PPS"
          ],
          "line": 1153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "driverbits",
            "COM_SW_PPS"
          ],
          "line": 1152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "userbits",
            "TIOCFLAG_MDMBUF"
          ],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "driverbits",
            "COM_SW_MDMBUF"
          ],
          "line": 1150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "userbits",
            "TIOCFLAG_CRTSCTS"
          ],
          "line": 1149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "driverbits",
            "COM_SW_CRTSCTS"
          ],
          "line": 1148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "userbits",
            "TIOCFLAG_CLOCAL"
          ],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "driverbits",
            "COM_SW_CLOCAL"
          ],
          "line": 1146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "userbits",
            "TIOCFLAG_SOFTCAR"
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "driverbits",
            "COM_SW_SOFTCAR"
          ],
          "line": 1144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_LE"
          ],
          "line": 1136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_ier"
          ],
          "line": 1135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_RI"
          ],
          "line": 1134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "m",
            "MSR_RI | MSR_TERI"
          ],
          "line": 1133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_DSR"
          ],
          "line": 1132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "m",
            "MSR_DSR"
          ],
          "line": 1131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_CTS"
          ],
          "line": 1130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "m",
            "MSR_CTS"
          ],
          "line": 1129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_CD"
          ],
          "line": 1128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "m",
            "MSR_DCD"
          ],
          "line": 1127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_RTS"
          ],
          "line": 1125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "m",
            "MCR_RTS"
          ],
          "line": 1124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "bits",
            "TIOCM_DTR"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "m",
            "MCR_DTR"
          ],
          "line": 1122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "tiocm_xxx2mcr(*(int *)data)"
          ],
          "line": 1114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tiocm_xxx2mcr",
          "args": [
            "*(int *)data"
          ],
          "line": 1114
        },
        "resolved": true,
        "details": {
          "function_name": "tiocm_xxx2mcr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "1055-1066",
          "snippet": "static u_char\ntiocm_xxx2mcr(data)\n\tint data;\n{\n\tu_char m = 0;\n\n\tif (ISSET(data, TIOCM_DTR))\n\t\tSET(m, MCR_DTR);\n\tif (ISSET(data, TIOCM_RTS))\n\t\tSET(m, MCR_RTS);\n\treturn m;\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_char tiocm_xxx2mcr"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic u_char tiocm_xxx2mcr;\n\nstatic u_char\ntiocm_xxx2mcr(data)\n\tint data;\n{\n\tu_char m = 0;\n\n\tif (ISSET(data, TIOCM_DTR))\n\t\tSET(m, MCR_DTR);\n\tif (ISSET(data, TIOCM_RTS))\n\t\tSET(m, MCR_RTS);\n\treturn m;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "tiocm_xxx2mcr(*(int *)data)"
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "MCR_DTR | MCR_RTS"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "sc->sc_dtr"
          ],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "sc->sc_dtr"
          ],
          "line": 1100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "sc->sc_lcr"
          ],
          "line": 1097
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_lcr",
            "LCR_SBREAK"
          ],
          "line": 1096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "sc->sc_lcr"
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_lcr",
            "LCR_SBREAK"
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ttioctl",
          "args": [
            "tp",
            "cmd",
            "data",
            "flag",
            "p"
          ],
          "line": 1086
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "tp",
            "cmd",
            "data",
            "flag",
            "p"
          ],
          "line": 1083
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "dev"
          ],
          "line": 1076
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nstatic u_char tiocm_xxx2mcr;\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nint\ncomioctl(dev, cmd, data, flag, p)\n\tdev_t dev;\n\tu_long cmd;\n\tcaddr_t data;\n\tint flag;\n\tstruct proc *p;\n{\n\tint unit = DEVUNIT(dev);\n\tstruct com_softc *sc = com_cd.cd_devs[unit];\n\tstruct tty *tp = sc->sc_tty;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint error;\n\n\terror = (*linesw[tp->t_line].l_ioctl)(tp, cmd, data, flag, p);\n\tif (error >= 0)\n\t\treturn error;\n\terror = ttioctl(tp, cmd, data, flag, p);\n\tif (error >= 0)\n\t\treturn error;\n\n\tswitch (cmd) {\n\tcase TIOCSBRK:\n\t\tSET(sc->sc_lcr, LCR_SBREAK);\n\t\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\t\tbreak;\n\tcase TIOCCBRK:\n\t\tCLR(sc->sc_lcr, LCR_SBREAK);\n\t\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\t\tbreak;\n\tcase TIOCSDTR:\n\t\tSET(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCCDTR:\n\t\tCLR(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCMSET:\n\t\tCLR(sc->sc_mcr, MCR_DTR | MCR_RTS);\n\tcase TIOCMBIS:\n\t\tSET(sc->sc_mcr, tiocm_xxx2mcr(*(int *)data));\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCMBIC:\n\t\tCLR(sc->sc_mcr, tiocm_xxx2mcr(*(int *)data));\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tbreak;\n\tcase TIOCMGET: {\n\t\tu_char m;\n\t\tint bits = 0;\n\n\t\tm = sc->sc_mcr;\n\t\tif (ISSET(m, MCR_DTR))\n\t\t\tSET(bits, TIOCM_DTR);\n\t\tif (ISSET(m, MCR_RTS))\n\t\t\tSET(bits, TIOCM_RTS);\n\t\tm = sc->sc_msr;\n\t\tif (ISSET(m, MSR_DCD))\n\t\t\tSET(bits, TIOCM_CD);\n\t\tif (ISSET(m, MSR_CTS))\n\t\t\tSET(bits, TIOCM_CTS);\n\t\tif (ISSET(m, MSR_DSR))\n\t\t\tSET(bits, TIOCM_DSR);\n\t\tif (ISSET(m, MSR_RI | MSR_TERI))\n\t\t\tSET(bits, TIOCM_RI);\n\t\tif (bus_space_read_1(iot, ioh, com_ier))\n\t\t\tSET(bits, TIOCM_LE);\n\t\t*(int *)data = bits;\n\t\tbreak;\n\t}\n\tcase TIOCGFLAGS: {\n\t\tint driverbits, userbits = 0;\n\n\t\tdriverbits = sc->sc_swflags;\n\t\tif (ISSET(driverbits, COM_SW_SOFTCAR))\n\t\t\tSET(userbits, TIOCFLAG_SOFTCAR);\n\t\tif (ISSET(driverbits, COM_SW_CLOCAL))\n\t\t\tSET(userbits, TIOCFLAG_CLOCAL);\n\t\tif (ISSET(driverbits, COM_SW_CRTSCTS))\n\t\t\tSET(userbits, TIOCFLAG_CRTSCTS);\n\t\tif (ISSET(driverbits, COM_SW_MDMBUF))\n\t\t\tSET(userbits, TIOCFLAG_MDMBUF);\n\t\tif (ISSET(driverbits, COM_SW_PPS))\n\t\t\tSET(userbits, TIOCFLAG_PPS);\n\n\t\t*(int *)data = userbits;\n\t\tbreak;\n\t}\n\tcase TIOCSFLAGS: {\n\t\tint userbits, driverbits = 0;\n\n\t\terror = suser(p->p_ucred, &p->p_acflag); \n\t\tif (error != 0)\n\t\t\treturn(EPERM); \n\n\t\tuserbits = *(int *)data;\n\t\tif (ISSET(userbits, TIOCFLAG_SOFTCAR) ||\n\t\t    ISSET(sc->sc_hwflags, COM_HW_CONSOLE))\n\t\t\tSET(driverbits, COM_SW_SOFTCAR);\n\t\tif (ISSET(userbits, TIOCFLAG_CLOCAL))\n\t\t\tSET(driverbits, COM_SW_CLOCAL);\n\t\tif (ISSET(userbits, TIOCFLAG_CRTSCTS))\n\t\t\tSET(driverbits, COM_SW_CRTSCTS);\n\t\tif (ISSET(userbits, TIOCFLAG_MDMBUF))\n\t\t\tSET(driverbits, COM_SW_MDMBUF);\n\t\tif (ISSET(userbits, TIOCFLAG_PPS))\n\t\t\tSET(driverbits, COM_SW_PPS);\n\n\t\tsc->sc_swflags = driverbits;\n\t\tbreak;\n\t}\n\tdefault:\n\t\treturn ENOTTY;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "tiocm_xxx2mcr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1055-1066",
    "snippet": "static u_char\ntiocm_xxx2mcr(data)\n\tint data;\n{\n\tu_char m = 0;\n\n\tif (ISSET(data, TIOCM_DTR))\n\t\tSET(m, MCR_DTR);\n\tif (ISSET(data, TIOCM_RTS))\n\t\tSET(m, MCR_RTS);\n\treturn m;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_char tiocm_xxx2mcr"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "m",
            "MCR_RTS"
          ],
          "line": 1064
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "data",
            "TIOCM_RTS"
          ],
          "line": 1063
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "m",
            "MCR_DTR"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "data",
            "TIOCM_DTR"
          ],
          "line": 1061
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic u_char tiocm_xxx2mcr;\n\nstatic u_char\ntiocm_xxx2mcr(data)\n\tint data;\n{\n\tu_char m = 0;\n\n\tif (ISSET(data, TIOCM_DTR))\n\t\tSET(m, MCR_DTR);\n\tif (ISSET(data, TIOCM_RTS))\n\t\tSET(m, MCR_RTS);\n\treturn m;\n}"
  },
  {
    "function_name": "comwrite",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1033-1043",
    "snippet": "int\ncomwrite(dev, uio, flag)\n\tdev_t dev;\n\tstruct uio *uio;\n\tint flag;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(dev)];\n\tstruct tty *tp = sc->sc_tty;\n \n\treturn ((*linesw[tp->t_line].l_write)(tp, uio, flag));\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "struct com_softc *sc = (void *)self;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "struct com_softc *sc = arg;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "tp",
            "uio",
            "flag"
          ],
          "line": 1042
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "dev"
          ],
          "line": 1039
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nstruct com_softc *sc = arg;\nstruct tty *tp;\n\nint\ncomwrite(dev, uio, flag)\n\tdev_t dev;\n\tstruct uio *uio;\n\tint flag;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(dev)];\n\tstruct tty *tp = sc->sc_tty;\n \n\treturn ((*linesw[tp->t_line].l_write)(tp, uio, flag));\n}"
  },
  {
    "function_name": "comread",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1021-1031",
    "snippet": "int\ncomread(dev, uio, flag)\n\tdev_t dev;\n\tstruct uio *uio;\n\tint flag;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(dev)];\n\tstruct tty *tp = sc->sc_tty;\n \n\treturn ((*linesw[tp->t_line].l_read)(tp, uio, flag));\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "struct com_softc *sc = (void *)self;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "struct com_softc *sc = arg;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "tp",
            "uio",
            "flag"
          ],
          "line": 1030
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "dev"
          ],
          "line": 1027
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nstruct com_softc *sc = arg;\nstruct tty *tp;\n\nint\ncomread(dev, uio, flag)\n\tdev_t dev;\n\tstruct uio *uio;\n\tint flag;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(dev)];\n\tstruct tty *tp = sc->sc_tty;\n \n\treturn ((*linesw[tp->t_line].l_read)(tp, uio, flag));\n}"
  },
  {
    "function_name": "com_raisedtr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "1011-1019",
    "snippet": "void\ncom_raisedtr(arg)\n\tvoid *arg;\n{\n\tstruct com_softc *sc = arg;\n\n\tSET(sc->sc_mcr, MCR_DTR | MCR_RTS);\n\tbus_space_write_1(sc->sc_iot, sc->sc_ioh, com_mcr, sc->sc_mcr);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\tcom_raisedtr",
      "struct com_softc *sc = (void *)self;",
      "void *arg;",
      "struct com_softc *sc = arg;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "sc->sc_iot",
            "sc->sc_ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "MCR_DTR | MCR_RTS"
          ],
          "line": 1017
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nvoid\tcom_raisedtr;\nstruct com_softc *sc = (void *)self;\nvoid *arg;\nstruct com_softc *sc = arg;\n\nvoid\ncom_raisedtr(arg)\n\tvoid *arg;\n{\n\tstruct com_softc *sc = arg;\n\n\tSET(sc->sc_mcr, MCR_DTR | MCR_RTS);\n\tbus_space_write_1(sc->sc_iot, sc->sc_ioh, com_mcr, sc->sc_mcr);\n}"
  },
  {
    "function_name": "compwroff",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "969-1009",
    "snippet": "void\ncompwroff(sc)\n\tstruct com_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\n\tCLR(sc->sc_lcr, LCR_SBREAK);\n\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\tbus_space_write_1(iot, ioh, com_ier, 0);\n\tif (ISSET(tp->t_cflag, HUPCL) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR)) {\n\t\t/* XXX perhaps only clear DTR */\n\t\tsc->sc_mcr = 0;\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Turn FIFO off; enter sleep mode if possible.\n\t */\n\tbus_space_write_1(iot, ioh, com_fifo, 0);\n\tdelay(100);\n\t(void) bus_space_read_1(iot, ioh, com_data);\n\tdelay(100);\n\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t  FIFO_RCV_RST | FIFO_XMT_RST);\n\n\tswitch (sc->sc_uarttype) {\n\tcase COM_UART_ST16650:\n\tcase COM_UART_ST16650V2:\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\tbreak;\n\tcase COM_UART_TI16750:\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tcom_lcr\tcom_cfcr"
    ],
    "globals_used": [
      "void\tcompwroff",
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "IER_SLEEP"
          ],
          "line": 1006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "0"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "IER_SLEEP"
          ],
          "line": 1002
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_efr",
            "EFR_ECB"
          ],
          "line": 1001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "0xbf"
          ],
          "line": 1000
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "FIFO_RCV_RST | FIFO_XMT_RST"
          ],
          "line": 994
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "100"
          ],
          "line": 993
        },
        "resolved": true,
        "details": {
          "function_name": "dc_delay",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/dc.c",
          "lines": "215-222",
          "snippet": "void dc_delay(sc)\n\tstruct dc_softc\t\t*sc;\n{\n\tint\t\t\tidx;\n\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\tCSR_READ_4(sc, DC_BUSCTL);\n}",
          "includes": [
            "#include <dev/ic/dcreg.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <dev/mii/miivar.h>",
            "#include <dev/mii/mii.h>",
            "#include <vm/pmap.h>            /* for vtophys */",
            "#include <vm/vm.h>              /* for vtophys */",
            "#include <net/bpf.h>",
            "#include <net/if_media.h>",
            "#include <netinet/if_ether.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_var.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_types.h>",
            "#include <net/if_dl.h>",
            "#include <net/if.h>",
            "#include <sys/device.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/protosw.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"bpfilter.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void dc_delay"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/dcreg.h>\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <dev/mii/miivar.h>\n#include <dev/mii/mii.h>\n#include <vm/pmap.h>            /* for vtophys */\n#include <vm/vm.h>              /* for vtophys */\n#include <net/bpf.h>\n#include <net/if_media.h>\n#include <netinet/if_ether.h>\n#include <netinet/ip.h>\n#include <netinet/in_var.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_types.h>\n#include <net/if_dl.h>\n#include <net/if.h>\n#include <sys/device.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/protosw.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"bpfilter.h\"\n\nvoid dc_delay;\n\nvoid dc_delay(sc)\n\tstruct dc_softc\t\t*sc;\n{\n\tint\t\t\tidx;\n\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\tCSR_READ_4(sc, DC_BUSCTL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_data"
          ],
          "line": 992
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "0"
          ],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_swflags",
            "COM_SW_SOFTCAR"
          ],
          "line": 981
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_cflag",
            "HUPCL"
          ],
          "line": 980
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "0"
          ],
          "line": 979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "sc->sc_lcr"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_lcr",
            "LCR_SBREAK"
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nvoid\tcompwroff;\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nvoid\ncompwroff(sc)\n\tstruct com_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\n\tCLR(sc->sc_lcr, LCR_SBREAK);\n\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\tbus_space_write_1(iot, ioh, com_ier, 0);\n\tif (ISSET(tp->t_cflag, HUPCL) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR)) {\n\t\t/* XXX perhaps only clear DTR */\n\t\tsc->sc_mcr = 0;\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Turn FIFO off; enter sleep mode if possible.\n\t */\n\tbus_space_write_1(iot, ioh, com_fifo, 0);\n\tdelay(100);\n\t(void) bus_space_read_1(iot, ioh, com_data);\n\tdelay(100);\n\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t  FIFO_RCV_RST | FIFO_XMT_RST);\n\n\tswitch (sc->sc_uarttype) {\n\tcase COM_UART_ST16650:\n\tcase COM_UART_ST16650V2:\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\tbreak;\n\tcase COM_UART_TI16750:\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "comclose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "925-967",
    "snippet": "int\ncomclose(dev, flag, mode, p)\n\tdev_t dev;\n\tint flag, mode;\n\tstruct proc *p;\n{\n\tint unit = DEVUNIT(dev);\n\tstruct com_softc *sc = com_cd.cd_devs[unit];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\tint s;\n\n\t/* XXX This is for cons.c. */\n\tif (!ISSET(tp->t_state, TS_ISOPEN))\n\t\treturn 0;\n\n\t(*linesw[tp->t_line].l_close)(tp, flag);\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_WOPEN)) {\n\t\t/* tty device is waiting for carrier; drop dtr then re-raise */\n\t\tCLR(sc->sc_mcr, MCR_DTR | MCR_RTS);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\ttimeout(com_raisedtr, sc, hz * 2);\n\t} else {\n\t\t/* no one else waiting; turn off the uart */\n\t\tcompwroff(sc);\n\t}\n\tCLR(tp->t_state, TS_BUSY | TS_FLUSH);\n\tif (--comsopen == 0)\n\t\tuntimeout(compoll, NULL);\n\tsc->sc_cua = 0;\n\tsplx(s);\n\tttyclose(tp);\n\n#ifdef notyet /* XXXX */\n\tif (ISSET(sc->sc_hwflags, COM_HW_CONSOLE)) {\n\t\tttyfree(tp);\n\t\tsc->sc_tty = 0;\n\t}\n#endif\n\treturn 0;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\tcompwroff",
      "void\tcom_raisedtr",
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "int\tcomsopen = 0;",
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ttyfree",
          "args": [
            "tp"
          ],
          "line": 962
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_CONSOLE"
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ttyclose",
          "args": [
            "tp"
          ],
          "line": 958
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 957
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "untimeout",
          "args": [
            "compoll",
            "NULL"
          ],
          "line": 955
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "tp->t_state",
            "TS_BUSY | TS_FLUSH"
          ],
          "line": 953
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "compwroff",
          "args": [
            "sc"
          ],
          "line": 951
        },
        "resolved": true,
        "details": {
          "function_name": "compwroff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "969-1009",
          "snippet": "void\ncompwroff(sc)\n\tstruct com_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\n\tCLR(sc->sc_lcr, LCR_SBREAK);\n\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\tbus_space_write_1(iot, ioh, com_ier, 0);\n\tif (ISSET(tp->t_cflag, HUPCL) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR)) {\n\t\t/* XXX perhaps only clear DTR */\n\t\tsc->sc_mcr = 0;\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Turn FIFO off; enter sleep mode if possible.\n\t */\n\tbus_space_write_1(iot, ioh, com_fifo, 0);\n\tdelay(100);\n\t(void) bus_space_read_1(iot, ioh, com_data);\n\tdelay(100);\n\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t  FIFO_RCV_RST | FIFO_XMT_RST);\n\n\tswitch (sc->sc_uarttype) {\n\tcase COM_UART_ST16650:\n\tcase COM_UART_ST16650V2:\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\tbreak;\n\tcase COM_UART_TI16750:\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "void\tcompwroff",
            "struct com_softc *sc = (void *)self;",
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "struct com_softc *sc = arg;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;",
            "struct tty *tp;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nvoid\tcompwroff;\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nvoid\ncompwroff(sc)\n\tstruct com_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\n\tCLR(sc->sc_lcr, LCR_SBREAK);\n\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\tbus_space_write_1(iot, ioh, com_ier, 0);\n\tif (ISSET(tp->t_cflag, HUPCL) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR)) {\n\t\t/* XXX perhaps only clear DTR */\n\t\tsc->sc_mcr = 0;\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Turn FIFO off; enter sleep mode if possible.\n\t */\n\tbus_space_write_1(iot, ioh, com_fifo, 0);\n\tdelay(100);\n\t(void) bus_space_read_1(iot, ioh, com_data);\n\tdelay(100);\n\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t  FIFO_RCV_RST | FIFO_XMT_RST);\n\n\tswitch (sc->sc_uarttype) {\n\tcase COM_UART_ST16650:\n\tcase COM_UART_ST16650V2:\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\tbreak;\n\tcase COM_UART_TI16750:\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "timeout",
          "args": [
            "com_raisedtr",
            "sc",
            "hz * 2"
          ],
          "line": 948
        },
        "resolved": true,
        "details": {
          "function_name": "wdctimeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/wdc.c",
          "lines": "952-980",
          "snippet": "void\nwdctimeout(arg)\n\tvoid *arg;\n{\n\tstruct channel_softc *chp = (struct channel_softc *)arg;\n\tstruct wdc_xfer *xfer = chp->ch_queue->sc_xfer.tqh_first;\n\tint s;\n\n\tWDCDEBUG_PRINT((\"wdctimeout\\n\"), DEBUG_FUNCS);\n\n\ts = splbio();\n\tif ((chp->ch_flags & WDCF_IRQ_WAIT) != 0) {\n\t\t__wdcerror(chp, \"timeout\");\n\t\tprintf(\"\\ttype: %s\\n\", (xfer->c_flags & C_ATAPI) ?\n\t\t    \"atapi\":\"ata\");\n\t\tprintf(\"\\tc_bcount: %d\\n\", xfer->c_bcount);\n\t\tprintf(\"\\tc_skip: %d\\n\", xfer->c_skip);\n\t\t/*\n\t\t * Call the interrupt routine. If we just missed and interrupt,\n\t\t * it will do what's needed. Else, it will take the needed\n\t\t * action (reset the device).\n\t\t */\n\t\txfer->c_flags |= C_TIMEOU;\n\t\tchp->ch_flags &= ~WDCF_IRQ_WAIT;\n\t\txfer->c_intr(chp, xfer, 1);\n\t} else\n\t\t__wdcerror(chp, \"missing untimeout\");\n\tsplx(s);\n}",
          "includes": [
            "#include \"atapiscsi.h\"",
            "#include <dev/ic/wdcvar.h>",
            "#include <dev/ic/wdcreg.h>",
            "#include <dev/ata/atareg.h>",
            "#include <dev/ata/atavar.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <vm/vm.h>",
            "#include <sys/proc.h>",
            "#include <sys/syslog.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/buf.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define DEBUG_FUNCS  0x08"
          ],
          "globals_used": [
            "static void  __wdcerror"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"atapiscsi.h\"\n#include <dev/ic/wdcvar.h>\n#include <dev/ic/wdcreg.h>\n#include <dev/ata/atareg.h>\n#include <dev/ata/atavar.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <vm/vm.h>\n#include <sys/proc.h>\n#include <sys/syslog.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/buf.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define DEBUG_FUNCS  0x08\n\nstatic void  __wdcerror;\n\nvoid\nwdctimeout(arg)\n\tvoid *arg;\n{\n\tstruct channel_softc *chp = (struct channel_softc *)arg;\n\tstruct wdc_xfer *xfer = chp->ch_queue->sc_xfer.tqh_first;\n\tint s;\n\n\tWDCDEBUG_PRINT((\"wdctimeout\\n\"), DEBUG_FUNCS);\n\n\ts = splbio();\n\tif ((chp->ch_flags & WDCF_IRQ_WAIT) != 0) {\n\t\t__wdcerror(chp, \"timeout\");\n\t\tprintf(\"\\ttype: %s\\n\", (xfer->c_flags & C_ATAPI) ?\n\t\t    \"atapi\":\"ata\");\n\t\tprintf(\"\\tc_bcount: %d\\n\", xfer->c_bcount);\n\t\tprintf(\"\\tc_skip: %d\\n\", xfer->c_skip);\n\t\t/*\n\t\t * Call the interrupt routine. If we just missed and interrupt,\n\t\t * it will do what's needed. Else, it will take the needed\n\t\t * action (reset the device).\n\t\t */\n\t\txfer->c_flags |= C_TIMEOU;\n\t\tchp->ch_flags &= ~WDCF_IRQ_WAIT;\n\t\txfer->c_intr(chp, xfer, 1);\n\t} else\n\t\t__wdcerror(chp, \"missing untimeout\");\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 947
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "sc->sc_mcr",
            "MCR_DTR | MCR_RTS"
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_WOPEN"
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "tp",
            "flag"
          ],
          "line": 942
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_ISOPEN"
          ],
          "line": 939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "dev"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nvoid\tcompwroff;\nvoid\tcom_raisedtr;\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nint\tcomsopen = 0;\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nint\ncomclose(dev, flag, mode, p)\n\tdev_t dev;\n\tint flag, mode;\n\tstruct proc *p;\n{\n\tint unit = DEVUNIT(dev);\n\tstruct com_softc *sc = com_cd.cd_devs[unit];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\tint s;\n\n\t/* XXX This is for cons.c. */\n\tif (!ISSET(tp->t_state, TS_ISOPEN))\n\t\treturn 0;\n\n\t(*linesw[tp->t_line].l_close)(tp, flag);\n\ts = spltty();\n\tif (ISSET(tp->t_state, TS_WOPEN)) {\n\t\t/* tty device is waiting for carrier; drop dtr then re-raise */\n\t\tCLR(sc->sc_mcr, MCR_DTR | MCR_RTS);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\ttimeout(com_raisedtr, sc, hz * 2);\n\t} else {\n\t\t/* no one else waiting; turn off the uart */\n\t\tcompwroff(sc);\n\t}\n\tCLR(tp->t_state, TS_BUSY | TS_FLUSH);\n\tif (--comsopen == 0)\n\t\tuntimeout(compoll, NULL);\n\tsc->sc_cua = 0;\n\tsplx(s);\n\tttyclose(tp);\n\n#ifdef notyet /* XXXX */\n\tif (ISSET(sc->sc_hwflags, COM_HW_CONSOLE)) {\n\t\tttyfree(tp);\n\t\tsc->sc_tty = 0;\n\t}\n#endif\n\treturn 0;\n}"
  },
  {
    "function_name": "comopen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "707-923",
    "snippet": "int\ncomopen(dev, flag, mode, p)\n\tdev_t dev;\n\tint flag, mode;\n\tstruct proc *p;\n{\n\tint unit = DEVUNIT(dev);\n\tstruct com_softc *sc;\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tstruct tty *tp;\n\tint s;\n\tint error = 0;\n \n\tif (unit >= com_cd.cd_ndevs)\n\t\treturn ENXIO;\n\tsc = com_cd.cd_devs[unit];\n\tif (!sc)\n\t\treturn ENXIO;\n\n\ts = spltty();\n\tif (!sc->sc_tty) {\n\t\ttp = sc->sc_tty = ttymalloc();\n\t\ttty_attach(tp);\n\t} else\n\t\ttp = sc->sc_tty;\n\tsplx(s);\n\n\ttp->t_oproc = comstart;\n\ttp->t_param = comparam;\n\ttp->t_dev = dev;\n\tif (!ISSET(tp->t_state, TS_ISOPEN)) {\n\t\tSET(tp->t_state, TS_WOPEN);\n\t\tttychars(tp);\n\t\ttp->t_iflag = TTYDEF_IFLAG;\n\t\ttp->t_oflag = TTYDEF_OFLAG;\n\t\tif (ISSET(sc->sc_hwflags, COM_HW_CONSOLE))\n\t\t\ttp->t_cflag = comconscflag;\n\t\telse\n\t\t\ttp->t_cflag = TTYDEF_CFLAG;\n\t\tif (ISSET(sc->sc_swflags, COM_SW_CLOCAL))\n\t\t\tSET(tp->t_cflag, CLOCAL);\n\t\tif (ISSET(sc->sc_swflags, COM_SW_CRTSCTS))\n\t\t\tSET(tp->t_cflag, CRTSCTS);\n\t\tif (ISSET(sc->sc_swflags, COM_SW_MDMBUF))\n\t\t\tSET(tp->t_cflag, MDMBUF);\n\t\ttp->t_lflag = TTYDEF_LFLAG;\n\t\ttp->t_ispeed = tp->t_ospeed = comdefaultrate;\n\n\t\ts = spltty();\n\n\t\tsc->sc_initialize = 1;\n\t\tcomparam(tp, &tp->t_termios);\n\t\tttsetwater(tp);\n\n\t\tif (comsopen++ == 0)\n\t\t\ttimeout(compoll, NULL, 1);\n\n\t\tsc->sc_ibufp = sc->sc_ibuf = sc->sc_ibufs[0];\n\t\tsc->sc_ibufhigh = sc->sc_ibuf + COM_IHIGHWATER;\n\t\tsc->sc_ibufend = sc->sc_ibuf + COM_IBUFSIZE;\n\n\t\tiot = sc->sc_iot;\n\t\tioh = sc->sc_ioh;\n\n\t\t/*\n\t\t * Wake up the sleepy heads.\n\t\t */\n\t\tswitch (sc->sc_uarttype) {\n\t\tcase COM_UART_ST16650:\n\t\tcase COM_UART_ST16650V2:\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\t\tbus_space_write_1(iot, ioh, com_ier, 0);\n\t\t\tbus_space_write_1(iot, ioh, com_efr, 0);\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\t\tbreak;\n\t\tcase COM_UART_TI16750:\n\t\t\tbus_space_write_1(iot, ioh, com_ier, 0);\n\t\t\tbreak;\n\t\t}\n\n#ifdef COM_HAYESP\n\t\t/* Setup the ESP board */\n\t\tif (ISSET(sc->sc_hwflags, COM_HW_HAYESP)) {\n\t\t\tbus_space_handle_t hayespioh = sc->sc_hayespioh;\n\n\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t    FIFO_DMA_MODE|FIFO_ENABLE|\n\t\t\t    FIFO_RCV_RST|FIFO_XMT_RST|FIFO_TRIGGER_8);\n\n\t\t\t/* Set 16550 compatibility mode */\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_SETMODE);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, \n\t\t\t    HAYESP_MODE_FIFO|HAYESP_MODE_RTS|\n\t\t\t    HAYESP_MODE_SCALE);\n\n\t\t\t/* Set RTS/CTS flow control */\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_SETFLOWTYPE);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, HAYESP_FLOW_RTS);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, HAYESP_FLOW_CTS);\n\n\t\t\t/* Set flow control levels */\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_SETRXFLOW);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, \n\t\t\t    HAYESP_HIBYTE(HAYESP_RXHIWMARK));\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2,\n\t\t\t    HAYESP_LOBYTE(HAYESP_RXHIWMARK));\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2,\n\t\t\t    HAYESP_HIBYTE(HAYESP_RXLOWMARK));\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2,\n\t\t\t    HAYESP_LOBYTE(HAYESP_RXLOWMARK));\n\t\t} else\n#endif\n\t\tif (ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n\t\t\tu_int8_t fifo = FIFO_ENABLE|FIFO_RCV_RST|FIFO_XMT_RST;\n\t\t\tu_int8_t lcr;\n\n\t\t\tif (tp->t_ispeed <= 1200)\n\t\t\t\tfifo |= FIFO_TRIGGER_1;\n\t\t\telse\n\t\t\t\tfifo |= FIFO_TRIGGER_8;\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750) {\n\t\t\t\tfifo |= FIFO_ENABLE_64BYTE;\n\t\t\t\tlcr = bus_space_read_1(iot, ioh, com_lcr);\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr,\n\t\t\t\t    lcr | LCR_DLAB);\n\t\t\t}\n\n\t\t\t/*\n\t\t\t * (Re)enable and drain FIFOs.\n\t\t\t *\n\t\t\t * Certain SMC chips cause problems if the FIFOs are\n\t\t\t * enabled while input is ready. Turn off the FIFO\n\t\t\t * if necessary to clear the input. Test the input\n\t\t\t * ready bit after enabling the FIFOs to handle races\n\t\t\t * between enabling and fresh input.\n\t\t\t *\n\t\t\t * Set the FIFO threshold based on the receive speed.\n\t\t\t */\n\t\t\tfor (;;) {\n\t\t\t \tbus_space_write_1(iot, ioh, com_fifo, 0);\n\t\t\t\tdelay(100);\n\t\t\t\t(void) bus_space_read_1(iot, ioh, com_data);\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo, fifo |\n\t\t\t\t    FIFO_RCV_RST | FIFO_XMT_RST);\n\t\t\t\tdelay(100);\n\t\t\t\tif(!ISSET(bus_space_read_1(iot, ioh,\n\t\t\t\t    com_lsr), LSR_RXRDY))\n\t\t\t\t    \tbreak;\n\t\t\t}\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750)\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t}\n\n\t\t/* flush any pending I/O */\n\t\twhile (ISSET(bus_space_read_1(iot, ioh, com_lsr), LSR_RXRDY))\n\t\t\t(void) bus_space_read_1(iot, ioh, com_data);\n\t\t/* you turn me on, baby */\n\t\tsc->sc_mcr = MCR_DTR | MCR_RTS;\n\t\tif (!ISSET(sc->sc_hwflags, COM_HW_NOIEN))\n\t\t\tSET(sc->sc_mcr, MCR_IENABLE);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tsc->sc_ier = IER_ERXRDY | IER_ERLS | IER_EMSC;\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\n\t\tsc->sc_msr = bus_space_read_1(iot, ioh, com_msr);\n\t\tif (ISSET(sc->sc_swflags, COM_SW_SOFTCAR) || DEVCUA(dev) ||\n\t\t    ISSET(sc->sc_msr, MSR_DCD) || ISSET(tp->t_cflag, MDMBUF))\n\t\t\tSET(tp->t_state, TS_CARR_ON);\n\t\telse\n\t\t\tCLR(tp->t_state, TS_CARR_ON);\n\t} else if (ISSET(tp->t_state, TS_XCLUDE) && p->p_ucred->cr_uid != 0)\n\t\treturn EBUSY;\n\telse\n\t\ts = spltty();\n\n\tif (DEVCUA(dev)) {\n\t\tif (ISSET(tp->t_state, TS_ISOPEN)) {\n\t\t\t/* Ah, but someone already is dialed in... */\n\t\t\tsplx(s);\n\t\t\treturn EBUSY;\n\t\t}\n\t\tsc->sc_cua = 1;\t\t/* We go into CUA mode */\n\t} else {\n\t\t/* tty (not cua) device; wait for carrier if necessary */\n\t\tif (ISSET(flag, O_NONBLOCK)) {\n\t\t\tif (sc->sc_cua) {\n\t\t\t\t/* Opening TTY non-blocking... but the CUA is busy */\n\t\t\t\tsplx(s);\n\t\t\t\treturn EBUSY;\n\t\t\t}\n\t\t} else {\n\t\t\twhile (sc->sc_cua ||\n\t\t\t    (!ISSET(tp->t_cflag, CLOCAL) &&\n\t\t\t\t!ISSET(tp->t_state, TS_CARR_ON))) {\n\t\t\t\tSET(tp->t_state, TS_WOPEN);\n\t\t\t\terror = ttysleep(tp, &tp->t_rawq, TTIPRI | PCATCH, ttopen, 0);\n\t\t\t\t/*\n\t\t\t\t * If TS_WOPEN has been reset, that means the cua device\n\t\t\t\t * has been closed.  We don't want to fail in that case,\n\t\t\t\t * so just go around again.\n\t\t\t\t */\n\t\t\t\tif (error && ISSET(tp->t_state, TS_WOPEN)) {\n\t\t\t\t\tCLR(tp->t_state, TS_WOPEN);\n\t\t\t\t\tif (!sc->sc_cua && !ISSET(tp->t_state, TS_ISOPEN))\n\t\t\t\t\t\tcompwroff(sc);\n\t\t\t\t\tsplx(s);\n\t\t\t\t\treturn error;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tsplx(s);\n\n\treturn (*linesw[tp->t_line].l_open)(dev, tp);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tcom_lcr\tcom_cfcr"
    ],
    "globals_used": [
      "void\tcompwroff",
      "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
      "tcflag_t comconscflag = TTYDEF_CFLAG;",
      "int\tcomsopen = 0;",
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "u_int8_t lcr;",
      "struct tty *\ncomtty(dev)\n\tdev_t dev;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;",
      "struct tty *tp;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "dev",
            "tp"
          ],
          "line": 922
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "compwroff",
          "args": [
            "sc"
          ],
          "line": 913
        },
        "resolved": true,
        "details": {
          "function_name": "compwroff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "969-1009",
          "snippet": "void\ncompwroff(sc)\n\tstruct com_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\n\tCLR(sc->sc_lcr, LCR_SBREAK);\n\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\tbus_space_write_1(iot, ioh, com_ier, 0);\n\tif (ISSET(tp->t_cflag, HUPCL) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR)) {\n\t\t/* XXX perhaps only clear DTR */\n\t\tsc->sc_mcr = 0;\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Turn FIFO off; enter sleep mode if possible.\n\t */\n\tbus_space_write_1(iot, ioh, com_fifo, 0);\n\tdelay(100);\n\t(void) bus_space_read_1(iot, ioh, com_data);\n\tdelay(100);\n\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t  FIFO_RCV_RST | FIFO_XMT_RST);\n\n\tswitch (sc->sc_uarttype) {\n\tcase COM_UART_ST16650:\n\tcase COM_UART_ST16650V2:\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\tbreak;\n\tcase COM_UART_TI16750:\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "void\tcompwroff",
            "struct com_softc *sc = (void *)self;",
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "struct com_softc *sc = arg;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;",
            "struct tty *tp;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nvoid\tcompwroff;\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nvoid\ncompwroff(sc)\n\tstruct com_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tstruct tty *tp = sc->sc_tty;\n\n\tCLR(sc->sc_lcr, LCR_SBREAK);\n\tbus_space_write_1(iot, ioh, com_lcr, sc->sc_lcr);\n\tbus_space_write_1(iot, ioh, com_ier, 0);\n\tif (ISSET(tp->t_cflag, HUPCL) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR)) {\n\t\t/* XXX perhaps only clear DTR */\n\t\tsc->sc_mcr = 0;\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Turn FIFO off; enter sleep mode if possible.\n\t */\n\tbus_space_write_1(iot, ioh, com_fifo, 0);\n\tdelay(100);\n\t(void) bus_space_read_1(iot, ioh, com_data);\n\tdelay(100);\n\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t  FIFO_RCV_RST | FIFO_XMT_RST);\n\n\tswitch (sc->sc_uarttype) {\n\tcase COM_UART_ST16650:\n\tcase COM_UART_ST16650V2:\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\tbreak;\n\tcase COM_UART_TI16750:\n\t\tbus_space_write_1(iot, ioh, com_ier, IER_SLEEP);\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_ISOPEN"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "tp->t_state",
            "TS_WOPEN"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_WOPEN"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ttysleep",
          "args": [
            "tp",
            "&tp->t_rawq",
            "TTIPRI | PCATCH",
            "ttopen",
            "0"
          ],
          "line": 904
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_state",
            "TS_WOPEN"
          ],
          "line": 903
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_CARR_ON"
          ],
          "line": 902
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_cflag",
            "CLOCAL"
          ],
          "line": 901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 896
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "flag",
            "O_NONBLOCK"
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_ISOPEN"
          ],
          "line": 885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVCUA",
          "args": [
            "dev"
          ],
          "line": 884
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 882
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_XCLUDE"
          ],
          "line": 879
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CLR",
          "args": [
            "tp->t_state",
            "TS_CARR_ON"
          ],
          "line": 878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_state",
            "TS_CARR_ON"
          ],
          "line": 876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_cflag",
            "MDMBUF"
          ],
          "line": 875
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_msr",
            "MSR_DCD"
          ],
          "line": 875
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVCUA",
          "args": [
            "dev"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_swflags",
            "COM_SW_SOFTCAR"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_msr"
          ],
          "line": 873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "sc->sc_ier"
          ],
          "line": 871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_mcr",
            "sc->sc_mcr"
          ],
          "line": 869
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_mcr",
            "MCR_IENABLE"
          ],
          "line": 868
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_NOIEN"
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_data"
          ],
          "line": 864
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "bus_space_read_1(iot, ioh, com_lsr)",
            "LSR_RXRDY"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_lsr"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr"
          ],
          "line": 859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "bus_space_read_1(iot, ioh,\n\t\t\t\t    com_lsr)",
            "LSR_RXRDY"
          ],
          "line": 854
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_lsr"
          ],
          "line": 854
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "100"
          ],
          "line": 853
        },
        "resolved": true,
        "details": {
          "function_name": "dc_delay",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/dc.c",
          "lines": "215-222",
          "snippet": "void dc_delay(sc)\n\tstruct dc_softc\t\t*sc;\n{\n\tint\t\t\tidx;\n\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\tCSR_READ_4(sc, DC_BUSCTL);\n}",
          "includes": [
            "#include <dev/ic/dcreg.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <dev/mii/miivar.h>",
            "#include <dev/mii/mii.h>",
            "#include <vm/pmap.h>            /* for vtophys */",
            "#include <vm/vm.h>              /* for vtophys */",
            "#include <net/bpf.h>",
            "#include <net/if_media.h>",
            "#include <netinet/if_ether.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_var.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_types.h>",
            "#include <net/if_dl.h>",
            "#include <net/if.h>",
            "#include <sys/device.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/protosw.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"bpfilter.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void dc_delay"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/dcreg.h>\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <dev/mii/miivar.h>\n#include <dev/mii/mii.h>\n#include <vm/pmap.h>            /* for vtophys */\n#include <vm/vm.h>              /* for vtophys */\n#include <net/bpf.h>\n#include <net/if_media.h>\n#include <netinet/if_ether.h>\n#include <netinet/ip.h>\n#include <netinet/in_var.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_types.h>\n#include <net/if_dl.h>\n#include <net/if.h>\n#include <sys/device.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/protosw.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"bpfilter.h\"\n\nvoid dc_delay;\n\nvoid dc_delay(sc)\n\tstruct dc_softc\t\t*sc;\n{\n\tint\t\t\tidx;\n\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\tCSR_READ_4(sc, DC_BUSCTL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "fifo |\n\t\t\t\t    FIFO_RCV_RST | FIFO_XMT_RST"
          ],
          "line": 851
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_data"
          ],
          "line": 850
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "0"
          ],
          "line": 848
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "lcr | LCR_DLAB"
          ],
          "line": 832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_FIFO"
          ],
          "line": 821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_LOBYTE(HAYESP_RXLOWMARK)"
          ],
          "line": 817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HAYESP_LOBYTE",
          "args": [
            "HAYESP_RXLOWMARK"
          ],
          "line": 818
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_HIBYTE(HAYESP_RXLOWMARK)"
          ],
          "line": 815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HAYESP_HIBYTE",
          "args": [
            "HAYESP_RXLOWMARK"
          ],
          "line": 816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_LOBYTE(HAYESP_RXHIWMARK)"
          ],
          "line": 813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HAYESP_LOBYTE",
          "args": [
            "HAYESP_RXHIWMARK"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_HIBYTE(HAYESP_RXHIWMARK)"
          ],
          "line": 811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HAYESP_HIBYTE",
          "args": [
            "HAYESP_RXHIWMARK"
          ],
          "line": 812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD1",
            "HAYESP_SETRXFLOW"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_FLOW_CTS"
          ],
          "line": 807
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_FLOW_RTS"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD1",
            "HAYESP_SETFLOWTYPE"
          ],
          "line": 805
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD2",
            "HAYESP_MODE_FIFO|HAYESP_MODE_RTS|\n\t\t\t    HAYESP_MODE_SCALE"
          ],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD1",
            "HAYESP_SETMODE"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_fifo",
            "FIFO_DMA_MODE|FIFO_ENABLE|\n\t\t\t    FIFO_RCV_RST|FIFO_XMT_RST|FIFO_TRIGGER_8"
          ],
          "line": 794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_HAYESP"
          ],
          "line": 791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "0"
          ],
          "line": 785
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "0"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_efr",
            "0"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_ier",
            "0"
          ],
          "line": 780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_efr",
            "EFR_ECB"
          ],
          "line": 779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "0xbf"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "timeout",
          "args": [
            "compoll",
            "NULL",
            "1"
          ],
          "line": 763
        },
        "resolved": true,
        "details": {
          "function_name": "wdctimeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/wdc.c",
          "lines": "952-980",
          "snippet": "void\nwdctimeout(arg)\n\tvoid *arg;\n{\n\tstruct channel_softc *chp = (struct channel_softc *)arg;\n\tstruct wdc_xfer *xfer = chp->ch_queue->sc_xfer.tqh_first;\n\tint s;\n\n\tWDCDEBUG_PRINT((\"wdctimeout\\n\"), DEBUG_FUNCS);\n\n\ts = splbio();\n\tif ((chp->ch_flags & WDCF_IRQ_WAIT) != 0) {\n\t\t__wdcerror(chp, \"timeout\");\n\t\tprintf(\"\\ttype: %s\\n\", (xfer->c_flags & C_ATAPI) ?\n\t\t    \"atapi\":\"ata\");\n\t\tprintf(\"\\tc_bcount: %d\\n\", xfer->c_bcount);\n\t\tprintf(\"\\tc_skip: %d\\n\", xfer->c_skip);\n\t\t/*\n\t\t * Call the interrupt routine. If we just missed and interrupt,\n\t\t * it will do what's needed. Else, it will take the needed\n\t\t * action (reset the device).\n\t\t */\n\t\txfer->c_flags |= C_TIMEOU;\n\t\tchp->ch_flags &= ~WDCF_IRQ_WAIT;\n\t\txfer->c_intr(chp, xfer, 1);\n\t} else\n\t\t__wdcerror(chp, \"missing untimeout\");\n\tsplx(s);\n}",
          "includes": [
            "#include \"atapiscsi.h\"",
            "#include <dev/ic/wdcvar.h>",
            "#include <dev/ic/wdcreg.h>",
            "#include <dev/ata/atareg.h>",
            "#include <dev/ata/atavar.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <vm/vm.h>",
            "#include <sys/proc.h>",
            "#include <sys/syslog.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/buf.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define DEBUG_FUNCS  0x08"
          ],
          "globals_used": [
            "static void  __wdcerror"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"atapiscsi.h\"\n#include <dev/ic/wdcvar.h>\n#include <dev/ic/wdcreg.h>\n#include <dev/ata/atareg.h>\n#include <dev/ata/atavar.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <vm/vm.h>\n#include <sys/proc.h>\n#include <sys/syslog.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/buf.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define DEBUG_FUNCS  0x08\n\nstatic void  __wdcerror;\n\nvoid\nwdctimeout(arg)\n\tvoid *arg;\n{\n\tstruct channel_softc *chp = (struct channel_softc *)arg;\n\tstruct wdc_xfer *xfer = chp->ch_queue->sc_xfer.tqh_first;\n\tint s;\n\n\tWDCDEBUG_PRINT((\"wdctimeout\\n\"), DEBUG_FUNCS);\n\n\ts = splbio();\n\tif ((chp->ch_flags & WDCF_IRQ_WAIT) != 0) {\n\t\t__wdcerror(chp, \"timeout\");\n\t\tprintf(\"\\ttype: %s\\n\", (xfer->c_flags & C_ATAPI) ?\n\t\t    \"atapi\":\"ata\");\n\t\tprintf(\"\\tc_bcount: %d\\n\", xfer->c_bcount);\n\t\tprintf(\"\\tc_skip: %d\\n\", xfer->c_skip);\n\t\t/*\n\t\t * Call the interrupt routine. If we just missed and interrupt,\n\t\t * it will do what's needed. Else, it will take the needed\n\t\t * action (reset the device).\n\t\t */\n\t\txfer->c_flags |= C_TIMEOU;\n\t\tchp->ch_flags &= ~WDCF_IRQ_WAIT;\n\t\txfer->c_intr(chp, xfer, 1);\n\t} else\n\t\t__wdcerror(chp, \"missing untimeout\");\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ttsetwater",
          "args": [
            "tp"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comparam",
          "args": [
            "tp",
            "&tp->t_termios"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "comparam",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "1188-1333",
          "snippet": "int\ncomparam(tp, t)\n\tstruct tty *tp;\n\tstruct termios *t;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint ospeed = comspeed(t->c_ospeed);\n\tu_char lcr;\n\ttcflag_t oldcflag;\n\tint s;\n\n\t/* check requested parameters */\n\tif (ospeed < 0 || (t->c_ispeed && t->c_ispeed != t->c_ospeed))\n\t\treturn EINVAL;\n\n\tlcr = ISSET(sc->sc_lcr, LCR_SBREAK);\n\n\tswitch (ISSET(t->c_cflag, CSIZE)) {\n\tcase CS5:\n\t\tSET(lcr, LCR_5BITS);\n\t\tbreak;\n\tcase CS6:\n\t\tSET(lcr, LCR_6BITS);\n\t\tbreak;\n\tcase CS7:\n\t\tSET(lcr, LCR_7BITS);\n\t\tbreak;\n\tcase CS8:\n\t\tSET(lcr, LCR_8BITS);\n\t\tbreak;\n\t}\n\tif (ISSET(t->c_cflag, PARENB)) {\n\t\tSET(lcr, LCR_PENAB);\n\t\tif (!ISSET(t->c_cflag, PARODD))\n\t\t\tSET(lcr, LCR_PEVEN);\n\t}\n\tif (ISSET(t->c_cflag, CSTOPB))\n\t\tSET(lcr, LCR_STOPB);\n\n\tsc->sc_lcr = lcr;\n\n\ts = spltty();\n\n\tif (ospeed == 0) {\n\t\tCLR(sc->sc_mcr, MCR_DTR);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Set the FIFO threshold based on the receive speed, if we are\n\t * changing it.\n\t */\n\tif (sc->sc_initialize || (tp->t_ispeed != t->c_ispeed)) {\n\t\tsc->sc_initialize = 0;\n\n\t\tif (ospeed != 0) {\n\t\t\t/*\n\t\t\t * Make sure the transmit FIFO is empty before\n\t\t\t * proceeding.  If we don't do this, some revisions\n\t\t\t * of the UART will hang.  Interestingly enough,\n\t\t\t * even if we do this while the last character is\n\t\t\t * still being pushed out, they don't hang.  This\n\t\t\t * seems good enough.\n\t\t\t */\n\t\t\twhile (ISSET(tp->t_state, TS_BUSY)) {\n\t\t\t\tint error;\n\n\t\t\t\t++sc->sc_halt;\n\t\t\t\terror = ttysleep(tp, &tp->t_outq,\n\t\t\t\t    TTOPRI | PCATCH, \"comprm\", 0);\n\t\t\t\t--sc->sc_halt;\n\t\t\t\tif (error) {\n\t\t\t\t\tsplx(s);\n\t\t\t\t\tcomstart(tp);\n\t\t\t\t\treturn (error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr | LCR_DLAB);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbl, ospeed);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbh, ospeed >> 8);\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\tSET(sc->sc_mcr, MCR_DTR);\n\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t} else\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t\tif (!ISSET(sc->sc_hwflags, COM_HW_HAYESP) &&\n\t\t    ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750) {\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr,\n\t\t\t\t    lcr | LCR_DLAB);\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE | FIFO_ENABLE_64BYTE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\t} else\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t}\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t/* When not using CRTSCTS, RTS follows DTR. */\n\tif (!ISSET(t->c_cflag, CRTSCTS)) {\n\t\tif (ISSET(sc->sc_mcr, MCR_DTR)) {\n\t\t\tif (!ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tSET(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t} else {\n\t\t\tif (ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tCLR(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t}\n\t\tsc->sc_dtr = MCR_DTR | MCR_RTS;\n\t} else\n\t\tsc->sc_dtr = MCR_DTR;\n\n\t/* and copy to tty */\n\ttp->t_ispeed = t->c_ispeed;\n\ttp->t_ospeed = t->c_ospeed;\n\toldcflag = tp->t_cflag;\n\ttp->t_cflag = t->c_cflag;\n\n\t/*\n\t * If DCD is off and MDMBUF is changed, ask the tty layer if we should\n\t * stop the device.\n\t */\n\tif (!ISSET(sc->sc_msr, MSR_DCD) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR) &&\n\t    ISSET(oldcflag, MDMBUF) != ISSET(tp->t_cflag, MDMBUF) &&\n\t    (*linesw[tp->t_line].l_modem)(tp, 0) == 0) {\n\t\tCLR(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/* Just to be sure... */\n\tsplx(s);\n\tcomstart(tp);\n\treturn 0;\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "struct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};",
            "struct com_softc *sc = (void *)self;",
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "u_int8_t lcr;",
            "struct com_softc *sc = arg;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;",
            "struct tty *tp;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nu_int8_t lcr;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nint\ncomparam(tp, t)\n\tstruct tty *tp;\n\tstruct termios *t;\n{\n\tstruct com_softc *sc = com_cd.cd_devs[DEVUNIT(tp->t_dev)];\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint ospeed = comspeed(t->c_ospeed);\n\tu_char lcr;\n\ttcflag_t oldcflag;\n\tint s;\n\n\t/* check requested parameters */\n\tif (ospeed < 0 || (t->c_ispeed && t->c_ispeed != t->c_ospeed))\n\t\treturn EINVAL;\n\n\tlcr = ISSET(sc->sc_lcr, LCR_SBREAK);\n\n\tswitch (ISSET(t->c_cflag, CSIZE)) {\n\tcase CS5:\n\t\tSET(lcr, LCR_5BITS);\n\t\tbreak;\n\tcase CS6:\n\t\tSET(lcr, LCR_6BITS);\n\t\tbreak;\n\tcase CS7:\n\t\tSET(lcr, LCR_7BITS);\n\t\tbreak;\n\tcase CS8:\n\t\tSET(lcr, LCR_8BITS);\n\t\tbreak;\n\t}\n\tif (ISSET(t->c_cflag, PARENB)) {\n\t\tSET(lcr, LCR_PENAB);\n\t\tif (!ISSET(t->c_cflag, PARODD))\n\t\t\tSET(lcr, LCR_PEVEN);\n\t}\n\tif (ISSET(t->c_cflag, CSTOPB))\n\t\tSET(lcr, LCR_STOPB);\n\n\tsc->sc_lcr = lcr;\n\n\ts = spltty();\n\n\tif (ospeed == 0) {\n\t\tCLR(sc->sc_mcr, MCR_DTR);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/*\n\t * Set the FIFO threshold based on the receive speed, if we are\n\t * changing it.\n\t */\n\tif (sc->sc_initialize || (tp->t_ispeed != t->c_ispeed)) {\n\t\tsc->sc_initialize = 0;\n\n\t\tif (ospeed != 0) {\n\t\t\t/*\n\t\t\t * Make sure the transmit FIFO is empty before\n\t\t\t * proceeding.  If we don't do this, some revisions\n\t\t\t * of the UART will hang.  Interestingly enough,\n\t\t\t * even if we do this while the last character is\n\t\t\t * still being pushed out, they don't hang.  This\n\t\t\t * seems good enough.\n\t\t\t */\n\t\t\twhile (ISSET(tp->t_state, TS_BUSY)) {\n\t\t\t\tint error;\n\n\t\t\t\t++sc->sc_halt;\n\t\t\t\terror = ttysleep(tp, &tp->t_outq,\n\t\t\t\t    TTOPRI | PCATCH, \"comprm\", 0);\n\t\t\t\t--sc->sc_halt;\n\t\t\t\tif (error) {\n\t\t\t\t\tsplx(s);\n\t\t\t\t\tcomstart(tp);\n\t\t\t\t\treturn (error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr | LCR_DLAB);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbl, ospeed);\n\t\t\tbus_space_write_1(iot, ioh, com_dlbh, ospeed >> 8);\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\tSET(sc->sc_mcr, MCR_DTR);\n\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t} else\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t\tif (!ISSET(sc->sc_hwflags, COM_HW_HAYESP) &&\n\t\t    ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750) {\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr,\n\t\t\t\t    lcr | LCR_DLAB);\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE | FIFO_ENABLE_64BYTE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t\t} else\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t\t    FIFO_ENABLE |\n\t\t\t\t    (t->c_ispeed <= 1200 ? FIFO_TRIGGER_1 : FIFO_TRIGGER_8));\n\t\t}\n\t} else\n\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\n\t/* When not using CRTSCTS, RTS follows DTR. */\n\tif (!ISSET(t->c_cflag, CRTSCTS)) {\n\t\tif (ISSET(sc->sc_mcr, MCR_DTR)) {\n\t\t\tif (!ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tSET(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t} else {\n\t\t\tif (ISSET(sc->sc_mcr, MCR_RTS)) {\n\t\t\t\tCLR(sc->sc_mcr, MCR_RTS);\n\t\t\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\t\t}\n\t\t}\n\t\tsc->sc_dtr = MCR_DTR | MCR_RTS;\n\t} else\n\t\tsc->sc_dtr = MCR_DTR;\n\n\t/* and copy to tty */\n\ttp->t_ispeed = t->c_ispeed;\n\ttp->t_ospeed = t->c_ospeed;\n\toldcflag = tp->t_cflag;\n\ttp->t_cflag = t->c_cflag;\n\n\t/*\n\t * If DCD is off and MDMBUF is changed, ask the tty layer if we should\n\t * stop the device.\n\t */\n\tif (!ISSET(sc->sc_msr, MSR_DCD) &&\n\t    !ISSET(sc->sc_swflags, COM_SW_SOFTCAR) &&\n\t    ISSET(oldcflag, MDMBUF) != ISSET(tp->t_cflag, MDMBUF) &&\n\t    (*linesw[tp->t_line].l_modem)(tp, 0) == 0) {\n\t\tCLR(sc->sc_mcr, sc->sc_dtr);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t}\n\n\t/* Just to be sure... */\n\tsplx(s);\n\tcomstart(tp);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_cflag",
            "MDMBUF"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_swflags",
            "COM_SW_MDMBUF"
          ],
          "line": 751
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_cflag",
            "CRTSCTS"
          ],
          "line": 750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_swflags",
            "COM_SW_CRTSCTS"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_cflag",
            "CLOCAL"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_swflags",
            "COM_SW_CLOCAL"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_CONSOLE"
          ],
          "line": 743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ttychars",
          "args": [
            "tp"
          ],
          "line": 740
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "tp->t_state",
            "TS_WOPEN"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSET",
          "args": [
            "tp->t_state",
            "TS_ISOPEN"
          ],
          "line": 738
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tty_attach",
          "args": [
            "tp"
          ],
          "line": 730
        },
        "resolved": true,
        "details": {
          "function_name": "zstty_attach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/z8530tty.c",
          "lines": "210-303",
          "snippet": "void \nzstty_attach(parent, self, aux)\n\tstruct device *parent, *self;\n\tvoid   *aux;\n\n{\n\tstruct zsc_softc *zsc = (void *) parent;\n\tstruct zstty_softc *zst = (void *) self;\n\tstruct zsc_attach_args *args = aux;\n\tstruct zs_chanstate *cs;\n\tstruct cfdata *cf;\n\tstruct tty *tp;\n\tint channel, tty_unit;\n\tdev_t dev;\n\n\tcf = zst->zst_dev.dv_cfdata;\n\ttty_unit = zst->zst_dev.dv_unit;\n\tchannel = args->channel;\n\tcs = &zsc->zsc_cs[channel];\n\tcs->cs_private = zst;\n\tcs->cs_ops = &zsops_tty;\n\n\tzst->zst_cs = cs;\n\tzst->zst_swflags = cf->cf_flags;\t/* softcar, etc. */\n\tzst->zst_hwflags = args->hwflags;\n\tdev = makedev(ZSTTY_MAJOR, tty_unit);\n\n\tif (zst->zst_swflags)\n\t\tprintf(\" flags 0x%x\", zst->zst_swflags);\n\n\tif (zst->zst_hwflags & ZS_HWFLAG_CONSOLE)\n\t\tprintf(\" (console)\");\n\telse {\n#ifdef KGDB\n\t\t/*\n\t\t * Allow kgdb to \"take over\" this port.  If this port is\n\t\t * NOT the kgdb port, zs_check_kgdb() will return zero.\n\t\t * If it IS the kgdb port, it will print \"kgdb,...\\n\"\n\t\t * and then return non-zero.\n\t\t */\n\t\tif (zs_check_kgdb(cs, dev)) {\n\t\t\t/*\n\t\t\t * This is the kgdb port (exclusive use)\n\t\t\t * so skip the normal attach code.\n\t\t\t */\n\t\t\treturn;\n\t\t}\n#endif\n\t}\n\tprintf(\"\\n\");\n\n\ttp = ttymalloc();\n\ttp->t_dev = dev;\n\ttp->t_oproc = zsstart;\n\ttp->t_param = zsparam;\n\ttp->t_hwiflow = zshwiflow;\n\ttty_attach(tp);\n\n\tzst->zst_tty = tp;\n\tzst->zst_rbhiwat =  zstty_rbuf_size;\t/* impossible value */\n\tzst->zst_ringmask = zstty_rbuf_size - 1;\n\tzst->zst_rbuf = malloc(zstty_rbuf_size * sizeof(zst->zst_rbuf[0]),\n\t\t\t      M_DEVBUF, M_WAITOK);\n\n\t/*\n\t * Hardware init\n\t */\n\tif (zst->zst_hwflags & ZS_HWFLAG_CONSOLE) {\n\t\t/* This unit is the console. */\n\t\tzst->zst_swflags |= TIOCFLAG_SOFTCAR;\n\t\t/* Call _param so interrupts get enabled. */\n\t\tcs->cs_defspeed = zs_getspeed(cs);\n\t\ttp->t_ispeed = cs->cs_defspeed;\n\t\ttp->t_ospeed = cs->cs_defspeed;\n\t\ttp->t_cflag = ZSTTY_DEF_CFLAG;\n\t\t(void) zsparam(tp, &tp->t_termios);\n\t} else {\n\t\t/* Not the console; may need reset. */\n\t\tint reset, s;\n\t\treset = (channel == 0) ?\n\t\t\tZSWR9_A_RESET : ZSWR9_B_RESET;\n\t\ts = splzs();\n\t\tzs_write_reg(cs, 9, reset);\n\t\tsplx(s);\n\t}\n\n\t/*\n\t * Initialize state of modem control lines (DTR).\n\t * If softcar is set, turn on DTR now and leave it.\n\t * otherwise, turn off DTR now, and raise in open.\n\t * (Keeps modem from answering too early.)\n\t */\n\tzs_modem(zst, (zst->zst_swflags & TIOCFLAG_SOFTCAR) ? 1 : 0);\n}",
          "includes": [
            "#include <machine/z8530var.h>",
            "#include <dev/ic/z8530reg.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/time.h>",
            "#include <sys/tty.h>",
            "#include <sys/malloc.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tZSTTY_DEF_CFLAG\tTTYDEF_CFLAG"
          ],
          "globals_used": [
            "int zstty_rbuf_size = ZSTTY_RING_SIZE;",
            "static int\tzstty_match(struct device *, void *, void *);",
            "static void\tzstty_attach(struct device *, struct device *, void *);",
            "struct zsops zsops_tty;",
            "static void\tzsstart",
            "static int\tzsparam",
            "static void\tzs_modem",
            "static int\tzshwiflow",
            "__P((register struct zs_chanstate *));",
            "__P((register struct zs_chanstate *));",
            "__P((register struct zs_chanstate *));",
            "struct tty *\nzstty(dev)\n\tdev_t dev;",
            "struct zsops zsops_tty = {\n\tzstty_rxint,\t/* receive char available */\n\tzstty_stint,\t/* external/status */\n\tzstty_txint,\t/* xmit buffer empty */\n\tzstty_softint,\t/* process software interrupt */\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <machine/z8530var.h>\n#include <dev/ic/z8530reg.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/time.h>\n#include <sys/tty.h>\n#include <sys/malloc.h>\n#include <sys/ioctl.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tZSTTY_DEF_CFLAG\tTTYDEF_CFLAG\n\nint zstty_rbuf_size = ZSTTY_RING_SIZE;\nstatic int\tzstty_match(struct device *, void *, void *);\nstatic void\tzstty_attach(struct device *, struct device *, void *);\nstruct zsops zsops_tty;\nstatic void\tzsstart;\nstatic int\tzsparam;\nstatic void\tzs_modem;\nstatic int\tzshwiflow;\n__P((register struct zs_chanstate *));\n__P((register struct zs_chanstate *));\n__P((register struct zs_chanstate *));\nstruct tty *\nzstty(dev)\n\tdev_t dev;\nstruct zsops zsops_tty = {\n\tzstty_rxint,\t/* receive char available */\n\tzstty_stint,\t/* external/status */\n\tzstty_txint,\t/* xmit buffer empty */\n\tzstty_softint,\t/* process software interrupt */\n};\n\nvoid \nzstty_attach(parent, self, aux)\n\tstruct device *parent, *self;\n\tvoid   *aux;\n\n{\n\tstruct zsc_softc *zsc = (void *) parent;\n\tstruct zstty_softc *zst = (void *) self;\n\tstruct zsc_attach_args *args = aux;\n\tstruct zs_chanstate *cs;\n\tstruct cfdata *cf;\n\tstruct tty *tp;\n\tint channel, tty_unit;\n\tdev_t dev;\n\n\tcf = zst->zst_dev.dv_cfdata;\n\ttty_unit = zst->zst_dev.dv_unit;\n\tchannel = args->channel;\n\tcs = &zsc->zsc_cs[channel];\n\tcs->cs_private = zst;\n\tcs->cs_ops = &zsops_tty;\n\n\tzst->zst_cs = cs;\n\tzst->zst_swflags = cf->cf_flags;\t/* softcar, etc. */\n\tzst->zst_hwflags = args->hwflags;\n\tdev = makedev(ZSTTY_MAJOR, tty_unit);\n\n\tif (zst->zst_swflags)\n\t\tprintf(\" flags 0x%x\", zst->zst_swflags);\n\n\tif (zst->zst_hwflags & ZS_HWFLAG_CONSOLE)\n\t\tprintf(\" (console)\");\n\telse {\n#ifdef KGDB\n\t\t/*\n\t\t * Allow kgdb to \"take over\" this port.  If this port is\n\t\t * NOT the kgdb port, zs_check_kgdb() will return zero.\n\t\t * If it IS the kgdb port, it will print \"kgdb,...\\n\"\n\t\t * and then return non-zero.\n\t\t */\n\t\tif (zs_check_kgdb(cs, dev)) {\n\t\t\t/*\n\t\t\t * This is the kgdb port (exclusive use)\n\t\t\t * so skip the normal attach code.\n\t\t\t */\n\t\t\treturn;\n\t\t}\n#endif\n\t}\n\tprintf(\"\\n\");\n\n\ttp = ttymalloc();\n\ttp->t_dev = dev;\n\ttp->t_oproc = zsstart;\n\ttp->t_param = zsparam;\n\ttp->t_hwiflow = zshwiflow;\n\ttty_attach(tp);\n\n\tzst->zst_tty = tp;\n\tzst->zst_rbhiwat =  zstty_rbuf_size;\t/* impossible value */\n\tzst->zst_ringmask = zstty_rbuf_size - 1;\n\tzst->zst_rbuf = malloc(zstty_rbuf_size * sizeof(zst->zst_rbuf[0]),\n\t\t\t      M_DEVBUF, M_WAITOK);\n\n\t/*\n\t * Hardware init\n\t */\n\tif (zst->zst_hwflags & ZS_HWFLAG_CONSOLE) {\n\t\t/* This unit is the console. */\n\t\tzst->zst_swflags |= TIOCFLAG_SOFTCAR;\n\t\t/* Call _param so interrupts get enabled. */\n\t\tcs->cs_defspeed = zs_getspeed(cs);\n\t\ttp->t_ispeed = cs->cs_defspeed;\n\t\ttp->t_ospeed = cs->cs_defspeed;\n\t\ttp->t_cflag = ZSTTY_DEF_CFLAG;\n\t\t(void) zsparam(tp, &tp->t_termios);\n\t} else {\n\t\t/* Not the console; may need reset. */\n\t\tint reset, s;\n\t\treset = (channel == 0) ?\n\t\t\tZSWR9_A_RESET : ZSWR9_B_RESET;\n\t\ts = splzs();\n\t\tzs_write_reg(cs, 9, reset);\n\t\tsplx(s);\n\t}\n\n\t/*\n\t * Initialize state of modem control lines (DTR).\n\t * If softcar is set, turn on DTR now and leave it.\n\t * otherwise, turn off DTR now, and raise in open.\n\t * (Keeps modem from answering too early.)\n\t */\n\tzs_modem(zst, (zst->zst_swflags & TIOCFLAG_SOFTCAR) ? 1 : 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ttymalloc",
          "args": [],
          "line": 729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEVUNIT",
          "args": [
            "dev"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nvoid\tcompwroff;\nstruct cfdriver com_cd = {\n\tNULL, \"com\", DV_TTY\n};\ntcflag_t comconscflag = TTYDEF_CFLAG;\nint\tcomsopen = 0;\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nu_int8_t lcr;\nstruct tty *\ncomtty(dev)\n\tdev_t dev;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\nstruct tty *tp;\n\nint\ncomopen(dev, flag, mode, p)\n\tdev_t dev;\n\tint flag, mode;\n\tstruct proc *p;\n{\n\tint unit = DEVUNIT(dev);\n\tstruct com_softc *sc;\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tstruct tty *tp;\n\tint s;\n\tint error = 0;\n \n\tif (unit >= com_cd.cd_ndevs)\n\t\treturn ENXIO;\n\tsc = com_cd.cd_devs[unit];\n\tif (!sc)\n\t\treturn ENXIO;\n\n\ts = spltty();\n\tif (!sc->sc_tty) {\n\t\ttp = sc->sc_tty = ttymalloc();\n\t\ttty_attach(tp);\n\t} else\n\t\ttp = sc->sc_tty;\n\tsplx(s);\n\n\ttp->t_oproc = comstart;\n\ttp->t_param = comparam;\n\ttp->t_dev = dev;\n\tif (!ISSET(tp->t_state, TS_ISOPEN)) {\n\t\tSET(tp->t_state, TS_WOPEN);\n\t\tttychars(tp);\n\t\ttp->t_iflag = TTYDEF_IFLAG;\n\t\ttp->t_oflag = TTYDEF_OFLAG;\n\t\tif (ISSET(sc->sc_hwflags, COM_HW_CONSOLE))\n\t\t\ttp->t_cflag = comconscflag;\n\t\telse\n\t\t\ttp->t_cflag = TTYDEF_CFLAG;\n\t\tif (ISSET(sc->sc_swflags, COM_SW_CLOCAL))\n\t\t\tSET(tp->t_cflag, CLOCAL);\n\t\tif (ISSET(sc->sc_swflags, COM_SW_CRTSCTS))\n\t\t\tSET(tp->t_cflag, CRTSCTS);\n\t\tif (ISSET(sc->sc_swflags, COM_SW_MDMBUF))\n\t\t\tSET(tp->t_cflag, MDMBUF);\n\t\ttp->t_lflag = TTYDEF_LFLAG;\n\t\ttp->t_ispeed = tp->t_ospeed = comdefaultrate;\n\n\t\ts = spltty();\n\n\t\tsc->sc_initialize = 1;\n\t\tcomparam(tp, &tp->t_termios);\n\t\tttsetwater(tp);\n\n\t\tif (comsopen++ == 0)\n\t\t\ttimeout(compoll, NULL, 1);\n\n\t\tsc->sc_ibufp = sc->sc_ibuf = sc->sc_ibufs[0];\n\t\tsc->sc_ibufhigh = sc->sc_ibuf + COM_IHIGHWATER;\n\t\tsc->sc_ibufend = sc->sc_ibuf + COM_IBUFSIZE;\n\n\t\tiot = sc->sc_iot;\n\t\tioh = sc->sc_ioh;\n\n\t\t/*\n\t\t * Wake up the sleepy heads.\n\t\t */\n\t\tswitch (sc->sc_uarttype) {\n\t\tcase COM_UART_ST16650:\n\t\tcase COM_UART_ST16650V2:\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, 0xbf);\n\t\t\tbus_space_write_1(iot, ioh, com_efr, EFR_ECB);\n\t\t\tbus_space_write_1(iot, ioh, com_ier, 0);\n\t\t\tbus_space_write_1(iot, ioh, com_efr, 0);\n\t\t\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\t\t\tbreak;\n\t\tcase COM_UART_TI16750:\n\t\t\tbus_space_write_1(iot, ioh, com_ier, 0);\n\t\t\tbreak;\n\t\t}\n\n#ifdef COM_HAYESP\n\t\t/* Setup the ESP board */\n\t\tif (ISSET(sc->sc_hwflags, COM_HW_HAYESP)) {\n\t\t\tbus_space_handle_t hayespioh = sc->sc_hayespioh;\n\n\t\t\tbus_space_write_1(iot, ioh, com_fifo,\n\t\t\t    FIFO_DMA_MODE|FIFO_ENABLE|\n\t\t\t    FIFO_RCV_RST|FIFO_XMT_RST|FIFO_TRIGGER_8);\n\n\t\t\t/* Set 16550 compatibility mode */\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_SETMODE);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, \n\t\t\t    HAYESP_MODE_FIFO|HAYESP_MODE_RTS|\n\t\t\t    HAYESP_MODE_SCALE);\n\n\t\t\t/* Set RTS/CTS flow control */\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_SETFLOWTYPE);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, HAYESP_FLOW_RTS);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, HAYESP_FLOW_CTS);\n\n\t\t\t/* Set flow control levels */\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_SETRXFLOW);\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2, \n\t\t\t    HAYESP_HIBYTE(HAYESP_RXHIWMARK));\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2,\n\t\t\t    HAYESP_LOBYTE(HAYESP_RXHIWMARK));\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2,\n\t\t\t    HAYESP_HIBYTE(HAYESP_RXLOWMARK));\n\t\t\tbus_space_write_1(iot, hayespioh, HAYESP_CMD2,\n\t\t\t    HAYESP_LOBYTE(HAYESP_RXLOWMARK));\n\t\t} else\n#endif\n\t\tif (ISSET(sc->sc_hwflags, COM_HW_FIFO)) {\n\t\t\tu_int8_t fifo = FIFO_ENABLE|FIFO_RCV_RST|FIFO_XMT_RST;\n\t\t\tu_int8_t lcr;\n\n\t\t\tif (tp->t_ispeed <= 1200)\n\t\t\t\tfifo |= FIFO_TRIGGER_1;\n\t\t\telse\n\t\t\t\tfifo |= FIFO_TRIGGER_8;\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750) {\n\t\t\t\tfifo |= FIFO_ENABLE_64BYTE;\n\t\t\t\tlcr = bus_space_read_1(iot, ioh, com_lcr);\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr,\n\t\t\t\t    lcr | LCR_DLAB);\n\t\t\t}\n\n\t\t\t/*\n\t\t\t * (Re)enable and drain FIFOs.\n\t\t\t *\n\t\t\t * Certain SMC chips cause problems if the FIFOs are\n\t\t\t * enabled while input is ready. Turn off the FIFO\n\t\t\t * if necessary to clear the input. Test the input\n\t\t\t * ready bit after enabling the FIFOs to handle races\n\t\t\t * between enabling and fresh input.\n\t\t\t *\n\t\t\t * Set the FIFO threshold based on the receive speed.\n\t\t\t */\n\t\t\tfor (;;) {\n\t\t\t \tbus_space_write_1(iot, ioh, com_fifo, 0);\n\t\t\t\tdelay(100);\n\t\t\t\t(void) bus_space_read_1(iot, ioh, com_data);\n\t\t\t\tbus_space_write_1(iot, ioh, com_fifo, fifo |\n\t\t\t\t    FIFO_RCV_RST | FIFO_XMT_RST);\n\t\t\t\tdelay(100);\n\t\t\t\tif(!ISSET(bus_space_read_1(iot, ioh,\n\t\t\t\t    com_lsr), LSR_RXRDY))\n\t\t\t\t    \tbreak;\n\t\t\t}\n\t\t\tif (sc->sc_uarttype == COM_UART_TI16750)\n\t\t\t\tbus_space_write_1(iot, ioh, com_lcr, lcr);\n\t\t}\n\n\t\t/* flush any pending I/O */\n\t\twhile (ISSET(bus_space_read_1(iot, ioh, com_lsr), LSR_RXRDY))\n\t\t\t(void) bus_space_read_1(iot, ioh, com_data);\n\t\t/* you turn me on, baby */\n\t\tsc->sc_mcr = MCR_DTR | MCR_RTS;\n\t\tif (!ISSET(sc->sc_hwflags, COM_HW_NOIEN))\n\t\t\tSET(sc->sc_mcr, MCR_IENABLE);\n\t\tbus_space_write_1(iot, ioh, com_mcr, sc->sc_mcr);\n\t\tsc->sc_ier = IER_ERXRDY | IER_ERLS | IER_EMSC;\n\t\tbus_space_write_1(iot, ioh, com_ier, sc->sc_ier);\n\n\t\tsc->sc_msr = bus_space_read_1(iot, ioh, com_msr);\n\t\tif (ISSET(sc->sc_swflags, COM_SW_SOFTCAR) || DEVCUA(dev) ||\n\t\t    ISSET(sc->sc_msr, MSR_DCD) || ISSET(tp->t_cflag, MDMBUF))\n\t\t\tSET(tp->t_state, TS_CARR_ON);\n\t\telse\n\t\t\tCLR(tp->t_state, TS_CARR_ON);\n\t} else if (ISSET(tp->t_state, TS_XCLUDE) && p->p_ucred->cr_uid != 0)\n\t\treturn EBUSY;\n\telse\n\t\ts = spltty();\n\n\tif (DEVCUA(dev)) {\n\t\tif (ISSET(tp->t_state, TS_ISOPEN)) {\n\t\t\t/* Ah, but someone already is dialed in... */\n\t\t\tsplx(s);\n\t\t\treturn EBUSY;\n\t\t}\n\t\tsc->sc_cua = 1;\t\t/* We go into CUA mode */\n\t} else {\n\t\t/* tty (not cua) device; wait for carrier if necessary */\n\t\tif (ISSET(flag, O_NONBLOCK)) {\n\t\t\tif (sc->sc_cua) {\n\t\t\t\t/* Opening TTY non-blocking... but the CUA is busy */\n\t\t\t\tsplx(s);\n\t\t\t\treturn EBUSY;\n\t\t\t}\n\t\t} else {\n\t\t\twhile (sc->sc_cua ||\n\t\t\t    (!ISSET(tp->t_cflag, CLOCAL) &&\n\t\t\t\t!ISSET(tp->t_state, TS_CARR_ON))) {\n\t\t\t\tSET(tp->t_state, TS_WOPEN);\n\t\t\t\terror = ttysleep(tp, &tp->t_rawq, TTIPRI | PCATCH, ttopen, 0);\n\t\t\t\t/*\n\t\t\t\t * If TS_WOPEN has been reset, that means the cua device\n\t\t\t\t * has been closed.  We don't want to fail in that case,\n\t\t\t\t * so just go around again.\n\t\t\t\t */\n\t\t\t\tif (error && ISSET(tp->t_state, TS_WOPEN)) {\n\t\t\t\t\tCLR(tp->t_state, TS_WOPEN);\n\t\t\t\t\tif (!sc->sc_cua && !ISSET(tp->t_state, TS_ISOPEN))\n\t\t\t\t\t\tcompwroff(sc);\n\t\t\t\t\tsplx(s);\n\t\t\t\t\treturn error;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tsplx(s);\n\n\treturn (*linesw[tp->t_line].l_open)(dev, tp);\n}"
  },
  {
    "function_name": "com_activate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "677-705",
    "snippet": "int\ncom_activate(self, act)\n\tstruct device *self;\n\tenum devact act;\n{\n\tstruct com_softc *sc = (struct com_softc *)self;\n\tint s, rv = 0;\n\n\ts = spltty();\n\tswitch (act) {\n\tcase DVACT_ACTIVATE:\n\t\trv = EOPNOTSUPP;\n\t\tbreak;\n\n\tcase DVACT_DEACTIVATE:\n\t\tif (sc->sc_hwflags & COM_HW_CONSOLE) {\n\t\t\trv = EBUSY;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (sc->disable != NULL && sc->enabled != 0) {\n\t\t\t(*sc->disable)(sc);\n\t\t\tsc->enabled = 0;\n\t\t}\n\t\tbreak;\n\t}\n\tsplx(s);\n\treturn (rv);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct device *parent, *self;",
      "struct com_softc *sc = (void *)self;",
      "struct com_softc *sc = arg;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 703
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "sc"
          ],
          "line": 698
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spltty",
          "args": [],
          "line": 685
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct device *parent, *self;\nstruct com_softc *sc = (void *)self;\nstruct com_softc *sc = arg;\n\nint\ncom_activate(self, act)\n\tstruct device *self;\n\tenum devact act;\n{\n\tstruct com_softc *sc = (struct com_softc *)self;\n\tint s, rv = 0;\n\n\ts = spltty();\n\tswitch (act) {\n\tcase DVACT_ACTIVATE:\n\t\trv = EOPNOTSUPP;\n\t\tbreak;\n\n\tcase DVACT_DEACTIVATE:\n\t\tif (sc->sc_hwflags & COM_HW_CONSOLE) {\n\t\t\trv = EBUSY;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (sc->disable != NULL && sc->enabled != 0) {\n\t\t\t(*sc->disable)(sc);\n\t\t\tsc->enabled = 0;\n\t\t}\n\t\tbreak;\n\t}\n\tsplx(s);\n\treturn (rv);\n}"
  },
  {
    "function_name": "com_detach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "643-675",
    "snippet": "int\ncom_detach(self, flags)\n\tstruct device *self;\n\tint flags;\n{\n\tstruct com_softc *sc = (struct com_softc *)self;\n\tint maj, mn;\n\n\t/* locate the major number */\n\tfor (maj = 0; maj < nchrdev; maj++)\n\t\tif (cdevsw[maj].d_open == comopen)\n\t\t\tbreak;\n\n\t/* Nuke the vnodes for any open instances. */\n\tmn = self->dv_unit;\n\tvdevgone(maj, mn, mn, VCHR);\n\n\t/* XXX a symbolic constant for the cua bit would be nicer. */\n\tmn |= 0x80;\n\tvdevgone(maj, mn, mn, VCHR);\n\n\t/* Detach and free the tty. */\n\tif (sc->sc_tty) {\n\t\ttty_detach(sc->sc_tty);\n\t\tttyfree(sc->sc_tty);\n\t}\n\n\tuntimeout(compoll, NULL);\n\tuntimeout(com_raisedtr, sc);\n\tuntimeout(comdiag, sc);\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\tcom_raisedtr",
      "struct device *parent, *self;",
      "struct com_softc *sc = (void *)self;",
      "struct com_softc *sc = arg;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "untimeout",
          "args": [
            "comdiag",
            "sc"
          ],
          "line": 672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "untimeout",
          "args": [
            "com_raisedtr",
            "sc"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "untimeout",
          "args": [
            "compoll",
            "NULL"
          ],
          "line": 670
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ttyfree",
          "args": [
            "sc->sc_tty"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tty_detach",
          "args": [
            "sc->sc_tty"
          ],
          "line": 666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vdevgone",
          "args": [
            "maj",
            "mn",
            "mn",
            "VCHR"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vdevgone",
          "args": [
            "maj",
            "mn",
            "mn",
            "VCHR"
          ],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nvoid\tcom_raisedtr;\nstruct device *parent, *self;\nstruct com_softc *sc = (void *)self;\nstruct com_softc *sc = arg;\n\nint\ncom_detach(self, flags)\n\tstruct device *self;\n\tint flags;\n{\n\tstruct com_softc *sc = (struct com_softc *)self;\n\tint maj, mn;\n\n\t/* locate the major number */\n\tfor (maj = 0; maj < nchrdev; maj++)\n\t\tif (cdevsw[maj].d_open == comopen)\n\t\t\tbreak;\n\n\t/* Nuke the vnodes for any open instances. */\n\tmn = self->dv_unit;\n\tvdevgone(maj, mn, mn, VCHR);\n\n\t/* XXX a symbolic constant for the cua bit would be nicer. */\n\tmn |= 0x80;\n\tvdevgone(maj, mn, mn, VCHR);\n\n\t/* Detach and free the tty. */\n\tif (sc->sc_tty) {\n\t\ttty_detach(sc->sc_tty);\n\t\tttyfree(sc->sc_tty);\n\t}\n\n\tuntimeout(compoll, NULL);\n\tuntimeout(com_raisedtr, sc);\n\tuntimeout(comdiag, sc);\n\n\treturn (0);\n}"
  },
  {
    "function_name": "comprobe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "308-374",
    "snippet": "int\ncomprobe(parent, match, aux)\n\tstruct device *parent;\n\tvoid *match, *aux;\n{\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint iobase, needioh;\n\tint rv = 1;\n\n\t/*\n\t * XXX should be broken out into functions for isa probe and\n\t * XXX for commulti probe, with a helper function that contains\n\t * XXX most of the interesting stuff.\n\t */\n#if NCOM_ISA || NCOM_ISAPNP\n\tif (IS_ISA(parent) || IS_ISAPNP(parent)) {\n\t\tstruct isa_attach_args *ia = aux;\n\n\t\tiot = ia->ia_iot;\n\t\tiobase = ia->ia_iobase;\n\t\tif (IS_ISAPNP(parent)) {\n\t\t\tioh = ia->ia_ioh;\n\t\t\tneedioh = 0;\n\t\t} else\n\t\t\tneedioh = 1;\n\t} else\n#endif\n#if NCOM_COMMULTI\n\tif (1) {\n\t\tstruct cfdata *cf = match;\n\t\tstruct commulti_attach_args *ca = aux;\n \n\t\tif (cf->cf_loc[0] != -1 && cf->cf_loc[0] != ca->ca_slave)\n\t\t\treturn (0);\n\n\t\tiot = ca->ca_iot;\n\t\tiobase = ca->ca_iobase;\n\t\tioh = ca->ca_ioh;\n\t\tneedioh = 0;\n\t} else\n#endif\n\t\treturn(0);\t\t\t/* This cannot happen */\n\n\t/* if it's in use as console, it's there. */\n\tif (iobase == comconsaddr && !comconsattached)\n\t\tgoto out;\n\n\tif (needioh && bus_space_map(iot, iobase, COM_NPORTS, 0, &ioh)) {\n\t\trv = 0;\n\t\tgoto out;\n\t}\n\trv = comprobe1(iot, ioh);\n\tif (needioh)\n\t\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\nout:\n#if NCOM_ISA\n\tif (rv && IS_ISA(parent)) {\n\t\tstruct isa_attach_args *ia = aux;\n\n\t\tia->ia_iosize = COM_NPORTS;\n\t\tia->ia_msize = 0;\n\t}\n#endif\n\treturn (rv);\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tcomprobe",
      "int\tcomconsaddr;",
      "int\tcomconsattached;",
      "void *aux;",
      "int iobase;",
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "IS_ISA",
          "args": [
            "parent"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_unmap",
          "args": [
            "iot",
            "ioh",
            "COM_NPORTS"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comprobe1",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "comprobe1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "220-241",
          "snippet": "int\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "iobase",
            "COM_NPORTS",
            "0",
            "&ioh"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ISAPNP",
          "args": [
            "parent"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ISAPNP",
          "args": [
            "parent"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ISA",
          "args": [
            "parent"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\tcomprobe;\nint\tcomconsaddr;\nint\tcomconsattached;\nvoid *aux;\nint iobase;\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomprobe(parent, match, aux)\n\tstruct device *parent;\n\tvoid *match, *aux;\n{\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tint iobase, needioh;\n\tint rv = 1;\n\n\t/*\n\t * XXX should be broken out into functions for isa probe and\n\t * XXX for commulti probe, with a helper function that contains\n\t * XXX most of the interesting stuff.\n\t */\n#if NCOM_ISA || NCOM_ISAPNP\n\tif (IS_ISA(parent) || IS_ISAPNP(parent)) {\n\t\tstruct isa_attach_args *ia = aux;\n\n\t\tiot = ia->ia_iot;\n\t\tiobase = ia->ia_iobase;\n\t\tif (IS_ISAPNP(parent)) {\n\t\t\tioh = ia->ia_ioh;\n\t\t\tneedioh = 0;\n\t\t} else\n\t\t\tneedioh = 1;\n\t} else\n#endif\n#if NCOM_COMMULTI\n\tif (1) {\n\t\tstruct cfdata *cf = match;\n\t\tstruct commulti_attach_args *ca = aux;\n \n\t\tif (cf->cf_loc[0] != -1 && cf->cf_loc[0] != ca->ca_slave)\n\t\t\treturn (0);\n\n\t\tiot = ca->ca_iot;\n\t\tiobase = ca->ca_iobase;\n\t\tioh = ca->ca_ioh;\n\t\tneedioh = 0;\n\t} else\n#endif\n\t\treturn(0);\t\t\t/* This cannot happen */\n\n\t/* if it's in use as console, it's there. */\n\tif (iobase == comconsaddr && !comconsattached)\n\t\tgoto out;\n\n\tif (needioh && bus_space_map(iot, iobase, COM_NPORTS, 0, &ioh)) {\n\t\trv = 0;\n\t\tgoto out;\n\t}\n\trv = comprobe1(iot, ioh);\n\tif (needioh)\n\t\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\nout:\n#if NCOM_ISA\n\tif (rv && IS_ISA(parent)) {\n\t\tstruct isa_attach_args *ia = aux;\n\n\t\tia->ia_iosize = COM_NPORTS;\n\t\tia->ia_msize = 0;\n\t}\n#endif\n\treturn (rv);\n}"
  },
  {
    "function_name": "comprobeHAYESP",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "244-305",
    "snippet": "int\ncomprobeHAYESP(hayespioh, sc)\n\tbus_space_handle_t hayespioh;\n\tstruct com_softc *sc;\n{\n\tchar\tval, dips;\n\tint\tcombaselist[] = { 0x3f8, 0x2f8, 0x3e8, 0x2e8 };\n\tbus_space_tag_t iot = sc->sc_iot;\n\n\t/*\n\t * Hayes ESP cards have two iobases.  One is for compatibility with\n\t * 16550 serial chips, and at the same ISA PC base addresses.  The\n\t * other is for ESP-specific enhanced features, and lies at a\n\t * different addressing range entirely (0x140, 0x180, 0x280, or 0x300).\n\t */\n\n\t/* Test for ESP signature */\n\tif ((bus_space_read_1(iot, hayespioh, 0) & 0xf3) == 0)\n\t\treturn 0;\n\n\t/*\n\t * ESP is present at ESP enhanced base address; unknown com port\n\t */\n\n\t/* Get the dip-switch configurations */\n\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_GETDIPS);\n\tdips = bus_space_read_1(iot, hayespioh, HAYESP_STATUS1);\n\n\t/* Determine which com port this ESP card services: bits 0,1 of  */\n\t/*  dips is the port # (0-3); combaselist[val] is the com_iobase */\n\tif (sc->sc_iobase != combaselist[dips & 0x03])\n\t\treturn 0;\n\n\tprintf(\": ESP\");\n\n \t/* Check ESP Self Test bits. */\n\t/* Check for ESP version 2.0: bits 4,5,6 == 010 */\n\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_GETTEST);\n\tval = bus_space_read_1(iot, hayespioh, HAYESP_STATUS1); /* Clear reg 1 */\n\tval = bus_space_read_1(iot, hayespioh, HAYESP_STATUS2);\n\tif ((val & 0x70) < 0x20) {\n\t\tprintf(\"-old (%o)\", val & 0x70);\n\t\t/* we do not support the necessary features */\n\t\treturn 0;\n\t}\n\n\t/* Check for ability to emulate 16550: bit 8 == 1 */\n\tif ((dips & 0x80) == 0) {\n\t\tprintf(\" slave\");\n\t\t/* XXX Does slave really mean no 16550 support?? */\n\t\treturn 0;\n\t}\n\n\t/*\n\t * If we made it this far, we are a full-featured ESP v2.0 (or\n\t * better), at the correct com port address.\n\t */\n\n\tSET(sc->sc_hwflags, COM_HW_HAYESP);\n\tprintf(\", 1024 byte fifo\\n\");\n\treturn 1;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct com_softc *sc = (void *)self;",
      "bus_space_tag_t iot;",
      "struct com_softc *sc = arg;",
      "bus_space_tag_t iot = sc->sc_iot;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\", 1024 byte fifo\\n\""
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "SET",
          "args": [
            "sc->sc_hwflags",
            "COM_HW_HAYESP"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_STATUS2"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_STATUS1"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD1",
            "HAYESP_GETTEST"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_STATUS1"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "hayespioh",
            "HAYESP_CMD1",
            "HAYESP_GETDIPS"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "hayespioh",
            "0"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct com_softc *sc = (void *)self;\nbus_space_tag_t iot;\nstruct com_softc *sc = arg;\nbus_space_tag_t iot = sc->sc_iot;\n\nint\ncomprobeHAYESP(hayespioh, sc)\n\tbus_space_handle_t hayespioh;\n\tstruct com_softc *sc;\n{\n\tchar\tval, dips;\n\tint\tcombaselist[] = { 0x3f8, 0x2f8, 0x3e8, 0x2e8 };\n\tbus_space_tag_t iot = sc->sc_iot;\n\n\t/*\n\t * Hayes ESP cards have two iobases.  One is for compatibility with\n\t * 16550 serial chips, and at the same ISA PC base addresses.  The\n\t * other is for ESP-specific enhanced features, and lies at a\n\t * different addressing range entirely (0x140, 0x180, 0x280, or 0x300).\n\t */\n\n\t/* Test for ESP signature */\n\tif ((bus_space_read_1(iot, hayespioh, 0) & 0xf3) == 0)\n\t\treturn 0;\n\n\t/*\n\t * ESP is present at ESP enhanced base address; unknown com port\n\t */\n\n\t/* Get the dip-switch configurations */\n\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_GETDIPS);\n\tdips = bus_space_read_1(iot, hayespioh, HAYESP_STATUS1);\n\n\t/* Determine which com port this ESP card services: bits 0,1 of  */\n\t/*  dips is the port # (0-3); combaselist[val] is the com_iobase */\n\tif (sc->sc_iobase != combaselist[dips & 0x03])\n\t\treturn 0;\n\n\tprintf(\": ESP\");\n\n \t/* Check ESP Self Test bits. */\n\t/* Check for ESP version 2.0: bits 4,5,6 == 010 */\n\tbus_space_write_1(iot, hayespioh, HAYESP_CMD1, HAYESP_GETTEST);\n\tval = bus_space_read_1(iot, hayespioh, HAYESP_STATUS1); /* Clear reg 1 */\n\tval = bus_space_read_1(iot, hayespioh, HAYESP_STATUS2);\n\tif ((val & 0x70) < 0x20) {\n\t\tprintf(\"-old (%o)\", val & 0x70);\n\t\t/* we do not support the necessary features */\n\t\treturn 0;\n\t}\n\n\t/* Check for ability to emulate 16550: bit 8 == 1 */\n\tif ((dips & 0x80) == 0) {\n\t\tprintf(\" slave\");\n\t\t/* XXX Does slave really mean no 16550 support?? */\n\t\treturn 0;\n\t}\n\n\t/*\n\t * If we made it this far, we are a full-featured ESP v2.0 (or\n\t * better), at the correct com port address.\n\t */\n\n\tSET(sc->sc_hwflags, COM_HW_HAYESP);\n\tprintf(\", 1024 byte fifo\\n\");\n\treturn 1;\n}"
  },
  {
    "function_name": "comprobe1",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "220-241",
    "snippet": "int\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tcom_lcr\tcom_cfcr"
    ],
    "globals_used": [
      "bus_space_tag_t iot;",
      "bus_space_handle_t ioh;",
      "bus_space_tag_t iot = sc->sc_iot;",
      "bus_space_handle_t ioh = sc->sc_ioh;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_data"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "com_iir"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_iir",
            "0"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "com_lcr",
            "0"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}"
  },
  {
    "function_name": "comspeed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
    "lines": "195-218",
    "snippet": "int\ncomspeed(speed)\n\tlong speed;\n{\n#define\tdivrnd(n, q)\t(((n)*2/(q)+1)/2)\t/* divide and round off */\n\n\tint x, err;\n\n\tif (speed == 0)\n\t\treturn 0;\n\tif (speed < 0)\n\t\treturn -1;\n\tx = divrnd((COM_FREQ / 16), speed);\n\tif (x <= 0)\n\t\treturn -1;\n\terr = divrnd((COM_FREQ / 16) * 1000, speed * x) - 1000;\n\tif (err < 0)\n\t\terr = -err;\n\tif (err > COM_TOLERANCE)\n\t\treturn -1;\n\treturn x;\n\n#undef\tdivrnd(n, q)\n}",
    "includes": [
      "#include <dev/cons.h>",
      "#include <machine/remote-sl.h>",
      "#include <dev/isa/isavar.h>\t/* XXX */",
      "#include \"com.h\"",
      "#include <dev/ic/hayespreg.h>",
      "#include <dev/ic/ns16550reg.h>",
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <ddb/db_var.h>",
      "#include <sys/vnode.h>",
      "#include <sys/device.h>",
      "#include <sys/types.h>",
      "#include <sys/syslog.h>",
      "#include <sys/kernel.h>",
      "#include <sys/uio.h>",
      "#include <sys/file.h>",
      "#include <sys/conf.h>",
      "#include <sys/user.h>",
      "#include <sys/proc.h>",
      "#include <sys/tty.h>",
      "#include <sys/select.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "divrnd",
          "args": [
            "(COM_FREQ / 16) * 1000",
            "speed * x"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "divrnd",
          "args": [
            "(COM_FREQ / 16)",
            "speed"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\ncomspeed(speed)\n\tlong speed;\n{\n#define\tdivrnd(n, q)\t(((n)*2/(q)+1)/2)\t/* divide and round off */\n\n\tint x, err;\n\n\tif (speed == 0)\n\t\treturn 0;\n\tif (speed < 0)\n\t\treturn -1;\n\tx = divrnd((COM_FREQ / 16), speed);\n\tif (x <= 0)\n\t\treturn -1;\n\terr = divrnd((COM_FREQ / 16) * 1000, speed * x) - 1000;\n\tif (err < 0)\n\t\terr = -err;\n\tif (err > COM_TOLERANCE)\n\t\treturn -1;\n\treturn x;\n\n#undef\tdivrnd(n, q)\n}"
  }
]