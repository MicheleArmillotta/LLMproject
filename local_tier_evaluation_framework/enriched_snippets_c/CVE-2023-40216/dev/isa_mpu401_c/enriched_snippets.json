[
  {
    "function_name": "mpu_intr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "243-255",
    "snippet": "int\nmpu_intr(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n\tif (MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_INPUT_EMPTY) {\n\t\tDPRINTF((\"mpu_intr: no data\\n\"));\n\t\treturn 0;\n\t}\n\tmpu_readinput(sc);\n\treturn 1;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define  MPU_INPUT_EMPTY\t0x80"
    ],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "mpu_readinput",
          "args": [
            "sc"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_readinput",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "196-210",
          "snippet": "void\nmpu_readinput(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint data;\n\n\twhile(!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY)) {\n\t\tdata = bus_space_read_1(iot, ioh, MPU_DATA);\n\t\tDPRINTFN(3, (\"mpu_rea: sc=%p 0x%02x\\n\", sc, data));\n\t\tif (sc->intr)\n\t\t\tsc->intr(sc->arg, data);\n\t}\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define  MPU_INPUT_EMPTY\t0x80",
            "#define MPU_DATA\t\t0"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_INPUT_EMPTY\t0x80\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nvoid\nmpu_readinput(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint data;\n\n\twhile(!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY)) {\n\t\tdata = bus_space_read_1(iot, ioh, MPU_DATA);\n\t\tDPRINTFN(3, (\"mpu_rea: sc=%p 0x%02x\\n\", sc, data));\n\t\tif (sc->intr)\n\t\t\tsc->intr(sc->arg, data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_intr: no data\\n\")"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MPU_GETSTATUS",
          "args": [
            "sc->iot",
            "sc->ioh"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_INPUT_EMPTY\t0x80\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_intr(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n\tif (MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_INPUT_EMPTY) {\n\t\tDPRINTF((\"mpu_intr: no data\\n\"));\n\t\treturn 0;\n\t}\n\tmpu_readinput(sc);\n\treturn 1;\n}"
  },
  {
    "function_name": "mpu_getinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "234-241",
    "snippet": "void\nmpu_getinfo(addr, mi)\n\tvoid *addr;\n\tstruct midi_info *mi;\n{\n\tmi->name = \"MPU-401 MIDI UART\";\n\tmi->props = 0;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nvoid\nmpu_getinfo(addr, mi)\n\tvoid *addr;\n\tstruct midi_info *mi;\n{\n\tmi->name = \"MPU-401 MIDI UART\";\n\tmi->props = 0;\n}"
  },
  {
    "function_name": "mpu_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "212-232",
    "snippet": "int\nmpu_output(v, d)\n\tvoid *v;\n\tint d;\n{\n\tstruct mpu_softc *sc = v;\n\tint s;\n\n\tDPRINTFN(3, (\"mpu_output: sc=%p 0x%02x\\n\", sc, d));\n\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_INPUT_EMPTY)) {\n\t\ts = splaudio();\n\t\tmpu_readinput(sc);\n\t\tsplx(s);\n\t}\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_output: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\tbus_space_write_1(sc->iot, sc->ioh, MPU_DATA, d);\n\treturn 0;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define  MPU_INPUT_EMPTY\t0x80",
      "#define MPU_DATA\t\t0"
    ],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "sc->iot",
            "sc->ioh",
            "MPU_DATA",
            "d"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_output: not ready\\n\")"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mpu_waitready",
          "args": [
            "sc"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_waitready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "118-130",
          "snippet": "static __inline int\nmpu_waitready(sc)\n\tstruct mpu_softc *sc;\n{\n\tint i;\n\n\tfor(i = 0; i < MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_OUTPUT_BUSY))\n\t\t\treturn 0;\n\t\tdelay(10);\n\t}\n\treturn 1;\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
            "#define  MPU_OUTPUT_BUSY\t0x40"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_OUTPUT_BUSY\t0x40\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nstatic __inline int\nmpu_waitready(sc)\n\tstruct mpu_softc *sc;\n{\n\tint i;\n\n\tfor(i = 0; i < MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_OUTPUT_BUSY))\n\t\t\treturn 0;\n\t\tdelay(10);\n\t}\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mpu_readinput",
          "args": [
            "sc"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_readinput",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "196-210",
          "snippet": "void\nmpu_readinput(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint data;\n\n\twhile(!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY)) {\n\t\tdata = bus_space_read_1(iot, ioh, MPU_DATA);\n\t\tDPRINTFN(3, (\"mpu_rea: sc=%p 0x%02x\\n\", sc, data));\n\t\tif (sc->intr)\n\t\t\tsc->intr(sc->arg, data);\n\t}\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define  MPU_INPUT_EMPTY\t0x80",
            "#define MPU_DATA\t\t0"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_INPUT_EMPTY\t0x80\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nvoid\nmpu_readinput(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint data;\n\n\twhile(!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY)) {\n\t\tdata = bus_space_read_1(iot, ioh, MPU_DATA);\n\t\tDPRINTFN(3, (\"mpu_rea: sc=%p 0x%02x\\n\", sc, data));\n\t\tif (sc->intr)\n\t\t\tsc->intr(sc->arg, data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "splaudio",
          "args": [],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MPU_GETSTATUS",
          "args": [
            "sc->iot",
            "sc->ioh"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "3",
            "(\"mpu_output: sc=%p 0x%02x\\n\", sc, d)"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_INPUT_EMPTY\t0x80\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_output(v, d)\n\tvoid *v;\n\tint d;\n{\n\tstruct mpu_softc *sc = v;\n\tint s;\n\n\tDPRINTFN(3, (\"mpu_output: sc=%p 0x%02x\\n\", sc, d));\n\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_INPUT_EMPTY)) {\n\t\ts = splaudio();\n\t\tmpu_readinput(sc);\n\t\tsplx(s);\n\t}\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_output: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\tbus_space_write_1(sc->iot, sc->ioh, MPU_DATA, d);\n\treturn 0;\n}"
  },
  {
    "function_name": "mpu_readinput",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "196-210",
    "snippet": "void\nmpu_readinput(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint data;\n\n\twhile(!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY)) {\n\t\tdata = bus_space_read_1(iot, ioh, MPU_DATA);\n\t\tDPRINTFN(3, (\"mpu_rea: sc=%p 0x%02x\\n\", sc, data));\n\t\tif (sc->intr)\n\t\t\tsc->intr(sc->arg, data);\n\t}\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define  MPU_INPUT_EMPTY\t0x80",
      "#define MPU_DATA\t\t0"
    ],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sc->intr",
          "args": [
            "sc->arg",
            "data"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "3",
            "(\"mpu_rea: sc=%p 0x%02x\\n\", sc, data)"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "MPU_DATA"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MPU_GETSTATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_INPUT_EMPTY\t0x80\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nvoid\nmpu_readinput(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint data;\n\n\twhile(!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY)) {\n\t\tdata = bus_space_read_1(iot, ioh, MPU_DATA);\n\t\tDPRINTFN(3, (\"mpu_rea: sc=%p 0x%02x\\n\", sc, data));\n\t\tif (sc->intr)\n\t\t\tsc->intr(sc->arg, data);\n\t}\n}"
  },
  {
    "function_name": "mpu_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "183-194",
    "snippet": "void\nmpu_close(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n        DPRINTF((\"mpu_close: sc=%p\\n\", sc));\n\n\tsc->open = 0;\n\tsc->intr = 0;\n\tmpu_reset(sc); /* exit UART mode */\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "mpu_reset",
          "args": [
            "sc"
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "132-157",
          "snippet": "int\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
            "#define  MPU_INPUT_EMPTY\t0x80",
            "#define  MPU_ACK\t\t0xfe",
            "#define  MPU_RESET\t0xff",
            "#define MPU_COMMAND\t1",
            "#define MPU_DATA\t\t0"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_INPUT_EMPTY\t0x80\n#define  MPU_ACK\t\t0xfe\n#define  MPU_RESET\t0xff\n#define MPU_COMMAND\t1\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_close: sc=%p\\n\", sc)"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nvoid\nmpu_close(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n        DPRINTF((\"mpu_close: sc=%p\\n\", sc));\n\n\tsc->open = 0;\n\tsc->intr = 0;\n\tmpu_reset(sc); /* exit UART mode */\n}"
  },
  {
    "function_name": "mpu_open",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "159-181",
    "snippet": "int\nmpu_open(v, flags, iintr, ointr, arg)\n\tvoid *v;\n\tint flags;\n\tvoid (*iintr)__P((void *, int));\n\tvoid (*ointr)__P((void *));\n\tvoid *arg;\n{\n\tstruct mpu_softc *sc = v;\n\n        DPRINTF((\"mpu_open: sc=%p\\n\", sc));\n\n\tif (sc->open)\n\t\treturn EBUSY;\n\tif (mpu_reset(sc) != 0)\n\t\treturn EIO;\n\n\tbus_space_write_1(sc->iot, sc->ioh, MPU_COMMAND, MPU_UART_MODE);\n\tsc->open = 1;\n\tsc->intr = iintr;\n\tsc->arg = arg;\n\treturn 0;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define  MPU_UART_MODE\t0x3f",
      "#define MPU_COMMAND\t1"
    ],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "sc->iot",
            "sc->ioh",
            "MPU_COMMAND",
            "MPU_UART_MODE"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mpu_reset",
          "args": [
            "sc"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "132-157",
          "snippet": "int\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
            "#define  MPU_INPUT_EMPTY\t0x80",
            "#define  MPU_ACK\t\t0xfe",
            "#define  MPU_RESET\t0xff",
            "#define MPU_COMMAND\t1",
            "#define MPU_DATA\t\t0"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_INPUT_EMPTY\t0x80\n#define  MPU_ACK\t\t0xfe\n#define  MPU_RESET\t0xff\n#define MPU_COMMAND\t1\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_open: sc=%p\\n\", sc)"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_UART_MODE\t0x3f\n#define MPU_COMMAND\t1\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_open(v, flags, iintr, ointr, arg)\n\tvoid *v;\n\tint flags;\n\tvoid (*iintr)__P((void *, int));\n\tvoid (*ointr)__P((void *));\n\tvoid *arg;\n{\n\tstruct mpu_softc *sc = v;\n\n        DPRINTF((\"mpu_open: sc=%p\\n\", sc));\n\n\tif (sc->open)\n\t\treturn EBUSY;\n\tif (mpu_reset(sc) != 0)\n\t\treturn EIO;\n\n\tbus_space_write_1(sc->iot, sc->ioh, MPU_COMMAND, MPU_UART_MODE);\n\tsc->open = 1;\n\tsc->intr = iintr;\n\tsc->arg = arg;\n\treturn 0;\n}"
  },
  {
    "function_name": "mpu_reset",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "132-157",
    "snippet": "int\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
      "#define  MPU_INPUT_EMPTY\t0x80",
      "#define  MPU_ACK\t\t0xfe",
      "#define  MPU_RESET\t0xff",
      "#define MPU_COMMAND\t1",
      "#define MPU_DATA\t\t0"
    ],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_reset: No ACK\\n\")"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "MPU_DATA"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MPU_GETSTATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "MPU_COMMAND",
            "MPU_RESET"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splaudio",
          "args": [],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_reset: not ready\\n\")"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mpu_waitready",
          "args": [
            "sc"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_waitready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "118-130",
          "snippet": "static __inline int\nmpu_waitready(sc)\n\tstruct mpu_softc *sc;\n{\n\tint i;\n\n\tfor(i = 0; i < MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_OUTPUT_BUSY))\n\t\t\treturn 0;\n\t\tdelay(10);\n\t}\n\treturn 1;\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
            "#define  MPU_OUTPUT_BUSY\t0x40"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_OUTPUT_BUSY\t0x40\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nstatic __inline int\nmpu_waitready(sc)\n\tstruct mpu_softc *sc;\n{\n\tint i;\n\n\tfor(i = 0; i < MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_OUTPUT_BUSY))\n\t\t\treturn 0;\n\t\tdelay(10);\n\t}\n\treturn 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_INPUT_EMPTY\t0x80\n#define  MPU_ACK\t\t0xfe\n#define  MPU_RESET\t0xff\n#define MPU_COMMAND\t1\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}"
  },
  {
    "function_name": "mpu_waitready",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "118-130",
    "snippet": "static __inline int\nmpu_waitready(sc)\n\tstruct mpu_softc *sc;\n{\n\tint i;\n\n\tfor(i = 0; i < MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_OUTPUT_BUSY))\n\t\t\treturn 0;\n\t\tdelay(10);\n\t}\n\treturn 1;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
      "#define  MPU_OUTPUT_BUSY\t0x40"
    ],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "10"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "MPU_GETSTATUS",
          "args": [
            "sc->iot",
            "sc->ioh"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_OUTPUT_BUSY\t0x40\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nstatic __inline int\nmpu_waitready(sc)\n\tstruct mpu_softc *sc;\n{\n\tint i;\n\n\tfor(i = 0; i < MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_OUTPUT_BUSY))\n\t\t\treturn 0;\n\t\tdelay(10);\n\t}\n\treturn 1;\n}"
  },
  {
    "function_name": "mpu_find",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
    "lines": "100-116",
    "snippet": "int\nmpu_find(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n\tif (MPU_GETSTATUS(sc->iot, sc->ioh) == 0xff) {\n\t\tDPRINTF((\"mpu_find: No status\\n\"));\n\t\tgoto bad;\n\t}\n\tsc->open = 0;\n\tsc->intr = 0;\n\tif (mpu_reset(sc) == 0)\n\t\treturn 1;\nbad:\n\treturn 0;\n}",
    "includes": [
      "#include <dev/ic/mpuvar.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/midi_if.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmpu_reset(struct mpu_softc *);",
      "static\t__inline int mpu_waitready(struct mpu_softc *);",
      "void\tmpu_readinput(struct mpu_softc *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "mpu_reset",
          "args": [
            "sc"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "132-157",
          "snippet": "int\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */",
            "#define  MPU_INPUT_EMPTY\t0x80",
            "#define  MPU_ACK\t\t0xfe",
            "#define  MPU_RESET\t0xff",
            "#define MPU_COMMAND\t1",
            "#define MPU_DATA\t\t0"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define MPU_MAXWAIT\t10000\t/* usec/10 to wait */\n#define  MPU_INPUT_EMPTY\t0x80\n#define  MPU_ACK\t\t0xfe\n#define  MPU_RESET\t0xff\n#define MPU_COMMAND\t1\n#define MPU_DATA\t\t0\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_reset(sc)\n\tstruct mpu_softc *sc;\n{\n\tbus_space_tag_t iot = sc->iot;\n\tbus_space_handle_t ioh = sc->ioh;\n\tint i;\n\tint s;\n\n\tif (mpu_waitready(sc)) {\n\t\tDPRINTF((\"mpu_reset: not ready\\n\"));\n\t\treturn EIO;\n\t}\n\ts = splaudio();\t\t/* Don't let the interrupt get our ACK. */\n\tbus_space_write_1(iot, ioh, MPU_COMMAND, MPU_RESET);\n\tfor(i = 0; i < 2*MPU_MAXWAIT; i++) {\n\t\tif (!(MPU_GETSTATUS(iot, ioh) & MPU_INPUT_EMPTY) &&\n\t\t    bus_space_read_1(iot, ioh, MPU_DATA) == MPU_ACK) {\n\t\t\tsplx(s);\n\t\t\treturn 0;\n\t\t}\n\t}\n\tsplx(s);\n\tDPRINTF((\"mpu_reset: No ACK\\n\"));\n\treturn EIO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"mpu_find: No status\\n\")"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MPU_GETSTATUS",
          "args": [
            "sc->iot",
            "sc->ioh"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_find(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n\tif (MPU_GETSTATUS(sc->iot, sc->ioh) == 0xff) {\n\t\tDPRINTF((\"mpu_find: No status\\n\"));\n\t\tgoto bad;\n\t}\n\tsc->open = 0;\n\tsc->intr = 0;\n\tif (mpu_reset(sc) == 0)\n\t\treturn 1;\nbad:\n\treturn 0;\n}"
  }
]