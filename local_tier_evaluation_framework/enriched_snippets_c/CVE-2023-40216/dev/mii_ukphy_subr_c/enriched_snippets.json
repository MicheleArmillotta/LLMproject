[
  {
    "function_name": "ukphy_status",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/mii/ukphy_subr.c",
    "lines": "62-114",
    "snippet": "void\nukphy_status(phy)\n\tstruct mii_softc *phy;\n{\n\tstruct mii_data *mii = phy->mii_pdata;\n\tstruct ifmedia_entry *ife = mii->mii_media.ifm_cur;\n\tint bmsr, bmcr, anlpar;\n\n\tmii->mii_media_status = IFM_AVALID;\n\tmii->mii_media_active = IFM_ETHER;\n\n\tbmsr = PHY_READ(phy, MII_BMSR) | PHY_READ(phy, MII_BMSR);\n\tif (bmsr & BMSR_LINK)\n\t\tmii->mii_media_status |= IFM_ACTIVE;\n\n\tbmcr = PHY_READ(phy, MII_BMCR);\n\tif (bmcr & BMCR_ISO) {\n\t\tmii->mii_media_active |= IFM_NONE;\n\t\tmii->mii_media_status = 0;\n\t\treturn;\n\t}\n\n\tif (bmcr & BMCR_LOOP)\n\t\tmii->mii_media_active |= IFM_LOOP;\n\n\tif (bmcr & BMCR_AUTOEN) {\n\t\t/*\n\t\t * NWay autonegotiation takes the highest-order common\n\t\t * bit of the ANAR and ANLPAR (i.e. best media advertised\n\t\t * both by us and our link partner).\n\t\t */\n\t\tif ((bmsr & BMSR_ACOMP) == 0) {\n\t\t\t/* Erg, still trying, I guess... */\n\t\t\tmii->mii_media_active |= IFM_NONE;\n\t\t\treturn;\n\t\t}\n\n\t\tanlpar = PHY_READ(phy, MII_ANAR) & PHY_READ(phy, MII_ANLPAR);\n\t\tif (anlpar & ANLPAR_T4)\n\t\t\tmii->mii_media_active |= IFM_100_T4;\n\t\telse if (anlpar & ANLPAR_TX_FD)\n\t\t\tmii->mii_media_active |= IFM_100_TX|IFM_FDX;\n\t\telse if (anlpar & ANLPAR_TX)\n\t\t\tmii->mii_media_active |= IFM_100_TX;\n\t\telse if (anlpar & ANLPAR_10_FD)\n\t\t\tmii->mii_media_active |= IFM_10_T|IFM_FDX;\n\t\telse if (anlpar & ANLPAR_10)\n\t\t\tmii->mii_media_active |= IFM_10_T;\n\t\telse\n\t\t\tmii->mii_media_active |= IFM_NONE;\n\t} else\n\t\tmii->mii_media_active = ife->ifm_media;\n}",
    "includes": [
      "#include <dev/mii/miivar.h>",
      "#include <dev/mii/mii.h>",
      "#include <net/if_media.h>",
      "#include <net/if.h>",
      "#include <sys/socket.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/kernel.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PHY_READ",
          "args": [
            "phy",
            "MII_ANLPAR"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PHY_READ",
          "args": [
            "phy",
            "MII_ANAR"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PHY_READ",
          "args": [
            "phy",
            "MII_BMCR"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PHY_READ",
          "args": [
            "phy",
            "MII_BMSR"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PHY_READ",
          "args": [
            "phy",
            "MII_BMSR"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/mii/miivar.h>\n#include <dev/mii/mii.h>\n#include <net/if_media.h>\n#include <net/if.h>\n#include <sys/socket.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/kernel.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nvoid\nukphy_status(phy)\n\tstruct mii_softc *phy;\n{\n\tstruct mii_data *mii = phy->mii_pdata;\n\tstruct ifmedia_entry *ife = mii->mii_media.ifm_cur;\n\tint bmsr, bmcr, anlpar;\n\n\tmii->mii_media_status = IFM_AVALID;\n\tmii->mii_media_active = IFM_ETHER;\n\n\tbmsr = PHY_READ(phy, MII_BMSR) | PHY_READ(phy, MII_BMSR);\n\tif (bmsr & BMSR_LINK)\n\t\tmii->mii_media_status |= IFM_ACTIVE;\n\n\tbmcr = PHY_READ(phy, MII_BMCR);\n\tif (bmcr & BMCR_ISO) {\n\t\tmii->mii_media_active |= IFM_NONE;\n\t\tmii->mii_media_status = 0;\n\t\treturn;\n\t}\n\n\tif (bmcr & BMCR_LOOP)\n\t\tmii->mii_media_active |= IFM_LOOP;\n\n\tif (bmcr & BMCR_AUTOEN) {\n\t\t/*\n\t\t * NWay autonegotiation takes the highest-order common\n\t\t * bit of the ANAR and ANLPAR (i.e. best media advertised\n\t\t * both by us and our link partner).\n\t\t */\n\t\tif ((bmsr & BMSR_ACOMP) == 0) {\n\t\t\t/* Erg, still trying, I guess... */\n\t\t\tmii->mii_media_active |= IFM_NONE;\n\t\t\treturn;\n\t\t}\n\n\t\tanlpar = PHY_READ(phy, MII_ANAR) & PHY_READ(phy, MII_ANLPAR);\n\t\tif (anlpar & ANLPAR_T4)\n\t\t\tmii->mii_media_active |= IFM_100_T4;\n\t\telse if (anlpar & ANLPAR_TX_FD)\n\t\t\tmii->mii_media_active |= IFM_100_TX|IFM_FDX;\n\t\telse if (anlpar & ANLPAR_TX)\n\t\t\tmii->mii_media_active |= IFM_100_TX;\n\t\telse if (anlpar & ANLPAR_10_FD)\n\t\t\tmii->mii_media_active |= IFM_10_T|IFM_FDX;\n\t\telse if (anlpar & ANLPAR_10)\n\t\t\tmii->mii_media_active |= IFM_10_T;\n\t\telse\n\t\t\tmii->mii_media_active |= IFM_NONE;\n\t} else\n\t\tmii->mii_media_active = ife->ifm_media;\n}"
  }
]