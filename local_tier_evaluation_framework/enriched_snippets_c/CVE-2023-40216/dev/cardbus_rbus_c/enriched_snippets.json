[
  {
    "function_name": "rbus_delete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "374-387",
    "snippet": "int\nrbus_delete(rb)\n     rbus_tag_t rb;\n{\n  DPRINTF((\"rbus_delete called [%s]\\n\",\n\t   rb->rb_ext != NULL ? rb->rb_ext->ex_name : \"noname\"));\n  if (rb->rb_flags == RBUS_SPACE_DEDICATE) {\n    extent_destroy(rb->rb_ext);\n  }\n\n  free(rb, M_DEVBUF);\n\n  return 0;\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "rb",
            "M_DEVBUF"
          ],
          "line": 384
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_space_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "179-207",
          "snippet": "int\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}",
          "includes": [
            "#include <dev/cardbus/rbus.h>",
            "#include <machine/bus.h>",
            "#include <sys/extent.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "extent_destroy",
          "args": [
            "rb->rb_ext"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"rbus_delete called [%s]\\n\",\n\t   rb->rb_ext != NULL ? rb->rb_ext->ex_name : \"noname\")"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\nrbus_delete(rb)\n     rbus_tag_t rb;\n{\n  DPRINTF((\"rbus_delete called [%s]\\n\",\n\t   rb->rb_ext != NULL ? rb->rb_ext->ex_name : \"noname\"));\n  if (rb->rb_flags == RBUS_SPACE_DEDICATE) {\n    extent_destroy(rb->rb_ext);\n  }\n\n  free(rb, M_DEVBUF);\n\n  return 0;\n}"
  },
  {
    "function_name": "rbus_new_root_share",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "346-363",
    "snippet": "rbus_tag_t\nrbus_new_root_share(bt, ex, start, size, offset)\n     bus_space_tag_t bt;\n     struct extent *ex;\n     bus_addr_t start;\n     bus_size_t size;\n     bus_addr_t offset;\n{\n  /* sanity check */\n  if (start < ex->ex_start || start + size > ex->ex_end) {\n    /* out of range: [start, size] should be containd in parent space */\n    return 0;\n    /* Should I invoke panic? */\n  }\n\n  return rbus_new_body(bt, NULL, ex, start, start + size, offset,\n\t\t       RBUS_SPACE_SHARE);\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static rbus_tag_t rbus_new_body"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rbus_new_body",
          "args": [
            "bt",
            "NULL",
            "ex",
            "start",
            "start + size",
            "offset",
            "RBUS_SPACE_SHARE"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_new_body",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "218-257",
          "snippet": "static rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}",
          "includes": [
            "#include <dev/cardbus/rbus.h>",
            "#include <machine/bus.h>",
            "#include <sys/extent.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static rbus_tag_t rbus_new_body",
            "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nstatic rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\n\nrbus_tag_t\nrbus_new_root_share(bt, ex, start, size, offset)\n     bus_space_tag_t bt;\n     struct extent *ex;\n     bus_addr_t start;\n     bus_size_t size;\n     bus_addr_t offset;\n{\n  /* sanity check */\n  if (start < ex->ex_start || start + size > ex->ex_end) {\n    /* out of range: [start, size] should be containd in parent space */\n    return 0;\n    /* Should I invoke panic? */\n  }\n\n  return rbus_new_body(bt, NULL, ex, start, start + size, offset,\n\t\t       RBUS_SPACE_SHARE);\n}"
  },
  {
    "function_name": "rbus_new_root_delegate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "313-336",
    "snippet": "rbus_tag_t\nrbus_new_root_delegate(bt, start, size, offset)\n     bus_space_tag_t bt;\n     bus_addr_t start;\n     bus_size_t size;\n     bus_addr_t offset;\n{\n  rbus_tag_t rb;\n  struct extent *ex;\n\n  if (NULL == (ex = extent_create(\"rbus root\", start, start + size, M_DEVBUF,\n\t\t\t\t  NULL, 0, EX_NOCOALESCE|EX_NOWAIT))) {\n    return NULL;\n  }\n  \n  rb = rbus_new_body(bt, NULL, ex, start, start + size, offset,\n\t\t     RBUS_SPACE_DEDICATE);\n\n  if (rb == NULL) {\n    extent_destroy(ex);\n  }\n\n  return rb;\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static rbus_tag_t rbus_new_body"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "extent_destroy",
          "args": [
            "ex"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbus_new_body",
          "args": [
            "bt",
            "NULL",
            "ex",
            "start",
            "start + size",
            "offset",
            "RBUS_SPACE_DEDICATE"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_new_body",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "218-257",
          "snippet": "static rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}",
          "includes": [
            "#include <dev/cardbus/rbus.h>",
            "#include <machine/bus.h>",
            "#include <sys/extent.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static rbus_tag_t rbus_new_body",
            "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nstatic rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}"
        }
      },
      {
        "call_info": {
          "callee": "extent_create",
          "args": [
            "\"rbus root\"",
            "start",
            "start + size",
            "M_DEVBUF",
            "NULL",
            "0",
            "EX_NOCOALESCE|EX_NOWAIT"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\n\nrbus_tag_t\nrbus_new_root_delegate(bt, start, size, offset)\n     bus_space_tag_t bt;\n     bus_addr_t start;\n     bus_size_t size;\n     bus_addr_t offset;\n{\n  rbus_tag_t rb;\n  struct extent *ex;\n\n  if (NULL == (ex = extent_create(\"rbus root\", start, start + size, M_DEVBUF,\n\t\t\t\t  NULL, 0, EX_NOCOALESCE|EX_NOWAIT))) {\n    return NULL;\n  }\n  \n  rb = rbus_new_body(bt, NULL, ex, start, start + size, offset,\n\t\t     RBUS_SPACE_DEDICATE);\n\n  if (rb == NULL) {\n    extent_destroy(ex);\n  }\n\n  return rb;\n}"
  },
  {
    "function_name": "rbus_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "267-302",
    "snippet": "rbus_tag_t\nrbus_new(parent, start, size, offset, flags)\n     rbus_tag_t parent;\n     bus_addr_t start;\n     bus_size_t size;\n     bus_addr_t offset;\n     int flags;\n{\n  rbus_tag_t rb;\n  struct extent *ex = NULL;\n  bus_addr_t end = start + size;\n\n  if (flags == RBUS_SPACE_SHARE) {\n    ex = parent->rb_ext;\n  } else if (flags == RBUS_SPACE_DEDICATE) {\n    if (NULL == (ex = extent_create(\"rbus\", start, end, M_DEVBUF, NULL, 0, \n\t\t\t\t    EX_NOCOALESCE|EX_NOWAIT))) {\n      free(rb, M_DEVBUF);\n      return NULL;\n    }\n  } else if (flags == RBUS_SPACE_ASK_PARENT) {\n    ex = NULL;\n  } else {\n    /* Invalid flag */\n    return 0;\n  }\n\n  rb = rbus_new_body(parent->rb_bt, parent, ex, start, start + size,\n\t\t     offset, flags);\n\n  if ((rb == NULL) && (flags == RBUS_SPACE_DEDICATE)) {\n    extent_destroy(ex);\n  }\n\n  return rb;\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static rbus_tag_t rbus_new_body",
      "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "extent_destroy",
          "args": [
            "ex"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbus_new_body",
          "args": [
            "parent->rb_bt",
            "parent",
            "ex",
            "start",
            "start + size",
            "offset",
            "flags"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_new_body",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "218-257",
          "snippet": "static rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}",
          "includes": [
            "#include <dev/cardbus/rbus.h>",
            "#include <machine/bus.h>",
            "#include <sys/extent.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static rbus_tag_t rbus_new_body",
            "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nstatic rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "rb",
            "M_DEVBUF"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_space_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "179-207",
          "snippet": "int\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}",
          "includes": [
            "#include <dev/cardbus/rbus.h>",
            "#include <machine/bus.h>",
            "#include <sys/extent.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}"
        }
      },
      {
        "call_info": {
          "callee": "extent_create",
          "args": [
            "\"rbus\"",
            "start",
            "end",
            "M_DEVBUF",
            "NULL",
            "0",
            "EX_NOCOALESCE|EX_NOWAIT"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nrbus_tag_t\nrbus_new(parent, start, size, offset, flags)\n     rbus_tag_t parent;\n     bus_addr_t start;\n     bus_size_t size;\n     bus_addr_t offset;\n     int flags;\n{\n  rbus_tag_t rb;\n  struct extent *ex = NULL;\n  bus_addr_t end = start + size;\n\n  if (flags == RBUS_SPACE_SHARE) {\n    ex = parent->rb_ext;\n  } else if (flags == RBUS_SPACE_DEDICATE) {\n    if (NULL == (ex = extent_create(\"rbus\", start, end, M_DEVBUF, NULL, 0, \n\t\t\t\t    EX_NOCOALESCE|EX_NOWAIT))) {\n      free(rb, M_DEVBUF);\n      return NULL;\n    }\n  } else if (flags == RBUS_SPACE_ASK_PARENT) {\n    ex = NULL;\n  } else {\n    /* Invalid flag */\n    return 0;\n  }\n\n  rb = rbus_new_body(parent->rb_bt, parent, ex, start, start + size,\n\t\t     offset, flags);\n\n  if ((rb == NULL) && (flags == RBUS_SPACE_DEDICATE)) {\n    extent_destroy(ex);\n  }\n\n  return rb;\n}"
  },
  {
    "function_name": "rbus_new_body",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "218-257",
    "snippet": "static rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static rbus_tag_t rbus_new_body",
      "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\")"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"no memory for rbus instance\""
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct rbustag)",
            "M_DEVBUF",
            "M_NOWAIT"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "rf_unrecord_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugMem.c",
          "lines": "84-99",
          "snippet": "void \nrf_unrecord_malloc(p, sz)\n\tvoid   *p;\n\tint     sz;\n{\n\tint     size;\n\n\t/* RF_LOCK_MUTEX(rf_debug_mem_mutex); */\n\tsize = memory_hash_remove(p, sz);\n\ttot_mem_in_use -= size;\n\t/* RF_UNLOCK_MUTEX(rf_debug_mem_mutex); */\n\tif ((long) p == rf_memDebugAddress) {\n\t\tprintf(\"Free: Found debug address\\n\");\t/* this is really only a\n\t\t\t\t\t\t\t * flag line for gdb */\n\t}\n}",
          "includes": [
            "#include \"rf_general.h\"",
            "#include \"rf_debugMem.h\"",
            "#include \"rf_options.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static long tot_mem_in_use = 0;",
            "static int memory_hash_remove(void *addr, int sz);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"rf_general.h\"\n#include \"rf_debugMem.h\"\n#include \"rf_options.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\nstatic long tot_mem_in_use = 0;\nstatic int memory_hash_remove(void *addr, int sz);\n\nvoid \nrf_unrecord_malloc(p, sz)\n\tvoid   *p;\n\tint     sz;\n{\n\tint     size;\n\n\t/* RF_LOCK_MUTEX(rf_debug_mem_mutex); */\n\tsize = memory_hash_remove(p, sz);\n\ttot_mem_in_use -= size;\n\t/* RF_UNLOCK_MUTEX(rf_debug_mem_mutex); */\n\tif ((long) p == rf_memDebugAddress) {\n\t\tprintf(\"Free: Found debug address\\n\");\t/* this is really only a\n\t\t\t\t\t\t\t * flag line for gdb */\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic rbus_tag_t rbus_new_body;\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nstatic rbus_tag_t\nrbus_new_body(bt, parent, ex, start, end, offset, flags)\n     bus_space_tag_t bt;\n     rbus_tag_t parent;\n     struct extent *ex;\n     bus_addr_t start, end, offset;\n     int flags;\n{\n  rbus_tag_t rb;\n\n  /* sanity check */\n  if (parent != NULL) {\n    if (start < parent->rb_start || end > parent->rb_end) {\n      /* out of range: [start, size] should be containd in parent space */\n      return 0;\n      /* Should I invoke panic? */\n    }\n  }\n\n  if (NULL == (rb = (rbus_tag_t)malloc(sizeof(struct rbustag), M_DEVBUF,\n\t\t\t\t\t M_NOWAIT))) {\n    panic(\"no memory for rbus instance\");\n  }\n  \n  rb->rb_bt = bt;\n  rb->rb_parent = parent;\n  rb->rb_start = start;\n  rb->rb_end = end;\n  rb->rb_offset = offset;\n  rb->rb_flags = flags;\n  rb->rb_ext = ex;\n\n  DPRINTF((\"rbus_new_body: [%lx, %lx] type %s name [%s]\\n\", start, end,\n\t   flags == RBUS_SPACE_SHARE ? \"share\" :\n\t   flags == RBUS_SPACE_DEDICATE ? \"dedicated\" :\n\t   flags == RBUS_SPACE_ASK_PARENT ? \"parent\" : \"invalid\",\n\t   ex != NULL ? ex->ex_name : \"noname\"));\n\n  return rb;\n}"
  },
  {
    "function_name": "rbus_space_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "179-207",
    "snippet": "int\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "extent_free",
          "args": [
            "rbt->rb_ext",
            "addr",
            "size",
            "exflags"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "md_space_unmap",
          "args": [
            "rbt->rb_bt",
            "bsh",
            "size",
            "&addr"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbus_space_free",
          "args": [
            "rbt->rb_parent",
            "bsh",
            "size",
            "&addr"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_space_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "179-207",
          "snippet": "int\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\nrbus_space_free(rbt, bsh, size, addrp)\n     rbus_tag_t rbt;\n     bus_space_handle_t bsh;\n     bus_size_t size;\n     bus_addr_t *addrp;\n{\n  int exflags = EX_FAST | EX_NOWAIT;\n  bus_addr_t addr;\n  int status = 1;\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    status = rbus_space_free(rbt->rb_parent, bsh, size, &addr);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    md_space_unmap(rbt->rb_bt, bsh, size, &addr);\n\n    extent_free(rbt->rb_ext, addr, size, exflags);\n\n    status = 0;\n  } else {\n    /* error. INVALID rbustag */\n    status = 1;\n  }\n  if (addrp != NULL) {\n    *addrp = addr;\n  }\n  return status;\n}"
  },
  {
    "function_name": "rbus_space_alloc_subregion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "82-173",
    "snippet": "int\nrbus_space_alloc_subregion(rbt, substart, subend, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_addr_t substart;\n     bus_addr_t subend;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  bus_addr_t decodesize = mask + 1;\n  bus_addr_t boundary, search_addr;\n  int val = 0;\n  bus_addr_t result;\n  int exflags = EX_FAST | EX_NOWAIT;\n\n  DPRINTF((\"rbus_space_alloc: addr %lx, size %lx, mask %lx, align %lx\\n\",\n\t   addr, size, mask, align));\n\n  addr += rbt->rb_offset;\n\n  if (mask == 0) {\n    /* FULL Decode */\n    decodesize = 0;\n  }\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    return rbus_space_alloc(rbt->rb_parent, addr, size, mask, align, flags,\n\t\t\t    addrp, bshp);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    /* rbt has its own sh_extent */\n\n    /* sanity check: the subregion [substart, subend] should be\n       smaller than the region included in sh_extent */\n    if (substart < rbt->rb_ext->ex_start || subend > rbt->rb_ext->ex_end) {\n      return 1;\n    }\n\n    if (decodesize == align) {\n      if(extent_alloc_subregion(rbt->rb_ext, substart, subend, size, align, 0,\n\t\t\t\texflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else if (decodesize == 0) {\n      /* maybe, the resister is overflowed. */\n      \n      if (extent_alloc_subregion(rbt->rb_ext, addr, addr + size, size,\n\t\t\t\t 0, 0, exflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else {\n\n      boundary = decodesize > align ? decodesize : align;\n\n      search_addr = (substart & ~(boundary - 1)) + addr;\n\n      if (search_addr < substart) {\n\tsearch_addr += boundary;\n      }\n\n      for (; search_addr + size <= subend; search_addr += boundary) {\n\tval = extent_alloc_subregion(rbt->rb_ext,search_addr, search_addr+size,\n\t\t\t\tsize, align, 0, exflags, (u_long *)&result);\n\tif (val == 0) {\n\t  break;\n\t}\n      }\n      if (val) {\n\treturn 1;\n      }\n    }\n\n    if(md_space_map(rbt->rb_bt, result, size, flags, bshp)) {\n      /* map failed */\n      extent_free(rbt->rb_ext, result, size, exflags);\n      return 1;\n    }\n\n    if (addrp != NULL) {\n      *addrp = result + rbt->rb_offset;\n    }\n    return 0;\n\n  } else {\n    /* error!! */\n    return 1;\n  }\n  return 1;\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "extent_free",
          "args": [
            "rbt->rb_ext",
            "result",
            "size",
            "exflags"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "md_space_map",
          "args": [
            "rbt->rb_bt",
            "result",
            "size",
            "flags",
            "bshp"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "extent_alloc_subregion",
          "args": [
            "rbt->rb_ext",
            "search_addr",
            "search_addr+size",
            "size",
            "align",
            "0",
            "exflags",
            "(u_long *)&result"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "extent_alloc_subregion",
          "args": [
            "rbt->rb_ext",
            "addr",
            "addr + size",
            "size",
            "0",
            "0",
            "exflags",
            "(u_long *)&result"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "extent_alloc_subregion",
          "args": [
            "rbt->rb_ext",
            "substart",
            "subend",
            "size",
            "align",
            "0",
            "exflags",
            "(u_long *)&result"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rbus_space_alloc",
          "args": [
            "rbt->rb_parent",
            "addr",
            "size",
            "mask",
            "align",
            "flags",
            "addrp",
            "bshp"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_space_alloc_subregion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "82-173",
          "snippet": "int\nrbus_space_alloc_subregion(rbt, substart, subend, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_addr_t substart;\n     bus_addr_t subend;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  bus_addr_t decodesize = mask + 1;\n  bus_addr_t boundary, search_addr;\n  int val = 0;\n  bus_addr_t result;\n  int exflags = EX_FAST | EX_NOWAIT;\n\n  DPRINTF((\"rbus_space_alloc: addr %lx, size %lx, mask %lx, align %lx\\n\",\n\t   addr, size, mask, align));\n\n  addr += rbt->rb_offset;\n\n  if (mask == 0) {\n    /* FULL Decode */\n    decodesize = 0;\n  }\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    return rbus_space_alloc(rbt->rb_parent, addr, size, mask, align, flags,\n\t\t\t    addrp, bshp);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    /* rbt has its own sh_extent */\n\n    /* sanity check: the subregion [substart, subend] should be\n       smaller than the region included in sh_extent */\n    if (substart < rbt->rb_ext->ex_start || subend > rbt->rb_ext->ex_end) {\n      return 1;\n    }\n\n    if (decodesize == align) {\n      if(extent_alloc_subregion(rbt->rb_ext, substart, subend, size, align, 0,\n\t\t\t\texflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else if (decodesize == 0) {\n      /* maybe, the resister is overflowed. */\n      \n      if (extent_alloc_subregion(rbt->rb_ext, addr, addr + size, size,\n\t\t\t\t 0, 0, exflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else {\n\n      boundary = decodesize > align ? decodesize : align;\n\n      search_addr = (substart & ~(boundary - 1)) + addr;\n\n      if (search_addr < substart) {\n\tsearch_addr += boundary;\n      }\n\n      for (; search_addr + size <= subend; search_addr += boundary) {\n\tval = extent_alloc_subregion(rbt->rb_ext,search_addr, search_addr+size,\n\t\t\t\tsize, align, 0, exflags, (u_long *)&result);\n\tif (val == 0) {\n\t  break;\n\t}\n      }\n      if (val) {\n\treturn 1;\n      }\n    }\n\n    if(md_space_map(rbt->rb_bt, result, size, flags, bshp)) {\n      /* map failed */\n      extent_free(rbt->rb_ext, result, size, exflags);\n      return 1;\n    }\n\n    if (addrp != NULL) {\n      *addrp = result + rbt->rb_offset;\n    }\n    return 0;\n\n  } else {\n    /* error!! */\n    return 1;\n  }\n  return 1;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"rbus_space_alloc: addr %lx, size %lx, mask %lx, align %lx\\n\",\n\t   addr, size, mask, align)"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nint\nrbus_space_alloc_subregion(rbt, substart, subend, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_addr_t substart;\n     bus_addr_t subend;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  bus_addr_t decodesize = mask + 1;\n  bus_addr_t boundary, search_addr;\n  int val = 0;\n  bus_addr_t result;\n  int exflags = EX_FAST | EX_NOWAIT;\n\n  DPRINTF((\"rbus_space_alloc: addr %lx, size %lx, mask %lx, align %lx\\n\",\n\t   addr, size, mask, align));\n\n  addr += rbt->rb_offset;\n\n  if (mask == 0) {\n    /* FULL Decode */\n    decodesize = 0;\n  }\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    return rbus_space_alloc(rbt->rb_parent, addr, size, mask, align, flags,\n\t\t\t    addrp, bshp);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    /* rbt has its own sh_extent */\n\n    /* sanity check: the subregion [substart, subend] should be\n       smaller than the region included in sh_extent */\n    if (substart < rbt->rb_ext->ex_start || subend > rbt->rb_ext->ex_end) {\n      return 1;\n    }\n\n    if (decodesize == align) {\n      if(extent_alloc_subregion(rbt->rb_ext, substart, subend, size, align, 0,\n\t\t\t\texflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else if (decodesize == 0) {\n      /* maybe, the resister is overflowed. */\n      \n      if (extent_alloc_subregion(rbt->rb_ext, addr, addr + size, size,\n\t\t\t\t 0, 0, exflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else {\n\n      boundary = decodesize > align ? decodesize : align;\n\n      search_addr = (substart & ~(boundary - 1)) + addr;\n\n      if (search_addr < substart) {\n\tsearch_addr += boundary;\n      }\n\n      for (; search_addr + size <= subend; search_addr += boundary) {\n\tval = extent_alloc_subregion(rbt->rb_ext,search_addr, search_addr+size,\n\t\t\t\tsize, align, 0, exflags, (u_long *)&result);\n\tif (val == 0) {\n\t  break;\n\t}\n      }\n      if (val) {\n\treturn 1;\n      }\n    }\n\n    if(md_space_map(rbt->rb_bt, result, size, flags, bshp)) {\n      /* map failed */\n      extent_free(rbt->rb_ext, result, size, exflags);\n      return 1;\n    }\n\n    if (addrp != NULL) {\n      *addrp = result + rbt->rb_offset;\n    }\n    return 0;\n\n  } else {\n    /* error!! */\n    return 1;\n  }\n  return 1;\n}"
  },
  {
    "function_name": "rbus_space_alloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
    "lines": "65-77",
    "snippet": "int\nrbus_space_alloc(rbt, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  return rbus_space_alloc_subregion(rbt, rbt->rb_start, rbt->rb_end, addr,\n\t\t\t\t    size, mask, align, flags, addrp, bshp);\n}",
    "includes": [
      "#include <dev/cardbus/rbus.h>",
      "#include <machine/bus.h>",
      "#include <sys/extent.h>",
      "#include <sys/malloc.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rbus_space_alloc_subregion",
          "args": [
            "rbt",
            "rbt->rb_start",
            "rbt->rb_end",
            "addr",
            "size",
            "mask",
            "align",
            "flags",
            "addrp",
            "bshp"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "rbus_space_alloc_subregion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/cardbus/rbus.c",
          "lines": "82-173",
          "snippet": "int\nrbus_space_alloc_subregion(rbt, substart, subend, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_addr_t substart;\n     bus_addr_t subend;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  bus_addr_t decodesize = mask + 1;\n  bus_addr_t boundary, search_addr;\n  int val = 0;\n  bus_addr_t result;\n  int exflags = EX_FAST | EX_NOWAIT;\n\n  DPRINTF((\"rbus_space_alloc: addr %lx, size %lx, mask %lx, align %lx\\n\",\n\t   addr, size, mask, align));\n\n  addr += rbt->rb_offset;\n\n  if (mask == 0) {\n    /* FULL Decode */\n    decodesize = 0;\n  }\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    return rbus_space_alloc(rbt->rb_parent, addr, size, mask, align, flags,\n\t\t\t    addrp, bshp);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    /* rbt has its own sh_extent */\n\n    /* sanity check: the subregion [substart, subend] should be\n       smaller than the region included in sh_extent */\n    if (substart < rbt->rb_ext->ex_start || subend > rbt->rb_ext->ex_end) {\n      return 1;\n    }\n\n    if (decodesize == align) {\n      if(extent_alloc_subregion(rbt->rb_ext, substart, subend, size, align, 0,\n\t\t\t\texflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else if (decodesize == 0) {\n      /* maybe, the resister is overflowed. */\n      \n      if (extent_alloc_subregion(rbt->rb_ext, addr, addr + size, size,\n\t\t\t\t 0, 0, exflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else {\n\n      boundary = decodesize > align ? decodesize : align;\n\n      search_addr = (substart & ~(boundary - 1)) + addr;\n\n      if (search_addr < substart) {\n\tsearch_addr += boundary;\n      }\n\n      for (; search_addr + size <= subend; search_addr += boundary) {\n\tval = extent_alloc_subregion(rbt->rb_ext,search_addr, search_addr+size,\n\t\t\t\tsize, align, 0, exflags, (u_long *)&result);\n\tif (val == 0) {\n\t  break;\n\t}\n      }\n      if (val) {\n\treturn 1;\n      }\n    }\n\n    if(md_space_map(rbt->rb_bt, result, size, flags, bshp)) {\n      /* map failed */\n      extent_free(rbt->rb_ext, result, size, exflags);\n      return 1;\n    }\n\n    if (addrp != NULL) {\n      *addrp = result + rbt->rb_offset;\n    }\n    return 0;\n\n  } else {\n    /* error!! */\n    return 1;\n  }\n  return 1;\n}",
          "includes": [
            "#include <dev/cardbus/rbus.h>",
            "#include <machine/bus.h>",
            "#include <sys/extent.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nint\nrbus_space_alloc_subregion(rbt, substart, subend, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_addr_t substart;\n     bus_addr_t subend;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  bus_addr_t decodesize = mask + 1;\n  bus_addr_t boundary, search_addr;\n  int val = 0;\n  bus_addr_t result;\n  int exflags = EX_FAST | EX_NOWAIT;\n\n  DPRINTF((\"rbus_space_alloc: addr %lx, size %lx, mask %lx, align %lx\\n\",\n\t   addr, size, mask, align));\n\n  addr += rbt->rb_offset;\n\n  if (mask == 0) {\n    /* FULL Decode */\n    decodesize = 0;\n  }\n\n  if (rbt->rb_flags == RBUS_SPACE_ASK_PARENT) {\n    return rbus_space_alloc(rbt->rb_parent, addr, size, mask, align, flags,\n\t\t\t    addrp, bshp);\n  } else if (rbt->rb_flags == RBUS_SPACE_SHARE ||\n\t     rbt->rb_flags == RBUS_SPACE_DEDICATE) {\n    /* rbt has its own sh_extent */\n\n    /* sanity check: the subregion [substart, subend] should be\n       smaller than the region included in sh_extent */\n    if (substart < rbt->rb_ext->ex_start || subend > rbt->rb_ext->ex_end) {\n      return 1;\n    }\n\n    if (decodesize == align) {\n      if(extent_alloc_subregion(rbt->rb_ext, substart, subend, size, align, 0,\n\t\t\t\texflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else if (decodesize == 0) {\n      /* maybe, the resister is overflowed. */\n      \n      if (extent_alloc_subregion(rbt->rb_ext, addr, addr + size, size,\n\t\t\t\t 0, 0, exflags, (u_long *)&result)) {\n\treturn 1;\n      }\n    } else {\n\n      boundary = decodesize > align ? decodesize : align;\n\n      search_addr = (substart & ~(boundary - 1)) + addr;\n\n      if (search_addr < substart) {\n\tsearch_addr += boundary;\n      }\n\n      for (; search_addr + size <= subend; search_addr += boundary) {\n\tval = extent_alloc_subregion(rbt->rb_ext,search_addr, search_addr+size,\n\t\t\t\tsize, align, 0, exflags, (u_long *)&result);\n\tif (val == 0) {\n\t  break;\n\t}\n      }\n      if (val) {\n\treturn 1;\n      }\n    }\n\n    if(md_space_map(rbt->rb_bt, result, size, flags, bshp)) {\n      /* map failed */\n      extent_free(rbt->rb_ext, result, size, exflags);\n      return 1;\n    }\n\n    if (addrp != NULL) {\n      *addrp = result + rbt->rb_offset;\n    }\n    return 0;\n\n  } else {\n    /* error!! */\n    return 1;\n  }\n  return 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/cardbus/rbus.h>\n#include <machine/bus.h>\n#include <sys/extent.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstruct extent *ex, bus_addr_t start,\n\t\t\t\t    bus_addr_t end, bus_addr_t offset,\n\t\t\t\t    int flags));\n\nint\nrbus_space_alloc(rbt, addr, size, mask, align, flags, addrp, bshp)\n     rbus_tag_t rbt;\n     bus_addr_t addr;\n     bus_size_t size;\n     bus_addr_t mask, align;\n     int flags;\n     bus_addr_t *addrp;\n     bus_space_handle_t *bshp;\n{\n  return rbus_space_alloc_subregion(rbt, rbt->rb_start, rbt->rb_end, addr,\n\t\t\t\t    size, mask, align, flags, addrp, bshp);\n}"
  }
]