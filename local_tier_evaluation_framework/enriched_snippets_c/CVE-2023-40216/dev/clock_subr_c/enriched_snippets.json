[
  {
    "function_name": "clock_secs_to_ymdhms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/clock_subr.c",
    "lines": "131-169",
    "snippet": "void\nclock_secs_to_ymdhms(secs, dt)\n\ttime_t secs;\n\tstruct clock_ymdhms *dt;\n{\n\tint mthdays[12];\n\tint i, days;\n\tint rsec;\t/* remainder seconds */\n\n\tbcopy(month_days, mthdays, sizeof(mthdays));\n\n\tdays = secs / SECDAY;\n\trsec = secs % SECDAY;\n\n\t/* Day of week (Note: 1/1/1970 was a Thursday) */\n\tdt->dt_wday = (days + 4) % 7;\n\n\t/* Subtract out whole years, counting them in i. */\n\tfor (i = POSIX_BASE_YEAR; days >= days_in_year(i); i++)\n\t\tdays -= days_in_year(i);\n\tdt->dt_year = i;\n\n\t/* Subtract out whole months, counting them in i. */\n\tif (leapyear(i))\n\t\tdays_in_month(FEBRUARY) = 29;\n\tfor (i = 1; days >= days_in_month(i); i++)\n\t\tdays -= days_in_month(i);\n\tdt->dt_mon = i;\n\n\t/* Days are what is left over (+1) from all that. */\n\tdt->dt_day = days + 1;\n\n\t/* Hours, minutes, seconds are easy */\n\tdt->dt_hour = rsec / 3600;\n\trsec = rsec % 3600;\n\tdt->dt_min  = rsec / 60;\n\trsec = rsec % 60;\n\tdt->dt_sec  = rsec;\n}",
    "includes": [
      "#include <dev/clock_subr.h>",
      "#include <sys/systm.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [
      "#define FEBRUARY\t2",
      "#define\tPOSIX_BASE_YEAR\t1970"
    ],
    "globals_used": [
      "static inline int leapyear",
      "static const int month_days[12] = {\n\t31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "days_in_month",
          "args": [
            "i"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "days_in_month",
          "args": [
            "i"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "days_in_month",
          "args": [
            "FEBRUARY"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "leapyear",
          "args": [
            "i"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "leapyear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/clock_subr.c",
          "lines": "77-92",
          "snippet": "static inline int\nleapyear(year)\n\tint year;\n{\n\tint rv = 0;\n\n\tif ((year & 3) == 0) {\n\t\trv = 1;\n\t\tif ((year % 100) == 0) {\n\t\t\trv = 0;\n\t\t\tif ((year % 400) == 0)\n\t\t\t\trv = 1;\n\t\t}\n\t}\n\treturn (rv);\n}",
          "includes": [
            "#include <dev/clock_subr.h>",
            "#include <sys/systm.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline int leapyear",
            "__P((int year));"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/clock_subr.h>\n#include <sys/systm.h>\n#include <sys/types.h>\n\nstatic inline int leapyear;\n__P((int year));\n\nstatic inline int\nleapyear(year)\n\tint year;\n{\n\tint rv = 0;\n\n\tif ((year & 3) == 0) {\n\t\trv = 1;\n\t\tif ((year % 100) == 0) {\n\t\t\trv = 0;\n\t\t\tif ((year % 400) == 0)\n\t\t\t\trv = 1;\n\t\t}\n\t}\n\treturn (rv);\n}"
        }
      },
      {
        "call_info": {
          "callee": "days_in_year",
          "args": [
            "i"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "days_in_year",
          "args": [
            "i"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bcopy",
          "args": [
            "month_days",
            "mthdays",
            "sizeof(mthdays)"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "tr_bcopy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/tropic.c",
          "lines": "1618-1663",
          "snippet": "void \ntr_bcopy(sc, dest, len)\nstruct tr_softc *sc;\t/* pointer to softc struct for this adapter */\nu_char *dest;\t\t/* destination address */\nint len;\t\t/* number of bytes to copy */\n{\n\tstruct rbcb *rbc = &sc->rbc;\t/* pointer to rec buf ctl blk */\n\n\t/* While amount of data needed >= amount in current receive buffer. */\n\twhile (len >= rbc->data_len) {\n\t\t/* Copy all data from receive buffer to destination. */\n\n\t\tbus_space_read_region_1(sc->sc_memt, sc->sc_sramh,\n\t\t    rbc->rbuf_datap, dest, (bus_size_t)rbc->data_len);\n\t\tlen -= rbc->data_len;\t/* update length left to transfer */\n\t\tdest += rbc->data_len;\t/* update destination address */\n\n\t\t/* Make next receive buffer current receive buffer. */\n\t\trbc->rbufp = rbc->rbufp_next;\n\t\tif (rbc->rbufp != 0) { /* More receive buffers? */\n\n\t\t\t/* Calculate pointer to next receive buffer. */\n\t\t\trbc->rbufp_next = RB_INW(sc, rbc->rbufp, RB_NEXTBUF);\n\t\t\tif (rbc->rbufp_next != 0)\n\t\t\t\trbc->rbufp_next -= RB_NEXTBUF;\n\n\t\t\t/* Get pointer to data in current receive buffer. */\n\t\t\trbc->rbuf_datap = rbc->rbufp + RB_DATA;\n\n\t\t\t/* Get length of data in current receive buffer. */\n\t\t\trbc->data_len = RB_INW(sc, rbc->rbufp, RB_BUFLEN);\n\t\t}\n\t\telse {\n\t\t\tif (len != 0)\t/* len should equal zero. */\n\t\t\t\tprintf(\"tr_bcopy: residual data not copied\\n\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/* Amount of data needed is < amount in current receive buffer. */\n\n\tbus_space_read_region_1(sc->sc_memt, sc->sc_sramh,\n\t    rbc->rbuf_datap, dest, (bus_size_t)len);\n\trbc->data_len -= len;\t/* Update count of data in receive buffer. */\n\trbc->rbuf_datap += len;\t/* Update pointer to receive buffer data. */\n}",
          "includes": [
            "#include <dev/ic/tropicvar.h>",
            "#include <dev/ic/tropicreg.h>",
            "#include <machine/bus.h>",
            "#include <machine/cpu.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include <netns/ns_if.h>",
            "#include <netns/ns.h>",
            "#include <net/if_token.h>",
            "#include <netinet/in_var.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/if_ether.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/route.h>",
            "#include <net/netisr.h>",
            "#include <net/if_media.h>",
            "#include <net/if_llc.h>",
            "#include <net/if.h>",
            "#include <sys/device.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/syslog.h>",
            "#include <sys/socket.h>",
            "#include <sys/buf.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"bpfilter.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\ttr_bcopy",
            "struct mbuf *\ntr_get(sc, totlen, ifp)\nstruct tr_softc *sc;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/tropicvar.h>\n#include <dev/ic/tropicreg.h>\n#include <machine/bus.h>\n#include <machine/cpu.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include <netns/ns_if.h>\n#include <netns/ns.h>\n#include <net/if_token.h>\n#include <netinet/in_var.h>\n#include <netinet/ip.h>\n#include <netinet/if_ether.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/route.h>\n#include <net/netisr.h>\n#include <net/if_media.h>\n#include <net/if_llc.h>\n#include <net/if.h>\n#include <sys/device.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/syslog.h>\n#include <sys/socket.h>\n#include <sys/buf.h>\n#include <sys/mbuf.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"bpfilter.h\"\n\nvoid\ttr_bcopy;\nstruct mbuf *\ntr_get(sc, totlen, ifp)\nstruct tr_softc *sc;\n\nvoid \ntr_bcopy(sc, dest, len)\nstruct tr_softc *sc;\t/* pointer to softc struct for this adapter */\nu_char *dest;\t\t/* destination address */\nint len;\t\t/* number of bytes to copy */\n{\n\tstruct rbcb *rbc = &sc->rbc;\t/* pointer to rec buf ctl blk */\n\n\t/* While amount of data needed >= amount in current receive buffer. */\n\twhile (len >= rbc->data_len) {\n\t\t/* Copy all data from receive buffer to destination. */\n\n\t\tbus_space_read_region_1(sc->sc_memt, sc->sc_sramh,\n\t\t    rbc->rbuf_datap, dest, (bus_size_t)rbc->data_len);\n\t\tlen -= rbc->data_len;\t/* update length left to transfer */\n\t\tdest += rbc->data_len;\t/* update destination address */\n\n\t\t/* Make next receive buffer current receive buffer. */\n\t\trbc->rbufp = rbc->rbufp_next;\n\t\tif (rbc->rbufp != 0) { /* More receive buffers? */\n\n\t\t\t/* Calculate pointer to next receive buffer. */\n\t\t\trbc->rbufp_next = RB_INW(sc, rbc->rbufp, RB_NEXTBUF);\n\t\t\tif (rbc->rbufp_next != 0)\n\t\t\t\trbc->rbufp_next -= RB_NEXTBUF;\n\n\t\t\t/* Get pointer to data in current receive buffer. */\n\t\t\trbc->rbuf_datap = rbc->rbufp + RB_DATA;\n\n\t\t\t/* Get length of data in current receive buffer. */\n\t\t\trbc->data_len = RB_INW(sc, rbc->rbufp, RB_BUFLEN);\n\t\t}\n\t\telse {\n\t\t\tif (len != 0)\t/* len should equal zero. */\n\t\t\t\tprintf(\"tr_bcopy: residual data not copied\\n\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/* Amount of data needed is < amount in current receive buffer. */\n\n\tbus_space_read_region_1(sc->sc_memt, sc->sc_sramh,\n\t    rbc->rbuf_datap, dest, (bus_size_t)len);\n\trbc->data_len -= len;\t/* Update count of data in receive buffer. */\n\trbc->rbuf_datap += len;\t/* Update pointer to receive buffer data. */\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/clock_subr.h>\n#include <sys/systm.h>\n#include <sys/types.h>\n\n#define FEBRUARY\t2\n#define\tPOSIX_BASE_YEAR\t1970\n\nstatic inline int leapyear;\nstatic const int month_days[12] = {\n\t31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31\n};\n\nvoid\nclock_secs_to_ymdhms(secs, dt)\n\ttime_t secs;\n\tstruct clock_ymdhms *dt;\n{\n\tint mthdays[12];\n\tint i, days;\n\tint rsec;\t/* remainder seconds */\n\n\tbcopy(month_days, mthdays, sizeof(mthdays));\n\n\tdays = secs / SECDAY;\n\trsec = secs % SECDAY;\n\n\t/* Day of week (Note: 1/1/1970 was a Thursday) */\n\tdt->dt_wday = (days + 4) % 7;\n\n\t/* Subtract out whole years, counting them in i. */\n\tfor (i = POSIX_BASE_YEAR; days >= days_in_year(i); i++)\n\t\tdays -= days_in_year(i);\n\tdt->dt_year = i;\n\n\t/* Subtract out whole months, counting them in i. */\n\tif (leapyear(i))\n\t\tdays_in_month(FEBRUARY) = 29;\n\tfor (i = 1; days >= days_in_month(i); i++)\n\t\tdays -= days_in_month(i);\n\tdt->dt_mon = i;\n\n\t/* Days are what is left over (+1) from all that. */\n\tdt->dt_day = days + 1;\n\n\t/* Hours, minutes, seconds are easy */\n\tdt->dt_hour = rsec / 3600;\n\trsec = rsec % 3600;\n\tdt->dt_min  = rsec / 60;\n\trsec = rsec % 60;\n\tdt->dt_sec  = rsec;\n}"
  },
  {
    "function_name": "clock_ymdhms_to_secs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/clock_subr.c",
    "lines": "94-125",
    "snippet": "time_t\nclock_ymdhms_to_secs(dt)\n\tstruct clock_ymdhms *dt;\n{\n\ttime_t secs;\n\tint i, year, days;\n\n\tyear = dt->dt_year;\n\n\t/*\n\t * Compute days since start of time\n\t * First from years, then from months.\n\t */\n\tdays = 0;\n\tfor (i = POSIX_BASE_YEAR; i < year; i++)\n\t\tdays += days_in_year(i);\n\tif (leapyear(year) && dt->dt_mon > FEBRUARY)\n\t\tdays++;\n\n\t/* Months */\n\tfor (i = 1; i < dt->dt_mon; i++)\n\t  \tdays += days_in_month(i);\n\tdays += (dt->dt_day - 1);\n\n\t/* Add hours, minutes, seconds. */\n\tsecs = ((days\n\t    * 24 + dt->dt_hour)\n\t    * 60 + dt->dt_min)\n\t    * 60 + dt->dt_sec;\n\n\treturn (secs);\n}",
    "includes": [
      "#include <dev/clock_subr.h>",
      "#include <sys/systm.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [
      "#define FEBRUARY\t2",
      "#define\tPOSIX_BASE_YEAR\t1970"
    ],
    "globals_used": [
      "static inline int leapyear",
      "__P((int year));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "days_in_month",
          "args": [
            "i"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "leapyear",
          "args": [
            "year"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "leapyear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/clock_subr.c",
          "lines": "77-92",
          "snippet": "static inline int\nleapyear(year)\n\tint year;\n{\n\tint rv = 0;\n\n\tif ((year & 3) == 0) {\n\t\trv = 1;\n\t\tif ((year % 100) == 0) {\n\t\t\trv = 0;\n\t\t\tif ((year % 400) == 0)\n\t\t\t\trv = 1;\n\t\t}\n\t}\n\treturn (rv);\n}",
          "includes": [
            "#include <dev/clock_subr.h>",
            "#include <sys/systm.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline int leapyear",
            "__P((int year));"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/clock_subr.h>\n#include <sys/systm.h>\n#include <sys/types.h>\n\nstatic inline int leapyear;\n__P((int year));\n\nstatic inline int\nleapyear(year)\n\tint year;\n{\n\tint rv = 0;\n\n\tif ((year & 3) == 0) {\n\t\trv = 1;\n\t\tif ((year % 100) == 0) {\n\t\t\trv = 0;\n\t\t\tif ((year % 400) == 0)\n\t\t\t\trv = 1;\n\t\t}\n\t}\n\treturn (rv);\n}"
        }
      },
      {
        "call_info": {
          "callee": "days_in_year",
          "args": [
            "i"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/clock_subr.h>\n#include <sys/systm.h>\n#include <sys/types.h>\n\n#define FEBRUARY\t2\n#define\tPOSIX_BASE_YEAR\t1970\n\nstatic inline int leapyear;\n__P((int year));\n\ntime_t\nclock_ymdhms_to_secs(dt)\n\tstruct clock_ymdhms *dt;\n{\n\ttime_t secs;\n\tint i, year, days;\n\n\tyear = dt->dt_year;\n\n\t/*\n\t * Compute days since start of time\n\t * First from years, then from months.\n\t */\n\tdays = 0;\n\tfor (i = POSIX_BASE_YEAR; i < year; i++)\n\t\tdays += days_in_year(i);\n\tif (leapyear(year) && dt->dt_mon > FEBRUARY)\n\t\tdays++;\n\n\t/* Months */\n\tfor (i = 1; i < dt->dt_mon; i++)\n\t  \tdays += days_in_month(i);\n\tdays += (dt->dt_day - 1);\n\n\t/* Add hours, minutes, seconds. */\n\tsecs = ((days\n\t    * 24 + dt->dt_hour)\n\t    * 60 + dt->dt_min)\n\t    * 60 + dt->dt_sec;\n\n\treturn (secs);\n}"
  },
  {
    "function_name": "leapyear",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/clock_subr.c",
    "lines": "77-92",
    "snippet": "static inline int\nleapyear(year)\n\tint year;\n{\n\tint rv = 0;\n\n\tif ((year & 3) == 0) {\n\t\trv = 1;\n\t\tif ((year % 100) == 0) {\n\t\t\trv = 0;\n\t\t\tif ((year % 400) == 0)\n\t\t\t\trv = 1;\n\t\t}\n\t}\n\treturn (rv);\n}",
    "includes": [
      "#include <dev/clock_subr.h>",
      "#include <sys/systm.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static inline int leapyear",
      "__P((int year));"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/clock_subr.h>\n#include <sys/systm.h>\n#include <sys/types.h>\n\nstatic inline int leapyear;\n__P((int year));\n\nstatic inline int\nleapyear(year)\n\tint year;\n{\n\tint rv = 0;\n\n\tif ((year & 3) == 0) {\n\t\trv = 1;\n\t\tif ((year % 100) == 0) {\n\t\t\trv = 0;\n\t\t\tif ((year % 400) == 0)\n\t\t\t\trv = 1;\n\t\t}\n\t}\n\treturn (rv);\n}"
  }
]