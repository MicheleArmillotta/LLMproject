[
  {
    "function_name": "rf_ReleaseMemChunk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_memchunk.c",
    "lines": "186-211",
    "snippet": "void \nrf_ReleaseMemChunk(chunk)\n\tRF_ChunkDesc_t *chunk;\n{\n\tRF_ChunkHdr_t *hdr, *ht = NULL, *new;\n\n\tRF_LOCK_MUTEX(chunkmutex);\n\tfor (hdr = chunklist; hdr && hdr->size < chunk->size; ht = hdr, hdr = hdr->next);\n\tif (hdr && hdr->size == chunk->size) {\n\t\tchunk->next = hdr->list;\n\t\thdr->list = chunk;\n\t} else {\n\t\tRF_Malloc(new, sizeof(RF_ChunkHdr_t), (RF_ChunkHdr_t *));\n\t\tnew->size = chunk->size;\n\t\tnew->list = chunk;\n\t\tchunk->next = NULL;\n\t\tif (ht) {\n\t\t\tnew->next = ht->next;\n\t\t\tht->next = new;\n\t\t} else {\n\t\t\tnew->next = hdr;\n\t\t\tchunklist = new;\n\t\t}\n\t}\n\tRF_UNLOCK_MUTEX(chunkmutex);\n}",
    "includes": [
      "#include \"rf_shutdown.h\"",
      "#include \"rf_options.h\"",
      "#include \"rf_general.h\"",
      "#include \"rf_memchunk.h\"",
      "#include \"rf_debugMem.h\"",
      "#include \"rf_threadstuff.h\"",
      "#include \"rf_types.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static RF_ChunkDesc_t *\nNewMemChunk(size, buf)\n\tint     size;",
      "RF_ChunkDesc_t *\nrf_GetMemChunk(size)\n\tint     size;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "RF_UNLOCK_MUTEX",
          "args": [
            "chunkmutex"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_Malloc",
          "args": [
            "new",
            "sizeof(RF_ChunkHdr_t)",
            "(RF_ChunkHdr_t *)"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_LOCK_MUTEX",
          "args": [
            "chunkmutex"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rf_shutdown.h\"\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_memchunk.h\"\n#include \"rf_debugMem.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\nstatic RF_ChunkDesc_t *\nNewMemChunk(size, buf)\n\tint     size;\nRF_ChunkDesc_t *\nrf_GetMemChunk(size)\n\tint     size;\n\nvoid \nrf_ReleaseMemChunk(chunk)\n\tRF_ChunkDesc_t *chunk;\n{\n\tRF_ChunkHdr_t *hdr, *ht = NULL, *new;\n\n\tRF_LOCK_MUTEX(chunkmutex);\n\tfor (hdr = chunklist; hdr && hdr->size < chunk->size; ht = hdr, hdr = hdr->next);\n\tif (hdr && hdr->size == chunk->size) {\n\t\tchunk->next = hdr->list;\n\t\thdr->list = chunk;\n\t} else {\n\t\tRF_Malloc(new, sizeof(RF_ChunkHdr_t), (RF_ChunkHdr_t *));\n\t\tnew->size = chunk->size;\n\t\tnew->list = chunk;\n\t\tchunk->next = NULL;\n\t\tif (ht) {\n\t\t\tnew->next = ht->next;\n\t\t\tht->next = new;\n\t\t} else {\n\t\t\tnew->next = hdr;\n\t\t\tchunklist = new;\n\t\t}\n\t}\n\tRF_UNLOCK_MUTEX(chunkmutex);\n}"
  },
  {
    "function_name": "rf_ConfigureMemChunk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_memchunk.c",
    "lines": "109-130",
    "snippet": "int \nrf_ConfigureMemChunk(listp)\n\tRF_ShutdownList_t **listp;\n{\n\tint     rc;\n\n\tchunklist = NULL;\n\tchunk_hdr_free_list = NULL;\n\tchunk_desc_free_list = NULL;\n\trc = rf_mutex_init(&chunkmutex);\n\tif (rc) {\n\t\tRF_ERRORMSG3(\"Unable to init mutex file %s line %d rc=%d\\n\", __FILE__,\n\t\t    __LINE__, rc);\n\t}\n\trc = rf_ShutdownCreate(listp, rf_ShutdownMemChunk, NULL);\n\tif (rc) {\n\t\tRF_ERRORMSG3(\"Unable to add to shutdown list file %s line %d rc=%d\\n\", __FILE__,\n\t\t    __LINE__, rc);\n\t\trf_mutex_destroy(&chunkmutex);\n\t}\n\treturn (rc);\n}",
    "includes": [
      "#include \"rf_shutdown.h\"",
      "#include \"rf_options.h\"",
      "#include \"rf_general.h\"",
      "#include \"rf_memchunk.h\"",
      "#include \"rf_debugMem.h\"",
      "#include \"rf_threadstuff.h\"",
      "#include \"rf_types.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static RF_ChunkHdr_t *chunklist, *chunk_hdr_free_list;",
      "static RF_ChunkDesc_t *chunk_desc_free_list;",
      "RF_DECLARE_STATIC_MUTEX(chunkmutex)\n\tstatic void rf_ShutdownMemChunk(void *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rf_mutex_destroy",
          "args": [
            "&chunkmutex"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_ERRORMSG3",
          "args": [
            "\"Unable to add to shutdown list file %s line %d rc=%d\\n\"",
            "__FILE__",
            "__LINE__",
            "rc"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rf_ShutdownCreate",
          "args": [
            "listp",
            "rf_ShutdownMemChunk",
            "NULL"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_ERRORMSG3",
          "args": [
            "\"Unable to init mutex file %s line %d rc=%d\\n\"",
            "__FILE__",
            "__LINE__",
            "rc"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rf_mutex_init",
          "args": [
            "&chunkmutex"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "rf_mutex_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_threadstuff.c",
          "lines": "173-186",
          "snippet": "int \nrf_mutex_init(m)\ndecl_simple_lock_data(, *m)\n{\n\tsimple_lock_init(m);\n\treturn (0);\n}\n\nint \nrf_mutex_destroy(m)\ndecl_simple_lock_data(, *m)\n{\n\treturn (0);\n}",
          "includes": [
            "#include \"rf_shutdown.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rf_shutdown.h\"\n#include \"rf_general.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\nint \nrf_mutex_init(m)\ndecl_simple_lock_data(, *m)\n{\n\tsimple_lock_init(m);\n\treturn (0);\n}\n\nint \nrf_mutex_destroy(m)\ndecl_simple_lock_data(, *m)\n{\n\treturn (0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"rf_shutdown.h\"\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_memchunk.h\"\n#include \"rf_debugMem.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\nstatic RF_ChunkHdr_t *chunklist, *chunk_hdr_free_list;\nstatic RF_ChunkDesc_t *chunk_desc_free_list;\nRF_DECLARE_STATIC_MUTEX(chunkmutex)\n\tstatic void rf_ShutdownMemChunk(void *);\n\nint \nrf_ConfigureMemChunk(listp)\n\tRF_ShutdownList_t **listp;\n{\n\tint     rc;\n\n\tchunklist = NULL;\n\tchunk_hdr_free_list = NULL;\n\tchunk_desc_free_list = NULL;\n\trc = rf_mutex_init(&chunkmutex);\n\tif (rc) {\n\t\tRF_ERRORMSG3(\"Unable to init mutex file %s line %d rc=%d\\n\", __FILE__,\n\t\t    __LINE__, rc);\n\t}\n\trc = rf_ShutdownCreate(listp, rf_ShutdownMemChunk, NULL);\n\tif (rc) {\n\t\tRF_ERRORMSG3(\"Unable to add to shutdown list file %s line %d rc=%d\\n\", __FILE__,\n\t\t    __LINE__, rc);\n\t\trf_mutex_destroy(&chunkmutex);\n\t}\n\treturn (rc);\n}"
  },
  {
    "function_name": "rf_ShutdownMemChunk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_memchunk.c",
    "lines": "84-107",
    "snippet": "static void rf_ShutdownMemChunk(ignored)\n\tvoid   *ignored;\n{\n\tRF_ChunkDesc_t *pt, *p;\n\tRF_ChunkHdr_t *hdr, *ht;\n\n\tif (rf_memChunkDebug)\n\t\tprintf(\"Chunklist:\\n\");\n\tfor (hdr = chunklist; hdr;) {\n\t\tfor (p = hdr->list; p;) {\n\t\t\tif (rf_memChunkDebug)\n\t\t\t\tprintf(\"Size %d reuse count %d\\n\", p->size, p->reuse_count);\n\t\t\tpt = p;\n\t\t\tp = p->next;\n\t\t\tRF_Free(pt->buf, pt->size);\n\t\t\tRF_Free(pt, sizeof(*pt));\n\t\t}\n\t\tht = hdr;\n\t\thdr = hdr->next;\n\t\tRF_Free(ht, sizeof(*ht));\n\t}\n\n\trf_mutex_destroy(&chunkmutex);\n}",
    "includes": [
      "#include \"rf_shutdown.h\"",
      "#include \"rf_options.h\"",
      "#include \"rf_general.h\"",
      "#include \"rf_memchunk.h\"",
      "#include \"rf_debugMem.h\"",
      "#include \"rf_threadstuff.h\"",
      "#include \"rf_types.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "RF_DECLARE_STATIC_MUTEX(chunkmutex)\n\tstatic void rf_ShutdownMemChunk(void *);",
      "static RF_ChunkDesc_t *\nNewMemChunk(size, buf)\n\tint     size;",
      "char   *buf;",
      "RF_ChunkDesc_t *\nrf_GetMemChunk(size)\n\tint     size;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rf_mutex_destroy",
          "args": [
            "&chunkmutex"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_Free",
          "args": [
            "ht",
            "sizeof(*ht)"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_Free",
          "args": [
            "pt",
            "sizeof(*pt)"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RF_Free",
          "args": [
            "pt->buf",
            "pt->size"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Size %d reuse count %d\\n\"",
            "p->size",
            "p->reuse_count"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"rf_shutdown.h\"\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_memchunk.h\"\n#include \"rf_debugMem.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\nRF_DECLARE_STATIC_MUTEX(chunkmutex)\n\tstatic void rf_ShutdownMemChunk(void *);\nstatic RF_ChunkDesc_t *\nNewMemChunk(size, buf)\n\tint     size;\nchar   *buf;\nRF_ChunkDesc_t *\nrf_GetMemChunk(size)\n\tint     size;\n\nstatic void rf_ShutdownMemChunk(ignored)\n\tvoid   *ignored;\n{\n\tRF_ChunkDesc_t *pt, *p;\n\tRF_ChunkHdr_t *hdr, *ht;\n\n\tif (rf_memChunkDebug)\n\t\tprintf(\"Chunklist:\\n\");\n\tfor (hdr = chunklist; hdr;) {\n\t\tfor (p = hdr->list; p;) {\n\t\t\tif (rf_memChunkDebug)\n\t\t\t\tprintf(\"Size %d reuse count %d\\n\", p->size, p->reuse_count);\n\t\t\tpt = p;\n\t\t\tp = p->next;\n\t\t\tRF_Free(pt->buf, pt->size);\n\t\t\tRF_Free(pt, sizeof(*pt));\n\t\t}\n\t\tht = hdr;\n\t\thdr = hdr->next;\n\t\tRF_Free(ht, sizeof(*ht));\n\t}\n\n\trf_mutex_destroy(&chunkmutex);\n}"
  }
]