[
  {
    "function_name": "DvcDelayNanoSecond",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3462-3468",
    "snippet": "static void\nDvcDelayNanoSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY((n + 999) / 1000);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void DvcDelayNanoSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DELAY",
          "args": [
            "(n + 999) / 1000"
          ],
          "line": 3467
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcDelayNanoSecond;\n\nstatic void\nDvcDelayNanoSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY((n + 999) / 1000);\n}"
  },
  {
    "function_name": "DvcDelayMicroSecond",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3453-3459",
    "snippet": "static void\nDvcDelayMicroSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DELAY",
          "args": [
            "n"
          ],
          "line": 3458
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\nDvcDelayMicroSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n);\n}"
  },
  {
    "function_name": "DvcSleepMilliSecond",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3444-3450",
    "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DELAY",
          "args": [
            "n * 1000"
          ],
          "line": 3449
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
  },
  {
    "function_name": "DvcLeaveCritical",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3435-3441",
    "snippet": "static void\nDvcLeaveCritical(s)\n\tint             s;\n{\n\n\tsplx(s);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void DvcLeaveCritical"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 3440
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcLeaveCritical;\n\nstatic void\nDvcLeaveCritical(s)\n\tint             s;\n{\n\n\tsplx(s);\n}"
  },
  {
    "function_name": "DvcEnterCritical",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3425-3432",
    "snippet": "static int\nDvcEnterCritical(void)\n{\n\tint             s;\n\n\ts = splbio();\n\treturn (s);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int DvcEnterCritical"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splbio",
          "args": [],
          "line": 3430
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int DvcEnterCritical;\n\nstatic int\nDvcEnterCritical(void)\n{\n\tint             s;\n\n\ts = splbio();\n\treturn (s);\n}"
  },
  {
    "function_name": "AscCompareString",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3401-3417",
    "snippet": "static int\nAscCompareString(str1, str2, len)\n\tu_char         *str1;\n\tu_char         *str2;\n\tint             len;\n{\n\tint             i;\n\tint             diff;\n\n\tfor (i = 0; i < len; i++) {\n\t\tdiff = (int) (str1[i] - str2[i]);\n\t\tif (diff != 0)\n\t\t\treturn (diff);\n\t}\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscCompareString"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscCompareString;\n\nstatic int\nAscCompareString(str1, str2, len)\n\tu_char         *str1;\n\tu_char         *str2;\n\tint             len;\n{\n\tint             i;\n\tint             diff;\n\n\tfor (i = 0; i < len; i++) {\n\t\tdiff = (int) (str1[i] - str2[i]);\n\t\tif (diff != 0)\n\t\t\treturn (diff);\n\t}\n\n\treturn (0);\n}"
  },
  {
    "function_name": "AscAsyncFix",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3344-3393",
    "snippet": "static void\nAscAsyncFix(sc, tid_no, inq)\n\tASC_SOFTC      *sc;\n\tu_int8_t        tid_no;\n\tASC_SCSI_INQUIRY *inq;\n{\n\tu_int8_t        dvc_type;\n\tASC_SCSI_BIT_ID_TYPE tid_bits;\n\n\n\tdvc_type = inq->byte0.peri_dvc_type;\n\ttid_bits = ASC_TIX_TO_TARGET_ID(tid_no);\n\n\tif (sc->bug_fix_cntl & ASC_BUG_FIX_ASYN_USE_SYN) {\n\t\tif (!(sc->init_sdtr & tid_bits)) {\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t(AscCompareString(inq->vendor_id, \"HP \", 3) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer_always |= tid_bits;\n\t\t\t}\n\t\t\tsc->pci_fix_asyn_xfer |= tid_bits;\n\t\t\tif ((dvc_type == SCSI_TYPE_PROC) ||\n\t\t\t    (dvc_type == SCSI_TYPE_SCANNER)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"TANDBERG\", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \" TDC 36\", 7) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"WANGTEK \", 8) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"NEC\t \", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CD-ROM DRIVE\t\", 16) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"YAMAHA\", 6) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CDR400\", 6) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif (sc->pci_fix_asyn_xfer & tid_bits) {\n\t\t\t\tAscSetRunChipSynRegAtID(sc->sc_iot, sc->sc_ioh, tid_no,\n\t\t\t\t\t     ASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t\t\t}\n\t\t}\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscSetRunChipSynRegAtID",
      "static void AscAsyncFix",
      "static int AscCompareString"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetRunChipSynRegAtID",
          "args": [
            "sc->sc_iot",
            "sc->sc_ioh",
            "tid_no",
            "ASYN_SDTR_DATA_FIX_PCI_REV_AB"
          ],
          "line": 3388
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetRunChipSynRegAtID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "890-904",
          "snippet": "static int\nAscSetRunChipSynRegAtID(iot, ioh, tid_no, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n{\n\tint             retval = FALSE;\n\n\tif (AscHostReqRiscHalt(iot, ioh)) {\n\t\tretval = AscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\t\tAscStartChip(iot, ioh);\n\t}\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStartChip",
            "static int AscSetRunChipSynRegAtID",
            "static int AscSetChipSynRegAtID",
            "static int AscHostReqRiscHalt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\nstatic int AscSetRunChipSynRegAtID;\nstatic int AscSetChipSynRegAtID;\nstatic int AscHostReqRiscHalt;\n\nstatic int\nAscSetRunChipSynRegAtID(iot, ioh, tid_no, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n{\n\tint             retval = FALSE;\n\n\tif (AscHostReqRiscHalt(iot, ioh)) {\n\t\tretval = AscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\t\tAscStartChip(iot, ioh);\n\t}\n\treturn (retval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscCompareString",
          "args": [
            "inq->product_id",
            "\"CDR400\"",
            "6"
          ],
          "line": 3384
        },
        "resolved": true,
        "details": {
          "function_name": "AscCompareString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3401-3417",
          "snippet": "static int\nAscCompareString(str1, str2, len)\n\tu_char         *str1;\n\tu_char         *str2;\n\tint             len;\n{\n\tint             i;\n\tint             diff;\n\n\tfor (i = 0; i < len; i++) {\n\t\tdiff = (int) (str1[i] - str2[i]);\n\t\tif (diff != 0)\n\t\t\treturn (diff);\n\t}\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscCompareString"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscCompareString;\n\nstatic int\nAscCompareString(str1, str2, len)\n\tu_char         *str1;\n\tu_char         *str2;\n\tint             len;\n{\n\tint             i;\n\tint             diff;\n\n\tfor (i = 0; i < len; i++) {\n\t\tdiff = (int) (str1[i] - str2[i]);\n\t\tif (diff != 0)\n\t\t\treturn (diff);\n\t}\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TARGET_ID",
          "args": [
            "tid_no"
          ],
          "line": 3355
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetRunChipSynRegAtID;\nstatic void AscAsyncFix;\nstatic int AscCompareString;\n\nstatic void\nAscAsyncFix(sc, tid_no, inq)\n\tASC_SOFTC      *sc;\n\tu_int8_t        tid_no;\n\tASC_SCSI_INQUIRY *inq;\n{\n\tu_int8_t        dvc_type;\n\tASC_SCSI_BIT_ID_TYPE tid_bits;\n\n\n\tdvc_type = inq->byte0.peri_dvc_type;\n\ttid_bits = ASC_TIX_TO_TARGET_ID(tid_no);\n\n\tif (sc->bug_fix_cntl & ASC_BUG_FIX_ASYN_USE_SYN) {\n\t\tif (!(sc->init_sdtr & tid_bits)) {\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t(AscCompareString(inq->vendor_id, \"HP \", 3) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer_always |= tid_bits;\n\t\t\t}\n\t\t\tsc->pci_fix_asyn_xfer |= tid_bits;\n\t\t\tif ((dvc_type == SCSI_TYPE_PROC) ||\n\t\t\t    (dvc_type == SCSI_TYPE_SCANNER)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"TANDBERG\", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \" TDC 36\", 7) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"WANGTEK \", 8) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"NEC\t \", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CD-ROM DRIVE\t\", 16) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"YAMAHA\", 6) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CDR400\", 6) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif (sc->pci_fix_asyn_xfer & tid_bits) {\n\t\t\t\tAscSetRunChipSynRegAtID(sc->sc_iot, sc->sc_ioh, tid_no,\n\t\t\t\t\t     ASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t\t\t}\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "AscTagQueuingSafe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3331-3341",
    "snippet": "static int\nAscTagQueuingSafe(inq)\n\tASC_SCSI_INQUIRY *inq;\n{\n\tif ((inq->add_len >= 32) &&\n\t    (AscCompareString(inq->vendor_id, \"QUANTUM XP34301\", 15) == 0) &&\n\t    (AscCompareString(inq->product_rev_level, \"1071\", 4) == 0)) {\n\t\treturn 0;\n\t}\n\treturn 1;\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscTagQueuingSafe",
      "static int AscCompareString"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscCompareString",
          "args": [
            "inq->product_rev_level",
            "\"1071\"",
            "4"
          ],
          "line": 3337
        },
        "resolved": true,
        "details": {
          "function_name": "AscCompareString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3401-3417",
          "snippet": "static int\nAscCompareString(str1, str2, len)\n\tu_char         *str1;\n\tu_char         *str2;\n\tint             len;\n{\n\tint             i;\n\tint             diff;\n\n\tfor (i = 0; i < len; i++) {\n\t\tdiff = (int) (str1[i] - str2[i]);\n\t\tif (diff != 0)\n\t\t\treturn (diff);\n\t}\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscCompareString"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscCompareString;\n\nstatic int\nAscCompareString(str1, str2, len)\n\tu_char         *str1;\n\tu_char         *str2;\n\tint             len;\n{\n\tint             i;\n\tint             diff;\n\n\tfor (i = 0; i < len; i++) {\n\t\tdiff = (int) (str1[i] - str2[i]);\n\t\tif (diff != 0)\n\t\t\treturn (diff);\n\t}\n\n\treturn (0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscTagQueuingSafe;\nstatic int AscCompareString;\n\nstatic int\nAscTagQueuingSafe(inq)\n\tASC_SCSI_INQUIRY *inq;\n{\n\tif ((inq->add_len >= 32) &&\n\t    (AscCompareString(inq->vendor_id, \"QUANTUM XP34301\", 15) == 0) &&\n\t    (AscCompareString(inq->product_rev_level, \"1071\", 4) == 0)) {\n\t\treturn 0;\n\t}\n\treturn 1;\n}"
  },
  {
    "function_name": "AscInquiryHandling",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3284-3328",
    "snippet": "void\nAscInquiryHandling(sc, tid_no, inq)\n\tASC_SOFTC      *sc;\n\tu_int8_t        tid_no;\n\tASC_SCSI_INQUIRY *inq;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASC_SCSI_BIT_ID_TYPE tid_bit = ASC_TIX_TO_TARGET_ID(tid_no);\n\tASC_SCSI_BIT_ID_TYPE orig_init_sdtr, orig_use_tagged_qng;\n\n\n\torig_init_sdtr = sc->init_sdtr;\n\torig_use_tagged_qng = sc->use_tagged_qng;\n\n\tsc->init_sdtr &= ~tid_bit;\n\tsc->can_tagged_qng &= ~tid_bit;\n\tsc->use_tagged_qng &= ~tid_bit;\n\n\tif (inq->byte3.rsp_data_fmt >= 2 || inq->byte2.ansi_apr_ver >= 2) {\n\t\tif ((sc->sdtr_enable & tid_bit) && inq->byte7.Sync)\n\t\t\tsc->init_sdtr |= tid_bit;\n\n\t\tif ((sc->cmd_qng_enabled & tid_bit) && inq->byte7.CmdQue)\n\t\t\tif (AscTagQueuingSafe(inq)) {\n\t\t\t\tsc->use_tagged_qng |= tid_bit;\n\t\t\t\tsc->can_tagged_qng |= tid_bit;\n\t\t\t}\n\t}\n\tif (orig_use_tagged_qng != sc->use_tagged_qng) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_DISC_ENABLE_B,\n\t\t\t\t sc->disc_enable);\n\t\tAscWriteLramByte(iot, ioh, ASCV_USE_TAGGED_QNG_B,\n\t\t\t\t sc->use_tagged_qng);\n\t\tAscWriteLramByte(iot, ioh, ASCV_CAN_TAGGED_QNG_B,\n\t\t\t\t sc->can_tagged_qng);\n\n\t\tsc->max_dvc_qng[tid_no] =\n\t\t\tsc->max_tag_qng[tid_no];\n\t\tAscWriteLramByte(iot, ioh, ASCV_MAX_DVC_QNG_BEG + tid_no,\n\t\t\t\t sc->max_dvc_qng[tid_no]);\n\t}\n\tif (orig_init_sdtr != sc->init_sdtr)\n\t\tAscAsyncFix(sc, tid_no, inq);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramByte",
      "static int AscTagQueuingSafe",
      "static void AscAsyncFix"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscAsyncFix",
          "args": [
            "sc",
            "tid_no",
            "inq"
          ],
          "line": 3327
        },
        "resolved": true,
        "details": {
          "function_name": "AscAsyncFix",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3344-3393",
          "snippet": "static void\nAscAsyncFix(sc, tid_no, inq)\n\tASC_SOFTC      *sc;\n\tu_int8_t        tid_no;\n\tASC_SCSI_INQUIRY *inq;\n{\n\tu_int8_t        dvc_type;\n\tASC_SCSI_BIT_ID_TYPE tid_bits;\n\n\n\tdvc_type = inq->byte0.peri_dvc_type;\n\ttid_bits = ASC_TIX_TO_TARGET_ID(tid_no);\n\n\tif (sc->bug_fix_cntl & ASC_BUG_FIX_ASYN_USE_SYN) {\n\t\tif (!(sc->init_sdtr & tid_bits)) {\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t(AscCompareString(inq->vendor_id, \"HP \", 3) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer_always |= tid_bits;\n\t\t\t}\n\t\t\tsc->pci_fix_asyn_xfer |= tid_bits;\n\t\t\tif ((dvc_type == SCSI_TYPE_PROC) ||\n\t\t\t    (dvc_type == SCSI_TYPE_SCANNER)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"TANDBERG\", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \" TDC 36\", 7) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"WANGTEK \", 8) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"NEC\t \", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CD-ROM DRIVE\t\", 16) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"YAMAHA\", 6) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CDR400\", 6) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif (sc->pci_fix_asyn_xfer & tid_bits) {\n\t\t\t\tAscSetRunChipSynRegAtID(sc->sc_iot, sc->sc_ioh, tid_no,\n\t\t\t\t\t     ASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t\t\t}\n\t\t}\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscSetRunChipSynRegAtID",
            "static void AscAsyncFix",
            "static int AscCompareString"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetRunChipSynRegAtID;\nstatic void AscAsyncFix;\nstatic int AscCompareString;\n\nstatic void\nAscAsyncFix(sc, tid_no, inq)\n\tASC_SOFTC      *sc;\n\tu_int8_t        tid_no;\n\tASC_SCSI_INQUIRY *inq;\n{\n\tu_int8_t        dvc_type;\n\tASC_SCSI_BIT_ID_TYPE tid_bits;\n\n\n\tdvc_type = inq->byte0.peri_dvc_type;\n\ttid_bits = ASC_TIX_TO_TARGET_ID(tid_no);\n\n\tif (sc->bug_fix_cntl & ASC_BUG_FIX_ASYN_USE_SYN) {\n\t\tif (!(sc->init_sdtr & tid_bits)) {\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t(AscCompareString(inq->vendor_id, \"HP \", 3) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer_always |= tid_bits;\n\t\t\t}\n\t\t\tsc->pci_fix_asyn_xfer |= tid_bits;\n\t\t\tif ((dvc_type == SCSI_TYPE_PROC) ||\n\t\t\t    (dvc_type == SCSI_TYPE_SCANNER)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"TANDBERG\", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \" TDC 36\", 7) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_SASD) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"WANGTEK \", 8) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"NEC\t \", 8) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CD-ROM DRIVE\t\", 16) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif ((dvc_type == SCSI_TYPE_CDROM) &&\n\t\t\t    (AscCompareString(inq->vendor_id, \"YAMAHA\", 6) == 0) &&\n\t\t\t    (AscCompareString(inq->product_id, \"CDR400\", 6) == 0)) {\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~tid_bits;\n\t\t\t}\n\t\t\tif (sc->pci_fix_asyn_xfer & tid_bits) {\n\t\t\t\tAscSetRunChipSynRegAtID(sc->sc_iot, sc->sc_ioh, tid_no,\n\t\t\t\t\t     ASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t\t\t}\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_MAX_DVC_QNG_BEG + tid_no",
            "sc->max_dvc_qng[tid_no]"
          ],
          "line": 3323
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscTagQueuingSafe",
          "args": [
            "inq"
          ],
          "line": 3308
        },
        "resolved": true,
        "details": {
          "function_name": "AscTagQueuingSafe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3331-3341",
          "snippet": "static int\nAscTagQueuingSafe(inq)\n\tASC_SCSI_INQUIRY *inq;\n{\n\tif ((inq->add_len >= 32) &&\n\t    (AscCompareString(inq->vendor_id, \"QUANTUM XP34301\", 15) == 0) &&\n\t    (AscCompareString(inq->product_rev_level, \"1071\", 4) == 0)) {\n\t\treturn 0;\n\t}\n\treturn 1;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscTagQueuingSafe",
            "static int AscCompareString"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscTagQueuingSafe;\nstatic int AscCompareString;\n\nstatic int\nAscTagQueuingSafe(inq)\n\tASC_SCSI_INQUIRY *inq;\n{\n\tif ((inq->add_len >= 32) &&\n\t    (AscCompareString(inq->vendor_id, \"QUANTUM XP34301\", 15) == 0) &&\n\t    (AscCompareString(inq->product_rev_level, \"1071\", 4) == 0)) {\n\t\treturn 0;\n\t}\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TARGET_ID",
          "args": [
            "tid_no"
          ],
          "line": 3292
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic int AscTagQueuingSafe;\nstatic void AscAsyncFix;\n\nvoid\nAscInquiryHandling(sc, tid_no, inq)\n\tASC_SOFTC      *sc;\n\tu_int8_t        tid_no;\n\tASC_SCSI_INQUIRY *inq;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASC_SCSI_BIT_ID_TYPE tid_bit = ASC_TIX_TO_TARGET_ID(tid_no);\n\tASC_SCSI_BIT_ID_TYPE orig_init_sdtr, orig_use_tagged_qng;\n\n\n\torig_init_sdtr = sc->init_sdtr;\n\torig_use_tagged_qng = sc->use_tagged_qng;\n\n\tsc->init_sdtr &= ~tid_bit;\n\tsc->can_tagged_qng &= ~tid_bit;\n\tsc->use_tagged_qng &= ~tid_bit;\n\n\tif (inq->byte3.rsp_data_fmt >= 2 || inq->byte2.ansi_apr_ver >= 2) {\n\t\tif ((sc->sdtr_enable & tid_bit) && inq->byte7.Sync)\n\t\t\tsc->init_sdtr |= tid_bit;\n\n\t\tif ((sc->cmd_qng_enabled & tid_bit) && inq->byte7.CmdQue)\n\t\t\tif (AscTagQueuingSafe(inq)) {\n\t\t\t\tsc->use_tagged_qng |= tid_bit;\n\t\t\t\tsc->can_tagged_qng |= tid_bit;\n\t\t\t}\n\t}\n\tif (orig_use_tagged_qng != sc->use_tagged_qng) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_DISC_ENABLE_B,\n\t\t\t\t sc->disc_enable);\n\t\tAscWriteLramByte(iot, ioh, ASCV_USE_TAGGED_QNG_B,\n\t\t\t\t sc->use_tagged_qng);\n\t\tAscWriteLramByte(iot, ioh, ASCV_CAN_TAGGED_QNG_B,\n\t\t\t\t sc->can_tagged_qng);\n\n\t\tsc->max_dvc_qng[tid_no] =\n\t\t\tsc->max_tag_qng[tid_no];\n\t\tAscWriteLramByte(iot, ioh, ASCV_MAX_DVC_QNG_BEG + tid_no,\n\t\t\t\t sc->max_dvc_qng[tid_no]);\n\t}\n\tif (orig_init_sdtr != sc->init_sdtr)\n\t\tAscAsyncFix(sc, tid_no, inq);\n}"
  },
  {
    "function_name": "AscSetLibErrorCode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3263-3276",
    "snippet": "static int\nAscSetLibErrorCode(sc, err_code)\n\tASC_SOFTC      *sc;\n\tu_int16_t       err_code;\n{\n\t/*\n\t * if(sc->err_code == 0) { sc->err_code = err_code;\n\t */ AscWriteLramWord(sc->sc_iot, sc->sc_ioh, ASCV_ASCDVC_ERR_CODE_W,\n\t\t\t       err_code);\n\t/*\n\t * }\n\t */\n\treturn (err_code);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramWord",
      "static int AscSetLibErrorCode"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "sc->sc_iot",
            "sc->sc_ioh",
            "ASCV_ASCDVC_ERR_CODE_W",
            "err_code"
          ],
          "line": 3270
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\nstatic int AscSetLibErrorCode;\n\nstatic int\nAscSetLibErrorCode(sc, err_code)\n\tASC_SOFTC      *sc;\n\tu_int16_t       err_code;\n{\n\t/*\n\t * if(sc->err_code == 0) { sc->err_code = err_code;\n\t */ AscWriteLramWord(sc->sc_iot, sc->sc_ioh, ASCV_ASCDVC_ERR_CODE_W,\n\t\t\t       err_code);\n\t/*\n\t * }\n\t */\n\treturn (err_code);\n}"
  },
  {
    "function_name": "AscResetBus",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3219-3255",
    "snippet": "int\nAscResetBus(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tint             i;\n\n\n\tsc->unit_not_ready = 0xFF;\n\tretval = ASC_NOERROR;\n\n\tAscWaitISRDone(sc);\n\tAscStopQueueExe(iot, ioh);\n\tsc->sdtr_done = 0;\n\tAscResetChipAndScsiBus(iot, ioh);\n\tDvcSleepMilliSecond((u_long) ((u_int16_t) sc->scsi_reset_wait * 1000));\n\tAscReInitLram(sc);\n\tfor (i = 0; i <= ASC_MAX_TID; i++) {\n\t\tsc->cur_dvc_qng[i] = 0;\n\t\tif (sc->pci_fix_asyn_xfer & (ASC_SCSI_BIT_ID_TYPE) (0x01 << i))\n\t\t\tAscSetChipSynRegAtID(iot, ioh, i, ASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t}\n\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR)\n\t\tretval = ASC_ERROR;\n\n\tif (AscStartChip(iot, ioh) == 0)\n\t\tretval = ASC_ERROR;\n\n\tAscStartQueueExe(iot, ioh);\n\tsc->unit_not_ready = 0;\n\tsc->queue_full_or_busy = 0;\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscResetChipAndScsiBus",
      "static int AscStartChip",
      "static int AscSetChipSynRegAtID",
      "static int AscWaitISRDone",
      "static int AscStopQueueExe",
      "static void AscStartQueueExe",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscStartQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3251
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2944-2952",
          "snippet": "static void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void AscStartQueueExe"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscStartQueueExe;\n\nstatic void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStartChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3248
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "806-816",
          "snippet": "static int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStartChip"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\n\nstatic int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_PC_ADDR",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_PC_ADDR",
          "args": [
            "iot",
            "ioh",
            "ASC_MCODE_START_ADDR"
          ],
          "line": 3244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscSetChipSynRegAtID",
          "args": [
            "iot",
            "ioh",
            "i",
            "ASYN_SDTR_DATA_FIX_PCI_REV_AB"
          ],
          "line": 3241
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipSynRegAtID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "907-938",
          "snippet": "static int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static int AscSetChipSynRegAtID"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic int AscSetChipSynRegAtID;\n\nstatic int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "0x01 << i"
          ],
          "line": 3240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReInitLram",
          "args": [
            "sc"
          ],
          "line": 3237
        },
        "resolved": true,
        "details": {
          "function_name": "AscReInitLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "669-676",
          "snippet": "void\nAscReInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\n\tAscInitLram(sc);\n\tAscInitQLinkVar(sc);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscInitLram",
            "static void AscInitQLinkVar"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitLram;\nstatic void AscInitQLinkVar;\n\nvoid\nAscReInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\n\tAscInitLram(sc);\n\tAscInitQLinkVar(sc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "(u_long) ((u_int16_t) sc->scsi_reset_wait * 1000)"
          ],
          "line": 3236
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "(u_int16_t) sc->scsi_reset_wait * 1000"
          ],
          "line": 3236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscResetChipAndScsiBus",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3235
        },
        "resolved": true,
        "details": {
          "function_name": "AscResetChipAndScsiBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "708-732",
          "snippet": "static int\nAscResetChipAndScsiBus(bus_space_tag_t iot,\n\t\t       bus_space_handle_t ioh)\n{\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\tAscStopChip(iot, ioh);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT);\n\n\tDvcDelayNanoSecond(60000);\n\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\n\tDvcSleepMilliSecond(200);\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\tAscStartChip(iot, ioh);\n\n\tDvcSleepMilliSecond(200);\n\n\treturn (AscIsChipHalted(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscResetChipAndScsiBus",
            "static int AscStartChip",
            "static int AscStopChip",
            "static int AscIsChipHalted",
            "static void AscSetChipIH",
            "static void DvcSleepMilliSecond",
            "static void DvcDelayNanoSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscResetChipAndScsiBus;\nstatic int AscStartChip;\nstatic int AscStopChip;\nstatic int AscIsChipHalted;\nstatic void AscSetChipIH;\nstatic void DvcSleepMilliSecond;\nstatic void DvcDelayNanoSecond;\n\nstatic int\nAscResetChipAndScsiBus(bus_space_tag_t iot,\n\t\t       bus_space_handle_t ioh)\n{\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\tAscStopChip(iot, ioh);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT);\n\n\tDvcDelayNanoSecond(60000);\n\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\n\tDvcSleepMilliSecond(200);\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\tAscStartChip(iot, ioh);\n\n\tDvcSleepMilliSecond(200);\n\n\treturn (AscIsChipHalted(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStopQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3233
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2923-2941",
          "snippet": "static int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static int AscStopQueueExe",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscStopQueueExe;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWaitISRDone",
          "args": [
            "sc"
          ],
          "line": 3232
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitISRDone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1975-1985",
          "snippet": "static int\nAscWaitISRDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tint             tid;\n\n\tfor (tid = 0; tid <= ASC_MAX_TID; tid++)\n\t\tAscWaitTixISRDone(sc, ASC_TID_TO_TIX(tid));\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWaitTixISRDone",
            "static int AscWaitISRDone"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitTixISRDone;\nstatic int AscWaitISRDone;\n\nstatic int\nAscWaitISRDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tint             tid;\n\n\tfor (tid = 0; tid <= ASC_MAX_TID; tid++)\n\t\tAscWaitTixISRDone(sc, ASC_TID_TO_TIX(tid));\n\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscResetChipAndScsiBus;\nstatic int AscStartChip;\nstatic int AscSetChipSynRegAtID;\nstatic int AscWaitISRDone;\nstatic int AscStopQueueExe;\nstatic void AscStartQueueExe;\nstatic void DvcSleepMilliSecond;\n\nint\nAscResetBus(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tint             i;\n\n\n\tsc->unit_not_ready = 0xFF;\n\tretval = ASC_NOERROR;\n\n\tAscWaitISRDone(sc);\n\tAscStopQueueExe(iot, ioh);\n\tsc->sdtr_done = 0;\n\tAscResetChipAndScsiBus(iot, ioh);\n\tDvcSleepMilliSecond((u_long) ((u_int16_t) sc->scsi_reset_wait * 1000));\n\tAscReInitLram(sc);\n\tfor (i = 0; i <= ASC_MAX_TID; i++) {\n\t\tsc->cur_dvc_qng[i] = 0;\n\t\tif (sc->pci_fix_asyn_xfer & (ASC_SCSI_BIT_ID_TYPE) (0x01 << i))\n\t\t\tAscSetChipSynRegAtID(iot, ioh, i, ASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t}\n\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR)\n\t\tretval = ASC_ERROR;\n\n\tif (AscStartChip(iot, ioh) == 0)\n\t\tretval = ASC_ERROR;\n\n\tAscStartQueueExe(iot, ioh);\n\tsc->unit_not_ready = 0;\n\tsc->queue_full_or_busy = 0;\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscResetDevice",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3149-3216",
    "snippet": "int\nAscResetDevice(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_char          target_ix;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tu_int8_t        tid_no;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tint             i;\n\tASC_SCSI_REQ_Q  scsiq_buf;\n\tASC_SCSI_REQ_Q *scsiq;\n\tu_int8_t       *buf;\n\tASC_SCSI_BIT_ID_TYPE saved_unit_not_ready;\n\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\ttarget_id = ASC_TID_TO_TARGET_ID(tid_no);\n\tsaved_unit_not_ready = sc->unit_not_ready;\n\tsc->unit_not_ready = target_id;\n\tretval = ASC_ERROR;\n\n\tAscWaitTixISRDone(sc, target_ix);\n\n\tif (AscStopQueueExe(iot, ioh) == 1) {\n\t\tif (AscRiscHaltedAbortTIX(sc, target_ix) == 1) {\n\t\t\tAscCleanUpBusyQueue(iot, ioh);\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t\tAscWaitTixISRDone(sc, target_ix);\n\t\t\tretval = ASC_NOERROR;\n\t\t\tscsiq = (ASC_SCSI_REQ_Q *) & scsiq_buf;\n\t\t\tbuf = (u_char *) & scsiq_buf;\n\t\t\tfor (i = 0; i < sizeof(ASC_SCSI_REQ_Q); i++)\n\t\t\t\t*buf++ = 0x00;\n\t\t\tscsiq->q1.status = (u_char) ASC_QS_READY;\n\t\t\tscsiq->q2.cdb_len = 6;\n\t\t\tscsiq->q2.tag_code = M2_QTAG_MSG_SIMPLE;\n\t\t\tscsiq->q1.target_id = target_id;\n\t\t\tscsiq->q2.target_ix = ASC_TIDLUN_TO_IX(tid_no, 0);\n\t\t\tscsiq->cdbptr = (u_int8_t *) scsiq->cdb;\n\t\t\tscsiq->q1.cntl = ASC_QC_NO_CALLBACK | ASC_QC_MSG_OUT | ASC_QC_URGENT;\n\t\t\tAscWriteLramByte(iot, ioh, ASCV_MSGOUT_BEG, M1_BUS_DVC_RESET);\n\t\t\tsc->unit_not_ready &= ~target_id;\n\t\t\tsc->sdtr_done |= target_id;\n\t\t\tif (AscExeScsiQueue(sc, (ASC_SCSI_Q *) scsiq) == ASC_NOERROR) {\n\t\t\t\tsc->unit_not_ready = target_id;\n\t\t\t\tDvcSleepMilliSecond(1000);\n\t\t\t\t_AscWaitQDone(iot, ioh, (ASC_SCSI_Q *) scsiq);\n\t\t\t\tif (AscStopQueueExe(iot, ioh) == ASC_NOERROR) {\n\t\t\t\t\tAscCleanUpDiscQueue(iot, ioh);\n\t\t\t\t\tAscStartQueueExe(iot, ioh);\n\t\t\t\t\tif (sc->pci_fix_asyn_xfer & target_id)\n\t\t\t\t\t\tAscSetRunChipSynRegAtID(iot, ioh, tid_no,\n\t\t\t\t\t\t\t\tASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t\t\t\t\tAscWaitTixISRDone(sc, target_ix);\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tretval = ASC_BUSY;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t} else {\n\t\t\tretval = ASC_ERROR;\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t}\n\t}\n\tsc->unit_not_ready = saved_unit_not_ready;\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscSetRunChipSynRegAtID",
      "static void AscWriteLramByte",
      "static int AscWaitTixISRDone",
      "static int AscStopQueueExe",
      "static void AscStartQueueExe",
      "static void AscCleanUpBusyQueue",
      "static int _AscWaitQDone",
      "static int AscCleanUpDiscQueue",
      "static int AscRiscHaltedAbortTIX",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscStartQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3211
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2944-2952",
          "snippet": "static void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void AscStartQueueExe"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscStartQueueExe;\n\nstatic void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWaitTixISRDone",
          "args": [
            "sc",
            "target_ix"
          ],
          "line": 3204
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitTixISRDone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1954-1973",
          "snippet": "static int\nAscWaitTixISRDone(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tu_int8_t        cur_req;\n\tu_int8_t        tid_no;\n\tint             i = 0;\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\twhile (i++ < 10) {\n\t\tif ((cur_req = sc->cur_dvc_qng[tid_no]) == 0)\n\t\t\tbreak;\n\n\t\tDvcSleepMilliSecond(1000L);\n\t\tif (sc->cur_dvc_qng[tid_no] == cur_req)\n\t\t\tbreak;\n\t}\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWaitTixISRDone",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitTixISRDone;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWaitTixISRDone(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tu_int8_t        cur_req;\n\tu_int8_t        tid_no;\n\tint             i = 0;\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\twhile (i++ < 10) {\n\t\tif ((cur_req = sc->cur_dvc_qng[tid_no]) == 0)\n\t\t\tbreak;\n\n\t\tDvcSleepMilliSecond(1000L);\n\t\tif (sc->cur_dvc_qng[tid_no] == cur_req)\n\t\t\tbreak;\n\t}\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetRunChipSynRegAtID",
          "args": [
            "iot",
            "ioh",
            "tid_no",
            "ASYN_SDTR_DATA_FIX_PCI_REV_AB"
          ],
          "line": 3202
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetRunChipSynRegAtID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "890-904",
          "snippet": "static int\nAscSetRunChipSynRegAtID(iot, ioh, tid_no, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n{\n\tint             retval = FALSE;\n\n\tif (AscHostReqRiscHalt(iot, ioh)) {\n\t\tretval = AscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\t\tAscStartChip(iot, ioh);\n\t}\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStartChip",
            "static int AscSetRunChipSynRegAtID",
            "static int AscSetChipSynRegAtID",
            "static int AscHostReqRiscHalt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\nstatic int AscSetRunChipSynRegAtID;\nstatic int AscSetChipSynRegAtID;\nstatic int AscHostReqRiscHalt;\n\nstatic int\nAscSetRunChipSynRegAtID(iot, ioh, tid_no, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n{\n\tint             retval = FALSE;\n\n\tif (AscHostReqRiscHalt(iot, ioh)) {\n\t\tretval = AscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\t\tAscStartChip(iot, ioh);\n\t}\n\treturn (retval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscCleanUpDiscQueue",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3199
        },
        "resolved": true,
        "details": {
          "function_name": "AscCleanUpDiscQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3002-3022",
          "snippet": "static int\nAscCleanUpDiscQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count;\n\tu_int8_t        stop_code;\n\n\tcount = 0;\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_DISC_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_DISC_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static int AscCleanUpDiscQueue",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscCleanUpDiscQueue;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscCleanUpDiscQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count;\n\tu_int8_t        stop_code;\n\n\tcount = 0;\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_DISC_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_DISC_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStopQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3198
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2923-2941",
          "snippet": "static int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static int AscStopQueueExe",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscStopQueueExe;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_AscWaitQDone",
          "args": [
            "iot",
            "ioh",
            "(ASC_SCSI_Q *) scsiq"
          ],
          "line": 3197
        },
        "resolved": true,
        "details": {
          "function_name": "_AscWaitQDone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2977-2999",
          "snippet": "static int\n_AscWaitQDone(iot, ioh, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASC_SCSI_Q     *scsiq;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        q_status;\n\tint             count = 0;\n\n\twhile (scsiq->q1.q_no == 0);\n\n\tq_addr = ASC_QNO_TO_QADDR(scsiq->q1.q_no);\n\tdo {\n\t\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\t\tDvcSleepMilliSecond(100L);\n\t\tif (count++ > 30)\n\t\t\treturn (0);\n\n\t} while ((q_status & ASC_QS_READY) != 0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static int _AscWaitQDone",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic int _AscWaitQDone;\nstatic void DvcSleepMilliSecond;\n\nstatic int\n_AscWaitQDone(iot, ioh, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASC_SCSI_Q     *scsiq;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        q_status;\n\tint             count = 0;\n\n\twhile (scsiq->q1.q_no == 0);\n\n\tq_addr = ASC_QNO_TO_QADDR(scsiq->q1.q_no);\n\tdo {\n\t\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\t\tDvcSleepMilliSecond(100L);\n\t\tif (count++ > 30)\n\t\t\treturn (0);\n\n\t} while ((q_status & ASC_QS_READY) != 0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "1000"
          ],
          "line": 3196
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscExeScsiQueue",
          "args": [
            "sc",
            "(ASC_SCSI_Q *) scsiq"
          ],
          "line": 3194
        },
        "resolved": true,
        "details": {
          "function_name": "AscExeScsiQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2471-2619",
          "snippet": "int\nAscExeScsiQueue(sc, scsiq)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASC_SG_HEAD    *sg_head = scsiq->sg_head;\n\tint             retval;\n\tint             n_q_required;\n\tint             disable_syn_offset_one_fix;\n\tint             i;\n\tu_int32_t       addr;\n\tu_int16_t       sg_entry_cnt = 0;\n\tu_int16_t       sg_entry_cnt_minus_one = 0;\n\tu_int8_t        target_ix;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        extra_bytes;\n\tu_int8_t        scsi_cmd;\n\tu_int32_t       data_cnt;\n\n\n\tscsiq->q1.q_no = 0;\n\tif ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)\n\t\tscsiq->q1.extra_bytes = 0;\n\n\tretval = ASC_BUSY;\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tn_q_required = 1;\n\n\tif (scsiq->cdbptr[0] == SCSICMD_RequestSense)\n\t\tif ((sc->init_sdtr & scsiq->q1.target_id) != 0) {\n\t\t\tsc->sdtr_done &= ~scsiq->q1.target_id;\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      sdtr_data & ASC_SYN_MAX_OFFSET);\n\t\t\tscsiq->q1.cntl |= (ASC_QC_MSG_OUT | ASC_QC_URGENT);\n\t\t}\n\t/*\n\t * if there is just one segment into S/G list then\n\t * map it as it was a single request, filling\n\t * data_addr and data_cnt of ASC_SCSIQ structure.\n\t */\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tsg_entry_cnt = sg_head->entry_cnt;\n\n\t\tif (sg_entry_cnt < 1)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with QC_SG_HEAD set but %d segs.\",\n\t\t\t      sg_entry_cnt);\n\n\t\tif (sg_entry_cnt > ASC_MAX_SG_LIST)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with too many segs.\");\n\n\t\tif (sg_entry_cnt == 1) {\n\t\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\t\tscsiq->q1.cntl &= ~(ASC_QC_SG_HEAD | ASC_QC_SG_SWAP_QUEUE);\n\t\t}\n\t\tsg_entry_cnt_minus_one = sg_entry_cnt - 1;\n\t}\n\tscsi_cmd = scsiq->cdbptr[0];\n\tdisable_syn_offset_one_fix = FALSE;\n\tif ((sc->pci_fix_asyn_xfer & scsiq->q1.target_id) &&\n\t    !(sc->pci_fix_asyn_xfer_always & scsiq->q1.target_id)) {\n\t\tif (scsiq->q1.cntl & ASC_QC_SG_HEAD) {\n\t\t\tdata_cnt = 0;\n\t\t\tfor (i = 0; i < sg_entry_cnt; i++)\n\t\t\t\tdata_cnt += sg_head->sg_list[i].bytes;\n\t\t} else {\n\t\t\tdata_cnt = scsiq->q1.data_cnt;\n\t\t}\n\n\t\tif (data_cnt != 0ul) {\n\t\t\tif (data_cnt < 512ul) {\n\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t} else {\n\t\t\t\tif (scsi_cmd == SCSICMD_Inquiry ||\n\t\t\t\t    scsi_cmd == SCSICMD_RequestSense ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadCapacity ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadTOC ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect10 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense10) {\n\t\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (disable_syn_offset_one_fix) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t\tscsiq->q2.tag_code |= (ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX |\n\t\t\t\t       ASC_TAG_FLAG_DISABLE_DISCONNECT);\n\t} else {\n\t\tscsiq->q2.tag_code &= 0x23;\n\t}\n\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = sg_head->sg_list[sg_entry_cnt_minus_one].addr +\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes -=\n\t\t\t\t\t\t\textra_bytes;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsg_head->entry_to_copy = sg_head->entry_cnt;\n\t\tn_q_required = AscSgListToQueue(sg_entry_cnt);\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, n_q_required) >= n_q_required)\n\t\t    || ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t} else {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = scsiq->q1.data_addr + scsiq->q1.data_cnt;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tif ((scsiq->q1.data_cnt & 0x01FF) == 0) {\n\t\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\t\tscsiq->q1.data_cnt -= extra_bytes;\n\t\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tn_q_required = 1;\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, 1) >= 1) ||\n\t\t    ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t}\n\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscMsgOutSDTR",
            "static int AscSendScsiQueue",
            "static int AscSgListToQueue",
            "static u_int AscGetNumOfFreeQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscMsgOutSDTR;\nstatic int AscSendScsiQueue;\nstatic int AscSgListToQueue;\nstatic u_int AscGetNumOfFreeQueue;\n\nint\nAscExeScsiQueue(sc, scsiq)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASC_SG_HEAD    *sg_head = scsiq->sg_head;\n\tint             retval;\n\tint             n_q_required;\n\tint             disable_syn_offset_one_fix;\n\tint             i;\n\tu_int32_t       addr;\n\tu_int16_t       sg_entry_cnt = 0;\n\tu_int16_t       sg_entry_cnt_minus_one = 0;\n\tu_int8_t        target_ix;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        extra_bytes;\n\tu_int8_t        scsi_cmd;\n\tu_int32_t       data_cnt;\n\n\n\tscsiq->q1.q_no = 0;\n\tif ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)\n\t\tscsiq->q1.extra_bytes = 0;\n\n\tretval = ASC_BUSY;\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tn_q_required = 1;\n\n\tif (scsiq->cdbptr[0] == SCSICMD_RequestSense)\n\t\tif ((sc->init_sdtr & scsiq->q1.target_id) != 0) {\n\t\t\tsc->sdtr_done &= ~scsiq->q1.target_id;\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      sdtr_data & ASC_SYN_MAX_OFFSET);\n\t\t\tscsiq->q1.cntl |= (ASC_QC_MSG_OUT | ASC_QC_URGENT);\n\t\t}\n\t/*\n\t * if there is just one segment into S/G list then\n\t * map it as it was a single request, filling\n\t * data_addr and data_cnt of ASC_SCSIQ structure.\n\t */\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tsg_entry_cnt = sg_head->entry_cnt;\n\n\t\tif (sg_entry_cnt < 1)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with QC_SG_HEAD set but %d segs.\",\n\t\t\t      sg_entry_cnt);\n\n\t\tif (sg_entry_cnt > ASC_MAX_SG_LIST)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with too many segs.\");\n\n\t\tif (sg_entry_cnt == 1) {\n\t\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\t\tscsiq->q1.cntl &= ~(ASC_QC_SG_HEAD | ASC_QC_SG_SWAP_QUEUE);\n\t\t}\n\t\tsg_entry_cnt_minus_one = sg_entry_cnt - 1;\n\t}\n\tscsi_cmd = scsiq->cdbptr[0];\n\tdisable_syn_offset_one_fix = FALSE;\n\tif ((sc->pci_fix_asyn_xfer & scsiq->q1.target_id) &&\n\t    !(sc->pci_fix_asyn_xfer_always & scsiq->q1.target_id)) {\n\t\tif (scsiq->q1.cntl & ASC_QC_SG_HEAD) {\n\t\t\tdata_cnt = 0;\n\t\t\tfor (i = 0; i < sg_entry_cnt; i++)\n\t\t\t\tdata_cnt += sg_head->sg_list[i].bytes;\n\t\t} else {\n\t\t\tdata_cnt = scsiq->q1.data_cnt;\n\t\t}\n\n\t\tif (data_cnt != 0ul) {\n\t\t\tif (data_cnt < 512ul) {\n\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t} else {\n\t\t\t\tif (scsi_cmd == SCSICMD_Inquiry ||\n\t\t\t\t    scsi_cmd == SCSICMD_RequestSense ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadCapacity ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadTOC ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect10 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense10) {\n\t\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (disable_syn_offset_one_fix) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t\tscsiq->q2.tag_code |= (ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX |\n\t\t\t\t       ASC_TAG_FLAG_DISABLE_DISCONNECT);\n\t} else {\n\t\tscsiq->q2.tag_code &= 0x23;\n\t}\n\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = sg_head->sg_list[sg_entry_cnt_minus_one].addr +\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes -=\n\t\t\t\t\t\t\textra_bytes;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsg_head->entry_to_copy = sg_head->entry_cnt;\n\t\tn_q_required = AscSgListToQueue(sg_entry_cnt);\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, n_q_required) >= n_q_required)\n\t\t    || ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t} else {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = scsiq->q1.data_addr + scsiq->q1.data_cnt;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tif ((scsiq->q1.data_cnt & 0x01FF) == 0) {\n\t\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\t\tscsiq->q1.data_cnt -= extra_bytes;\n\t\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tn_q_required = 1;\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, 1) >= 1) ||\n\t\t    ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t}\n\n\treturn (retval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_MSGOUT_BEG",
            "M1_BUS_DVC_RESET"
          ],
          "line": 3191
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TIDLUN_TO_IX",
          "args": [
            "tid_no",
            "0"
          ],
          "line": 3188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscCleanUpBusyQueue",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3176
        },
        "resolved": true,
        "details": {
          "function_name": "AscCleanUpBusyQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2955-2974",
          "snippet": "static void\nAscCleanUpBusyQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tu_int8_t        stop_code;\n\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_BUSY_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_BUSY_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void AscCleanUpBusyQueue",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscCleanUpBusyQueue;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscCleanUpBusyQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tu_int8_t        stop_code;\n\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_BUSY_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_BUSY_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscRiscHaltedAbortTIX",
          "args": [
            "sc",
            "target_ix"
          ],
          "line": 3175
        },
        "resolved": true,
        "details": {
          "function_name": "AscRiscHaltedAbortTIX",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3105-3141",
          "snippet": "static int\nAscRiscHaltedAbortTIX(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\tif (((scsiq->q_status & ASC_QS_READY) != 0) &&\n\t\t    ((scsiq->q_status & ASC_QS_ABORTED) == 0) &&\n\t\t    ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\tif (scsiq->d2.target_ix == target_ix) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t}\n\t\t}\n\t}\n\tDvcLeaveCritical(last_int_level);\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static void AscWriteLramDWord",
            "static u_int8_t _AscCopyLramScsiDoneQ",
            "static int AscRiscHaltedAbortTIX",
            "static int DvcEnterCritical",
            "static void DvcLeaveCritical"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic void AscWriteLramDWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic int AscRiscHaltedAbortTIX;\nstatic int DvcEnterCritical;\nstatic void DvcLeaveCritical;\n\nstatic int\nAscRiscHaltedAbortTIX(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\tif (((scsiq->q_status & ASC_QS_READY) != 0) &&\n\t\t    ((scsiq->q_status & ASC_QS_ABORTED) == 0) &&\n\t\t    ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\tif (scsiq->d2.target_ix == target_ix) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t}\n\t\t}\n\t}\n\tDvcLeaveCritical(last_int_level);\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TID_TO_TARGET_ID",
          "args": [
            "tid_no"
          ],
          "line": 3167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "target_ix"
          ],
          "line": 3166
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetRunChipSynRegAtID;\nstatic void AscWriteLramByte;\nstatic int AscWaitTixISRDone;\nstatic int AscStopQueueExe;\nstatic void AscStartQueueExe;\nstatic void AscCleanUpBusyQueue;\nstatic int _AscWaitQDone;\nstatic int AscCleanUpDiscQueue;\nstatic int AscRiscHaltedAbortTIX;\nstatic void DvcSleepMilliSecond;\n\nint\nAscResetDevice(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_char          target_ix;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tu_int8_t        tid_no;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tint             i;\n\tASC_SCSI_REQ_Q  scsiq_buf;\n\tASC_SCSI_REQ_Q *scsiq;\n\tu_int8_t       *buf;\n\tASC_SCSI_BIT_ID_TYPE saved_unit_not_ready;\n\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\ttarget_id = ASC_TID_TO_TARGET_ID(tid_no);\n\tsaved_unit_not_ready = sc->unit_not_ready;\n\tsc->unit_not_ready = target_id;\n\tretval = ASC_ERROR;\n\n\tAscWaitTixISRDone(sc, target_ix);\n\n\tif (AscStopQueueExe(iot, ioh) == 1) {\n\t\tif (AscRiscHaltedAbortTIX(sc, target_ix) == 1) {\n\t\t\tAscCleanUpBusyQueue(iot, ioh);\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t\tAscWaitTixISRDone(sc, target_ix);\n\t\t\tretval = ASC_NOERROR;\n\t\t\tscsiq = (ASC_SCSI_REQ_Q *) & scsiq_buf;\n\t\t\tbuf = (u_char *) & scsiq_buf;\n\t\t\tfor (i = 0; i < sizeof(ASC_SCSI_REQ_Q); i++)\n\t\t\t\t*buf++ = 0x00;\n\t\t\tscsiq->q1.status = (u_char) ASC_QS_READY;\n\t\t\tscsiq->q2.cdb_len = 6;\n\t\t\tscsiq->q2.tag_code = M2_QTAG_MSG_SIMPLE;\n\t\t\tscsiq->q1.target_id = target_id;\n\t\t\tscsiq->q2.target_ix = ASC_TIDLUN_TO_IX(tid_no, 0);\n\t\t\tscsiq->cdbptr = (u_int8_t *) scsiq->cdb;\n\t\t\tscsiq->q1.cntl = ASC_QC_NO_CALLBACK | ASC_QC_MSG_OUT | ASC_QC_URGENT;\n\t\t\tAscWriteLramByte(iot, ioh, ASCV_MSGOUT_BEG, M1_BUS_DVC_RESET);\n\t\t\tsc->unit_not_ready &= ~target_id;\n\t\t\tsc->sdtr_done |= target_id;\n\t\t\tif (AscExeScsiQueue(sc, (ASC_SCSI_Q *) scsiq) == ASC_NOERROR) {\n\t\t\t\tsc->unit_not_ready = target_id;\n\t\t\t\tDvcSleepMilliSecond(1000);\n\t\t\t\t_AscWaitQDone(iot, ioh, (ASC_SCSI_Q *) scsiq);\n\t\t\t\tif (AscStopQueueExe(iot, ioh) == ASC_NOERROR) {\n\t\t\t\t\tAscCleanUpDiscQueue(iot, ioh);\n\t\t\t\t\tAscStartQueueExe(iot, ioh);\n\t\t\t\t\tif (sc->pci_fix_asyn_xfer & target_id)\n\t\t\t\t\t\tAscSetRunChipSynRegAtID(iot, ioh, tid_no,\n\t\t\t\t\t\t\t\tASYN_SDTR_DATA_FIX_PCI_REV_AB);\n\t\t\t\t\tAscWaitTixISRDone(sc, target_ix);\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tretval = ASC_BUSY;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t} else {\n\t\t\tretval = ASC_ERROR;\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t}\n\t}\n\tsc->unit_not_ready = saved_unit_not_ready;\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscRiscHaltedAbortTIX",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3105-3141",
    "snippet": "static int\nAscRiscHaltedAbortTIX(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\tif (((scsiq->q_status & ASC_QS_READY) != 0) &&\n\t\t    ((scsiq->q_status & ASC_QS_ABORTED) == 0) &&\n\t\t    ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\tif (scsiq->d2.target_ix == target_ix) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t}\n\t\t}\n\t}\n\tDvcLeaveCritical(last_int_level);\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramByte",
      "static void AscWriteLramDWord",
      "static u_int8_t _AscCopyLramScsiDoneQ",
      "static int AscRiscHaltedAbortTIX",
      "static int DvcEnterCritical",
      "static void DvcLeaveCritical"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcLeaveCritical",
          "args": [
            "last_int_level"
          ],
          "line": 3139
        },
        "resolved": true,
        "details": {
          "function_name": "DvcLeaveCritical",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3435-3441",
          "snippet": "static void\nDvcLeaveCritical(s)\n\tint             s;\n{\n\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcLeaveCritical"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcLeaveCritical;\n\nstatic void\nDvcLeaveCritical(s)\n\tint             s;\n{\n\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "sc",
            "scsiq"
          ],
          "line": 3135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_B_STATUS",
            "scsiq->q_status"
          ],
          "line": 3133
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramDWord",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_D_CCBPTR",
            "0L"
          ],
          "line": 3132
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramDWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1096-1107",
          "snippet": "static void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramDWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramDWord;\n\nstatic void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}"
        }
      },
      {
        "call_info": {
          "callee": "_AscCopyLramScsiDoneQ",
          "args": [
            "iot",
            "ioh",
            "q_addr",
            "scsiq",
            "sc->max_dma_count"
          ],
          "line": 3125
        },
        "resolved": true,
        "details": {
          "function_name": "_AscCopyLramScsiDoneQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1988-2015",
          "snippet": "static u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord",
            "static u_int8_t _AscCopyLramScsiDoneQ",
            "static void AscGetQDoneInfo"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic void AscGetQDoneInfo;\n\nstatic u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "q_no"
          ],
          "line": 3124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DvcEnterCritical",
          "args": [],
          "line": 3121
        },
        "resolved": true,
        "details": {
          "function_name": "DvcEnterCritical",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3425-3432",
          "snippet": "static int\nDvcEnterCritical(void)\n{\n\tint             s;\n\n\ts = splbio();\n\treturn (s);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int DvcEnterCritical"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int DvcEnterCritical;\n\nstatic int\nDvcEnterCritical(void)\n{\n\tint             s;\n\n\ts = splbio();\n\treturn (s);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic void AscWriteLramDWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic int AscRiscHaltedAbortTIX;\nstatic int DvcEnterCritical;\nstatic void DvcLeaveCritical;\n\nstatic int\nAscRiscHaltedAbortTIX(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\tif (((scsiq->q_status & ASC_QS_READY) != 0) &&\n\t\t    ((scsiq->q_status & ASC_QS_ABORTED) == 0) &&\n\t\t    ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\tif (scsiq->d2.target_ix == target_ix) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t}\n\t\t}\n\t}\n\tDvcLeaveCritical(last_int_level);\n\treturn (1);\n}"
  },
  {
    "function_name": "AscRiscHaltedAbortCCB",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3061-3102",
    "snippet": "static int\nAscRiscHaltedAbortCCB(sc, ccb)\n\tASC_SOFTC      *sc;\n\tu_int32_t       ccb;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\tscsiq->d2.ccb_ptr = AscReadLramDWord(iot, ioh,\n\t\t\t\t\t       q_addr + ASC_SCSIQ_D_CCBPTR);\n\t\tif (scsiq->d2.ccb_ptr == ccb) {\n\t\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\t\tif (((scsiq->q_status & ASC_QS_READY) != 0)\n\t\t\t    && ((scsiq->q_status & ASC_QS_ABORTED) == 0)\n\t\t\t  && ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t\treturn (1);\n\t\t\t}\n\t\t}\n\t}\n\n\tDvcLeaveCritical(last_int_level);\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramByte",
      "static u_int32_t AscReadLramDWord",
      "static void AscWriteLramDWord",
      "static u_int8_t _AscCopyLramScsiDoneQ",
      "static int AscRiscHaltedAbortCCB",
      "static int DvcEnterCritical",
      "static void DvcLeaveCritical"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcLeaveCritical",
          "args": [
            "last_int_level"
          ],
          "line": 3100
        },
        "resolved": true,
        "details": {
          "function_name": "DvcLeaveCritical",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3435-3441",
          "snippet": "static void\nDvcLeaveCritical(s)\n\tint             s;\n{\n\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcLeaveCritical"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcLeaveCritical;\n\nstatic void\nDvcLeaveCritical(s)\n\tint             s;\n{\n\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "sc",
            "scsiq"
          ],
          "line": 3094
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_B_STATUS",
            "scsiq->q_status"
          ],
          "line": 3092
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramDWord",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_D_CCBPTR",
            "0L"
          ],
          "line": 3091
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramDWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1096-1107",
          "snippet": "static void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramDWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramDWord;\n\nstatic void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}"
        }
      },
      {
        "call_info": {
          "callee": "_AscCopyLramScsiDoneQ",
          "args": [
            "iot",
            "ioh",
            "q_addr",
            "scsiq",
            "sc->max_dma_count"
          ],
          "line": 3085
        },
        "resolved": true,
        "details": {
          "function_name": "_AscCopyLramScsiDoneQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1988-2015",
          "snippet": "static u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord",
            "static u_int8_t _AscCopyLramScsiDoneQ",
            "static void AscGetQDoneInfo"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic void AscGetQDoneInfo;\n\nstatic u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramDWord",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_D_CCBPTR"
          ],
          "line": 3082
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramDWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1079-1093",
          "snippet": "static u_int32_t\nAscReadLramDWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int16_t       low_word, hi_word;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tlow_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\thi_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\treturn ((((u_int32_t) hi_word) << 16) | (u_int32_t) low_word);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int32_t AscReadLramDWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscReadLramDWord;\n\nstatic u_int32_t\nAscReadLramDWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int16_t       low_word, hi_word;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tlow_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\thi_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\treturn ((((u_int32_t) hi_word) << 16) | (u_int32_t) low_word);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "q_no"
          ],
          "line": 3081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DvcEnterCritical",
          "args": [],
          "line": 3077
        },
        "resolved": true,
        "details": {
          "function_name": "DvcEnterCritical",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3425-3432",
          "snippet": "static int\nDvcEnterCritical(void)\n{\n\tint             s;\n\n\ts = splbio();\n\treturn (s);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int DvcEnterCritical"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int DvcEnterCritical;\n\nstatic int\nDvcEnterCritical(void)\n{\n\tint             s;\n\n\ts = splbio();\n\treturn (s);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int32_t AscReadLramDWord;\nstatic void AscWriteLramDWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic int AscRiscHaltedAbortCCB;\nstatic int DvcEnterCritical;\nstatic void DvcLeaveCritical;\n\nstatic int\nAscRiscHaltedAbortCCB(sc, ccb)\n\tASC_SOFTC      *sc;\n\tu_int32_t       ccb;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\tscsiq->d2.ccb_ptr = AscReadLramDWord(iot, ioh,\n\t\t\t\t\t       q_addr + ASC_SCSIQ_D_CCBPTR);\n\t\tif (scsiq->d2.ccb_ptr == ccb) {\n\t\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\t\tif (((scsiq->q_status & ASC_QS_READY) != 0)\n\t\t\t    && ((scsiq->q_status & ASC_QS_ABORTED) == 0)\n\t\t\t  && ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t\treturn (1);\n\t\t\t}\n\t\t}\n\t}\n\n\tDvcLeaveCritical(last_int_level);\n\treturn (0);\n}"
  },
  {
    "function_name": "AscAbortCCB",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3030-3058",
    "snippet": "int\nAscAbortCCB(sc, ccb)\n\tASC_SOFTC      *sc;\n\tu_int32_t       ccb;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tASC_SCSI_BIT_ID_TYPE saved_unit_not_ready;\n\n\n\tretval = -1;\n\tsaved_unit_not_ready = sc->unit_not_ready;\n\tsc->unit_not_ready = 0xFF;\n\tAscWaitISRDone(sc);\n\tif (AscStopQueueExe(iot, ioh) == 1) {\n\t\tif (AscRiscHaltedAbortCCB(sc, ccb) == 1) {\n\t\t\tretval = 1;\n\t\t\tAscCleanUpBusyQueue(iot, ioh);\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t} else {\n\t\t\tretval = 0;\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t}\n\t}\n\tsc->unit_not_ready = saved_unit_not_ready;\n\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWaitISRDone",
      "static int AscStopQueueExe",
      "static void AscStartQueueExe",
      "static void AscCleanUpBusyQueue",
      "static int AscRiscHaltedAbortCCB"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscStartQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3052
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2944-2952",
          "snippet": "static void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void AscStartQueueExe"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscStartQueueExe;\n\nstatic void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscCleanUpBusyQueue",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3048
        },
        "resolved": true,
        "details": {
          "function_name": "AscCleanUpBusyQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2955-2974",
          "snippet": "static void\nAscCleanUpBusyQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tu_int8_t        stop_code;\n\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_BUSY_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_BUSY_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void AscCleanUpBusyQueue",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscCleanUpBusyQueue;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscCleanUpBusyQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tu_int8_t        stop_code;\n\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_BUSY_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_BUSY_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscRiscHaltedAbortCCB",
          "args": [
            "sc",
            "ccb"
          ],
          "line": 3046
        },
        "resolved": true,
        "details": {
          "function_name": "AscRiscHaltedAbortCCB",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3061-3102",
          "snippet": "static int\nAscRiscHaltedAbortCCB(sc, ccb)\n\tASC_SOFTC      *sc;\n\tu_int32_t       ccb;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\tscsiq->d2.ccb_ptr = AscReadLramDWord(iot, ioh,\n\t\t\t\t\t       q_addr + ASC_SCSIQ_D_CCBPTR);\n\t\tif (scsiq->d2.ccb_ptr == ccb) {\n\t\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\t\tif (((scsiq->q_status & ASC_QS_READY) != 0)\n\t\t\t    && ((scsiq->q_status & ASC_QS_ABORTED) == 0)\n\t\t\t  && ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t\treturn (1);\n\t\t\t}\n\t\t}\n\t}\n\n\tDvcLeaveCritical(last_int_level);\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int32_t AscReadLramDWord",
            "static void AscWriteLramDWord",
            "static u_int8_t _AscCopyLramScsiDoneQ",
            "static int AscRiscHaltedAbortCCB",
            "static int DvcEnterCritical",
            "static void DvcLeaveCritical"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int32_t AscReadLramDWord;\nstatic void AscWriteLramDWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic int AscRiscHaltedAbortCCB;\nstatic int DvcEnterCritical;\nstatic void DvcLeaveCritical;\n\nstatic int\nAscRiscHaltedAbortCCB(sc, ccb)\n\tASC_SOFTC      *sc;\n\tu_int32_t       ccb;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        q_no;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\tint             last_int_level;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tlast_int_level = DvcEnterCritical();\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\n\tfor (q_no = ASC_MIN_ACTIVE_QNO; q_no <= sc->max_total_qng; q_no++) {\n\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\tscsiq->d2.ccb_ptr = AscReadLramDWord(iot, ioh,\n\t\t\t\t\t       q_addr + ASC_SCSIQ_D_CCBPTR);\n\t\tif (scsiq->d2.ccb_ptr == ccb) {\n\t\t\t_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, sc->max_dma_count);\n\t\t\tif (((scsiq->q_status & ASC_QS_READY) != 0)\n\t\t\t    && ((scsiq->q_status & ASC_QS_ABORTED) == 0)\n\t\t\t  && ((scsiq->cntl & ASC_QCSG_SG_XFER_LIST) == 0)) {\n\t\t\t\tscsiq->q_status |= ASC_QS_ABORTED;\n\t\t\t\tscsiq->d3.done_stat = ASC_QD_ABORTED_BY_HOST;\n\t\t\t\tAscWriteLramDWord(iot, ioh, q_addr + ASC_SCSIQ_D_CCBPTR, 0L);\n\t\t\t\tAscWriteLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t\t\t\t scsiq->q_status);\n\t\t\t\t(*asc_isr_callback) (sc, scsiq);\n\t\t\t\treturn (1);\n\t\t\t}\n\t\t}\n\t}\n\n\tDvcLeaveCritical(last_int_level);\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStopQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 3045
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2923-2941",
          "snippet": "static int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static int AscStopQueueExe",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscStopQueueExe;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWaitISRDone",
          "args": [
            "sc"
          ],
          "line": 3044
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitISRDone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1975-1985",
          "snippet": "static int\nAscWaitISRDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tint             tid;\n\n\tfor (tid = 0; tid <= ASC_MAX_TID; tid++)\n\t\tAscWaitTixISRDone(sc, ASC_TID_TO_TIX(tid));\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWaitTixISRDone",
            "static int AscWaitISRDone"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitTixISRDone;\nstatic int AscWaitISRDone;\n\nstatic int\nAscWaitISRDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tint             tid;\n\n\tfor (tid = 0; tid <= ASC_MAX_TID; tid++)\n\t\tAscWaitTixISRDone(sc, ASC_TID_TO_TIX(tid));\n\n\treturn (1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitISRDone;\nstatic int AscStopQueueExe;\nstatic void AscStartQueueExe;\nstatic void AscCleanUpBusyQueue;\nstatic int AscRiscHaltedAbortCCB;\n\nint\nAscAbortCCB(sc, ccb)\n\tASC_SOFTC      *sc;\n\tu_int32_t       ccb;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tASC_SCSI_BIT_ID_TYPE saved_unit_not_ready;\n\n\n\tretval = -1;\n\tsaved_unit_not_ready = sc->unit_not_ready;\n\tsc->unit_not_ready = 0xFF;\n\tAscWaitISRDone(sc);\n\tif (AscStopQueueExe(iot, ioh) == 1) {\n\t\tif (AscRiscHaltedAbortCCB(sc, ccb) == 1) {\n\t\t\tretval = 1;\n\t\t\tAscCleanUpBusyQueue(iot, ioh);\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t} else {\n\t\t\tretval = 0;\n\t\t\tAscStartQueueExe(iot, ioh);\n\t\t}\n\t}\n\tsc->unit_not_ready = saved_unit_not_ready;\n\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscCleanUpDiscQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "3002-3022",
    "snippet": "static int\nAscCleanUpDiscQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count;\n\tu_int8_t        stop_code;\n\n\tcount = 0;\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_DISC_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_DISC_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static int AscCleanUpDiscQueue",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "100"
          ],
          "line": 3018
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B"
          ],
          "line": 3014
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B",
            "ASC_STOP_CLEAN_UP_DISC_Q"
          ],
          "line": 3012
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscCleanUpDiscQueue;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscCleanUpDiscQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count;\n\tu_int8_t        stop_code;\n\n\tcount = 0;\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_DISC_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_DISC_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (1);\n}"
  },
  {
    "function_name": "_AscWaitQDone",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2977-2999",
    "snippet": "static int\n_AscWaitQDone(iot, ioh, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASC_SCSI_Q     *scsiq;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        q_status;\n\tint             count = 0;\n\n\twhile (scsiq->q1.q_no == 0);\n\n\tq_addr = ASC_QNO_TO_QADDR(scsiq->q1.q_no);\n\tdo {\n\t\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\t\tDvcSleepMilliSecond(100L);\n\t\tif (count++ > 30)\n\t\t\treturn (0);\n\n\t} while ((q_status & ASC_QS_READY) != 0);\n\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static int _AscWaitQDone",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "100L"
          ],
          "line": 2992
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_B_STATUS"
          ],
          "line": 2991
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "scsiq->q1.q_no"
          ],
          "line": 2989
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic int _AscWaitQDone;\nstatic void DvcSleepMilliSecond;\n\nstatic int\n_AscWaitQDone(iot, ioh, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASC_SCSI_Q     *scsiq;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        q_status;\n\tint             count = 0;\n\n\twhile (scsiq->q1.q_no == 0);\n\n\tq_addr = ASC_QNO_TO_QADDR(scsiq->q1.q_no);\n\tdo {\n\t\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\t\tDvcSleepMilliSecond(100L);\n\t\tif (count++ > 30)\n\t\t\treturn (0);\n\n\t} while ((q_status & ASC_QS_READY) != 0);\n\n\treturn (1);\n}"
  },
  {
    "function_name": "AscCleanUpBusyQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2955-2974",
    "snippet": "static void\nAscCleanUpBusyQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tu_int8_t        stop_code;\n\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_BUSY_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_BUSY_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static void AscCleanUpBusyQueue",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "100"
          ],
          "line": 2971
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B"
          ],
          "line": 2967
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B",
            "ASC_STOP_CLEAN_UP_BUSY_Q"
          ],
          "line": 2965
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscCleanUpBusyQueue;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscCleanUpBusyQueue(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tu_int8_t        stop_code;\n\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_CLEAN_UP_BUSY_Q);\n\t\tdo {\n\t\t\tstop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\t\t\tif ((stop_code & ASC_STOP_CLEAN_UP_BUSY_Q) == 0)\n\t\t\t\tbreak;\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n}"
  },
  {
    "function_name": "AscStartQueueExe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2944-2952",
    "snippet": "static void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static void AscStartQueueExe"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B",
            "0"
          ],
          "line": 2951
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B"
          ],
          "line": 2950
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscStartQueueExe;\n\nstatic void\nAscStartQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) != 0)\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n}"
  },
  {
    "function_name": "AscStopQueueExe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2923-2941",
    "snippet": "static int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static int AscStopQueueExe",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "100"
          ],
          "line": 2937
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B"
          ],
          "line": 2933
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B",
            "ASC_STOP_REQ_RISC_STOP"
          ],
          "line": 2931
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscStopQueueExe;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "AscAllocMultipleFreeQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2904-2920",
    "snippet": "static u_int8_t\nAscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_free_q)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        n_free_q;\n{\n\tu_int8_t        i;\n\n\tfor (i = 0; i < n_free_q; i++) {\n\t\tfree_q_head = AscAllocFreeQueue(iot, ioh, free_q_head);\n\t\tif (free_q_head == ASC_QLINK_END)\n\t\t\tbreak;\n\t}\n\n\treturn (free_q_head);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscAllocFreeQueue",
      "static u_int8_t AscAllocMultipleFreeQueue"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscAllocFreeQueue",
          "args": [
            "iot",
            "ioh",
            "free_q_head"
          ],
          "line": 2914
        },
        "resolved": true,
        "details": {
          "function_name": "AscAllocFreeQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2883-2901",
          "snippet": "static u_int8_t\nAscAllocFreeQueue(iot, ioh, free_q_head)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\tu_int8_t        q_status;\n\n\n\tq_addr = ASC_QNO_TO_QADDR(free_q_head);\n\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\tif (((q_status & ASC_QS_READY) == 0) && (next_qp != ASC_QLINK_END))\n\t\treturn (next_qp);\n\n\treturn (ASC_QLINK_END);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static u_int8_t AscAllocFreeQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic u_int8_t AscAllocFreeQueue;\n\nstatic u_int8_t\nAscAllocFreeQueue(iot, ioh, free_q_head)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\tu_int8_t        q_status;\n\n\n\tq_addr = ASC_QNO_TO_QADDR(free_q_head);\n\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\tif (((q_status & ASC_QS_READY) == 0) && (next_qp != ASC_QLINK_END))\n\t\treturn (next_qp);\n\n\treturn (ASC_QLINK_END);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscAllocFreeQueue;\nstatic u_int8_t AscAllocMultipleFreeQueue;\n\nstatic u_int8_t\nAscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_free_q)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        n_free_q;\n{\n\tu_int8_t        i;\n\n\tfor (i = 0; i < n_free_q; i++) {\n\t\tfree_q_head = AscAllocFreeQueue(iot, ioh, free_q_head);\n\t\tif (free_q_head == ASC_QLINK_END)\n\t\t\tbreak;\n\t}\n\n\treturn (free_q_head);\n}"
  },
  {
    "function_name": "AscAllocFreeQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2883-2901",
    "snippet": "static u_int8_t\nAscAllocFreeQueue(iot, ioh, free_q_head)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\tu_int8_t        q_status;\n\n\n\tq_addr = ASC_QNO_TO_QADDR(free_q_head);\n\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\tif (((q_status & ASC_QS_READY) == 0) && (next_qp != ASC_QLINK_END))\n\t\treturn (next_qp);\n\n\treturn (ASC_QLINK_END);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static u_int8_t AscAllocFreeQueue"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_B_FWD"
          ],
          "line": 2896
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "free_q_head"
          ],
          "line": 2894
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic u_int8_t AscAllocFreeQueue;\n\nstatic u_int8_t\nAscAllocFreeQueue(iot, ioh, free_q_head)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n{\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\tu_int8_t        q_status;\n\n\n\tq_addr = ASC_QNO_TO_QADDR(free_q_head);\n\tq_status = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\tif (((q_status & ASC_QS_READY) == 0) && (next_qp != ASC_QLINK_END))\n\t\treturn (next_qp);\n\n\treturn (ASC_QLINK_END);\n}"
  },
  {
    "function_name": "AscGetNumOfFreeQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2852-2880",
    "snippet": "static u_int\nAscGetNumOfFreeQueue(sc, target_ix, n_qs)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n\tu_int8_t        n_qs;\n{\n\tu_int           cur_used_qs;\n\tu_int           cur_free_qs;\n\n\n\tif (n_qs == 1) {\n\t\tcur_used_qs = sc->cur_total_qng +\n\t\t\tsc->last_q_shortage +\n\t\t\tASC_MIN_FREE_Q;\n\t} else {\n\t\tcur_used_qs = sc->cur_total_qng + ASC_MIN_FREE_Q;\n\t}\n\n\tif ((cur_used_qs + n_qs) <= sc->max_total_qng) {\n\t\tcur_free_qs = sc->max_total_qng - cur_used_qs;\n\t\treturn (cur_free_qs);\n\t}\n\tif (n_qs > 1)\n\t\tif ((n_qs > sc->last_q_shortage) &&\n\t\t    (n_qs <= (sc->max_total_qng - ASC_MIN_FREE_Q))) {\n\t\t\tsc->last_q_shortage = n_qs;\n\t\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int AscGetNumOfFreeQueue"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int AscGetNumOfFreeQueue;\n\nstatic u_int\nAscGetNumOfFreeQueue(sc, target_ix, n_qs)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n\tu_int8_t        n_qs;\n{\n\tu_int           cur_used_qs;\n\tu_int           cur_free_qs;\n\n\n\tif (n_qs == 1) {\n\t\tcur_used_qs = sc->cur_total_qng +\n\t\t\tsc->last_q_shortage +\n\t\t\tASC_MIN_FREE_Q;\n\t} else {\n\t\tcur_used_qs = sc->cur_total_qng + ASC_MIN_FREE_Q;\n\t}\n\n\tif ((cur_used_qs + n_qs) <= sc->max_total_qng) {\n\t\tcur_free_qs = sc->max_total_qng - cur_used_qs;\n\t\treturn (cur_free_qs);\n\t}\n\tif (n_qs > 1)\n\t\tif ((n_qs > sc->last_q_shortage) &&\n\t\t    (n_qs <= (sc->max_total_qng - ASC_MIN_FREE_Q))) {\n\t\t\tsc->last_q_shortage = n_qs;\n\t\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "AscSgListToQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2838-2849",
    "snippet": "static int\nAscSgListToQueue(sg_list)\n\tint             sg_list;\n{\n\tint             n_sg_list_qs;\n\n\tn_sg_list_qs = ((sg_list - 1) / ASC_SG_LIST_PER_Q);\n\tif (((sg_list - 1) % ASC_SG_LIST_PER_Q) != 0)\n\t\tn_sg_list_qs++;\n\n\treturn (n_sg_list_qs + 1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscSgListToQueue"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSgListToQueue;\n\nstatic int\nAscSgListToQueue(sg_list)\n\tint             sg_list;\n{\n\tint             n_sg_list_qs;\n\n\tn_sg_list_qs = ((sg_list - 1) / ASC_SG_LIST_PER_Q);\n\tif (((sg_list - 1) % ASC_SG_LIST_PER_Q) != 0)\n\t\tn_sg_list_qs++;\n\n\treturn (n_sg_list_qs + 1);\n}"
  },
  {
    "function_name": "AscPutSCSIQ",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2793-2835",
    "snippet": "static void\nAscPutSCSIQ(iot, ioh, addr, scsiq)\n\tbus_space_tag_t\t\tiot;\n\tbus_space_handle_t\tioh;\n\tu_int16_t\t\taddr;\n\tASC_SCSI_Q \t\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\t/* ASC_SCSIQ_1 */\n\tval = MAKEWORD(scsiq->q1.cntl, scsiq->q1.sg_queue_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.target_id, scsiq->q1.target_lun);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.sense_len, scsiq->q1.extra_bytes);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\n\t/* ASC_SCSIQ_2 */\n\tval = LO_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.target_ix, scsiq->q2.flag);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.cdb_len, scsiq->q2.tag_code);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, scsiq->q2.vm_id);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscPutSCSIQ"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "scsiq->q2.vm_id"
          ],
          "line": 2834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2833
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKEWORD",
          "args": [
            "scsiq->q2.cdb_len",
            "scsiq->q2.tag_code"
          ],
          "line": 2832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKEWORD",
          "args": [
            "scsiq->q2.target_ix",
            "scsiq->q2.flag"
          ],
          "line": 2830
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_WORD",
          "args": [
            "scsiq->q2.ccb_ptr"
          ],
          "line": 2828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_WORD",
          "args": [
            "scsiq->q2.ccb_ptr"
          ],
          "line": 2826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2823
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKEWORD",
          "args": [
            "scsiq->q1.sense_len",
            "scsiq->q1.extra_bytes"
          ],
          "line": 2822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_WORD",
          "args": [
            "scsiq->q1.sense_addr"
          ],
          "line": 2820
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2819
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_WORD",
          "args": [
            "scsiq->q1.sense_addr"
          ],
          "line": 2818
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_WORD",
          "args": [
            "scsiq->q1.data_cnt"
          ],
          "line": 2816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_WORD",
          "args": [
            "scsiq->q1.data_cnt"
          ],
          "line": 2814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_WORD",
          "args": [
            "scsiq->q1.data_addr"
          ],
          "line": 2812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_WORD",
          "args": [
            "scsiq->q1.data_addr"
          ],
          "line": 2810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKEWORD",
          "args": [
            "scsiq->q1.target_id",
            "scsiq->q1.target_lun"
          ],
          "line": 2808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 2807
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKEWORD",
          "args": [
            "scsiq->q1.cntl",
            "scsiq->q1.sg_queue_cnt"
          ],
          "line": 2806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 2803
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscPutSCSIQ;\n\nstatic void\nAscPutSCSIQ(iot, ioh, addr, scsiq)\n\tbus_space_tag_t\t\tiot;\n\tbus_space_handle_t\tioh;\n\tu_int16_t\t\taddr;\n\tASC_SCSI_Q \t\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\t/* ASC_SCSIQ_1 */\n\tval = MAKEWORD(scsiq->q1.cntl, scsiq->q1.sg_queue_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.target_id, scsiq->q1.target_lun);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.sense_len, scsiq->q1.extra_bytes);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\n\t/* ASC_SCSIQ_2 */\n\tval = LO_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.target_ix, scsiq->q2.flag);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.cdb_len, scsiq->q2.tag_code);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, scsiq->q2.vm_id);\n}"
  },
  {
    "function_name": "AscPutReadyQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2748-2790",
    "snippet": "static int\nAscPutReadyQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        syn_period_ix;\n\tu_int8_t        syn_offset;\n\n\n\tif (((sc->init_sdtr & scsiq->q1.target_id) != 0) &&\n\t    ((sc->sdtr_done & scsiq->q1.target_id) == 0)) {\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->q2.target_ix);\n\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\tsyn_period_ix = (sdtr_data >> 4) & (sc->max_sdtr_index - 1);\n\t\tsyn_offset = sdtr_data & ASC_SYN_MAX_OFFSET;\n\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[syn_period_ix], syn_offset);\n\t\tscsiq->q1.cntl |= ASC_QC_MSG_OUT;\n\t}\n\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\n\tif ((scsiq->q1.target_id & sc->use_tagged_qng) == 0) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t}\n\tscsiq->q1.status = ASC_QS_FREE;\n\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_CDB_BEG,\n\t\t       (u_int16_t *) scsiq->cdbptr, scsiq->q2.cdb_len >> 1);\n\n\tAscPutSCSIQ(iot, ioh, q_addr + ASC_SCSIQ_CPY_BEG, scsiq);\n\n\t/*\n\t * Let's start the command\n\t */\n\tAscWriteLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t (scsiq->q1.q_no << 8) | ASC_QS_READY);\n\n\treturn (ASC_NOERROR);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramWord",
      "static void AscMemWordCopyToLram",
      "static u_int8_t AscMsgOutSDTR",
      "static int AscPutReadyQueue",
      "static void AscPutSCSIQ"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_B_STATUS",
            "(scsiq->q1.q_no << 8) | ASC_QS_READY"
          ],
          "line": 2786
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscPutSCSIQ",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_CPY_BEG",
            "scsiq"
          ],
          "line": 2781
        },
        "resolved": true,
        "details": {
          "function_name": "AscPutSCSIQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2793-2835",
          "snippet": "static void\nAscPutSCSIQ(iot, ioh, addr, scsiq)\n\tbus_space_tag_t\t\tiot;\n\tbus_space_handle_t\tioh;\n\tu_int16_t\t\taddr;\n\tASC_SCSI_Q \t\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\t/* ASC_SCSIQ_1 */\n\tval = MAKEWORD(scsiq->q1.cntl, scsiq->q1.sg_queue_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.target_id, scsiq->q1.target_lun);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.sense_len, scsiq->q1.extra_bytes);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\n\t/* ASC_SCSIQ_2 */\n\tval = LO_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.target_ix, scsiq->q2.flag);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.cdb_len, scsiq->q2.tag_code);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, scsiq->q2.vm_id);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscPutSCSIQ"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscPutSCSIQ;\n\nstatic void\nAscPutSCSIQ(iot, ioh, addr, scsiq)\n\tbus_space_tag_t\t\tiot;\n\tbus_space_handle_t\tioh;\n\tu_int16_t\t\taddr;\n\tASC_SCSI_Q \t\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\t/* ASC_SCSIQ_1 */\n\tval = MAKEWORD(scsiq->q1.cntl, scsiq->q1.sg_queue_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.target_id, scsiq->q1.target_lun);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.data_cnt);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = LO_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q1.sense_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q1.sense_len, scsiq->q1.extra_bytes);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\n\t/* ASC_SCSIQ_2 */\n\tval = LO_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = HI_WORD(scsiq->q2.ccb_ptr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.target_ix, scsiq->q2.flag);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tval = MAKEWORD(scsiq->q2.cdb_len, scsiq->q2.tag_code);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, val);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, scsiq->q2.vm_id);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordCopyToLram",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_CDB_BEG",
            "(u_int16_t *) scsiq->cdbptr",
            "scsiq->q2.cdb_len >> 1"
          ],
          "line": 2778
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyToLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1126-1139",
          "snippet": "static void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\n\nstatic void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "q_no"
          ],
          "line": 2772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscMsgOutSDTR",
          "args": [
            "sc",
            "sc->sdtr_period_tbl[syn_period_ix]",
            "syn_offset"
          ],
          "line": 2769
        },
        "resolved": true,
        "details": {
          "function_name": "AscMsgOutSDTR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2372-2401",
          "snippet": "static u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram",
            "static u_int8_t AscMsgOutSDTR",
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_MCODE_INIT_SDTR_AT_ID",
          "args": [
            "iot",
            "ioh",
            "tid_no"
          ],
          "line": 2766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "scsiq->q2.target_ix"
          ],
          "line": 2765
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic int AscPutReadyQueue;\nstatic void AscPutSCSIQ;\n\nstatic int\nAscPutReadyQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        syn_period_ix;\n\tu_int8_t        syn_offset;\n\n\n\tif (((sc->init_sdtr & scsiq->q1.target_id) != 0) &&\n\t    ((sc->sdtr_done & scsiq->q1.target_id) == 0)) {\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->q2.target_ix);\n\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\tsyn_period_ix = (sdtr_data >> 4) & (sc->max_sdtr_index - 1);\n\t\tsyn_offset = sdtr_data & ASC_SYN_MAX_OFFSET;\n\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[syn_period_ix], syn_offset);\n\t\tscsiq->q1.cntl |= ASC_QC_MSG_OUT;\n\t}\n\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\n\tif ((scsiq->q1.target_id & sc->use_tagged_qng) == 0) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t}\n\tscsiq->q1.status = ASC_QS_FREE;\n\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_CDB_BEG,\n\t\t       (u_int16_t *) scsiq->cdbptr, scsiq->q2.cdb_len >> 1);\n\n\tAscPutSCSIQ(iot, ioh, q_addr + ASC_SCSIQ_CPY_BEG, scsiq);\n\n\t/*\n\t * Let's start the command\n\t */\n\tAscWriteLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t (scsiq->q1.q_no << 8) | ASC_QS_READY);\n\n\treturn (ASC_NOERROR);\n}"
  },
  {
    "function_name": "AscPutReadySgListQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2660-2745",
    "snippet": "static int\nAscPutReadySgListQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tint             i;\n\tASC_SG_HEAD    *sg_head;\n\tASC_SG_LIST_Q   scsi_sg_q;\n\tu_int32_t       saved_data_addr;\n\tu_int32_t       saved_data_cnt;\n\tu_int16_t       sg_list_dwords;\n\tu_int16_t       sg_index;\n\tu_int16_t       sg_entry_cnt;\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\n\n\tsaved_data_addr = scsiq->q1.data_addr;\n\tsaved_data_cnt = scsiq->q1.data_cnt;\n\n\tif ((sg_head = scsiq->sg_head) != 0) {\n\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\tsg_entry_cnt = sg_head->entry_cnt - 1;\n\t\tif (sg_entry_cnt != 0) {\n\t\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t\tsg_index = 1;\n\t\t\tscsiq->q1.sg_queue_cnt = sg_head->queue_cnt;\n\t\t\tscsi_sg_q.sg_head_qp = q_no;\n\t\t\tscsi_sg_q.cntl = ASC_QCSG_SG_XFER_LIST;\n\n\t\t\tfor (i = 0; i < sg_head->queue_cnt; i++) {\n\t\t\t\tscsi_sg_q.seq_no = i + 1;\n\t\t\t\tif (sg_entry_cnt > ASC_SG_LIST_PER_Q) {\n\t\t\t\t\tsg_list_dwords = ASC_SG_LIST_PER_Q * 2;\n\t\t\t\t\tsg_entry_cnt -= ASC_SG_LIST_PER_Q;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tscsi_sg_q.cntl |= ASC_QCSG_SG_XFER_END;\n\t\t\t\t\tsg_list_dwords = sg_entry_cnt << 1;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsg_entry_cnt = 0;\n\t\t\t\t}\n\n\t\t\t\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tscsi_sg_q.q_no = next_qp;\n\t\t\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\n\t\t\t\t/*\n\t\t\t\t * Tell the board how many entries are in the S/G list\n\t\t\t\t */\n\t\t\t\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_SGHD_CPY_BEG,\n\t\t\t\t\t\t\t(u_int16_t *) & scsi_sg_q,\n\t\t\t\t\t\t\tsizeof(ASC_SG_LIST_Q) >> 1);\n\t\t\t\t/*\n\t\t\t\t * Tell the board the addresses of the S/G list segments\n\t\t\t\t */\n\t\t\t\tAscMemDWordCopyToLram(iot, ioh, q_addr + ASC_SGQ_LIST_BEG,\n\t\t\t\t\t\t\t(u_int32_t *) & sg_head->sg_list[sg_index],\n\t\t\t\t\t\t\tsg_list_dwords);\n\t\t\t\tsg_index += ASC_SG_LIST_PER_Q;\n\t\t\t}\n\t\t}\n\t}\n\tretval = AscPutReadyQueue(sc, scsiq, q_no);\n\tscsiq->q1.data_addr = saved_data_addr;\n\tscsiq->q1.data_cnt = saved_data_cnt;\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscMemWordCopyToLram",
      "static void AscMemDWordCopyToLram",
      "static int AscPutReadyQueue",
      "static int AscPutReadySgListQueue"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscPutReadyQueue",
          "args": [
            "sc",
            "scsiq",
            "q_no"
          ],
          "line": 2741
        },
        "resolved": true,
        "details": {
          "function_name": "AscPutReadyQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2748-2790",
          "snippet": "static int\nAscPutReadyQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        syn_period_ix;\n\tu_int8_t        syn_offset;\n\n\n\tif (((sc->init_sdtr & scsiq->q1.target_id) != 0) &&\n\t    ((sc->sdtr_done & scsiq->q1.target_id) == 0)) {\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->q2.target_ix);\n\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\tsyn_period_ix = (sdtr_data >> 4) & (sc->max_sdtr_index - 1);\n\t\tsyn_offset = sdtr_data & ASC_SYN_MAX_OFFSET;\n\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[syn_period_ix], syn_offset);\n\t\tscsiq->q1.cntl |= ASC_QC_MSG_OUT;\n\t}\n\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\n\tif ((scsiq->q1.target_id & sc->use_tagged_qng) == 0) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t}\n\tscsiq->q1.status = ASC_QS_FREE;\n\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_CDB_BEG,\n\t\t       (u_int16_t *) scsiq->cdbptr, scsiq->q2.cdb_len >> 1);\n\n\tAscPutSCSIQ(iot, ioh, q_addr + ASC_SCSIQ_CPY_BEG, scsiq);\n\n\t/*\n\t * Let's start the command\n\t */\n\tAscWriteLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t (scsiq->q1.q_no << 8) | ASC_QS_READY);\n\n\treturn (ASC_NOERROR);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord",
            "static void AscMemWordCopyToLram",
            "static u_int8_t AscMsgOutSDTR",
            "static int AscPutReadyQueue",
            "static void AscPutSCSIQ"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic int AscPutReadyQueue;\nstatic void AscPutSCSIQ;\n\nstatic int\nAscPutReadyQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        syn_period_ix;\n\tu_int8_t        syn_offset;\n\n\n\tif (((sc->init_sdtr & scsiq->q1.target_id) != 0) &&\n\t    ((sc->sdtr_done & scsiq->q1.target_id) == 0)) {\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->q2.target_ix);\n\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\tsyn_period_ix = (sdtr_data >> 4) & (sc->max_sdtr_index - 1);\n\t\tsyn_offset = sdtr_data & ASC_SYN_MAX_OFFSET;\n\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[syn_period_ix], syn_offset);\n\t\tscsiq->q1.cntl |= ASC_QC_MSG_OUT;\n\t}\n\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\n\tif ((scsiq->q1.target_id & sc->use_tagged_qng) == 0) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t}\n\tscsiq->q1.status = ASC_QS_FREE;\n\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_CDB_BEG,\n\t\t       (u_int16_t *) scsiq->cdbptr, scsiq->q2.cdb_len >> 1);\n\n\tAscPutSCSIQ(iot, ioh, q_addr + ASC_SCSIQ_CPY_BEG, scsiq);\n\n\t/*\n\t * Let's start the command\n\t */\n\tAscWriteLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS,\n\t\t\t (scsiq->q1.q_no << 8) | ASC_QS_READY);\n\n\treturn (ASC_NOERROR);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemDWordCopyToLram",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SGQ_LIST_BEG",
            "(u_int32_t *) & sg_head->sg_list[sg_index]",
            "sg_list_dwords"
          ],
          "line": 2734
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemDWordCopyToLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1158-1177",
          "snippet": "static void\nAscMemDWordCopyToLram(iot, ioh, s_addr, s_buffer, dwords)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int32_t      *s_buffer;\n\tint             dwords;\n{\n\tint             i;\n\tu_int32_t      *pw;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\n\tpw = s_buffer;\n\tfor (i = 0; i < dwords; i++, pw++) {\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, LO_WORD(*pw));\n\t\tDELAY(1);\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, HI_WORD(*pw));\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemDWordCopyToLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemDWordCopyToLram;\n\nstatic void\nAscMemDWordCopyToLram(iot, ioh, s_addr, s_buffer, dwords)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int32_t      *s_buffer;\n\tint             dwords;\n{\n\tint             i;\n\tu_int32_t      *pw;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\n\tpw = s_buffer;\n\tfor (i = 0; i < dwords; i++, pw++) {\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, LO_WORD(*pw));\n\t\tDELAY(1);\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, HI_WORD(*pw));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordCopyToLram",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_SGHD_CPY_BEG",
            "(u_int16_t *) & scsi_sg_q",
            "sizeof(ASC_SG_LIST_Q) >> 1"
          ],
          "line": 2728
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyToLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1126-1139",
          "snippet": "static void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\n\nstatic void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "next_qp"
          ],
          "line": 2723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_B_FWD"
          ],
          "line": 2721
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "q_no"
          ],
          "line": 2689
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscMemWordCopyToLram;\nstatic void AscMemDWordCopyToLram;\nstatic int AscPutReadyQueue;\nstatic int AscPutReadySgListQueue;\n\nstatic int\nAscPutReadySgListQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tint             i;\n\tASC_SG_HEAD    *sg_head;\n\tASC_SG_LIST_Q   scsi_sg_q;\n\tu_int32_t       saved_data_addr;\n\tu_int32_t       saved_data_cnt;\n\tu_int16_t       sg_list_dwords;\n\tu_int16_t       sg_index;\n\tu_int16_t       sg_entry_cnt;\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\n\n\tsaved_data_addr = scsiq->q1.data_addr;\n\tsaved_data_cnt = scsiq->q1.data_cnt;\n\n\tif ((sg_head = scsiq->sg_head) != 0) {\n\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\tsg_entry_cnt = sg_head->entry_cnt - 1;\n\t\tif (sg_entry_cnt != 0) {\n\t\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t\tsg_index = 1;\n\t\t\tscsiq->q1.sg_queue_cnt = sg_head->queue_cnt;\n\t\t\tscsi_sg_q.sg_head_qp = q_no;\n\t\t\tscsi_sg_q.cntl = ASC_QCSG_SG_XFER_LIST;\n\n\t\t\tfor (i = 0; i < sg_head->queue_cnt; i++) {\n\t\t\t\tscsi_sg_q.seq_no = i + 1;\n\t\t\t\tif (sg_entry_cnt > ASC_SG_LIST_PER_Q) {\n\t\t\t\t\tsg_list_dwords = ASC_SG_LIST_PER_Q * 2;\n\t\t\t\t\tsg_entry_cnt -= ASC_SG_LIST_PER_Q;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tscsi_sg_q.cntl |= ASC_QCSG_SG_XFER_END;\n\t\t\t\t\tsg_list_dwords = sg_entry_cnt << 1;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsg_entry_cnt = 0;\n\t\t\t\t}\n\n\t\t\t\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tscsi_sg_q.q_no = next_qp;\n\t\t\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\n\t\t\t\t/*\n\t\t\t\t * Tell the board how many entries are in the S/G list\n\t\t\t\t */\n\t\t\t\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_SGHD_CPY_BEG,\n\t\t\t\t\t\t\t(u_int16_t *) & scsi_sg_q,\n\t\t\t\t\t\t\tsizeof(ASC_SG_LIST_Q) >> 1);\n\t\t\t\t/*\n\t\t\t\t * Tell the board the addresses of the S/G list segments\n\t\t\t\t */\n\t\t\t\tAscMemDWordCopyToLram(iot, ioh, q_addr + ASC_SGQ_LIST_BEG,\n\t\t\t\t\t\t\t(u_int32_t *) & sg_head->sg_list[sg_index],\n\t\t\t\t\t\t\tsg_list_dwords);\n\t\t\t\tsg_index += ASC_SG_LIST_PER_Q;\n\t\t\t}\n\t\t}\n\t}\n\tretval = AscPutReadyQueue(sc, scsiq, q_no);\n\tscsiq->q1.data_addr = saved_data_addr;\n\tscsiq->q1.data_cnt = saved_data_cnt;\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscSendScsiQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2622-2657",
    "snippet": "static int\nAscSendScsiQueue(sc, scsiq, n_q_required)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        n_q_required;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        next_qp;\n\tu_int8_t        tid_no;\n\tu_int8_t        target_ix;\n\tint             retval;\n\n\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tretval = ASC_BUSY;\n\tfree_q_head = ASC_GET_VAR_FREE_QHEAD(iot, ioh);\n\n\tif ((next_qp = AscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_q_required))\n\t    != ASC_QLINK_END) {\n\t\tif (n_q_required > 1) {\n\t\t\tsc->last_q_shortage = 0;\n\t\t\tscsiq->sg_head->queue_cnt = n_q_required - 1;\n\t\t}\n\t\tscsiq->q1.q_no = free_q_head;\n\n\t\tif ((retval = AscPutReadySgListQueue(sc, scsiq, free_q_head)) == ASC_NOERROR) {\n\t\t\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, next_qp);\n\t\t\tsc->cur_total_qng += n_q_required;\n\t\t\tsc->cur_dvc_qng[tid_no]++;\n\t\t}\n\t}\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscSendScsiQueue",
      "static int AscPutReadySgListQueue",
      "static u_int8_t AscAllocMultipleFreeQueue"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_PUT_VAR_FREE_QHEAD",
          "args": [
            "iot",
            "ioh",
            "next_qp"
          ],
          "line": 2651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscPutReadySgListQueue",
          "args": [
            "sc",
            "scsiq",
            "free_q_head"
          ],
          "line": 2650
        },
        "resolved": true,
        "details": {
          "function_name": "AscPutReadySgListQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2660-2745",
          "snippet": "static int\nAscPutReadySgListQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tint             i;\n\tASC_SG_HEAD    *sg_head;\n\tASC_SG_LIST_Q   scsi_sg_q;\n\tu_int32_t       saved_data_addr;\n\tu_int32_t       saved_data_cnt;\n\tu_int16_t       sg_list_dwords;\n\tu_int16_t       sg_index;\n\tu_int16_t       sg_entry_cnt;\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\n\n\tsaved_data_addr = scsiq->q1.data_addr;\n\tsaved_data_cnt = scsiq->q1.data_cnt;\n\n\tif ((sg_head = scsiq->sg_head) != 0) {\n\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\tsg_entry_cnt = sg_head->entry_cnt - 1;\n\t\tif (sg_entry_cnt != 0) {\n\t\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t\tsg_index = 1;\n\t\t\tscsiq->q1.sg_queue_cnt = sg_head->queue_cnt;\n\t\t\tscsi_sg_q.sg_head_qp = q_no;\n\t\t\tscsi_sg_q.cntl = ASC_QCSG_SG_XFER_LIST;\n\n\t\t\tfor (i = 0; i < sg_head->queue_cnt; i++) {\n\t\t\t\tscsi_sg_q.seq_no = i + 1;\n\t\t\t\tif (sg_entry_cnt > ASC_SG_LIST_PER_Q) {\n\t\t\t\t\tsg_list_dwords = ASC_SG_LIST_PER_Q * 2;\n\t\t\t\t\tsg_entry_cnt -= ASC_SG_LIST_PER_Q;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tscsi_sg_q.cntl |= ASC_QCSG_SG_XFER_END;\n\t\t\t\t\tsg_list_dwords = sg_entry_cnt << 1;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsg_entry_cnt = 0;\n\t\t\t\t}\n\n\t\t\t\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tscsi_sg_q.q_no = next_qp;\n\t\t\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\n\t\t\t\t/*\n\t\t\t\t * Tell the board how many entries are in the S/G list\n\t\t\t\t */\n\t\t\t\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_SGHD_CPY_BEG,\n\t\t\t\t\t\t\t(u_int16_t *) & scsi_sg_q,\n\t\t\t\t\t\t\tsizeof(ASC_SG_LIST_Q) >> 1);\n\t\t\t\t/*\n\t\t\t\t * Tell the board the addresses of the S/G list segments\n\t\t\t\t */\n\t\t\t\tAscMemDWordCopyToLram(iot, ioh, q_addr + ASC_SGQ_LIST_BEG,\n\t\t\t\t\t\t\t(u_int32_t *) & sg_head->sg_list[sg_index],\n\t\t\t\t\t\t\tsg_list_dwords);\n\t\t\t\tsg_index += ASC_SG_LIST_PER_Q;\n\t\t\t}\n\t\t}\n\t}\n\tretval = AscPutReadyQueue(sc, scsiq, q_no);\n\tscsiq->q1.data_addr = saved_data_addr;\n\tscsiq->q1.data_cnt = saved_data_cnt;\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscMemWordCopyToLram",
            "static void AscMemDWordCopyToLram",
            "static int AscPutReadyQueue",
            "static int AscPutReadySgListQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscMemWordCopyToLram;\nstatic void AscMemDWordCopyToLram;\nstatic int AscPutReadyQueue;\nstatic int AscPutReadySgListQueue;\n\nstatic int\nAscPutReadySgListQueue(sc, scsiq, q_no)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        q_no;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             retval;\n\tint             i;\n\tASC_SG_HEAD    *sg_head;\n\tASC_SG_LIST_Q   scsi_sg_q;\n\tu_int32_t       saved_data_addr;\n\tu_int32_t       saved_data_cnt;\n\tu_int16_t       sg_list_dwords;\n\tu_int16_t       sg_index;\n\tu_int16_t       sg_entry_cnt;\n\tu_int16_t       q_addr;\n\tu_int8_t        next_qp;\n\n\n\tsaved_data_addr = scsiq->q1.data_addr;\n\tsaved_data_cnt = scsiq->q1.data_cnt;\n\n\tif ((sg_head = scsiq->sg_head) != 0) {\n\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\tsg_entry_cnt = sg_head->entry_cnt - 1;\n\t\tif (sg_entry_cnt != 0) {\n\t\t\tq_addr = ASC_QNO_TO_QADDR(q_no);\n\t\t\tsg_index = 1;\n\t\t\tscsiq->q1.sg_queue_cnt = sg_head->queue_cnt;\n\t\t\tscsi_sg_q.sg_head_qp = q_no;\n\t\t\tscsi_sg_q.cntl = ASC_QCSG_SG_XFER_LIST;\n\n\t\t\tfor (i = 0; i < sg_head->queue_cnt; i++) {\n\t\t\t\tscsi_sg_q.seq_no = i + 1;\n\t\t\t\tif (sg_entry_cnt > ASC_SG_LIST_PER_Q) {\n\t\t\t\t\tsg_list_dwords = ASC_SG_LIST_PER_Q * 2;\n\t\t\t\t\tsg_entry_cnt -= ASC_SG_LIST_PER_Q;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = ASC_SG_LIST_PER_Q - 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tscsi_sg_q.cntl |= ASC_QCSG_SG_XFER_END;\n\t\t\t\t\tsg_list_dwords = sg_entry_cnt << 1;\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscsi_sg_q.sg_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t\tscsi_sg_q.sg_cur_list_cnt = sg_entry_cnt - 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsg_entry_cnt = 0;\n\t\t\t\t}\n\n\t\t\t\tnext_qp = AscReadLramByte(iot, ioh, q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tscsi_sg_q.q_no = next_qp;\n\t\t\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\n\t\t\t\t/*\n\t\t\t\t * Tell the board how many entries are in the S/G list\n\t\t\t\t */\n\t\t\t\tAscMemWordCopyToLram(iot, ioh, q_addr + ASC_SCSIQ_SGHD_CPY_BEG,\n\t\t\t\t\t\t\t(u_int16_t *) & scsi_sg_q,\n\t\t\t\t\t\t\tsizeof(ASC_SG_LIST_Q) >> 1);\n\t\t\t\t/*\n\t\t\t\t * Tell the board the addresses of the S/G list segments\n\t\t\t\t */\n\t\t\t\tAscMemDWordCopyToLram(iot, ioh, q_addr + ASC_SGQ_LIST_BEG,\n\t\t\t\t\t\t\t(u_int32_t *) & sg_head->sg_list[sg_index],\n\t\t\t\t\t\t\tsg_list_dwords);\n\t\t\t\tsg_index += ASC_SG_LIST_PER_Q;\n\t\t\t}\n\t\t}\n\t}\n\tretval = AscPutReadyQueue(sc, scsiq, q_no);\n\tscsiq->q1.data_addr = saved_data_addr;\n\tscsiq->q1.data_cnt = saved_data_cnt;\n\treturn (retval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscAllocMultipleFreeQueue",
          "args": [
            "iot",
            "ioh",
            "free_q_head",
            "n_q_required"
          ],
          "line": 2642
        },
        "resolved": true,
        "details": {
          "function_name": "AscAllocMultipleFreeQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2904-2920",
          "snippet": "static u_int8_t\nAscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_free_q)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        n_free_q;\n{\n\tu_int8_t        i;\n\n\tfor (i = 0; i < n_free_q; i++) {\n\t\tfree_q_head = AscAllocFreeQueue(iot, ioh, free_q_head);\n\t\tif (free_q_head == ASC_QLINK_END)\n\t\t\tbreak;\n\t}\n\n\treturn (free_q_head);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscAllocFreeQueue",
            "static u_int8_t AscAllocMultipleFreeQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscAllocFreeQueue;\nstatic u_int8_t AscAllocMultipleFreeQueue;\n\nstatic u_int8_t\nAscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_free_q)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        n_free_q;\n{\n\tu_int8_t        i;\n\n\tfor (i = 0; i < n_free_q; i++) {\n\t\tfree_q_head = AscAllocFreeQueue(iot, ioh, free_q_head);\n\t\tif (free_q_head == ASC_QLINK_END)\n\t\t\tbreak;\n\t}\n\n\treturn (free_q_head);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_VAR_FREE_QHEAD",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2640
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "target_ix"
          ],
          "line": 2638
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSendScsiQueue;\nstatic int AscPutReadySgListQueue;\nstatic u_int8_t AscAllocMultipleFreeQueue;\n\nstatic int\nAscSendScsiQueue(sc, scsiq, n_q_required)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        n_q_required;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        next_qp;\n\tu_int8_t        tid_no;\n\tu_int8_t        target_ix;\n\tint             retval;\n\n\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tretval = ASC_BUSY;\n\tfree_q_head = ASC_GET_VAR_FREE_QHEAD(iot, ioh);\n\n\tif ((next_qp = AscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_q_required))\n\t    != ASC_QLINK_END) {\n\t\tif (n_q_required > 1) {\n\t\t\tsc->last_q_shortage = 0;\n\t\t\tscsiq->sg_head->queue_cnt = n_q_required - 1;\n\t\t}\n\t\tscsiq->q1.q_no = free_q_head;\n\n\t\tif ((retval = AscPutReadySgListQueue(sc, scsiq, free_q_head)) == ASC_NOERROR) {\n\t\t\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, next_qp);\n\t\t\tsc->cur_total_qng += n_q_required;\n\t\t\tsc->cur_dvc_qng[tid_no]++;\n\t\t}\n\t}\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscExeScsiQueue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2471-2619",
    "snippet": "int\nAscExeScsiQueue(sc, scsiq)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASC_SG_HEAD    *sg_head = scsiq->sg_head;\n\tint             retval;\n\tint             n_q_required;\n\tint             disable_syn_offset_one_fix;\n\tint             i;\n\tu_int32_t       addr;\n\tu_int16_t       sg_entry_cnt = 0;\n\tu_int16_t       sg_entry_cnt_minus_one = 0;\n\tu_int8_t        target_ix;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        extra_bytes;\n\tu_int8_t        scsi_cmd;\n\tu_int32_t       data_cnt;\n\n\n\tscsiq->q1.q_no = 0;\n\tif ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)\n\t\tscsiq->q1.extra_bytes = 0;\n\n\tretval = ASC_BUSY;\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tn_q_required = 1;\n\n\tif (scsiq->cdbptr[0] == SCSICMD_RequestSense)\n\t\tif ((sc->init_sdtr & scsiq->q1.target_id) != 0) {\n\t\t\tsc->sdtr_done &= ~scsiq->q1.target_id;\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      sdtr_data & ASC_SYN_MAX_OFFSET);\n\t\t\tscsiq->q1.cntl |= (ASC_QC_MSG_OUT | ASC_QC_URGENT);\n\t\t}\n\t/*\n\t * if there is just one segment into S/G list then\n\t * map it as it was a single request, filling\n\t * data_addr and data_cnt of ASC_SCSIQ structure.\n\t */\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tsg_entry_cnt = sg_head->entry_cnt;\n\n\t\tif (sg_entry_cnt < 1)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with QC_SG_HEAD set but %d segs.\",\n\t\t\t      sg_entry_cnt);\n\n\t\tif (sg_entry_cnt > ASC_MAX_SG_LIST)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with too many segs.\");\n\n\t\tif (sg_entry_cnt == 1) {\n\t\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\t\tscsiq->q1.cntl &= ~(ASC_QC_SG_HEAD | ASC_QC_SG_SWAP_QUEUE);\n\t\t}\n\t\tsg_entry_cnt_minus_one = sg_entry_cnt - 1;\n\t}\n\tscsi_cmd = scsiq->cdbptr[0];\n\tdisable_syn_offset_one_fix = FALSE;\n\tif ((sc->pci_fix_asyn_xfer & scsiq->q1.target_id) &&\n\t    !(sc->pci_fix_asyn_xfer_always & scsiq->q1.target_id)) {\n\t\tif (scsiq->q1.cntl & ASC_QC_SG_HEAD) {\n\t\t\tdata_cnt = 0;\n\t\t\tfor (i = 0; i < sg_entry_cnt; i++)\n\t\t\t\tdata_cnt += sg_head->sg_list[i].bytes;\n\t\t} else {\n\t\t\tdata_cnt = scsiq->q1.data_cnt;\n\t\t}\n\n\t\tif (data_cnt != 0ul) {\n\t\t\tif (data_cnt < 512ul) {\n\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t} else {\n\t\t\t\tif (scsi_cmd == SCSICMD_Inquiry ||\n\t\t\t\t    scsi_cmd == SCSICMD_RequestSense ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadCapacity ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadTOC ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect10 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense10) {\n\t\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (disable_syn_offset_one_fix) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t\tscsiq->q2.tag_code |= (ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX |\n\t\t\t\t       ASC_TAG_FLAG_DISABLE_DISCONNECT);\n\t} else {\n\t\tscsiq->q2.tag_code &= 0x23;\n\t}\n\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = sg_head->sg_list[sg_entry_cnt_minus_one].addr +\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes -=\n\t\t\t\t\t\t\textra_bytes;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsg_head->entry_to_copy = sg_head->entry_cnt;\n\t\tn_q_required = AscSgListToQueue(sg_entry_cnt);\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, n_q_required) >= n_q_required)\n\t\t    || ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t} else {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = scsiq->q1.data_addr + scsiq->q1.data_cnt;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tif ((scsiq->q1.data_cnt & 0x01FF) == 0) {\n\t\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\t\tscsiq->q1.data_cnt -= extra_bytes;\n\t\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tn_q_required = 1;\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, 1) >= 1) ||\n\t\t    ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t}\n\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscMsgOutSDTR",
      "static int AscSendScsiQueue",
      "static int AscSgListToQueue",
      "static u_int AscGetNumOfFreeQueue"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSendScsiQueue",
          "args": [
            "sc",
            "scsiq",
            "n_q_required"
          ],
          "line": 2614
        },
        "resolved": true,
        "details": {
          "function_name": "AscSendScsiQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2622-2657",
          "snippet": "static int\nAscSendScsiQueue(sc, scsiq, n_q_required)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        n_q_required;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        next_qp;\n\tu_int8_t        tid_no;\n\tu_int8_t        target_ix;\n\tint             retval;\n\n\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tretval = ASC_BUSY;\n\tfree_q_head = ASC_GET_VAR_FREE_QHEAD(iot, ioh);\n\n\tif ((next_qp = AscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_q_required))\n\t    != ASC_QLINK_END) {\n\t\tif (n_q_required > 1) {\n\t\t\tsc->last_q_shortage = 0;\n\t\t\tscsiq->sg_head->queue_cnt = n_q_required - 1;\n\t\t}\n\t\tscsiq->q1.q_no = free_q_head;\n\n\t\tif ((retval = AscPutReadySgListQueue(sc, scsiq, free_q_head)) == ASC_NOERROR) {\n\t\t\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, next_qp);\n\t\t\tsc->cur_total_qng += n_q_required;\n\t\t\tsc->cur_dvc_qng[tid_no]++;\n\t\t}\n\t}\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscSendScsiQueue",
            "static int AscPutReadySgListQueue",
            "static u_int8_t AscAllocMultipleFreeQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSendScsiQueue;\nstatic int AscPutReadySgListQueue;\nstatic u_int8_t AscAllocMultipleFreeQueue;\n\nstatic int\nAscSendScsiQueue(sc, scsiq, n_q_required)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n\tu_int8_t        n_q_required;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        free_q_head;\n\tu_int8_t        next_qp;\n\tu_int8_t        tid_no;\n\tu_int8_t        target_ix;\n\tint             retval;\n\n\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tretval = ASC_BUSY;\n\tfree_q_head = ASC_GET_VAR_FREE_QHEAD(iot, ioh);\n\n\tif ((next_qp = AscAllocMultipleFreeQueue(iot, ioh, free_q_head, n_q_required))\n\t    != ASC_QLINK_END) {\n\t\tif (n_q_required > 1) {\n\t\t\tsc->last_q_shortage = 0;\n\t\t\tscsiq->sg_head->queue_cnt = n_q_required - 1;\n\t\t}\n\t\tscsiq->q1.q_no = free_q_head;\n\n\t\tif ((retval = AscPutReadySgListQueue(sc, scsiq, free_q_head)) == ASC_NOERROR) {\n\t\t\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, next_qp);\n\t\t\tsc->cur_total_qng += n_q_required;\n\t\t\tsc->cur_dvc_qng[tid_no]++;\n\t\t}\n\t}\n\treturn (retval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetNumOfFreeQueue",
          "args": [
            "sc",
            "target_ix",
            "1"
          ],
          "line": 2612
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetNumOfFreeQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2852-2880",
          "snippet": "static u_int\nAscGetNumOfFreeQueue(sc, target_ix, n_qs)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n\tu_int8_t        n_qs;\n{\n\tu_int           cur_used_qs;\n\tu_int           cur_free_qs;\n\n\n\tif (n_qs == 1) {\n\t\tcur_used_qs = sc->cur_total_qng +\n\t\t\tsc->last_q_shortage +\n\t\t\tASC_MIN_FREE_Q;\n\t} else {\n\t\tcur_used_qs = sc->cur_total_qng + ASC_MIN_FREE_Q;\n\t}\n\n\tif ((cur_used_qs + n_qs) <= sc->max_total_qng) {\n\t\tcur_free_qs = sc->max_total_qng - cur_used_qs;\n\t\treturn (cur_free_qs);\n\t}\n\tif (n_qs > 1)\n\t\tif ((n_qs > sc->last_q_shortage) &&\n\t\t    (n_qs <= (sc->max_total_qng - ASC_MIN_FREE_Q))) {\n\t\t\tsc->last_q_shortage = n_qs;\n\t\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int AscGetNumOfFreeQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int AscGetNumOfFreeQueue;\n\nstatic u_int\nAscGetNumOfFreeQueue(sc, target_ix, n_qs)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n\tu_int8_t        n_qs;\n{\n\tu_int           cur_used_qs;\n\tu_int           cur_free_qs;\n\n\n\tif (n_qs == 1) {\n\t\tcur_used_qs = sc->cur_total_qng +\n\t\t\tsc->last_q_shortage +\n\t\t\tASC_MIN_FREE_Q;\n\t} else {\n\t\tcur_used_qs = sc->cur_total_qng + ASC_MIN_FREE_Q;\n\t}\n\n\tif ((cur_used_qs + n_qs) <= sc->max_total_qng) {\n\t\tcur_free_qs = sc->max_total_qng - cur_used_qs;\n\t\treturn (cur_free_qs);\n\t}\n\tif (n_qs > 1)\n\t\tif ((n_qs > sc->last_q_shortage) &&\n\t\t    (n_qs <= (sc->max_total_qng - ASC_MIN_FREE_Q))) {\n\t\t\tsc->last_q_shortage = n_qs;\n\t\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSgListToQueue",
          "args": [
            "sg_entry_cnt"
          ],
          "line": 2589
        },
        "resolved": true,
        "details": {
          "function_name": "AscSgListToQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2838-2849",
          "snippet": "static int\nAscSgListToQueue(sg_list)\n\tint             sg_list;\n{\n\tint             n_sg_list_qs;\n\n\tn_sg_list_qs = ((sg_list - 1) / ASC_SG_LIST_PER_Q);\n\tif (((sg_list - 1) % ASC_SG_LIST_PER_Q) != 0)\n\t\tn_sg_list_qs++;\n\n\treturn (n_sg_list_qs + 1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscSgListToQueue"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSgListToQueue;\n\nstatic int\nAscSgListToQueue(sg_list)\n\tint             sg_list;\n{\n\tint             n_sg_list_qs;\n\n\tn_sg_list_qs = ((sg_list - 1) / ASC_SG_LIST_PER_Q);\n\tif (((sg_list - 1) % ASC_SG_LIST_PER_Q) != 0)\n\t\tn_sg_list_qs++;\n\n\treturn (n_sg_list_qs + 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"AscExeScsiQueue: Queue with too many segs.\""
          ],
          "line": 2525
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"AscExeScsiQueue: Queue with QC_SG_HEAD set but %d segs.\"",
            "sg_entry_cnt"
          ],
          "line": 2521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscMsgOutSDTR",
          "args": [
            "sc",
            "sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)]",
            "sdtr_data & ASC_SYN_MAX_OFFSET"
          ],
          "line": 2507
        },
        "resolved": true,
        "details": {
          "function_name": "AscMsgOutSDTR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2372-2401",
          "snippet": "static u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram",
            "static u_int8_t AscMsgOutSDTR",
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_MCODE_INIT_SDTR_AT_ID",
          "args": [
            "iot",
            "ioh",
            "tid_no"
          ],
          "line": 2506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "target_ix"
          ],
          "line": 2500
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscMsgOutSDTR;\nstatic int AscSendScsiQueue;\nstatic int AscSgListToQueue;\nstatic u_int AscGetNumOfFreeQueue;\n\nint\nAscExeScsiQueue(sc, scsiq)\n\tASC_SOFTC      *sc;\n\tASC_SCSI_Q     *scsiq;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASC_SG_HEAD    *sg_head = scsiq->sg_head;\n\tint             retval;\n\tint             n_q_required;\n\tint             disable_syn_offset_one_fix;\n\tint             i;\n\tu_int32_t       addr;\n\tu_int16_t       sg_entry_cnt = 0;\n\tu_int16_t       sg_entry_cnt_minus_one = 0;\n\tu_int8_t        target_ix;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        extra_bytes;\n\tu_int8_t        scsi_cmd;\n\tu_int32_t       data_cnt;\n\n\n\tscsiq->q1.q_no = 0;\n\tif ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)\n\t\tscsiq->q1.extra_bytes = 0;\n\n\tretval = ASC_BUSY;\n\ttarget_ix = scsiq->q2.target_ix;\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\tn_q_required = 1;\n\n\tif (scsiq->cdbptr[0] == SCSICMD_RequestSense)\n\t\tif ((sc->init_sdtr & scsiq->q1.target_id) != 0) {\n\t\t\tsc->sdtr_done &= ~scsiq->q1.target_id;\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      sdtr_data & ASC_SYN_MAX_OFFSET);\n\t\t\tscsiq->q1.cntl |= (ASC_QC_MSG_OUT | ASC_QC_URGENT);\n\t\t}\n\t/*\n\t * if there is just one segment into S/G list then\n\t * map it as it was a single request, filling\n\t * data_addr and data_cnt of ASC_SCSIQ structure.\n\t */\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tsg_entry_cnt = sg_head->entry_cnt;\n\n\t\tif (sg_entry_cnt < 1)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with QC_SG_HEAD set but %d segs.\",\n\t\t\t      sg_entry_cnt);\n\n\t\tif (sg_entry_cnt > ASC_MAX_SG_LIST)\n\t\t\tpanic(\"AscExeScsiQueue: Queue with too many segs.\");\n\n\t\tif (sg_entry_cnt == 1) {\n\t\t\tscsiq->q1.data_addr = sg_head->sg_list[0].addr;\n\t\t\tscsiq->q1.data_cnt = sg_head->sg_list[0].bytes;\n\t\t\tscsiq->q1.cntl &= ~(ASC_QC_SG_HEAD | ASC_QC_SG_SWAP_QUEUE);\n\t\t}\n\t\tsg_entry_cnt_minus_one = sg_entry_cnt - 1;\n\t}\n\tscsi_cmd = scsiq->cdbptr[0];\n\tdisable_syn_offset_one_fix = FALSE;\n\tif ((sc->pci_fix_asyn_xfer & scsiq->q1.target_id) &&\n\t    !(sc->pci_fix_asyn_xfer_always & scsiq->q1.target_id)) {\n\t\tif (scsiq->q1.cntl & ASC_QC_SG_HEAD) {\n\t\t\tdata_cnt = 0;\n\t\t\tfor (i = 0; i < sg_entry_cnt; i++)\n\t\t\t\tdata_cnt += sg_head->sg_list[i].bytes;\n\t\t} else {\n\t\t\tdata_cnt = scsiq->q1.data_cnt;\n\t\t}\n\n\t\tif (data_cnt != 0ul) {\n\t\t\tif (data_cnt < 512ul) {\n\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t} else {\n\t\t\t\tif (scsi_cmd == SCSICMD_Inquiry ||\n\t\t\t\t    scsi_cmd == SCSICMD_RequestSense ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadCapacity ||\n\t\t\t\t    scsi_cmd == SCSICMD_ReadTOC ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense6 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSelect10 ||\n\t\t\t\t    scsi_cmd == SCSICMD_ModeSense10) {\n\t\t\t\t\tdisable_syn_offset_one_fix = TRUE;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (disable_syn_offset_one_fix) {\n\t\tscsiq->q2.tag_code &= ~M2_QTAG_MSG_SIMPLE;\n\t\tscsiq->q2.tag_code |= (ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX |\n\t\t\t\t       ASC_TAG_FLAG_DISABLE_DISCONNECT);\n\t} else {\n\t\tscsiq->q2.tag_code &= 0x23;\n\t}\n\n\tif ((scsiq->q1.cntl & ASC_QC_SG_HEAD) != 0) {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = sg_head->sg_list[sg_entry_cnt_minus_one].addr +\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\tsg_head->sg_list[sg_entry_cnt_minus_one].bytes -=\n\t\t\t\t\t\t\textra_bytes;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsg_head->entry_to_copy = sg_head->entry_cnt;\n\t\tn_q_required = AscSgListToQueue(sg_entry_cnt);\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, n_q_required) >= n_q_required)\n\t\t    || ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t} else {\n\t\tif (sc->bug_fix_cntl) {\n\t\t\tif (sc->bug_fix_cntl & ASC_BUG_FIX_IF_NOT_DWB) {\n\t\t\t\tif ((scsi_cmd == SCSICMD_Read6) || (scsi_cmd == SCSICMD_Read10)) {\n\t\t\t\t\taddr = scsiq->q1.data_addr + scsiq->q1.data_cnt;\n\t\t\t\t\textra_bytes = addr & 0x0003;\n\t\t\t\t\tif ((extra_bytes != 0) &&\n\t\t\t\t\t    ((scsiq->q2.tag_code & ASC_TAG_FLAG_EXTRA_BYTES) == 0)) {\n\t\t\t\t\t\tif ((scsiq->q1.data_cnt & 0x01FF) == 0) {\n\t\t\t\t\t\t\tscsiq->q2.tag_code |= ASC_TAG_FLAG_EXTRA_BYTES;\n\t\t\t\t\t\t\tscsiq->q1.data_cnt -= extra_bytes;\n\t\t\t\t\t\t\tscsiq->q1.extra_bytes = extra_bytes;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tn_q_required = 1;\n\t\tif ((AscGetNumOfFreeQueue(sc, target_ix, 1) >= 1) ||\n\t\t    ((scsiq->q1.cntl & ASC_QC_URGENT) != 0)) {\n\t\t\tretval = AscSendScsiQueue(sc, scsiq, n_q_required);\n\t\t}\n\t}\n\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscGetSynPeriodIndex",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2439-2461",
    "snippet": "static u_int8_t\nAscGetSynPeriodIndex(sc, syn_time)\n\tASC_SOFTC      *sc;\n\tu_int8_t        syn_time;\n{\n\tu_int8_t       *period_table;\n\tint             max_index;\n\tint             min_index;\n\tint             i;\n\n\tperiod_table = sc->sdtr_period_tbl;\n\tmax_index = sc->max_sdtr_index;\n\tmin_index = sc->host_init_sdtr_index;\n\tif ((syn_time <= period_table[max_index])) {\n\t\tfor (i = min_index; i < (max_index - 1); i++) {\n\t\t\tif (syn_time <= period_table[i])\n\t\t\t\treturn (i);\n\t\t}\n\n\t\treturn (max_index);\n\t} else\n\t\treturn (max_index + 1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscGetSynPeriodIndex"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscGetSynPeriodIndex(sc, syn_time)\n\tASC_SOFTC      *sc;\n\tu_int8_t        syn_time;\n{\n\tu_int8_t       *period_table;\n\tint             max_index;\n\tint             min_index;\n\tint             i;\n\n\tperiod_table = sc->sdtr_period_tbl;\n\tmax_index = sc->max_sdtr_index;\n\tmin_index = sc->host_init_sdtr_index;\n\tif ((syn_time <= period_table[max_index])) {\n\t\tfor (i = min_index; i < (max_index - 1); i++) {\n\t\t\tif (syn_time <= period_table[i])\n\t\t\t\treturn (i);\n\t\t}\n\n\t\treturn (max_index);\n\t} else\n\t\treturn (max_index + 1);\n}"
  },
  {
    "function_name": "AscCalSDTRData",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2421-2436",
    "snippet": "static u_int8_t\nAscCalSDTRData(sc, sdtr_period, syn_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        syn_offset;\n{\n\tu_int8_t        byte;\n\tu_int8_t        sdtr_period_ix;\n\n\tsdtr_period_ix = AscGetSynPeriodIndex(sc, sdtr_period);\n\tif (sdtr_period_ix > sc->max_sdtr_index)\n\t\treturn (0xFF);\n\n\tbyte = (sdtr_period_ix << 4) | (syn_offset & ASC_SYN_MAX_OFFSET);\n\treturn (byte);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscCalSDTRData",
      "static u_int8_t AscGetSynPeriodIndex"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscGetSynPeriodIndex",
          "args": [
            "sc",
            "sdtr_period"
          ],
          "line": 2430
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetSynPeriodIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2439-2461",
          "snippet": "static u_int8_t\nAscGetSynPeriodIndex(sc, syn_time)\n\tASC_SOFTC      *sc;\n\tu_int8_t        syn_time;\n{\n\tu_int8_t       *period_table;\n\tint             max_index;\n\tint             min_index;\n\tint             i;\n\n\tperiod_table = sc->sdtr_period_tbl;\n\tmax_index = sc->max_sdtr_index;\n\tmin_index = sc->host_init_sdtr_index;\n\tif ((syn_time <= period_table[max_index])) {\n\t\tfor (i = min_index; i < (max_index - 1); i++) {\n\t\t\tif (syn_time <= period_table[i])\n\t\t\t\treturn (i);\n\t\t}\n\n\t\treturn (max_index);\n\t} else\n\t\treturn (max_index + 1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscGetSynPeriodIndex(sc, syn_time)\n\tASC_SOFTC      *sc;\n\tu_int8_t        syn_time;\n{\n\tu_int8_t       *period_table;\n\tint             max_index;\n\tint             min_index;\n\tint             i;\n\n\tperiod_table = sc->sdtr_period_tbl;\n\tmax_index = sc->max_sdtr_index;\n\tmin_index = sc->host_init_sdtr_index;\n\tif ((syn_time <= period_table[max_index])) {\n\t\tfor (i = min_index; i < (max_index - 1); i++) {\n\t\t\tif (syn_time <= period_table[i])\n\t\t\t\treturn (i);\n\t\t}\n\n\t\treturn (max_index);\n\t} else\n\t\treturn (max_index + 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscCalSDTRData;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscCalSDTRData(sc, sdtr_period, syn_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        syn_offset;\n{\n\tu_int8_t        byte;\n\tu_int8_t        sdtr_period_ix;\n\n\tsdtr_period_ix = AscGetSynPeriodIndex(sc, sdtr_period);\n\tif (sdtr_period_ix > sc->max_sdtr_index)\n\t\treturn (0xFF);\n\n\tbyte = (sdtr_period_ix << 4) | (syn_offset & ASC_SYN_MAX_OFFSET);\n\treturn (byte);\n}"
  },
  {
    "function_name": "AscSetChipSDTR",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2409-2418",
    "snippet": "static void\nAscSetChipSDTR(iot, ioh, sdtr_data, tid_no)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        tid_no;\n{\n\tAscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\tAscWriteLramByte(iot, ioh, tid_no + ASCV_SDTR_DONE_BEG, sdtr_data);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscSetChipSynRegAtID",
      "static void AscWriteLramByte",
      "static void AscSetChipSDTR"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "tid_no + ASCV_SDTR_DONE_BEG",
            "sdtr_data"
          ],
          "line": 2417
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetChipSynRegAtID",
          "args": [
            "iot",
            "ioh",
            "tid_no",
            "sdtr_data"
          ],
          "line": 2416
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipSynRegAtID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "907-938",
          "snippet": "static int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static int AscSetChipSynRegAtID"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic int AscSetChipSynRegAtID;\n\nstatic int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetChipSynRegAtID;\nstatic void AscWriteLramByte;\nstatic void AscSetChipSDTR;\n\nstatic void\nAscSetChipSDTR(iot, ioh, sdtr_data, tid_no)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        tid_no;\n{\n\tAscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\tAscWriteLramByte(iot, ioh, tid_no + ASCV_SDTR_DONE_BEG, sdtr_data);\n}"
  },
  {
    "function_name": "AscMsgOutSDTR",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2372-2401",
    "snippet": "static u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscMemWordCopyToLram",
      "static u_int8_t AscMsgOutSDTR",
      "static u_int8_t AscGetSynPeriodIndex"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscMemWordCopyToLram",
          "args": [
            "iot",
            "ioh",
            "ASCV_MSGOUT_BEG",
            "(u_int16_t *) & sdtr_buf",
            "sizeof(EXT_MSG) >> 1"
          ],
          "line": 2397
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyToLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1126-1139",
          "snippet": "static void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\n\nstatic void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetSynPeriodIndex",
          "args": [
            "sc",
            "sdtr_period"
          ],
          "line": 2390
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetSynPeriodIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2439-2461",
          "snippet": "static u_int8_t\nAscGetSynPeriodIndex(sc, syn_time)\n\tASC_SOFTC      *sc;\n\tu_int8_t        syn_time;\n{\n\tu_int8_t       *period_table;\n\tint             max_index;\n\tint             min_index;\n\tint             i;\n\n\tperiod_table = sc->sdtr_period_tbl;\n\tmax_index = sc->max_sdtr_index;\n\tmin_index = sc->host_init_sdtr_index;\n\tif ((syn_time <= period_table[max_index])) {\n\t\tfor (i = min_index; i < (max_index - 1); i++) {\n\t\t\tif (syn_time <= period_table[i])\n\t\t\t\treturn (i);\n\t\t}\n\n\t\treturn (max_index);\n\t} else\n\t\treturn (max_index + 1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscGetSynPeriodIndex(sc, syn_time)\n\tASC_SOFTC      *sc;\n\tu_int8_t        syn_time;\n{\n\tu_int8_t       *period_table;\n\tint             max_index;\n\tint             min_index;\n\tint             i;\n\n\tperiod_table = sc->sdtr_period_tbl;\n\tmax_index = sc->max_sdtr_index;\n\tmin_index = sc->host_init_sdtr_index;\n\tif ((syn_time <= period_table[max_index])) {\n\t\tfor (i = min_index; i < (max_index - 1); i++) {\n\t\t\tif (syn_time <= period_table[i])\n\t\t\t\treturn (i);\n\t\t}\n\n\t\treturn (max_index);\n\t} else\n\t\treturn (max_index + 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "AscHandleExtMsgIn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2280-2369",
    "snippet": "static void\nAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id, tid_no, asyn_sdtr)\n\tASC_SOFTC      *sc;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        q_cntl;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tint             tid_no;\n\tu_int8_t        asyn_sdtr;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         ext_msg;\n\tu_int8_t        sdtr_data;\n\tint             sdtr_accept;\n\n\n\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGIN_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\n\tif (ext_msg.msg_type == MS_EXTEND &&\n\t    ext_msg.msg_req == MS_SDTR_CODE &&\n\t    ext_msg.msg_len == MS_SDTR_LEN) {\n\t\tsdtr_accept = TRUE;\n\n\t\tif (ext_msg.req_ack_offset > ASC_SYN_MAX_OFFSET) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.req_ack_offset = ASC_SYN_MAX_OFFSET;\n\t\t}\n\t\tif ((ext_msg.xfer_period <\n\t\t     sc->sdtr_period_tbl[sc->host_init_sdtr_index]) ||\n\t\t    (ext_msg.xfer_period >\n\t\t     sc->sdtr_period_tbl[sc->max_sdtr_index])) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.xfer_period = sc->sdtr_period_tbl[sc->host_init_sdtr_index];\n\t\t}\n\t\tif (sdtr_accept) {\n\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t   ext_msg.req_ack_offset);\n\t\t\tif (sdtr_data == 0xFF) {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t\t}\n\t\t}\n\t\tif (ext_msg.req_ack_offset == 0) {\n\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t} else {\n\t\t\tif (sdtr_accept && (q_cntl & ASC_QC_MSG_OUT)) {\n\t\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t} else {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tAscMsgOutSDTR(sc, ext_msg.xfer_period,\n\t\t\t\t\t      ext_msg.req_ack_offset);\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t}\n\t\t}\n\t} else if (ext_msg.msg_type == MS_EXTEND &&\n\t\t   ext_msg.msg_req == MS_WDTR_CODE &&\n\t\t   ext_msg.msg_len == MS_WDTR_LEN) {\n\t\text_msg.wdtr_width = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t} else {\n\t\text_msg.msg_type = M1_MSG_REJECT;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t}\n\n\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramByte",
      "static void AscMemWordCopyToLram",
      "static void AscMemWordCopyFromLram",
      "static void AscHandleExtMsgIn",
      "static u_int8_t AscMsgOutSDTR",
      "static void AscSetChipSDTR",
      "static u_int8_t AscCalSDTRData"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "halt_q_addr + ASC_SCSIQ_B_CNTL",
            "q_cntl"
          ],
          "line": 2368
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordCopyToLram",
          "args": [
            "iot",
            "ioh",
            "ASCV_MSGOUT_BEG",
            "(u_int16_t *) & ext_msg",
            "sizeof(EXT_MSG) >> 1"
          ],
          "line": 2363
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyToLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1126-1139",
          "snippet": "static void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\n\nstatic void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetChipSDTR",
          "args": [
            "iot",
            "ioh",
            "sdtr_data",
            "tid_no"
          ],
          "line": 2348
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipSDTR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2409-2418",
          "snippet": "static void\nAscSetChipSDTR(iot, ioh, sdtr_data, tid_no)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        tid_no;\n{\n\tAscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\tAscWriteLramByte(iot, ioh, tid_no + ASCV_SDTR_DONE_BEG, sdtr_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscSetChipSynRegAtID",
            "static void AscWriteLramByte",
            "static void AscSetChipSDTR"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetChipSynRegAtID;\nstatic void AscWriteLramByte;\nstatic void AscSetChipSDTR;\n\nstatic void\nAscSetChipSDTR(iot, ioh, sdtr_data, tid_no)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        tid_no;\n{\n\tAscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\tAscWriteLramByte(iot, ioh, tid_no + ASCV_SDTR_DONE_BEG, sdtr_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscCalSDTRData",
          "args": [
            "sc",
            "ext_msg.xfer_period",
            "ext_msg.req_ack_offset"
          ],
          "line": 2346
        },
        "resolved": true,
        "details": {
          "function_name": "AscCalSDTRData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2421-2436",
          "snippet": "static u_int8_t\nAscCalSDTRData(sc, sdtr_period, syn_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        syn_offset;\n{\n\tu_int8_t        byte;\n\tu_int8_t        sdtr_period_ix;\n\n\tsdtr_period_ix = AscGetSynPeriodIndex(sc, sdtr_period);\n\tif (sdtr_period_ix > sc->max_sdtr_index)\n\t\treturn (0xFF);\n\n\tbyte = (sdtr_period_ix << 4) | (syn_offset & ASC_SYN_MAX_OFFSET);\n\treturn (byte);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscCalSDTRData",
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscCalSDTRData;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscCalSDTRData(sc, sdtr_period, syn_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        syn_offset;\n{\n\tu_int8_t        byte;\n\tu_int8_t        sdtr_period_ix;\n\n\tsdtr_period_ix = AscGetSynPeriodIndex(sc, sdtr_period);\n\tif (sdtr_period_ix > sc->max_sdtr_index)\n\t\treturn (0xFF);\n\n\tbyte = (sdtr_period_ix << 4) | (syn_offset & ASC_SYN_MAX_OFFSET);\n\treturn (byte);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMsgOutSDTR",
          "args": [
            "sc",
            "ext_msg.xfer_period",
            "ext_msg.req_ack_offset"
          ],
          "line": 2343
        },
        "resolved": true,
        "details": {
          "function_name": "AscMsgOutSDTR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2372-2401",
          "snippet": "static u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram",
            "static u_int8_t AscMsgOutSDTR",
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordCopyFromLram",
          "args": [
            "iot",
            "ioh",
            "ASCV_MSGIN_BEG",
            "(u_int16_t *) & ext_msg",
            "sizeof(EXT_MSG) >> 1"
          ],
          "line": 2296
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyFromLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1142-1155",
          "snippet": "static void\nAscMemWordCopyFromLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\t*s_buffer = ASC_GET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyFromLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyFromLram;\n\nstatic void\nAscMemWordCopyFromLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\t*s_buffer = ASC_GET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic void AscMemWordCopyToLram;\nstatic void AscMemWordCopyFromLram;\nstatic void AscHandleExtMsgIn;\nstatic u_int8_t AscMsgOutSDTR;\nstatic void AscSetChipSDTR;\nstatic u_int8_t AscCalSDTRData;\n\nstatic void\nAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id, tid_no, asyn_sdtr)\n\tASC_SOFTC      *sc;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        q_cntl;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tint             tid_no;\n\tu_int8_t        asyn_sdtr;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         ext_msg;\n\tu_int8_t        sdtr_data;\n\tint             sdtr_accept;\n\n\n\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGIN_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\n\tif (ext_msg.msg_type == MS_EXTEND &&\n\t    ext_msg.msg_req == MS_SDTR_CODE &&\n\t    ext_msg.msg_len == MS_SDTR_LEN) {\n\t\tsdtr_accept = TRUE;\n\n\t\tif (ext_msg.req_ack_offset > ASC_SYN_MAX_OFFSET) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.req_ack_offset = ASC_SYN_MAX_OFFSET;\n\t\t}\n\t\tif ((ext_msg.xfer_period <\n\t\t     sc->sdtr_period_tbl[sc->host_init_sdtr_index]) ||\n\t\t    (ext_msg.xfer_period >\n\t\t     sc->sdtr_period_tbl[sc->max_sdtr_index])) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.xfer_period = sc->sdtr_period_tbl[sc->host_init_sdtr_index];\n\t\t}\n\t\tif (sdtr_accept) {\n\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t   ext_msg.req_ack_offset);\n\t\t\tif (sdtr_data == 0xFF) {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t\t}\n\t\t}\n\t\tif (ext_msg.req_ack_offset == 0) {\n\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t} else {\n\t\t\tif (sdtr_accept && (q_cntl & ASC_QC_MSG_OUT)) {\n\t\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t} else {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tAscMsgOutSDTR(sc, ext_msg.xfer_period,\n\t\t\t\t\t      ext_msg.req_ack_offset);\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t}\n\t\t}\n\t} else if (ext_msg.msg_type == MS_EXTEND &&\n\t\t   ext_msg.msg_req == MS_WDTR_CODE &&\n\t\t   ext_msg.msg_len == MS_WDTR_LEN) {\n\t\text_msg.wdtr_width = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t} else {\n\t\text_msg.msg_type = M1_MSG_REJECT;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t}\n\n\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n}"
  },
  {
    "function_name": "AscSetIsaDmaSpeed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2261-2272",
    "snippet": "static u_int8_t\nAscSetIsaDmaSpeed(iot, ioh, speed_value)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        speed_value;\n{\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DMA_SPEED(iot, ioh, speed_value);\n\tAscSetBank(iot, ioh, 0);\n\treturn (AscGetIsaDmaSpeed(iot, ioh));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscSetBank",
      "static u_int8_t AscGetIsaDmaSpeed",
      "static u_int8_t AscSetIsaDmaSpeed"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscGetIsaDmaSpeed",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2271
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetIsaDmaSpeed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2246-2258",
          "snippet": "static u_int8_t\nAscGetIsaDmaSpeed(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        speed_value;\n\n\tAscSetBank(iot, ioh, 1);\n\tspeed_value = ASC_READ_CHIP_DMA_SPEED(iot, ioh);\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 0);\n\treturn (speed_value);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static u_int8_t AscGetIsaDmaSpeed"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic u_int8_t AscGetIsaDmaSpeed;\n\nstatic u_int8_t\nAscGetIsaDmaSpeed(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        speed_value;\n\n\tAscSetBank(iot, ioh, 1);\n\tspeed_value = ASC_READ_CHIP_DMA_SPEED(iot, ioh);\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 0);\n\treturn (speed_value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetBank",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 2270
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetBank",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "770-798",
          "snippet": "static void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\n\nstatic void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_WRITE_CHIP_DMA_SPEED",
          "args": [
            "iot",
            "ioh",
            "speed_value"
          ],
          "line": 2269
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic u_int8_t AscGetIsaDmaSpeed;\nstatic u_int8_t AscSetIsaDmaSpeed;\n\nstatic u_int8_t\nAscSetIsaDmaSpeed(iot, ioh, speed_value)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        speed_value;\n{\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DMA_SPEED(iot, ioh, speed_value);\n\tAscSetBank(iot, ioh, 0);\n\treturn (AscGetIsaDmaSpeed(iot, ioh));\n}"
  },
  {
    "function_name": "AscGetIsaDmaSpeed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2246-2258",
    "snippet": "static u_int8_t\nAscGetIsaDmaSpeed(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        speed_value;\n\n\tAscSetBank(iot, ioh, 1);\n\tspeed_value = ASC_READ_CHIP_DMA_SPEED(iot, ioh);\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 0);\n\treturn (speed_value);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscSetBank",
      "static u_int8_t AscGetIsaDmaSpeed"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetBank",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 2256
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetBank",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "770-798",
          "snippet": "static void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\n\nstatic void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_READ_CHIP_DMA_SPEED",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2254
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic u_int8_t AscGetIsaDmaSpeed;\n\nstatic u_int8_t\nAscGetIsaDmaSpeed(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        speed_value;\n\n\tAscSetBank(iot, ioh, 1);\n\tspeed_value = ASC_READ_CHIP_DMA_SPEED(iot, ioh);\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 0);\n\treturn (speed_value);\n}"
  },
  {
    "function_name": "AscSetIsaDmaChannel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2223-2243",
    "snippet": "static u_int16_t\nAscSetIsaDmaChannel(iot, ioh, dma_channel)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       dma_channel;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        value;\n\n\tif ((dma_channel >= 5) && (dma_channel <= 7)) {\n\t\tif (dma_channel == 7)\n\t\t\tvalue = 0x00;\n\t\telse\n\t\t\tvalue = dma_channel - 4;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFFC;\n\t\tcfg_lsw |= value;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\treturn (AscGetIsaDmaChannel(iot, ioh));\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscGetIsaDmaChannel",
      "static u_int16_t AscSetIsaDmaChannel"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscGetIsaDmaChannel",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2240
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetIsaDmaChannel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2207-2220",
          "snippet": "static u_int16_t\nAscGetIsaDmaChannel(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       channel;\n\n\tchannel = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0x0003;\n\tif (channel == 0x03)\n\t\treturn (0);\n\telse if (channel == 0x00)\n\t\treturn (7);\n\treturn (channel + 4);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscGetIsaDmaChannel"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetIsaDmaChannel;\n\nstatic u_int16_t\nAscGetIsaDmaChannel(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       channel;\n\n\tchannel = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0x0003;\n\tif (channel == 0x03)\n\t\treturn (0);\n\telse if (channel == 0x00)\n\t\treturn (7);\n\treturn (channel + 4);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg_lsw"
          ],
          "line": 2239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2237
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetIsaDmaChannel;\nstatic u_int16_t AscSetIsaDmaChannel;\n\nstatic u_int16_t\nAscSetIsaDmaChannel(iot, ioh, dma_channel)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       dma_channel;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        value;\n\n\tif ((dma_channel >= 5) && (dma_channel <= 7)) {\n\t\tif (dma_channel == 7)\n\t\t\tvalue = 0x00;\n\t\telse\n\t\t\tvalue = dma_channel - 4;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFFC;\n\t\tcfg_lsw |= value;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\treturn (AscGetIsaDmaChannel(iot, ioh));\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "AscGetIsaDmaChannel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2207-2220",
    "snippet": "static u_int16_t\nAscGetIsaDmaChannel(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       channel;\n\n\tchannel = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0x0003;\n\tif (channel == 0x03)\n\t\treturn (0);\n\telse if (channel == 0x00)\n\t\treturn (7);\n\treturn (channel + 4);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscGetIsaDmaChannel"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2214
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetIsaDmaChannel;\n\nstatic u_int16_t\nAscGetIsaDmaChannel(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       channel;\n\n\tchannel = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0x0003;\n\tif (channel == 0x03)\n\t\treturn (0);\n\telse if (channel == 0x00)\n\t\treturn (7);\n\treturn (channel + 4);\n}"
  },
  {
    "function_name": "AscGetMaxDmaCount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2195-2204",
    "snippet": "static u_int32_t\nAscGetMaxDmaCount(bus_type)\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_ISA)\n\t\treturn (ASC_MAX_ISA_DMA_COUNT);\n\telse if (bus_type & (ASC_IS_EISA | ASC_IS_VL))\n\t\treturn (ASC_MAX_VL_DMA_COUNT);\n\treturn (ASC_MAX_PCI_DMA_COUNT);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int32_t AscGetMaxDmaCount"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscGetMaxDmaCount;\n\nstatic u_int32_t\nAscGetMaxDmaCount(bus_type)\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_ISA)\n\t\treturn (ASC_MAX_ISA_DMA_COUNT);\n\telse if (bus_type & (ASC_IS_EISA | ASC_IS_VL))\n\t\treturn (ASC_MAX_VL_DMA_COUNT);\n\treturn (ASC_MAX_PCI_DMA_COUNT);\n}"
  },
  {
    "function_name": "AscAckInterrupt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2161-2192",
    "snippet": "static void\nAscAckInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        host_flag;\n\tu_int8_t        risc_flag;\n\tu_int16_t       loop;\n\n\n\tloop = 0;\n\tdo {\n\t\trisc_flag = AscReadLramByte(iot, ioh, ASCV_RISC_FLAG_B);\n\t\tif (loop++ > 0x7FFF)\n\t\t\tbreak;\n\t} while ((risc_flag & ASC_RISC_FLAG_GEN_INT) != 0);\n\n\thost_flag = AscReadLramByte(iot, ioh, ASCV_HOST_FLAG_B) &\n\t\t(~ASC_HOST_FLAG_ACK_INT);\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B,\n\t\t\t host_flag | ASC_HOST_FLAG_ACK_INT);\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\n\tloop = 0;\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_INT_PENDING) {\n\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\t\tif (loop++ > 3)\n\t\t\tbreak;\n\t}\n\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B, host_flag);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static void AscAckInterrupt"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_HOST_FLAG_B",
            "host_flag"
          ],
          "line": 2191
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "ASC_CIW_INT_ACK"
          ],
          "line": 2186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "ASC_CIW_INT_ACK"
          ],
          "line": 2182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_HOST_FLAG_B"
          ],
          "line": 2178
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscAckInterrupt;\n\nstatic void\nAscAckInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        host_flag;\n\tu_int8_t        risc_flag;\n\tu_int16_t       loop;\n\n\n\tloop = 0;\n\tdo {\n\t\trisc_flag = AscReadLramByte(iot, ioh, ASCV_RISC_FLAG_B);\n\t\tif (loop++ > 0x7FFF)\n\t\t\tbreak;\n\t} while ((risc_flag & ASC_RISC_FLAG_GEN_INT) != 0);\n\n\thost_flag = AscReadLramByte(iot, ioh, ASCV_HOST_FLAG_B) &\n\t\t(~ASC_HOST_FLAG_ACK_INT);\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B,\n\t\t\t host_flag | ASC_HOST_FLAG_ACK_INT);\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\n\tloop = 0;\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_INT_PENDING) {\n\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\t\tif (loop++ > 3)\n\t\t\tbreak;\n\t}\n\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B, host_flag);\n}"
  },
  {
    "function_name": "AscSetChipIRQ",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2118-2158",
    "snippet": "static u_int8_t\nAscSetChipIRQ(iot, ioh, irq_no, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        irq_no;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tif (irq_no) {\n\t\t\tif ((irq_no < ASC_MIN_IRQ_NO) || (irq_no > ASC_MAX_IRQ_NO))\n\t\t\t\tirq_no = 0;\n\t\t\telse\n\t\t\t\tirq_no -= ASC_MIN_IRQ_NO - 1;\n\t\t}\n\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE3;\n\t\tcfg_lsw |= 0x0010;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE0;\n\t\tcfg_lsw |= (irq_no & 0x07) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\tif (bus_type & ASC_IS_ISA) {\n\t\tif (irq_no == 15)\n\t\t\tirq_no -= 2;\n\t\tirq_no -= ASC_MIN_IRQ_NO;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFF3;\n\t\tcfg_lsw |= (irq_no & 0x03) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscToggleIRQAct",
      "static u_int8_t AscGetChipIRQ",
      "static u_int8_t AscSetChipIRQ"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscGetChipIRQ",
          "args": [
            "iot",
            "ioh",
            "bus_type"
          ],
          "line": 2155
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipIRQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2083-2115",
          "snippet": "static u_int8_t\nAscGetChipIRQ(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        chip_irq;\n\n\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * cfg_lsw = AscGetEisaChipCfg(iot, ioh); chip_irq =\n\t\t * ((cfg_lsw >> 8) & 0x07) + 10; if((chip_irq == 13) ||\n\t\t * (chip_irq > 15)) return (0); return(chip_irq);\n\t\t */\n\t}\n\tif ((bus_type & ASC_IS_VL) != 0) {\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\tchip_irq = (cfg_lsw >> 2) & 0x07;\n\t\tif ((chip_irq == 0) ||\n\t\t    (chip_irq == 4) ||\n\t\t    (chip_irq == 7)) {\n\t\t\treturn (0);\n\t\t}\n\t\treturn (chip_irq + (ASC_MIN_IRQ_NO - 1));\n\t}\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tchip_irq = (cfg_lsw >> 2) & 0x03;\n\tif (chip_irq == 3)\n\t\tchip_irq += 2;\n\treturn (chip_irq + ASC_MIN_IRQ_NO);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetChipIRQ"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipIRQ;\n\nstatic u_int8_t\nAscGetChipIRQ(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        chip_irq;\n\n\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * cfg_lsw = AscGetEisaChipCfg(iot, ioh); chip_irq =\n\t\t * ((cfg_lsw >> 8) & 0x07) + 10; if((chip_irq == 13) ||\n\t\t * (chip_irq > 15)) return (0); return(chip_irq);\n\t\t */\n\t}\n\tif ((bus_type & ASC_IS_VL) != 0) {\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\tchip_irq = (cfg_lsw >> 2) & 0x07;\n\t\tif ((chip_irq == 0) ||\n\t\t    (chip_irq == 4) ||\n\t\t    (chip_irq == 7)) {\n\t\t\treturn (0);\n\t\t}\n\t\treturn (chip_irq + (ASC_MIN_IRQ_NO - 1));\n\t}\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tchip_irq = (cfg_lsw >> 2) & 0x03;\n\tif (chip_irq == 3)\n\t\tchip_irq += 2;\n\treturn (chip_irq + ASC_MIN_IRQ_NO);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg_lsw"
          ],
          "line": 2153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscToggleIRQAct",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2143
        },
        "resolved": true,
        "details": {
          "function_name": "AscToggleIRQAct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2048-2056",
          "snippet": "static void\nAscToggleIRQAct(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_IRQ_ACT);\n\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscToggleIRQAct"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscToggleIRQAct;\n\nstatic void\nAscToggleIRQAct(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_IRQ_ACT);\n\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg_lsw"
          ],
          "line": 2142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg_lsw"
          ],
          "line": 2138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2136
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscToggleIRQAct;\nstatic u_int8_t AscGetChipIRQ;\nstatic u_int8_t AscSetChipIRQ;\n\nstatic u_int8_t\nAscSetChipIRQ(iot, ioh, irq_no, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        irq_no;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tif (irq_no) {\n\t\t\tif ((irq_no < ASC_MIN_IRQ_NO) || (irq_no > ASC_MAX_IRQ_NO))\n\t\t\t\tirq_no = 0;\n\t\t\telse\n\t\t\t\tirq_no -= ASC_MIN_IRQ_NO - 1;\n\t\t}\n\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE3;\n\t\tcfg_lsw |= 0x0010;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE0;\n\t\tcfg_lsw |= (irq_no & 0x07) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\tif (bus_type & ASC_IS_ISA) {\n\t\tif (irq_no == 15)\n\t\t\tirq_no -= 2;\n\t\tirq_no -= ASC_MIN_IRQ_NO;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFF3;\n\t\tcfg_lsw |= (irq_no & 0x03) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "AscGetChipIRQ",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2083-2115",
    "snippet": "static u_int8_t\nAscGetChipIRQ(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        chip_irq;\n\n\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * cfg_lsw = AscGetEisaChipCfg(iot, ioh); chip_irq =\n\t\t * ((cfg_lsw >> 8) & 0x07) + 10; if((chip_irq == 13) ||\n\t\t * (chip_irq > 15)) return (0); return(chip_irq);\n\t\t */\n\t}\n\tif ((bus_type & ASC_IS_VL) != 0) {\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\tchip_irq = (cfg_lsw >> 2) & 0x07;\n\t\tif ((chip_irq == 0) ||\n\t\t    (chip_irq == 4) ||\n\t\t    (chip_irq == 7)) {\n\t\t\treturn (0);\n\t\t}\n\t\treturn (chip_irq + (ASC_MIN_IRQ_NO - 1));\n\t}\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tchip_irq = (cfg_lsw >> 2) & 0x03;\n\tif (chip_irq == 3)\n\t\tchip_irq += 2;\n\treturn (chip_irq + ASC_MIN_IRQ_NO);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscGetChipIRQ"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipIRQ;\n\nstatic u_int8_t\nAscGetChipIRQ(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        chip_irq;\n\n\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * cfg_lsw = AscGetEisaChipCfg(iot, ioh); chip_irq =\n\t\t * ((cfg_lsw >> 8) & 0x07) + 10; if((chip_irq == 13) ||\n\t\t * (chip_irq > 15)) return (0); return(chip_irq);\n\t\t */\n\t}\n\tif ((bus_type & ASC_IS_VL) != 0) {\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\tchip_irq = (cfg_lsw >> 2) & 0x07;\n\t\tif ((chip_irq == 0) ||\n\t\t    (chip_irq == 4) ||\n\t\t    (chip_irq == 7)) {\n\t\t\treturn (0);\n\t\t}\n\t\treturn (chip_irq + (ASC_MIN_IRQ_NO - 1));\n\t}\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tchip_irq = (cfg_lsw >> 2) & 0x03;\n\tif (chip_irq == 3)\n\t\tchip_irq += 2;\n\treturn (chip_irq + ASC_MIN_IRQ_NO);\n}"
  },
  {
    "function_name": "AscEnableInterrupt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2071-2080",
    "snippet": "static void\nAscEnableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg | ASC_CFG0_HOST_INT_ON);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscEnableInterrupt"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg | ASC_CFG0_HOST_INT_ON"
          ],
          "line": 2079
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2078
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscEnableInterrupt;\n\nstatic void\nAscEnableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg | ASC_CFG0_HOST_INT_ON);\n}"
  },
  {
    "function_name": "AscDisableInterrupt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2059-2068",
    "snippet": "static void\nAscDisableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg & (~ASC_CFG0_HOST_INT_ON));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscDisableInterrupt"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg & (~ASC_CFG0_HOST_INT_ON)"
          ],
          "line": 2067
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2066
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscDisableInterrupt;\n\nstatic void\nAscDisableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg & (~ASC_CFG0_HOST_INT_ON));\n}"
  },
  {
    "function_name": "AscToggleIRQAct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2048-2056",
    "snippet": "static void\nAscToggleIRQAct(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_IRQ_ACT);\n\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscToggleIRQAct"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 2055
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "ASC_CIW_IRQ_ACT"
          ],
          "line": 2054
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscToggleIRQAct;\n\nstatic void\nAscToggleIRQAct(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_IRQ_ACT);\n\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n}"
  },
  {
    "function_name": "AscGetQDoneInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "2018-2045",
    "snippet": "static void\nAscGetQDoneInfo(iot, ioh, addr, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t\taddr;\n\tASC_QDONE_INFO\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.ccb_ptr = MAKELONG(val, ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.target_ix = LO_BYTE(val);\n\tscsiq->d2.flag = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.cdb_len = LO_BYTE(val);\n\tscsiq->d2.tag_code = HI_BYTE(val);\n\tscsiq->d2.vm_id = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.done_stat = LO_BYTE(val);\n\tscsiq->d3.host_stat = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.scsi_stat = LO_BYTE(val);\n\tscsiq->d3.scsi_msg = HI_BYTE(val);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscGetQDoneInfo"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "val"
          ],
          "line": 2044
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "val"
          ],
          "line": 2043
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2042
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "val"
          ],
          "line": 2041
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "val"
          ],
          "line": 2040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2037
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "val"
          ],
          "line": 2036
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "val"
          ],
          "line": 2035
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2034
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "val"
          ],
          "line": 2033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "val"
          ],
          "line": 2032
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2031
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKELONG",
          "args": [
            "val",
            "ASC_GET_CHIP_LRAM_DATA(iot, ioh)"
          ],
          "line": 2030
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2030
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 2029
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 2027
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscGetQDoneInfo;\n\nstatic void\nAscGetQDoneInfo(iot, ioh, addr, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t\taddr;\n\tASC_QDONE_INFO\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.ccb_ptr = MAKELONG(val, ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.target_ix = LO_BYTE(val);\n\tscsiq->d2.flag = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.cdb_len = LO_BYTE(val);\n\tscsiq->d2.tag_code = HI_BYTE(val);\n\tscsiq->d2.vm_id = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.done_stat = LO_BYTE(val);\n\tscsiq->d3.host_stat = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.scsi_stat = LO_BYTE(val);\n\tscsiq->d3.scsi_msg = HI_BYTE(val);\n}"
  },
  {
    "function_name": "_AscCopyLramScsiDoneQ",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1988-2015",
    "snippet": "static u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscReadLramWord",
      "static u_int8_t _AscCopyLramScsiDoneQ",
      "static void AscGetQDoneInfo"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscReadLramWord",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT"
          ],
          "line": 2010
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1054-1063",
          "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "_val"
          ],
          "line": 2009
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "_val"
          ],
          "line": 2008
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "_val"
          ],
          "line": 2006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "_val"
          ],
          "line": 2005
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_BYTE",
          "args": [
            "_val"
          ],
          "line": 2003
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_BYTE",
          "args": [
            "_val"
          ],
          "line": 2002
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscGetQDoneInfo",
          "args": [
            "iot",
            "ioh",
            "q_addr + ASC_SCSIQ_DONE_INFO_BEG",
            "scsiq"
          ],
          "line": 1999
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetQDoneInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2018-2045",
          "snippet": "static void\nAscGetQDoneInfo(iot, ioh, addr, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t\taddr;\n\tASC_QDONE_INFO\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.ccb_ptr = MAKELONG(val, ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.target_ix = LO_BYTE(val);\n\tscsiq->d2.flag = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.cdb_len = LO_BYTE(val);\n\tscsiq->d2.tag_code = HI_BYTE(val);\n\tscsiq->d2.vm_id = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.done_stat = LO_BYTE(val);\n\tscsiq->d3.host_stat = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.scsi_stat = LO_BYTE(val);\n\tscsiq->d3.scsi_msg = HI_BYTE(val);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscGetQDoneInfo"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscGetQDoneInfo;\n\nstatic void\nAscGetQDoneInfo(iot, ioh, addr, scsiq)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t\taddr;\n\tASC_QDONE_INFO\t*scsiq;\n{\n\tu_int16_t\tval;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.ccb_ptr = MAKELONG(val, ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.target_ix = LO_BYTE(val);\n\tscsiq->d2.flag = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d2.cdb_len = LO_BYTE(val);\n\tscsiq->d2.tag_code = HI_BYTE(val);\n\tscsiq->d2.vm_id = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.done_stat = LO_BYTE(val);\n\tscsiq->d3.host_stat = HI_BYTE(val);\n\tval = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\tscsiq->d3.scsi_stat = LO_BYTE(val);\n\tscsiq->d3.scsi_msg = HI_BYTE(val);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic void AscGetQDoneInfo;\n\nstatic u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}"
  },
  {
    "function_name": "AscWaitISRDone",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1975-1985",
    "snippet": "static int\nAscWaitISRDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tint             tid;\n\n\tfor (tid = 0; tid <= ASC_MAX_TID; tid++)\n\t\tAscWaitTixISRDone(sc, ASC_TID_TO_TIX(tid));\n\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWaitTixISRDone",
      "static int AscWaitISRDone"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWaitTixISRDone",
          "args": [
            "sc",
            "ASC_TID_TO_TIX(tid)"
          ],
          "line": 1982
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitTixISRDone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1954-1973",
          "snippet": "static int\nAscWaitTixISRDone(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tu_int8_t        cur_req;\n\tu_int8_t        tid_no;\n\tint             i = 0;\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\twhile (i++ < 10) {\n\t\tif ((cur_req = sc->cur_dvc_qng[tid_no]) == 0)\n\t\t\tbreak;\n\n\t\tDvcSleepMilliSecond(1000L);\n\t\tif (sc->cur_dvc_qng[tid_no] == cur_req)\n\t\t\tbreak;\n\t}\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWaitTixISRDone",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitTixISRDone;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWaitTixISRDone(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tu_int8_t        cur_req;\n\tu_int8_t        tid_no;\n\tint             i = 0;\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\twhile (i++ < 10) {\n\t\tif ((cur_req = sc->cur_dvc_qng[tid_no]) == 0)\n\t\t\tbreak;\n\n\t\tDvcSleepMilliSecond(1000L);\n\t\tif (sc->cur_dvc_qng[tid_no] == cur_req)\n\t\t\tbreak;\n\t}\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TID_TO_TIX",
          "args": [
            "tid"
          ],
          "line": 1982
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitTixISRDone;\nstatic int AscWaitISRDone;\n\nstatic int\nAscWaitISRDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tint             tid;\n\n\tfor (tid = 0; tid <= ASC_MAX_TID; tid++)\n\t\tAscWaitTixISRDone(sc, ASC_TID_TO_TIX(tid));\n\n\treturn (1);\n}"
  },
  {
    "function_name": "AscWaitTixISRDone",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1954-1973",
    "snippet": "static int\nAscWaitTixISRDone(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tu_int8_t        cur_req;\n\tu_int8_t        tid_no;\n\tint             i = 0;\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\twhile (i++ < 10) {\n\t\tif ((cur_req = sc->cur_dvc_qng[tid_no]) == 0)\n\t\t\tbreak;\n\n\t\tDvcSleepMilliSecond(1000L);\n\t\tif (sc->cur_dvc_qng[tid_no] == cur_req)\n\t\t\tbreak;\n\t}\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWaitTixISRDone",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "1000L"
          ],
          "line": 1968
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "target_ix"
          ],
          "line": 1963
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWaitTixISRDone;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWaitTixISRDone(sc, target_ix)\n\tASC_SOFTC      *sc;\n\tu_int8_t        target_ix;\n{\n\tu_int8_t        cur_req;\n\tu_int8_t        tid_no;\n\tint             i = 0;\n\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\twhile (i++ < 10) {\n\t\tif ((cur_req = sc->cur_dvc_qng[tid_no]) == 0)\n\t\t\tbreak;\n\n\t\tDvcSleepMilliSecond(1000L);\n\t\tif (sc->cur_dvc_qng[tid_no] == cur_req)\n\t\t\tbreak;\n\t}\n\treturn (1);\n}"
  },
  {
    "function_name": "AscIsrChipHalted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1817-1951",
    "snippet": "static void\nAscIsrChipHalted(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         out_msg;\n\tu_int16_t       int_halt_code;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        halt_qp;\n\tu_int8_t        target_ix;\n\tu_int8_t        tag_code;\n\tu_int8_t        q_status;\n\tu_int8_t        q_cntl;\n\tu_int8_t        tid_no;\n\tu_int8_t        cur_dvc_qng;\n\tu_int8_t        asyn_sdtr;\n\tu_int8_t        scsi_status;\n\tu_int8_t        sdtr_data;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\n\n\tint_halt_code = AscReadLramWord(iot, ioh, ASCV_HALTCODE_W);\n\n\thalt_qp = AscReadLramByte(iot, ioh, ASCV_CURCDB_B);\n\thalt_q_addr = ASC_QNO_TO_QADDR(halt_qp);\n\ttarget_ix = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TARGET_IX);\n\tq_cntl = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL);\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\ttarget_id = ASC_TID_TO_TARGET_ID(tid_no);\n\n\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\tasyn_sdtr = ASYN_SDTR_DATA_FIX_PCI_REV_AB;\n\t} else {\n\t\tasyn_sdtr = 0;\n\t}\n\n\tif (int_halt_code == ASC_HALT_DISABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, 0, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = 0;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_ENABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_EXTMSG_IN) {\n\t\tAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id,\n\t\t\t\t  tid_no, asyn_sdtr);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_CHK_CONDITION) {\n\t\tq_cntl |= ASC_QC_REQ_SENSE;\n\n\t\tif (sc->init_sdtr & target_id) {\n\t\t\tsc->sdtr_done &= ~target_id;\n\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      (sdtr_data & ASC_SYN_MAX_OFFSET));\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\n\t\ttag_code = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE);\n\t\ttag_code &= 0xDC;\n\n\t\tif ((sc->pci_fix_asyn_xfer & target_id) &&\n\t\t    !(sc->pci_fix_asyn_xfer_always & target_id)) {\n\t\t\ttag_code |= (ASC_TAG_FLAG_DISABLE_DISCONNECT |\n\t\t\t\t     ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX);\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE, tag_code);\n\n\t\tq_status = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS);\n\t\tq_status |= ASC_QS_READY | ASC_QS_BUSY;\n\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS, q_status);\n\n\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\tscsi_busy &= ~target_id;\n\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SDTR_REJECTED) {\n\t\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & out_msg, sizeof(EXT_MSG) >> 1);\n\n\t\tif ((out_msg.msg_type == MS_EXTEND) &&\n\t\t    (out_msg.msg_len == MS_SDTR_LEN) &&\n\t\t    (out_msg.msg_req == MS_SDTR_CODE)) {\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SS_QUEUE_FULL) {\n\t\tscsi_status = AscReadLramByte(iot, ioh,\n\t\t\t\t       halt_q_addr + ASC_SCSIQ_SCSI_STATUS);\n\t\tcur_dvc_qng = AscReadLramByte(iot, ioh, target_ix + ASC_QADR_BEG);\n\n\t\tif ((cur_dvc_qng > 0) && (sc->cur_dvc_qng[tid_no] > 0)) {\n\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\tscsi_busy |= target_id;\n\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\tsc->queue_full_or_busy |= target_id;\n\n\t\t\tif (scsi_status == SS_QUEUE_FULL) {\n\t\t\t\tif (cur_dvc_qng > ASC_MIN_TAGGED_CMD) {\n\t\t\t\t\tcur_dvc_qng -= 1;\n\t\t\t\t\tsc->max_dvc_qng[tid_no] = cur_dvc_qng;\n\n\t\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\t\t\t\t tid_no + ASCV_MAX_DVC_QNG_BEG, cur_dvc_qng);\n\n#if ASC_QUEUE_FLOW_CONTROL\n\t\t\t\t\tif ((sc->device[tid_no] != NULL) &&\n\t\t\t\t\t    (sc->device[tid_no]->queue_curr_depth > cur_dvc_qng)) {\n\t\t\t\t\t\tsc->device[tid_no]->queue_curr_depth = cur_dvc_qng;\n\t\t\t\t\t}\n#endif\t\t\t\t/* ASC_QUEUE_FLOW_CONTROL */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t}\n\treturn;\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static u_int16_t AscReadLramWord",
      "static void AscWriteLramWord",
      "static void AscMemWordCopyFromLram",
      "static void AscIsrChipHalted",
      "static void AscHandleExtMsgIn",
      "static u_int8_t AscMsgOutSDTR",
      "static void AscSetChipSDTR"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "ASCV_HALTCODE_W",
            "0"
          ],
          "line": 1948
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "tid_no + ASCV_MAX_DVC_QNG_BEG",
            "cur_dvc_qng"
          ],
          "line": 1936
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_SCSIBUSY_B"
          ],
          "line": 1926
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetChipSDTR",
          "args": [
            "iot",
            "ioh",
            "asyn_sdtr",
            "tid_no"
          ],
          "line": 1914
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipSDTR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2409-2418",
          "snippet": "static void\nAscSetChipSDTR(iot, ioh, sdtr_data, tid_no)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        tid_no;\n{\n\tAscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\tAscWriteLramByte(iot, ioh, tid_no + ASCV_SDTR_DONE_BEG, sdtr_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscSetChipSynRegAtID",
            "static void AscWriteLramByte",
            "static void AscSetChipSDTR"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetChipSynRegAtID;\nstatic void AscWriteLramByte;\nstatic void AscSetChipSDTR;\n\nstatic void\nAscSetChipSDTR(iot, ioh, sdtr_data, tid_no)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        sdtr_data;\n\tu_int8_t        tid_no;\n{\n\tAscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\tAscWriteLramByte(iot, ioh, tid_no + ASCV_SDTR_DONE_BEG, sdtr_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordCopyFromLram",
          "args": [
            "iot",
            "ioh",
            "ASCV_MSGOUT_BEG",
            "(u_int16_t *) & out_msg",
            "sizeof(EXT_MSG) >> 1"
          ],
          "line": 1906
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyFromLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1142-1155",
          "snippet": "static void\nAscMemWordCopyFromLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\t*s_buffer = ASC_GET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyFromLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyFromLram;\n\nstatic void\nAscMemWordCopyFromLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\t*s_buffer = ASC_GET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMsgOutSDTR",
          "args": [
            "sc",
            "sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)]",
            "(sdtr_data & ASC_SYN_MAX_OFFSET)"
          ],
          "line": 1879
        },
        "resolved": true,
        "details": {
          "function_name": "AscMsgOutSDTR",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2372-2401",
          "snippet": "static u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram",
            "static u_int8_t AscMsgOutSDTR",
            "static u_int8_t AscGetSynPeriodIndex"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\nstatic u_int8_t AscMsgOutSDTR;\nstatic u_int8_t AscGetSynPeriodIndex;\n\nstatic u_int8_t\nAscMsgOutSDTR(sc, sdtr_period, sdtr_offset)\n\tASC_SOFTC      *sc;\n\tu_int8_t        sdtr_period;\n\tu_int8_t        sdtr_offset;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         sdtr_buf;\n\tu_int8_t        sdtr_period_index;\n\n\n\tsdtr_buf.msg_type = MS_EXTEND;\n\tsdtr_buf.msg_len = MS_SDTR_LEN;\n\tsdtr_buf.msg_req = MS_SDTR_CODE;\n\tsdtr_buf.xfer_period = sdtr_period;\n\tsdtr_offset &= ASC_SYN_MAX_OFFSET;\n\tsdtr_buf.req_ack_offset = sdtr_offset;\n\tif ((sdtr_period_index = AscGetSynPeriodIndex(sc, sdtr_period)) <=\n\t    sc->max_sdtr_index) {\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn ((sdtr_period_index << 4) | sdtr_offset);\n\t} else {\n\t\tsdtr_buf.req_ack_offset = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t    (u_int16_t *) & sdtr_buf, sizeof(EXT_MSG) >> 1);\n\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_MCODE_INIT_SDTR_AT_ID",
          "args": [
            "iot",
            "ioh",
            "tid_no"
          ],
          "line": 1877
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscHandleExtMsgIn",
          "args": [
            "sc",
            "halt_q_addr",
            "q_cntl",
            "target_id",
            "tid_no",
            "asyn_sdtr"
          ],
          "line": 1868
        },
        "resolved": true,
        "details": {
          "function_name": "AscHandleExtMsgIn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2280-2369",
          "snippet": "static void\nAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id, tid_no, asyn_sdtr)\n\tASC_SOFTC      *sc;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        q_cntl;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tint             tid_no;\n\tu_int8_t        asyn_sdtr;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         ext_msg;\n\tu_int8_t        sdtr_data;\n\tint             sdtr_accept;\n\n\n\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGIN_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\n\tif (ext_msg.msg_type == MS_EXTEND &&\n\t    ext_msg.msg_req == MS_SDTR_CODE &&\n\t    ext_msg.msg_len == MS_SDTR_LEN) {\n\t\tsdtr_accept = TRUE;\n\n\t\tif (ext_msg.req_ack_offset > ASC_SYN_MAX_OFFSET) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.req_ack_offset = ASC_SYN_MAX_OFFSET;\n\t\t}\n\t\tif ((ext_msg.xfer_period <\n\t\t     sc->sdtr_period_tbl[sc->host_init_sdtr_index]) ||\n\t\t    (ext_msg.xfer_period >\n\t\t     sc->sdtr_period_tbl[sc->max_sdtr_index])) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.xfer_period = sc->sdtr_period_tbl[sc->host_init_sdtr_index];\n\t\t}\n\t\tif (sdtr_accept) {\n\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t   ext_msg.req_ack_offset);\n\t\t\tif (sdtr_data == 0xFF) {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t\t}\n\t\t}\n\t\tif (ext_msg.req_ack_offset == 0) {\n\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t} else {\n\t\t\tif (sdtr_accept && (q_cntl & ASC_QC_MSG_OUT)) {\n\t\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t} else {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tAscMsgOutSDTR(sc, ext_msg.xfer_period,\n\t\t\t\t\t      ext_msg.req_ack_offset);\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t}\n\t\t}\n\t} else if (ext_msg.msg_type == MS_EXTEND &&\n\t\t   ext_msg.msg_req == MS_WDTR_CODE &&\n\t\t   ext_msg.msg_len == MS_WDTR_LEN) {\n\t\text_msg.wdtr_width = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t} else {\n\t\text_msg.msg_type = M1_MSG_REJECT;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t}\n\n\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static void AscMemWordCopyToLram",
            "static void AscMemWordCopyFromLram",
            "static void AscHandleExtMsgIn",
            "static u_int8_t AscMsgOutSDTR",
            "static void AscSetChipSDTR",
            "static u_int8_t AscCalSDTRData"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic void AscMemWordCopyToLram;\nstatic void AscMemWordCopyFromLram;\nstatic void AscHandleExtMsgIn;\nstatic u_int8_t AscMsgOutSDTR;\nstatic void AscSetChipSDTR;\nstatic u_int8_t AscCalSDTRData;\n\nstatic void\nAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id, tid_no, asyn_sdtr)\n\tASC_SOFTC      *sc;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        q_cntl;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tint             tid_no;\n\tu_int8_t        asyn_sdtr;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         ext_msg;\n\tu_int8_t        sdtr_data;\n\tint             sdtr_accept;\n\n\n\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGIN_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\n\tif (ext_msg.msg_type == MS_EXTEND &&\n\t    ext_msg.msg_req == MS_SDTR_CODE &&\n\t    ext_msg.msg_len == MS_SDTR_LEN) {\n\t\tsdtr_accept = TRUE;\n\n\t\tif (ext_msg.req_ack_offset > ASC_SYN_MAX_OFFSET) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.req_ack_offset = ASC_SYN_MAX_OFFSET;\n\t\t}\n\t\tif ((ext_msg.xfer_period <\n\t\t     sc->sdtr_period_tbl[sc->host_init_sdtr_index]) ||\n\t\t    (ext_msg.xfer_period >\n\t\t     sc->sdtr_period_tbl[sc->max_sdtr_index])) {\n\t\t\tsdtr_accept = FALSE;\n\t\t\text_msg.xfer_period = sc->sdtr_period_tbl[sc->host_init_sdtr_index];\n\t\t}\n\t\tif (sdtr_accept) {\n\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t   ext_msg.req_ack_offset);\n\t\t\tif (sdtr_data == 0xFF) {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t\t}\n\t\t}\n\t\tif (ext_msg.req_ack_offset == 0) {\n\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t} else {\n\t\t\tif (sdtr_accept && (q_cntl & ASC_QC_MSG_OUT)) {\n\t\t\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t} else {\n\t\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\t\tAscMsgOutSDTR(sc, ext_msg.xfer_period,\n\t\t\t\t\t      ext_msg.req_ack_offset);\n\t\t\t\tsc->pci_fix_asyn_xfer &= ~target_id;\n\t\t\t\tsdtr_data = AscCalSDTRData(sc, ext_msg.xfer_period,\n\t\t\t\t\t\t    ext_msg.req_ack_offset);\n\t\t\t\tAscSetChipSDTR(iot, ioh, sdtr_data, tid_no);\n\t\t\t\tsc->sdtr_data[tid_no] = sdtr_data;\n\t\t\t\tsc->sdtr_done |= target_id;\n\t\t\t\tsc->init_sdtr |= target_id;\n\t\t\t}\n\t\t}\n\t} else if (ext_msg.msg_type == MS_EXTEND &&\n\t\t   ext_msg.msg_req == MS_WDTR_CODE &&\n\t\t   ext_msg.msg_len == MS_WDTR_LEN) {\n\t\text_msg.wdtr_width = 0;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t} else {\n\t\text_msg.msg_type = M1_MSG_REJECT;\n\t\tAscMemWordCopyToLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & ext_msg, sizeof(EXT_MSG) >> 1);\n\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t}\n\n\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TID_TO_TARGET_ID",
          "args": [
            "tid_no"
          ],
          "line": 1847
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "target_ix"
          ],
          "line": 1846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "halt_qp"
          ],
          "line": 1843
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReadLramWord",
          "args": [
            "iot",
            "ioh",
            "ASCV_HALTCODE_W"
          ],
          "line": 1840
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1054-1063",
          "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\nstatic void AscMemWordCopyFromLram;\nstatic void AscIsrChipHalted;\nstatic void AscHandleExtMsgIn;\nstatic u_int8_t AscMsgOutSDTR;\nstatic void AscSetChipSDTR;\n\nstatic void\nAscIsrChipHalted(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         out_msg;\n\tu_int16_t       int_halt_code;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        halt_qp;\n\tu_int8_t        target_ix;\n\tu_int8_t        tag_code;\n\tu_int8_t        q_status;\n\tu_int8_t        q_cntl;\n\tu_int8_t        tid_no;\n\tu_int8_t        cur_dvc_qng;\n\tu_int8_t        asyn_sdtr;\n\tu_int8_t        scsi_status;\n\tu_int8_t        sdtr_data;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\n\n\tint_halt_code = AscReadLramWord(iot, ioh, ASCV_HALTCODE_W);\n\n\thalt_qp = AscReadLramByte(iot, ioh, ASCV_CURCDB_B);\n\thalt_q_addr = ASC_QNO_TO_QADDR(halt_qp);\n\ttarget_ix = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TARGET_IX);\n\tq_cntl = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL);\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\ttarget_id = ASC_TID_TO_TARGET_ID(tid_no);\n\n\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\tasyn_sdtr = ASYN_SDTR_DATA_FIX_PCI_REV_AB;\n\t} else {\n\t\tasyn_sdtr = 0;\n\t}\n\n\tif (int_halt_code == ASC_HALT_DISABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, 0, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = 0;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_ENABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_EXTMSG_IN) {\n\t\tAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id,\n\t\t\t\t  tid_no, asyn_sdtr);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_CHK_CONDITION) {\n\t\tq_cntl |= ASC_QC_REQ_SENSE;\n\n\t\tif (sc->init_sdtr & target_id) {\n\t\t\tsc->sdtr_done &= ~target_id;\n\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      (sdtr_data & ASC_SYN_MAX_OFFSET));\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\n\t\ttag_code = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE);\n\t\ttag_code &= 0xDC;\n\n\t\tif ((sc->pci_fix_asyn_xfer & target_id) &&\n\t\t    !(sc->pci_fix_asyn_xfer_always & target_id)) {\n\t\t\ttag_code |= (ASC_TAG_FLAG_DISABLE_DISCONNECT |\n\t\t\t\t     ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX);\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE, tag_code);\n\n\t\tq_status = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS);\n\t\tq_status |= ASC_QS_READY | ASC_QS_BUSY;\n\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS, q_status);\n\n\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\tscsi_busy &= ~target_id;\n\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SDTR_REJECTED) {\n\t\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & out_msg, sizeof(EXT_MSG) >> 1);\n\n\t\tif ((out_msg.msg_type == MS_EXTEND) &&\n\t\t    (out_msg.msg_len == MS_SDTR_LEN) &&\n\t\t    (out_msg.msg_req == MS_SDTR_CODE)) {\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SS_QUEUE_FULL) {\n\t\tscsi_status = AscReadLramByte(iot, ioh,\n\t\t\t\t       halt_q_addr + ASC_SCSIQ_SCSI_STATUS);\n\t\tcur_dvc_qng = AscReadLramByte(iot, ioh, target_ix + ASC_QADR_BEG);\n\n\t\tif ((cur_dvc_qng > 0) && (sc->cur_dvc_qng[tid_no] > 0)) {\n\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\tscsi_busy |= target_id;\n\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\tsc->queue_full_or_busy |= target_id;\n\n\t\t\tif (scsi_status == SS_QUEUE_FULL) {\n\t\t\t\tif (cur_dvc_qng > ASC_MIN_TAGGED_CMD) {\n\t\t\t\t\tcur_dvc_qng -= 1;\n\t\t\t\t\tsc->max_dvc_qng[tid_no] = cur_dvc_qng;\n\n\t\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\t\t\t\t tid_no + ASCV_MAX_DVC_QNG_BEG, cur_dvc_qng);\n\n#if ASC_QUEUE_FLOW_CONTROL\n\t\t\t\t\tif ((sc->device[tid_no] != NULL) &&\n\t\t\t\t\t    (sc->device[tid_no]->queue_curr_depth > cur_dvc_qng)) {\n\t\t\t\t\t\tsc->device[tid_no]->queue_curr_depth = cur_dvc_qng;\n\t\t\t\t\t}\n#endif\t\t\t\t/* ASC_QUEUE_FLOW_CONTROL */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t}\n\treturn;\n}"
  },
  {
    "function_name": "AscIsrQDone",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1698-1810",
    "snippet": "static int\nAscIsrQDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tu_int8_t        next_qp;\n\tu_int8_t        n_q_used;\n\tu_int8_t        sg_list_qp;\n\tu_int8_t        sg_queue_cnt;\n\tu_int8_t        q_cnt;\n\tu_int8_t        done_q_tail;\n\tu_int8_t        tid_no;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int16_t       sg_q_addr;\n\tu_int8_t        cur_target_qng;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tn_q_used = 1;\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tdone_q_tail = ASC_GET_VAR_DONE_QTAIL(iot, ioh);\n\tq_addr = ASC_QNO_TO_QADDR(done_q_tail);\n\tnext_qp = AscReadLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_FWD));\n\n\tif (next_qp != ASC_QLINK_END) {\n\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, next_qp);\n\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\t\tsg_queue_cnt = _AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq,\n\t\t\t\t\t\t     sc->max_dma_count);\n\t\tAscWriteLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_STATUS),\n\t\t      (scsiq->q_status & ~(ASC_QS_READY | ASC_QS_ABORTED)));\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->d2.target_ix);\n\t\ttarget_id = ASC_TIX_TO_TARGET_ID(scsiq->d2.target_ix);\n\t\tif ((scsiq->cntl & ASC_QC_SG_HEAD) != 0) {\n\t\t\tsg_q_addr = q_addr;\n\t\t\tsg_list_qp = next_qp;\n\t\t\tfor (q_cnt = 0; q_cnt < sg_queue_cnt; q_cnt++) {\n\t\t\t\tsg_list_qp = AscReadLramByte(iot, ioh,\n\t\t\t\t\t       sg_q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tsg_q_addr = ASC_QNO_TO_QADDR(sg_list_qp);\n\t\t\t\tif (sg_list_qp == ASC_QLINK_END) {\n\t\t\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_SG_Q_LINKS);\n\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_D_QDONE_SG_LIST_CORRUPTED;\n\t\t\t\t\tpanic(\"AscIsrQDone: Corrupted SG list encountered\");\n\t\t\t\t}\n\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\tsg_q_addr + ASC_SCSIQ_B_STATUS, ASC_QS_FREE);\n\t\t\t}\n\t\t\tn_q_used = sg_queue_cnt + 1;\n\t\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sg_list_qp);\n\t\t}\n\t\tif (sc->queue_full_or_busy & target_id) {\n\t\t\tcur_target_qng = AscReadLramByte(iot, ioh,\n\t\t\t\t\tASC_QADR_BEG + scsiq->d2.target_ix);\n\n\t\t\tif (cur_target_qng < sc->max_dvc_qng[tid_no]) {\n\t\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\t\tscsi_busy &= ~target_id;\n\t\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\t\tsc->queue_full_or_busy &= ~target_id;\n\t\t\t}\n\t\t}\n\t\tif (sc->cur_total_qng >= n_q_used) {\n\t\t\tsc->cur_total_qng -= n_q_used;\n\t\t\tif (sc->cur_dvc_qng[tid_no] != 0) {\n\t\t\t\tsc->cur_dvc_qng[tid_no]--;\n\t\t\t}\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_CUR_QNG);\n\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\tpanic(\"AscIsrQDone: Attempting to free more queues than are active\");\n\t\t}\n\n\t\tif ((scsiq->d2.ccb_ptr == 0UL) || ((scsiq->q_status & ASC_QS_ABORTED) != 0)) {\n\t\t\treturn (0x11);\n\t\t} else if (scsiq->q_status == ASC_QS_DONE) {\n\t\t\tscsiq->remain_bytes += scsiq->extra_bytes;\n\n\t\t\tif (scsiq->d3.done_stat == ASC_QD_WITH_ERROR) {\n\t\t\t\tif (scsiq->d3.host_stat == ASC_QHSTA_M_DATA_OVER_RUN) {\n\t\t\t\t\tif ((scsiq->cntl & (ASC_QC_DATA_IN | ASC_QC_DATA_OUT)) == 0) {\n\t\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_NO_ERROR;\n\t\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_NO_ERROR;\n\t\t\t\t\t}\n\t\t\t\t} else if (scsiq->d3.host_stat == ASC_QHSTA_M_HUNG_REQ_SCSI_BUS_RESET) {\n\t\t\t\t\tAscStopChip(iot, ioh);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, (ASC_CC_SCSI_RESET | ASC_CC_HALT));\n\t\t\t\t\tDvcDelayNanoSecond(60000);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t(*asc_isr_callback) (sc, scsiq);\n\n\t\t\treturn (1);\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_Q_STATUS);\n\t\t\tpanic(\"AscIsrQDone: completed scsiq with unknown status\");\n\n\t\t\treturn (0x80);\n\t\t}\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscStopChip",
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static int AscIsrQDone",
      "static u_int8_t _AscCopyLramScsiDoneQ",
      "static int AscSetLibErrorCode",
      "static void DvcDelayNanoSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"AscIsrQDone: completed scsiq with unknown status\""
          ],
          "line": 1804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscSetLibErrorCode",
          "args": [
            "sc",
            "ASCQ_ERR_Q_STATUS"
          ],
          "line": 1803
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetLibErrorCode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3263-3276",
          "snippet": "static int\nAscSetLibErrorCode(sc, err_code)\n\tASC_SOFTC      *sc;\n\tu_int16_t       err_code;\n{\n\t/*\n\t * if(sc->err_code == 0) { sc->err_code = err_code;\n\t */ AscWriteLramWord(sc->sc_iot, sc->sc_ioh, ASCV_ASCDVC_ERR_CODE_W,\n\t\t\t       err_code);\n\t/*\n\t * }\n\t */\n\treturn (err_code);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord",
            "static int AscSetLibErrorCode"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\nstatic int AscSetLibErrorCode;\n\nstatic int\nAscSetLibErrorCode(sc, err_code)\n\tASC_SOFTC      *sc;\n\tu_int16_t       err_code;\n{\n\t/*\n\t * if(sc->err_code == 0) { sc->err_code = err_code;\n\t */ AscWriteLramWord(sc->sc_iot, sc->sc_ioh, ASCV_ASCDVC_ERR_CODE_W,\n\t\t\t       err_code);\n\t/*\n\t * }\n\t */\n\treturn (err_code);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "sc",
            "scsiq"
          ],
          "line": 1799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 1796
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 1795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "ASC_CIW_CLR_SCSI_RESET_INT"
          ],
          "line": 1794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "ASC_CC_HALT"
          ],
          "line": 1793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DvcDelayNanoSecond",
          "args": [
            "60000"
          ],
          "line": 1792
        },
        "resolved": true,
        "details": {
          "function_name": "DvcDelayNanoSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3462-3468",
          "snippet": "static void\nDvcDelayNanoSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY((n + 999) / 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcDelayNanoSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcDelayNanoSecond;\n\nstatic void\nDvcDelayNanoSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY((n + 999) / 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "(ASC_CC_SCSI_RESET | ASC_CC_HALT)"
          ],
          "line": 1791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscStopChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1790
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "819-835",
          "snippet": "static int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStopChip",
            "static void AscSetChipIH"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStopChip;\nstatic void AscSetChipIH;\n\nstatic int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"AscIsrQDone: Attempting to free more queues than are active\""
          ],
          "line": 1775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_SCSIBUSY_B",
            "scsi_busy"
          ],
          "line": 1763
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_SCSIBUSY_B"
          ],
          "line": 1761
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_PUT_VAR_DONE_QTAIL",
          "args": [
            "iot",
            "ioh",
            "sg_list_qp"
          ],
          "line": 1754
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"AscIsrQDone: Corrupted SG list encountered\""
          ],
          "line": 1748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "sg_list_qp"
          ],
          "line": 1743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TARGET_ID",
          "args": [
            "scsiq->d2.target_ix"
          ],
          "line": 1736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_TIX_TO_TID",
          "args": [
            "scsiq->d2.target_ix"
          ],
          "line": 1735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_AscCopyLramScsiDoneQ",
          "args": [
            "iot",
            "ioh",
            "q_addr",
            "scsiq",
            "sc->max_dma_count"
          ],
          "line": 1731
        },
        "resolved": true,
        "details": {
          "function_name": "_AscCopyLramScsiDoneQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1988-2015",
          "snippet": "static u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord",
            "static u_int8_t _AscCopyLramScsiDoneQ",
            "static void AscGetQDoneInfo"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic void AscGetQDoneInfo;\n\nstatic u_int8_t\n_AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq, max_dma_count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       q_addr;\n\tASC_QDONE_INFO *scsiq;\n\tu_int32_t       max_dma_count;\n{\n\tu_int16_t       _val;\n\tu_int8_t        sg_queue_cnt;\n\n\tAscGetQDoneInfo(iot, ioh, q_addr + ASC_SCSIQ_DONE_INFO_BEG, scsiq);\n\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_STATUS);\n\tscsiq->q_status = LO_BYTE(_val);\n\tscsiq->q_no = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_CNTL);\n\tscsiq->cntl = LO_BYTE(_val);\n\tsg_queue_cnt = HI_BYTE(_val);\n\t_val = AscReadLramWord(iot, ioh, q_addr + ASC_SCSIQ_B_SENSE_LEN);\n\tscsiq->sense_len = LO_BYTE(_val);\n\tscsiq->extra_bytes = HI_BYTE(_val);\n\tscsiq->remain_bytes = AscReadLramWord(iot, ioh,\n\t\t\t\t     q_addr + ASC_SCSIQ_DW_REMAIN_XFER_CNT);\n\tscsiq->remain_bytes &= max_dma_count;\n\n\treturn (sg_queue_cnt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "next_qp"
          ],
          "line": 1730
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_PUT_VAR_DONE_QTAIL",
          "args": [
            "iot",
            "ioh",
            "next_qp"
          ],
          "line": 1729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "done_q_tail"
          ],
          "line": 1725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_VAR_DONE_QTAIL",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1724
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStopChip;\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscIsrQDone;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic int AscSetLibErrorCode;\nstatic void DvcDelayNanoSecond;\n\nstatic int\nAscIsrQDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tu_int8_t        next_qp;\n\tu_int8_t        n_q_used;\n\tu_int8_t        sg_list_qp;\n\tu_int8_t        sg_queue_cnt;\n\tu_int8_t        q_cnt;\n\tu_int8_t        done_q_tail;\n\tu_int8_t        tid_no;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int16_t       sg_q_addr;\n\tu_int8_t        cur_target_qng;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tn_q_used = 1;\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tdone_q_tail = ASC_GET_VAR_DONE_QTAIL(iot, ioh);\n\tq_addr = ASC_QNO_TO_QADDR(done_q_tail);\n\tnext_qp = AscReadLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_FWD));\n\n\tif (next_qp != ASC_QLINK_END) {\n\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, next_qp);\n\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\t\tsg_queue_cnt = _AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq,\n\t\t\t\t\t\t     sc->max_dma_count);\n\t\tAscWriteLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_STATUS),\n\t\t      (scsiq->q_status & ~(ASC_QS_READY | ASC_QS_ABORTED)));\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->d2.target_ix);\n\t\ttarget_id = ASC_TIX_TO_TARGET_ID(scsiq->d2.target_ix);\n\t\tif ((scsiq->cntl & ASC_QC_SG_HEAD) != 0) {\n\t\t\tsg_q_addr = q_addr;\n\t\t\tsg_list_qp = next_qp;\n\t\t\tfor (q_cnt = 0; q_cnt < sg_queue_cnt; q_cnt++) {\n\t\t\t\tsg_list_qp = AscReadLramByte(iot, ioh,\n\t\t\t\t\t       sg_q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tsg_q_addr = ASC_QNO_TO_QADDR(sg_list_qp);\n\t\t\t\tif (sg_list_qp == ASC_QLINK_END) {\n\t\t\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_SG_Q_LINKS);\n\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_D_QDONE_SG_LIST_CORRUPTED;\n\t\t\t\t\tpanic(\"AscIsrQDone: Corrupted SG list encountered\");\n\t\t\t\t}\n\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\tsg_q_addr + ASC_SCSIQ_B_STATUS, ASC_QS_FREE);\n\t\t\t}\n\t\t\tn_q_used = sg_queue_cnt + 1;\n\t\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sg_list_qp);\n\t\t}\n\t\tif (sc->queue_full_or_busy & target_id) {\n\t\t\tcur_target_qng = AscReadLramByte(iot, ioh,\n\t\t\t\t\tASC_QADR_BEG + scsiq->d2.target_ix);\n\n\t\t\tif (cur_target_qng < sc->max_dvc_qng[tid_no]) {\n\t\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\t\tscsi_busy &= ~target_id;\n\t\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\t\tsc->queue_full_or_busy &= ~target_id;\n\t\t\t}\n\t\t}\n\t\tif (sc->cur_total_qng >= n_q_used) {\n\t\t\tsc->cur_total_qng -= n_q_used;\n\t\t\tif (sc->cur_dvc_qng[tid_no] != 0) {\n\t\t\t\tsc->cur_dvc_qng[tid_no]--;\n\t\t\t}\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_CUR_QNG);\n\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\tpanic(\"AscIsrQDone: Attempting to free more queues than are active\");\n\t\t}\n\n\t\tif ((scsiq->d2.ccb_ptr == 0UL) || ((scsiq->q_status & ASC_QS_ABORTED) != 0)) {\n\t\t\treturn (0x11);\n\t\t} else if (scsiq->q_status == ASC_QS_DONE) {\n\t\t\tscsiq->remain_bytes += scsiq->extra_bytes;\n\n\t\t\tif (scsiq->d3.done_stat == ASC_QD_WITH_ERROR) {\n\t\t\t\tif (scsiq->d3.host_stat == ASC_QHSTA_M_DATA_OVER_RUN) {\n\t\t\t\t\tif ((scsiq->cntl & (ASC_QC_DATA_IN | ASC_QC_DATA_OUT)) == 0) {\n\t\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_NO_ERROR;\n\t\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_NO_ERROR;\n\t\t\t\t\t}\n\t\t\t\t} else if (scsiq->d3.host_stat == ASC_QHSTA_M_HUNG_REQ_SCSI_BUS_RESET) {\n\t\t\t\t\tAscStopChip(iot, ioh);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, (ASC_CC_SCSI_RESET | ASC_CC_HALT));\n\t\t\t\t\tDvcDelayNanoSecond(60000);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t(*asc_isr_callback) (sc, scsiq);\n\n\t\t\treturn (1);\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_Q_STATUS);\n\t\t\tpanic(\"AscIsrQDone: completed scsiq with unknown status\");\n\n\t\t\treturn (0x80);\n\t\t}\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "AscISR",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1625-1695",
    "snippet": "int\nAscISR(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       chipstat;\n\tu_int16_t       saved_ram_addr;\n\tu_int8_t        ctrl_reg;\n\tu_int8_t        saved_ctrl_reg;\n\tint             int_pending;\n\tint             status;\n\tu_int8_t        host_flag;\n\n\n\tint_pending = FALSE;\n\n\tctrl_reg = ASC_GET_CHIP_CONTROL(iot, ioh);\n\tsaved_ctrl_reg = ctrl_reg & (~(ASC_CC_SCSI_RESET | ASC_CC_CHIP_RESET |\n\t\t\t   ASC_CC_SINGLE_STEP | ASC_CC_DIAG | ASC_CC_TEST));\n\tchipstat = ASC_GET_CHIP_STATUS(iot, ioh);\n\tif (chipstat & ASC_CSW_SCSI_RESET_LATCH) {\n\t\tif (!(sc->bus_type & (ASC_IS_VL | ASC_IS_EISA))) {\n\t\t\tint_pending = TRUE;\n\t\t\tsc->sdtr_done = 0;\n\t\t\tsaved_ctrl_reg &= (u_int8_t) (~ASC_CC_HALT);\n\n\t\t\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, (ASC_CC_CHIP_RESET | ASC_CC_HALT));\n\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\t\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\t\t\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\t\t\tchipstat = ASC_GET_CHIP_STATUS(iot, ioh);\n\t\t}\n\t}\n\tsaved_ram_addr = ASC_GET_CHIP_LRAM_ADDR(iot, ioh);\n\thost_flag = AscReadLramByte(iot, ioh, ASCV_HOST_FLAG_B) &\n\t\t(u_int8_t) (~ASC_HOST_FLAG_IN_ISR);\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B,\n\t\t\t (host_flag | ASC_HOST_FLAG_IN_ISR));\n\n\tif ((chipstat & ASC_CSW_INT_PENDING) || (int_pending)) {\n\t\tAscAckInterrupt(iot, ioh);\n\t\tint_pending = TRUE;\n\n\t\tif ((chipstat & ASC_CSW_HALTED) &&\n\t\t    (ctrl_reg & ASC_CC_SINGLE_STEP)) {\n\t\t\tAscIsrChipHalted(sc);\n\t\t\tsaved_ctrl_reg &= ~ASC_CC_HALT;\n\t\t} else {\n\t\t\tif (sc->dvc_cntl & ASC_CNTL_INT_MULTI_Q) {\n\t\t\t\twhile (((status = AscIsrQDone(sc)) & 0x01) != 0);\n\t\t\t} else {\n\t\t\t\tdo {\n\t\t\t\t\tif ((status = AscIsrQDone(sc)) == 1)\n\t\t\t\t\t\tbreak;\n\t\t\t\t} while (status == 0x11);\n\t\t\t}\n\n\t\t\tif (status & 0x80)\n\t\t\t\tint_pending = -1;\n\t\t}\n\t}\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B, host_flag);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, saved_ram_addr);\n\tASC_SET_CHIP_CONTROL(iot, ioh, saved_ctrl_reg);\n\n\treturn (1);\n\t/* return(int_pending); */\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static void AscIsrChipHalted",
      "static int AscIsrQDone",
      "static void AscAckInterrupt"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "saved_ctrl_reg"
          ],
          "line": 1691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "saved_ram_addr"
          ],
          "line": 1690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_HOST_FLAG_B",
            "host_flag"
          ],
          "line": 1689
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscIsrQDone",
          "args": [
            "sc"
          ],
          "line": 1680
        },
        "resolved": true,
        "details": {
          "function_name": "AscIsrQDone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1698-1810",
          "snippet": "static int\nAscIsrQDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tu_int8_t        next_qp;\n\tu_int8_t        n_q_used;\n\tu_int8_t        sg_list_qp;\n\tu_int8_t        sg_queue_cnt;\n\tu_int8_t        q_cnt;\n\tu_int8_t        done_q_tail;\n\tu_int8_t        tid_no;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int16_t       sg_q_addr;\n\tu_int8_t        cur_target_qng;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tn_q_used = 1;\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tdone_q_tail = ASC_GET_VAR_DONE_QTAIL(iot, ioh);\n\tq_addr = ASC_QNO_TO_QADDR(done_q_tail);\n\tnext_qp = AscReadLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_FWD));\n\n\tif (next_qp != ASC_QLINK_END) {\n\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, next_qp);\n\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\t\tsg_queue_cnt = _AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq,\n\t\t\t\t\t\t     sc->max_dma_count);\n\t\tAscWriteLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_STATUS),\n\t\t      (scsiq->q_status & ~(ASC_QS_READY | ASC_QS_ABORTED)));\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->d2.target_ix);\n\t\ttarget_id = ASC_TIX_TO_TARGET_ID(scsiq->d2.target_ix);\n\t\tif ((scsiq->cntl & ASC_QC_SG_HEAD) != 0) {\n\t\t\tsg_q_addr = q_addr;\n\t\t\tsg_list_qp = next_qp;\n\t\t\tfor (q_cnt = 0; q_cnt < sg_queue_cnt; q_cnt++) {\n\t\t\t\tsg_list_qp = AscReadLramByte(iot, ioh,\n\t\t\t\t\t       sg_q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tsg_q_addr = ASC_QNO_TO_QADDR(sg_list_qp);\n\t\t\t\tif (sg_list_qp == ASC_QLINK_END) {\n\t\t\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_SG_Q_LINKS);\n\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_D_QDONE_SG_LIST_CORRUPTED;\n\t\t\t\t\tpanic(\"AscIsrQDone: Corrupted SG list encountered\");\n\t\t\t\t}\n\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\tsg_q_addr + ASC_SCSIQ_B_STATUS, ASC_QS_FREE);\n\t\t\t}\n\t\t\tn_q_used = sg_queue_cnt + 1;\n\t\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sg_list_qp);\n\t\t}\n\t\tif (sc->queue_full_or_busy & target_id) {\n\t\t\tcur_target_qng = AscReadLramByte(iot, ioh,\n\t\t\t\t\tASC_QADR_BEG + scsiq->d2.target_ix);\n\n\t\t\tif (cur_target_qng < sc->max_dvc_qng[tid_no]) {\n\t\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\t\tscsi_busy &= ~target_id;\n\t\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\t\tsc->queue_full_or_busy &= ~target_id;\n\t\t\t}\n\t\t}\n\t\tif (sc->cur_total_qng >= n_q_used) {\n\t\t\tsc->cur_total_qng -= n_q_used;\n\t\t\tif (sc->cur_dvc_qng[tid_no] != 0) {\n\t\t\t\tsc->cur_dvc_qng[tid_no]--;\n\t\t\t}\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_CUR_QNG);\n\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\tpanic(\"AscIsrQDone: Attempting to free more queues than are active\");\n\t\t}\n\n\t\tif ((scsiq->d2.ccb_ptr == 0UL) || ((scsiq->q_status & ASC_QS_ABORTED) != 0)) {\n\t\t\treturn (0x11);\n\t\t} else if (scsiq->q_status == ASC_QS_DONE) {\n\t\t\tscsiq->remain_bytes += scsiq->extra_bytes;\n\n\t\t\tif (scsiq->d3.done_stat == ASC_QD_WITH_ERROR) {\n\t\t\t\tif (scsiq->d3.host_stat == ASC_QHSTA_M_DATA_OVER_RUN) {\n\t\t\t\t\tif ((scsiq->cntl & (ASC_QC_DATA_IN | ASC_QC_DATA_OUT)) == 0) {\n\t\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_NO_ERROR;\n\t\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_NO_ERROR;\n\t\t\t\t\t}\n\t\t\t\t} else if (scsiq->d3.host_stat == ASC_QHSTA_M_HUNG_REQ_SCSI_BUS_RESET) {\n\t\t\t\t\tAscStopChip(iot, ioh);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, (ASC_CC_SCSI_RESET | ASC_CC_HALT));\n\t\t\t\t\tDvcDelayNanoSecond(60000);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t(*asc_isr_callback) (sc, scsiq);\n\n\t\t\treturn (1);\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_Q_STATUS);\n\t\t\tpanic(\"AscIsrQDone: completed scsiq with unknown status\");\n\n\t\t\treturn (0x80);\n\t\t}\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStopChip",
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static int AscIsrQDone",
            "static u_int8_t _AscCopyLramScsiDoneQ",
            "static int AscSetLibErrorCode",
            "static void DvcDelayNanoSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStopChip;\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscIsrQDone;\nstatic u_int8_t _AscCopyLramScsiDoneQ;\nstatic int AscSetLibErrorCode;\nstatic void DvcDelayNanoSecond;\n\nstatic int\nAscIsrQDone(sc)\n\tASC_SOFTC      *sc;\n{\n\tu_int8_t        next_qp;\n\tu_int8_t        n_q_used;\n\tu_int8_t        sg_list_qp;\n\tu_int8_t        sg_queue_cnt;\n\tu_int8_t        q_cnt;\n\tu_int8_t        done_q_tail;\n\tu_int8_t        tid_no;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       q_addr;\n\tu_int16_t       sg_q_addr;\n\tu_int8_t        cur_target_qng;\n\tASC_QDONE_INFO  scsiq_buf;\n\tASC_QDONE_INFO *scsiq;\n\tASC_ISR_CALLBACK asc_isr_callback;\n\n\n\tasc_isr_callback = (ASC_ISR_CALLBACK) sc->isr_callback;\n\tn_q_used = 1;\n\tscsiq = (ASC_QDONE_INFO *) & scsiq_buf;\n\tdone_q_tail = ASC_GET_VAR_DONE_QTAIL(iot, ioh);\n\tq_addr = ASC_QNO_TO_QADDR(done_q_tail);\n\tnext_qp = AscReadLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_FWD));\n\n\tif (next_qp != ASC_QLINK_END) {\n\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, next_qp);\n\t\tq_addr = ASC_QNO_TO_QADDR(next_qp);\n\t\tsg_queue_cnt = _AscCopyLramScsiDoneQ(iot, ioh, q_addr, scsiq,\n\t\t\t\t\t\t     sc->max_dma_count);\n\t\tAscWriteLramByte(iot, ioh, (q_addr + ASC_SCSIQ_B_STATUS),\n\t\t      (scsiq->q_status & ~(ASC_QS_READY | ASC_QS_ABORTED)));\n\t\ttid_no = ASC_TIX_TO_TID(scsiq->d2.target_ix);\n\t\ttarget_id = ASC_TIX_TO_TARGET_ID(scsiq->d2.target_ix);\n\t\tif ((scsiq->cntl & ASC_QC_SG_HEAD) != 0) {\n\t\t\tsg_q_addr = q_addr;\n\t\t\tsg_list_qp = next_qp;\n\t\t\tfor (q_cnt = 0; q_cnt < sg_queue_cnt; q_cnt++) {\n\t\t\t\tsg_list_qp = AscReadLramByte(iot, ioh,\n\t\t\t\t\t       sg_q_addr + ASC_SCSIQ_B_FWD);\n\t\t\t\tsg_q_addr = ASC_QNO_TO_QADDR(sg_list_qp);\n\t\t\t\tif (sg_list_qp == ASC_QLINK_END) {\n\t\t\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_SG_Q_LINKS);\n\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_D_QDONE_SG_LIST_CORRUPTED;\n\t\t\t\t\tpanic(\"AscIsrQDone: Corrupted SG list encountered\");\n\t\t\t\t}\n\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\tsg_q_addr + ASC_SCSIQ_B_STATUS, ASC_QS_FREE);\n\t\t\t}\n\t\t\tn_q_used = sg_queue_cnt + 1;\n\t\t\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sg_list_qp);\n\t\t}\n\t\tif (sc->queue_full_or_busy & target_id) {\n\t\t\tcur_target_qng = AscReadLramByte(iot, ioh,\n\t\t\t\t\tASC_QADR_BEG + scsiq->d2.target_ix);\n\n\t\t\tif (cur_target_qng < sc->max_dvc_qng[tid_no]) {\n\t\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\t\tscsi_busy &= ~target_id;\n\t\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\t\tsc->queue_full_or_busy &= ~target_id;\n\t\t\t}\n\t\t}\n\t\tif (sc->cur_total_qng >= n_q_used) {\n\t\t\tsc->cur_total_qng -= n_q_used;\n\t\t\tif (sc->cur_dvc_qng[tid_no] != 0) {\n\t\t\t\tsc->cur_dvc_qng[tid_no]--;\n\t\t\t}\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_CUR_QNG);\n\t\t\tscsiq->d3.done_stat = ASC_QD_WITH_ERROR;\n\t\t\tpanic(\"AscIsrQDone: Attempting to free more queues than are active\");\n\t\t}\n\n\t\tif ((scsiq->d2.ccb_ptr == 0UL) || ((scsiq->q_status & ASC_QS_ABORTED) != 0)) {\n\t\t\treturn (0x11);\n\t\t} else if (scsiq->q_status == ASC_QS_DONE) {\n\t\t\tscsiq->remain_bytes += scsiq->extra_bytes;\n\n\t\t\tif (scsiq->d3.done_stat == ASC_QD_WITH_ERROR) {\n\t\t\t\tif (scsiq->d3.host_stat == ASC_QHSTA_M_DATA_OVER_RUN) {\n\t\t\t\t\tif ((scsiq->cntl & (ASC_QC_DATA_IN | ASC_QC_DATA_OUT)) == 0) {\n\t\t\t\t\t\tscsiq->d3.done_stat = ASC_QD_NO_ERROR;\n\t\t\t\t\t\tscsiq->d3.host_stat = ASC_QHSTA_NO_ERROR;\n\t\t\t\t\t}\n\t\t\t\t} else if (scsiq->d3.host_stat == ASC_QHSTA_M_HUNG_REQ_SCSI_BUS_RESET) {\n\t\t\t\t\tAscStopChip(iot, ioh);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, (ASC_CC_SCSI_RESET | ASC_CC_HALT));\n\t\t\t\t\tDvcDelayNanoSecond(60000);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\t\t\t\t\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\t\t\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t(*asc_isr_callback) (sc, scsiq);\n\n\t\t\treturn (1);\n\t\t} else {\n\t\t\tAscSetLibErrorCode(sc, ASCQ_ERR_Q_STATUS);\n\t\t\tpanic(\"AscIsrQDone: completed scsiq with unknown status\");\n\n\t\t\treturn (0x80);\n\t\t}\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscIsrChipHalted",
          "args": [
            "sc"
          ],
          "line": 1673
        },
        "resolved": true,
        "details": {
          "function_name": "AscIsrChipHalted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1817-1951",
          "snippet": "static void\nAscIsrChipHalted(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         out_msg;\n\tu_int16_t       int_halt_code;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        halt_qp;\n\tu_int8_t        target_ix;\n\tu_int8_t        tag_code;\n\tu_int8_t        q_status;\n\tu_int8_t        q_cntl;\n\tu_int8_t        tid_no;\n\tu_int8_t        cur_dvc_qng;\n\tu_int8_t        asyn_sdtr;\n\tu_int8_t        scsi_status;\n\tu_int8_t        sdtr_data;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\n\n\tint_halt_code = AscReadLramWord(iot, ioh, ASCV_HALTCODE_W);\n\n\thalt_qp = AscReadLramByte(iot, ioh, ASCV_CURCDB_B);\n\thalt_q_addr = ASC_QNO_TO_QADDR(halt_qp);\n\ttarget_ix = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TARGET_IX);\n\tq_cntl = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL);\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\ttarget_id = ASC_TID_TO_TARGET_ID(tid_no);\n\n\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\tasyn_sdtr = ASYN_SDTR_DATA_FIX_PCI_REV_AB;\n\t} else {\n\t\tasyn_sdtr = 0;\n\t}\n\n\tif (int_halt_code == ASC_HALT_DISABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, 0, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = 0;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_ENABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_EXTMSG_IN) {\n\t\tAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id,\n\t\t\t\t  tid_no, asyn_sdtr);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_CHK_CONDITION) {\n\t\tq_cntl |= ASC_QC_REQ_SENSE;\n\n\t\tif (sc->init_sdtr & target_id) {\n\t\t\tsc->sdtr_done &= ~target_id;\n\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      (sdtr_data & ASC_SYN_MAX_OFFSET));\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\n\t\ttag_code = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE);\n\t\ttag_code &= 0xDC;\n\n\t\tif ((sc->pci_fix_asyn_xfer & target_id) &&\n\t\t    !(sc->pci_fix_asyn_xfer_always & target_id)) {\n\t\t\ttag_code |= (ASC_TAG_FLAG_DISABLE_DISCONNECT |\n\t\t\t\t     ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX);\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE, tag_code);\n\n\t\tq_status = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS);\n\t\tq_status |= ASC_QS_READY | ASC_QS_BUSY;\n\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS, q_status);\n\n\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\tscsi_busy &= ~target_id;\n\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SDTR_REJECTED) {\n\t\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & out_msg, sizeof(EXT_MSG) >> 1);\n\n\t\tif ((out_msg.msg_type == MS_EXTEND) &&\n\t\t    (out_msg.msg_len == MS_SDTR_LEN) &&\n\t\t    (out_msg.msg_req == MS_SDTR_CODE)) {\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SS_QUEUE_FULL) {\n\t\tscsi_status = AscReadLramByte(iot, ioh,\n\t\t\t\t       halt_q_addr + ASC_SCSIQ_SCSI_STATUS);\n\t\tcur_dvc_qng = AscReadLramByte(iot, ioh, target_ix + ASC_QADR_BEG);\n\n\t\tif ((cur_dvc_qng > 0) && (sc->cur_dvc_qng[tid_no] > 0)) {\n\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\tscsi_busy |= target_id;\n\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\tsc->queue_full_or_busy |= target_id;\n\n\t\t\tif (scsi_status == SS_QUEUE_FULL) {\n\t\t\t\tif (cur_dvc_qng > ASC_MIN_TAGGED_CMD) {\n\t\t\t\t\tcur_dvc_qng -= 1;\n\t\t\t\t\tsc->max_dvc_qng[tid_no] = cur_dvc_qng;\n\n\t\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\t\t\t\t tid_no + ASCV_MAX_DVC_QNG_BEG, cur_dvc_qng);\n\n#if ASC_QUEUE_FLOW_CONTROL\n\t\t\t\t\tif ((sc->device[tid_no] != NULL) &&\n\t\t\t\t\t    (sc->device[tid_no]->queue_curr_depth > cur_dvc_qng)) {\n\t\t\t\t\t\tsc->device[tid_no]->queue_curr_depth = cur_dvc_qng;\n\t\t\t\t\t}\n#endif\t\t\t\t/* ASC_QUEUE_FLOW_CONTROL */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t}\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord",
            "static void AscMemWordCopyFromLram",
            "static void AscIsrChipHalted",
            "static void AscHandleExtMsgIn",
            "static u_int8_t AscMsgOutSDTR",
            "static void AscSetChipSDTR"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\nstatic void AscMemWordCopyFromLram;\nstatic void AscIsrChipHalted;\nstatic void AscHandleExtMsgIn;\nstatic u_int8_t AscMsgOutSDTR;\nstatic void AscSetChipSDTR;\n\nstatic void\nAscIsrChipHalted(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tEXT_MSG         out_msg;\n\tu_int16_t       int_halt_code;\n\tu_int16_t       halt_q_addr;\n\tu_int8_t        halt_qp;\n\tu_int8_t        target_ix;\n\tu_int8_t        tag_code;\n\tu_int8_t        q_status;\n\tu_int8_t        q_cntl;\n\tu_int8_t        tid_no;\n\tu_int8_t        cur_dvc_qng;\n\tu_int8_t        asyn_sdtr;\n\tu_int8_t        scsi_status;\n\tu_int8_t        sdtr_data;\n\tASC_SCSI_BIT_ID_TYPE scsi_busy;\n\tASC_SCSI_BIT_ID_TYPE target_id;\n\n\n\tint_halt_code = AscReadLramWord(iot, ioh, ASCV_HALTCODE_W);\n\n\thalt_qp = AscReadLramByte(iot, ioh, ASCV_CURCDB_B);\n\thalt_q_addr = ASC_QNO_TO_QADDR(halt_qp);\n\ttarget_ix = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TARGET_IX);\n\tq_cntl = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL);\n\ttid_no = ASC_TIX_TO_TID(target_ix);\n\ttarget_id = ASC_TID_TO_TARGET_ID(tid_no);\n\n\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\tasyn_sdtr = ASYN_SDTR_DATA_FIX_PCI_REV_AB;\n\t} else {\n\t\tasyn_sdtr = 0;\n\t}\n\n\tif (int_halt_code == ASC_HALT_DISABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, 0, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = 0;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_ENABLE_ASYN_USE_SYN_FIX) {\n\t\tif (sc->pci_fix_asyn_xfer & target_id) {\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_EXTMSG_IN) {\n\t\tAscHandleExtMsgIn(sc, halt_q_addr, q_cntl, target_id,\n\t\t\t\t  tid_no, asyn_sdtr);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_CHK_CONDITION) {\n\t\tq_cntl |= ASC_QC_REQ_SENSE;\n\n\t\tif (sc->init_sdtr & target_id) {\n\t\t\tsc->sdtr_done &= ~target_id;\n\n\t\t\tsdtr_data = ASC_GET_MCODE_INIT_SDTR_AT_ID(iot, ioh, tid_no);\n\t\t\tq_cntl |= ASC_QC_MSG_OUT;\n\t\t\tAscMsgOutSDTR(sc, sc->sdtr_period_tbl[(sdtr_data >> 4) &\n\t\t\t\t\t\t  (sc->max_sdtr_index - 1)],\n\t\t\t\t      (sdtr_data & ASC_SYN_MAX_OFFSET));\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\n\t\ttag_code = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE);\n\t\ttag_code &= 0xDC;\n\n\t\tif ((sc->pci_fix_asyn_xfer & target_id) &&\n\t\t    !(sc->pci_fix_asyn_xfer_always & target_id)) {\n\t\t\ttag_code |= (ASC_TAG_FLAG_DISABLE_DISCONNECT |\n\t\t\t\t     ASC_TAG_FLAG_DISABLE_ASYN_USE_SYN_FIX);\n\t\t}\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_TAG_CODE, tag_code);\n\n\t\tq_status = AscReadLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS);\n\t\tq_status |= ASC_QS_READY | ASC_QS_BUSY;\n\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_STATUS, q_status);\n\n\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\tscsi_busy &= ~target_id;\n\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SDTR_REJECTED) {\n\t\tAscMemWordCopyFromLram(iot, ioh, ASCV_MSGOUT_BEG,\n\t\t\t     (u_int16_t *) & out_msg, sizeof(EXT_MSG) >> 1);\n\n\t\tif ((out_msg.msg_type == MS_EXTEND) &&\n\t\t    (out_msg.msg_len == MS_SDTR_LEN) &&\n\t\t    (out_msg.msg_req == MS_SDTR_CODE)) {\n\t\t\tsc->init_sdtr &= ~target_id;\n\t\t\tsc->sdtr_done &= ~target_id;\n\t\t\tAscSetChipSDTR(iot, ioh, asyn_sdtr, tid_no);\n\t\t\tsc->sdtr_data[tid_no] = asyn_sdtr;\n\t\t}\n\t\tq_cntl &= ~ASC_QC_MSG_OUT;\n\t\tAscWriteLramByte(iot, ioh, halt_q_addr + ASC_SCSIQ_B_CNTL, q_cntl);\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t} else if (int_halt_code == ASC_HALT_SS_QUEUE_FULL) {\n\t\tscsi_status = AscReadLramByte(iot, ioh,\n\t\t\t\t       halt_q_addr + ASC_SCSIQ_SCSI_STATUS);\n\t\tcur_dvc_qng = AscReadLramByte(iot, ioh, target_ix + ASC_QADR_BEG);\n\n\t\tif ((cur_dvc_qng > 0) && (sc->cur_dvc_qng[tid_no] > 0)) {\n\t\t\tscsi_busy = AscReadLramByte(iot, ioh, ASCV_SCSIBUSY_B);\n\t\t\tscsi_busy |= target_id;\n\t\t\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, scsi_busy);\n\t\t\tsc->queue_full_or_busy |= target_id;\n\n\t\t\tif (scsi_status == SS_QUEUE_FULL) {\n\t\t\t\tif (cur_dvc_qng > ASC_MIN_TAGGED_CMD) {\n\t\t\t\t\tcur_dvc_qng -= 1;\n\t\t\t\t\tsc->max_dvc_qng[tid_no] = cur_dvc_qng;\n\n\t\t\t\t\tAscWriteLramByte(iot, ioh,\n\t\t\t\t\t\t\t tid_no + ASCV_MAX_DVC_QNG_BEG, cur_dvc_qng);\n\n#if ASC_QUEUE_FLOW_CONTROL\n\t\t\t\t\tif ((sc->device[tid_no] != NULL) &&\n\t\t\t\t\t    (sc->device[tid_no]->queue_curr_depth > cur_dvc_qng)) {\n\t\t\t\t\t\tsc->device[tid_no]->queue_curr_depth = cur_dvc_qng;\n\t\t\t\t\t}\n#endif\t\t\t\t/* ASC_QUEUE_FLOW_CONTROL */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\t}\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscAckInterrupt",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1668
        },
        "resolved": true,
        "details": {
          "function_name": "AscAckInterrupt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2161-2192",
          "snippet": "static void\nAscAckInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        host_flag;\n\tu_int8_t        risc_flag;\n\tu_int16_t       loop;\n\n\n\tloop = 0;\n\tdo {\n\t\trisc_flag = AscReadLramByte(iot, ioh, ASCV_RISC_FLAG_B);\n\t\tif (loop++ > 0x7FFF)\n\t\t\tbreak;\n\t} while ((risc_flag & ASC_RISC_FLAG_GEN_INT) != 0);\n\n\thost_flag = AscReadLramByte(iot, ioh, ASCV_HOST_FLAG_B) &\n\t\t(~ASC_HOST_FLAG_ACK_INT);\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B,\n\t\t\t host_flag | ASC_HOST_FLAG_ACK_INT);\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\n\tloop = 0;\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_INT_PENDING) {\n\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\t\tif (loop++ > 3)\n\t\t\tbreak;\n\t}\n\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B, host_flag);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void AscAckInterrupt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscAckInterrupt;\n\nstatic void\nAscAckInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        host_flag;\n\tu_int8_t        risc_flag;\n\tu_int16_t       loop;\n\n\n\tloop = 0;\n\tdo {\n\t\trisc_flag = AscReadLramByte(iot, ioh, ASCV_RISC_FLAG_B);\n\t\tif (loop++ > 0x7FFF)\n\t\t\tbreak;\n\t} while ((risc_flag & ASC_RISC_FLAG_GEN_INT) != 0);\n\n\thost_flag = AscReadLramByte(iot, ioh, ASCV_HOST_FLAG_B) &\n\t\t(~ASC_HOST_FLAG_ACK_INT);\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B,\n\t\t\t host_flag | ASC_HOST_FLAG_ACK_INT);\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\n\tloop = 0;\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_INT_PENDING) {\n\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_INT_ACK);\n\t\tif (loop++ > 3)\n\t\t\tbreak;\n\t}\n\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B, host_flag);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "~ASC_HOST_FLAG_IN_ISR"
          ],
          "line": 1663
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_HOST_FLAG_B"
          ],
          "line": 1662
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 1657
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "ASC_CIW_CLR_SCSI_RESET_INT"
          ],
          "line": 1656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "ASC_CC_HALT"
          ],
          "line": 1655
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "(ASC_CC_CHIP_RESET | ASC_CC_HALT)"
          ],
          "line": 1654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "~ASC_CC_HALT"
          ],
          "line": 1650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1645
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1642
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void AscIsrChipHalted;\nstatic int AscIsrQDone;\nstatic void AscAckInterrupt;\n\nint\nAscISR(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       chipstat;\n\tu_int16_t       saved_ram_addr;\n\tu_int8_t        ctrl_reg;\n\tu_int8_t        saved_ctrl_reg;\n\tint             int_pending;\n\tint             status;\n\tu_int8_t        host_flag;\n\n\n\tint_pending = FALSE;\n\n\tctrl_reg = ASC_GET_CHIP_CONTROL(iot, ioh);\n\tsaved_ctrl_reg = ctrl_reg & (~(ASC_CC_SCSI_RESET | ASC_CC_CHIP_RESET |\n\t\t\t   ASC_CC_SINGLE_STEP | ASC_CC_DIAG | ASC_CC_TEST));\n\tchipstat = ASC_GET_CHIP_STATUS(iot, ioh);\n\tif (chipstat & ASC_CSW_SCSI_RESET_LATCH) {\n\t\tif (!(sc->bus_type & (ASC_IS_VL | ASC_IS_EISA))) {\n\t\t\tint_pending = TRUE;\n\t\t\tsc->sdtr_done = 0;\n\t\t\tsaved_ctrl_reg &= (u_int8_t) (~ASC_CC_HALT);\n\n\t\t\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, (ASC_CC_CHIP_RESET | ASC_CC_HALT));\n\t\t\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\t\t\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\t\t\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\t\t\tchipstat = ASC_GET_CHIP_STATUS(iot, ioh);\n\t\t}\n\t}\n\tsaved_ram_addr = ASC_GET_CHIP_LRAM_ADDR(iot, ioh);\n\thost_flag = AscReadLramByte(iot, ioh, ASCV_HOST_FLAG_B) &\n\t\t(u_int8_t) (~ASC_HOST_FLAG_IN_ISR);\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B,\n\t\t\t (host_flag | ASC_HOST_FLAG_IN_ISR));\n\n\tif ((chipstat & ASC_CSW_INT_PENDING) || (int_pending)) {\n\t\tAscAckInterrupt(iot, ioh);\n\t\tint_pending = TRUE;\n\n\t\tif ((chipstat & ASC_CSW_HALTED) &&\n\t\t    (ctrl_reg & ASC_CC_SINGLE_STEP)) {\n\t\t\tAscIsrChipHalted(sc);\n\t\t\tsaved_ctrl_reg &= ~ASC_CC_HALT;\n\t\t} else {\n\t\t\tif (sc->dvc_cntl & ASC_CNTL_INT_MULTI_Q) {\n\t\t\t\twhile (((status = AscIsrQDone(sc)) & 0x01) != 0);\n\t\t\t} else {\n\t\t\t\tdo {\n\t\t\t\t\tif ((status = AscIsrQDone(sc)) == 1)\n\t\t\t\t\t\tbreak;\n\t\t\t\t} while (status == 0x11);\n\t\t\t}\n\n\t\t\tif (status & 0x80)\n\t\t\t\tint_pending = -1;\n\t\t}\n\t}\n\tAscWriteLramByte(iot, ioh, ASCV_HOST_FLAG_B, host_flag);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, saved_ram_addr);\n\tASC_SET_CHIP_CONTROL(iot, ioh, saved_ctrl_reg);\n\n\treturn (1);\n\t/* return(int_pending); */\n}"
  },
  {
    "function_name": "AscPrintEEPConfig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1578-1616",
    "snippet": "static void\nAscPrintEEPConfig(eep_config, chksum)\n\tASCEEP_CONFIG\t*eep_config;\n\tu_int16_t\tchksum;\n{\n\tprintf(\"---- ASC EEprom settings ----\\n\");\n\tprintf(\"cfg_lsw = 0x%x\\n\", eep_config->cfg_lsw);\n\tprintf(\"cfg_msw = 0x%x\\n\", eep_config->cfg_msw);\n\tprintf(\"init_sdtr = 0x%x\\n\", eep_config->init_sdtr);\n\tprintf(\"disc_enable = 0x%x\\n\", eep_config->disc_enable);\n\tprintf(\"use_cmd_qng = %d\\n\", eep_config->use_cmd_qng);\n\tprintf(\"start_motor = 0x%x\\n\", eep_config->start_motor);\n\tprintf(\"max_total_qng = 0x%x\\n\", eep_config->max_total_qng);\n\tprintf(\"max_tag_qng = 0x%x\\n\", eep_config->max_tag_qng);\n\tprintf(\"bios_scan = 0x%x\\n\", eep_config->bios_scan);\n\tprintf(\"power_up_wait = 0x%x\\n\", eep_config->power_up_wait);\n\tprintf(\"no_scam = %d\\n\", eep_config->no_scam);\n\tprintf(\"chip_scsi_id = %d\\n\", eep_config->chip_scsi_id);\n\tprintf(\"isa_dma_speed = %d\\n\", eep_config->isa_dma_speed);\n\tprintf(\"cntl = 0x%x\\n\", eep_config->cntl);\n#if BYTE_ORDER == BIG_ENDIAN\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[5]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[4]);\n#else\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[4]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[5]);\n#endif\n\tprintf(\"checksum = 0x%x\\n\", eep_config->chksum);\n\tprintf(\"calculated checksum = 0x%x\\n\", chksum);\n\tprintf(\"-----------------------------\\n\");\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"-----------------------------\\n\""
          ],
          "line": 1615
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\nAscPrintEEPConfig(eep_config, chksum)\n\tASCEEP_CONFIG\t*eep_config;\n\tu_int16_t\tchksum;\n{\n\tprintf(\"---- ASC EEprom settings ----\\n\");\n\tprintf(\"cfg_lsw = 0x%x\\n\", eep_config->cfg_lsw);\n\tprintf(\"cfg_msw = 0x%x\\n\", eep_config->cfg_msw);\n\tprintf(\"init_sdtr = 0x%x\\n\", eep_config->init_sdtr);\n\tprintf(\"disc_enable = 0x%x\\n\", eep_config->disc_enable);\n\tprintf(\"use_cmd_qng = %d\\n\", eep_config->use_cmd_qng);\n\tprintf(\"start_motor = 0x%x\\n\", eep_config->start_motor);\n\tprintf(\"max_total_qng = 0x%x\\n\", eep_config->max_total_qng);\n\tprintf(\"max_tag_qng = 0x%x\\n\", eep_config->max_tag_qng);\n\tprintf(\"bios_scan = 0x%x\\n\", eep_config->bios_scan);\n\tprintf(\"power_up_wait = 0x%x\\n\", eep_config->power_up_wait);\n\tprintf(\"no_scam = %d\\n\", eep_config->no_scam);\n\tprintf(\"chip_scsi_id = %d\\n\", eep_config->chip_scsi_id);\n\tprintf(\"isa_dma_speed = %d\\n\", eep_config->isa_dma_speed);\n\tprintf(\"cntl = 0x%x\\n\", eep_config->cntl);\n#if BYTE_ORDER == BIG_ENDIAN\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[5]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[4]);\n#else\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[4]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[5]);\n#endif\n\tprintf(\"checksum = 0x%x\\n\", eep_config->chksum);\n\tprintf(\"calculated checksum = 0x%x\\n\", chksum);\n\tprintf(\"-----------------------------\\n\");\n}"
  },
  {
    "function_name": "AscSetEEPConfigOnce",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1520-1574",
    "snippet": "static int\nAscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             n_error;\n\tu_int16_t      *wbuf;\n\tu_int16_t       sum;\n\tint             s_addr;\n\tint             cfg_beg;\n\tint             cfg_end;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tn_error = 0;\n\tsum = 0;\n\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\t*wbuf = sum;\n\tif (sum != AscWriteEEPWord(iot, ioh, s_addr, sum))\n\t\tn_error++;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= cfg_end; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\treturn (n_error);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscReadEEPWord",
      "static u_int16_t AscWriteEEPWord",
      "static int AscSetEEPConfigOnce"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscReadEEPWord",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1569
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadEEPWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1405-1423",
          "snippet": "static u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPCmdReg",
            "static void AscWaitEEPRead",
            "static u_int16_t AscReadEEPWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void AscWaitEEPRead;\nstatic u_int16_t AscReadEEPWord;\n\nstatic u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteEEPWord",
          "args": [
            "iot",
            "ioh",
            "s_addr",
            "sum"
          ],
          "line": 1559
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteEEPWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1426-1448",
          "snippet": "static u_int16_t\nAscWriteEEPWord(iot, ioh, addr, word_val)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n\tu_int16_t       word_val;\n{\n\tu_int16_t       read_wval;\n\n\tread_wval = AscReadEEPWord(iot, ioh, addr);\n\tif (read_wval != word_val) {\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_ABLE);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPDataReg(iot, ioh, word_val);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE | addr);\n\t\tAscWaitEEPWrite();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\t\tAscWaitEEPRead();\n\t\treturn (AscReadEEPWord(iot, ioh, addr));\n\t}\n\treturn (read_wval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPCmdReg",
            "static int AscWriteEEPDataReg",
            "static void AscWaitEEPRead",
            "static void AscWaitEEPWrite",
            "static u_int16_t AscReadEEPWord",
            "static u_int16_t AscWriteEEPWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic int AscWriteEEPDataReg;\nstatic void AscWaitEEPRead;\nstatic void AscWaitEEPWrite;\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscWriteEEPWord;\n\nstatic u_int16_t\nAscWriteEEPWord(iot, ioh, addr, word_val)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n\tu_int16_t       word_val;\n{\n\tu_int16_t       read_wval;\n\n\tread_wval = AscReadEEPWord(iot, ioh, addr);\n\tif (read_wval != word_val) {\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_ABLE);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPDataReg(iot, ioh, word_val);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE | addr);\n\t\tAscWaitEEPWrite();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\t\tAscWaitEEPRead();\n\t\treturn (AscReadEEPWord(iot, ioh, addr));\n\t}\n\treturn (read_wval);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscWriteEEPWord;\nstatic int AscSetEEPConfigOnce;\n\nstatic int\nAscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             n_error;\n\tu_int16_t      *wbuf;\n\tu_int16_t       sum;\n\tint             s_addr;\n\tint             cfg_beg;\n\tint             cfg_end;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tn_error = 0;\n\tsum = 0;\n\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\t*wbuf = sum;\n\tif (sum != AscWriteEEPWord(iot, ioh, s_addr, sum))\n\t\tn_error++;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= cfg_end; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\treturn (n_error);\n}"
  },
  {
    "function_name": "AscSetEEPConfig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1497-1517",
    "snippet": "static int\nAscSetEEPConfig(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             retry;\n\tint             n_error;\n\n\tretry = 0;\n\twhile (TRUE) {\n\t\tif ((n_error = AscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)) == 0)\n\t\t\tbreak;\n\n\t\tif (++retry > ASC_EEP_MAX_RETRY)\n\t\t\tbreak;\n\t}\n\n\treturn (n_error);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscSetEEPConfig",
      "static int AscSetEEPConfigOnce"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetEEPConfigOnce",
          "args": [
            "iot",
            "ioh",
            "cfg_buf",
            "bus_type"
          ],
          "line": 1509
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetEEPConfigOnce",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1520-1574",
          "snippet": "static int\nAscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             n_error;\n\tu_int16_t      *wbuf;\n\tu_int16_t       sum;\n\tint             s_addr;\n\tint             cfg_beg;\n\tint             cfg_end;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tn_error = 0;\n\tsum = 0;\n\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\t*wbuf = sum;\n\tif (sum != AscWriteEEPWord(iot, ioh, s_addr, sum))\n\t\tn_error++;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= cfg_end; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\treturn (n_error);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadEEPWord",
            "static u_int16_t AscWriteEEPWord",
            "static int AscSetEEPConfigOnce"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscWriteEEPWord;\nstatic int AscSetEEPConfigOnce;\n\nstatic int\nAscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             n_error;\n\tu_int16_t      *wbuf;\n\tu_int16_t       sum;\n\tint             s_addr;\n\tint             cfg_beg;\n\tint             cfg_end;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tn_error = 0;\n\tsum = 0;\n\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\t*wbuf = sum;\n\tif (sum != AscWriteEEPWord(iot, ioh, s_addr, sum))\n\t\tn_error++;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= cfg_end; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\treturn (n_error);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscSetEEPConfig;\nstatic int AscSetEEPConfigOnce;\n\nstatic int\nAscSetEEPConfig(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             retry;\n\tint             n_error;\n\n\tretry = 0;\n\twhile (TRUE) {\n\t\tif ((n_error = AscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)) == 0)\n\t\t\tbreak;\n\n\t\tif (++retry > ASC_EEP_MAX_RETRY)\n\t\t\tbreak;\n\t}\n\n\treturn (n_error);\n}"
  },
  {
    "function_name": "AscGetEEPConfig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1451-1494",
    "snippet": "static u_int16_t\nAscGetEEPConfig(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       wval;\n\tu_int16_t       sum;\n\tu_int16_t      *wbuf;\n\tint             cfg_beg;\n\tint             cfg_end;\n\tint             s_addr;\n\tint             isa_pnp_wsize;\n\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tsum = 0;\n\tisa_pnp_wsize = 0;\n\n\tfor (s_addr = 0; s_addr < (2 + isa_pnp_wsize); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\t*wbuf = AscReadEEPWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscReadEEPWord",
      "static u_int16_t AscGetEEPConfig"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscReadEEPWord",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1491
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadEEPWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1405-1423",
          "snippet": "static u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPCmdReg",
            "static void AscWaitEEPRead",
            "static u_int16_t AscReadEEPWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void AscWaitEEPRead;\nstatic u_int16_t AscReadEEPWord;\n\nstatic u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscGetEEPConfig;\n\nstatic u_int16_t\nAscGetEEPConfig(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       wval;\n\tu_int16_t       sum;\n\tu_int16_t      *wbuf;\n\tint             cfg_beg;\n\tint             cfg_end;\n\tint             s_addr;\n\tint             isa_pnp_wsize;\n\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tsum = 0;\n\tisa_pnp_wsize = 0;\n\n\tfor (s_addr = 0; s_addr < (2 + isa_pnp_wsize); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\t*wbuf = AscReadEEPWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}"
  },
  {
    "function_name": "AscWriteEEPWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1426-1448",
    "snippet": "static u_int16_t\nAscWriteEEPWord(iot, ioh, addr, word_val)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n\tu_int16_t       word_val;\n{\n\tu_int16_t       read_wval;\n\n\tread_wval = AscReadEEPWord(iot, ioh, addr);\n\tif (read_wval != word_val) {\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_ABLE);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPDataReg(iot, ioh, word_val);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE | addr);\n\t\tAscWaitEEPWrite();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\t\tAscWaitEEPRead();\n\t\treturn (AscReadEEPWord(iot, ioh, addr));\n\t}\n\treturn (read_wval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWriteEEPCmdReg",
      "static int AscWriteEEPDataReg",
      "static void AscWaitEEPRead",
      "static void AscWaitEEPWrite",
      "static u_int16_t AscReadEEPWord",
      "static u_int16_t AscWriteEEPWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscReadEEPWord",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 1445
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadEEPWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1405-1423",
          "snippet": "static u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPCmdReg",
            "static void AscWaitEEPRead",
            "static u_int16_t AscReadEEPWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void AscWaitEEPRead;\nstatic u_int16_t AscReadEEPWord;\n\nstatic u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWaitEEPRead",
          "args": [],
          "line": 1444
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitEEPRead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1389-1394",
          "snippet": "static void\nAscWaitEEPRead(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWaitEEPRead",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWaitEEPRead;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscWaitEEPRead(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteEEPCmdReg",
          "args": [
            "iot",
            "ioh",
            "ASC_EEP_CMD_WRITE_DISABLE"
          ],
          "line": 1443
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteEEPCmdReg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1342-1363",
          "snippet": "static int\nAscWriteEEPCmdReg(iot, ioh, cmd_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        cmd_reg;\n{\n\tu_int8_t        read_back;\n\tint             retry;\n\n\tretry = 0;\n\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_CMD(iot, ioh, cmd_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_CMD(iot, ioh);\n\t\tif (read_back == cmd_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPCmdReg",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWriteEEPCmdReg(iot, ioh, cmd_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        cmd_reg;\n{\n\tu_int8_t        read_back;\n\tint             retry;\n\n\tretry = 0;\n\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_CMD(iot, ioh, cmd_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_CMD(iot, ioh);\n\t\tif (read_back == cmd_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWaitEEPWrite",
          "args": [],
          "line": 1442
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitEEPWrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1397-1402",
          "snippet": "static void\nAscWaitEEPWrite(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWaitEEPWrite",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWaitEEPWrite;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscWaitEEPWrite(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteEEPDataReg",
          "args": [
            "iot",
            "ioh",
            "word_val"
          ],
          "line": 1439
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteEEPDataReg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1366-1386",
          "snippet": "static int\nAscWriteEEPDataReg(iot, ioh, data_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       data_reg;\n{\n\tu_int16_t       read_back;\n\tint             retry;\n\n\tretry = 0;\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_DATA(iot, ioh, data_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\t\tif (read_back == data_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPDataReg",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPDataReg;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWriteEEPDataReg(iot, ioh, data_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       data_reg;\n{\n\tu_int16_t       read_back;\n\tint             retry;\n\n\tretry = 0;\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_DATA(iot, ioh, data_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\t\tif (read_back == data_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic int AscWriteEEPDataReg;\nstatic void AscWaitEEPRead;\nstatic void AscWaitEEPWrite;\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscWriteEEPWord;\n\nstatic u_int16_t\nAscWriteEEPWord(iot, ioh, addr, word_val)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n\tu_int16_t       word_val;\n{\n\tu_int16_t       read_wval;\n\n\tread_wval = AscReadEEPWord(iot, ioh, addr);\n\tif (read_wval != word_val) {\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_ABLE);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPDataReg(iot, ioh, word_val);\n\t\tAscWaitEEPRead();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE | addr);\n\t\tAscWaitEEPWrite();\n\t\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\t\tAscWaitEEPRead();\n\t\treturn (AscReadEEPWord(iot, ioh, addr));\n\t}\n\treturn (read_wval);\n}"
  },
  {
    "function_name": "AscReadEEPWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1405-1423",
    "snippet": "static u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWriteEEPCmdReg",
      "static void AscWaitEEPRead",
      "static u_int16_t AscReadEEPWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWaitEEPRead",
          "args": [],
          "line": 1420
        },
        "resolved": true,
        "details": {
          "function_name": "AscWaitEEPRead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1389-1394",
          "snippet": "static void\nAscWaitEEPRead(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWaitEEPRead",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWaitEEPRead;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscWaitEEPRead(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_EEP_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscWriteEEPCmdReg",
          "args": [
            "iot",
            "ioh",
            "cmd_reg"
          ],
          "line": 1417
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteEEPCmdReg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1342-1363",
          "snippet": "static int\nAscWriteEEPCmdReg(iot, ioh, cmd_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        cmd_reg;\n{\n\tu_int8_t        read_back;\n\tint             retry;\n\n\tretry = 0;\n\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_CMD(iot, ioh, cmd_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_CMD(iot, ioh);\n\t\tif (read_back == cmd_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscWriteEEPCmdReg",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWriteEEPCmdReg(iot, ioh, cmd_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        cmd_reg;\n{\n\tu_int8_t        read_back;\n\tint             retry;\n\n\tretry = 0;\n\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_CMD(iot, ioh, cmd_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_CMD(iot, ioh);\n\t\tif (read_back == cmd_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void AscWaitEEPRead;\nstatic u_int16_t AscReadEEPWord;\n\nstatic u_int16_t\nAscReadEEPWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        addr;\n{\n\tu_int16_t       read_wval;\n\tu_int8_t        cmd_reg;\n\n\tAscWriteEEPCmdReg(iot, ioh, ASC_EEP_CMD_WRITE_DISABLE);\n\tAscWaitEEPRead();\n\tcmd_reg = addr | ASC_EEP_CMD_READ;\n\tAscWriteEEPCmdReg(iot, ioh, cmd_reg);\n\tAscWaitEEPRead();\n\tread_wval = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\tAscWaitEEPRead();\n\n\treturn (read_wval);\n}"
  },
  {
    "function_name": "AscWaitEEPWrite",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1397-1402",
    "snippet": "static void\nAscWaitEEPWrite(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWaitEEPWrite",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "1"
          ],
          "line": 1401
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWaitEEPWrite;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscWaitEEPWrite(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}"
  },
  {
    "function_name": "AscWaitEEPRead",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1389-1394",
    "snippet": "static void\nAscWaitEEPRead(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWaitEEPRead",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "1"
          ],
          "line": 1393
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWaitEEPRead;\nstatic void DvcSleepMilliSecond;\n\nstatic void\nAscWaitEEPRead(void)\n{\n\n\tDvcSleepMilliSecond(1);\n}"
  },
  {
    "function_name": "AscWriteEEPDataReg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1366-1386",
    "snippet": "static int\nAscWriteEEPDataReg(iot, ioh, data_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       data_reg;\n{\n\tu_int16_t       read_back;\n\tint             retry;\n\n\tretry = 0;\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_DATA(iot, ioh, data_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\t\tif (read_back == data_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWriteEEPDataReg",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_EEP_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "1"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_EEP_DATA",
          "args": [
            "iot",
            "ioh",
            "data_reg"
          ],
          "line": 1377
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPDataReg;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWriteEEPDataReg(iot, ioh, data_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       data_reg;\n{\n\tu_int16_t       read_back;\n\tint             retry;\n\n\tretry = 0;\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_DATA(iot, ioh, data_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_DATA(iot, ioh);\n\t\tif (read_back == data_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "AscWriteEEPCmdReg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1342-1363",
    "snippet": "static int\nAscWriteEEPCmdReg(iot, ioh, cmd_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        cmd_reg;\n{\n\tu_int8_t        read_back;\n\tint             retry;\n\n\tretry = 0;\n\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_CMD(iot, ioh, cmd_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_CMD(iot, ioh);\n\t\tif (read_back == cmd_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscWriteEEPCmdReg",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_EEP_CMD",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "1"
          ],
          "line": 1355
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_EEP_CMD",
          "args": [
            "iot",
            "ioh",
            "cmd_reg"
          ],
          "line": 1354
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscWriteEEPCmdReg;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscWriteEEPCmdReg(iot, ioh, cmd_reg)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        cmd_reg;\n{\n\tu_int8_t        read_back;\n\tint             retry;\n\n\tretry = 0;\n\n\twhile (TRUE) {\n\t\tASC_SET_CHIP_EEP_CMD(iot, ioh, cmd_reg);\n\t\tDvcSleepMilliSecond(1);\n\t\tread_back = ASC_GET_CHIP_EEP_CMD(iot, ioh);\n\t\tif (read_back == cmd_reg)\n\t\t\treturn (1);\n\n\t\tif (retry++ > ASC_EEP_MAX_RETRY)\n\t\t\treturn (0);\n\t}\n}"
  },
  {
    "function_name": "AscGetSGList",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1319-1334",
    "snippet": "static u_int32_t\nAscGetSGList(sc, buf_addr, buf_len, asc_sg_head_ptr)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_len;\n\tASC_SG_HEAD    *asc_sg_head_ptr;\n{\n\tu_int32_t       buf_size;\n\n\tbuf_size = buf_len;\n\tasc_sg_head_ptr->entry_cnt = 1;\n\tasc_sg_head_ptr->sg_list[0].addr = (u_int32_t) buf_addr;\n\tasc_sg_head_ptr->sg_list[0].bytes = buf_size;\n\n\treturn (buf_size);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int32_t AscGetSGList"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscGetSGList;\n\nstatic u_int32_t\nAscGetSGList(sc, buf_addr, buf_len, asc_sg_head_ptr)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_len;\n\tASC_SG_HEAD    *asc_sg_head_ptr;\n{\n\tu_int32_t       buf_size;\n\n\tbuf_size = buf_len;\n\tasc_sg_head_ptr->entry_cnt = 1;\n\tasc_sg_head_ptr->sg_list[0].addr = (u_int32_t) buf_addr;\n\tasc_sg_head_ptr->sg_list[0].bytes = buf_size;\n\n\treturn (buf_size);\n}"
  },
  {
    "function_name": "AscGetOnePhyAddr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1299-1316",
    "snippet": "static u_int32_t\nAscGetOnePhyAddr(sc, buf_addr, buf_size)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_size;\n{\n\tASC_MIN_SG_HEAD sg_head;\n\n\tsg_head.entry_cnt = ASC_MIN_SG_LIST;\n\tif (AscGetSGList(sc, buf_addr, buf_size, (ASC_SG_HEAD *) & sg_head) !=\n\t    buf_size) {\n\t\treturn (0L);\n\t}\n\tif (sg_head.entry_cnt > 1) {\n\t\treturn (0L);\n\t}\n\treturn (sg_head.sg_list[0].addr);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int32_t AscGetOnePhyAddr",
      "static u_int32_t AscGetSGList"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscGetSGList",
          "args": [
            "sc",
            "buf_addr",
            "buf_size",
            "(ASC_SG_HEAD *) & sg_head"
          ],
          "line": 1308
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetSGList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1319-1334",
          "snippet": "static u_int32_t\nAscGetSGList(sc, buf_addr, buf_len, asc_sg_head_ptr)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_len;\n\tASC_SG_HEAD    *asc_sg_head_ptr;\n{\n\tu_int32_t       buf_size;\n\n\tbuf_size = buf_len;\n\tasc_sg_head_ptr->entry_cnt = 1;\n\tasc_sg_head_ptr->sg_list[0].addr = (u_int32_t) buf_addr;\n\tasc_sg_head_ptr->sg_list[0].bytes = buf_size;\n\n\treturn (buf_size);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int32_t AscGetSGList"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscGetSGList;\n\nstatic u_int32_t\nAscGetSGList(sc, buf_addr, buf_len, asc_sg_head_ptr)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_len;\n\tASC_SG_HEAD    *asc_sg_head_ptr;\n{\n\tu_int32_t       buf_size;\n\n\tbuf_size = buf_len;\n\tasc_sg_head_ptr->entry_cnt = 1;\n\tasc_sg_head_ptr->sg_list[0].addr = (u_int32_t) buf_addr;\n\tasc_sg_head_ptr->sg_list[0].bytes = buf_size;\n\n\treturn (buf_size);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscGetOnePhyAddr;\nstatic u_int32_t AscGetSGList;\n\nstatic u_int32_t\nAscGetOnePhyAddr(sc, buf_addr, buf_size)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_size;\n{\n\tASC_MIN_SG_HEAD sg_head;\n\n\tsg_head.entry_cnt = ASC_MIN_SG_LIST;\n\tif (AscGetSGList(sc, buf_addr, buf_size, (ASC_SG_HEAD *) & sg_head) !=\n\t    buf_size) {\n\t\treturn (0L);\n\t}\n\tif (sg_head.entry_cnt > 1) {\n\t\treturn (0L);\n\t}\n\treturn (sg_head.sg_list[0].addr);\n}"
  },
  {
    "function_name": "AscLoadMicroCode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1272-1296",
    "snippet": "static u_int32_t\nAscLoadMicroCode(iot, ioh, s_addr, mcode_buf, mcode_size)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *mcode_buf;\n\tu_int16_t       mcode_size;\n{\n\tu_int32_t       chksum;\n\tu_int16_t       mcode_word_size;\n\tu_int16_t       mcode_chksum;\n\n\tmcode_word_size = mcode_size >> 1;\n\t/* clear board memory */\n\tAscMemWordSetLram(iot, ioh, s_addr, 0, mcode_word_size);\n\t/* copy uCode to board memory */\n\tAscMemWordCopyToLram(iot, ioh, s_addr, mcode_buf, mcode_word_size);\n\tchksum = AscMemSumLramWord(iot, ioh, s_addr, mcode_word_size);\n\tmcode_chksum = AscMemSumLramWord(iot, ioh, ASC_CODE_SEC_BEG,\n\t\t\t   ((mcode_size - s_addr - ASC_CODE_SEC_BEG) >> 1));\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_CHKSUM_W, mcode_chksum);\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_SIZE_W, mcode_size);\n\n\treturn (chksum);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int32_t AscLoadMicroCode",
      "static void AscWriteLramWord",
      "static void AscMemWordSetLram",
      "static void AscMemWordCopyToLram",
      "static u_int32_t AscMemSumLramWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "ASCV_MCODE_SIZE_W",
            "mcode_size"
          ],
          "line": 1293
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemSumLramWord",
          "args": [
            "iot",
            "ioh",
            "ASC_CODE_SEC_BEG",
            "((mcode_size - s_addr - ASC_CODE_SEC_BEG) >> 1)"
          ],
          "line": 1290
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemSumLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1180-1195",
          "snippet": "static u_int32_t\nAscMemSumLramWord(iot, ioh, s_addr, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tint             words;\n{\n\tu_int32_t       sum = 0L;\n\tu_int16_t       i;\n\n\n\tfor (i = 0; i < words; i++, s_addr += 2)\n\t\tsum += AscReadLramWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord",
            "static u_int32_t AscMemSumLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic u_int32_t AscMemSumLramWord;\n\nstatic u_int32_t\nAscMemSumLramWord(iot, ioh, s_addr, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tint             words;\n{\n\tu_int32_t       sum = 0L;\n\tu_int16_t       i;\n\n\n\tfor (i = 0; i < words; i++, s_addr += 2)\n\t\tsum += AscReadLramWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordCopyToLram",
          "args": [
            "iot",
            "ioh",
            "s_addr",
            "mcode_buf",
            "mcode_word_size"
          ],
          "line": 1288
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordCopyToLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1126-1139",
          "snippet": "static void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordCopyToLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\n\nstatic void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscMemWordSetLram",
          "args": [
            "iot",
            "ioh",
            "s_addr",
            "0",
            "mcode_word_size"
          ],
          "line": 1286
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordSetLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1110-1123",
          "snippet": "static void\nAscMemWordSetLram(iot, ioh, s_addr, s_words, count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t       s_words;\n\tint             count;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < count; i++)\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, s_words);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordSetLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordSetLram;\n\nstatic void\nAscMemWordSetLram(iot, ioh, s_addr, s_words, count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t       s_words;\n\tint             count;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < count; i++)\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, s_words);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscLoadMicroCode;\nstatic void AscWriteLramWord;\nstatic void AscMemWordSetLram;\nstatic void AscMemWordCopyToLram;\nstatic u_int32_t AscMemSumLramWord;\n\nstatic u_int32_t\nAscLoadMicroCode(iot, ioh, s_addr, mcode_buf, mcode_size)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *mcode_buf;\n\tu_int16_t       mcode_size;\n{\n\tu_int32_t       chksum;\n\tu_int16_t       mcode_word_size;\n\tu_int16_t       mcode_chksum;\n\n\tmcode_word_size = mcode_size >> 1;\n\t/* clear board memory */\n\tAscMemWordSetLram(iot, ioh, s_addr, 0, mcode_word_size);\n\t/* copy uCode to board memory */\n\tAscMemWordCopyToLram(iot, ioh, s_addr, mcode_buf, mcode_word_size);\n\tchksum = AscMemSumLramWord(iot, ioh, s_addr, mcode_word_size);\n\tmcode_chksum = AscMemSumLramWord(iot, ioh, ASC_CODE_SEC_BEG,\n\t\t\t   ((mcode_size - s_addr - ASC_CODE_SEC_BEG) >> 1));\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_CHKSUM_W, mcode_chksum);\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_SIZE_W, mcode_size);\n\n\treturn (chksum);\n}"
  },
  {
    "function_name": "AscInitMicroCodeVar",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1229-1269",
    "snippet": "static u_int16_t\nAscInitMicroCodeVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int32_t       phy_addr;\n\tint             i;\n\n\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tASC_PUT_MCODE_INIT_SDTR_AT_ID(iot, ioh, i,\n\t\t\t\t\t      sc->sdtr_period_offset[i]);\n\n\tAscInitQLinkVar(sc);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC_ENABLE_B, sc->disc_enable);\n\tAscWriteLramByte(iot, ioh, ASCV_HOSTSCSI_ID_B,\n\t\t\t ASC_TID_TO_TARGET_ID(sc->chip_scsi_id));\n\n\tif ((phy_addr = AscGetOnePhyAddr(sc, sc->overrun_buf,\n\t\t\t\t\t ASC_OVERRUN_BSIZE)) == 0L) {\n\t\treturn (0);\n\t} else {\n\t\tphy_addr = (phy_addr & 0xFFFFFFF8ul) + 8;\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_PADDR_D, phy_addr);\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_BSIZE_D,\n\t\t\t\t  ASC_OVERRUN_BSIZE - 8);\n\t}\n\n\tsc->mcode_date = AscReadLramWord(iot, ioh, ASCV_MC_DATE_W);\n\tsc->mcode_version = AscReadLramWord(iot, ioh, ASCV_MC_VER_W);\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR) {\n\t\treturn (0);\n\t}\n\tif (AscStartChip(iot, ioh) != 1) {\n\t\treturn (0);\n\t}\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscInitQLinkVar",
      "static int AscStartChip",
      "static void AscWriteLramByte",
      "static u_int16_t AscReadLramWord",
      "static void AscWriteLramDWord",
      "static u_int16_t AscInitMicroCodeVar",
      "static u_int32_t AscGetOnePhyAddr"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscStartChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1265
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "806-816",
          "snippet": "static int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStartChip"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\n\nstatic int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_PC_ADDR",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_PC_ADDR",
          "args": [
            "iot",
            "ioh",
            "ASC_MCODE_START_ADDR"
          ],
          "line": 1260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReadLramWord",
          "args": [
            "iot",
            "ioh",
            "ASCV_MC_VER_W"
          ],
          "line": 1259
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1054-1063",
          "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramDWord",
          "args": [
            "iot",
            "ioh",
            "ASCV_OVERRUN_BSIZE_D",
            "ASC_OVERRUN_BSIZE - 8"
          ],
          "line": 1254
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramDWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1096-1107",
          "snippet": "static void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramDWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramDWord;\n\nstatic void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetOnePhyAddr",
          "args": [
            "sc",
            "sc->overrun_buf",
            "ASC_OVERRUN_BSIZE"
          ],
          "line": 1248
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetOnePhyAddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1299-1316",
          "snippet": "static u_int32_t\nAscGetOnePhyAddr(sc, buf_addr, buf_size)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_size;\n{\n\tASC_MIN_SG_HEAD sg_head;\n\n\tsg_head.entry_cnt = ASC_MIN_SG_LIST;\n\tif (AscGetSGList(sc, buf_addr, buf_size, (ASC_SG_HEAD *) & sg_head) !=\n\t    buf_size) {\n\t\treturn (0L);\n\t}\n\tif (sg_head.entry_cnt > 1) {\n\t\treturn (0L);\n\t}\n\treturn (sg_head.sg_list[0].addr);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int32_t AscGetOnePhyAddr",
            "static u_int32_t AscGetSGList"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscGetOnePhyAddr;\nstatic u_int32_t AscGetSGList;\n\nstatic u_int32_t\nAscGetOnePhyAddr(sc, buf_addr, buf_size)\n\tASC_SOFTC      *sc;\n\tu_int8_t       *buf_addr;\n\tu_int32_t       buf_size;\n{\n\tASC_MIN_SG_HEAD sg_head;\n\n\tsg_head.entry_cnt = ASC_MIN_SG_LIST;\n\tif (AscGetSGList(sc, buf_addr, buf_size, (ASC_SG_HEAD *) & sg_head) !=\n\t    buf_size) {\n\t\treturn (0L);\n\t}\n\tif (sg_head.entry_cnt > 1) {\n\t\treturn (0L);\n\t}\n\treturn (sg_head.sg_list[0].addr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_HOSTSCSI_ID_B",
            "ASC_TID_TO_TARGET_ID(sc->chip_scsi_id)"
          ],
          "line": 1245
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_TID_TO_TARGET_ID",
          "args": [
            "sc->chip_scsi_id"
          ],
          "line": 1246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscInitQLinkVar",
          "args": [
            "sc"
          ],
          "line": 1243
        },
        "resolved": true,
        "details": {
          "function_name": "AscInitQLinkVar",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "679-705",
          "snippet": "static void\nAscInitQLinkVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       lram_addr;\n\n\n\tASC_PUT_RISC_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_RISC_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, ASCV_BUSY_QHEAD_B, sc->max_total_qng + 1);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC1_QHEAD_B, sc->max_total_qng + 2);\n\tAscWriteLramByte(iot, ioh, ASCV_TOTAL_READY_Q_B, sc->max_total_qng);\n\tAscWriteLramWord(iot, ioh, ASCV_ASCDVC_ERR_CODE_W, 0);\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_WTM_FLAG_B, 0);\n\tASC_PUT_QDONE_IN_PROGRESS(iot, ioh, 0);\n\tlram_addr = ASC_QADR_BEG;\n\tfor (i = 0; i < 32; i++, lram_addr += 2)\n\t\tAscWriteLramWord(iot, ioh, lram_addr, 0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscInitQLinkVar",
            "static void AscWriteLramByte",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitQLinkVar;\nstatic void AscWriteLramByte;\nstatic void AscWriteLramWord;\n\nstatic void\nAscInitQLinkVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       lram_addr;\n\n\n\tASC_PUT_RISC_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_RISC_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, ASCV_BUSY_QHEAD_B, sc->max_total_qng + 1);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC1_QHEAD_B, sc->max_total_qng + 2);\n\tAscWriteLramByte(iot, ioh, ASCV_TOTAL_READY_Q_B, sc->max_total_qng);\n\tAscWriteLramWord(iot, ioh, ASCV_ASCDVC_ERR_CODE_W, 0);\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_WTM_FLAG_B, 0);\n\tASC_PUT_QDONE_IN_PROGRESS(iot, ioh, 0);\n\tlram_addr = ASC_QADR_BEG;\n\tfor (i = 0; i < 32; i++, lram_addr += 2)\n\t\tAscWriteLramWord(iot, ioh, lram_addr, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_PUT_MCODE_INIT_SDTR_AT_ID",
          "args": [
            "iot",
            "ioh",
            "i",
            "sc->sdtr_period_offset[i]"
          ],
          "line": 1240
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitQLinkVar;\nstatic int AscStartChip;\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramDWord;\nstatic u_int16_t AscInitMicroCodeVar;\nstatic u_int32_t AscGetOnePhyAddr;\n\nstatic u_int16_t\nAscInitMicroCodeVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int32_t       phy_addr;\n\tint             i;\n\n\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tASC_PUT_MCODE_INIT_SDTR_AT_ID(iot, ioh, i,\n\t\t\t\t\t      sc->sdtr_period_offset[i]);\n\n\tAscInitQLinkVar(sc);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC_ENABLE_B, sc->disc_enable);\n\tAscWriteLramByte(iot, ioh, ASCV_HOSTSCSI_ID_B,\n\t\t\t ASC_TID_TO_TARGET_ID(sc->chip_scsi_id));\n\n\tif ((phy_addr = AscGetOnePhyAddr(sc, sc->overrun_buf,\n\t\t\t\t\t ASC_OVERRUN_BSIZE)) == 0L) {\n\t\treturn (0);\n\t} else {\n\t\tphy_addr = (phy_addr & 0xFFFFFFF8ul) + 8;\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_PADDR_D, phy_addr);\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_BSIZE_D,\n\t\t\t\t  ASC_OVERRUN_BSIZE - 8);\n\t}\n\n\tsc->mcode_date = AscReadLramWord(iot, ioh, ASCV_MC_DATE_W);\n\tsc->mcode_version = AscReadLramWord(iot, ioh, ASCV_MC_VER_W);\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR) {\n\t\treturn (0);\n\t}\n\tif (AscStartChip(iot, ioh) != 1) {\n\t\treturn (0);\n\t}\n\treturn (1);\n}"
  },
  {
    "function_name": "AscTestExternalLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1198-1221",
    "snippet": "static int\nAscTestExternalLram(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       q_addr;\n\tu_int16_t       saved_word;\n\tint             retval;\n\n\n\tretval = 0;\n\tq_addr = ASC_QNO_TO_QADDR(241);\n\tsaved_word = AscReadLramWord(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, 0x55AA);\n\tDvcSleepMilliSecond(10);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\n\tif (ASC_GET_CHIP_LRAM_DATA(iot, ioh) == 0x55AA) {\n\t\tretval = 1;\n\t\tAscWriteLramWord(iot, ioh, q_addr, saved_word);\n\t}\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscReadLramWord",
      "static void AscWriteLramWord",
      "static int AscTestExternalLram",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "q_addr",
            "saved_word"
          ],
          "line": 1218
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "q_addr"
          ],
          "line": 1214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "10"
          ],
          "line": 1213
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "0x55AA"
          ],
          "line": 1212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "q_addr"
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscReadLramWord",
          "args": [
            "iot",
            "ioh",
            "q_addr"
          ],
          "line": 1210
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1054-1063",
          "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_QNO_TO_QADDR",
          "args": [
            "241"
          ],
          "line": 1209
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\nstatic int AscTestExternalLram;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscTestExternalLram(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       q_addr;\n\tu_int16_t       saved_word;\n\tint             retval;\n\n\n\tretval = 0;\n\tq_addr = ASC_QNO_TO_QADDR(241);\n\tsaved_word = AscReadLramWord(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, 0x55AA);\n\tDvcSleepMilliSecond(10);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\n\tif (ASC_GET_CHIP_LRAM_DATA(iot, ioh) == 0x55AA) {\n\t\tretval = 1;\n\t\tAscWriteLramWord(iot, ioh, q_addr, saved_word);\n\t}\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscMemSumLramWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1180-1195",
    "snippet": "static u_int32_t\nAscMemSumLramWord(iot, ioh, s_addr, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tint             words;\n{\n\tu_int32_t       sum = 0L;\n\tu_int16_t       i;\n\n\n\tfor (i = 0; i < words; i++, s_addr += 2)\n\t\tsum += AscReadLramWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscReadLramWord",
      "static u_int32_t AscMemSumLramWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscReadLramWord",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1192
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1054-1063",
          "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic u_int32_t AscMemSumLramWord;\n\nstatic u_int32_t\nAscMemSumLramWord(iot, ioh, s_addr, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tint             words;\n{\n\tu_int32_t       sum = 0L;\n\tu_int16_t       i;\n\n\n\tfor (i = 0; i < words; i++, s_addr += 2)\n\t\tsum += AscReadLramWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}"
  },
  {
    "function_name": "AscMemDWordCopyToLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1158-1177",
    "snippet": "static void\nAscMemDWordCopyToLram(iot, ioh, s_addr, s_buffer, dwords)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int32_t      *s_buffer;\n\tint             dwords;\n{\n\tint             i;\n\tu_int32_t      *pw;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\n\tpw = s_buffer;\n\tfor (i = 0; i < dwords; i++, pw++) {\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, LO_WORD(*pw));\n\t\tDELAY(1);\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, HI_WORD(*pw));\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscMemDWordCopyToLram"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "HI_WORD(*pw)"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HI_WORD",
          "args": [
            "*pw"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DELAY",
          "args": [
            "1"
          ],
          "line": 1174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "LO_WORD(*pw)"
          ],
          "line": 1173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LO_WORD",
          "args": [
            "*pw"
          ],
          "line": 1173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1169
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemDWordCopyToLram;\n\nstatic void\nAscMemDWordCopyToLram(iot, ioh, s_addr, s_buffer, dwords)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int32_t      *s_buffer;\n\tint             dwords;\n{\n\tint             i;\n\tu_int32_t      *pw;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\n\tpw = s_buffer;\n\tfor (i = 0; i < dwords; i++, pw++) {\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, LO_WORD(*pw));\n\t\tDELAY(1);\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, HI_WORD(*pw));\n\t}\n}"
  },
  {
    "function_name": "AscMemWordCopyFromLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1142-1155",
    "snippet": "static void\nAscMemWordCopyFromLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\t*s_buffer = ASC_GET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscMemWordCopyFromLram"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA_NO_SWAP",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1152
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyFromLram;\n\nstatic void\nAscMemWordCopyFromLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\t*s_buffer = ASC_GET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh);\n}"
  },
  {
    "function_name": "AscMemWordCopyToLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1126-1139",
    "snippet": "static void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscMemWordCopyToLram"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA_NO_SWAP",
          "args": [
            "iot",
            "ioh",
            "*s_buffer"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1136
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordCopyToLram;\n\nstatic void\nAscMemWordCopyToLram(iot, ioh, s_addr, s_buffer, words)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *s_buffer;\n\tint             words;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < words; i++, s_buffer++)\n\t\tASC_SET_CHIP_LRAM_DATA_NO_SWAP(iot, ioh, *s_buffer);\n}"
  },
  {
    "function_name": "AscMemWordSetLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1110-1123",
    "snippet": "static void\nAscMemWordSetLram(iot, ioh, s_addr, s_words, count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t       s_words;\n\tint             count;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < count; i++)\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, s_words);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscMemWordSetLram"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "s_words"
          ],
          "line": 1122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "s_addr"
          ],
          "line": 1120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordSetLram;\n\nstatic void\nAscMemWordSetLram(iot, ioh, s_addr, s_words, count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t       s_words;\n\tint             count;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < count; i++)\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, s_words);\n}"
  },
  {
    "function_name": "AscWriteLramDWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1096-1107",
    "snippet": "static void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramDWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "(u_int16_t) (data >> 16)"
          ],
          "line": 1106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "data >> 16"
          ],
          "line": 1106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "(u_int16_t) (data & 0x0000FFFF)"
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "data & 0x0000FFFF"
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramDWord;\n\nstatic void\nAscWriteLramDWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int32_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data & 0x0000FFFF));\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, (u_int16_t) (data >> 16));\n}"
  },
  {
    "function_name": "AscReadLramDWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1079-1093",
    "snippet": "static u_int32_t\nAscReadLramDWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int16_t       low_word, hi_word;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tlow_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\thi_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\treturn ((((u_int32_t) hi_word) << 16) | (u_int32_t) low_word);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int32_t AscReadLramDWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1089
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 1088
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscReadLramDWord;\n\nstatic u_int32_t\nAscReadLramDWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int16_t       low_word, hi_word;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tlow_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\thi_word = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\treturn ((((u_int32_t) hi_word) << 16) | (u_int32_t) low_word);\n}"
  },
  {
    "function_name": "AscWriteLramWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1066-1076",
    "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh",
            "data"
          ],
          "line": 1075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
  },
  {
    "function_name": "AscReadLramWord",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1054-1063",
    "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscReadLramWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr"
          ],
          "line": 1061
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
  },
  {
    "function_name": "AscWriteLramByte",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1028-1051",
    "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscWriteLramByte",
      "static u_int16_t AscReadLramWord",
      "static void AscWriteLramWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "addr",
            "word_data"
          ],
          "line": 1050
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramWord",
          "args": [
            "iot",
            "ioh",
            "addr & 0xFFFE"
          ],
          "line": 1038
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1054-1063",
          "snippet": "static u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\n\nstatic u_int16_t\nAscReadLramWord(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\treturn (ASC_GET_CHIP_LRAM_DATA(iot, ioh));\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
  },
  {
    "function_name": "AscReadLramByte",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "1003-1025",
    "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscReadLramByte"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "word_data & 0xFF"
          ],
          "line": 1021
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "(word_data >> 8) & 0xFF"
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_LRAM_DATA",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 1014
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_LRAM_ADDR",
          "args": [
            "iot",
            "ioh",
            "addr & 0xFFFE"
          ],
          "line": 1013
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
  },
  {
    "function_name": "AscSetChipIH",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "984-995",
    "snippet": "static void\nAscSetChipIH(iot, ioh, ins_code)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       ins_code;\n{\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_IH(iot, ioh, ins_code);\n\tAscSetBank(iot, ioh, 0);\n\n\treturn;\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscSetBank",
      "static void AscSetChipIH"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetBank",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 992
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetBank",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "770-798",
          "snippet": "static void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\n\nstatic void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_WRITE_CHIP_IH",
          "args": [
            "iot",
            "ioh",
            "ins_code"
          ],
          "line": 991
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic void AscSetChipIH;\n\nstatic void\nAscSetChipIH(iot, ioh, ins_code)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       ins_code;\n{\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_IH(iot, ioh, ins_code);\n\tAscSetBank(iot, ioh, 0);\n\n\treturn;\n}"
  },
  {
    "function_name": "AscIsChipHalted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "971-981",
    "snippet": "static int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscIsChipHalted"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscIsChipHalted;\n\nstatic int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}"
  },
  {
    "function_name": "AscHostReqRiscHalt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "941-968",
    "snippet": "static int\nAscHostReqRiscHalt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tint             retval = 0;\n\tu_int8_t        saved_stop_code;\n\n\n\tif (AscIsChipHalted(iot, ioh))\n\t\treturn (1);\n\tsaved_stop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B,\n\t\t      ASC_STOP_HOST_REQ_RISC_HALT | ASC_STOP_REQ_RISC_STOP);\n\n\tdo {\n\t\tif (AscIsChipHalted(iot, ioh)) {\n\t\t\tretval = 1;\n\t\t\tbreak;\n\t\t}\n\t\tDvcSleepMilliSecond(100);\n\t} while (count++ < 20);\n\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, saved_stop_code);\n\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscHostReqRiscHalt",
      "static int AscIsChipHalted",
      "static u_int8_t AscReadLramByte",
      "static void AscWriteLramByte",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B",
            "saved_stop_code"
          ],
          "line": 965
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "100"
          ],
          "line": 962
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscIsChipHalted",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 958
        },
        "resolved": true,
        "details": {
          "function_name": "AscIsChipHalted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "971-981",
          "snippet": "static int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscIsChipHalted"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscIsChipHalted;\n\nstatic int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscReadLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_STOP_CODE_B"
          ],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "AscReadLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1003-1025",
          "snippet": "static u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\n\nstatic u_int8_t\nAscReadLramByte(iot, ioh, addr)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n{\n\tu_int8_t        byte_data;\n\tu_int16_t       word_data;\n\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr & 0xFFFE);\n\tword_data = ASC_GET_CHIP_LRAM_DATA(iot, ioh);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tbyte_data = (u_int8_t) ((word_data >> 8) & 0xFF);\n\t} else {\n\t\t/* even address */\n\t\tbyte_data = (u_int8_t) (word_data & 0xFF);\n\t}\n\n\treturn (byte_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscHostReqRiscHalt;\nstatic int AscIsChipHalted;\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscHostReqRiscHalt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tint             retval = 0;\n\tu_int8_t        saved_stop_code;\n\n\n\tif (AscIsChipHalted(iot, ioh))\n\t\treturn (1);\n\tsaved_stop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B,\n\t\t      ASC_STOP_HOST_REQ_RISC_HALT | ASC_STOP_REQ_RISC_STOP);\n\n\tdo {\n\t\tif (AscIsChipHalted(iot, ioh)) {\n\t\t\tretval = 1;\n\t\t\tbreak;\n\t\t}\n\t\tDvcSleepMilliSecond(100);\n\t} while (count++ < 20);\n\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, saved_stop_code);\n\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscSetChipSynRegAtID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "907-938",
    "snippet": "static int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscSetBank",
      "static int AscSetChipSynRegAtID"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetBank",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetBank",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "770-798",
          "snippet": "static void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\n\nstatic void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_WRITE_CHIP_DVC_ID",
          "args": [
            "iot",
            "ioh",
            "org_id"
          ],
          "line": 935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_SYN",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_SYN",
          "args": [
            "iot",
            "ioh",
            "sdtr_data"
          ],
          "line": 928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_READ_CHIP_DVC_ID",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_WRITE_CHIP_DVC_ID",
          "args": [
            "iot",
            "ioh",
            "id"
          ],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_READ_CHIP_DVC_ID",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 919
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic int AscSetChipSynRegAtID;\n\nstatic int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}"
  },
  {
    "function_name": "AscSetRunChipSynRegAtID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "890-904",
    "snippet": "static int\nAscSetRunChipSynRegAtID(iot, ioh, tid_no, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n{\n\tint             retval = FALSE;\n\n\tif (AscHostReqRiscHalt(iot, ioh)) {\n\t\tretval = AscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\t\tAscStartChip(iot, ioh);\n\t}\n\treturn (retval);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscStartChip",
      "static int AscSetRunChipSynRegAtID",
      "static int AscSetChipSynRegAtID",
      "static int AscHostReqRiscHalt"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscStartChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 901
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "806-816",
          "snippet": "static int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStartChip"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\n\nstatic int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetChipSynRegAtID",
          "args": [
            "iot",
            "ioh",
            "tid_no",
            "sdtr_data"
          ],
          "line": 900
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipSynRegAtID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "907-938",
          "snippet": "static int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static int AscSetChipSynRegAtID"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic int AscSetChipSynRegAtID;\n\nstatic int\nAscSetChipSynRegAtID(iot, ioh, id, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        id;\n\tu_int8_t        sdtr_data;\n{\n\tASC_SCSI_BIT_ID_TYPE org_id;\n\tint             i;\n\tint             sta = TRUE;\n\n\tAscSetBank(iot, ioh, 1);\n\torg_id = ASC_READ_CHIP_DVC_ID(iot, ioh);\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tif (org_id == (0x01 << i))\n\t\t\tbreak;\n\n\torg_id = i;\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, id);\n\tif (ASC_READ_CHIP_DVC_ID(iot, ioh) == (0x01 << id)) {\n\t\tAscSetBank(iot, ioh, 0);\n\t\tASC_SET_CHIP_SYN(iot, ioh, sdtr_data);\n\t\tif (ASC_GET_CHIP_SYN(iot, ioh) != sdtr_data)\n\t\t\tsta = FALSE;\n\t} else\n\t\tsta = FALSE;\n\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DVC_ID(iot, ioh, org_id);\n\tAscSetBank(iot, ioh, 0);\n\treturn (sta);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscHostReqRiscHalt",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 899
        },
        "resolved": true,
        "details": {
          "function_name": "AscHostReqRiscHalt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "941-968",
          "snippet": "static int\nAscHostReqRiscHalt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tint             retval = 0;\n\tu_int8_t        saved_stop_code;\n\n\n\tif (AscIsChipHalted(iot, ioh))\n\t\treturn (1);\n\tsaved_stop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B,\n\t\t      ASC_STOP_HOST_REQ_RISC_HALT | ASC_STOP_REQ_RISC_STOP);\n\n\tdo {\n\t\tif (AscIsChipHalted(iot, ioh)) {\n\t\t\tretval = 1;\n\t\t\tbreak;\n\t\t}\n\t\tDvcSleepMilliSecond(100);\n\t} while (count++ < 20);\n\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, saved_stop_code);\n\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscHostReqRiscHalt",
            "static int AscIsChipHalted",
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscHostReqRiscHalt;\nstatic int AscIsChipHalted;\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscHostReqRiscHalt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\tint             retval = 0;\n\tu_int8_t        saved_stop_code;\n\n\n\tif (AscIsChipHalted(iot, ioh))\n\t\treturn (1);\n\tsaved_stop_code = AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B,\n\t\t      ASC_STOP_HOST_REQ_RISC_HALT | ASC_STOP_REQ_RISC_STOP);\n\n\tdo {\n\t\tif (AscIsChipHalted(iot, ioh)) {\n\t\t\tretval = 1;\n\t\t\tbreak;\n\t\t}\n\t\tDvcSleepMilliSecond(100);\n\t} while (count++ < 20);\n\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, saved_stop_code);\n\n\treturn (retval);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\nstatic int AscSetRunChipSynRegAtID;\nstatic int AscSetChipSynRegAtID;\nstatic int AscHostReqRiscHalt;\n\nstatic int\nAscSetRunChipSynRegAtID(iot, ioh, tid_no, sdtr_data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        tid_no;\n\tu_int8_t        sdtr_data;\n{\n\tint             retval = FALSE;\n\n\tif (AscHostReqRiscHalt(iot, ioh)) {\n\t\tretval = AscSetChipSynRegAtID(iot, ioh, tid_no, sdtr_data);\n\t\tAscStartChip(iot, ioh);\n\t}\n\treturn (retval);\n}"
  },
  {
    "function_name": "AscGetChipScsiCtrl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "876-887",
    "snippet": "static u_int8_t\nAscGetChipScsiCtrl(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        scsi_ctrl;\n\n\tAscSetBank(iot, ioh, 1);\n\tscsi_ctrl = bus_space_read_1(iot, ioh, ASC_IOP_REG_SC);\n\tAscSetBank(iot, ioh, 0);\n\treturn (scsi_ctrl);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscSetBank",
      "static u_int8_t AscGetChipScsiCtrl"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetBank",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetBank",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "770-798",
          "snippet": "static void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\n\nstatic void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "ASC_IOP_REG_SC"
          ],
          "line": 884
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic u_int8_t AscGetChipScsiCtrl;\n\nstatic u_int8_t\nAscGetChipScsiCtrl(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        scsi_ctrl;\n\n\tAscSetBank(iot, ioh, 1);\n\tscsi_ctrl = bus_space_read_1(iot, ioh, ASC_IOP_REG_SC);\n\tAscSetBank(iot, ioh, 0);\n\treturn (scsi_ctrl);\n}"
  },
  {
    "function_name": "AscSetChipScsiID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "857-873",
    "snippet": "static u_int8_t\nAscSetChipScsiID(iot, ioh, new_id)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        new_id;\n{\n\tu_int16_t       cfg_lsw;\n\n\tif (ASC_GET_CHIP_SCSI_ID(iot, ioh) == new_id)\n\t\treturn (new_id);\n\n\tcfg_lsw = ASC_GET_CHIP_SCSI_ID(iot, ioh);\n\tcfg_lsw &= 0xF8FF;\n\tcfg_lsw |= (new_id & ASC_MAX_TID) << 8;\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\treturn (ASC_GET_CHIP_SCSI_ID(iot, ioh));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscSetChipScsiID"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_SCSI_ID",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh",
            "cfg_lsw"
          ],
          "line": 871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_SCSI_ID",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 868
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_SCSI_ID",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 865
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscSetChipScsiID;\n\nstatic u_int8_t\nAscSetChipScsiID(iot, ioh, new_id)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        new_id;\n{\n\tu_int16_t       cfg_lsw;\n\n\tif (ASC_GET_CHIP_SCSI_ID(iot, ioh) == new_id)\n\t\treturn (new_id);\n\n\tcfg_lsw = ASC_GET_CHIP_SCSI_ID(iot, ioh);\n\tcfg_lsw &= 0xF8FF;\n\tcfg_lsw |= (new_id & ASC_MAX_TID) << 8;\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\treturn (ASC_GET_CHIP_SCSI_ID(iot, ioh));\n}"
  },
  {
    "function_name": "AscGetChipVersion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "838-854",
    "snippet": "static u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscGetChipVersion"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_VER_NO",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 853
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipVersion;\n\nstatic u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}"
  },
  {
    "function_name": "AscStopChip",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "819-835",
    "snippet": "static int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscStopChip",
      "static void AscSetChipIH"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscSetChipIH",
          "args": [
            "iot",
            "ioh",
            "ASC_INS_RFLAG_WTM"
          ],
          "line": 830
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipIH",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "984-995",
          "snippet": "static void\nAscSetChipIH(iot, ioh, ins_code)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       ins_code;\n{\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_IH(iot, ioh, ins_code);\n\tAscSetBank(iot, ioh, 0);\n\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static void AscSetChipIH"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic void AscSetChipIH;\n\nstatic void\nAscSetChipIH(iot, ioh, ins_code)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       ins_code;\n{\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_IH(iot, ioh, ins_code);\n\tAscSetBank(iot, ioh, 0);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "cc_val | ASC_CC_HALT"
          ],
          "line": 828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStopChip;\nstatic void AscSetChipIH;\n\nstatic int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
  },
  {
    "function_name": "AscStartChip",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "806-816",
    "snippet": "static int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscStartChip"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 811
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\n\nstatic int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
  },
  {
    "function_name": "AscSetBank",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "770-798",
    "snippet": "static void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscSetBank"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "val"
          ],
          "line": 796
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\n\nstatic void\nAscSetBank(iot, ioh, bank)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        bank;\n{\n\tu_int8_t        val;\n\n\tval = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST |\n\t\t   ASC_CC_DIAG | ASC_CC_SCSI_RESET |\n\t\t   ASC_CC_CHIP_RESET));\n\n\tswitch (bank) {\n\tcase 1:\n\t\tval |= ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tcase 2:\n\t\tval |= ASC_CC_DIAG | ASC_CC_BANK_ONE;\n\t\tbreak;\n\n\tdefault:\n\t\tval &= ~ASC_CC_BANK_ONE;\n\t}\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, val);\n\treturn;\n}"
  },
  {
    "function_name": "AscGetChipBusType",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "735-762",
    "snippet": "static u_int16_t\nAscGetChipBusType(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       chip_ver;\n\n\tchip_ver = ASC_GET_CHIP_VER_NO(iot, ioh);\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_VL) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_VL)) {\n\t\t/*\n\t\t * if(((iop_base & 0x0C30) == 0x0C30) || ((iop_base & 0x0C50)\n\t\t * == 0x0C50)) return (ASC_IS_EISA);\n\t\t */\n\t\treturn (ASC_IS_VL);\n\t}\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_ISA) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_ISA)) {\n\t\tif (chip_ver >= ASC_CHIP_MIN_VER_ISA_PNP)\n\t\t\treturn (ASC_IS_ISAPNP);\n\n\t\treturn (ASC_IS_ISA);\n\t} else if ((chip_ver >= ASC_CHIP_MIN_VER_PCI) &&\n\t\t   (chip_ver <= ASC_CHIP_MAX_VER_PCI))\n\t\treturn (ASC_IS_PCI);\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscGetChipBusType"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_VER_NO",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetChipBusType;\n\nstatic u_int16_t\nAscGetChipBusType(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       chip_ver;\n\n\tchip_ver = ASC_GET_CHIP_VER_NO(iot, ioh);\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_VL) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_VL)) {\n\t\t/*\n\t\t * if(((iop_base & 0x0C30) == 0x0C30) || ((iop_base & 0x0C50)\n\t\t * == 0x0C50)) return (ASC_IS_EISA);\n\t\t */\n\t\treturn (ASC_IS_VL);\n\t}\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_ISA) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_ISA)) {\n\t\tif (chip_ver >= ASC_CHIP_MIN_VER_ISA_PNP)\n\t\t\treturn (ASC_IS_ISAPNP);\n\n\t\treturn (ASC_IS_ISA);\n\t} else if ((chip_ver >= ASC_CHIP_MIN_VER_PCI) &&\n\t\t   (chip_ver <= ASC_CHIP_MAX_VER_PCI))\n\t\treturn (ASC_IS_PCI);\n\n\treturn (0);\n}"
  },
  {
    "function_name": "AscResetChipAndScsiBus",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "708-732",
    "snippet": "static int\nAscResetChipAndScsiBus(bus_space_tag_t iot,\n\t\t       bus_space_handle_t ioh)\n{\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\tAscStopChip(iot, ioh);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT);\n\n\tDvcDelayNanoSecond(60000);\n\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\n\tDvcSleepMilliSecond(200);\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\tAscStartChip(iot, ioh);\n\n\tDvcSleepMilliSecond(200);\n\n\treturn (AscIsChipHalted(iot, ioh));\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscResetChipAndScsiBus",
      "static int AscStartChip",
      "static int AscStopChip",
      "static int AscIsChipHalted",
      "static void AscSetChipIH",
      "static void DvcSleepMilliSecond",
      "static void DvcDelayNanoSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscIsChipHalted",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 731
        },
        "resolved": true,
        "details": {
          "function_name": "AscIsChipHalted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "971-981",
          "snippet": "static int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscIsChipHalted"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscIsChipHalted;\n\nstatic int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "200"
          ],
          "line": 729
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStartChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 727
        },
        "resolved": true,
        "details": {
          "function_name": "AscStartChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "806-816",
          "snippet": "static int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStartChip"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStartChip;\n\nstatic int\nAscStartChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tASC_SET_CHIP_CONTROL(iot, ioh, 0);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "ASC_CIW_CLR_SCSI_RESET_INT"
          ],
          "line": 726
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "ASC_CC_HALT"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "ASC_CC_CHIP_RESET | ASC_CC_HALT"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscSetChipIH",
          "args": [
            "iot",
            "ioh",
            "ASC_INS_HALT"
          ],
          "line": 720
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipIH",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "984-995",
          "snippet": "static void\nAscSetChipIH(iot, ioh, ins_code)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       ins_code;\n{\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_IH(iot, ioh, ins_code);\n\tAscSetBank(iot, ioh, 0);\n\n\treturn;\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static void AscSetChipIH"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic void AscSetChipIH;\n\nstatic void\nAscSetChipIH(iot, ioh, ins_code)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       ins_code;\n{\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_IH(iot, ioh, ins_code);\n\tAscSetBank(iot, ioh, 0);\n\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DvcDelayNanoSecond",
          "args": [
            "60000"
          ],
          "line": 717
        },
        "resolved": true,
        "details": {
          "function_name": "DvcDelayNanoSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3462-3468",
          "snippet": "static void\nDvcDelayNanoSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY((n + 999) / 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcDelayNanoSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcDelayNanoSecond;\n\nstatic void\nDvcDelayNanoSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY((n + 999) / 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT"
          ],
          "line": 715
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscStopChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 714
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "819-835",
          "snippet": "static int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStopChip",
            "static void AscSetChipIH"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStopChip;\nstatic void AscSetChipIH;\n\nstatic int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscResetChipAndScsiBus;\nstatic int AscStartChip;\nstatic int AscStopChip;\nstatic int AscIsChipHalted;\nstatic void AscSetChipIH;\nstatic void DvcSleepMilliSecond;\nstatic void DvcDelayNanoSecond;\n\nstatic int\nAscResetChipAndScsiBus(bus_space_tag_t iot,\n\t\t       bus_space_handle_t ioh)\n{\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\tAscStopChip(iot, ioh);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT);\n\n\tDvcDelayNanoSecond(60000);\n\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\n\tDvcSleepMilliSecond(200);\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\tAscStartChip(iot, ioh);\n\n\tDvcSleepMilliSecond(200);\n\n\treturn (AscIsChipHalted(iot, ioh));\n}"
  },
  {
    "function_name": "AscInitQLinkVar",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "679-705",
    "snippet": "static void\nAscInitQLinkVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       lram_addr;\n\n\n\tASC_PUT_RISC_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_RISC_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, ASCV_BUSY_QHEAD_B, sc->max_total_qng + 1);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC1_QHEAD_B, sc->max_total_qng + 2);\n\tAscWriteLramByte(iot, ioh, ASCV_TOTAL_READY_Q_B, sc->max_total_qng);\n\tAscWriteLramWord(iot, ioh, ASCV_ASCDVC_ERR_CODE_W, 0);\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_WTM_FLAG_B, 0);\n\tASC_PUT_QDONE_IN_PROGRESS(iot, ioh, 0);\n\tlram_addr = ASC_QADR_BEG;\n\tfor (i = 0; i < 32; i++, lram_addr += 2)\n\t\tAscWriteLramWord(iot, ioh, lram_addr, 0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscInitQLinkVar",
      "static void AscWriteLramByte",
      "static void AscWriteLramWord"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "lram_addr",
            "0"
          ],
          "line": 704
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_PUT_QDONE_IN_PROGRESS",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 701
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "ASCV_WTM_FLAG_B",
            "0"
          ],
          "line": 700
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_PUT_VAR_DONE_QTAIL",
          "args": [
            "iot",
            "ioh",
            "sc->max_total_qng"
          ],
          "line": 692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_PUT_VAR_FREE_QHEAD",
          "args": [
            "iot",
            "ioh",
            "1"
          ],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_PUT_RISC_VAR_DONE_QTAIL",
          "args": [
            "iot",
            "ioh",
            "sc->max_total_qng"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_PUT_RISC_VAR_FREE_QHEAD",
          "args": [
            "iot",
            "ioh",
            "1"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitQLinkVar;\nstatic void AscWriteLramByte;\nstatic void AscWriteLramWord;\n\nstatic void\nAscInitQLinkVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       lram_addr;\n\n\n\tASC_PUT_RISC_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_RISC_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, ASCV_BUSY_QHEAD_B, sc->max_total_qng + 1);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC1_QHEAD_B, sc->max_total_qng + 2);\n\tAscWriteLramByte(iot, ioh, ASCV_TOTAL_READY_Q_B, sc->max_total_qng);\n\tAscWriteLramWord(iot, ioh, ASCV_ASCDVC_ERR_CODE_W, 0);\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_WTM_FLAG_B, 0);\n\tASC_PUT_QDONE_IN_PROGRESS(iot, ioh, 0);\n\tlram_addr = ASC_QADR_BEG;\n\tfor (i = 0; i < 32; i++, lram_addr += 2)\n\t\tAscWriteLramWord(iot, ioh, lram_addr, 0);\n}"
  },
  {
    "function_name": "AscReInitLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "669-676",
    "snippet": "void\nAscReInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\n\tAscInitLram(sc);\n\tAscInitQLinkVar(sc);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscInitLram",
      "static void AscInitQLinkVar"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscInitQLinkVar",
          "args": [
            "sc"
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "AscInitQLinkVar",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "679-705",
          "snippet": "static void\nAscInitQLinkVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       lram_addr;\n\n\n\tASC_PUT_RISC_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_RISC_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, ASCV_BUSY_QHEAD_B, sc->max_total_qng + 1);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC1_QHEAD_B, sc->max_total_qng + 2);\n\tAscWriteLramByte(iot, ioh, ASCV_TOTAL_READY_Q_B, sc->max_total_qng);\n\tAscWriteLramWord(iot, ioh, ASCV_ASCDVC_ERR_CODE_W, 0);\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_WTM_FLAG_B, 0);\n\tASC_PUT_QDONE_IN_PROGRESS(iot, ioh, 0);\n\tlram_addr = ASC_QADR_BEG;\n\tfor (i = 0; i < 32; i++, lram_addr += 2)\n\t\tAscWriteLramWord(iot, ioh, lram_addr, 0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscInitQLinkVar",
            "static void AscWriteLramByte",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitQLinkVar;\nstatic void AscWriteLramByte;\nstatic void AscWriteLramWord;\n\nstatic void\nAscInitQLinkVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       lram_addr;\n\n\n\tASC_PUT_RISC_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_RISC_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tASC_PUT_VAR_FREE_QHEAD(iot, ioh, 1);\n\tASC_PUT_VAR_DONE_QTAIL(iot, ioh, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, ASCV_BUSY_QHEAD_B, sc->max_total_qng + 1);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC1_QHEAD_B, sc->max_total_qng + 2);\n\tAscWriteLramByte(iot, ioh, ASCV_TOTAL_READY_Q_B, sc->max_total_qng);\n\tAscWriteLramWord(iot, ioh, ASCV_ASCDVC_ERR_CODE_W, 0);\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_SCSIBUSY_B, 0);\n\tAscWriteLramByte(iot, ioh, ASCV_WTM_FLAG_B, 0);\n\tASC_PUT_QDONE_IN_PROGRESS(iot, ioh, 0);\n\tlram_addr = ASC_QADR_BEG;\n\tfor (i = 0; i < 32; i++, lram_addr += 2)\n\t\tAscWriteLramWord(iot, ioh, lram_addr, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscInitLram",
          "args": [
            "sc"
          ],
          "line": 674
        },
        "resolved": true,
        "details": {
          "function_name": "AscInitLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "631-666",
          "snippet": "static void\nAscInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       s_addr;\n\n\n\tAscMemWordSetLram(iot, ioh, ASC_QADR_BEG, 0,\n\t\t\t  (((sc->max_total_qng + 2 + 1) * 64) >> 1));\n\n\ti = ASC_MIN_ACTIVE_QNO;\n\ts_addr = ASC_QADR_BEG + ASC_QBLK_SIZE;\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i < sc->max_total_qng; i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i - 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, ASC_QLINK_END);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng - 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, sc->max_total_qng);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i <= (u_int8_t) (sc->max_total_qng + 3); i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscInitLram",
            "static void AscWriteLramByte",
            "static void AscMemWordSetLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitLram;\nstatic void AscWriteLramByte;\nstatic void AscMemWordSetLram;\n\nstatic void\nAscInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       s_addr;\n\n\n\tAscMemWordSetLram(iot, ioh, ASC_QADR_BEG, 0,\n\t\t\t  (((sc->max_total_qng + 2 + 1) * 64) >> 1));\n\n\ti = ASC_MIN_ACTIVE_QNO;\n\ts_addr = ASC_QADR_BEG + ASC_QBLK_SIZE;\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i < sc->max_total_qng; i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i - 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, ASC_QLINK_END);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng - 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, sc->max_total_qng);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i <= (u_int8_t) (sc->max_total_qng + 3); i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitLram;\nstatic void AscInitQLinkVar;\n\nvoid\nAscReInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\n\tAscInitLram(sc);\n\tAscInitQLinkVar(sc);\n}"
  },
  {
    "function_name": "AscInitLram",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "631-666",
    "snippet": "static void\nAscInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       s_addr;\n\n\n\tAscMemWordSetLram(iot, ioh, ASC_QADR_BEG, 0,\n\t\t\t  (((sc->max_total_qng + 2 + 1) * 64) >> 1));\n\n\ti = ASC_MIN_ACTIVE_QNO;\n\ts_addr = ASC_QADR_BEG + ASC_QBLK_SIZE;\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i < sc->max_total_qng; i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i - 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, ASC_QLINK_END);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng - 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, sc->max_total_qng);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i <= (u_int8_t) (sc->max_total_qng + 3); i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void AscInitLram",
      "static void AscWriteLramByte",
      "static void AscMemWordSetLram"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscWriteLramByte",
          "args": [
            "iot",
            "ioh",
            "s_addr + ASC_SCSIQ_B_QNO",
            "i"
          ],
          "line": 664
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramByte",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1028-1051",
          "snippet": "static void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramByte(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int8_t        data;\n{\n\tu_int16_t       word_data;\n\n\n\tword_data = AscReadLramWord(iot, ioh, addr & 0xFFFE);\n\n\tif (addr & 1) {\n\t\t/* odd address */\n\t\tword_data &= 0x00FF;\n\t\tword_data |= (((u_int16_t) data) << 8) & 0xFF00;\n\t} else {\n\t\t/* even address */\n\t\tword_data &= 0xFF00;\n\t\tword_data |= ((u_int16_t) data) & 0x00FF;\n\t}\n\n\tAscWriteLramWord(iot, ioh, addr, word_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "sc->max_total_qng + 3"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscMemWordSetLram",
          "args": [
            "iot",
            "ioh",
            "ASC_QADR_BEG",
            "0",
            "(((sc->max_total_qng + 2 + 1) * 64) >> 1)"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "AscMemWordSetLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1110-1123",
          "snippet": "static void\nAscMemWordSetLram(iot, ioh, s_addr, s_words, count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t       s_words;\n\tint             count;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < count; i++)\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, s_words);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscMemWordSetLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscMemWordSetLram;\n\nstatic void\nAscMemWordSetLram(iot, ioh, s_addr, s_words, count)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t       s_words;\n\tint             count;\n{\n\tint             i;\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, s_addr);\n\tfor (i = 0; i < count; i++)\n\t\tASC_SET_CHIP_LRAM_DATA(iot, ioh, s_words);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitLram;\nstatic void AscWriteLramByte;\nstatic void AscMemWordSetLram;\n\nstatic void\nAscInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       s_addr;\n\n\n\tAscMemWordSetLram(iot, ioh, ASC_QADR_BEG, 0,\n\t\t\t  (((sc->max_total_qng + 2 + 1) * 64) >> 1));\n\n\ti = ASC_MIN_ACTIVE_QNO;\n\ts_addr = ASC_QADR_BEG + ASC_QBLK_SIZE;\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i < sc->max_total_qng; i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i - 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, ASC_QLINK_END);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng - 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, sc->max_total_qng);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i <= (u_int8_t) (sc->max_total_qng + 3); i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n}"
  },
  {
    "function_name": "AscFindSignature",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "614-628",
    "snippet": "int\nAscFindSignature(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       sig_word;\n\n\tif (ASC_GET_CHIP_SIGNATURE_BYTE(iot, ioh) == ASC_1000_ID1B) {\n\t\tsig_word = ASC_GET_CHIP_SIGNATURE_WORD(iot, ioh);\n\t\tif (sig_word == ASC_1000_ID0W ||\n\t\t    sig_word == ASC_1000_ID0W_FIX)\n\t\t\treturn (1);\n\t}\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_SIGNATURE_WORD",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_SIGNATURE_BYTE",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\nAscFindSignature(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       sig_word;\n\n\tif (ASC_GET_CHIP_SIGNATURE_BYTE(iot, ioh) == ASC_1000_ID1B) {\n\t\tsig_word = ASC_GET_CHIP_SIGNATURE_WORD(iot, ioh);\n\t\tif (sig_word == ASC_1000_ID0W ||\n\t\t    sig_word == ASC_1000_ID0W_FIX)\n\t\t\treturn (1);\n\t}\n\treturn (0);\n}"
  },
  {
    "function_name": "AscInitDriver",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "585-611",
    "snippet": "int\nAscInitDriver(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int32_t       chksum;\n\n\n\tif (!AscFindSignature(iot, ioh))\n\t\treturn (1);\n\n\tAscDisableInterrupt(iot, ioh);\n\n\tAscInitLram(sc);\n\tchksum = AscLoadMicroCode(iot, ioh, 0, (u_int16_t *) asc_mcode,\n\t\t\t\t  asc_mcode_size);\n\tif (chksum != asc_mcode_chksum)\n\t\treturn (2);\n\n\tif (AscInitMicroCodeVar(sc) == 0)\n\t\treturn (3);\n\n\tAscEnableInterrupt(iot, ioh);\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int32_t AscLoadMicroCode",
      "static void AscInitLram",
      "static u_int16_t AscInitMicroCodeVar",
      "static void AscDisableInterrupt",
      "static void AscEnableInterrupt"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscEnableInterrupt",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "AscEnableInterrupt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2071-2080",
          "snippet": "static void\nAscEnableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg | ASC_CFG0_HOST_INT_ON);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscEnableInterrupt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscEnableInterrupt;\n\nstatic void\nAscEnableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg | ASC_CFG0_HOST_INT_ON);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscInitMicroCodeVar",
          "args": [
            "sc"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "AscInitMicroCodeVar",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1229-1269",
          "snippet": "static u_int16_t\nAscInitMicroCodeVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int32_t       phy_addr;\n\tint             i;\n\n\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tASC_PUT_MCODE_INIT_SDTR_AT_ID(iot, ioh, i,\n\t\t\t\t\t      sc->sdtr_period_offset[i]);\n\n\tAscInitQLinkVar(sc);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC_ENABLE_B, sc->disc_enable);\n\tAscWriteLramByte(iot, ioh, ASCV_HOSTSCSI_ID_B,\n\t\t\t ASC_TID_TO_TARGET_ID(sc->chip_scsi_id));\n\n\tif ((phy_addr = AscGetOnePhyAddr(sc, sc->overrun_buf,\n\t\t\t\t\t ASC_OVERRUN_BSIZE)) == 0L) {\n\t\treturn (0);\n\t} else {\n\t\tphy_addr = (phy_addr & 0xFFFFFFF8ul) + 8;\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_PADDR_D, phy_addr);\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_BSIZE_D,\n\t\t\t\t  ASC_OVERRUN_BSIZE - 8);\n\t}\n\n\tsc->mcode_date = AscReadLramWord(iot, ioh, ASCV_MC_DATE_W);\n\tsc->mcode_version = AscReadLramWord(iot, ioh, ASCV_MC_VER_W);\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR) {\n\t\treturn (0);\n\t}\n\tif (AscStartChip(iot, ioh) != 1) {\n\t\treturn (0);\n\t}\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscInitQLinkVar",
            "static int AscStartChip",
            "static void AscWriteLramByte",
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramDWord",
            "static u_int16_t AscInitMicroCodeVar",
            "static u_int32_t AscGetOnePhyAddr"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitQLinkVar;\nstatic int AscStartChip;\nstatic void AscWriteLramByte;\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramDWord;\nstatic u_int16_t AscInitMicroCodeVar;\nstatic u_int32_t AscGetOnePhyAddr;\n\nstatic u_int16_t\nAscInitMicroCodeVar(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int32_t       phy_addr;\n\tint             i;\n\n\n\tfor (i = 0; i <= ASC_MAX_TID; i++)\n\t\tASC_PUT_MCODE_INIT_SDTR_AT_ID(iot, ioh, i,\n\t\t\t\t\t      sc->sdtr_period_offset[i]);\n\n\tAscInitQLinkVar(sc);\n\tAscWriteLramByte(iot, ioh, ASCV_DISC_ENABLE_B, sc->disc_enable);\n\tAscWriteLramByte(iot, ioh, ASCV_HOSTSCSI_ID_B,\n\t\t\t ASC_TID_TO_TARGET_ID(sc->chip_scsi_id));\n\n\tif ((phy_addr = AscGetOnePhyAddr(sc, sc->overrun_buf,\n\t\t\t\t\t ASC_OVERRUN_BSIZE)) == 0L) {\n\t\treturn (0);\n\t} else {\n\t\tphy_addr = (phy_addr & 0xFFFFFFF8ul) + 8;\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_PADDR_D, phy_addr);\n\t\tAscWriteLramDWord(iot, ioh, ASCV_OVERRUN_BSIZE_D,\n\t\t\t\t  ASC_OVERRUN_BSIZE - 8);\n\t}\n\n\tsc->mcode_date = AscReadLramWord(iot, ioh, ASCV_MC_DATE_W);\n\tsc->mcode_version = AscReadLramWord(iot, ioh, ASCV_MC_VER_W);\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR) {\n\t\treturn (0);\n\t}\n\tif (AscStartChip(iot, ioh) != 1) {\n\t\treturn (0);\n\t}\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscLoadMicroCode",
          "args": [
            "iot",
            "ioh",
            "0",
            "(u_int16_t *) asc_mcode",
            "asc_mcode_size"
          ],
          "line": 600
        },
        "resolved": true,
        "details": {
          "function_name": "AscLoadMicroCode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1272-1296",
          "snippet": "static u_int32_t\nAscLoadMicroCode(iot, ioh, s_addr, mcode_buf, mcode_size)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *mcode_buf;\n\tu_int16_t       mcode_size;\n{\n\tu_int32_t       chksum;\n\tu_int16_t       mcode_word_size;\n\tu_int16_t       mcode_chksum;\n\n\tmcode_word_size = mcode_size >> 1;\n\t/* clear board memory */\n\tAscMemWordSetLram(iot, ioh, s_addr, 0, mcode_word_size);\n\t/* copy uCode to board memory */\n\tAscMemWordCopyToLram(iot, ioh, s_addr, mcode_buf, mcode_word_size);\n\tchksum = AscMemSumLramWord(iot, ioh, s_addr, mcode_word_size);\n\tmcode_chksum = AscMemSumLramWord(iot, ioh, ASC_CODE_SEC_BEG,\n\t\t\t   ((mcode_size - s_addr - ASC_CODE_SEC_BEG) >> 1));\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_CHKSUM_W, mcode_chksum);\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_SIZE_W, mcode_size);\n\n\treturn (chksum);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int32_t AscLoadMicroCode",
            "static void AscWriteLramWord",
            "static void AscMemWordSetLram",
            "static void AscMemWordCopyToLram",
            "static u_int32_t AscMemSumLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscLoadMicroCode;\nstatic void AscWriteLramWord;\nstatic void AscMemWordSetLram;\nstatic void AscMemWordCopyToLram;\nstatic u_int32_t AscMemSumLramWord;\n\nstatic u_int32_t\nAscLoadMicroCode(iot, ioh, s_addr, mcode_buf, mcode_size)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       s_addr;\n\tu_int16_t      *mcode_buf;\n\tu_int16_t       mcode_size;\n{\n\tu_int32_t       chksum;\n\tu_int16_t       mcode_word_size;\n\tu_int16_t       mcode_chksum;\n\n\tmcode_word_size = mcode_size >> 1;\n\t/* clear board memory */\n\tAscMemWordSetLram(iot, ioh, s_addr, 0, mcode_word_size);\n\t/* copy uCode to board memory */\n\tAscMemWordCopyToLram(iot, ioh, s_addr, mcode_buf, mcode_word_size);\n\tchksum = AscMemSumLramWord(iot, ioh, s_addr, mcode_word_size);\n\tmcode_chksum = AscMemSumLramWord(iot, ioh, ASC_CODE_SEC_BEG,\n\t\t\t   ((mcode_size - s_addr - ASC_CODE_SEC_BEG) >> 1));\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_CHKSUM_W, mcode_chksum);\n\tAscWriteLramWord(iot, ioh, ASCV_MCODE_SIZE_W, mcode_size);\n\n\treturn (chksum);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscInitLram",
          "args": [
            "sc"
          ],
          "line": 599
        },
        "resolved": true,
        "details": {
          "function_name": "AscInitLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "631-666",
          "snippet": "static void\nAscInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       s_addr;\n\n\n\tAscMemWordSetLram(iot, ioh, ASC_QADR_BEG, 0,\n\t\t\t  (((sc->max_total_qng + 2 + 1) * 64) >> 1));\n\n\ti = ASC_MIN_ACTIVE_QNO;\n\ts_addr = ASC_QADR_BEG + ASC_QBLK_SIZE;\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i < sc->max_total_qng; i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i - 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, ASC_QLINK_END);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng - 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, sc->max_total_qng);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i <= (u_int8_t) (sc->max_total_qng + 3); i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscInitLram",
            "static void AscWriteLramByte",
            "static void AscMemWordSetLram"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscInitLram;\nstatic void AscWriteLramByte;\nstatic void AscMemWordSetLram;\n\nstatic void\nAscInitLram(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int8_t        i;\n\tu_int16_t       s_addr;\n\n\n\tAscMemWordSetLram(iot, ioh, ASC_QADR_BEG, 0,\n\t\t\t  (((sc->max_total_qng + 2 + 1) * 64) >> 1));\n\n\ti = ASC_MIN_ACTIVE_QNO;\n\ts_addr = ASC_QADR_BEG + ASC_QBLK_SIZE;\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i < sc->max_total_qng; i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i + 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i - 1);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, ASC_QLINK_END);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, sc->max_total_qng - 1);\n\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, sc->max_total_qng);\n\ti++;\n\ts_addr += ASC_QBLK_SIZE;\n\tfor (; i <= (u_int8_t) (sc->max_total_qng + 3); i++, s_addr += ASC_QBLK_SIZE) {\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_FWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_BWD, i);\n\t\tAscWriteLramByte(iot, ioh, s_addr + ASC_SCSIQ_B_QNO, i);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscDisableInterrupt",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 597
        },
        "resolved": true,
        "details": {
          "function_name": "AscDisableInterrupt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2059-2068",
          "snippet": "static void\nAscDisableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg & (~ASC_CFG0_HOST_INT_ON));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscDisableInterrupt"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscDisableInterrupt;\n\nstatic void\nAscDisableInterrupt(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       cfg;\n\n\tcfg = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg & (~ASC_CFG0_HOST_INT_ON));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscFindSignature",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 594
        },
        "resolved": true,
        "details": {
          "function_name": "AscFindSignature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "614-628",
          "snippet": "int\nAscFindSignature(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       sig_word;\n\n\tif (ASC_GET_CHIP_SIGNATURE_BYTE(iot, ioh) == ASC_1000_ID1B) {\n\t\tsig_word = ASC_GET_CHIP_SIGNATURE_WORD(iot, ioh);\n\t\tif (sig_word == ASC_1000_ID0W ||\n\t\t    sig_word == ASC_1000_ID0W_FIX)\n\t\t\treturn (1);\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nint\nAscFindSignature(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       sig_word;\n\n\tif (ASC_GET_CHIP_SIGNATURE_BYTE(iot, ioh) == ASC_1000_ID1B) {\n\t\tsig_word = ASC_GET_CHIP_SIGNATURE_WORD(iot, ioh);\n\t\tif (sig_word == ASC_1000_ID0W ||\n\t\t    sig_word == ASC_1000_ID0W_FIX)\n\t\t\treturn (1);\n\t}\n\treturn (0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscLoadMicroCode;\nstatic void AscInitLram;\nstatic u_int16_t AscInitMicroCodeVar;\nstatic void AscDisableInterrupt;\nstatic void AscEnableInterrupt;\n\nint\nAscInitDriver(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int32_t       chksum;\n\n\n\tif (!AscFindSignature(iot, ioh))\n\t\treturn (1);\n\n\tAscDisableInterrupt(iot, ioh);\n\n\tAscInitLram(sc);\n\tchksum = AscLoadMicroCode(iot, ioh, 0, (u_int16_t *) asc_mcode,\n\t\t\t\t  asc_mcode_size);\n\tif (chksum != asc_mcode_chksum)\n\t\treturn (2);\n\n\tif (AscInitMicroCodeVar(sc) == 0)\n\t\treturn (3);\n\n\tAscEnableInterrupt(iot, ioh);\n\n\treturn (0);\n}"
  },
  {
    "function_name": "AscInitFromASC_SOFTC",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "523-576",
    "snippet": "u_int16_t\nAscInitFromASC_SOFTC(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       cfg_msw;\n\tu_int16_t       warn_code;\n\tu_int16_t       pci_device_id = sc->pci_device_id;\n\n\n\twarn_code = 0;\n\tcfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\n\tif ((cfg_msw & ASC_CFG_MSW_CLR_MASK) != 0) {\n\t\tcfg_msw &= (~(ASC_CFG_MSW_CLR_MASK));\n\t\twarn_code |= ASC_WARN_CFG_MSW_RECOVER;\n\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\t}\n\tif ((sc->cmd_qng_enabled & sc->disc_enable) != sc->cmd_qng_enabled) {\n\t\tsc->disc_enable = sc->cmd_qng_enabled;\n\t\twarn_code |= ASC_WARN_CMD_QNG_CONFLICT;\n\t}\n\tif (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_AUTO_CONFIG) {\n\t\twarn_code |= ASC_WARN_AUTO_CONFIG;\n\t}\n\tif ((sc->bus_type & (ASC_IS_ISA | ASC_IS_VL)) != 0) {\n\t\tAscSetChipIRQ(iot, ioh, sc->irq_no, sc->bus_type);\n\t}\n\tif (sc->bus_type & ASC_IS_PCI) {\n\t\tcfg_msw &= 0xFFC0;\n\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\n\t\tif ((sc->bus_type & ASC_IS_PCI_ULTRA) != ASC_IS_PCI_ULTRA) {\n\t\t\tif ((pci_device_id == ASC_PCI_DEVICE_ID_REV_A) ||\n\t\t\t    (pci_device_id == ASC_PCI_DEVICE_ID_REV_B)) {\n\t\t\t\tsc->bug_fix_cntl |= ASC_BUG_FIX_IF_NOT_DWB;\n\t\t\t\tsc->bug_fix_cntl |= ASC_BUG_FIX_ASYN_USE_SYN;\n\t\t\t}\n\t\t}\n\t} else if (sc->bus_type == ASC_IS_ISAPNP) {\n\t\tif (AscGetChipVersion(iot, ioh, sc->bus_type) ==\n\t\t    ASC_CHIP_VER_ASYN_BUG) {\n\t\t\tsc->bug_fix_cntl |= ASC_BUG_FIX_ASYN_USE_SYN;\n\t\t}\n\t}\n\tAscSetChipScsiID(iot, ioh, sc->chip_scsi_id);\n\n\tif (sc->bus_type & ASC_IS_ISA) {\n\t\tAscSetIsaDmaChannel(iot, ioh, sc->isa_dma_channel);\n\t\tAscSetIsaDmaSpeed(iot, ioh, sc->isa_dma_speed);\n\t}\n\treturn (warn_code);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int8_t AscSetChipScsiID",
      "static u_int8_t AscGetChipVersion",
      "static u_int8_t AscSetChipIRQ",
      "static u_int16_t AscSetIsaDmaChannel",
      "static u_int8_t AscSetIsaDmaSpeed"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscSetIsaDmaSpeed",
          "args": [
            "iot",
            "ioh",
            "sc->isa_dma_speed"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetIsaDmaSpeed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2261-2272",
          "snippet": "static u_int8_t\nAscSetIsaDmaSpeed(iot, ioh, speed_value)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        speed_value;\n{\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DMA_SPEED(iot, ioh, speed_value);\n\tAscSetBank(iot, ioh, 0);\n\treturn (AscGetIsaDmaSpeed(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static u_int8_t AscGetIsaDmaSpeed",
            "static u_int8_t AscSetIsaDmaSpeed"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic u_int8_t AscGetIsaDmaSpeed;\nstatic u_int8_t AscSetIsaDmaSpeed;\n\nstatic u_int8_t\nAscSetIsaDmaSpeed(iot, ioh, speed_value)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        speed_value;\n{\n\tspeed_value &= 0x07;\n\tAscSetBank(iot, ioh, 1);\n\tASC_WRITE_CHIP_DMA_SPEED(iot, ioh, speed_value);\n\tAscSetBank(iot, ioh, 0);\n\treturn (AscGetIsaDmaSpeed(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetIsaDmaChannel",
          "args": [
            "iot",
            "ioh",
            "sc->isa_dma_channel"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetIsaDmaChannel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2223-2243",
          "snippet": "static u_int16_t\nAscSetIsaDmaChannel(iot, ioh, dma_channel)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       dma_channel;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        value;\n\n\tif ((dma_channel >= 5) && (dma_channel <= 7)) {\n\t\tif (dma_channel == 7)\n\t\t\tvalue = 0x00;\n\t\telse\n\t\t\tvalue = dma_channel - 4;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFFC;\n\t\tcfg_lsw |= value;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\treturn (AscGetIsaDmaChannel(iot, ioh));\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscGetIsaDmaChannel",
            "static u_int16_t AscSetIsaDmaChannel"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetIsaDmaChannel;\nstatic u_int16_t AscSetIsaDmaChannel;\n\nstatic u_int16_t\nAscSetIsaDmaChannel(iot, ioh, dma_channel)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       dma_channel;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        value;\n\n\tif ((dma_channel >= 5) && (dma_channel <= 7)) {\n\t\tif (dma_channel == 7)\n\t\t\tvalue = 0x00;\n\t\telse\n\t\t\tvalue = dma_channel - 4;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFFC;\n\t\tcfg_lsw |= value;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\treturn (AscGetIsaDmaChannel(iot, ioh));\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetChipScsiID",
          "args": [
            "iot",
            "ioh",
            "sc->chip_scsi_id"
          ],
          "line": 569
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipScsiID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "857-873",
          "snippet": "static u_int8_t\nAscSetChipScsiID(iot, ioh, new_id)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        new_id;\n{\n\tu_int16_t       cfg_lsw;\n\n\tif (ASC_GET_CHIP_SCSI_ID(iot, ioh) == new_id)\n\t\treturn (new_id);\n\n\tcfg_lsw = ASC_GET_CHIP_SCSI_ID(iot, ioh);\n\tcfg_lsw &= 0xF8FF;\n\tcfg_lsw |= (new_id & ASC_MAX_TID) << 8;\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\treturn (ASC_GET_CHIP_SCSI_ID(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscSetChipScsiID"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscSetChipScsiID;\n\nstatic u_int8_t\nAscSetChipScsiID(iot, ioh, new_id)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        new_id;\n{\n\tu_int16_t       cfg_lsw;\n\n\tif (ASC_GET_CHIP_SCSI_ID(iot, ioh) == new_id)\n\t\treturn (new_id);\n\n\tcfg_lsw = ASC_GET_CHIP_SCSI_ID(iot, ioh);\n\tcfg_lsw &= 0xF8FF;\n\tcfg_lsw |= (new_id & ASC_MAX_TID) << 8;\n\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\treturn (ASC_GET_CHIP_SCSI_ID(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetChipVersion",
          "args": [
            "iot",
            "ioh",
            "sc->bus_type"
          ],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipVersion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "838-854",
          "snippet": "static u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetChipVersion"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipVersion;\n\nstatic u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh",
            "cfg_msw"
          ],
          "line": 554
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscSetChipIRQ",
          "args": [
            "iot",
            "ioh",
            "sc->irq_no",
            "sc->bus_type"
          ],
          "line": 550
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetChipIRQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2118-2158",
          "snippet": "static u_int8_t\nAscSetChipIRQ(iot, ioh, irq_no, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        irq_no;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tif (irq_no) {\n\t\t\tif ((irq_no < ASC_MIN_IRQ_NO) || (irq_no > ASC_MAX_IRQ_NO))\n\t\t\t\tirq_no = 0;\n\t\t\telse\n\t\t\t\tirq_no -= ASC_MIN_IRQ_NO - 1;\n\t\t}\n\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE3;\n\t\tcfg_lsw |= 0x0010;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE0;\n\t\tcfg_lsw |= (irq_no & 0x07) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\tif (bus_type & ASC_IS_ISA) {\n\t\tif (irq_no == 15)\n\t\t\tirq_no -= 2;\n\t\tirq_no -= ASC_MIN_IRQ_NO;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFF3;\n\t\tcfg_lsw |= (irq_no & 0x03) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscToggleIRQAct",
            "static u_int8_t AscGetChipIRQ",
            "static u_int8_t AscSetChipIRQ"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscToggleIRQAct;\nstatic u_int8_t AscGetChipIRQ;\nstatic u_int8_t AscSetChipIRQ;\n\nstatic u_int8_t\nAscSetChipIRQ(iot, ioh, irq_no, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int8_t        irq_no;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tif (irq_no) {\n\t\t\tif ((irq_no < ASC_MIN_IRQ_NO) || (irq_no > ASC_MAX_IRQ_NO))\n\t\t\t\tirq_no = 0;\n\t\t\telse\n\t\t\t\tirq_no -= ASC_MIN_IRQ_NO - 1;\n\t\t}\n\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE3;\n\t\tcfg_lsw |= 0x0010;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFE0;\n\t\tcfg_lsw |= (irq_no & 0x07) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\t\tAscToggleIRQAct(iot, ioh);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\tif (bus_type & ASC_IS_ISA) {\n\t\tif (irq_no == 15)\n\t\t\tirq_no -= 2;\n\t\tirq_no -= ASC_MIN_IRQ_NO;\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0xFFF3;\n\t\tcfg_lsw |= (irq_no & 0x03) << 2;\n\t\tASC_SET_CHIP_CFG_LSW(iot, ioh, cfg_lsw);\n\n\t\treturn (AscGetChipIRQ(iot, ioh, bus_type));\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh",
            "cfg_msw"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscSetChipScsiID;\nstatic u_int8_t AscGetChipVersion;\nstatic u_int8_t AscSetChipIRQ;\nstatic u_int16_t AscSetIsaDmaChannel;\nstatic u_int8_t AscSetIsaDmaSpeed;\n\nu_int16_t\nAscInitFromASC_SOFTC(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tu_int16_t       cfg_msw;\n\tu_int16_t       warn_code;\n\tu_int16_t       pci_device_id = sc->pci_device_id;\n\n\n\twarn_code = 0;\n\tcfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\n\tif ((cfg_msw & ASC_CFG_MSW_CLR_MASK) != 0) {\n\t\tcfg_msw &= (~(ASC_CFG_MSW_CLR_MASK));\n\t\twarn_code |= ASC_WARN_CFG_MSW_RECOVER;\n\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\t}\n\tif ((sc->cmd_qng_enabled & sc->disc_enable) != sc->cmd_qng_enabled) {\n\t\tsc->disc_enable = sc->cmd_qng_enabled;\n\t\twarn_code |= ASC_WARN_CMD_QNG_CONFLICT;\n\t}\n\tif (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_AUTO_CONFIG) {\n\t\twarn_code |= ASC_WARN_AUTO_CONFIG;\n\t}\n\tif ((sc->bus_type & (ASC_IS_ISA | ASC_IS_VL)) != 0) {\n\t\tAscSetChipIRQ(iot, ioh, sc->irq_no, sc->bus_type);\n\t}\n\tif (sc->bus_type & ASC_IS_PCI) {\n\t\tcfg_msw &= 0xFFC0;\n\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\n\t\tif ((sc->bus_type & ASC_IS_PCI_ULTRA) != ASC_IS_PCI_ULTRA) {\n\t\t\tif ((pci_device_id == ASC_PCI_DEVICE_ID_REV_A) ||\n\t\t\t    (pci_device_id == ASC_PCI_DEVICE_ID_REV_B)) {\n\t\t\t\tsc->bug_fix_cntl |= ASC_BUG_FIX_IF_NOT_DWB;\n\t\t\t\tsc->bug_fix_cntl |= ASC_BUG_FIX_ASYN_USE_SYN;\n\t\t\t}\n\t\t}\n\t} else if (sc->bus_type == ASC_IS_ISAPNP) {\n\t\tif (AscGetChipVersion(iot, ioh, sc->bus_type) ==\n\t\t    ASC_CHIP_VER_ASYN_BUG) {\n\t\t\tsc->bug_fix_cntl |= ASC_BUG_FIX_ASYN_USE_SYN;\n\t\t}\n\t}\n\tAscSetChipScsiID(iot, ioh, sc->chip_scsi_id);\n\n\tif (sc->bus_type & ASC_IS_ISA) {\n\t\tAscSetIsaDmaChannel(iot, ioh, sc->isa_dma_channel);\n\t\tAscSetIsaDmaSpeed(iot, ioh, sc->isa_dma_speed);\n\t}\n\treturn (warn_code);\n}"
  },
  {
    "function_name": "AscInitFromEEP",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "353-520",
    "snippet": "u_int16_t\nAscInitFromEEP(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASCEEP_CONFIG   eep_config_buf;\n\tASCEEP_CONFIG  *eep_config;\n\tu_int16_t       chksum;\n\tu_int16_t       warn_code;\n\tu_int16_t       cfg_msw, cfg_lsw;\n\tint             i;\n\tint             write_eep = 0;\n\n\n\twarn_code = 0;\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0x00FE);\n\tAscStopQueueExe(iot, ioh);\n\tif ((AscStopChip(iot, ioh) == FALSE) ||\n\t    (AscGetChipScsiCtrl(iot, ioh) != 0)) {\n\t\tAscResetChipAndScsiBus(iot, ioh);\n\t\tDvcSleepMilliSecond(sc->scsi_reset_wait * 1000);\n\t}\n\tif (AscIsChipHalted(iot, ioh) == FALSE)\n\t\treturn (-1);\n\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR)\n\t\treturn (-2);\n\n\teep_config = &eep_config_buf;\n\tcfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tif ((cfg_msw & ASC_CFG_MSW_CLR_MASK) != 0) {\n\t\tcfg_msw &= (~(ASC_CFG_MSW_CLR_MASK));\n\t\twarn_code |= ASC_WARN_CFG_MSW_RECOVER;\n\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\t}\n\tchksum = AscGetEEPConfig(iot, ioh, eep_config, sc->bus_type);\n#ifdef ASC_DEBUG\n\tAscPrintEEPConfig(eep_config, chksum);\n#endif\n\tif (chksum == 0)\n\t\tchksum = 0xAA55;\n\n\tif (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_AUTO_CONFIG) {\n\t\twarn_code |= ASC_WARN_AUTO_CONFIG;\n\t\tif (sc->chip_version == 3) {\n\t\t\tif (eep_config->cfg_lsw != cfg_lsw) {\n\t\t\t\twarn_code |= ASC_WARN_EEPROM_RECOVER;\n\t\t\t\teep_config->cfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\t\t}\n\t\t\tif (eep_config->cfg_msw != cfg_msw) {\n\t\t\t\twarn_code |= ASC_WARN_EEPROM_RECOVER;\n\t\t\t\teep_config->cfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\t\t\t}\n\t\t}\n\t}\n\teep_config->cfg_msw &= ~ASC_CFG_MSW_CLR_MASK;\n\teep_config->cfg_lsw |= ASC_CFG0_HOST_INT_ON;\n\n\tif (chksum != eep_config->chksum) {\n\t\tif (AscGetChipVersion(iot, ioh, sc->bus_type) ==\n\t\t    ASC_CHIP_VER_PCI_ULTRA_3050) {\n\t\t\teep_config->init_sdtr = 0xFF;\n\t\t\teep_config->disc_enable = 0xFF;\n\t\t\teep_config->start_motor = 0xFF;\n\t\t\teep_config->use_cmd_qng = 0;\n\t\t\teep_config->max_total_qng = 0xF0;\n\t\t\teep_config->max_tag_qng = 0x20;\n\t\t\teep_config->cntl = 0xBFFF;\n\t\t\teep_config->chip_scsi_id = 7;\n\t\t\teep_config->no_scam = 0;\n\t\t\teep_config->adapter_info[0] = 0;\n\t\t\teep_config->adapter_info[1] = 0;\n\t\t\teep_config->adapter_info[2] = 0;\n\t\t\teep_config->adapter_info[3] = 0;\n#if BYTE_ORDER == BIG_ENDIAN\n\t\t\teep_config->adapter_info[5] = 0;\n\t\t\t/* Indicate EEPROM-less board. */\n\t\t\teep_config->adapter_info[4] = 0xBB;\n#else\n\t\t\teep_config->adapter_info[4] = 0;\n\t\t\t/* Indicate EEPROM-less board. */\n\t\t\teep_config->adapter_info[5] = 0xBB;\n#endif\n\t\t} else {\n\t\t\twrite_eep = 1;\n\t\t\twarn_code |= ASC_WARN_EEPROM_CHKSUM;\n\t\t}\n\t}\n\tsc->sdtr_enable = eep_config->init_sdtr;\n\tsc->disc_enable = eep_config->disc_enable;\n\tsc->cmd_qng_enabled = eep_config->use_cmd_qng;\n\tsc->isa_dma_speed = eep_config->isa_dma_speed;\n\tsc->start_motor = eep_config->start_motor;\n\tsc->dvc_cntl = eep_config->cntl;\n#if BYTE_ORDER == BIG_ENDIAN\n\tsc->adapter_info[0] = eep_config->adapter_info[1];\n\tsc->adapter_info[1] = eep_config->adapter_info[0];\n\tsc->adapter_info[2] = eep_config->adapter_info[3];\n\tsc->adapter_info[3] = eep_config->adapter_info[2];\n\tsc->adapter_info[4] = eep_config->adapter_info[5];\n\tsc->adapter_info[5] = eep_config->adapter_info[4];\n#else\n\tsc->adapter_info[0] = eep_config->adapter_info[0];\n\tsc->adapter_info[1] = eep_config->adapter_info[1];\n\tsc->adapter_info[2] = eep_config->adapter_info[2];\n\tsc->adapter_info[3] = eep_config->adapter_info[3];\n\tsc->adapter_info[4] = eep_config->adapter_info[4];\n\tsc->adapter_info[5] = eep_config->adapter_info[5];\n#endif\n\n\tif (!AscTestExternalLram(iot, ioh)) {\n\t\tif (((sc->bus_type & ASC_IS_PCI_ULTRA) == ASC_IS_PCI_ULTRA)) {\n\t\t\teep_config->max_total_qng = ASC_MAX_PCI_ULTRA_INRAM_TOTAL_QNG;\n\t\t\teep_config->max_tag_qng = ASC_MAX_PCI_ULTRA_INRAM_TAG_QNG;\n\t\t} else {\n\t\t\teep_config->cfg_msw |= 0x0800;\n\t\t\tcfg_msw |= 0x0800;\n\t\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\t\t\teep_config->max_total_qng = ASC_MAX_PCI_INRAM_TOTAL_QNG;\n\t\t\teep_config->max_tag_qng = ASC_MAX_INRAM_TAG_QNG;\n\t\t}\n\t}\n\tif (eep_config->max_total_qng < ASC_MIN_TOTAL_QNG)\n\t\teep_config->max_total_qng = ASC_MIN_TOTAL_QNG;\n\n\tif (eep_config->max_total_qng > ASC_MAX_TOTAL_QNG)\n\t\teep_config->max_total_qng = ASC_MAX_TOTAL_QNG;\n\n\tif (eep_config->max_tag_qng > eep_config->max_total_qng)\n\t\teep_config->max_tag_qng = eep_config->max_total_qng;\n\n\tif (eep_config->max_tag_qng < ASC_MIN_TAG_Q_PER_DVC)\n\t\teep_config->max_tag_qng = ASC_MIN_TAG_Q_PER_DVC;\n\n\tsc->max_total_qng = eep_config->max_total_qng;\n\tif ((eep_config->use_cmd_qng & eep_config->disc_enable) !=\n\t    eep_config->use_cmd_qng) {\n\t\teep_config->disc_enable = eep_config->use_cmd_qng;\n\t\twarn_code |= ASC_WARN_CMD_QNG_CONFLICT;\n\t}\n\tif (sc->bus_type & (ASC_IS_ISA | ASC_IS_VL | ASC_IS_EISA))\n\t\tsc->irq_no = AscGetChipIRQ(iot, ioh, sc->bus_type);\n\n\teep_config->chip_scsi_id &= ASC_MAX_TID;\n\tsc->chip_scsi_id = eep_config->chip_scsi_id;\n\tif (((sc->bus_type & ASC_IS_PCI_ULTRA) == ASC_IS_PCI_ULTRA) &&\n\t    !(sc->dvc_cntl & ASC_CNTL_SDTR_ENABLE_ULTRA)) {\n\t\tsc->host_init_sdtr_index = ASC_SDTR_ULTRA_PCI_10MB_INDEX;\n\t}\n\tfor (i = 0; i <= ASC_MAX_TID; i++) {\n\t\tsc->max_tag_qng[i] = eep_config->max_tag_qng;\n\t\tsc->sdtr_period_offset[i] = ASC_DEF_SDTR_OFFSET |\n\t\t\t(sc->host_init_sdtr_index << 4);\n\t}\n\n\teep_config->cfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\tif (write_eep) {\n\t\tAscSetEEPConfig(iot, ioh, eep_config, sc->bus_type);\n#ifdef ASC_DEBUG\n\t\tAscPrintEEPConfig(eep_config, 0);\n#endif\n\t}\n\n\treturn (warn_code);\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int AscResetChipAndScsiBus",
      "static int AscStopChip",
      "static u_int8_t AscGetChipScsiCtrl",
      "static u_int8_t AscGetChipVersion",
      "static int AscIsChipHalted",
      "static void AscWriteLramWord",
      "static int AscTestExternalLram",
      "static u_int16_t AscGetEEPConfig",
      "static int AscSetEEPConfig",
      "static u_int8_t AscGetChipIRQ",
      "static int AscStopQueueExe",
      "static void DvcSleepMilliSecond"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscPrintEEPConfig",
          "args": [
            "eep_config",
            "0"
          ],
          "line": 515
        },
        "resolved": true,
        "details": {
          "function_name": "AscPrintEEPConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1578-1616",
          "snippet": "static void\nAscPrintEEPConfig(eep_config, chksum)\n\tASCEEP_CONFIG\t*eep_config;\n\tu_int16_t\tchksum;\n{\n\tprintf(\"---- ASC EEprom settings ----\\n\");\n\tprintf(\"cfg_lsw = 0x%x\\n\", eep_config->cfg_lsw);\n\tprintf(\"cfg_msw = 0x%x\\n\", eep_config->cfg_msw);\n\tprintf(\"init_sdtr = 0x%x\\n\", eep_config->init_sdtr);\n\tprintf(\"disc_enable = 0x%x\\n\", eep_config->disc_enable);\n\tprintf(\"use_cmd_qng = %d\\n\", eep_config->use_cmd_qng);\n\tprintf(\"start_motor = 0x%x\\n\", eep_config->start_motor);\n\tprintf(\"max_total_qng = 0x%x\\n\", eep_config->max_total_qng);\n\tprintf(\"max_tag_qng = 0x%x\\n\", eep_config->max_tag_qng);\n\tprintf(\"bios_scan = 0x%x\\n\", eep_config->bios_scan);\n\tprintf(\"power_up_wait = 0x%x\\n\", eep_config->power_up_wait);\n\tprintf(\"no_scam = %d\\n\", eep_config->no_scam);\n\tprintf(\"chip_scsi_id = %d\\n\", eep_config->chip_scsi_id);\n\tprintf(\"isa_dma_speed = %d\\n\", eep_config->isa_dma_speed);\n\tprintf(\"cntl = 0x%x\\n\", eep_config->cntl);\n#if BYTE_ORDER == BIG_ENDIAN\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[5]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[4]);\n#else\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[4]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[5]);\n#endif\n\tprintf(\"checksum = 0x%x\\n\", eep_config->chksum);\n\tprintf(\"calculated checksum = 0x%x\\n\", chksum);\n\tprintf(\"-----------------------------\\n\");\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void\nAscPrintEEPConfig(eep_config, chksum)\n\tASCEEP_CONFIG\t*eep_config;\n\tu_int16_t\tchksum;\n{\n\tprintf(\"---- ASC EEprom settings ----\\n\");\n\tprintf(\"cfg_lsw = 0x%x\\n\", eep_config->cfg_lsw);\n\tprintf(\"cfg_msw = 0x%x\\n\", eep_config->cfg_msw);\n\tprintf(\"init_sdtr = 0x%x\\n\", eep_config->init_sdtr);\n\tprintf(\"disc_enable = 0x%x\\n\", eep_config->disc_enable);\n\tprintf(\"use_cmd_qng = %d\\n\", eep_config->use_cmd_qng);\n\tprintf(\"start_motor = 0x%x\\n\", eep_config->start_motor);\n\tprintf(\"max_total_qng = 0x%x\\n\", eep_config->max_total_qng);\n\tprintf(\"max_tag_qng = 0x%x\\n\", eep_config->max_tag_qng);\n\tprintf(\"bios_scan = 0x%x\\n\", eep_config->bios_scan);\n\tprintf(\"power_up_wait = 0x%x\\n\", eep_config->power_up_wait);\n\tprintf(\"no_scam = %d\\n\", eep_config->no_scam);\n\tprintf(\"chip_scsi_id = %d\\n\", eep_config->chip_scsi_id);\n\tprintf(\"isa_dma_speed = %d\\n\", eep_config->isa_dma_speed);\n\tprintf(\"cntl = 0x%x\\n\", eep_config->cntl);\n#if BYTE_ORDER == BIG_ENDIAN\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[5]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[4]);\n#else\n\tprintf(\"adapter_info[0] = 0x%x\\n\", eep_config->adapter_info[0]);\n\tprintf(\"adapter_info[1] = 0x%x\\n\", eep_config->adapter_info[1]);\n\tprintf(\"adapter_info[2] = 0x%x\\n\", eep_config->adapter_info[2]);\n\tprintf(\"adapter_info[3] = 0x%x\\n\", eep_config->adapter_info[3]);\n\tprintf(\"adapter_info[4] = 0x%x\\n\", eep_config->adapter_info[4]);\n\tprintf(\"adapter_info[5] = 0x%x\\n\", eep_config->adapter_info[5]);\n#endif\n\tprintf(\"checksum = 0x%x\\n\", eep_config->chksum);\n\tprintf(\"calculated checksum = 0x%x\\n\", chksum);\n\tprintf(\"-----------------------------\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscSetEEPConfig",
          "args": [
            "iot",
            "ioh",
            "eep_config",
            "sc->bus_type"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "AscSetEEPConfigOnce",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1520-1574",
          "snippet": "static int\nAscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             n_error;\n\tu_int16_t      *wbuf;\n\tu_int16_t       sum;\n\tint             s_addr;\n\tint             cfg_beg;\n\tint             cfg_end;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tn_error = 0;\n\tsum = 0;\n\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\t*wbuf = sum;\n\tif (sum != AscWriteEEPWord(iot, ioh, s_addr, sum))\n\t\tn_error++;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= cfg_end; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\treturn (n_error);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadEEPWord",
            "static u_int16_t AscWriteEEPWord",
            "static int AscSetEEPConfigOnce"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscWriteEEPWord;\nstatic int AscSetEEPConfigOnce;\n\nstatic int\nAscSetEEPConfigOnce(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tint             n_error;\n\tu_int16_t      *wbuf;\n\tu_int16_t       sum;\n\tint             s_addr;\n\tint             cfg_beg;\n\tint             cfg_end;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tn_error = 0;\n\tsum = 0;\n\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\tsum += *wbuf;\n\t\tif (*wbuf != AscWriteEEPWord(iot, ioh, s_addr, *wbuf))\n\t\t\tn_error++;\n\t}\n\n\t*wbuf = sum;\n\tif (sum != AscWriteEEPWord(iot, ioh, s_addr, sum))\n\t\tn_error++;\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tfor (s_addr = 0; s_addr < 2; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= cfg_end; s_addr++, wbuf++) {\n\t\tif (*wbuf != AscReadEEPWord(iot, ioh, s_addr))\n\t\t\tn_error++;\n\t}\n\n\treturn (n_error);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscGetChipIRQ",
          "args": [
            "iot",
            "ioh",
            "sc->bus_type"
          ],
          "line": 497
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipIRQ",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2083-2115",
          "snippet": "static u_int8_t\nAscGetChipIRQ(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        chip_irq;\n\n\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * cfg_lsw = AscGetEisaChipCfg(iot, ioh); chip_irq =\n\t\t * ((cfg_lsw >> 8) & 0x07) + 10; if((chip_irq == 13) ||\n\t\t * (chip_irq > 15)) return (0); return(chip_irq);\n\t\t */\n\t}\n\tif ((bus_type & ASC_IS_VL) != 0) {\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\tchip_irq = (cfg_lsw >> 2) & 0x07;\n\t\tif ((chip_irq == 0) ||\n\t\t    (chip_irq == 4) ||\n\t\t    (chip_irq == 7)) {\n\t\t\treturn (0);\n\t\t}\n\t\treturn (chip_irq + (ASC_MIN_IRQ_NO - 1));\n\t}\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tchip_irq = (cfg_lsw >> 2) & 0x03;\n\tif (chip_irq == 3)\n\t\tchip_irq += 2;\n\treturn (chip_irq + ASC_MIN_IRQ_NO);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetChipIRQ"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipIRQ;\n\nstatic u_int8_t\nAscGetChipIRQ(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       cfg_lsw;\n\tu_int8_t        chip_irq;\n\n\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * cfg_lsw = AscGetEisaChipCfg(iot, ioh); chip_irq =\n\t\t * ((cfg_lsw >> 8) & 0x07) + 10; if((chip_irq == 13) ||\n\t\t * (chip_irq > 15)) return (0); return(chip_irq);\n\t\t */\n\t}\n\tif ((bus_type & ASC_IS_VL) != 0) {\n\t\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\tchip_irq = (cfg_lsw >> 2) & 0x07;\n\t\tif ((chip_irq == 0) ||\n\t\t    (chip_irq == 4) ||\n\t\t    (chip_irq == 7)) {\n\t\t\treturn (0);\n\t\t}\n\t\treturn (chip_irq + (ASC_MIN_IRQ_NO - 1));\n\t}\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tchip_irq = (cfg_lsw >> 2) & 0x03;\n\tif (chip_irq == 3)\n\t\tchip_irq += 2;\n\treturn (chip_irq + ASC_MIN_IRQ_NO);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh",
            "cfg_msw"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscTestExternalLram",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "AscTestExternalLram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1198-1221",
          "snippet": "static int\nAscTestExternalLram(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       q_addr;\n\tu_int16_t       saved_word;\n\tint             retval;\n\n\n\tretval = 0;\n\tq_addr = ASC_QNO_TO_QADDR(241);\n\tsaved_word = AscReadLramWord(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, 0x55AA);\n\tDvcSleepMilliSecond(10);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\n\tif (ASC_GET_CHIP_LRAM_DATA(iot, ioh) == 0x55AA) {\n\t\tretval = 1;\n\t\tAscWriteLramWord(iot, ioh, q_addr, saved_word);\n\t}\n\treturn (retval);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadLramWord",
            "static void AscWriteLramWord",
            "static int AscTestExternalLram",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadLramWord;\nstatic void AscWriteLramWord;\nstatic int AscTestExternalLram;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscTestExternalLram(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       q_addr;\n\tu_int16_t       saved_word;\n\tint             retval;\n\n\n\tretval = 0;\n\tq_addr = ASC_QNO_TO_QADDR(241);\n\tsaved_word = AscReadLramWord(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, 0x55AA);\n\tDvcSleepMilliSecond(10);\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, q_addr);\n\n\tif (ASC_GET_CHIP_LRAM_DATA(iot, ioh) == 0x55AA) {\n\t\tretval = 1;\n\t\tAscWriteLramWord(iot, ioh, q_addr, saved_word);\n\t}\n\treturn (retval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetChipVersion",
          "args": [
            "iot",
            "ioh",
            "sc->bus_type"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipVersion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "838-854",
          "snippet": "static u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetChipVersion"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipVersion;\n\nstatic u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscGetEEPConfig",
          "args": [
            "iot",
            "ioh",
            "eep_config",
            "sc->bus_type"
          ],
          "line": 391
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetEEPConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1451-1494",
          "snippet": "static u_int16_t\nAscGetEEPConfig(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       wval;\n\tu_int16_t       sum;\n\tu_int16_t      *wbuf;\n\tint             cfg_beg;\n\tint             cfg_end;\n\tint             s_addr;\n\tint             isa_pnp_wsize;\n\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tsum = 0;\n\tisa_pnp_wsize = 0;\n\n\tfor (s_addr = 0; s_addr < (2 + isa_pnp_wsize); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\t*wbuf = AscReadEEPWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscReadEEPWord",
            "static u_int16_t AscGetEEPConfig"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscReadEEPWord;\nstatic u_int16_t AscGetEEPConfig;\n\nstatic u_int16_t\nAscGetEEPConfig(iot, ioh, cfg_buf, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tASCEEP_CONFIG  *cfg_buf;\n\tu_int16_t       bus_type;\n{\n\tu_int16_t       wval;\n\tu_int16_t       sum;\n\tu_int16_t      *wbuf;\n\tint             cfg_beg;\n\tint             cfg_end;\n\tint             s_addr;\n\tint             isa_pnp_wsize;\n\n\n\twbuf = (u_int16_t *) cfg_buf;\n\tsum = 0;\n\tisa_pnp_wsize = 0;\n\n\tfor (s_addr = 0; s_addr < (2 + isa_pnp_wsize); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\tif (bus_type & ASC_IS_VL) {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG_VL;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR_VL;\n\t} else {\n\t\tcfg_beg = ASC_EEP_DVC_CFG_BEG;\n\t\tcfg_end = ASC_EEP_MAX_DVC_ADDR;\n\t}\n\n\tfor (s_addr = cfg_beg; s_addr <= (cfg_end - 1); s_addr++, wbuf++) {\n\t\twval = AscReadEEPWord(iot, ioh, s_addr);\n\t\tsum += wval;\n\t\t*wbuf = wval;\n\t}\n\n\t*wbuf = AscReadEEPWord(iot, ioh, s_addr);\n\n\treturn (sum);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh",
            "cfg_msw"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_LSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_CHIP_CFG_MSW",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_GET_PC_ADDR",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_PC_ADDR",
          "args": [
            "iot",
            "ioh",
            "ASC_MCODE_START_ADDR"
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscIsChipHalted",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "AscIsChipHalted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "971-981",
          "snippet": "static int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscIsChipHalted"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscIsChipHalted;\n\nstatic int\nAscIsChipHalted(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) != 0)\n\t\tif ((ASC_GET_CHIP_CONTROL(iot, ioh) & ASC_CC_HALT) != 0)\n\t\t\treturn (1);\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DvcSleepMilliSecond",
          "args": [
            "sc->scsi_reset_wait * 1000"
          ],
          "line": 374
        },
        "resolved": true,
        "details": {
          "function_name": "DvcSleepMilliSecond",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "3444-3450",
          "snippet": "static void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void DvcSleepMilliSecond;\n\nstatic void\nDvcSleepMilliSecond(n)\n\tu_int32_t       n;\n{\n\n\tDELAY(n * 1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscResetChipAndScsiBus",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "AscResetChipAndScsiBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "708-732",
          "snippet": "static int\nAscResetChipAndScsiBus(bus_space_tag_t iot,\n\t\t       bus_space_handle_t ioh)\n{\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\tAscStopChip(iot, ioh);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT);\n\n\tDvcDelayNanoSecond(60000);\n\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\n\tDvcSleepMilliSecond(200);\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\tAscStartChip(iot, ioh);\n\n\tDvcSleepMilliSecond(200);\n\n\treturn (AscIsChipHalted(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscResetChipAndScsiBus",
            "static int AscStartChip",
            "static int AscStopChip",
            "static int AscIsChipHalted",
            "static void AscSetChipIH",
            "static void DvcSleepMilliSecond",
            "static void DvcDelayNanoSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscResetChipAndScsiBus;\nstatic int AscStartChip;\nstatic int AscStopChip;\nstatic int AscIsChipHalted;\nstatic void AscSetChipIH;\nstatic void DvcSleepMilliSecond;\nstatic void DvcDelayNanoSecond;\n\nstatic int\nAscResetChipAndScsiBus(bus_space_tag_t iot,\n\t\t       bus_space_handle_t ioh)\n{\n\twhile (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_SCSI_RESET_ACTIVE);\n\n\tAscStopChip(iot, ioh);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_SCSI_RESET | ASC_CC_HALT);\n\n\tDvcDelayNanoSecond(60000);\n\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_CHIP_RESET | ASC_CC_HALT);\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\n\tDvcSleepMilliSecond(200);\n\n\tASC_SET_CHIP_STATUS(iot, ioh, ASC_CIW_CLR_SCSI_RESET_INT);\n\tAscStartChip(iot, ioh);\n\n\tDvcSleepMilliSecond(200);\n\n\treturn (AscIsChipHalted(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetChipScsiCtrl",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipScsiCtrl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "876-887",
          "snippet": "static u_int8_t\nAscGetChipScsiCtrl(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        scsi_ctrl;\n\n\tAscSetBank(iot, ioh, 1);\n\tscsi_ctrl = bus_space_read_1(iot, ioh, ASC_IOP_REG_SC);\n\tAscSetBank(iot, ioh, 0);\n\treturn (scsi_ctrl);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscSetBank",
            "static u_int8_t AscGetChipScsiCtrl"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscSetBank;\nstatic u_int8_t AscGetChipScsiCtrl;\n\nstatic u_int8_t\nAscGetChipScsiCtrl(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        scsi_ctrl;\n\n\tAscSetBank(iot, ioh, 1);\n\tscsi_ctrl = bus_space_read_1(iot, ioh, ASC_IOP_REG_SC);\n\tAscSetBank(iot, ioh, 0);\n\treturn (scsi_ctrl);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStopChip",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopChip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "819-835",
          "snippet": "static int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int AscStopChip",
            "static void AscSetChipIH"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscStopChip;\nstatic void AscSetChipIH;\n\nstatic int\nAscStopChip(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int8_t        cc_val;\n\n\tcc_val = ASC_GET_CHIP_CONTROL(iot, ioh) &\n\t\t(~(ASC_CC_SINGLE_STEP | ASC_CC_TEST | ASC_CC_DIAG));\n\tASC_SET_CHIP_CONTROL(iot, ioh, cc_val | ASC_CC_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_HALT);\n\tAscSetChipIH(iot, ioh, ASC_INS_RFLAG_WTM);\n\tif ((ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_HALTED) == 0)\n\t\treturn (0);\n\n\treturn (1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscStopQueueExe",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 370
        },
        "resolved": true,
        "details": {
          "function_name": "AscStopQueueExe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2923-2941",
          "snippet": "static int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscReadLramByte",
            "static void AscWriteLramByte",
            "static int AscStopQueueExe",
            "static void DvcSleepMilliSecond"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscReadLramByte;\nstatic void AscWriteLramByte;\nstatic int AscStopQueueExe;\nstatic void DvcSleepMilliSecond;\n\nstatic int\nAscStopQueueExe(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint             count = 0;\n\n\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) == 0) {\n\t\tAscWriteLramByte(iot, ioh, ASCV_STOP_CODE_B, ASC_STOP_REQ_RISC_STOP);\n\t\tdo {\n\t\t\tif (AscReadLramByte(iot, ioh, ASCV_STOP_CODE_B) &\n\t\t\t    ASC_STOP_ACK_RISC_STOP)\n\t\t\t\treturn (1);\n\n\t\t\tDvcSleepMilliSecond(100);\n\t\t} while (count++ < 20);\n\t}\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscWriteLramWord",
          "args": [
            "iot",
            "ioh",
            "ASCV_HALTCODE_W",
            "0x00FE"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "AscWriteLramWord",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "1066-1076",
          "snippet": "static void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void AscWriteLramWord"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic void AscWriteLramWord;\n\nstatic void\nAscWriteLramWord(iot, ioh, addr, data)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       addr;\n\tu_int16_t       data;\n{\n\n\tASC_SET_CHIP_LRAM_ADDR(iot, ioh, addr);\n\tASC_SET_CHIP_LRAM_DATA(iot, ioh, data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic int AscResetChipAndScsiBus;\nstatic int AscStopChip;\nstatic u_int8_t AscGetChipScsiCtrl;\nstatic u_int8_t AscGetChipVersion;\nstatic int AscIsChipHalted;\nstatic void AscWriteLramWord;\nstatic int AscTestExternalLram;\nstatic u_int16_t AscGetEEPConfig;\nstatic int AscSetEEPConfig;\nstatic u_int8_t AscGetChipIRQ;\nstatic int AscStopQueueExe;\nstatic void DvcSleepMilliSecond;\n\nu_int16_t\nAscInitFromEEP(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tASCEEP_CONFIG   eep_config_buf;\n\tASCEEP_CONFIG  *eep_config;\n\tu_int16_t       chksum;\n\tu_int16_t       warn_code;\n\tu_int16_t       cfg_msw, cfg_lsw;\n\tint             i;\n\tint             write_eep = 0;\n\n\n\twarn_code = 0;\n\tAscWriteLramWord(iot, ioh, ASCV_HALTCODE_W, 0x00FE);\n\tAscStopQueueExe(iot, ioh);\n\tif ((AscStopChip(iot, ioh) == FALSE) ||\n\t    (AscGetChipScsiCtrl(iot, ioh) != 0)) {\n\t\tAscResetChipAndScsiBus(iot, ioh);\n\t\tDvcSleepMilliSecond(sc->scsi_reset_wait * 1000);\n\t}\n\tif (AscIsChipHalted(iot, ioh) == FALSE)\n\t\treturn (-1);\n\n\tASC_SET_PC_ADDR(iot, ioh, ASC_MCODE_START_ADDR);\n\tif (ASC_GET_PC_ADDR(iot, ioh) != ASC_MCODE_START_ADDR)\n\t\treturn (-2);\n\n\teep_config = &eep_config_buf;\n\tcfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\tcfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\tif ((cfg_msw & ASC_CFG_MSW_CLR_MASK) != 0) {\n\t\tcfg_msw &= (~(ASC_CFG_MSW_CLR_MASK));\n\t\twarn_code |= ASC_WARN_CFG_MSW_RECOVER;\n\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\t}\n\tchksum = AscGetEEPConfig(iot, ioh, eep_config, sc->bus_type);\n#ifdef ASC_DEBUG\n\tAscPrintEEPConfig(eep_config, chksum);\n#endif\n\tif (chksum == 0)\n\t\tchksum = 0xAA55;\n\n\tif (ASC_GET_CHIP_STATUS(iot, ioh) & ASC_CSW_AUTO_CONFIG) {\n\t\twarn_code |= ASC_WARN_AUTO_CONFIG;\n\t\tif (sc->chip_version == 3) {\n\t\t\tif (eep_config->cfg_lsw != cfg_lsw) {\n\t\t\t\twarn_code |= ASC_WARN_EEPROM_RECOVER;\n\t\t\t\teep_config->cfg_lsw = ASC_GET_CHIP_CFG_LSW(iot, ioh);\n\t\t\t}\n\t\t\tif (eep_config->cfg_msw != cfg_msw) {\n\t\t\t\twarn_code |= ASC_WARN_EEPROM_RECOVER;\n\t\t\t\teep_config->cfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\t\t\t}\n\t\t}\n\t}\n\teep_config->cfg_msw &= ~ASC_CFG_MSW_CLR_MASK;\n\teep_config->cfg_lsw |= ASC_CFG0_HOST_INT_ON;\n\n\tif (chksum != eep_config->chksum) {\n\t\tif (AscGetChipVersion(iot, ioh, sc->bus_type) ==\n\t\t    ASC_CHIP_VER_PCI_ULTRA_3050) {\n\t\t\teep_config->init_sdtr = 0xFF;\n\t\t\teep_config->disc_enable = 0xFF;\n\t\t\teep_config->start_motor = 0xFF;\n\t\t\teep_config->use_cmd_qng = 0;\n\t\t\teep_config->max_total_qng = 0xF0;\n\t\t\teep_config->max_tag_qng = 0x20;\n\t\t\teep_config->cntl = 0xBFFF;\n\t\t\teep_config->chip_scsi_id = 7;\n\t\t\teep_config->no_scam = 0;\n\t\t\teep_config->adapter_info[0] = 0;\n\t\t\teep_config->adapter_info[1] = 0;\n\t\t\teep_config->adapter_info[2] = 0;\n\t\t\teep_config->adapter_info[3] = 0;\n#if BYTE_ORDER == BIG_ENDIAN\n\t\t\teep_config->adapter_info[5] = 0;\n\t\t\t/* Indicate EEPROM-less board. */\n\t\t\teep_config->adapter_info[4] = 0xBB;\n#else\n\t\t\teep_config->adapter_info[4] = 0;\n\t\t\t/* Indicate EEPROM-less board. */\n\t\t\teep_config->adapter_info[5] = 0xBB;\n#endif\n\t\t} else {\n\t\t\twrite_eep = 1;\n\t\t\twarn_code |= ASC_WARN_EEPROM_CHKSUM;\n\t\t}\n\t}\n\tsc->sdtr_enable = eep_config->init_sdtr;\n\tsc->disc_enable = eep_config->disc_enable;\n\tsc->cmd_qng_enabled = eep_config->use_cmd_qng;\n\tsc->isa_dma_speed = eep_config->isa_dma_speed;\n\tsc->start_motor = eep_config->start_motor;\n\tsc->dvc_cntl = eep_config->cntl;\n#if BYTE_ORDER == BIG_ENDIAN\n\tsc->adapter_info[0] = eep_config->adapter_info[1];\n\tsc->adapter_info[1] = eep_config->adapter_info[0];\n\tsc->adapter_info[2] = eep_config->adapter_info[3];\n\tsc->adapter_info[3] = eep_config->adapter_info[2];\n\tsc->adapter_info[4] = eep_config->adapter_info[5];\n\tsc->adapter_info[5] = eep_config->adapter_info[4];\n#else\n\tsc->adapter_info[0] = eep_config->adapter_info[0];\n\tsc->adapter_info[1] = eep_config->adapter_info[1];\n\tsc->adapter_info[2] = eep_config->adapter_info[2];\n\tsc->adapter_info[3] = eep_config->adapter_info[3];\n\tsc->adapter_info[4] = eep_config->adapter_info[4];\n\tsc->adapter_info[5] = eep_config->adapter_info[5];\n#endif\n\n\tif (!AscTestExternalLram(iot, ioh)) {\n\t\tif (((sc->bus_type & ASC_IS_PCI_ULTRA) == ASC_IS_PCI_ULTRA)) {\n\t\t\teep_config->max_total_qng = ASC_MAX_PCI_ULTRA_INRAM_TOTAL_QNG;\n\t\t\teep_config->max_tag_qng = ASC_MAX_PCI_ULTRA_INRAM_TAG_QNG;\n\t\t} else {\n\t\t\teep_config->cfg_msw |= 0x0800;\n\t\t\tcfg_msw |= 0x0800;\n\t\t\tASC_SET_CHIP_CFG_MSW(iot, ioh, cfg_msw);\n\t\t\teep_config->max_total_qng = ASC_MAX_PCI_INRAM_TOTAL_QNG;\n\t\t\teep_config->max_tag_qng = ASC_MAX_INRAM_TAG_QNG;\n\t\t}\n\t}\n\tif (eep_config->max_total_qng < ASC_MIN_TOTAL_QNG)\n\t\teep_config->max_total_qng = ASC_MIN_TOTAL_QNG;\n\n\tif (eep_config->max_total_qng > ASC_MAX_TOTAL_QNG)\n\t\teep_config->max_total_qng = ASC_MAX_TOTAL_QNG;\n\n\tif (eep_config->max_tag_qng > eep_config->max_total_qng)\n\t\teep_config->max_tag_qng = eep_config->max_total_qng;\n\n\tif (eep_config->max_tag_qng < ASC_MIN_TAG_Q_PER_DVC)\n\t\teep_config->max_tag_qng = ASC_MIN_TAG_Q_PER_DVC;\n\n\tsc->max_total_qng = eep_config->max_total_qng;\n\tif ((eep_config->use_cmd_qng & eep_config->disc_enable) !=\n\t    eep_config->use_cmd_qng) {\n\t\teep_config->disc_enable = eep_config->use_cmd_qng;\n\t\twarn_code |= ASC_WARN_CMD_QNG_CONFLICT;\n\t}\n\tif (sc->bus_type & (ASC_IS_ISA | ASC_IS_VL | ASC_IS_EISA))\n\t\tsc->irq_no = AscGetChipIRQ(iot, ioh, sc->bus_type);\n\n\teep_config->chip_scsi_id &= ASC_MAX_TID;\n\tsc->chip_scsi_id = eep_config->chip_scsi_id;\n\tif (((sc->bus_type & ASC_IS_PCI_ULTRA) == ASC_IS_PCI_ULTRA) &&\n\t    !(sc->dvc_cntl & ASC_CNTL_SDTR_ENABLE_ULTRA)) {\n\t\tsc->host_init_sdtr_index = ASC_SDTR_ULTRA_PCI_10MB_INDEX;\n\t}\n\tfor (i = 0; i <= ASC_MAX_TID; i++) {\n\t\tsc->max_tag_qng[i] = eep_config->max_tag_qng;\n\t\tsc->sdtr_period_offset[i] = ASC_DEF_SDTR_OFFSET |\n\t\t\t(sc->host_init_sdtr_index << 4);\n\t}\n\n\teep_config->cfg_msw = ASC_GET_CHIP_CFG_MSW(iot, ioh);\n\tif (write_eep) {\n\t\tAscSetEEPConfig(iot, ioh, eep_config, sc->bus_type);\n#ifdef ASC_DEBUG\n\t\tAscPrintEEPConfig(eep_config, 0);\n#endif\n\t}\n\n\treturn (warn_code);\n}"
  },
  {
    "function_name": "AscInitASC_SOFTC",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
    "lines": "253-346",
    "snippet": "void\nAscInitASC_SOFTC(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             i;\n\tu_int8_t        chip_version;\n\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\n\tsc->bug_fix_cntl = 0;\n\tsc->pci_fix_asyn_xfer = 0;\n\tsc->pci_fix_asyn_xfer_always = 0;\n\tsc->sdtr_done = 0;\n\tsc->cur_total_qng = 0;\n\tsc->last_q_shortage = 0;\n\tsc->use_tagged_qng = 0;\n\tsc->unit_not_ready = 0;\n\tsc->queue_full_or_busy = 0;\n\tsc->host_init_sdtr_index = 0;\n\tsc->can_tagged_qng = 0;\n\tsc->cmd_qng_enabled = 0;\n\tsc->dvc_cntl = ASC_DEF_DVC_CNTL;\n\tsc->init_sdtr = 0;\n\tsc->max_total_qng = ASC_DEF_MAX_TOTAL_QNG;\n\tsc->scsi_reset_wait = 3;\n\tsc->start_motor = ASC_SCSI_WIDTH_BIT_SET;\n\tsc->max_dma_count = AscGetMaxDmaCount(sc->bus_type);\n\tsc->sdtr_enable = ASC_SCSI_WIDTH_BIT_SET;\n\tsc->disc_enable = ASC_SCSI_WIDTH_BIT_SET;\n\tsc->chip_scsi_id = ASC_DEF_CHIP_SCSI_ID;\n\tsc->lib_serial_no = ASC_LIB_SERIAL_NUMBER;\n\tsc->lib_version = (ASC_LIB_VERSION_MAJOR << 8) | ASC_LIB_VERSION_MINOR;\n\tchip_version = AscGetChipVersion(iot, ioh, sc->bus_type);\n\tsc->chip_version = chip_version;\n\tif ((sc->bus_type & ASC_IS_PCI) &&\n\t    (chip_version >= ASC_CHIP_VER_PCI_ULTRA_3150)) {\n\t\tsc->bus_type = ASC_IS_PCI_ULTRA;\n\t\tsc->sdtr_period_tbl[0] = SYN_ULTRA_XFER_NS_0;\n\t\tsc->sdtr_period_tbl[1] = SYN_ULTRA_XFER_NS_1;\n\t\tsc->sdtr_period_tbl[2] = SYN_ULTRA_XFER_NS_2;\n\t\tsc->sdtr_period_tbl[3] = SYN_ULTRA_XFER_NS_3;\n\t\tsc->sdtr_period_tbl[4] = SYN_ULTRA_XFER_NS_4;\n\t\tsc->sdtr_period_tbl[5] = SYN_ULTRA_XFER_NS_5;\n\t\tsc->sdtr_period_tbl[6] = SYN_ULTRA_XFER_NS_6;\n\t\tsc->sdtr_period_tbl[7] = SYN_ULTRA_XFER_NS_7;\n\t\tsc->sdtr_period_tbl[8] = SYN_ULTRA_XFER_NS_8;\n\t\tsc->sdtr_period_tbl[9] = SYN_ULTRA_XFER_NS_9;\n\t\tsc->sdtr_period_tbl[10] = SYN_ULTRA_XFER_NS_10;\n\t\tsc->sdtr_period_tbl[11] = SYN_ULTRA_XFER_NS_11;\n\t\tsc->sdtr_period_tbl[12] = SYN_ULTRA_XFER_NS_12;\n\t\tsc->sdtr_period_tbl[13] = SYN_ULTRA_XFER_NS_13;\n\t\tsc->sdtr_period_tbl[14] = SYN_ULTRA_XFER_NS_14;\n\t\tsc->sdtr_period_tbl[15] = SYN_ULTRA_XFER_NS_15;\n\t\tsc->max_sdtr_index = 15;\n\t\tif (chip_version == ASC_CHIP_VER_PCI_ULTRA_3150)\n\t\t\tASC_SET_EXTRA_CONTROL(iot, ioh,\n\t\t\t\t       (SEC_ACTIVE_NEGATE | SEC_SLEW_RATE));\n\t\telse if (chip_version >= ASC_CHIP_VER_PCI_ULTRA_3050)\n\t\t\tASC_SET_EXTRA_CONTROL(iot, ioh,\n\t\t\t\t   (SEC_ACTIVE_NEGATE | SEC_ENABLE_FILTER));\n\t} else {\n\t\tsc->sdtr_period_tbl[0] = SYN_XFER_NS_0;\n\t\tsc->sdtr_period_tbl[1] = SYN_XFER_NS_1;\n\t\tsc->sdtr_period_tbl[2] = SYN_XFER_NS_2;\n\t\tsc->sdtr_period_tbl[3] = SYN_XFER_NS_3;\n\t\tsc->sdtr_period_tbl[4] = SYN_XFER_NS_4;\n\t\tsc->sdtr_period_tbl[5] = SYN_XFER_NS_5;\n\t\tsc->sdtr_period_tbl[6] = SYN_XFER_NS_6;\n\t\tsc->sdtr_period_tbl[7] = SYN_XFER_NS_7;\n\t\tsc->max_sdtr_index = 7;\n\t}\n\n\tif (sc->bus_type == ASC_IS_PCI)\n\t\tASC_SET_EXTRA_CONTROL(iot, ioh,\n\t\t\t\t      (SEC_ACTIVE_NEGATE | SEC_SLEW_RATE));\n\n\tsc->isa_dma_speed = ASC_DEF_ISA_DMA_SPEED;\n\tif (AscGetChipBusType(iot, ioh) == ASC_IS_ISAPNP) {\n\t\tASC_SET_CHIP_IFC(iot, ioh, ASC_IFC_INIT_DEFAULT);\n\t\tsc->bus_type = ASC_IS_ISAPNP;\n\t}\n\tif ((sc->bus_type & ASC_IS_ISA) != 0)\n\t\tsc->isa_dma_channel = AscGetIsaDmaChannel(iot, ioh);\n\n\tfor (i = 0; i <= ASC_MAX_TID; i++) {\n\t\tsc->cur_dvc_qng[i] = 0;\n\t\tsc->max_dvc_qng[i] = ASC_MAX_SCSI1_QNG;\n\t\tsc->max_tag_qng[i] = ASC_MAX_INRAM_TAG_QNG;\n\t}\n}",
    "includes": [
      "#include <dev/ic/advmcode.h>",
      "#include <dev/ic/advlib.h>",
      "#include <dev/ic/adv.h>",
      "#include <vm/pmap.h>",
      "#include <vm/vm_param.h>",
      "#include <vm/vm.h>",
      "#include <scsi/scsiconf.h>",
      "#include <scsi/scsi_all.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/device.h>",
      "#include <sys/queue.h>",
      "#include <sys/kernel.h>",
      "#include <sys/malloc.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include <sys/types.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static u_int16_t AscGetChipBusType",
      "static u_int8_t AscGetChipVersion",
      "static u_int32_t AscGetMaxDmaCount",
      "static u_int16_t AscGetIsaDmaChannel"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "AscGetIsaDmaChannel",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetIsaDmaChannel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2207-2220",
          "snippet": "static u_int16_t\nAscGetIsaDmaChannel(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       channel;\n\n\tchannel = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0x0003;\n\tif (channel == 0x03)\n\t\treturn (0);\n\telse if (channel == 0x00)\n\t\treturn (7);\n\treturn (channel + 4);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscGetIsaDmaChannel"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetIsaDmaChannel;\n\nstatic u_int16_t\nAscGetIsaDmaChannel(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       channel;\n\n\tchannel = ASC_GET_CHIP_CFG_LSW(iot, ioh) & 0x0003;\n\tif (channel == 0x03)\n\t\treturn (0);\n\telse if (channel == 0x00)\n\t\treturn (7);\n\treturn (channel + 4);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_IFC",
          "args": [
            "iot",
            "ioh",
            "ASC_IFC_INIT_DEFAULT"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscGetChipBusType",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipBusType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "735-762",
          "snippet": "static u_int16_t\nAscGetChipBusType(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       chip_ver;\n\n\tchip_ver = ASC_GET_CHIP_VER_NO(iot, ioh);\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_VL) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_VL)) {\n\t\t/*\n\t\t * if(((iop_base & 0x0C30) == 0x0C30) || ((iop_base & 0x0C50)\n\t\t * == 0x0C50)) return (ASC_IS_EISA);\n\t\t */\n\t\treturn (ASC_IS_VL);\n\t}\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_ISA) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_ISA)) {\n\t\tif (chip_ver >= ASC_CHIP_MIN_VER_ISA_PNP)\n\t\t\treturn (ASC_IS_ISAPNP);\n\n\t\treturn (ASC_IS_ISA);\n\t} else if ((chip_ver >= ASC_CHIP_MIN_VER_PCI) &&\n\t\t   (chip_ver <= ASC_CHIP_MAX_VER_PCI))\n\t\treturn (ASC_IS_PCI);\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int16_t AscGetChipBusType"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetChipBusType;\n\nstatic u_int16_t\nAscGetChipBusType(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tu_int16_t       chip_ver;\n\n\tchip_ver = ASC_GET_CHIP_VER_NO(iot, ioh);\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_VL) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_VL)) {\n\t\t/*\n\t\t * if(((iop_base & 0x0C30) == 0x0C30) || ((iop_base & 0x0C50)\n\t\t * == 0x0C50)) return (ASC_IS_EISA);\n\t\t */\n\t\treturn (ASC_IS_VL);\n\t}\n\tif ((chip_ver >= ASC_CHIP_MIN_VER_ISA) &&\n\t    (chip_ver <= ASC_CHIP_MAX_VER_ISA)) {\n\t\tif (chip_ver >= ASC_CHIP_MIN_VER_ISA_PNP)\n\t\t\treturn (ASC_IS_ISAPNP);\n\n\t\treturn (ASC_IS_ISA);\n\t} else if ((chip_ver >= ASC_CHIP_MIN_VER_PCI) &&\n\t\t   (chip_ver <= ASC_CHIP_MAX_VER_PCI))\n\t\treturn (ASC_IS_PCI);\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_EXTRA_CONTROL",
          "args": [
            "iot",
            "ioh",
            "(SEC_ACTIVE_NEGATE | SEC_SLEW_RATE)"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_EXTRA_CONTROL",
          "args": [
            "iot",
            "ioh",
            "(SEC_ACTIVE_NEGATE | SEC_ENABLE_FILTER)"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_EXTRA_CONTROL",
          "args": [
            "iot",
            "ioh",
            "(SEC_ACTIVE_NEGATE | SEC_SLEW_RATE)"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AscGetChipVersion",
          "args": [
            "iot",
            "ioh",
            "sc->bus_type"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetChipVersion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "838-854",
          "snippet": "static u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int8_t AscGetChipVersion"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int8_t AscGetChipVersion;\n\nstatic u_int8_t\nAscGetChipVersion(iot, ioh, bus_type)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_EISA) {\n\t\t/*\n\t\t * u_int16_t\teisa_iop; u_int8_t\trevision;\n\t\t *\n\t\t * eisa_iop = ASC_GET_EISA_SLOT(iop_base) |\n\t\t * ASC_EISA_REV_IOP_MASK; revision = inp(eisa_iop);\n\t\t * return((ASC_CHIP_MIN_VER_EISA - 1) + revision);\n\t\t */\n\t}\n\treturn (ASC_GET_CHIP_VER_NO(iot, ioh));\n}"
        }
      },
      {
        "call_info": {
          "callee": "AscGetMaxDmaCount",
          "args": [
            "sc->bus_type"
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "AscGetMaxDmaCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/advlib.c",
          "lines": "2195-2204",
          "snippet": "static u_int32_t\nAscGetMaxDmaCount(bus_type)\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_ISA)\n\t\treturn (ASC_MAX_ISA_DMA_COUNT);\n\telse if (bus_type & (ASC_IS_EISA | ASC_IS_VL))\n\t\treturn (ASC_MAX_VL_DMA_COUNT);\n\treturn (ASC_MAX_PCI_DMA_COUNT);\n}",
          "includes": [
            "#include <dev/ic/advmcode.h>",
            "#include <dev/ic/advlib.h>",
            "#include <dev/ic/adv.h>",
            "#include <vm/pmap.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <sys/device.h>",
            "#include <sys/queue.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static u_int32_t AscGetMaxDmaCount"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int32_t AscGetMaxDmaCount;\n\nstatic u_int32_t\nAscGetMaxDmaCount(bus_type)\n\tu_int16_t       bus_type;\n{\n\tif (bus_type & ASC_IS_ISA)\n\t\treturn (ASC_MAX_ISA_DMA_COUNT);\n\telse if (bus_type & (ASC_IS_EISA | ASC_IS_VL))\n\t\treturn (ASC_MAX_VL_DMA_COUNT);\n\treturn (ASC_MAX_PCI_DMA_COUNT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_STATUS",
          "args": [
            "iot",
            "ioh",
            "0"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASC_SET_CHIP_CONTROL",
          "args": [
            "iot",
            "ioh",
            "ASC_CC_HALT"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/advmcode.h>\n#include <dev/ic/advlib.h>\n#include <dev/ic/adv.h>\n#include <vm/pmap.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/device.h>\n#include <sys/queue.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\nstatic u_int16_t AscGetChipBusType;\nstatic u_int8_t AscGetChipVersion;\nstatic u_int32_t AscGetMaxDmaCount;\nstatic u_int16_t AscGetIsaDmaChannel;\n\nvoid\nAscInitASC_SOFTC(sc)\n\tASC_SOFTC      *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint             i;\n\tu_int8_t        chip_version;\n\n\n\tASC_SET_CHIP_CONTROL(iot, ioh, ASC_CC_HALT);\n\tASC_SET_CHIP_STATUS(iot, ioh, 0);\n\n\tsc->bug_fix_cntl = 0;\n\tsc->pci_fix_asyn_xfer = 0;\n\tsc->pci_fix_asyn_xfer_always = 0;\n\tsc->sdtr_done = 0;\n\tsc->cur_total_qng = 0;\n\tsc->last_q_shortage = 0;\n\tsc->use_tagged_qng = 0;\n\tsc->unit_not_ready = 0;\n\tsc->queue_full_or_busy = 0;\n\tsc->host_init_sdtr_index = 0;\n\tsc->can_tagged_qng = 0;\n\tsc->cmd_qng_enabled = 0;\n\tsc->dvc_cntl = ASC_DEF_DVC_CNTL;\n\tsc->init_sdtr = 0;\n\tsc->max_total_qng = ASC_DEF_MAX_TOTAL_QNG;\n\tsc->scsi_reset_wait = 3;\n\tsc->start_motor = ASC_SCSI_WIDTH_BIT_SET;\n\tsc->max_dma_count = AscGetMaxDmaCount(sc->bus_type);\n\tsc->sdtr_enable = ASC_SCSI_WIDTH_BIT_SET;\n\tsc->disc_enable = ASC_SCSI_WIDTH_BIT_SET;\n\tsc->chip_scsi_id = ASC_DEF_CHIP_SCSI_ID;\n\tsc->lib_serial_no = ASC_LIB_SERIAL_NUMBER;\n\tsc->lib_version = (ASC_LIB_VERSION_MAJOR << 8) | ASC_LIB_VERSION_MINOR;\n\tchip_version = AscGetChipVersion(iot, ioh, sc->bus_type);\n\tsc->chip_version = chip_version;\n\tif ((sc->bus_type & ASC_IS_PCI) &&\n\t    (chip_version >= ASC_CHIP_VER_PCI_ULTRA_3150)) {\n\t\tsc->bus_type = ASC_IS_PCI_ULTRA;\n\t\tsc->sdtr_period_tbl[0] = SYN_ULTRA_XFER_NS_0;\n\t\tsc->sdtr_period_tbl[1] = SYN_ULTRA_XFER_NS_1;\n\t\tsc->sdtr_period_tbl[2] = SYN_ULTRA_XFER_NS_2;\n\t\tsc->sdtr_period_tbl[3] = SYN_ULTRA_XFER_NS_3;\n\t\tsc->sdtr_period_tbl[4] = SYN_ULTRA_XFER_NS_4;\n\t\tsc->sdtr_period_tbl[5] = SYN_ULTRA_XFER_NS_5;\n\t\tsc->sdtr_period_tbl[6] = SYN_ULTRA_XFER_NS_6;\n\t\tsc->sdtr_period_tbl[7] = SYN_ULTRA_XFER_NS_7;\n\t\tsc->sdtr_period_tbl[8] = SYN_ULTRA_XFER_NS_8;\n\t\tsc->sdtr_period_tbl[9] = SYN_ULTRA_XFER_NS_9;\n\t\tsc->sdtr_period_tbl[10] = SYN_ULTRA_XFER_NS_10;\n\t\tsc->sdtr_period_tbl[11] = SYN_ULTRA_XFER_NS_11;\n\t\tsc->sdtr_period_tbl[12] = SYN_ULTRA_XFER_NS_12;\n\t\tsc->sdtr_period_tbl[13] = SYN_ULTRA_XFER_NS_13;\n\t\tsc->sdtr_period_tbl[14] = SYN_ULTRA_XFER_NS_14;\n\t\tsc->sdtr_period_tbl[15] = SYN_ULTRA_XFER_NS_15;\n\t\tsc->max_sdtr_index = 15;\n\t\tif (chip_version == ASC_CHIP_VER_PCI_ULTRA_3150)\n\t\t\tASC_SET_EXTRA_CONTROL(iot, ioh,\n\t\t\t\t       (SEC_ACTIVE_NEGATE | SEC_SLEW_RATE));\n\t\telse if (chip_version >= ASC_CHIP_VER_PCI_ULTRA_3050)\n\t\t\tASC_SET_EXTRA_CONTROL(iot, ioh,\n\t\t\t\t   (SEC_ACTIVE_NEGATE | SEC_ENABLE_FILTER));\n\t} else {\n\t\tsc->sdtr_period_tbl[0] = SYN_XFER_NS_0;\n\t\tsc->sdtr_period_tbl[1] = SYN_XFER_NS_1;\n\t\tsc->sdtr_period_tbl[2] = SYN_XFER_NS_2;\n\t\tsc->sdtr_period_tbl[3] = SYN_XFER_NS_3;\n\t\tsc->sdtr_period_tbl[4] = SYN_XFER_NS_4;\n\t\tsc->sdtr_period_tbl[5] = SYN_XFER_NS_5;\n\t\tsc->sdtr_period_tbl[6] = SYN_XFER_NS_6;\n\t\tsc->sdtr_period_tbl[7] = SYN_XFER_NS_7;\n\t\tsc->max_sdtr_index = 7;\n\t}\n\n\tif (sc->bus_type == ASC_IS_PCI)\n\t\tASC_SET_EXTRA_CONTROL(iot, ioh,\n\t\t\t\t      (SEC_ACTIVE_NEGATE | SEC_SLEW_RATE));\n\n\tsc->isa_dma_speed = ASC_DEF_ISA_DMA_SPEED;\n\tif (AscGetChipBusType(iot, ioh) == ASC_IS_ISAPNP) {\n\t\tASC_SET_CHIP_IFC(iot, ioh, ASC_IFC_INIT_DEFAULT);\n\t\tsc->bus_type = ASC_IS_ISAPNP;\n\t}\n\tif ((sc->bus_type & ASC_IS_ISA) != 0)\n\t\tsc->isa_dma_channel = AscGetIsaDmaChannel(iot, ioh);\n\n\tfor (i = 0; i <= ASC_MAX_TID; i++) {\n\t\tsc->cur_dvc_qng[i] = 0;\n\t\tsc->max_dvc_qng[i] = ASC_MAX_SCSI1_QNG;\n\t\tsc->max_tag_qng[i] = ASC_MAX_INRAM_TAG_QNG;\n\t}\n}"
  }
]