[
  {
    "function_name": "sbdsp_midi_intr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2313-2321",
    "snippet": "int\nsbdsp_midi_intr(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tsc->sc_intrm(sc->sc_argm, sbdsp_rdsp(sc));\n\treturn (0);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_midi_intr",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sc->sc_intrm",
          "args": [
            "sc->sc_argm",
            "sbdsp_rdsp(sc)"
          ],
          "line": 2319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_rdsp",
          "args": [
            "sc"
          ],
          "line": 2319
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_rdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "982-1002",
          "snippet": "int\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_midi_intr;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_midi_intr(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tsc->sc_intrm(sc->sc_argm, sbdsp_rdsp(sc));\n\treturn (0);\n}"
  },
  {
    "function_name": "sbdsp_midi_getinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2302-2311",
    "snippet": "void\nsbdsp_midi_getinfo(addr, mi)\n\tvoid *addr;\n\tstruct midi_info *mi;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tmi->name = sc->sc_model < SB_20 ? \"SB MIDI cmd\" : \"SB MIDI UART\";\n\tmi->props = MIDI_PROP_CAN_INPUT;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nvoid\nsbdsp_midi_getinfo(addr, mi)\n\tvoid *addr;\n\tstruct midi_info *mi;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tmi->name = sc->sc_model < SB_20 ? \"SB MIDI cmd\" : \"SB MIDI UART\";\n\tmi->props = MIDI_PROP_CAN_INPUT;\n}"
  },
  {
    "function_name": "sbdsp_midi_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2288-2300",
    "snippet": "int\nsbdsp_midi_output(addr, d)\n\tvoid *addr;\n\tint d;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tif (sc->sc_model < SB_20 && sbdsp_wdsp(sc, SB_MIDI_WRITE))\n\t\treturn EIO;\n\tif (sbdsp_wdsp(sc, d))\n\t\treturn EIO;\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "d"
          ],
          "line": 2297
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_midi_output(addr, d)\n\tvoid *addr;\n\tint d;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tif (sc->sc_model < SB_20 && sbdsp_wdsp(sc, SB_MIDI_WRITE))\n\t\treturn EIO;\n\tif (sbdsp_wdsp(sc, d))\n\t\treturn EIO;\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_midi_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2274-2286",
    "snippet": "void\nsbdsp_midi_close(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_midi_close: sc=%p\\n\", sc));\n\n\tif (sc->sc_model >= SB_20)\n\t\tsbdsp_reset(sc); /* exit UART mode */\n\tsc->sc_open = SB_CLOSED;\n\tsc->sc_intrm = 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_reset",
          "args": [
            "sc"
          ],
          "line": 2283
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "918-949",
          "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_midi_close: sc=%p\\n\", sc)"
          ],
          "line": 2280
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nvoid\nsbdsp_midi_close(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_midi_close: sc=%p\\n\", sc));\n\n\tif (sc->sc_model >= SB_20)\n\t\tsbdsp_reset(sc); /* exit UART mode */\n\tsc->sc_open = SB_CLOSED;\n\tsc->sc_intrm = 0;\n}"
  },
  {
    "function_name": "sbdsp_midi_open",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2245-2272",
    "snippet": "int\nsbdsp_midi_open(addr, flags, iintr, ointr, arg)\n\tvoid *addr;\n\tint flags;\n\tvoid (*iintr)__P((void *, int));\n\tvoid (*ointr)__P((void *));\n\tvoid *arg;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_midi_open: sc=%p\\n\", sc));\n\n\tif (sc->sc_open != SB_CLOSED)\n\t\treturn EBUSY;\n\tif (sbdsp_reset(sc) != 0)\n\t\treturn EIO;\n\n\tif (sc->sc_model >= SB_20)\n\t\tif (sbdsp_wdsp(sc, SB_MIDI_UART_INTR)) /* enter UART mode */\n\t\t\treturn EIO;\n\tsc->sc_open = SB_OPEN_MIDI;\n\tsc->sc_openflags = flags;\n\tsc->sc_intr8 = sbdsp_midi_intr;\n\tsc->sc_arg8 = addr;\n\tsc->sc_intrm = iintr;\n\tsc->sc_argm = arg;\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "__P((int, int));",
      "int\tsbdsp_midi_intr",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;",
      "int flags;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "SB_MIDI_UART_INTR"
          ],
          "line": 2263
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_reset",
          "args": [
            "sc"
          ],
          "line": 2259
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "918-949",
          "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_midi_open: sc=%p\\n\", sc)"
          ],
          "line": 2255
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n__P((int, int));\nint\tsbdsp_midi_intr;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\nint flags;\n\nint\nsbdsp_midi_open(addr, flags, iintr, ointr, arg)\n\tvoid *addr;\n\tint flags;\n\tvoid (*iintr)__P((void *, int));\n\tvoid (*ointr)__P((void *));\n\tvoid *arg;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_midi_open: sc=%p\\n\", sc));\n\n\tif (sc->sc_open != SB_CLOSED)\n\t\treturn EBUSY;\n\tif (sbdsp_reset(sc) != 0)\n\t\treturn EIO;\n\n\tif (sc->sc_model >= SB_20)\n\t\tif (sbdsp_wdsp(sc, SB_MIDI_UART_INTR)) /* enter UART mode */\n\t\t\treturn EIO;\n\tsc->sc_open = SB_OPEN_MIDI;\n\tsc->sc_openflags = flags;\n\tsc->sc_intr8 = sbdsp_midi_intr;\n\tsc->sc_arg8 = addr;\n\tsc->sc_intrm = iintr;\n\tsc->sc_argm = arg;\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_get_props",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2231-2238",
    "snippet": "int\nsbdsp_get_props(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\treturn AUDIO_PROP_MMAP | AUDIO_PROP_INDEPENDENT |\n\t       (sc->sc_fullduplex ? AUDIO_PROP_FULLDUPLEX : 0);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_get_props(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\treturn AUDIO_PROP_MMAP | AUDIO_PROP_INDEPENDENT |\n\t       (sc->sc_fullduplex ? AUDIO_PROP_FULLDUPLEX : 0);\n}"
  },
  {
    "function_name": "sb_mappage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2221-2229",
    "snippet": "int\nsb_mappage(addr, mem, off, prot)\n\tvoid *addr;\n        void *mem;\n        int off;\n\tint prot;\n{\n\treturn isa_mappage(mem, off, prot);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "isa_mappage",
          "args": [
            "mem",
            "off",
            "prot"
          ],
          "line": 2228
        },
        "resolved": true,
        "details": {
          "function_name": "isa_mappage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/isadma.c",
          "lines": "729-745",
          "snippet": "int\nisa_mappage(mem, off, prot)\n\tvoid *mem;\n\tint off;\n\tint prot;\n{\n\tstruct isa_mem *m;\n\n\tfor(m = isa_mem_head; m && m->kva != (caddr_t)mem; m = m->next)\n\t\t;\n\tif (!m) {\n\t\tprintf(\"isa_mappage: mapping unallocted memory\\n\");\n\t\treturn -1;\n\t}\n\treturn (isa_dmamem_mmap(m->isadev, m->chan, m->addr, m->size, off,\n\t    prot, BUS_DMA_WAITOK));\n}",
          "includes": [
            "#include <sys/malloc.h>",
            "#include <dev/isa/isadmareg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/isa/isareg.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct isa_mem {\n\tstruct device *isadev;\n\tint chan;\n\tbus_size_t size;\n\tbus_addr_t addr;\n\tcaddr_t kva;\n\tstruct isa_mem *next;\n} *isa_mem_head = 0;",
            "void *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;",
            "int chan;",
            "size_t size;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/malloc.h>\n#include <dev/isa/isadmareg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/isa/isareg.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct isa_mem {\n\tstruct device *isadev;\n\tint chan;\n\tbus_size_t size;\n\tbus_addr_t addr;\n\tcaddr_t kva;\n\tstruct isa_mem *next;\n} *isa_mem_head = 0;\nvoid *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;\nint chan;\nsize_t size;\n\nint\nisa_mappage(mem, off, prot)\n\tvoid *mem;\n\tint off;\n\tint prot;\n{\n\tstruct isa_mem *m;\n\n\tfor(m = isa_mem_head; m && m->kva != (caddr_t)mem; m = m->next)\n\t\t;\n\tif (!m) {\n\t\tprintf(\"isa_mappage: mapping unallocted memory\\n\");\n\t\treturn -1;\n\t}\n\treturn (isa_dmamem_mmap(m->isadev, m->chan, m->addr, m->size, off,\n\t    prot, BUS_DMA_WAITOK));\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsb_mappage(addr, mem, off, prot)\n\tvoid *addr;\n        void *mem;\n        int off;\n\tint prot;\n{\n\treturn isa_mappage(mem, off, prot);\n}"
  },
  {
    "function_name": "sb_round",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2211-2219",
    "snippet": "unsigned long\nsb_round(addr, size)\n\tvoid *addr;\n\tunsigned long size;\n{\n\tif (size > MAX_ISADMA)\n\t\tsize = MAX_ISADMA;\n\treturn size;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;",
      "unsigned long size;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\nunsigned long size;\n\nunsigned long\nsb_round(addr, size)\n\tvoid *addr;\n\tunsigned long size;\n{\n\tif (size > MAX_ISADMA)\n\t\tsize = MAX_ISADMA;\n\treturn size;\n}"
  },
  {
    "function_name": "sb_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "2202-2209",
    "snippet": "void\nsb_free(addr, ptr, pool)\n\tvoid *addr;\n\tvoid *ptr;\n\tint pool;\n{\n\tisa_free(ptr, pool);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;",
      "int pool;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "isa_free",
          "args": [
            "ptr",
            "pool"
          ],
          "line": 2208
        },
        "resolved": true,
        "details": {
          "function_name": "isa_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/isadma.c",
          "lines": "708-727",
          "snippet": "void\nisa_free(addr, pool)\n\tvoid *addr;\n\tint pool;\n{\n\tstruct isa_mem **mp, *m;\n\tcaddr_t kva = (caddr_t)addr;\n\n\tfor(mp = &isa_mem_head; *mp && (*mp)->kva != kva; mp = &(*mp)->next)\n\t\t;\n\tm = *mp;\n\tif (!m) {\n\t\tprintf(\"isa_free: freeing unallocted memory\\n\");\n\t\treturn;\n\t}\n\t*mp = m->next;\n\tisa_dmamem_unmap(m->isadev, m->chan, kva, m->size);\n\tisa_dmamem_free(m->isadev, m->chan, m->addr, m->size);\n\tfree(m, pool);\n}",
          "includes": [
            "#include <sys/malloc.h>",
            "#include <dev/isa/isadmareg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/isa/isareg.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "struct isa_mem {\n\tstruct device *isadev;\n\tint chan;\n\tbus_size_t size;\n\tbus_addr_t addr;\n\tcaddr_t kva;\n\tstruct isa_mem *next;\n} *isa_mem_head = 0;",
            "void *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;",
            "int chan;",
            "size_t size;",
            "int pool;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/malloc.h>\n#include <dev/isa/isadmareg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/isa/isareg.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstruct isa_mem {\n\tstruct device *isadev;\n\tint chan;\n\tbus_size_t size;\n\tbus_addr_t addr;\n\tcaddr_t kva;\n\tstruct isa_mem *next;\n} *isa_mem_head = 0;\nvoid *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;\nint chan;\nsize_t size;\nint pool;\n\nvoid\nisa_free(addr, pool)\n\tvoid *addr;\n\tint pool;\n{\n\tstruct isa_mem **mp, *m;\n\tcaddr_t kva = (caddr_t)addr;\n\n\tfor(mp = &isa_mem_head; *mp && (*mp)->kva != kva; mp = &(*mp)->next)\n\t\t;\n\tm = *mp;\n\tif (!m) {\n\t\tprintf(\"isa_free: freeing unallocted memory\\n\");\n\t\treturn;\n\t}\n\t*mp = m->next;\n\tisa_dmamem_unmap(m->isadev, m->chan, kva, m->size);\n\tisa_dmamem_free(m->isadev, m->chan, m->addr, m->size);\n\tfree(m, pool);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\nint pool;\n\nvoid\nsb_free(addr, ptr, pool)\n\tvoid *addr;\n\tvoid *ptr;\n\tint pool;\n{\n\tisa_free(ptr, pool);\n}"
  },
  {
    "function_name": "sbdsp_mixer_query_devinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1894-2188",
    "snippet": "int\nsbdsp_mixer_query_devinfo(addr, dip)\n\tvoid *addr;\n\tmixer_devinfo_t *dip;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint chan, class, is1745;\n\n\tDPRINTF((\"sbdsp_mixer_query_devinfo: model=%d index=%d\\n\", \n\t\t sc->sc_mixer_model, dip->index));\n\n\tif (sc->sc_mixer_model == SBM_NONE)\n\t\treturn ENXIO;\n\n\tchan = sc->sc_mixer_model == SBM_CT1335 ? 1 : 2;\n\tis1745 = ISSBM1745(sc);\n\tclass = is1745 ? SB_INPUT_CLASS : SB_OUTPUT_CLASS;\n\n\tswitch (dip->index) {\n\tcase SB_MASTER_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNmaster);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_MIDI_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_MIDI_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNfmsynth);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_CD_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_CD_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNcd);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_VOICE_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNdac);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_OUTPUT_CLASS:\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCoutputs);\n\t\treturn 0;\n\t}\n\n\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\treturn ENXIO;\n\n\tswitch (dip->index) {\n\tcase SB_MIC_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_MIC_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNmicrophone);\n\t\tdip->un.v.num_channels = 1;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_LINE_IN_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_LINE_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNline);\n\t\tdip->un.v.num_channels = 2;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_RECORD_SOURCE:\n\t\tdip->mixer_class = SB_RECORD_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNsource);\n\t\tif (ISSBM1745(sc)) {\n\t\t\tdip->type = AUDIO_MIXER_SET;\n\t\t\tdip->un.s.num_mem = 4;\n\t\t\tstrcpy(dip->un.s.member[0].label.name, AudioNmicrophone);\n\t\t\tdip->un.s.member[0].mask = 1 << SB_MIC_VOL;\n\t\t\tstrcpy(dip->un.s.member[1].label.name, AudioNcd);\n\t\t\tdip->un.s.member[1].mask = 1 << SB_CD_VOL;\n\t\t\tstrcpy(dip->un.s.member[2].label.name, AudioNline);\n\t\t\tdip->un.s.member[2].mask = 1 << SB_LINE_IN_VOL;\n\t\t\tstrcpy(dip->un.s.member[3].label.name, AudioNfmsynth);\n\t\t\tdip->un.s.member[3].mask = 1 << SB_MIDI_VOL;\n\t\t} else {\n\t\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\t\tdip->un.e.num_mem = 3;\n\t\t\tstrcpy(dip->un.e.member[0].label.name, AudioNmicrophone);\n\t\t\tdip->un.e.member[0].ord = SB_MIC_VOL;\n\t\t\tstrcpy(dip->un.e.member[1].label.name, AudioNcd);\n\t\t\tdip->un.e.member[1].ord = SB_CD_VOL;\n\t\t\tstrcpy(dip->un.e.member[2].label.name, AudioNline);\n\t\t\tdip->un.e.member[2].ord = SB_LINE_IN_VOL;\n\t\t}\n\t\treturn 0;\n\n\tcase SB_BASS:\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNbass);\n\t\tif (sc->sc_mixer_model == SBM_CT1745) {\n\t\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\t\tdip->mixer_class = SB_EQUALIZATION_CLASS;\n\t\t\tdip->un.v.num_channels = 2;\n\t\t\tstrcpy(dip->un.v.units.name, AudioNbass);\n\t\t} else {\n\t\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\t\tdip->un.e.num_mem = 2;\n\t\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\t\tdip->un.e.member[0].ord = 0;\n\t\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\t\tdip->un.e.member[1].ord = 1;\n\t\t}\n\t\treturn 0;\n\t\t\n\tcase SB_TREBLE:\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNtreble);\n\t\tif (sc->sc_mixer_model == SBM_CT1745) {\n\t\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\t\tdip->mixer_class = SB_EQUALIZATION_CLASS;\n\t\t\tdip->un.v.num_channels = 2;\n\t\t\tstrcpy(dip->un.v.units.name, AudioNtreble);\n\t\t} else {\n\t\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\t\tdip->un.e.num_mem = 2;\n\t\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\t\tdip->un.e.member[0].ord = 0;\n\t\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\t\tdip->un.e.member[1].ord = 1;\n\t\t}\n\t\treturn 0;\n\t\t\n\tcase SB_RECORD_CLASS:\t\t\t/* record source class */\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_RECORD_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCrecord);\n\t\treturn 0;\n\n\tcase SB_INPUT_CLASS:\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCinputs);\n\t\treturn 0;\n\n\t}\n\n\tif (sc->sc_mixer_model == SBM_CT1345)\n\t\treturn ENXIO;\n\n\tswitch(dip->index) {\n\tcase SB_PCSPEAKER:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, \"pc_speaker\");\n\t\tdip->un.v.num_channels = 1;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_INPUT_GAIN:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNinput);\n\t\tdip->un.v.num_channels = 2;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_OUTPUT_GAIN:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNoutput);\n\t\tdip->un.v.num_channels = 2;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_AGC:\n\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, \"agc\");\n\t\tdip->un.e.num_mem = 2;\n\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\tdip->un.e.member[0].ord = 0;\n\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\tdip->un.e.member[1].ord = 1;\n\t\treturn 0;\n\n\tcase SB_EQUALIZATION_CLASS:\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_EQUALIZATION_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCequalization);\n\t\treturn 0;\n\n\tcase SB_CD_IN_MUTE:\n\t\tdip->prev = SB_CD_VOL;\n\t\tdip->next = SB_CD_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_MIC_IN_MUTE:\n\t\tdip->prev = SB_MIC_VOL;\n\t\tdip->next = SB_MIC_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_LINE_IN_MUTE:\n\t\tdip->prev = SB_LINE_IN_VOL;\n\t\tdip->next = SB_LINE_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_MIDI_IN_MUTE:\n\t\tdip->prev = SB_MIDI_VOL;\n\t\tdip->next = SB_MIDI_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_CD_SWAP:\n\t\tdip->prev = SB_CD_IN_MUTE;\n\t\tdip->next = SB_CD_OUT_MUTE;\n\t\tgoto swap;\n\n\tcase SB_MIC_SWAP:\n\t\tdip->prev = SB_MIC_IN_MUTE;\n\t\tdip->next = SB_MIC_OUT_MUTE;\n\t\tgoto swap;\n\n\tcase SB_LINE_SWAP:\n\t\tdip->prev = SB_LINE_IN_MUTE;\n\t\tdip->next = SB_LINE_OUT_MUTE;\n\t\tgoto swap;\n\n\tcase SB_MIDI_SWAP:\n\t\tdip->prev = SB_MIDI_IN_MUTE;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\tswap:\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tstrcpy(dip->label.name, AudioNswap);\n\t\tgoto mute1;\n\n\tcase SB_CD_OUT_MUTE:\n\t\tdip->prev = SB_CD_SWAP;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_MIC_OUT_MUTE:\n\t\tdip->prev = SB_MIC_SWAP;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_LINE_OUT_MUTE:\n\t\tdip->prev = SB_LINE_SWAP;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\tmute:\n\t\tstrcpy(dip->label.name, AudioNmute);\n\tmute1:\n\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\tdip->un.e.num_mem = 2;\n\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\tdip->un.e.member[0].ord = 0;\n\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\tdip->un.e.member[1].ord = 1;\n\t\treturn 0;\n\n\t}\n\n\treturn ENXIO;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[1].label.name",
            "AudioNon"
          ],
          "line": 2181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[0].label.name",
            "AudioNoff"
          ],
          "line": 2179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNmute"
          ],
          "line": 2175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNswap"
          ],
          "line": 2155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioCequalization"
          ],
          "line": 2108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[1].label.name",
            "AudioNon"
          ],
          "line": 2100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[0].label.name",
            "AudioNoff"
          ],
          "line": 2098
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "\"agc\""
          ],
          "line": 2096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 2089
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNoutput"
          ],
          "line": 2087
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 2080
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNinput"
          ],
          "line": 2078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 2071
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "\"pc_speaker\""
          ],
          "line": 2069
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioCinputs"
          ],
          "line": 2056
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioCrecord"
          ],
          "line": 2049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[1].label.name",
            "AudioNon"
          ],
          "line": 2040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[0].label.name",
            "AudioNoff"
          ],
          "line": 2038
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNtreble"
          ],
          "line": 2033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNtreble"
          ],
          "line": 2028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[1].label.name",
            "AudioNon"
          ],
          "line": 2021
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[0].label.name",
            "AudioNoff"
          ],
          "line": 2019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNbass"
          ],
          "line": 2014
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNbass"
          ],
          "line": 2009
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[2].label.name",
            "AudioNline"
          ],
          "line": 2002
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[1].label.name",
            "AudioNcd"
          ],
          "line": 2000
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.e.member[0].label.name",
            "AudioNmicrophone"
          ],
          "line": 1998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.s.member[3].label.name",
            "AudioNfmsynth"
          ],
          "line": 1993
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.s.member[2].label.name",
            "AudioNline"
          ],
          "line": 1991
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.s.member[1].label.name",
            "AudioNcd"
          ],
          "line": 1989
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.s.member[0].label.name",
            "AudioNmicrophone"
          ],
          "line": 1987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNsource"
          ],
          "line": 1983
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 1977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNline"
          ],
          "line": 1975
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 1967
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNmicrophone"
          ],
          "line": 1965
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioCoutputs"
          ],
          "line": 1952
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 1946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNdac"
          ],
          "line": 1944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 1937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNcd"
          ],
          "line": 1935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 1928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNfmsynth"
          ],
          "line": 1926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->un.v.units.name",
            "AudioNvolume"
          ],
          "line": 1919
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dip->label.name",
            "AudioNmaster"
          ],
          "line": 1917
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_mixer_query_devinfo: model=%d index=%d\\n\", \n\t\t sc->sc_mixer_model, dip->index)"
          ],
          "line": 1902
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_mixer_query_devinfo(addr, dip)\n\tvoid *addr;\n\tmixer_devinfo_t *dip;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint chan, class, is1745;\n\n\tDPRINTF((\"sbdsp_mixer_query_devinfo: model=%d index=%d\\n\", \n\t\t sc->sc_mixer_model, dip->index));\n\n\tif (sc->sc_mixer_model == SBM_NONE)\n\t\treturn ENXIO;\n\n\tchan = sc->sc_mixer_model == SBM_CT1335 ? 1 : 2;\n\tis1745 = ISSBM1745(sc);\n\tclass = is1745 ? SB_INPUT_CLASS : SB_OUTPUT_CLASS;\n\n\tswitch (dip->index) {\n\tcase SB_MASTER_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNmaster);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_MIDI_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_MIDI_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNfmsynth);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_CD_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_CD_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNcd);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_VOICE_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNdac);\n\t\tdip->un.v.num_channels = chan;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\tcase SB_OUTPUT_CLASS:\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCoutputs);\n\t\treturn 0;\n\t}\n\n\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\treturn ENXIO;\n\n\tswitch (dip->index) {\n\tcase SB_MIC_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_MIC_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNmicrophone);\n\t\tdip->un.v.num_channels = 1;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_LINE_IN_VOL:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = class;\n\t\tdip->prev = AUDIO_MIXER_LAST;\n\t\tdip->next = is1745 ? SB_LINE_IN_MUTE : AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNline);\n\t\tdip->un.v.num_channels = 2;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_RECORD_SOURCE:\n\t\tdip->mixer_class = SB_RECORD_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNsource);\n\t\tif (ISSBM1745(sc)) {\n\t\t\tdip->type = AUDIO_MIXER_SET;\n\t\t\tdip->un.s.num_mem = 4;\n\t\t\tstrcpy(dip->un.s.member[0].label.name, AudioNmicrophone);\n\t\t\tdip->un.s.member[0].mask = 1 << SB_MIC_VOL;\n\t\t\tstrcpy(dip->un.s.member[1].label.name, AudioNcd);\n\t\t\tdip->un.s.member[1].mask = 1 << SB_CD_VOL;\n\t\t\tstrcpy(dip->un.s.member[2].label.name, AudioNline);\n\t\t\tdip->un.s.member[2].mask = 1 << SB_LINE_IN_VOL;\n\t\t\tstrcpy(dip->un.s.member[3].label.name, AudioNfmsynth);\n\t\t\tdip->un.s.member[3].mask = 1 << SB_MIDI_VOL;\n\t\t} else {\n\t\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\t\tdip->un.e.num_mem = 3;\n\t\t\tstrcpy(dip->un.e.member[0].label.name, AudioNmicrophone);\n\t\t\tdip->un.e.member[0].ord = SB_MIC_VOL;\n\t\t\tstrcpy(dip->un.e.member[1].label.name, AudioNcd);\n\t\t\tdip->un.e.member[1].ord = SB_CD_VOL;\n\t\t\tstrcpy(dip->un.e.member[2].label.name, AudioNline);\n\t\t\tdip->un.e.member[2].ord = SB_LINE_IN_VOL;\n\t\t}\n\t\treturn 0;\n\n\tcase SB_BASS:\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNbass);\n\t\tif (sc->sc_mixer_model == SBM_CT1745) {\n\t\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\t\tdip->mixer_class = SB_EQUALIZATION_CLASS;\n\t\t\tdip->un.v.num_channels = 2;\n\t\t\tstrcpy(dip->un.v.units.name, AudioNbass);\n\t\t} else {\n\t\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\t\tdip->un.e.num_mem = 2;\n\t\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\t\tdip->un.e.member[0].ord = 0;\n\t\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\t\tdip->un.e.member[1].ord = 1;\n\t\t}\n\t\treturn 0;\n\t\t\n\tcase SB_TREBLE:\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNtreble);\n\t\tif (sc->sc_mixer_model == SBM_CT1745) {\n\t\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\t\tdip->mixer_class = SB_EQUALIZATION_CLASS;\n\t\t\tdip->un.v.num_channels = 2;\n\t\t\tstrcpy(dip->un.v.units.name, AudioNtreble);\n\t\t} else {\n\t\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\t\tdip->un.e.num_mem = 2;\n\t\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\t\tdip->un.e.member[0].ord = 0;\n\t\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\t\tdip->un.e.member[1].ord = 1;\n\t\t}\n\t\treturn 0;\n\t\t\n\tcase SB_RECORD_CLASS:\t\t\t/* record source class */\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_RECORD_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCrecord);\n\t\treturn 0;\n\n\tcase SB_INPUT_CLASS:\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCinputs);\n\t\treturn 0;\n\n\t}\n\n\tif (sc->sc_mixer_model == SBM_CT1345)\n\t\treturn ENXIO;\n\n\tswitch(dip->index) {\n\tcase SB_PCSPEAKER:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, \"pc_speaker\");\n\t\tdip->un.v.num_channels = 1;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_INPUT_GAIN:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNinput);\n\t\tdip->un.v.num_channels = 2;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_OUTPUT_GAIN:\n\t\tdip->type = AUDIO_MIXER_VALUE;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioNoutput);\n\t\tdip->un.v.num_channels = 2;\n\t\tstrcpy(dip->un.v.units.name, AudioNvolume);\n\t\treturn 0;\n\n\tcase SB_AGC:\n\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tdip->prev = dip->next = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, \"agc\");\n\t\tdip->un.e.num_mem = 2;\n\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\tdip->un.e.member[0].ord = 0;\n\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\tdip->un.e.member[1].ord = 1;\n\t\treturn 0;\n\n\tcase SB_EQUALIZATION_CLASS:\n\t\tdip->type = AUDIO_MIXER_CLASS;\n\t\tdip->mixer_class = SB_EQUALIZATION_CLASS;\n\t\tdip->next = dip->prev = AUDIO_MIXER_LAST;\n\t\tstrcpy(dip->label.name, AudioCequalization);\n\t\treturn 0;\n\n\tcase SB_CD_IN_MUTE:\n\t\tdip->prev = SB_CD_VOL;\n\t\tdip->next = SB_CD_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_MIC_IN_MUTE:\n\t\tdip->prev = SB_MIC_VOL;\n\t\tdip->next = SB_MIC_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_LINE_IN_MUTE:\n\t\tdip->prev = SB_LINE_IN_VOL;\n\t\tdip->next = SB_LINE_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_MIDI_IN_MUTE:\n\t\tdip->prev = SB_MIDI_VOL;\n\t\tdip->next = SB_MIDI_SWAP;\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_CD_SWAP:\n\t\tdip->prev = SB_CD_IN_MUTE;\n\t\tdip->next = SB_CD_OUT_MUTE;\n\t\tgoto swap;\n\n\tcase SB_MIC_SWAP:\n\t\tdip->prev = SB_MIC_IN_MUTE;\n\t\tdip->next = SB_MIC_OUT_MUTE;\n\t\tgoto swap;\n\n\tcase SB_LINE_SWAP:\n\t\tdip->prev = SB_LINE_IN_MUTE;\n\t\tdip->next = SB_LINE_OUT_MUTE;\n\t\tgoto swap;\n\n\tcase SB_MIDI_SWAP:\n\t\tdip->prev = SB_MIDI_IN_MUTE;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\tswap:\n\t\tdip->mixer_class = SB_INPUT_CLASS;\n\t\tstrcpy(dip->label.name, AudioNswap);\n\t\tgoto mute1;\n\n\tcase SB_CD_OUT_MUTE:\n\t\tdip->prev = SB_CD_SWAP;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_MIC_OUT_MUTE:\n\t\tdip->prev = SB_MIC_SWAP;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\t\tgoto mute;\n\n\tcase SB_LINE_OUT_MUTE:\n\t\tdip->prev = SB_LINE_SWAP;\n\t\tdip->next = AUDIO_MIXER_LAST;\n\t\tdip->mixer_class = SB_OUTPUT_CLASS;\n\tmute:\n\t\tstrcpy(dip->label.name, AudioNmute);\n\tmute1:\n\t\tdip->type = AUDIO_MIXER_ENUM;\n\t\tdip->un.e.num_mem = 2;\n\t\tstrcpy(dip->un.e.member[0].label.name, AudioNoff);\n\t\tdip->un.e.member[0].ord = 0;\n\t\tstrcpy(dip->un.e.member[1].label.name, AudioNon);\n\t\tdip->un.e.member[1].ord = 1;\n\t\treturn 0;\n\n\t}\n\n\treturn ENXIO;\n}"
  },
  {
    "function_name": "sbdsp_mixer_get_port",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1793-1892",
    "snippet": "int\nsbdsp_mixer_get_port(addr, cp)\n\tvoid *addr;\n\tmixer_ctrl_t *cp;\n{\n\tstruct sbdsp_softc *sc = addr;\n    \n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_mixer_get_port: port=%d\\n\", cp->dev));\n\n\tif (sc->sc_mixer_model == SBM_NONE)\n\t\treturn EINVAL;\n\n\tswitch (cp->dev) {\n\tcase SB_TREBLE:\n\tcase SB_BASS:\n\t\tif (sc->sc_mixer_model == SBM_CT1345 ||\n                    sc->sc_mixer_model == SBM_CT1XX5) {\n\t\t\tswitch (cp->dev) {\n\t\t\tcase SB_TREBLE:\n\t\t\t\tcp->un.ord = sbdsp_get_ifilter(addr) == SB_TREBLE;\n\t\t\t\treturn 0;\n\t\t\tcase SB_BASS:\n\t\t\t\tcp->un.ord = sbdsp_get_ifilter(addr) == SB_BASS;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\tcase SB_PCSPEAKER:\n\tcase SB_INPUT_GAIN:\n\tcase SB_OUTPUT_GAIN:\n\t\tif (!ISSBM1745(sc))\n\t\t\treturn EINVAL;\n\tcase SB_MIC_VOL:\n\tcase SB_LINE_IN_VOL:\n\t\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\t\treturn EINVAL;\n\tcase SB_VOICE_VOL:\n\tcase SB_MIDI_VOL:\n\tcase SB_CD_VOL:\n\tcase SB_MASTER_VOL:\n\t\tswitch (cp->dev) {\n\t\tcase SB_MIC_VOL:\n\t\tcase SB_PCSPEAKER:\n\t\t\tif (cp->un.value.num_channels != 1)\n\t\t\t\treturn EINVAL;\n\t\t\t/* fall into */\n\t\tdefault:\n\t\t\tswitch (cp->un.value.num_channels) {\n\t\t\tcase 1:\n\t\t\t\tcp->un.value.level[AUDIO_MIXER_LEVEL_MONO] = \n\t\t\t\t\tsc->gain[cp->dev][SB_LEFT];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcp->un.value.level[AUDIO_MIXER_LEVEL_LEFT] = \n\t\t\t\t\tsc->gain[cp->dev][SB_LEFT];\n\t\t\t\tcp->un.value.level[AUDIO_MIXER_LEVEL_RIGHT] = \n\t\t\t\t\tsc->gain[cp->dev][SB_RIGHT];\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase SB_RECORD_SOURCE:\n\t\tif (ISSBM1745(sc))\n\t\t\tcp->un.mask = sc->in_mask;\n\t\telse\n\t\t\tcp->un.ord = sc->in_port;\n\t\tbreak;\n\n\tcase SB_AGC:\n\t\tif (!ISSBM1745(sc))\n\t\t\treturn EINVAL;\n\t\tcp->un.ord = sbdsp_mix_read(sc, SB16P_AGC);\n\t\tbreak;\n\n\tcase SB_CD_IN_MUTE:\n\tcase SB_MIC_IN_MUTE:\n\tcase SB_LINE_IN_MUTE:\n\tcase SB_MIDI_IN_MUTE:\n\tcase SB_CD_SWAP:\n\tcase SB_MIC_SWAP:\n\tcase SB_LINE_SWAP:\n\tcase SB_MIDI_SWAP:\n\tcase SB_CD_OUT_MUTE:\n\tcase SB_MIC_OUT_MUTE:\n\tcase SB_LINE_OUT_MUTE:\n\t\tcp->un.ord = sc->gain[cp->dev][SB_LR];\n\t\tbreak;\n\n\tdefault:\n\t\treturn EINVAL;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_get_ifilter",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SB16P_AGC"
          ],
          "line": 1870
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1868
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_get_ifilter",
          "args": [
            "addr"
          ],
          "line": 1818
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_get_ifilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "748-764",
          "snippet": "int\nsbdsp_get_ifilter(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\t\n\tsc->in_filter =\n\t\tsbdsp_mix_read(sc, SBP_INFILTER) & SBP_IFILTER_MASK;\n\tswitch (sc->in_filter) {\n\tcase SBP_FILTER_ON|SBP_IFILTER_HIGH:\n\t\treturn SB_TREBLE;\n\tcase SBP_FILTER_ON|SBP_IFILTER_LOW:\n\t\treturn SB_BASS;\n\tdefault:\n\t\treturn 0;\n\t}\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_get_ifilter",
            "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_get_ifilter;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_get_ifilter(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\t\n\tsc->in_filter =\n\t\tsbdsp_mix_read(sc, SBP_INFILTER) & SBP_IFILTER_MASK;\n\tswitch (sc->in_filter) {\n\tcase SBP_FILTER_ON|SBP_IFILTER_HIGH:\n\t\treturn SB_TREBLE;\n\tcase SBP_FILTER_ON|SBP_IFILTER_LOW:\n\t\treturn SB_BASS;\n\tdefault:\n\t\treturn 0;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_mixer_get_port: port=%d\\n\", cp->dev)"
          ],
          "line": 1803
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_get_ifilter;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_mixer_get_port(addr, cp)\n\tvoid *addr;\n\tmixer_ctrl_t *cp;\n{\n\tstruct sbdsp_softc *sc = addr;\n    \n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_mixer_get_port: port=%d\\n\", cp->dev));\n\n\tif (sc->sc_mixer_model == SBM_NONE)\n\t\treturn EINVAL;\n\n\tswitch (cp->dev) {\n\tcase SB_TREBLE:\n\tcase SB_BASS:\n\t\tif (sc->sc_mixer_model == SBM_CT1345 ||\n                    sc->sc_mixer_model == SBM_CT1XX5) {\n\t\t\tswitch (cp->dev) {\n\t\t\tcase SB_TREBLE:\n\t\t\t\tcp->un.ord = sbdsp_get_ifilter(addr) == SB_TREBLE;\n\t\t\t\treturn 0;\n\t\t\tcase SB_BASS:\n\t\t\t\tcp->un.ord = sbdsp_get_ifilter(addr) == SB_BASS;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\tcase SB_PCSPEAKER:\n\tcase SB_INPUT_GAIN:\n\tcase SB_OUTPUT_GAIN:\n\t\tif (!ISSBM1745(sc))\n\t\t\treturn EINVAL;\n\tcase SB_MIC_VOL:\n\tcase SB_LINE_IN_VOL:\n\t\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\t\treturn EINVAL;\n\tcase SB_VOICE_VOL:\n\tcase SB_MIDI_VOL:\n\tcase SB_CD_VOL:\n\tcase SB_MASTER_VOL:\n\t\tswitch (cp->dev) {\n\t\tcase SB_MIC_VOL:\n\t\tcase SB_PCSPEAKER:\n\t\t\tif (cp->un.value.num_channels != 1)\n\t\t\t\treturn EINVAL;\n\t\t\t/* fall into */\n\t\tdefault:\n\t\t\tswitch (cp->un.value.num_channels) {\n\t\t\tcase 1:\n\t\t\t\tcp->un.value.level[AUDIO_MIXER_LEVEL_MONO] = \n\t\t\t\t\tsc->gain[cp->dev][SB_LEFT];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcp->un.value.level[AUDIO_MIXER_LEVEL_LEFT] = \n\t\t\t\t\tsc->gain[cp->dev][SB_LEFT];\n\t\t\t\tcp->un.value.level[AUDIO_MIXER_LEVEL_RIGHT] = \n\t\t\t\t\tsc->gain[cp->dev][SB_RIGHT];\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase SB_RECORD_SOURCE:\n\t\tif (ISSBM1745(sc))\n\t\t\tcp->un.mask = sc->in_mask;\n\t\telse\n\t\t\tcp->un.ord = sc->in_port;\n\t\tbreak;\n\n\tcase SB_AGC:\n\t\tif (!ISSBM1745(sc))\n\t\t\treturn EINVAL;\n\t\tcp->un.ord = sbdsp_mix_read(sc, SB16P_AGC);\n\t\tbreak;\n\n\tcase SB_CD_IN_MUTE:\n\tcase SB_MIC_IN_MUTE:\n\tcase SB_LINE_IN_MUTE:\n\tcase SB_MIDI_IN_MUTE:\n\tcase SB_CD_SWAP:\n\tcase SB_MIC_SWAP:\n\tcase SB_LINE_SWAP:\n\tcase SB_MIDI_SWAP:\n\tcase SB_CD_OUT_MUTE:\n\tcase SB_MIC_OUT_MUTE:\n\tcase SB_LINE_OUT_MUTE:\n\t\tcp->un.ord = sc->gain[cp->dev][SB_LR];\n\t\tbreak;\n\n\tdefault:\n\t\treturn EINVAL;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_mixer_set_port",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1602-1791",
    "snippet": "int\nsbdsp_mixer_set_port(addr, cp)\n\tvoid *addr;\n\tmixer_ctrl_t *cp;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint lgain, rgain;\n\tint mask, bits;\n\tint lmask, rmask, lbits, rbits;\n\tint mute, swap;\n    \n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_mixer_set_port: port=%d num_channels=%d\\n\", cp->dev,\n\t    cp->un.value.num_channels));\n\n\tif (sc->sc_mixer_model == SBM_NONE)\n\t\treturn EINVAL;\n\n\tswitch (cp->dev) {\n\tcase SB_TREBLE:\n\tcase SB_BASS:\n\t\tif (sc->sc_mixer_model == SBM_CT1345 ||\n                    sc->sc_mixer_model == SBM_CT1XX5) {\n\t\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\t\treturn EINVAL;\n\t\t\tswitch (cp->dev) {\n\t\t\tcase SB_TREBLE:\n\t\t\t\tsbdsp_set_ifilter(addr, cp->un.ord ? SB_TREBLE : 0);\n\t\t\t\treturn 0;\n\t\t\tcase SB_BASS:\n\t\t\t\tsbdsp_set_ifilter(addr, cp->un.ord ? SB_BASS : 0);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\tcase SB_PCSPEAKER:\n\tcase SB_INPUT_GAIN:\n\tcase SB_OUTPUT_GAIN:\n\t\tif (!ISSBM1745(sc))\n\t\t\treturn EINVAL;\n\tcase SB_MIC_VOL:\n\tcase SB_LINE_IN_VOL:\n\t\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\t\treturn EINVAL;\n\tcase SB_VOICE_VOL:\n\tcase SB_MIDI_VOL:\n\tcase SB_CD_VOL:\n\tcase SB_MASTER_VOL:\n\t\tif (cp->type != AUDIO_MIXER_VALUE)\n\t\t\treturn EINVAL;\n\n\t\t/*\n\t\t * All the mixer ports are stereo except for the microphone.\n\t\t * If we get a single-channel gain value passed in, then we\n\t\t * duplicate it to both left and right channels.\n\t\t */\n\n\t\tswitch (cp->dev) {\n\t\tcase SB_MIC_VOL:\n\t\t\tif (cp->un.value.num_channels != 1)\n\t\t\t\treturn EINVAL;\n\n\t\t\tlgain = rgain = SB_ADJUST_MIC_GAIN(sc, \n\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]);\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tif (cp->un.value.num_channels != 1)\n\t\t\t\treturn EINVAL;\n\t\t\t/* fall into */\n\t\tcase SB_INPUT_GAIN:\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tlgain = rgain = SB_ADJUST_2_GAIN(sc, \n\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tswitch (cp->un.value.num_channels) {\n\t\t\tcase 1:\n\t\t\t\tlgain = rgain = SB_ADJUST_GAIN(sc, \n\t\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\t\t\t\treturn EINVAL;\n\t\t\t\tlgain = SB_ADJUST_GAIN(sc, \n\t\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_LEFT]);\n\t\t\t\trgain = SB_ADJUST_GAIN(sc, \n\t\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_RIGHT]);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tsc->gain[cp->dev][SB_LEFT]  = lgain;\n\t\tsc->gain[cp->dev][SB_RIGHT] = rgain;\n\n\t\tsbdsp_set_mixer_gain(sc, cp->dev);\n\t\tbreak;\n\n\tcase SB_RECORD_SOURCE:\n\t\tif (ISSBM1745(sc)) {\n\t\t\tif (cp->type != AUDIO_MIXER_SET)\n\t\t\t\treturn EINVAL;\n\t\t\treturn sbdsp_set_in_ports(sc, cp->un.mask);\n\t\t} else {\n\t\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\t\treturn EINVAL;\n\t\t\tsc->in_port = cp->un.ord;\n\t\t\treturn sbdsp_set_in_ports(sc, 1 << cp->un.ord);\n\t\t}\n\t\tbreak;\n\n\tcase SB_AGC:\n\t\tif (!ISSBM1745(sc) || cp->type != AUDIO_MIXER_ENUM)\n\t\t\treturn EINVAL;\n\t\tsbdsp_mix_write(sc, SB16P_AGC, cp->un.ord & 1);\n\t\tbreak;\n\n\tcase SB_CD_OUT_MUTE:\n\t\tmask = SB16P_SW_CD;\n\t\tgoto omute;\n\tcase SB_MIC_OUT_MUTE:\n\t\tmask = SB16P_SW_MIC;\n\t\tgoto omute;\n\tcase SB_LINE_OUT_MUTE:\n\t\tmask = SB16P_SW_LINE;\n\tomute:\n\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\treturn EINVAL;\n\t\tbits = sbdsp_mix_read(sc, SB16P_OSWITCH);\n\t\tsc->gain[cp->dev][SB_LR] = cp->un.ord != 0;\n\t\tif (cp->un.ord)\n\t\t\tbits = bits & ~mask;\n\t\telse\n\t\t\tbits = bits | mask;\n\t\tsbdsp_mix_write(sc, SB16P_OSWITCH, bits);\n\t\tbreak;\n\n\tcase SB_MIC_IN_MUTE:\n\tcase SB_MIC_SWAP:\n\t\tlmask = rmask = SB16P_SW_MIC;\n\t\tgoto imute;\n\tcase SB_CD_IN_MUTE:\n\tcase SB_CD_SWAP:\n\t\tlmask = SB16P_SW_CD_L;\n\t\trmask = SB16P_SW_CD_R;\n\t\tgoto imute;\n\tcase SB_LINE_IN_MUTE:\n\tcase SB_LINE_SWAP:\n\t\tlmask = SB16P_SW_LINE_L;\n\t\trmask = SB16P_SW_LINE_R;\n\t\tgoto imute;\n\tcase SB_MIDI_IN_MUTE:\n\tcase SB_MIDI_SWAP:\n\t\tlmask = SB16P_SW_MIDI_L;\n\t\trmask = SB16P_SW_MIDI_R;\n\timute:\n\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\treturn EINVAL;\n\t\tmask = lmask | rmask;\n\t\tlbits = sbdsp_mix_read(sc, SB16P_ISWITCH_L) & ~mask;\n\t\trbits = sbdsp_mix_read(sc, SB16P_ISWITCH_R) & ~mask;\n\t\tsc->gain[cp->dev][SB_LR] = cp->un.ord != 0;\n\t\tif (SB_IS_IN_MUTE(cp->dev)) {\n\t\t\tmute = cp->dev;\n\t\t\tswap = mute - SB_CD_IN_MUTE + SB_CD_SWAP;\n\t\t} else {\n\t\t\tswap = cp->dev;\n\t\t\tmute = swap + SB_CD_IN_MUTE - SB_CD_SWAP;\n\t\t}\n\t\tif (sc->gain[swap][SB_LR]) {\n\t\t\tmask = lmask;\n\t\t\tlmask = rmask;\n\t\t\trmask = mask;\n\t\t}\n\t\tif (!sc->gain[mute][SB_LR]) {\n\t\t\tlbits = lbits | lmask;\n\t\t\trbits = rbits | rmask;\n\t\t}\n\t\tsbdsp_mix_write(sc, SB16P_ISWITCH_L, lbits);\n\t\tsbdsp_mix_write(sc, SB16P_ISWITCH_L, rbits);\n\t\tbreak;\n\n\tdefault:\n\t\treturn EINVAL;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_set_mixer_gain",
      "int\tsbdsp_set_in_ports",
      "void\tsbdsp_set_ifilter",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SB16P_ISWITCH_L",
            "rbits"
          ],
          "line": 1783
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "SB_IS_IN_MUTE",
          "args": [
            "cp->dev"
          ],
          "line": 1766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SB16P_ISWITCH_R"
          ],
          "line": 1764
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_set_in_ports",
          "args": [
            "sc",
            "1 << cp->un.ord"
          ],
          "line": 1711
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_in_ports",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "766-824",
          "snippet": "int\nsbdsp_set_in_ports(sc, mask)\n\tstruct sbdsp_softc *sc;\n\tint mask;\n{\n\tint bitsl, bitsr;\n\tint sbport;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask));\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn EINVAL;\n\tcase SBM_CT1335:\n\t\tif (mask != (1 << SB_MIC_VOL))\n\t\t\treturn EINVAL;\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tswitch (mask) {\n\t\tcase 1 << SB_MIC_VOL:\n\t\t\tsbport = SBP_FROM_MIC;\n\t\t\tbreak;\n\t\tcase 1 << SB_LINE_IN_VOL:\n\t\t\tsbport = SBP_FROM_LINE;\n\t\t\tbreak;\n\t\tcase 1 << SB_CD_VOL:\n\t\t\tsbport = SBP_FROM_CD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn (EINVAL);\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE, sbport | sc->in_filter);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tif (mask & ~((1<<SB_MIDI_VOL) | (1<<SB_LINE_IN_VOL) |\n\t\t\t     (1<<SB_CD_VOL) | (1<<SB_MIC_VOL)))\n\t\t\treturn EINVAL;\n\t\tbitsr = 0;\n\t\tif (mask & (1<<SB_MIDI_VOL))    bitsr |= SBP_MIDI_SRC_R;\n\t\tif (mask & (1<<SB_LINE_IN_VOL)) bitsr |= SBP_LINE_SRC_R;\n\t\tif (mask & (1<<SB_CD_VOL))      bitsr |= SBP_CD_SRC_R;\n\t\tbitsl = SB_SRC_R_TO_L(bitsr);\n\t\tif (mask & (1<<SB_MIC_VOL)) {\n\t\t\tbitsl |= SBP_MIC_SRC;\n\t\t\tbitsr |= SBP_MIC_SRC;\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_L, bitsl);\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_R, bitsr);\n\t\tbreak;\n\t}\n\tsc->in_mask = mask;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_set_in_ports"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_in_ports;\n\nint\nsbdsp_set_in_ports(sc, mask)\n\tstruct sbdsp_softc *sc;\n\tint mask;\n{\n\tint bitsl, bitsr;\n\tint sbport;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask));\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn EINVAL;\n\tcase SBM_CT1335:\n\t\tif (mask != (1 << SB_MIC_VOL))\n\t\t\treturn EINVAL;\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tswitch (mask) {\n\t\tcase 1 << SB_MIC_VOL:\n\t\t\tsbport = SBP_FROM_MIC;\n\t\t\tbreak;\n\t\tcase 1 << SB_LINE_IN_VOL:\n\t\t\tsbport = SBP_FROM_LINE;\n\t\t\tbreak;\n\t\tcase 1 << SB_CD_VOL:\n\t\t\tsbport = SBP_FROM_CD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn (EINVAL);\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE, sbport | sc->in_filter);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tif (mask & ~((1<<SB_MIDI_VOL) | (1<<SB_LINE_IN_VOL) |\n\t\t\t     (1<<SB_CD_VOL) | (1<<SB_MIC_VOL)))\n\t\t\treturn EINVAL;\n\t\tbitsr = 0;\n\t\tif (mask & (1<<SB_MIDI_VOL))    bitsr |= SBP_MIDI_SRC_R;\n\t\tif (mask & (1<<SB_LINE_IN_VOL)) bitsr |= SBP_LINE_SRC_R;\n\t\tif (mask & (1<<SB_CD_VOL))      bitsr |= SBP_CD_SRC_R;\n\t\tbitsl = SB_SRC_R_TO_L(bitsr);\n\t\tif (mask & (1<<SB_MIC_VOL)) {\n\t\t\tbitsl |= SBP_MIC_SRC;\n\t\t\tbitsr |= SBP_MIC_SRC;\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_L, bitsl);\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_R, bitsr);\n\t\tbreak;\n\t}\n\tsc->in_mask = mask;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1703
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_set_mixer_gain",
          "args": [
            "sc",
            "cp->dev"
          ],
          "line": 1699
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_mixer_gain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1498-1600",
          "snippet": "void\nsbdsp_set_mixer_gain(sc, port)\n\tstruct sbdsp_softc *sc;\n\tint port;\n{\n\tint src, gain;\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn;\n\tcase SBM_CT1335:\n\t\tgain = SB_1335_GAIN(sc->gain[port][SB_LEFT]);\n\t\tswitch(port) {\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_1335_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_1335_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_1335_CD_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_1335_VOICE_VOL;\n\t\t\tgain = SB_1335_MASTER_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tgain = SB_STEREO_GAIN(sc->gain[port][SB_LEFT],\n\t\t\t\t      sc->gain[port][SB_RIGHT]);\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SBP_MIC_VOL;\n\t\t\tgain = SB_MIC_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SBP_LINE_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_VOICE_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_CD_VOL;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SB16P_MIC_L;\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SB16P_MASTER_L;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SB16P_LINE_L;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SB16P_VOICE_L;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SB16P_MIDI_L;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SB16P_CD_L;\n\t\t\tbreak;\n\t\tcase SB_INPUT_GAIN:\n\t\t\tsrc = SB16P_INPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tsrc = SB16P_OUTPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_TREBLE:\n\t\t\tsrc = SB16P_TREBLE_L;\n\t\t\tbreak;\n\t\tcase SB_BASS:\n\t\t\tsrc = SB16P_BASS_L;\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tsbdsp_mix_write(sc, SB16P_PCSPEAKER, sc->gain[port][SB_LEFT]);\n\t\t\treturn;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, sc->gain[port][SB_LEFT]);\n\t\tsbdsp_mix_write(sc, SB16P_L_TO_R(src), sc->gain[port][SB_RIGHT]);\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_set_mixer_gain"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_mixer_gain;\n\nvoid\nsbdsp_set_mixer_gain(sc, port)\n\tstruct sbdsp_softc *sc;\n\tint port;\n{\n\tint src, gain;\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn;\n\tcase SBM_CT1335:\n\t\tgain = SB_1335_GAIN(sc->gain[port][SB_LEFT]);\n\t\tswitch(port) {\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_1335_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_1335_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_1335_CD_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_1335_VOICE_VOL;\n\t\t\tgain = SB_1335_MASTER_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tgain = SB_STEREO_GAIN(sc->gain[port][SB_LEFT],\n\t\t\t\t      sc->gain[port][SB_RIGHT]);\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SBP_MIC_VOL;\n\t\t\tgain = SB_MIC_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SBP_LINE_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_VOICE_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_CD_VOL;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SB16P_MIC_L;\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SB16P_MASTER_L;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SB16P_LINE_L;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SB16P_VOICE_L;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SB16P_MIDI_L;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SB16P_CD_L;\n\t\t\tbreak;\n\t\tcase SB_INPUT_GAIN:\n\t\t\tsrc = SB16P_INPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tsrc = SB16P_OUTPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_TREBLE:\n\t\t\tsrc = SB16P_TREBLE_L;\n\t\t\tbreak;\n\t\tcase SB_BASS:\n\t\t\tsrc = SB16P_BASS_L;\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tsbdsp_mix_write(sc, SB16P_PCSPEAKER, sc->gain[port][SB_LEFT]);\n\t\t\treturn;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, sc->gain[port][SB_LEFT]);\n\t\tsbdsp_mix_write(sc, SB16P_L_TO_R(src), sc->gain[port][SB_RIGHT]);\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_GAIN",
          "args": [
            "sc",
            "cp->un.value.level[AUDIO_MIXER_LEVEL_RIGHT]"
          ],
          "line": 1688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_GAIN",
          "args": [
            "sc",
            "cp->un.value.level[AUDIO_MIXER_LEVEL_LEFT]"
          ],
          "line": 1686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_GAIN",
          "args": [
            "sc",
            "cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]"
          ],
          "line": 1680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_2_GAIN",
          "args": [
            "sc",
            "cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]"
          ],
          "line": 1674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_MIC_GAIN",
          "args": [
            "sc",
            "cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]"
          ],
          "line": 1665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSBM1745",
          "args": [
            "sc"
          ],
          "line": 1641
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_set_ifilter",
          "args": [
            "addr",
            "cp->un.ord ? SB_BASS : 0"
          ],
          "line": 1634
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_ifilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "722-746",
          "snippet": "void\nsbdsp_set_ifilter(addr, which)\n\tvoid *addr;\n\tint which;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint mixval;\n\n\tmixval = sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK;\n\tswitch (which) {\n\tcase 0:\n\t\tmixval |= SBP_FILTER_OFF;\n\t\tbreak;\n\tcase SB_TREBLE:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_HIGH;\n\t\tbreak;\n\tcase SB_BASS:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_LOW; \n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tsc->in_filter = mixval & SBP_IFILTER_MASK;\n\tsbdsp_mix_write(sc, SBP_INFILTER, mixval);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_set_ifilter",
            "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_ifilter;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nvoid\nsbdsp_set_ifilter(addr, which)\n\tvoid *addr;\n\tint which;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint mixval;\n\n\tmixval = sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK;\n\tswitch (which) {\n\tcase 0:\n\t\tmixval |= SBP_FILTER_OFF;\n\t\tbreak;\n\tcase SB_TREBLE:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_HIGH;\n\t\tbreak;\n\tcase SB_BASS:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_LOW; \n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tsc->in_filter = mixval & SBP_IFILTER_MASK;\n\tsbdsp_mix_write(sc, SBP_INFILTER, mixval);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_mixer_set_port: port=%d num_channels=%d\\n\", cp->dev,\n\t    cp->un.value.num_channels)"
          ],
          "line": 1616
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_mixer_gain;\nint\tsbdsp_set_in_ports;\nvoid\tsbdsp_set_ifilter;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_mixer_set_port(addr, cp)\n\tvoid *addr;\n\tmixer_ctrl_t *cp;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint lgain, rgain;\n\tint mask, bits;\n\tint lmask, rmask, lbits, rbits;\n\tint mute, swap;\n    \n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_mixer_set_port: port=%d num_channels=%d\\n\", cp->dev,\n\t    cp->un.value.num_channels));\n\n\tif (sc->sc_mixer_model == SBM_NONE)\n\t\treturn EINVAL;\n\n\tswitch (cp->dev) {\n\tcase SB_TREBLE:\n\tcase SB_BASS:\n\t\tif (sc->sc_mixer_model == SBM_CT1345 ||\n                    sc->sc_mixer_model == SBM_CT1XX5) {\n\t\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\t\treturn EINVAL;\n\t\t\tswitch (cp->dev) {\n\t\t\tcase SB_TREBLE:\n\t\t\t\tsbdsp_set_ifilter(addr, cp->un.ord ? SB_TREBLE : 0);\n\t\t\t\treturn 0;\n\t\t\tcase SB_BASS:\n\t\t\t\tsbdsp_set_ifilter(addr, cp->un.ord ? SB_BASS : 0);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\tcase SB_PCSPEAKER:\n\tcase SB_INPUT_GAIN:\n\tcase SB_OUTPUT_GAIN:\n\t\tif (!ISSBM1745(sc))\n\t\t\treturn EINVAL;\n\tcase SB_MIC_VOL:\n\tcase SB_LINE_IN_VOL:\n\t\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\t\treturn EINVAL;\n\tcase SB_VOICE_VOL:\n\tcase SB_MIDI_VOL:\n\tcase SB_CD_VOL:\n\tcase SB_MASTER_VOL:\n\t\tif (cp->type != AUDIO_MIXER_VALUE)\n\t\t\treturn EINVAL;\n\n\t\t/*\n\t\t * All the mixer ports are stereo except for the microphone.\n\t\t * If we get a single-channel gain value passed in, then we\n\t\t * duplicate it to both left and right channels.\n\t\t */\n\n\t\tswitch (cp->dev) {\n\t\tcase SB_MIC_VOL:\n\t\t\tif (cp->un.value.num_channels != 1)\n\t\t\t\treturn EINVAL;\n\n\t\t\tlgain = rgain = SB_ADJUST_MIC_GAIN(sc, \n\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]);\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tif (cp->un.value.num_channels != 1)\n\t\t\t\treturn EINVAL;\n\t\t\t/* fall into */\n\t\tcase SB_INPUT_GAIN:\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tlgain = rgain = SB_ADJUST_2_GAIN(sc, \n\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tswitch (cp->un.value.num_channels) {\n\t\t\tcase 1:\n\t\t\t\tlgain = rgain = SB_ADJUST_GAIN(sc, \n\t\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_MONO]);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tif (sc->sc_mixer_model == SBM_CT1335)\n\t\t\t\t\treturn EINVAL;\n\t\t\t\tlgain = SB_ADJUST_GAIN(sc, \n\t\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_LEFT]);\n\t\t\t\trgain = SB_ADJUST_GAIN(sc, \n\t\t\t\t  cp->un.value.level[AUDIO_MIXER_LEVEL_RIGHT]);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tsc->gain[cp->dev][SB_LEFT]  = lgain;\n\t\tsc->gain[cp->dev][SB_RIGHT] = rgain;\n\n\t\tsbdsp_set_mixer_gain(sc, cp->dev);\n\t\tbreak;\n\n\tcase SB_RECORD_SOURCE:\n\t\tif (ISSBM1745(sc)) {\n\t\t\tif (cp->type != AUDIO_MIXER_SET)\n\t\t\t\treturn EINVAL;\n\t\t\treturn sbdsp_set_in_ports(sc, cp->un.mask);\n\t\t} else {\n\t\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\t\treturn EINVAL;\n\t\t\tsc->in_port = cp->un.ord;\n\t\t\treturn sbdsp_set_in_ports(sc, 1 << cp->un.ord);\n\t\t}\n\t\tbreak;\n\n\tcase SB_AGC:\n\t\tif (!ISSBM1745(sc) || cp->type != AUDIO_MIXER_ENUM)\n\t\t\treturn EINVAL;\n\t\tsbdsp_mix_write(sc, SB16P_AGC, cp->un.ord & 1);\n\t\tbreak;\n\n\tcase SB_CD_OUT_MUTE:\n\t\tmask = SB16P_SW_CD;\n\t\tgoto omute;\n\tcase SB_MIC_OUT_MUTE:\n\t\tmask = SB16P_SW_MIC;\n\t\tgoto omute;\n\tcase SB_LINE_OUT_MUTE:\n\t\tmask = SB16P_SW_LINE;\n\tomute:\n\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\treturn EINVAL;\n\t\tbits = sbdsp_mix_read(sc, SB16P_OSWITCH);\n\t\tsc->gain[cp->dev][SB_LR] = cp->un.ord != 0;\n\t\tif (cp->un.ord)\n\t\t\tbits = bits & ~mask;\n\t\telse\n\t\t\tbits = bits | mask;\n\t\tsbdsp_mix_write(sc, SB16P_OSWITCH, bits);\n\t\tbreak;\n\n\tcase SB_MIC_IN_MUTE:\n\tcase SB_MIC_SWAP:\n\t\tlmask = rmask = SB16P_SW_MIC;\n\t\tgoto imute;\n\tcase SB_CD_IN_MUTE:\n\tcase SB_CD_SWAP:\n\t\tlmask = SB16P_SW_CD_L;\n\t\trmask = SB16P_SW_CD_R;\n\t\tgoto imute;\n\tcase SB_LINE_IN_MUTE:\n\tcase SB_LINE_SWAP:\n\t\tlmask = SB16P_SW_LINE_L;\n\t\trmask = SB16P_SW_LINE_R;\n\t\tgoto imute;\n\tcase SB_MIDI_IN_MUTE:\n\tcase SB_MIDI_SWAP:\n\t\tlmask = SB16P_SW_MIDI_L;\n\t\trmask = SB16P_SW_MIDI_R;\n\timute:\n\t\tif (cp->type != AUDIO_MIXER_ENUM)\n\t\t\treturn EINVAL;\n\t\tmask = lmask | rmask;\n\t\tlbits = sbdsp_mix_read(sc, SB16P_ISWITCH_L) & ~mask;\n\t\trbits = sbdsp_mix_read(sc, SB16P_ISWITCH_R) & ~mask;\n\t\tsc->gain[cp->dev][SB_LR] = cp->un.ord != 0;\n\t\tif (SB_IS_IN_MUTE(cp->dev)) {\n\t\t\tmute = cp->dev;\n\t\t\tswap = mute - SB_CD_IN_MUTE + SB_CD_SWAP;\n\t\t} else {\n\t\t\tswap = cp->dev;\n\t\t\tmute = swap + SB_CD_IN_MUTE - SB_CD_SWAP;\n\t\t}\n\t\tif (sc->gain[swap][SB_LR]) {\n\t\t\tmask = lmask;\n\t\t\tlmask = rmask;\n\t\t\trmask = mask;\n\t\t}\n\t\tif (!sc->gain[mute][SB_LR]) {\n\t\t\tlbits = lbits | lmask;\n\t\t\trbits = rbits | rmask;\n\t\t}\n\t\tsbdsp_mix_write(sc, SB16P_ISWITCH_L, lbits);\n\t\tsbdsp_mix_write(sc, SB16P_ISWITCH_L, rbits);\n\t\tbreak;\n\n\tdefault:\n\t\treturn EINVAL;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_set_mixer_gain",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1498-1600",
    "snippet": "void\nsbdsp_set_mixer_gain(sc, port)\n\tstruct sbdsp_softc *sc;\n\tint port;\n{\n\tint src, gain;\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn;\n\tcase SBM_CT1335:\n\t\tgain = SB_1335_GAIN(sc->gain[port][SB_LEFT]);\n\t\tswitch(port) {\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_1335_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_1335_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_1335_CD_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_1335_VOICE_VOL;\n\t\t\tgain = SB_1335_MASTER_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tgain = SB_STEREO_GAIN(sc->gain[port][SB_LEFT],\n\t\t\t\t      sc->gain[port][SB_RIGHT]);\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SBP_MIC_VOL;\n\t\t\tgain = SB_MIC_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SBP_LINE_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_VOICE_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_CD_VOL;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SB16P_MIC_L;\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SB16P_MASTER_L;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SB16P_LINE_L;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SB16P_VOICE_L;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SB16P_MIDI_L;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SB16P_CD_L;\n\t\t\tbreak;\n\t\tcase SB_INPUT_GAIN:\n\t\t\tsrc = SB16P_INPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tsrc = SB16P_OUTPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_TREBLE:\n\t\t\tsrc = SB16P_TREBLE_L;\n\t\t\tbreak;\n\t\tcase SB_BASS:\n\t\t\tsrc = SB16P_BASS_L;\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tsbdsp_mix_write(sc, SB16P_PCSPEAKER, sc->gain[port][SB_LEFT]);\n\t\t\treturn;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, sc->gain[port][SB_LEFT]);\n\t\tsbdsp_mix_write(sc, SB16P_L_TO_R(src), sc->gain[port][SB_RIGHT]);\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_set_mixer_gain"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SB16P_L_TO_R(src)",
            "sc->gain[port][SB_RIGHT]"
          ],
          "line": 1597
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "SB16P_L_TO_R",
          "args": [
            "src"
          ],
          "line": 1597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_MIC_GAIN",
          "args": [
            "sc->gain[port][SB_LEFT]"
          ],
          "line": 1535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_STEREO_GAIN",
          "args": [
            "sc->gain[port][SB_LEFT]",
            "sc->gain[port][SB_RIGHT]"
          ],
          "line": 1530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_1335_MASTER_GAIN",
          "args": [
            "sc->gain[port][SB_LEFT]"
          ],
          "line": 1522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_1335_GAIN",
          "args": [
            "sc->gain[port][SB_LEFT]"
          ],
          "line": 1509
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_mixer_gain;\n\nvoid\nsbdsp_set_mixer_gain(sc, port)\n\tstruct sbdsp_softc *sc;\n\tint port;\n{\n\tint src, gain;\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn;\n\tcase SBM_CT1335:\n\t\tgain = SB_1335_GAIN(sc->gain[port][SB_LEFT]);\n\t\tswitch(port) {\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_1335_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_1335_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_1335_CD_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_1335_VOICE_VOL;\n\t\t\tgain = SB_1335_MASTER_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tgain = SB_STEREO_GAIN(sc->gain[port][SB_LEFT],\n\t\t\t\t      sc->gain[port][SB_RIGHT]);\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SBP_MIC_VOL;\n\t\t\tgain = SB_MIC_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SBP_LINE_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_VOICE_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_CD_VOL;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SB16P_MIC_L;\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SB16P_MASTER_L;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SB16P_LINE_L;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SB16P_VOICE_L;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SB16P_MIDI_L;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SB16P_CD_L;\n\t\t\tbreak;\n\t\tcase SB_INPUT_GAIN:\n\t\t\tsrc = SB16P_INPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tsrc = SB16P_OUTPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_TREBLE:\n\t\t\tsrc = SB16P_TREBLE_L;\n\t\t\tbreak;\n\t\tcase SB_BASS:\n\t\t\tsrc = SB16P_BASS_L;\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tsbdsp_mix_write(sc, SB16P_PCSPEAKER, sc->gain[port][SB_LEFT]);\n\t\t\treturn;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, sc->gain[port][SB_LEFT]);\n\t\tsbdsp_mix_write(sc, SB16P_L_TO_R(src), sc->gain[port][SB_RIGHT]);\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "sbdsp_adjust",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1488-1496",
    "snippet": "static int\nsbdsp_adjust(val, mask)\n\tint val, mask;\n{\n\tval += (MAXVAL - mask) >> 1;\n\tif (val >= MAXVAL)\n\t\tval = MAXVAL-1;\n\treturn val & mask;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [
      "#define MAXVAL 256"
    ],
    "globals_used": [
      "static\tint sbdsp_adjust"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define MAXVAL 256\n\nstatic\tint sbdsp_adjust;\n\nstatic int\nsbdsp_adjust(val, mask)\n\tint val, mask;\n{\n\tval += (MAXVAL - mask) >> 1;\n\tif (val >= MAXVAL)\n\t\tval = MAXVAL-1;\n\treturn val & mask;\n}"
  },
  {
    "function_name": "sbdsp_intr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1444-1484",
    "snippet": "int\nsbdsp_intr(arg)\n\tvoid *arg;\n{\n\tstruct sbdsp_softc *sc = arg;\n\tu_char irq;\n\n\tDPRINTFN(2, (\"sbdsp_intr: intr8=%p, intr16=%p\\n\",\n\t\t   sc->sc_intr8, sc->sc_intr16));\n\tif (ISSB16CLASS(sc)) {\n\t\tirq = sbdsp_mix_read(sc, SBP_IRQ_STATUS);\n\t\tif ((irq & (SBP_IRQ_DMA8 | SBP_IRQ_DMA16 | SBP_IRQ_MPU401)) == 0) {\n\t\t\tDPRINTF((\"sbdsp_intr: Spurious interrupt 0x%x\\n\", irq));\n\t\t\treturn 0;\n\t\t}\n\t} else {\n\t\t/* XXXX CHECK FOR INTERRUPT */\n\t\tirq = SBP_IRQ_DMA8;\n\t}\n\n\tsc->sc_interrupts++;\n\tdelay(10);\t\t/* XXX why? */\n\n\t/* clear interrupt */\n\tif (irq & SBP_IRQ_DMA8) {\n\t\tbus_space_read_1(sc->sc_iot, sc->sc_ioh, SBP_DSP_IRQACK8);\n\t\tif (sc->sc_intr8)\n\t\t\tsc->sc_intr8(sc->sc_arg8);\n\t}\n\tif (irq & SBP_IRQ_DMA16) {\n\t\tbus_space_read_1(sc->sc_iot, sc->sc_ioh, SBP_DSP_IRQACK16);\n\t\tif (sc->sc_intr16)\n\t\t\tsc->sc_intr16(sc->sc_arg16);\n\t}\n#if NMIDI > 0\n\tif ((irq & SBP_IRQ_MPU401) && sc->sc_hasmpu) {\n\t\tmpu_intr(&sc->sc_mpu_sc);\n\t}\n#endif\n\treturn 1;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mpu_intr",
          "args": [
            "&sc->sc_mpu_sc"
          ],
          "line": 1480
        },
        "resolved": true,
        "details": {
          "function_name": "mpu_intr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/mpu401.c",
          "lines": "243-255",
          "snippet": "int\nmpu_intr(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n\tif (MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_INPUT_EMPTY) {\n\t\tDPRINTF((\"mpu_intr: no data\\n\"));\n\t\treturn 0;\n\t}\n\tmpu_readinput(sc);\n\treturn 1;\n}",
          "includes": [
            "#include <dev/ic/mpuvar.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/midi_if.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define  MPU_INPUT_EMPTY\t0x80"
          ],
          "globals_used": [
            "int\tmpu_reset(struct mpu_softc *);",
            "static\t__inline int mpu_waitready(struct mpu_softc *);",
            "void\tmpu_readinput(struct mpu_softc *);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/ic/mpuvar.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/midi_if.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define  MPU_INPUT_EMPTY\t0x80\n\nint\tmpu_reset(struct mpu_softc *);\nstatic\t__inline int mpu_waitready(struct mpu_softc *);\nvoid\tmpu_readinput(struct mpu_softc *);\n\nint\nmpu_intr(v)\n\tvoid *v;\n{\n\tstruct mpu_softc *sc = v;\n\n\tif (MPU_GETSTATUS(sc->iot, sc->ioh) & MPU_INPUT_EMPTY) {\n\t\tDPRINTF((\"mpu_intr: no data\\n\"));\n\t\treturn 0;\n\t}\n\tmpu_readinput(sc);\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sc->sc_intr16",
          "args": [
            "sc->sc_arg16"
          ],
          "line": 1476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "sc->sc_iot",
            "sc->sc_ioh",
            "SBP_DSP_IRQACK16"
          ],
          "line": 1474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sc->sc_intr8",
          "args": [
            "sc->sc_arg8"
          ],
          "line": 1471
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "sc->sc_iot",
            "sc->sc_ioh",
            "SBP_DSP_IRQACK8"
          ],
          "line": 1469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "10"
          ],
          "line": 1465
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_intr: Spurious interrupt 0x%x\\n\", irq)"
          ],
          "line": 1456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SBP_IRQ_STATUS"
          ],
          "line": 1454
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 1453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "2",
            "(\"sbdsp_intr: intr8=%p, intr16=%p\\n\",\n\t\t   sc->sc_intr8, sc->sc_intr16)"
          ],
          "line": 1451
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_intr(arg)\n\tvoid *arg;\n{\n\tstruct sbdsp_softc *sc = arg;\n\tu_char irq;\n\n\tDPRINTFN(2, (\"sbdsp_intr: intr8=%p, intr16=%p\\n\",\n\t\t   sc->sc_intr8, sc->sc_intr16));\n\tif (ISSB16CLASS(sc)) {\n\t\tirq = sbdsp_mix_read(sc, SBP_IRQ_STATUS);\n\t\tif ((irq & (SBP_IRQ_DMA8 | SBP_IRQ_DMA16 | SBP_IRQ_MPU401)) == 0) {\n\t\t\tDPRINTF((\"sbdsp_intr: Spurious interrupt 0x%x\\n\", irq));\n\t\t\treturn 0;\n\t\t}\n\t} else {\n\t\t/* XXXX CHECK FOR INTERRUPT */\n\t\tirq = SBP_IRQ_DMA8;\n\t}\n\n\tsc->sc_interrupts++;\n\tdelay(10);\t\t/* XXX why? */\n\n\t/* clear interrupt */\n\tif (irq & SBP_IRQ_DMA8) {\n\t\tbus_space_read_1(sc->sc_iot, sc->sc_ioh, SBP_DSP_IRQACK8);\n\t\tif (sc->sc_intr8)\n\t\t\tsc->sc_intr8(sc->sc_arg8);\n\t}\n\tif (irq & SBP_IRQ_DMA16) {\n\t\tbus_space_read_1(sc->sc_iot, sc->sc_ioh, SBP_DSP_IRQACK16);\n\t\tif (sc->sc_intr16)\n\t\t\tsc->sc_intr16(sc->sc_arg16);\n\t}\n#if NMIDI > 0\n\tif ((irq & SBP_IRQ_MPU401) && sc->sc_hasmpu) {\n\t\tmpu_intr(&sc->sc_mpu_sc);\n\t}\n#endif\n\treturn 1;\n}"
  },
  {
    "function_name": "sbdsp_block_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1382-1432",
    "snippet": "int\nsbdsp_block_output(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_o.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_output: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_o.run != SB_NOTRUNNING)\n\t\tsc->sc_intrp(sc->sc_argp);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, initialized. Start DMA and PCM */\n\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_o.run = SB_RUNNING;\n\t} else if (sc->sc_o.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB16 cmd=0x%02x bmode=0x%02x cc=%d\\n\", \n\t\t\t    sc->sc_o.modep->cmd,sc->sc_o.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_o.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_output: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_o.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_block_output",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_output: SB2 DMA start failed\\n\")"
          ],
          "line": 1424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "sc->sc_o.modep->cmd"
          ],
          "line": 1423
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_output: SB2 DMA blocksize failed\\n\")"
          ],
          "line": 1420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_output: set blocksize=%d\\n\", cc)"
          ],
          "line": 1416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_output: SB16 DMA start failed\\n\")"
          ],
          "line": 1412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_output: SB16 cmd=0x%02x bmode=0x%02x cc=%d\\n\", \n\t\t\t    sc->sc_o.modep->cmd,sc->sc_o.bmode, cc)"
          ],
          "line": 1406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 1405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_output: SB1 DMA start failed\\n\")"
          ],
          "line": 1399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sc->sc_intrp",
          "args": [
            "sc->sc_argp"
          ],
          "line": 1392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "2",
            "(\"sbdsp_block_output: sc=%p cc=%d\\n\", addr, cc)"
          ],
          "line": 1389
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_block_output;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_block_output(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_o.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_output: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_o.run != SB_NOTRUNNING)\n\t\tsc->sc_intrp(sc->sc_argp);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, initialized. Start DMA and PCM */\n\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_o.run = SB_RUNNING;\n\t} else if (sc->sc_o.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB16 cmd=0x%02x bmode=0x%02x cc=%d\\n\", \n\t\t\t    sc->sc_o.modep->cmd,sc->sc_o.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_o.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_output: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_o.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}"
  },
  {
    "function_name": "sbdsp_trigger_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1299-1380",
    "snippet": "int\nsbdsp_trigger_output(addr, start, end, blksize, intr, arg, param)\n\tvoid *addr;\n\tvoid *start, *end;\n\tint blksize;\n\tvoid (*intr) __P((void *));\n\tvoid *arg;\n\tstruct audio_params *param;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint stereo = param->channels == 2;\n\tint width = param->precision * param->factor;\n\tint cmd;\n\n#ifdef DIAGNOSTIC\n\tif (stereo && (blksize & 1)) {\n\t\tDPRINTF((\"stereo playback odd bytes (%d)\\n\", blksize));\n\t\treturn (EIO);\n\t}\n#endif\n\n\tsc->sc_intrp = intr;\n\tsc->sc_argp = arg;\n\n\tif (width == 8) {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_o.dmachan != sc->sc_drq8) {\n\t\t\tprintf(\"sbdsp_trigger_output: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_o.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr8 = sbdsp_block_output;\n\t\tsc->sc_arg8 = addr;\n\t} else {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_o.dmachan != sc->sc_drq16) {\n\t\t\tprintf(\"sbdsp_trigger_output: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_o.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr16 = sbdsp_block_output;\n\t\tsc->sc_arg16 = addr;\n\t}\n\n\tif ((sc->sc_model == SB_JAZZ) ? (sc->sc_o.dmachan > 3) : (width == 16))\n\t\tblksize >>= 1;\n\t--blksize;\n\tsc->sc_o.blksize = blksize;\n\n\tif (ISSBPRO(sc)) {\n\t\t/* make sure we re-set stereo mixer bit when we start output. */\n\t\tsbdsp_mix_write(sc, SBP_STEREO,\n\t\t    (sbdsp_mix_read(sc, SBP_STEREO) & ~SBP_PLAYMODE_MASK) |\n\t\t    (stereo ?  SBP_PLAYMODE_STEREO : SBP_PLAYMODE_MONO));\n\t\tcmd = sc->sc_o.modep->cmdchan;\n\t\tif (cmd && sbdsp_wdsp(sc, cmd) < 0)\n\t\t\treturn (EIO);\n\t}\n\t\n\tif (ISSB16CLASS(sc)) {\n\t\tif (sbdsp16_set_rate(sc, SB_DSP16_OUTPUTRATE, sc->sc_o.rate)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_output: rate=%d set failed\\n\",\n\t\t\t\t sc->sc_o.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t} else {\n\t\tif (sbdsp_set_timeconst(sc, sc->sc_o.tc)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_output: tc=%d set failed\\n\",\n\t\t\t\t sc->sc_o.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t}\n\n\tDPRINTF((\"sbdsp: dma start loop output start=%p end=%p chan=%d\\n\",\n\t    start, end, sc->sc_o.dmachan));\n\tisa_dmastart(sc->sc_isa, sc->sc_o.dmachan, start, end - start,\n\t    NULL, DMAMODE_WRITE | DMAMODE_LOOP, BUS_DMA_NOWAIT);\n\n\treturn sbdsp_block_output(addr);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_set_timeconst",
      "int\tsbdsp16_set_rate",
      "int\tsbdsp_block_output",
      "__P((int, int));",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_block_output",
          "args": [
            "addr"
          ],
          "line": 1379
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_block_output",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1382-1432",
          "snippet": "int\nsbdsp_block_output(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_o.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_output: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_o.run != SB_NOTRUNNING)\n\t\tsc->sc_intrp(sc->sc_argp);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, initialized. Start DMA and PCM */\n\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_o.run = SB_RUNNING;\n\t} else if (sc->sc_o.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB16 cmd=0x%02x bmode=0x%02x cc=%d\\n\", \n\t\t\t    sc->sc_o.modep->cmd,sc->sc_o.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_o.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_output: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_o.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_block_output",
            "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_block_output;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_block_output(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_o.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_output: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_o.run != SB_NOTRUNNING)\n\t\tsc->sc_intrp(sc->sc_argp);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, initialized. Start DMA and PCM */\n\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_o.run = SB_RUNNING;\n\t} else if (sc->sc_o.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTF((\"sbdsp_block_output: SB16 cmd=0x%02x bmode=0x%02x cc=%d\\n\", \n\t\t\t    sc->sc_o.modep->cmd,sc->sc_o.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_o.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_output: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_o.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_output: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_o.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "isa_dmastart",
          "args": [
            "sc->sc_isa",
            "sc->sc_o.dmachan",
            "start",
            "end - start",
            "NULL",
            "DMAMODE_WRITE | DMAMODE_LOOP",
            "BUS_DMA_NOWAIT"
          ],
          "line": 1376
        },
        "resolved": true,
        "details": {
          "function_name": "isa_dmastart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/isadma.c",
          "lines": "288-422",
          "snippet": "int\nisa_dmastart(isadev, chan, addr, nbytes, p, flags, busdmaflags)\n\tstruct device *isadev;\n\tint chan;\n\tvoid *addr;\n\tbus_size_t nbytes;\n\tstruct proc *p;\n\tint flags;\n\tint busdmaflags;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\tbus_dmamap_t dmam;\n\tbus_addr_t dmaaddr;\n\tint waport;\n\tint ochan = chan & 3;\n\tint error;\n#ifdef __ISADMA_COMPAT\n\tint compat = busdmaflags & BUS_DMA_BUS1;\n\n\tbusdmaflags &= ~BUS_DMA_BUS1;\n#endif /* __ISADMA_COMPAT */\n\n\tif (chan < 0 || chan > 7) {\n\t\tprintf(\"%s: bogus drq %d\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"isa_dmastart: drq %d, addr %p, nbytes 0x%lx, p %p, \"\n\t    \"flags 0x%x, dmaflags 0x%x\\n\",\n\t    chan, addr, nbytes, p, flags, busdmaflags);\n#endif\n\n\tif (chan & 4) {\n\t\tif (nbytes > (1 << 17) || nbytes & 1 || (u_long)addr & 1) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx, addr %p\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes, addr);\n\t\t\tgoto lose;\n\t\t}\n\t} else {\n\t\tif (nbytes > (1 << 16)) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes);\n\t\t\tgoto lose;\n\t\t}\n\t}\n\n\tdmam = sc->sc_dmamaps[chan];\n\tif (dmam == NULL) {\n#ifdef __ISADMA_COMPAT\n\t\tif (compat)\n\t\t\tdmam = sc->sc_dmamaps[chan] = isadma_dmam[chan];\n\t\telse\n#endif /* __ISADMA_COMPAT */\n\t\tpanic(\"isa_dmastart: no DMA map for chan %d\", chan);\n\t}\n\n\terror = bus_dmamap_load(sc->sc_dmat, dmam, addr, nbytes, p,\n\t    busdmaflags);\n\tif (error)\n\t\treturn (error);\n\n#ifdef ISADMA_DEBUG\n\t__asm(\".globl isa_dmastart_afterload ; isa_dmastart_afterload:\");\n#endif\n\n\tif (flags & DMAMODE_READ) {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREREAD);\n\t\tsc->sc_dmareads |= (1 << chan);\n\t} else {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREWRITE);\n\t\tsc->sc_dmareads &= ~(1 << chan);\n\t}\n\n\tdmaaddr = dmam->dm_segs[0].ds_addr;\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"     dmaaddr 0x%lx\\n\", dmaaddr);\n\n\t__asm(\".globl isa_dmastart_aftersync ; isa_dmastart_aftersync:\");\n#endif\n\n\tsc->sc_dmalength[chan] = nbytes;\n\n\tisa_dmamask(sc, chan);\n\tsc->sc_dmafinished &= ~(1 << chan);\n\n\tif ((chan & 4) == 0) {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, DMA1_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA1_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[0][ochan], (dmaaddr >> 16) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (nbytes >> 8) & 0xff);\n\t} else {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, DMA2_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA2_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[1][ochan], (dmaaddr >> 16) & 0xff);\n\t\tdmaaddr >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tnbytes >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (nbytes >> 8) & 0xff);\n\t}\n\n\tisa_dmaunmask(sc, chan);\n\treturn (0);\n\n lose:\n\tpanic(\"isa_dmastart\");\n}",
          "includes": [
            "#include <sys/malloc.h>",
            "#include <dev/isa/isadmareg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/isa/isareg.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int dmapageport[2][4] = {\n\t{0x7, 0x3, 0x1, 0x2},\n\t{0xf, 0xb, 0x9, 0xa}\n};",
            "static u_int8_t dmamode[4] = {\n\tDMA37MD_READ | DMA37MD_SINGLE,\n\tDMA37MD_WRITE | DMA37MD_SINGLE,\n\tDMA37MD_READ | DMA37MD_SINGLE | DMA37MD_LOOP,\n\tDMA37MD_WRITE | DMA37MD_SINGLE | DMA37MD_LOOP\n};",
            "static inline void isa_dmaunmask",
            "static inline void isa_dmamask",
            "void *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;",
            "int chan;",
            "int flags;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/malloc.h>\n#include <dev/isa/isadmareg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/isa/isareg.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic int dmapageport[2][4] = {\n\t{0x7, 0x3, 0x1, 0x2},\n\t{0xf, 0xb, 0x9, 0xa}\n};\nstatic u_int8_t dmamode[4] = {\n\tDMA37MD_READ | DMA37MD_SINGLE,\n\tDMA37MD_WRITE | DMA37MD_SINGLE,\n\tDMA37MD_READ | DMA37MD_SINGLE | DMA37MD_LOOP,\n\tDMA37MD_WRITE | DMA37MD_SINGLE | DMA37MD_LOOP\n};\nstatic inline void isa_dmaunmask;\nstatic inline void isa_dmamask;\nvoid *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;\nint chan;\nint flags;\n\nint\nisa_dmastart(isadev, chan, addr, nbytes, p, flags, busdmaflags)\n\tstruct device *isadev;\n\tint chan;\n\tvoid *addr;\n\tbus_size_t nbytes;\n\tstruct proc *p;\n\tint flags;\n\tint busdmaflags;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\tbus_dmamap_t dmam;\n\tbus_addr_t dmaaddr;\n\tint waport;\n\tint ochan = chan & 3;\n\tint error;\n#ifdef __ISADMA_COMPAT\n\tint compat = busdmaflags & BUS_DMA_BUS1;\n\n\tbusdmaflags &= ~BUS_DMA_BUS1;\n#endif /* __ISADMA_COMPAT */\n\n\tif (chan < 0 || chan > 7) {\n\t\tprintf(\"%s: bogus drq %d\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"isa_dmastart: drq %d, addr %p, nbytes 0x%lx, p %p, \"\n\t    \"flags 0x%x, dmaflags 0x%x\\n\",\n\t    chan, addr, nbytes, p, flags, busdmaflags);\n#endif\n\n\tif (chan & 4) {\n\t\tif (nbytes > (1 << 17) || nbytes & 1 || (u_long)addr & 1) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx, addr %p\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes, addr);\n\t\t\tgoto lose;\n\t\t}\n\t} else {\n\t\tif (nbytes > (1 << 16)) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes);\n\t\t\tgoto lose;\n\t\t}\n\t}\n\n\tdmam = sc->sc_dmamaps[chan];\n\tif (dmam == NULL) {\n#ifdef __ISADMA_COMPAT\n\t\tif (compat)\n\t\t\tdmam = sc->sc_dmamaps[chan] = isadma_dmam[chan];\n\t\telse\n#endif /* __ISADMA_COMPAT */\n\t\tpanic(\"isa_dmastart: no DMA map for chan %d\", chan);\n\t}\n\n\terror = bus_dmamap_load(sc->sc_dmat, dmam, addr, nbytes, p,\n\t    busdmaflags);\n\tif (error)\n\t\treturn (error);\n\n#ifdef ISADMA_DEBUG\n\t__asm(\".globl isa_dmastart_afterload ; isa_dmastart_afterload:\");\n#endif\n\n\tif (flags & DMAMODE_READ) {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREREAD);\n\t\tsc->sc_dmareads |= (1 << chan);\n\t} else {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREWRITE);\n\t\tsc->sc_dmareads &= ~(1 << chan);\n\t}\n\n\tdmaaddr = dmam->dm_segs[0].ds_addr;\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"     dmaaddr 0x%lx\\n\", dmaaddr);\n\n\t__asm(\".globl isa_dmastart_aftersync ; isa_dmastart_aftersync:\");\n#endif\n\n\tsc->sc_dmalength[chan] = nbytes;\n\n\tisa_dmamask(sc, chan);\n\tsc->sc_dmafinished &= ~(1 << chan);\n\n\tif ((chan & 4) == 0) {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, DMA1_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA1_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[0][ochan], (dmaaddr >> 16) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (nbytes >> 8) & 0xff);\n\t} else {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, DMA2_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA2_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[1][ochan], (dmaaddr >> 16) & 0xff);\n\t\tdmaaddr >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tnbytes >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (nbytes >> 8) & 0xff);\n\t}\n\n\tisa_dmaunmask(sc, chan);\n\treturn (0);\n\n lose:\n\tpanic(\"isa_dmastart\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp: dma start loop output start=%p end=%p chan=%d\\n\",\n\t    start, end, sc->sc_o.dmachan)"
          ],
          "line": 1374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_trigger_output: tc=%d set failed\\n\",\n\t\t\t\t sc->sc_o.rate)"
          ],
          "line": 1368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_set_timeconst",
          "args": [
            "sc",
            "sc->sc_o.tc"
          ],
          "line": 1367
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_timeconst",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1137-1149",
          "snippet": "int\nsbdsp_set_timeconst(sc, tc)\n\tstruct sbdsp_softc *sc;\n\tint tc;\n{\n\tDPRINTF((\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc));\n\n\tif (sbdsp_wdsp(sc, SB_DSP_TIMECONST) < 0 ||\n\t    sbdsp_wdsp(sc, tc) < 0)\n\t\treturn EIO;\n\t    \n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_set_timeconst"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_timeconst;\n\nint\nsbdsp_set_timeconst(sc, tc)\n\tstruct sbdsp_softc *sc;\n\tint tc;\n{\n\tDPRINTF((\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc));\n\n\tif (sbdsp_wdsp(sc, SB_DSP_TIMECONST) < 0 ||\n\t    sbdsp_wdsp(sc, tc) < 0)\n\t\treturn EIO;\n\t    \n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_trigger_output: rate=%d set failed\\n\",\n\t\t\t\t sc->sc_o.rate)"
          ],
          "line": 1362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp16_set_rate",
          "args": [
            "sc",
            "SB_DSP16_OUTPUTRATE",
            "sc->sc_o.rate"
          ],
          "line": 1361
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp16_set_rate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1151-1163",
          "snippet": "int\nsbdsp16_set_rate(sc, cmd, rate)\n\tstruct sbdsp_softc *sc;\n\tint cmd, rate;\n{\n\tDPRINTF((\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate));\n\n\tif (sbdsp_wdsp(sc, cmd) < 0 ||\n\t    sbdsp_wdsp(sc, rate >> 8) < 0 ||\n\t    sbdsp_wdsp(sc, rate) < 0)\n\t\treturn EIO;\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp16_set_rate"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp16_set_rate;\n\nint\nsbdsp16_set_rate(sc, cmd, rate)\n\tstruct sbdsp_softc *sc;\n\tint cmd, rate;\n{\n\tDPRINTF((\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate));\n\n\tif (sbdsp_wdsp(sc, cmd) < 0 ||\n\t    sbdsp_wdsp(sc, rate >> 8) < 0 ||\n\t    sbdsp_wdsp(sc, rate) < 0)\n\t\treturn EIO;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 1360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "cmd"
          ],
          "line": 1356
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SBP_STEREO",
            "(sbdsp_mix_read(sc, SBP_STEREO) & ~SBP_PLAYMODE_MASK) |\n\t\t    (stereo ?  SBP_PLAYMODE_STEREO : SBP_PLAYMODE_MONO)"
          ],
          "line": 1352
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SBP_STEREO"
          ],
          "line": 1353
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSBPRO",
          "args": [
            "sc"
          ],
          "line": 1350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"sbdsp_trigger_output: width=%d bad chan %d\\n\"",
            "width",
            "sc->sc_o.dmachan"
          ],
          "line": 1336
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"stereo playback odd bytes (%d)\\n\", blksize)"
          ],
          "line": 1315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_timeconst;\nint\tsbdsp16_set_rate;\nint\tsbdsp_block_output;\n__P((int, int));\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_trigger_output(addr, start, end, blksize, intr, arg, param)\n\tvoid *addr;\n\tvoid *start, *end;\n\tint blksize;\n\tvoid (*intr) __P((void *));\n\tvoid *arg;\n\tstruct audio_params *param;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint stereo = param->channels == 2;\n\tint width = param->precision * param->factor;\n\tint cmd;\n\n#ifdef DIAGNOSTIC\n\tif (stereo && (blksize & 1)) {\n\t\tDPRINTF((\"stereo playback odd bytes (%d)\\n\", blksize));\n\t\treturn (EIO);\n\t}\n#endif\n\n\tsc->sc_intrp = intr;\n\tsc->sc_argp = arg;\n\n\tif (width == 8) {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_o.dmachan != sc->sc_drq8) {\n\t\t\tprintf(\"sbdsp_trigger_output: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_o.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr8 = sbdsp_block_output;\n\t\tsc->sc_arg8 = addr;\n\t} else {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_o.dmachan != sc->sc_drq16) {\n\t\t\tprintf(\"sbdsp_trigger_output: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_o.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr16 = sbdsp_block_output;\n\t\tsc->sc_arg16 = addr;\n\t}\n\n\tif ((sc->sc_model == SB_JAZZ) ? (sc->sc_o.dmachan > 3) : (width == 16))\n\t\tblksize >>= 1;\n\t--blksize;\n\tsc->sc_o.blksize = blksize;\n\n\tif (ISSBPRO(sc)) {\n\t\t/* make sure we re-set stereo mixer bit when we start output. */\n\t\tsbdsp_mix_write(sc, SBP_STEREO,\n\t\t    (sbdsp_mix_read(sc, SBP_STEREO) & ~SBP_PLAYMODE_MASK) |\n\t\t    (stereo ?  SBP_PLAYMODE_STEREO : SBP_PLAYMODE_MONO));\n\t\tcmd = sc->sc_o.modep->cmdchan;\n\t\tif (cmd && sbdsp_wdsp(sc, cmd) < 0)\n\t\t\treturn (EIO);\n\t}\n\t\n\tif (ISSB16CLASS(sc)) {\n\t\tif (sbdsp16_set_rate(sc, SB_DSP16_OUTPUTRATE, sc->sc_o.rate)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_output: rate=%d set failed\\n\",\n\t\t\t\t sc->sc_o.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t} else {\n\t\tif (sbdsp_set_timeconst(sc, sc->sc_o.tc)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_output: tc=%d set failed\\n\",\n\t\t\t\t sc->sc_o.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t}\n\n\tDPRINTF((\"sbdsp: dma start loop output start=%p end=%p chan=%d\\n\",\n\t    start, end, sc->sc_o.dmachan));\n\tisa_dmastart(sc->sc_isa, sc->sc_o.dmachan, start, end - start,\n\t    NULL, DMAMODE_WRITE | DMAMODE_LOOP, BUS_DMA_NOWAIT);\n\n\treturn sbdsp_block_output(addr);\n}"
  },
  {
    "function_name": "sbdsp_block_input",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1247-1297",
    "snippet": "int\nsbdsp_block_input(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_i.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_input: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_i.run != SB_NOTRUNNING)\n\t\tsc->sc_intrr(sc->sc_argr);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, start DMA */\n\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_input: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_i.run = SB_RUNNING;\n\t} else if (sc->sc_i.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTFN(3, (\"sbdsp16 input command cmd=0x%02x bmode=0x%02x cc=%d\\n\",\n\t\t\t    sc->sc_i.modep->cmd, sc->sc_i.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_i.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_input: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_i.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_block_input",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_input: SB2 DMA start failed\\n\")"
          ],
          "line": 1289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "sc->sc_i.modep->cmd"
          ],
          "line": 1288
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_input: SB2 DMA blocksize failed\\n\")"
          ],
          "line": 1285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_input: set blocksize=%d\\n\", cc)"
          ],
          "line": 1281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_input: SB16 DMA start failed\\n\")"
          ],
          "line": 1277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "3",
            "(\"sbdsp16 input command cmd=0x%02x bmode=0x%02x cc=%d\\n\",\n\t\t\t    sc->sc_i.modep->cmd, sc->sc_i.bmode, cc)"
          ],
          "line": 1271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 1270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_block_input: SB1 DMA start failed\\n\")"
          ],
          "line": 1264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sc->sc_intrr",
          "args": [
            "sc->sc_argr"
          ],
          "line": 1257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "2",
            "(\"sbdsp_block_input: sc=%p cc=%d\\n\", addr, cc)"
          ],
          "line": 1254
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_block_input;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_block_input(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_i.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_input: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_i.run != SB_NOTRUNNING)\n\t\tsc->sc_intrr(sc->sc_argr);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, start DMA */\n\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_input: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_i.run = SB_RUNNING;\n\t} else if (sc->sc_i.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTFN(3, (\"sbdsp16 input command cmd=0x%02x bmode=0x%02x cc=%d\\n\",\n\t\t\t    sc->sc_i.modep->cmd, sc->sc_i.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_i.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_input: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_i.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}"
  },
  {
    "function_name": "sbdsp_trigger_input",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1165-1245",
    "snippet": "int\nsbdsp_trigger_input(addr, start, end, blksize, intr, arg, param)\n\tvoid *addr;\n\tvoid *start, *end;\n\tint blksize;\n\tvoid (*intr) __P((void *));\n\tvoid *arg;\n\tstruct audio_params *param;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint stereo = param->channels == 2;\n\tint width = param->precision * param->factor;\n\tint filter;\n\n#ifdef DIAGNOSTIC\n\tif (stereo && (blksize & 1)) {\n\t\tDPRINTF((\"stereo record odd bytes (%d)\\n\", blksize));\n\t\treturn (EIO);\n\t}\n#endif\n\n\tsc->sc_intrr = intr;\n\tsc->sc_argr = arg;\n\n\tif (width == 8) {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_i.dmachan != sc->sc_drq8) {\n\t\t\tprintf(\"sbdsp_trigger_input: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_i.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr8 = sbdsp_block_input;\n\t\tsc->sc_arg8 = addr;\n\t} else {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_i.dmachan != sc->sc_drq16) {\n\t\t\tprintf(\"sbdsp_trigger_input: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_i.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr16 = sbdsp_block_input;\n\t\tsc->sc_arg16 = addr;\n\t}\n\n\tif ((sc->sc_model == SB_JAZZ) ? (sc->sc_i.dmachan > 3) : (width == 16))\n\t\tblksize >>= 1;\n\t--blksize;\n\tsc->sc_i.blksize = blksize;\n\n\tif (ISSBPRO(sc)) {\n\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmdchan) < 0)\n\t\t\treturn (EIO);\n\t\tfilter = stereo ? SBP_FILTER_OFF : sc->in_filter;\n\t\tsbdsp_mix_write(sc, SBP_INFILTER,\n\t\t    (sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK) |\n\t\t    filter);\n\t}\n\t\n\tif (ISSB16CLASS(sc)) {\n\t\tif (sbdsp16_set_rate(sc, SB_DSP16_INPUTRATE, sc->sc_i.rate)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_input: rate=%d set failed\\n\",\n\t\t\t\t sc->sc_i.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t} else {\n\t\tif (sbdsp_set_timeconst(sc, sc->sc_i.tc)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_input: tc=%d set failed\\n\",\n\t\t\t\t sc->sc_i.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t}\n\n\tDPRINTF((\"sbdsp: dma start loop input start=%p end=%p chan=%d\\n\", \n\t    start, end, sc->sc_i.dmachan));\n\tisa_dmastart(sc->sc_isa, sc->sc_i.dmachan, start, end - start,\n\t    NULL, DMAMODE_READ | DMAMODE_LOOP, BUS_DMA_NOWAIT);\n\n\treturn sbdsp_block_input(addr);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_set_timeconst",
      "int\tsbdsp16_set_rate",
      "int\tsbdsp_block_input",
      "__P((int, int));",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_block_input",
          "args": [
            "addr"
          ],
          "line": 1244
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_block_input",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1247-1297",
          "snippet": "int\nsbdsp_block_input(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_i.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_input: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_i.run != SB_NOTRUNNING)\n\t\tsc->sc_intrr(sc->sc_argr);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, start DMA */\n\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_input: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_i.run = SB_RUNNING;\n\t} else if (sc->sc_i.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTFN(3, (\"sbdsp16 input command cmd=0x%02x bmode=0x%02x cc=%d\\n\",\n\t\t\t    sc->sc_i.modep->cmd, sc->sc_i.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_i.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_input: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_i.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_block_input",
            "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_block_input;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_block_input(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint cc = sc->sc_i.blksize;\n\t\n\tDPRINTFN(2, (\"sbdsp_block_input: sc=%p cc=%d\\n\", addr, cc));\n\n\tif (sc->sc_i.run != SB_NOTRUNNING)\n\t\tsc->sc_intrr(sc->sc_argr);\n\n\tif (sc->sc_model == SB_1) {\n\t\t/* Non-looping mode, start DMA */\n\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\tDPRINTF((\"sbdsp_block_input: SB1 DMA start failed\\n\"));\n\t\t\treturn (EIO);\n\t\t}\n\t\tsc->sc_i.run = SB_RUNNING;\n\t} else if (sc->sc_i.run == SB_NOTRUNNING) {\n\t\t/* Initialize looping PCM */\n\t\tif (ISSB16CLASS(sc)) {\n\t\t\tDPRINTFN(3, (\"sbdsp16 input command cmd=0x%02x bmode=0x%02x cc=%d\\n\",\n\t\t\t    sc->sc_i.modep->cmd, sc->sc_i.bmode, cc));\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0 || \n\t\t\t    sbdsp_wdsp(sc, sc->sc_i.bmode) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB16 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t} else {\n\t\t\tDPRINTF((\"sbdsp_block_input: set blocksize=%d\\n\", cc));\n\t\t\tif (sbdsp_wdsp(sc, SB_DSP_BLOCKSIZE) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc) < 0 ||\n\t\t\t    sbdsp_wdsp(sc, cc >> 8) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA blocksize failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmd) < 0) {\n\t\t\t\tDPRINTF((\"sbdsp_block_input: SB2 DMA start failed\\n\"));\n\t\t\t\treturn (EIO);\n\t\t\t}\n\t\t}\n\t\tsc->sc_i.run = SB_LOOPING;\n\t}\n\n\treturn (0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "isa_dmastart",
          "args": [
            "sc->sc_isa",
            "sc->sc_i.dmachan",
            "start",
            "end - start",
            "NULL",
            "DMAMODE_READ | DMAMODE_LOOP",
            "BUS_DMA_NOWAIT"
          ],
          "line": 1241
        },
        "resolved": true,
        "details": {
          "function_name": "isa_dmastart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/isadma.c",
          "lines": "288-422",
          "snippet": "int\nisa_dmastart(isadev, chan, addr, nbytes, p, flags, busdmaflags)\n\tstruct device *isadev;\n\tint chan;\n\tvoid *addr;\n\tbus_size_t nbytes;\n\tstruct proc *p;\n\tint flags;\n\tint busdmaflags;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\tbus_dmamap_t dmam;\n\tbus_addr_t dmaaddr;\n\tint waport;\n\tint ochan = chan & 3;\n\tint error;\n#ifdef __ISADMA_COMPAT\n\tint compat = busdmaflags & BUS_DMA_BUS1;\n\n\tbusdmaflags &= ~BUS_DMA_BUS1;\n#endif /* __ISADMA_COMPAT */\n\n\tif (chan < 0 || chan > 7) {\n\t\tprintf(\"%s: bogus drq %d\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"isa_dmastart: drq %d, addr %p, nbytes 0x%lx, p %p, \"\n\t    \"flags 0x%x, dmaflags 0x%x\\n\",\n\t    chan, addr, nbytes, p, flags, busdmaflags);\n#endif\n\n\tif (chan & 4) {\n\t\tif (nbytes > (1 << 17) || nbytes & 1 || (u_long)addr & 1) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx, addr %p\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes, addr);\n\t\t\tgoto lose;\n\t\t}\n\t} else {\n\t\tif (nbytes > (1 << 16)) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes);\n\t\t\tgoto lose;\n\t\t}\n\t}\n\n\tdmam = sc->sc_dmamaps[chan];\n\tif (dmam == NULL) {\n#ifdef __ISADMA_COMPAT\n\t\tif (compat)\n\t\t\tdmam = sc->sc_dmamaps[chan] = isadma_dmam[chan];\n\t\telse\n#endif /* __ISADMA_COMPAT */\n\t\tpanic(\"isa_dmastart: no DMA map for chan %d\", chan);\n\t}\n\n\terror = bus_dmamap_load(sc->sc_dmat, dmam, addr, nbytes, p,\n\t    busdmaflags);\n\tif (error)\n\t\treturn (error);\n\n#ifdef ISADMA_DEBUG\n\t__asm(\".globl isa_dmastart_afterload ; isa_dmastart_afterload:\");\n#endif\n\n\tif (flags & DMAMODE_READ) {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREREAD);\n\t\tsc->sc_dmareads |= (1 << chan);\n\t} else {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREWRITE);\n\t\tsc->sc_dmareads &= ~(1 << chan);\n\t}\n\n\tdmaaddr = dmam->dm_segs[0].ds_addr;\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"     dmaaddr 0x%lx\\n\", dmaaddr);\n\n\t__asm(\".globl isa_dmastart_aftersync ; isa_dmastart_aftersync:\");\n#endif\n\n\tsc->sc_dmalength[chan] = nbytes;\n\n\tisa_dmamask(sc, chan);\n\tsc->sc_dmafinished &= ~(1 << chan);\n\n\tif ((chan & 4) == 0) {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, DMA1_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA1_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[0][ochan], (dmaaddr >> 16) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (nbytes >> 8) & 0xff);\n\t} else {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, DMA2_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA2_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[1][ochan], (dmaaddr >> 16) & 0xff);\n\t\tdmaaddr >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tnbytes >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (nbytes >> 8) & 0xff);\n\t}\n\n\tisa_dmaunmask(sc, chan);\n\treturn (0);\n\n lose:\n\tpanic(\"isa_dmastart\");\n}",
          "includes": [
            "#include <sys/malloc.h>",
            "#include <dev/isa/isadmareg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/isa/isareg.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int dmapageport[2][4] = {\n\t{0x7, 0x3, 0x1, 0x2},\n\t{0xf, 0xb, 0x9, 0xa}\n};",
            "static u_int8_t dmamode[4] = {\n\tDMA37MD_READ | DMA37MD_SINGLE,\n\tDMA37MD_WRITE | DMA37MD_SINGLE,\n\tDMA37MD_READ | DMA37MD_SINGLE | DMA37MD_LOOP,\n\tDMA37MD_WRITE | DMA37MD_SINGLE | DMA37MD_LOOP\n};",
            "static inline void isa_dmaunmask",
            "static inline void isa_dmamask",
            "void *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;",
            "int chan;",
            "int flags;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/malloc.h>\n#include <dev/isa/isadmareg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/isa/isareg.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic int dmapageport[2][4] = {\n\t{0x7, 0x3, 0x1, 0x2},\n\t{0xf, 0xb, 0x9, 0xa}\n};\nstatic u_int8_t dmamode[4] = {\n\tDMA37MD_READ | DMA37MD_SINGLE,\n\tDMA37MD_WRITE | DMA37MD_SINGLE,\n\tDMA37MD_READ | DMA37MD_SINGLE | DMA37MD_LOOP,\n\tDMA37MD_WRITE | DMA37MD_SINGLE | DMA37MD_LOOP\n};\nstatic inline void isa_dmaunmask;\nstatic inline void isa_dmamask;\nvoid *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;\nint chan;\nint flags;\n\nint\nisa_dmastart(isadev, chan, addr, nbytes, p, flags, busdmaflags)\n\tstruct device *isadev;\n\tint chan;\n\tvoid *addr;\n\tbus_size_t nbytes;\n\tstruct proc *p;\n\tint flags;\n\tint busdmaflags;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\tbus_dmamap_t dmam;\n\tbus_addr_t dmaaddr;\n\tint waport;\n\tint ochan = chan & 3;\n\tint error;\n#ifdef __ISADMA_COMPAT\n\tint compat = busdmaflags & BUS_DMA_BUS1;\n\n\tbusdmaflags &= ~BUS_DMA_BUS1;\n#endif /* __ISADMA_COMPAT */\n\n\tif (chan < 0 || chan > 7) {\n\t\tprintf(\"%s: bogus drq %d\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"isa_dmastart: drq %d, addr %p, nbytes 0x%lx, p %p, \"\n\t    \"flags 0x%x, dmaflags 0x%x\\n\",\n\t    chan, addr, nbytes, p, flags, busdmaflags);\n#endif\n\n\tif (chan & 4) {\n\t\tif (nbytes > (1 << 17) || nbytes & 1 || (u_long)addr & 1) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx, addr %p\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes, addr);\n\t\t\tgoto lose;\n\t\t}\n\t} else {\n\t\tif (nbytes > (1 << 16)) {\n\t\t\tprintf(\"%s: drq %d, nbytes 0x%lx\\n\",\n\t\t\t    sc->sc_dev.dv_xname, chan, nbytes);\n\t\t\tgoto lose;\n\t\t}\n\t}\n\n\tdmam = sc->sc_dmamaps[chan];\n\tif (dmam == NULL) {\n#ifdef __ISADMA_COMPAT\n\t\tif (compat)\n\t\t\tdmam = sc->sc_dmamaps[chan] = isadma_dmam[chan];\n\t\telse\n#endif /* __ISADMA_COMPAT */\n\t\tpanic(\"isa_dmastart: no DMA map for chan %d\", chan);\n\t}\n\n\terror = bus_dmamap_load(sc->sc_dmat, dmam, addr, nbytes, p,\n\t    busdmaflags);\n\tif (error)\n\t\treturn (error);\n\n#ifdef ISADMA_DEBUG\n\t__asm(\".globl isa_dmastart_afterload ; isa_dmastart_afterload:\");\n#endif\n\n\tif (flags & DMAMODE_READ) {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREREAD);\n\t\tsc->sc_dmareads |= (1 << chan);\n\t} else {\n\t\tbus_dmamap_sync(sc->sc_dmat, dmam, BUS_DMASYNC_PREWRITE);\n\t\tsc->sc_dmareads &= ~(1 << chan);\n\t}\n\n\tdmaaddr = dmam->dm_segs[0].ds_addr;\n\n#ifdef ISADMA_DEBUG\n\tprintf(\"     dmaaddr 0x%lx\\n\", dmaaddr);\n\n\t__asm(\".globl isa_dmastart_aftersync ; isa_dmastart_aftersync:\");\n#endif\n\n\tsc->sc_dmalength[chan] = nbytes;\n\n\tisa_dmamask(sc, chan);\n\tsc->sc_dmafinished &= ~(1 << chan);\n\n\tif ((chan & 4) == 0) {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, DMA1_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA1_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[0][ochan], (dmaaddr >> 16) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma1h, waport + 1,\n\t\t    (nbytes >> 8) & 0xff);\n\t} else {\n\t\t/* set dma channel mode */\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, DMA2_MODE,\n\t\t    ochan | dmamode[flags]);\n\n\t\t/* send start address */\n\t\twaport = DMA2_CHN(ochan);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dmapgh,\n\t\t    dmapageport[1][ochan], (dmaaddr >> 16) & 0xff);\n\t\tdmaaddr >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    dmaaddr & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport,\n\t\t    (dmaaddr >> 8) & 0xff);\n\n\t\t/* send count */\n\t\tnbytes >>= 1;\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (--nbytes) & 0xff);\n\t\tbus_space_write_1(sc->sc_iot, sc->sc_dma2h, waport + 2,\n\t\t    (nbytes >> 8) & 0xff);\n\t}\n\n\tisa_dmaunmask(sc, chan);\n\treturn (0);\n\n lose:\n\tpanic(\"isa_dmastart\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp: dma start loop input start=%p end=%p chan=%d\\n\", \n\t    start, end, sc->sc_i.dmachan)"
          ],
          "line": 1239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_trigger_input: tc=%d set failed\\n\",\n\t\t\t\t sc->sc_i.rate)"
          ],
          "line": 1233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_set_timeconst",
          "args": [
            "sc",
            "sc->sc_i.tc"
          ],
          "line": 1232
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_timeconst",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1137-1149",
          "snippet": "int\nsbdsp_set_timeconst(sc, tc)\n\tstruct sbdsp_softc *sc;\n\tint tc;\n{\n\tDPRINTF((\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc));\n\n\tif (sbdsp_wdsp(sc, SB_DSP_TIMECONST) < 0 ||\n\t    sbdsp_wdsp(sc, tc) < 0)\n\t\treturn EIO;\n\t    \n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_set_timeconst"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_timeconst;\n\nint\nsbdsp_set_timeconst(sc, tc)\n\tstruct sbdsp_softc *sc;\n\tint tc;\n{\n\tDPRINTF((\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc));\n\n\tif (sbdsp_wdsp(sc, SB_DSP_TIMECONST) < 0 ||\n\t    sbdsp_wdsp(sc, tc) < 0)\n\t\treturn EIO;\n\t    \n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_trigger_input: rate=%d set failed\\n\",\n\t\t\t\t sc->sc_i.rate)"
          ],
          "line": 1227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp16_set_rate",
          "args": [
            "sc",
            "SB_DSP16_INPUTRATE",
            "sc->sc_i.rate"
          ],
          "line": 1226
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp16_set_rate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1151-1163",
          "snippet": "int\nsbdsp16_set_rate(sc, cmd, rate)\n\tstruct sbdsp_softc *sc;\n\tint cmd, rate;\n{\n\tDPRINTF((\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate));\n\n\tif (sbdsp_wdsp(sc, cmd) < 0 ||\n\t    sbdsp_wdsp(sc, rate >> 8) < 0 ||\n\t    sbdsp_wdsp(sc, rate) < 0)\n\t\treturn EIO;\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp16_set_rate"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp16_set_rate;\n\nint\nsbdsp16_set_rate(sc, cmd, rate)\n\tstruct sbdsp_softc *sc;\n\tint cmd, rate;\n{\n\tDPRINTF((\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate));\n\n\tif (sbdsp_wdsp(sc, cmd) < 0 ||\n\t    sbdsp_wdsp(sc, rate >> 8) < 0 ||\n\t    sbdsp_wdsp(sc, rate) < 0)\n\t\treturn EIO;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 1225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SBP_INFILTER",
            "(sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK) |\n\t\t    filter"
          ],
          "line": 1220
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SBP_INFILTER"
          ],
          "line": 1221
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "sc->sc_i.modep->cmdchan"
          ],
          "line": 1217
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSBPRO",
          "args": [
            "sc"
          ],
          "line": 1216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"sbdsp_trigger_input: width=%d bad chan %d\\n\"",
            "width",
            "sc->sc_i.dmachan"
          ],
          "line": 1202
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"stereo record odd bytes (%d)\\n\", blksize)"
          ],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_timeconst;\nint\tsbdsp16_set_rate;\nint\tsbdsp_block_input;\n__P((int, int));\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_trigger_input(addr, start, end, blksize, intr, arg, param)\n\tvoid *addr;\n\tvoid *start, *end;\n\tint blksize;\n\tvoid (*intr) __P((void *));\n\tvoid *arg;\n\tstruct audio_params *param;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint stereo = param->channels == 2;\n\tint width = param->precision * param->factor;\n\tint filter;\n\n#ifdef DIAGNOSTIC\n\tif (stereo && (blksize & 1)) {\n\t\tDPRINTF((\"stereo record odd bytes (%d)\\n\", blksize));\n\t\treturn (EIO);\n\t}\n#endif\n\n\tsc->sc_intrr = intr;\n\tsc->sc_argr = arg;\n\n\tif (width == 8) {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_i.dmachan != sc->sc_drq8) {\n\t\t\tprintf(\"sbdsp_trigger_input: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_i.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr8 = sbdsp_block_input;\n\t\tsc->sc_arg8 = addr;\n\t} else {\n#ifdef DIAGNOSTIC\n\t\tif (sc->sc_i.dmachan != sc->sc_drq16) {\n\t\t\tprintf(\"sbdsp_trigger_input: width=%d bad chan %d\\n\",\n\t\t\t    width, sc->sc_i.dmachan);\n\t\t\treturn (EIO);\n\t\t}\n#endif\n\t\tsc->sc_intr16 = sbdsp_block_input;\n\t\tsc->sc_arg16 = addr;\n\t}\n\n\tif ((sc->sc_model == SB_JAZZ) ? (sc->sc_i.dmachan > 3) : (width == 16))\n\t\tblksize >>= 1;\n\t--blksize;\n\tsc->sc_i.blksize = blksize;\n\n\tif (ISSBPRO(sc)) {\n\t\tif (sbdsp_wdsp(sc, sc->sc_i.modep->cmdchan) < 0)\n\t\t\treturn (EIO);\n\t\tfilter = stereo ? SBP_FILTER_OFF : sc->in_filter;\n\t\tsbdsp_mix_write(sc, SBP_INFILTER,\n\t\t    (sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK) |\n\t\t    filter);\n\t}\n\t\n\tif (ISSB16CLASS(sc)) {\n\t\tif (sbdsp16_set_rate(sc, SB_DSP16_INPUTRATE, sc->sc_i.rate)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_input: rate=%d set failed\\n\",\n\t\t\t\t sc->sc_i.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t} else {\n\t\tif (sbdsp_set_timeconst(sc, sc->sc_i.tc)) {\n\t\t\tDPRINTF((\"sbdsp_trigger_input: tc=%d set failed\\n\",\n\t\t\t\t sc->sc_i.rate));\n\t\t\treturn (EIO);\n\t\t}\n\t}\n\n\tDPRINTF((\"sbdsp: dma start loop input start=%p end=%p chan=%d\\n\", \n\t    start, end, sc->sc_i.dmachan));\n\tisa_dmastart(sc->sc_isa, sc->sc_i.dmachan, start, end - start,\n\t    NULL, DMAMODE_READ | DMAMODE_LOOP, BUS_DMA_NOWAIT);\n\n\treturn sbdsp_block_input(addr);\n}"
  },
  {
    "function_name": "sbdsp16_set_rate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1151-1163",
    "snippet": "int\nsbdsp16_set_rate(sc, cmd, rate)\n\tstruct sbdsp_softc *sc;\n\tint cmd, rate;\n{\n\tDPRINTF((\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate));\n\n\tif (sbdsp_wdsp(sc, cmd) < 0 ||\n\t    sbdsp_wdsp(sc, rate >> 8) < 0 ||\n\t    sbdsp_wdsp(sc, rate) < 0)\n\t\treturn EIO;\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp16_set_rate"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "rate"
          ],
          "line": 1160
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate)"
          ],
          "line": 1156
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp16_set_rate;\n\nint\nsbdsp16_set_rate(sc, cmd, rate)\n\tstruct sbdsp_softc *sc;\n\tint cmd, rate;\n{\n\tDPRINTF((\"sbdsp16_set_rate: sc=%p cmd=0x%02x rate=%d\\n\", sc, cmd, rate));\n\n\tif (sbdsp_wdsp(sc, cmd) < 0 ||\n\t    sbdsp_wdsp(sc, rate >> 8) < 0 ||\n\t    sbdsp_wdsp(sc, rate) < 0)\n\t\treturn EIO;\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_set_timeconst",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1137-1149",
    "snippet": "int\nsbdsp_set_timeconst(sc, tc)\n\tstruct sbdsp_softc *sc;\n\tint tc;\n{\n\tDPRINTF((\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc));\n\n\tif (sbdsp_wdsp(sc, SB_DSP_TIMECONST) < 0 ||\n\t    sbdsp_wdsp(sc, tc) < 0)\n\t\treturn EIO;\n\t    \n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_set_timeconst"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "tc"
          ],
          "line": 1145
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc)"
          ],
          "line": 1142
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_timeconst;\n\nint\nsbdsp_set_timeconst(sc, tc)\n\tstruct sbdsp_softc *sc;\n\tint tc;\n{\n\tDPRINTF((\"sbdsp_set_timeconst: sc=%p tc=%d\\n\", sc, tc));\n\n\tif (sbdsp_wdsp(sc, SB_DSP_TIMECONST) < 0 ||\n\t    sbdsp_wdsp(sc, tc) < 0)\n\t\treturn EIO;\n\t    \n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_haltdma",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1125-1135",
    "snippet": "int\nsbdsp_haltdma(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tDPRINTF((\"sbdsp_haltdma: sc=%p\\n\", sc));\n\n\tsbdsp_reset(sc);\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_reset",
          "args": [
            "sc"
          ],
          "line": 1133
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "918-949",
          "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_haltdma: sc=%p\\n\", sc)"
          ],
          "line": 1131
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_haltdma(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tDPRINTF((\"sbdsp_haltdma: sc=%p\\n\", sc));\n\n\tsbdsp_reset(sc);\n\treturn 0;\n}"
  },
  {
    "function_name": "sbversion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1058-1120",
    "snippet": "void\nsbversion(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint v;\n\n\tsc->sc_model = SB_UNK;\n\tsc->sc_version = 0;\n\tif (sbdsp_wdsp(sc, SB_DSP_VERSION) < 0)\n\t\treturn;\n\tv = sbdsp_rdsp(sc) << 8;\n\tv |= sbdsp_rdsp(sc);\n\tif (v < 0)\n\t\treturn;\n\tsc->sc_version = v;\n\tswitch(SBVER_MAJOR(v)) {\n\tcase 1:\n\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tsc->sc_model = SB_1;\n\t\tbreak;\n\tcase 2:\n\t\t/* Some SB2 have a mixer, some don't. */\n\t\tsbdsp_mix_write(sc, SBP_1335_MASTER_VOL, 0x04);\n\t\tsbdsp_mix_write(sc, SBP_1335_MIDI_VOL,   0x06);\n\t\t/* Check if we can read back the mixer values. */\n\t\tif ((sbdsp_mix_read(sc, SBP_1335_MASTER_VOL) & 0x0e) == 0x04 &&\n\t\t    (sbdsp_mix_read(sc, SBP_1335_MIDI_VOL)   & 0x0e) == 0x06)\n\t\t\tsc->sc_mixer_model = SBM_CT1335;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tif (SBVER_MINOR(v) == 0)\n\t\t\tsc->sc_model = SB_20;\n\t\telse\n\t\t\tsc->sc_model = SB_2x;\n\t\tbreak;\n\tcase 3:\n\t\tsc->sc_mixer_model = SBM_CT1345;\n\t\tsc->sc_model = SB_PRO;\n\t\tbreak;\n\tcase 4:\n#if 0\n/* XXX This does not work */\n\t\t/* Most SB16 have a tone controls, but some don't. */\n\t\tsbdsp_mix_write(sc, SB16P_TREBLE_L, 0x80);\n\t\t/* Check if we can read back the mixer value. */\n\t\tif ((sbdsp_mix_read(sc, SB16P_TREBLE_L) & 0xf0) == 0x80)\n\t\t\tsc->sc_mixer_model = SBM_CT1745;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_CT1XX5;\n#else\n\t\tsc->sc_mixer_model = SBM_CT1745;\n#endif\n#if 0\n/* XXX figure out a good way of determining the model */\n\t\t/* XXX what about SB_32 */\n\t\tif (SBVER_MINOR(v) == 16)\n\t\t\tsc->sc_model = SB_64;\n\t\telse\n#endif\n\t\t\tsc->sc_model = SB_16;\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbversion"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "SBVER_MINOR",
          "args": [
            "v"
          ],
          "line": 1113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SB16P_TREBLE_L"
          ],
          "line": 1103
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SB16P_TREBLE_L",
            "0x80"
          ],
          "line": 1101
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "SBVER_MINOR",
          "args": [
            "v"
          ],
          "line": 1088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SBVER_MAJOR",
          "args": [
            "v"
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_rdsp",
          "args": [
            "sc"
          ],
          "line": 1069
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_rdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "982-1002",
          "snippet": "int\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "SB_DSP_VERSION"
          ],
          "line": 1066
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbversion;\n\nvoid\nsbversion(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint v;\n\n\tsc->sc_model = SB_UNK;\n\tsc->sc_version = 0;\n\tif (sbdsp_wdsp(sc, SB_DSP_VERSION) < 0)\n\t\treturn;\n\tv = sbdsp_rdsp(sc) << 8;\n\tv |= sbdsp_rdsp(sc);\n\tif (v < 0)\n\t\treturn;\n\tsc->sc_version = v;\n\tswitch(SBVER_MAJOR(v)) {\n\tcase 1:\n\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tsc->sc_model = SB_1;\n\t\tbreak;\n\tcase 2:\n\t\t/* Some SB2 have a mixer, some don't. */\n\t\tsbdsp_mix_write(sc, SBP_1335_MASTER_VOL, 0x04);\n\t\tsbdsp_mix_write(sc, SBP_1335_MIDI_VOL,   0x06);\n\t\t/* Check if we can read back the mixer values. */\n\t\tif ((sbdsp_mix_read(sc, SBP_1335_MASTER_VOL) & 0x0e) == 0x04 &&\n\t\t    (sbdsp_mix_read(sc, SBP_1335_MIDI_VOL)   & 0x0e) == 0x06)\n\t\t\tsc->sc_mixer_model = SBM_CT1335;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tif (SBVER_MINOR(v) == 0)\n\t\t\tsc->sc_model = SB_20;\n\t\telse\n\t\t\tsc->sc_model = SB_2x;\n\t\tbreak;\n\tcase 3:\n\t\tsc->sc_mixer_model = SBM_CT1345;\n\t\tsc->sc_model = SB_PRO;\n\t\tbreak;\n\tcase 4:\n#if 0\n/* XXX This does not work */\n\t\t/* Most SB16 have a tone controls, but some don't. */\n\t\tsbdsp_mix_write(sc, SB16P_TREBLE_L, 0x80);\n\t\t/* Check if we can read back the mixer value. */\n\t\tif ((sbdsp_mix_read(sc, SB16P_TREBLE_L) & 0xf0) == 0x80)\n\t\t\tsc->sc_mixer_model = SBM_CT1745;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_CT1XX5;\n#else\n\t\tsc->sc_mixer_model = SBM_CT1745;\n#endif\n#if 0\n/* XXX figure out a good way of determining the model */\n\t\t/* XXX what about SB_32 */\n\t\tif (SBVER_MINOR(v) == 16)\n\t\t\tsc->sc_model = SB_64;\n\t\telse\n#endif\n\t\t\tsc->sc_model = SB_16;\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "sbdsp_spkroff",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1046-1052",
    "snippet": "void\nsbdsp_spkroff(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_OFF);\n\tsbdsp_pause(sc);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_pause"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_pause",
          "args": [
            "sc"
          ],
          "line": 1051
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_pause",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1015-1023",
          "snippet": "void\nsbdsp_pause(sc)\n\tstruct sbdsp_softc *sc;\n{\n\textern int hz;\n\n\ttimeout(sbdsp_to, sbdsp_to, hz/8);\n\t(void)tsleep(sbdsp_to, PWAIT, \"sbpause\", 0);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_to",
            "void\tsbdsp_pause"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_to;\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_pause(sc)\n\tstruct sbdsp_softc *sc;\n{\n\textern int hz;\n\n\ttimeout(sbdsp_to, sbdsp_to, hz/8);\n\t(void)tsleep(sbdsp_to, PWAIT, \"sbpause\", 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "SB_DSP_SPKR_OFF"
          ],
          "line": 1050
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_spkroff(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_OFF);\n\tsbdsp_pause(sc);\n}"
  },
  {
    "function_name": "sbdsp_spkron",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1035-1041",
    "snippet": "void\nsbdsp_spkron(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_ON);\n\tsbdsp_pause(sc);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_pause"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_pause",
          "args": [
            "sc"
          ],
          "line": 1040
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_pause",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1015-1023",
          "snippet": "void\nsbdsp_pause(sc)\n\tstruct sbdsp_softc *sc;\n{\n\textern int hz;\n\n\ttimeout(sbdsp_to, sbdsp_to, hz/8);\n\t(void)tsleep(sbdsp_to, PWAIT, \"sbpause\", 0);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_to",
            "void\tsbdsp_pause"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_to;\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_pause(sc)\n\tstruct sbdsp_softc *sc;\n{\n\textern int hz;\n\n\ttimeout(sbdsp_to, sbdsp_to, hz/8);\n\t(void)tsleep(sbdsp_to, PWAIT, \"sbpause\", 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "SB_DSP_SPKR_ON"
          ],
          "line": 1039
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_spkron(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_ON);\n\tsbdsp_pause(sc);\n}"
  },
  {
    "function_name": "sbdsp_pause",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1015-1023",
    "snippet": "void\nsbdsp_pause(sc)\n\tstruct sbdsp_softc *sc;\n{\n\textern int hz;\n\n\ttimeout(sbdsp_to, sbdsp_to, hz/8);\n\t(void)tsleep(sbdsp_to, PWAIT, \"sbpause\", 0);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_to",
      "void\tsbdsp_pause"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tsleep",
          "args": [
            "sbdsp_to",
            "PWAIT",
            "\"sbpause\"",
            "0"
          ],
          "line": 1022
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "timeout",
          "args": [
            "sbdsp_to",
            "sbdsp_to",
            "hz/8"
          ],
          "line": 1021
        },
        "resolved": true,
        "details": {
          "function_name": "bt_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/bt.c",
          "lines": "1300-1345",
          "snippet": "void\nbt_timeout(arg)\n\tvoid *arg;\n{\n\tstruct bt_ccb *ccb = arg;\n\tstruct scsi_xfer *xs = ccb->xs;\n\tstruct scsi_link *sc_link = xs->sc_link;\n\tstruct bt_softc *sc = sc_link->adapter_softc;\n\tint s;\n\n\tsc_print_addr(sc_link);\n\tprintf(\"timed out\");\n\n\ts = splbio();\n\n#ifdef BTDIAG\n\t/*\n\t * If the ccb's mbx is not free, then the board has gone Far East?\n\t */\n\tbt_collect_mbo(sc);\n\tif (ccb->flags & CCB_SENDING) {\n\t\tprintf(\"%s: not taking commands!\\n\", sc->sc_dev.dv_xname);\n\t\tDebugger();\n\t}\n#endif\n\n\t/*\n\t * If it has been through before, then\n\t * a previous abort has failed, don't\n\t * try abort again\n\t */\n\tif (ccb->flags & CCB_ABORT) {\n\t\t/* abort timed out */\n\t\tprintf(\" AGAIN\\n\");\n\t\t/* XXX Must reset! */\n\t} else {\n\t\t/* abort the operation that has timed out */\n\t\tprintf(\"\\n\");\n\t\tccb->xs->error = XS_TIMEOUT;\n\t\tccb->timeout = BT_ABORT_TIMEOUT;\n\t\tccb->flags |= CCB_ABORT;\n\t\tbt_queue_ccb(sc, ccb);\n\t}\n\n\tsplx(s);\n}",
          "includes": [
            "#include \"bt.h\"",
            "#include \"aha.h\"",
            "#include <dev/isa/btreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <scsi/scsiconf.h>",
            "#include <scsi/scsi_all.h>",
            "#include <machine/pio.h>",
            "#include <machine/intr.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/buf.h>",
            "#include <sys/malloc.h>",
            "#include <sys/device.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/kernel.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include <sys/types.h>"
          ],
          "macros_used": [
            "#define\tBT_ABORT_TIMEOUT\t2000\t/* time to wait for abort (mSec) */"
          ],
          "globals_used": [
            "bt_finish_ccbs __P((struct bt_softc *));",
            "bt_reset_ccb __P((struct bt_softc *, struct bt_ccb *));",
            "bt_init_ccb __P((struct bt_softc *, struct bt_ccb *));",
            "void bt_queue_ccb",
            "void bt_collect_mbo",
            "void bt_timeout",
            "struct bt_ccb *\nbt_get_ccb(sc, flags)\n\tstruct bt_softc *sc;",
            "int flags;",
            "struct bt_ccb *\nbt_ccb_phys_kv(sc, ccb_phys)\n\tstruct bt_softc *sc;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"bt.h\"\n#include \"aha.h\"\n#include <dev/isa/btreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <scsi/scsiconf.h>\n#include <scsi/scsi_all.h>\n#include <machine/pio.h>\n#include <machine/intr.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/buf.h>\n#include <sys/malloc.h>\n#include <sys/device.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/kernel.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include <sys/types.h>\n\n#define\tBT_ABORT_TIMEOUT\t2000\t/* time to wait for abort (mSec) */\n\nbt_finish_ccbs __P((struct bt_softc *));\nbt_reset_ccb __P((struct bt_softc *, struct bt_ccb *));\nbt_init_ccb __P((struct bt_softc *, struct bt_ccb *));\nvoid bt_queue_ccb;\nvoid bt_collect_mbo;\nvoid bt_timeout;\nstruct bt_ccb *\nbt_get_ccb(sc, flags)\n\tstruct bt_softc *sc;\nint flags;\nstruct bt_ccb *\nbt_ccb_phys_kv(sc, ccb_phys)\n\tstruct bt_softc *sc;\n\nvoid\nbt_timeout(arg)\n\tvoid *arg;\n{\n\tstruct bt_ccb *ccb = arg;\n\tstruct scsi_xfer *xs = ccb->xs;\n\tstruct scsi_link *sc_link = xs->sc_link;\n\tstruct bt_softc *sc = sc_link->adapter_softc;\n\tint s;\n\n\tsc_print_addr(sc_link);\n\tprintf(\"timed out\");\n\n\ts = splbio();\n\n#ifdef BTDIAG\n\t/*\n\t * If the ccb's mbx is not free, then the board has gone Far East?\n\t */\n\tbt_collect_mbo(sc);\n\tif (ccb->flags & CCB_SENDING) {\n\t\tprintf(\"%s: not taking commands!\\n\", sc->sc_dev.dv_xname);\n\t\tDebugger();\n\t}\n#endif\n\n\t/*\n\t * If it has been through before, then\n\t * a previous abort has failed, don't\n\t * try abort again\n\t */\n\tif (ccb->flags & CCB_ABORT) {\n\t\t/* abort timed out */\n\t\tprintf(\" AGAIN\\n\");\n\t\t/* XXX Must reset! */\n\t} else {\n\t\t/* abort the operation that has timed out */\n\t\tprintf(\"\\n\");\n\t\tccb->xs->error = XS_TIMEOUT;\n\t\tccb->timeout = BT_ABORT_TIMEOUT;\n\t\tccb->flags |= CCB_ABORT;\n\t\tbt_queue_ccb(sc, ccb);\n\t}\n\n\tsplx(s);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_to;\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_pause(sc)\n\tstruct sbdsp_softc *sc;\n{\n\textern int hz;\n\n\ttimeout(sbdsp_to, sbdsp_to, hz/8);\n\t(void)tsleep(sbdsp_to, PWAIT, \"sbpause\", 0);\n}"
  },
  {
    "function_name": "sbdsp_to",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "1008-1013",
    "snippet": "void\nsbdsp_to(arg)\n\tvoid *arg;\n{\n\twakeup(arg);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_to"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup",
          "args": [
            "arg"
          ],
          "line": 1012
        },
        "resolved": true,
        "details": {
          "function_name": "audio_wakeup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/audio.c",
          "lines": "765-774",
          "snippet": "static __inline void\naudio_wakeup(chan)\n\tint *chan;\n{\n\tDPRINTFN(3, (\"audio_wakeup: chan=%p, *chan=%d\\n\", chan, *chan));\n\tif (*chan) {\n\t\twakeup(chan);\n\t\t*chan = 0;\n\t}\n}",
          "includes": [
            "#include <machine/endian.h>",
            "#include <vm/vm_prot.h>",
            "#include <vm/vm.h>",
            "#include <dev/rndvar.h>",
            "#include <dev/audiovar.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/device.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/signalvar.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/proc.h>",
            "#include <sys/malloc.h>",
            "#include <sys/poll.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>",
            "#include \"audio.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <machine/endian.h>\n#include <vm/vm_prot.h>\n#include <vm/vm.h>\n#include <dev/rndvar.h>\n#include <dev/audiovar.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/signalvar.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/proc.h>\n#include <sys/malloc.h>\n#include <sys/poll.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n#include \"audio.h\"\n\nstatic __inline void\naudio_wakeup(chan)\n\tint *chan;\n{\n\tDPRINTFN(3, (\"audio_wakeup: chan=%p, *chan=%d\\n\", chan, *chan));\n\tif (*chan) {\n\t\twakeup(chan);\n\t\t*chan = 0;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_to;\n\nvoid\nsbdsp_to(arg)\n\tvoid *arg;\n{\n\twakeup(arg);\n}"
  },
  {
    "function_name": "sbdsp_rdsp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "982-1002",
    "snippet": "int\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [
      "#define SBDSP_NPOLL 3000"
    ],
    "globals_used": [
      "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "10"
          ],
          "line": 996
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "SBP_DSP_READ"
          ],
          "line": 995
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "SBP_DSP_RSTAT"
          ],
          "line": 992
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}"
  },
  {
    "function_name": "sbdsp_wdsp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "956-977",
    "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [
      "#define SBDSP_NPOLL 3000"
    ],
    "globals_used": [
      "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "10"
          ],
          "line": 971
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "SBP_DSP_WRITE",
            "v"
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "SBP_DSP_WSTAT"
          ],
          "line": 967
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
  },
  {
    "function_name": "sbdsp_reset",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "918-949",
    "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_rdsp",
          "args": [
            "sc"
          ],
          "line": 945
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_rdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "982-1002",
          "snippet": "int\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "30"
          ],
          "line": 944
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "SBP_DSP_RESET",
            "0"
          ],
          "line": 943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "SBP_DSP_RESET",
            "1"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isa_dmaabort",
          "args": [
            "sc->sc_isa",
            "sc->sc_o.dmachan"
          ],
          "line": 932
        },
        "resolved": true,
        "details": {
          "function_name": "isa_dmaabort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/isadma.c",
          "lines": "424-439",
          "snippet": "void\nisa_dmaabort(isadev, chan)\n\tstruct device *isadev;\n\tint chan;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\n\tif (chan < 0 || chan > 7) {\n\t\tpanic(\"isa_dmaabort: %s: bogus drq %d\", sc->sc_dev.dv_xname,\n\t\t    chan);\n\t}\n\n\tisa_dmamask(sc, chan);\n\tbus_dmamap_unload(sc->sc_dmat, sc->sc_dmamaps[chan]);\n\tsc->sc_dmareads &= ~(1 << chan);\n}",
          "includes": [
            "#include <sys/malloc.h>",
            "#include <dev/isa/isadmareg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/isa/isareg.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline void isa_dmamask",
            "void *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;",
            "int chan;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/malloc.h>\n#include <dev/isa/isadmareg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/isa/isareg.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic inline void isa_dmamask;\nvoid *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;\nint chan;\n\nvoid\nisa_dmaabort(isadev, chan)\n\tstruct device *isadev;\n\tint chan;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\n\tif (chan < 0 || chan > 7) {\n\t\tpanic(\"isa_dmaabort: %s: bogus drq %d\", sc->sc_dev.dv_xname,\n\t\t    chan);\n\t}\n\n\tisa_dmamask(sc, chan);\n\tbus_dmamap_unload(sc->sc_dmat, sc->sc_dmamaps[chan]);\n\tsc->sc_dmareads &= ~(1 << chan);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "891-908",
    "snippet": "void\nsbdsp_close(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_close: sc=%p\\n\", sc));\n\n\tsc->sc_open = SB_CLOSED;\n\tsbdsp_spkroff(sc);\n\tsc->spkr_state = SPKR_OFF;\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tsc->sc_intrm = 0;\n\tsbdsp_haltdma(sc);\n\n\tDPRINTF((\"sbdsp_close: closed\\n\"));\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_close: closed\\n\")"
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_haltdma",
          "args": [
            "sc"
          ],
          "line": 905
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_haltdma",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1125-1135",
          "snippet": "int\nsbdsp_haltdma(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tDPRINTF((\"sbdsp_haltdma: sc=%p\\n\", sc));\n\n\tsbdsp_reset(sc);\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_haltdma(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tDPRINTF((\"sbdsp_haltdma: sc=%p\\n\", sc));\n\n\tsbdsp_reset(sc);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_spkroff",
          "args": [
            "sc"
          ],
          "line": 900
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_spkroff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1046-1052",
          "snippet": "void\nsbdsp_spkroff(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_OFF);\n\tsbdsp_pause(sc);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_pause"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_spkroff(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_OFF);\n\tsbdsp_pause(sc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_close: sc=%p\\n\", sc)"
          ],
          "line": 897
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nvoid\nsbdsp_close(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_close: sc=%p\\n\", sc));\n\n\tsc->sc_open = SB_CLOSED;\n\tsbdsp_spkroff(sc);\n\tsc->spkr_state = SPKR_OFF;\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tsc->sc_intrm = 0;\n\tsbdsp_haltdma(sc);\n\n\tDPRINTF((\"sbdsp_close: closed\\n\"));\n}"
  },
  {
    "function_name": "sbdsp_open",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "857-889",
    "snippet": "int\nsbdsp_open(addr, flags)\n\tvoid *addr;\n\tint flags;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_open: sc=%p\\n\", sc));\n\n\tif (sc->sc_open != SB_CLOSED)\n\t\treturn EBUSY;\n\tif (sbdsp_reset(sc) != 0)\n\t\treturn EIO;\n\n\tsc->sc_open = SB_OPEN_AUDIO;\n\tsc->sc_openflags = flags;\n\tsc->sc_intrm = 0;\n\tif (ISSBPRO(sc) &&\n\t    sbdsp_wdsp(sc, SB_DSP_RECORD_MONO) < 0) {\n\t\tDPRINTF((\"sbdsp_open: can't set mono mode\\n\"));\n\t\t/* we'll readjust when it's time for DMA. */\n\t}\n\n\t/*\n\t * Leave most things as they were; users must change things if\n\t * the previous process didn't leave it they way they wanted.\n\t * Looked at another way, it's easy to set up a configuration\n\t * in one program and leave it for another to inherit.\n\t */\n\tDPRINTF((\"sbdsp_open: opened\\n\"));\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;",
      "int flags;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_open: opened\\n\")"
          ],
          "line": 886
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_open: can't set mono mode\\n\")"
          ],
          "line": 876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "SB_DSP_RECORD_MONO"
          ],
          "line": 875
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ISSBPRO",
          "args": [
            "sc"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_reset",
          "args": [
            "sc"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "918-949",
          "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_open: sc=%p\\n\", sc)"
          ],
          "line": 864
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\nint flags;\n\nint\nsbdsp_open(addr, flags)\n\tvoid *addr;\n\tint flags;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n        DPRINTF((\"sbdsp_open: sc=%p\\n\", sc));\n\n\tif (sc->sc_open != SB_CLOSED)\n\t\treturn EBUSY;\n\tif (sbdsp_reset(sc) != 0)\n\t\treturn EIO;\n\n\tsc->sc_open = SB_OPEN_AUDIO;\n\tsc->sc_openflags = flags;\n\tsc->sc_intrm = 0;\n\tif (ISSBPRO(sc) &&\n\t    sbdsp_wdsp(sc, SB_DSP_RECORD_MONO) < 0) {\n\t\tDPRINTF((\"sbdsp_open: can't set mono mode\\n\"));\n\t\t/* we'll readjust when it's time for DMA. */\n\t}\n\n\t/*\n\t * Leave most things as they were; users must change things if\n\t * the previous process didn't leave it they way they wanted.\n\t * Looked at another way, it's easy to set up a configuration\n\t * in one program and leave it for another to inherit.\n\t */\n\tDPRINTF((\"sbdsp_open: opened\\n\"));\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_round_blocksize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "849-855",
    "snippet": "int\nsbdsp_round_blocksize(addr, blk)\n\tvoid *addr;\n\tint blk;\n{\n\treturn blk & -4;\t/* round to biggest sample size */\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;",
      "unsigned long size;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\nunsigned long size;\n\nint\nsbdsp_round_blocksize(addr, blk)\n\tvoid *addr;\n\tint blk;\n{\n\treturn blk & -4;\t/* round to biggest sample size */\n}"
  },
  {
    "function_name": "sbdsp_speaker_ctl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "826-847",
    "snippet": "int\nsbdsp_speaker_ctl(addr, newstate)\n\tvoid *addr;\n\tint newstate;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tif ((newstate == SPKR_ON) &&\n\t    (sc->spkr_state == SPKR_OFF)) {\n\t\tsbdsp_spkron(sc);\n\t\tsc->spkr_state = SPKR_ON;\n\t}\n\tif ((newstate == SPKR_OFF) &&\n\t    (sc->spkr_state == SPKR_ON)) {\n\t\tsbdsp_spkroff(sc);\n\t\tsc->spkr_state = SPKR_OFF;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_spkroff",
          "args": [
            "sc"
          ],
          "line": 843
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_spkroff",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1046-1052",
          "snippet": "void\nsbdsp_spkroff(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_OFF);\n\tsbdsp_pause(sc);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_pause"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_spkroff(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_OFF);\n\tsbdsp_pause(sc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_spkron",
          "args": [
            "sc"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_spkron",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1035-1041",
          "snippet": "void\nsbdsp_spkron(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_ON);\n\tsbdsp_pause(sc);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_pause"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_pause;\n\nvoid\nsbdsp_spkron(sc)\n\tstruct sbdsp_softc *sc;\n{\n\t(void)sbdsp_wdsp(sc, SB_DSP_SPKR_ON);\n\tsbdsp_pause(sc);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_speaker_ctl(addr, newstate)\n\tvoid *addr;\n\tint newstate;\n{\n\tstruct sbdsp_softc *sc = addr;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tif ((newstate == SPKR_ON) &&\n\t    (sc->spkr_state == SPKR_OFF)) {\n\t\tsbdsp_spkron(sc);\n\t\tsc->spkr_state = SPKR_ON;\n\t}\n\tif ((newstate == SPKR_OFF) &&\n\t    (sc->spkr_state == SPKR_ON)) {\n\t\tsbdsp_spkroff(sc);\n\t\tsc->spkr_state = SPKR_OFF;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_set_in_ports",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "766-824",
    "snippet": "int\nsbdsp_set_in_ports(sc, mask)\n\tstruct sbdsp_softc *sc;\n\tint mask;\n{\n\tint bitsl, bitsr;\n\tint sbport;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask));\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn EINVAL;\n\tcase SBM_CT1335:\n\t\tif (mask != (1 << SB_MIC_VOL))\n\t\t\treturn EINVAL;\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tswitch (mask) {\n\t\tcase 1 << SB_MIC_VOL:\n\t\t\tsbport = SBP_FROM_MIC;\n\t\t\tbreak;\n\t\tcase 1 << SB_LINE_IN_VOL:\n\t\t\tsbport = SBP_FROM_LINE;\n\t\t\tbreak;\n\t\tcase 1 << SB_CD_VOL:\n\t\t\tsbport = SBP_FROM_CD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn (EINVAL);\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE, sbport | sc->in_filter);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tif (mask & ~((1<<SB_MIDI_VOL) | (1<<SB_LINE_IN_VOL) |\n\t\t\t     (1<<SB_CD_VOL) | (1<<SB_MIC_VOL)))\n\t\t\treturn EINVAL;\n\t\tbitsr = 0;\n\t\tif (mask & (1<<SB_MIDI_VOL))    bitsr |= SBP_MIDI_SRC_R;\n\t\tif (mask & (1<<SB_LINE_IN_VOL)) bitsr |= SBP_LINE_SRC_R;\n\t\tif (mask & (1<<SB_CD_VOL))      bitsr |= SBP_CD_SRC_R;\n\t\tbitsl = SB_SRC_R_TO_L(bitsr);\n\t\tif (mask & (1<<SB_MIC_VOL)) {\n\t\t\tbitsl |= SBP_MIC_SRC;\n\t\t\tbitsr |= SBP_MIC_SRC;\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_L, bitsl);\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_R, bitsr);\n\t\tbreak;\n\t}\n\tsc->in_mask = mask;\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_set_in_ports"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SBP_RECORD_SOURCE_R",
            "bitsr"
          ],
          "line": 818
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "SB_SRC_R_TO_L",
          "args": [
            "bitsr"
          ],
          "line": 812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask)"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_in_ports;\n\nint\nsbdsp_set_in_ports(sc, mask)\n\tstruct sbdsp_softc *sc;\n\tint mask;\n{\n\tint bitsl, bitsr;\n\tint sbport;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask));\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn EINVAL;\n\tcase SBM_CT1335:\n\t\tif (mask != (1 << SB_MIC_VOL))\n\t\t\treturn EINVAL;\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tswitch (mask) {\n\t\tcase 1 << SB_MIC_VOL:\n\t\t\tsbport = SBP_FROM_MIC;\n\t\t\tbreak;\n\t\tcase 1 << SB_LINE_IN_VOL:\n\t\t\tsbport = SBP_FROM_LINE;\n\t\t\tbreak;\n\t\tcase 1 << SB_CD_VOL:\n\t\t\tsbport = SBP_FROM_CD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn (EINVAL);\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE, sbport | sc->in_filter);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tif (mask & ~((1<<SB_MIDI_VOL) | (1<<SB_LINE_IN_VOL) |\n\t\t\t     (1<<SB_CD_VOL) | (1<<SB_MIC_VOL)))\n\t\t\treturn EINVAL;\n\t\tbitsr = 0;\n\t\tif (mask & (1<<SB_MIDI_VOL))    bitsr |= SBP_MIDI_SRC_R;\n\t\tif (mask & (1<<SB_LINE_IN_VOL)) bitsr |= SBP_LINE_SRC_R;\n\t\tif (mask & (1<<SB_CD_VOL))      bitsr |= SBP_CD_SRC_R;\n\t\tbitsl = SB_SRC_R_TO_L(bitsr);\n\t\tif (mask & (1<<SB_MIC_VOL)) {\n\t\t\tbitsl |= SBP_MIC_SRC;\n\t\t\tbitsr |= SBP_MIC_SRC;\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_L, bitsl);\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_R, bitsr);\n\t\tbreak;\n\t}\n\tsc->in_mask = mask;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_get_ifilter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "748-764",
    "snippet": "int\nsbdsp_get_ifilter(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\t\n\tsc->in_filter =\n\t\tsbdsp_mix_read(sc, SBP_INFILTER) & SBP_IFILTER_MASK;\n\tswitch (sc->in_filter) {\n\tcase SBP_FILTER_ON|SBP_IFILTER_HIGH:\n\t\treturn SB_TREBLE;\n\tcase SBP_FILTER_ON|SBP_IFILTER_LOW:\n\t\treturn SB_BASS;\n\tdefault:\n\t\treturn 0;\n\t}\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int\tsbdsp_get_ifilter",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SBP_INFILTER"
          ],
          "line": 755
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_get_ifilter;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_get_ifilter(addr)\n\tvoid *addr;\n{\n\tstruct sbdsp_softc *sc = addr;\n\t\n\tsc->in_filter =\n\t\tsbdsp_mix_read(sc, SBP_INFILTER) & SBP_IFILTER_MASK;\n\tswitch (sc->in_filter) {\n\tcase SBP_FILTER_ON|SBP_IFILTER_HIGH:\n\t\treturn SB_TREBLE;\n\tcase SBP_FILTER_ON|SBP_IFILTER_LOW:\n\t\treturn SB_BASS;\n\tdefault:\n\t\treturn 0;\n\t}\n}"
  },
  {
    "function_name": "sbdsp_set_ifilter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "722-746",
    "snippet": "void\nsbdsp_set_ifilter(addr, which)\n\tvoid *addr;\n\tint which;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint mixval;\n\n\tmixval = sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK;\n\tswitch (which) {\n\tcase 0:\n\t\tmixval |= SBP_FILTER_OFF;\n\t\tbreak;\n\tcase SB_TREBLE:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_HIGH;\n\t\tbreak;\n\tcase SB_BASS:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_LOW; \n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tsc->in_filter = mixval & SBP_IFILTER_MASK;\n\tsbdsp_mix_write(sc, SBP_INFILTER, mixval);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_set_ifilter",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SBP_INFILTER",
            "mixval"
          ],
          "line": 745
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_read",
          "args": [
            "sc",
            "SBP_INFILTER"
          ],
          "line": 730
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "425-442",
          "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_ifilter;\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nvoid\nsbdsp_set_ifilter(addr, which)\n\tvoid *addr;\n\tint which;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint mixval;\n\n\tmixval = sbdsp_mix_read(sc, SBP_INFILTER) & ~SBP_IFILTER_MASK;\n\tswitch (which) {\n\tcase 0:\n\t\tmixval |= SBP_FILTER_OFF;\n\t\tbreak;\n\tcase SB_TREBLE:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_HIGH;\n\t\tbreak;\n\tcase SB_BASS:\n\t\tmixval |= SBP_FILTER_ON | SBP_IFILTER_LOW; \n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tsc->in_filter = mixval & SBP_IFILTER_MASK;\n\tsbdsp_mix_write(sc, SBP_INFILTER, mixval);\n}"
  },
  {
    "function_name": "sbdsp_set_params",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "518-720",
    "snippet": "int\nsbdsp_set_params(addr, setmode, usemode, play, rec)\n\tvoid *addr;\n\tint setmode, usemode;\n\tstruct audio_params *play, *rec;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tstruct sbmode *m;\n\tu_int rate, tc, bmode;\n\tvoid (*swcode) __P((void *, u_char *buf, int cnt));\n\tint factor;\n\tint model;\n\tint chan;\n\tstruct audio_params *p;\n\tint mode;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tmodel = sc->sc_model;\n\tif (model > SB_16) \n\t\tmodel = SB_16;\t/* later models work like SB16 */\n\n\t/*\n\t * Prior to the SB16, we have only one clock, so make the sample\n\t * rates match.\n\t */\n\tif (!ISSB16CLASS(sc) &&\n\t    play->sample_rate != rec->sample_rate &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD)) {\n\t\tif (setmode == AUMODE_PLAY) {\n\t\t\trec->sample_rate = play->sample_rate;\n\t\t\tsetmode |= AUMODE_RECORD;\n\t\t} else if (setmode == AUMODE_RECORD) {\n\t\t\tplay->sample_rate = rec->sample_rate;\n\t\t\tsetmode |= AUMODE_PLAY;\n\t\t} else\n\t\t\treturn (EINVAL);\n\t}\n\n\t/* Set first record info, then play info */\n\tfor (mode = AUMODE_RECORD; mode != -1; \n\t     mode = mode == AUMODE_RECORD ? AUMODE_PLAY : -1) {\n\t\tif ((setmode & mode) == 0)\n\t\t\tcontinue;\n\n\t\tp = mode == AUMODE_PLAY ? play : rec;\n\t\t/* Locate proper commands */\n\t\tfor(m = mode == AUMODE_PLAY ? sbpmodes : sbrmodes; \n\t\t    m->model != -1; m++) {\n\t\t\tif (model == m->model &&\n\t\t\t    p->channels == m->channels &&\n\t\t\t    p->precision == m->precision &&\n\t\t\t    p->sample_rate >= m->lowrate && \n\t\t\t    p->sample_rate < m->highrate)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (m->model == -1)\n\t\t\treturn EINVAL;\n\t\trate = p->sample_rate;\n\t\tswcode = 0;\n\t\tfactor = 1;\n\t\ttc = 1;\n\t\tbmode = -1;\n\t\tif (model == SB_16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_SIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = mulaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_mulaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = alaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_alaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tif (p->channels == 2)\n\t\t\t\tbmode |= SB_BMODE_STEREO;\n\t\t} else if (m->model == SB_JAZZ && m->precision == 16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tswcode = change_sign16;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tswcode = swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tswcode = mode == AUMODE_PLAY ?\n\t\t\t\t\tswap_bytes_change_sign16 : change_sign16_swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t} else {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tswcode = change_sign8;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t}\n\n\t\tchan = m->precision == 16 ? sc->sc_drq16 : sc->sc_drq8;\n\t\tif (mode == AUMODE_PLAY) {\n\t\t\tsc->sc_o.rate = rate;\n\t\t\tsc->sc_o.tc = tc;\n\t\t\tsc->sc_o.modep = m;\n\t\t\tsc->sc_o.bmode = bmode;\n\t\t\tsc->sc_o.dmachan = chan;\n\t\t} else {\n\t\t\tsc->sc_i.rate = rate;\n\t\t\tsc->sc_i.tc = tc;\n\t\t\tsc->sc_i.modep = m;\n\t\t\tsc->sc_i.bmode = bmode;\n\t\t\tsc->sc_i.dmachan = chan;\n\t\t}\n\n\t\tp->sw_code = swcode;\n\t\tp->factor = factor;\n\t\tDPRINTF((\"sbdsp_set_params: model=%d, mode=%d, rate=%ld, prec=%d, chan=%d, enc=%d -> tc=%02x, cmd=%02x, bmode=%02x, cmdchan=%02x, swcode=%p, factor=%d\\n\", \n\t\t\t sc->sc_model, mode, p->sample_rate, p->precision, p->channels,\n\t\t\t p->encoding, tc, m->cmd, bmode, m->cmdchan, swcode, factor));\n\n\t}\n\n\t/*\n\t * XXX\n\t * Should wait for chip to be idle.\n\t */\n\tsc->sc_i.run = SB_NOTRUNNING;\n\tsc->sc_o.run = SB_NOTRUNNING;\n\n\tif (sc->sc_fullduplex &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD) &&\n\t    sc->sc_i.dmachan == sc->sc_o.dmachan) {\n\t\tDPRINTF((\"sbdsp_set_params: fd=%d, usemode=%d, idma=%d, odma=%d\\n\", sc->sc_fullduplex, usemode, sc->sc_i.dmachan, sc->sc_o.dmachan));\n\t\tif (sc->sc_o.dmachan == sc->sc_drq8) {\n\t\t\t/* Use 16 bit DMA for playing by expanding the samples. */\n\t\t\tplay->sw_code = linear8_to_linear16;\n\t\t\tplay->factor = 2;\n\t\t\tsc->sc_o.modep = &sbpmodes[PLAY16];\n\t\t\tsc->sc_o.dmachan = sc->sc_drq16;\n\t\t} else {\n\t\t\treturn EINVAL;\n\t\t}\n\t}\n\tDPRINTF((\"sbdsp_set_params ichan=%d, ochan=%d\\n\", \n\t\t sc->sc_i.dmachan, sc->sc_o.dmachan));\n\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct sbmode sbpmodes[] = {\n { SB_1,    1,  8,  4000, 22727, SB_DSP_WDMA      },\n { SB_20,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_OUTPUT },\n /* Yes, we write the record mode to set 16-bit playback mode. weird, huh? */\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_WDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_WDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n#define PLAY16 15 /* must be the index of the next entry in the table */\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { -1 }\n};",
      "static struct sbmode sbrmodes[] = {\n { SB_1,    1,  8,  4000, 12987, SB_DSP_RDMA      },\n { SB_20,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8, 12987, 14925, SB_DSP_HS_INPUT  },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_RDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_INPUT,  JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_INPUT,  JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { -1 }\n};",
      "__P((int, int));",
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_set_params ichan=%d, ochan=%d\\n\", \n\t\t sc->sc_i.dmachan, sc->sc_o.dmachan)"
          ],
          "line": 716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_set_params: fd=%d, usemode=%d, idma=%d, odma=%d\\n\", sc->sc_fullduplex, usemode, sc->sc_i.dmachan, sc->sc_o.dmachan)"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_set_params: model=%d, mode=%d, rate=%ld, prec=%d, chan=%d, enc=%d -> tc=%02x, cmd=%02x, bmode=%02x, cmdchan=%02x, swcode=%p, factor=%d\\n\", \n\t\t\t sc->sc_model, mode, p->sample_rate, p->precision, p->channels,\n\t\t\t p->encoding, tc, m->cmd, bmode, m->cmdchan, swcode, factor)"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_TC_TO_RATE",
          "args": [
            "tc"
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_RATE_TO_TC",
          "args": [
            "p->sample_rate * p->channels"
          ],
          "line": 668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_TC_TO_RATE",
          "args": [
            "tc"
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_RATE_TO_TC",
          "args": [
            "p->sample_rate * p->channels"
          ],
          "line": 646
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__P",
          "args": [
            "(void *, u_char *buf, int cnt)"
          ],
          "line": 527
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nstatic struct sbmode sbpmodes[] = {\n { SB_1,    1,  8,  4000, 22727, SB_DSP_WDMA      },\n { SB_20,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_OUTPUT },\n /* Yes, we write the record mode to set 16-bit playback mode. weird, huh? */\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_WDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_WDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n#define PLAY16 15 /* must be the index of the next entry in the table */\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { -1 }\n};\nstatic struct sbmode sbrmodes[] = {\n { SB_1,    1,  8,  4000, 12987, SB_DSP_RDMA      },\n { SB_20,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8, 12987, 14925, SB_DSP_HS_INPUT  },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_RDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_INPUT,  JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_INPUT,  JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { -1 }\n};\n__P((int, int));\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_set_params(addr, setmode, usemode, play, rec)\n\tvoid *addr;\n\tint setmode, usemode;\n\tstruct audio_params *play, *rec;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tstruct sbmode *m;\n\tu_int rate, tc, bmode;\n\tvoid (*swcode) __P((void *, u_char *buf, int cnt));\n\tint factor;\n\tint model;\n\tint chan;\n\tstruct audio_params *p;\n\tint mode;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tmodel = sc->sc_model;\n\tif (model > SB_16) \n\t\tmodel = SB_16;\t/* later models work like SB16 */\n\n\t/*\n\t * Prior to the SB16, we have only one clock, so make the sample\n\t * rates match.\n\t */\n\tif (!ISSB16CLASS(sc) &&\n\t    play->sample_rate != rec->sample_rate &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD)) {\n\t\tif (setmode == AUMODE_PLAY) {\n\t\t\trec->sample_rate = play->sample_rate;\n\t\t\tsetmode |= AUMODE_RECORD;\n\t\t} else if (setmode == AUMODE_RECORD) {\n\t\t\tplay->sample_rate = rec->sample_rate;\n\t\t\tsetmode |= AUMODE_PLAY;\n\t\t} else\n\t\t\treturn (EINVAL);\n\t}\n\n\t/* Set first record info, then play info */\n\tfor (mode = AUMODE_RECORD; mode != -1; \n\t     mode = mode == AUMODE_RECORD ? AUMODE_PLAY : -1) {\n\t\tif ((setmode & mode) == 0)\n\t\t\tcontinue;\n\n\t\tp = mode == AUMODE_PLAY ? play : rec;\n\t\t/* Locate proper commands */\n\t\tfor(m = mode == AUMODE_PLAY ? sbpmodes : sbrmodes; \n\t\t    m->model != -1; m++) {\n\t\t\tif (model == m->model &&\n\t\t\t    p->channels == m->channels &&\n\t\t\t    p->precision == m->precision &&\n\t\t\t    p->sample_rate >= m->lowrate && \n\t\t\t    p->sample_rate < m->highrate)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (m->model == -1)\n\t\t\treturn EINVAL;\n\t\trate = p->sample_rate;\n\t\tswcode = 0;\n\t\tfactor = 1;\n\t\ttc = 1;\n\t\tbmode = -1;\n\t\tif (model == SB_16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_SIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = mulaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_mulaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = alaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_alaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tif (p->channels == 2)\n\t\t\t\tbmode |= SB_BMODE_STEREO;\n\t\t} else if (m->model == SB_JAZZ && m->precision == 16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tswcode = change_sign16;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tswcode = swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tswcode = mode == AUMODE_PLAY ?\n\t\t\t\t\tswap_bytes_change_sign16 : change_sign16_swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t} else {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tswcode = change_sign8;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t}\n\n\t\tchan = m->precision == 16 ? sc->sc_drq16 : sc->sc_drq8;\n\t\tif (mode == AUMODE_PLAY) {\n\t\t\tsc->sc_o.rate = rate;\n\t\t\tsc->sc_o.tc = tc;\n\t\t\tsc->sc_o.modep = m;\n\t\t\tsc->sc_o.bmode = bmode;\n\t\t\tsc->sc_o.dmachan = chan;\n\t\t} else {\n\t\t\tsc->sc_i.rate = rate;\n\t\t\tsc->sc_i.tc = tc;\n\t\t\tsc->sc_i.modep = m;\n\t\t\tsc->sc_i.bmode = bmode;\n\t\t\tsc->sc_i.dmachan = chan;\n\t\t}\n\n\t\tp->sw_code = swcode;\n\t\tp->factor = factor;\n\t\tDPRINTF((\"sbdsp_set_params: model=%d, mode=%d, rate=%ld, prec=%d, chan=%d, enc=%d -> tc=%02x, cmd=%02x, bmode=%02x, cmdchan=%02x, swcode=%p, factor=%d\\n\", \n\t\t\t sc->sc_model, mode, p->sample_rate, p->precision, p->channels,\n\t\t\t p->encoding, tc, m->cmd, bmode, m->cmdchan, swcode, factor));\n\n\t}\n\n\t/*\n\t * XXX\n\t * Should wait for chip to be idle.\n\t */\n\tsc->sc_i.run = SB_NOTRUNNING;\n\tsc->sc_o.run = SB_NOTRUNNING;\n\n\tif (sc->sc_fullduplex &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD) &&\n\t    sc->sc_i.dmachan == sc->sc_o.dmachan) {\n\t\tDPRINTF((\"sbdsp_set_params: fd=%d, usemode=%d, idma=%d, odma=%d\\n\", sc->sc_fullduplex, usemode, sc->sc_i.dmachan, sc->sc_o.dmachan));\n\t\tif (sc->sc_o.dmachan == sc->sc_drq8) {\n\t\t\t/* Use 16 bit DMA for playing by expanding the samples. */\n\t\t\tplay->sw_code = linear8_to_linear16;\n\t\t\tplay->factor = 2;\n\t\t\tsc->sc_o.modep = &sbpmodes[PLAY16];\n\t\t\tsc->sc_o.dmachan = sc->sc_drq16;\n\t\t} else {\n\t\t\treturn EINVAL;\n\t\t}\n\t}\n\tDPRINTF((\"sbdsp_set_params ichan=%d, ochan=%d\\n\", \n\t\t sc->sc_i.dmachan, sc->sc_o.dmachan));\n\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_query_encoding",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "448-516",
    "snippet": "int\nsbdsp_query_encoding(addr, fp)\n\tvoid *addr;\n\tstruct audio_encoding *fp;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint emul;\n\n\temul = ISSB16CLASS(sc) ? 0 : AUDIO_ENCODINGFLAG_EMULATED;\n\n\tswitch (fp->index) {\n\tcase 0:\n\t\tstrcpy(fp->name, AudioEulinear);\n\t\tfp->encoding = AUDIO_ENCODING_ULINEAR;\n\t\tfp->precision = 8;\n\t\tfp->flags = 0;\n\t\treturn 0;\n\tcase 1:\n\t\tstrcpy(fp->name, AudioEmulaw);\n\t\tfp->encoding = AUDIO_ENCODING_ULAW;\n\t\tfp->precision = 8;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tcase 2:\n\t\tstrcpy(fp->name, AudioEalaw);\n\t\tfp->encoding = AUDIO_ENCODING_ALAW;\n\t\tfp->precision = 8;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tcase 3:\n\t\tstrcpy(fp->name, AudioEslinear);\n\t\tfp->encoding = AUDIO_ENCODING_SLINEAR;\n\t\tfp->precision = 8;\n\t\tfp->flags = emul;\n\t\treturn 0;\n        }\n        if (!ISSB16CLASS(sc) && sc->sc_model != SB_JAZZ)\n\t\treturn EINVAL;\n\n        switch(fp->index) {\n        case 4:\n\t\tstrcpy(fp->name, AudioEslinear_le);\n\t\tfp->encoding = AUDIO_ENCODING_SLINEAR_LE;\n\t\tfp->precision = 16;\n\t\tfp->flags = 0;\n\t\treturn 0;\n\tcase 5:\n\t\tstrcpy(fp->name, AudioEulinear_le);\n\t\tfp->encoding = AUDIO_ENCODING_ULINEAR_LE;\n\t\tfp->precision = 16;\n\t\tfp->flags = emul;\n\t\treturn 0;\n\tcase 6:\n\t\tstrcpy(fp->name, AudioEslinear_be);\n\t\tfp->encoding = AUDIO_ENCODING_SLINEAR_BE;\n\t\tfp->precision = 16;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tcase 7:\n\t\tstrcpy(fp->name, AudioEulinear_be);\n\t\tfp->encoding = AUDIO_ENCODING_ULINEAR_BE;\n\t\tfp->precision = 16;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tdefault:\n\t\treturn EINVAL;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;",
      "int flags;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEulinear_be"
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEslinear_be"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEulinear_le"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEslinear_le"
          ],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEslinear"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEalaw"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEmulaw"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "fp->name",
            "AudioEulinear"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\nint flags;\n\nint\nsbdsp_query_encoding(addr, fp)\n\tvoid *addr;\n\tstruct audio_encoding *fp;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tint emul;\n\n\temul = ISSB16CLASS(sc) ? 0 : AUDIO_ENCODINGFLAG_EMULATED;\n\n\tswitch (fp->index) {\n\tcase 0:\n\t\tstrcpy(fp->name, AudioEulinear);\n\t\tfp->encoding = AUDIO_ENCODING_ULINEAR;\n\t\tfp->precision = 8;\n\t\tfp->flags = 0;\n\t\treturn 0;\n\tcase 1:\n\t\tstrcpy(fp->name, AudioEmulaw);\n\t\tfp->encoding = AUDIO_ENCODING_ULAW;\n\t\tfp->precision = 8;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tcase 2:\n\t\tstrcpy(fp->name, AudioEalaw);\n\t\tfp->encoding = AUDIO_ENCODING_ALAW;\n\t\tfp->precision = 8;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tcase 3:\n\t\tstrcpy(fp->name, AudioEslinear);\n\t\tfp->encoding = AUDIO_ENCODING_SLINEAR;\n\t\tfp->precision = 8;\n\t\tfp->flags = emul;\n\t\treturn 0;\n        }\n        if (!ISSB16CLASS(sc) && sc->sc_model != SB_JAZZ)\n\t\treturn EINVAL;\n\n        switch(fp->index) {\n        case 4:\n\t\tstrcpy(fp->name, AudioEslinear_le);\n\t\tfp->encoding = AUDIO_ENCODING_SLINEAR_LE;\n\t\tfp->precision = 16;\n\t\tfp->flags = 0;\n\t\treturn 0;\n\tcase 5:\n\t\tstrcpy(fp->name, AudioEulinear_le);\n\t\tfp->encoding = AUDIO_ENCODING_ULINEAR_LE;\n\t\tfp->precision = 16;\n\t\tfp->flags = emul;\n\t\treturn 0;\n\tcase 6:\n\t\tstrcpy(fp->name, AudioEslinear_be);\n\t\tfp->encoding = AUDIO_ENCODING_SLINEAR_BE;\n\t\tfp->precision = 16;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tcase 7:\n\t\tstrcpy(fp->name, AudioEulinear_be);\n\t\tfp->encoding = AUDIO_ENCODING_ULINEAR_BE;\n\t\tfp->precision = 16;\n\t\tfp->flags = AUDIO_ENCODINGFLAG_EMULATED;\n\t\treturn 0;\n\tdefault:\n\t\treturn EINVAL;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "sbdsp_mix_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "425-442",
    "snippet": "int\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "30"
          ],
          "line": 439
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_read_1",
          "args": [
            "iot",
            "ioh",
            "SBP_MIXER_DATA"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "SBP_MIXER_ADDR",
            "mixerport"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splaudio",
          "args": [],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_mix_read(sc, mixerport)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint val;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tval = bus_space_read_1(iot, ioh, SBP_MIXER_DATA);\n\tdelay(30);\n\tsplx(s);\n\treturn val;\n}"
  },
  {
    "function_name": "sbdsp_mix_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "407-423",
    "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "splx",
          "args": [
            "s"
          ],
          "line": 422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "30"
          ],
          "line": 421
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "SBP_MIXER_DATA",
            "val"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "SBP_MIXER_ADDR",
            "mixerport"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splaudio",
          "args": [],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
  },
  {
    "function_name": "sbdsp_attach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "327-405",
    "snippet": "void\nsbdsp_attach(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tstruct audio_params pparams, rparams;\n        int i;\n        u_int v;\n\n\t/*\n\t * Create our DMA maps.\n\t */\n\tif (sc->sc_drq8 != -1) {\n\t\tif (isa_dmamap_create(sc->sc_isa, sc->sc_drq8,\n\t\t    MAX_ISADMA, BUS_DMA_NOWAIT|BUS_DMA_ALLOCNOW)) {\n\t\t\tprintf(\"%s: can't create map for drq %d\\n\",\n\t\t\t    sc->sc_dev.dv_xname, sc->sc_drq8);\n\t\t\treturn;\n\t\t}\n\t}\n\tif (sc->sc_drq16 != -1 && sc->sc_drq16 != sc->sc_drq8) {\n\t\tif (isa_dmamap_create(sc->sc_isa, sc->sc_drq16,\n\t\t    MAX_ISADMA, BUS_DMA_NOWAIT|BUS_DMA_ALLOCNOW)) {\n\t\t\tprintf(\"%s: can't create map for drq %d\\n\",\n\t\t\t    sc->sc_dev.dv_xname, sc->sc_drq16);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tpparams = audio_default;\n\trparams = audio_default;\n        sbdsp_set_params(sc, AUMODE_RECORD|AUMODE_PLAY, 0, &pparams, &rparams);\n\n\tsbdsp_set_in_ports(sc, 1 << SB_MIC_VOL);\n\n\tif (sc->sc_mixer_model != SBM_NONE) {\n        \t/* Reset the mixer.*/\n\t\tsbdsp_mix_write(sc, SBP_MIX_RESET, SBP_MIX_RESET);\n                /* And set our own default values */\n\t\tfor (i = 0; i < SB_NDEVS; i++) {\n\t\t\tswitch(i) {\n\t\t\tcase SB_MIC_VOL:\n\t\t\tcase SB_LINE_IN_VOL:\n\t\t\t\tv = 0;\n\t\t\t\tbreak;\n\t\t\tcase SB_BASS:\n\t\t\tcase SB_TREBLE:\n\t\t\t\tv = SB_ADJUST_GAIN(sc, AUDIO_MAX_GAIN/2);\n\t\t\t\tbreak;\n\t\t\tcase SB_CD_IN_MUTE:\n\t\t\tcase SB_MIC_IN_MUTE:\n\t\t\tcase SB_LINE_IN_MUTE:\n\t\t\tcase SB_MIDI_IN_MUTE:\n\t\t\tcase SB_CD_SWAP:\n\t\t\tcase SB_MIC_SWAP:\n\t\t\tcase SB_LINE_SWAP:\n\t\t\tcase SB_MIDI_SWAP:\n\t\t\tcase SB_CD_OUT_MUTE:\n\t\t\tcase SB_MIC_OUT_MUTE:\n\t\t\tcase SB_LINE_OUT_MUTE:\n\t\t\t\tv = 0;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tv = SB_ADJUST_GAIN(sc, AUDIO_MAX_GAIN / 2);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tsc->gain[i][SB_LEFT] = sc->gain[i][SB_RIGHT] = v;\n\t\t\tsbdsp_set_mixer_gain(sc, i);\n\t\t}\n\t\tsc->in_filter = 0;\t/* no filters turned on, please */\n\t}\n\n\tprintf(\": dsp v%d.%02d%s\\n\",\n\t       SBVER_MAJOR(sc->sc_version), SBVER_MINOR(sc->sc_version),\n\t       sc->sc_model == SB_JAZZ ? \": <Jazz16>\" : \"\");\n\n\tsc->sc_fullduplex = ISSB16CLASS(sc) && \n\t\tsc->sc_drq8 != -1 && sc->sc_drq16 != -1 &&\n\t\tsc->sc_drq8 != sc->sc_drq16;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbdsp_set_mixer_gain",
      "int\tsbdsp_set_in_ports"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ISSB16CLASS",
          "args": [
            "sc"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\": dsp v%d.%02d%s\\n\"",
            "SBVER_MAJOR(sc->sc_version)",
            "SBVER_MINOR(sc->sc_version)",
            "sc->sc_model == SB_JAZZ ? \": <Jazz16>\" : \"\""
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "SBVER_MINOR",
          "args": [
            "sc->sc_version"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SBVER_MAJOR",
          "args": [
            "sc->sc_version"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_set_mixer_gain",
          "args": [
            "sc",
            "i"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_mixer_gain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1498-1600",
          "snippet": "void\nsbdsp_set_mixer_gain(sc, port)\n\tstruct sbdsp_softc *sc;\n\tint port;\n{\n\tint src, gain;\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn;\n\tcase SBM_CT1335:\n\t\tgain = SB_1335_GAIN(sc->gain[port][SB_LEFT]);\n\t\tswitch(port) {\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_1335_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_1335_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_1335_CD_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_1335_VOICE_VOL;\n\t\t\tgain = SB_1335_MASTER_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tgain = SB_STEREO_GAIN(sc->gain[port][SB_LEFT],\n\t\t\t\t      sc->gain[port][SB_RIGHT]);\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SBP_MIC_VOL;\n\t\t\tgain = SB_MIC_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SBP_LINE_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_VOICE_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_CD_VOL;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SB16P_MIC_L;\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SB16P_MASTER_L;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SB16P_LINE_L;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SB16P_VOICE_L;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SB16P_MIDI_L;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SB16P_CD_L;\n\t\t\tbreak;\n\t\tcase SB_INPUT_GAIN:\n\t\t\tsrc = SB16P_INPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tsrc = SB16P_OUTPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_TREBLE:\n\t\t\tsrc = SB16P_TREBLE_L;\n\t\t\tbreak;\n\t\tcase SB_BASS:\n\t\t\tsrc = SB16P_BASS_L;\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tsbdsp_mix_write(sc, SB16P_PCSPEAKER, sc->gain[port][SB_LEFT]);\n\t\t\treturn;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, sc->gain[port][SB_LEFT]);\n\t\tsbdsp_mix_write(sc, SB16P_L_TO_R(src), sc->gain[port][SB_RIGHT]);\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbdsp_set_mixer_gain"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_mixer_gain;\n\nvoid\nsbdsp_set_mixer_gain(sc, port)\n\tstruct sbdsp_softc *sc;\n\tint port;\n{\n\tint src, gain;\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn;\n\tcase SBM_CT1335:\n\t\tgain = SB_1335_GAIN(sc->gain[port][SB_LEFT]);\n\t\tswitch(port) {\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_1335_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_1335_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_1335_CD_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_1335_VOICE_VOL;\n\t\t\tgain = SB_1335_MASTER_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tgain = SB_STEREO_GAIN(sc->gain[port][SB_LEFT],\n\t\t\t\t      sc->gain[port][SB_RIGHT]);\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SBP_MIC_VOL;\n\t\t\tgain = SB_MIC_GAIN(sc->gain[port][SB_LEFT]);\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SBP_MASTER_VOL;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SBP_LINE_VOL;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SBP_VOICE_VOL;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SBP_MIDI_VOL;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SBP_CD_VOL;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, gain);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tswitch (port) {\n\t\tcase SB_MIC_VOL:\n\t\t\tsrc = SB16P_MIC_L;\n\t\t\tbreak;\n\t\tcase SB_MASTER_VOL:\n\t\t\tsrc = SB16P_MASTER_L;\n\t\t\tbreak;\n\t\tcase SB_LINE_IN_VOL:\n\t\t\tsrc = SB16P_LINE_L;\n\t\t\tbreak;\n\t\tcase SB_VOICE_VOL:\n\t\t\tsrc = SB16P_VOICE_L;\n\t\t\tbreak;\n\t\tcase SB_MIDI_VOL:\n\t\t\tsrc = SB16P_MIDI_L;\n\t\t\tbreak;\n\t\tcase SB_CD_VOL:\n\t\t\tsrc = SB16P_CD_L;\n\t\t\tbreak;\n\t\tcase SB_INPUT_GAIN:\n\t\t\tsrc = SB16P_INPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_OUTPUT_GAIN:\n\t\t\tsrc = SB16P_OUTPUT_GAIN_L;\n\t\t\tbreak;\n\t\tcase SB_TREBLE:\n\t\t\tsrc = SB16P_TREBLE_L;\n\t\t\tbreak;\n\t\tcase SB_BASS:\n\t\t\tsrc = SB16P_BASS_L;\n\t\t\tbreak;\n\t\tcase SB_PCSPEAKER:\n\t\t\tsbdsp_mix_write(sc, SB16P_PCSPEAKER, sc->gain[port][SB_LEFT]);\n\t\t\treturn;\n\t\tdefault:\n\t\t\treturn;\n\t\t}\n\t\tsbdsp_mix_write(sc, src, sc->gain[port][SB_LEFT]);\n\t\tsbdsp_mix_write(sc, SB16P_L_TO_R(src), sc->gain[port][SB_RIGHT]);\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_GAIN",
          "args": [
            "sc",
            "AUDIO_MAX_GAIN / 2"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SB_ADJUST_GAIN",
          "args": [
            "sc",
            "AUDIO_MAX_GAIN/2"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_mix_write",
          "args": [
            "sc",
            "SBP_MIX_RESET",
            "SBP_MIX_RESET"
          ],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_mix_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "407-423",
          "snippet": "void\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsbdsp_mix_write(sc, mixerport, val)\n\tstruct sbdsp_softc *sc;\n\tint mixerport;\n\tint val;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint s;\n\n\ts = splaudio();\n\tbus_space_write_1(iot, ioh, SBP_MIXER_ADDR, mixerport);\n\tdelay(20);\n\tbus_space_write_1(iot, ioh, SBP_MIXER_DATA, val);\n\tdelay(30);\n\tsplx(s);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_set_in_ports",
          "args": [
            "sc",
            "1 << SB_MIC_VOL"
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_in_ports",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "766-824",
          "snippet": "int\nsbdsp_set_in_ports(sc, mask)\n\tstruct sbdsp_softc *sc;\n\tint mask;\n{\n\tint bitsl, bitsr;\n\tint sbport;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask));\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn EINVAL;\n\tcase SBM_CT1335:\n\t\tif (mask != (1 << SB_MIC_VOL))\n\t\t\treturn EINVAL;\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tswitch (mask) {\n\t\tcase 1 << SB_MIC_VOL:\n\t\t\tsbport = SBP_FROM_MIC;\n\t\t\tbreak;\n\t\tcase 1 << SB_LINE_IN_VOL:\n\t\t\tsbport = SBP_FROM_LINE;\n\t\t\tbreak;\n\t\tcase 1 << SB_CD_VOL:\n\t\t\tsbport = SBP_FROM_CD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn (EINVAL);\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE, sbport | sc->in_filter);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tif (mask & ~((1<<SB_MIDI_VOL) | (1<<SB_LINE_IN_VOL) |\n\t\t\t     (1<<SB_CD_VOL) | (1<<SB_MIC_VOL)))\n\t\t\treturn EINVAL;\n\t\tbitsr = 0;\n\t\tif (mask & (1<<SB_MIDI_VOL))    bitsr |= SBP_MIDI_SRC_R;\n\t\tif (mask & (1<<SB_LINE_IN_VOL)) bitsr |= SBP_LINE_SRC_R;\n\t\tif (mask & (1<<SB_CD_VOL))      bitsr |= SBP_CD_SRC_R;\n\t\tbitsl = SB_SRC_R_TO_L(bitsr);\n\t\tif (mask & (1<<SB_MIC_VOL)) {\n\t\t\tbitsl |= SBP_MIC_SRC;\n\t\t\tbitsr |= SBP_MIC_SRC;\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_L, bitsl);\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_R, bitsr);\n\t\tbreak;\n\t}\n\tsc->in_mask = mask;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int\tsbdsp_set_in_ports"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\tsbdsp_set_in_ports;\n\nint\nsbdsp_set_in_ports(sc, mask)\n\tstruct sbdsp_softc *sc;\n\tint mask;\n{\n\tint bitsl, bitsr;\n\tint sbport;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tDPRINTF((\"sbdsp_set_in_ports: model=%d, mask=%x\\n\",\n\t\t sc->sc_mixer_model, mask));\n\n\tswitch(sc->sc_mixer_model) {\n\tcase SBM_NONE:\n\t\treturn EINVAL;\n\tcase SBM_CT1335:\n\t\tif (mask != (1 << SB_MIC_VOL))\n\t\t\treturn EINVAL;\n\t\tbreak;\n\tcase SBM_CT1345:\n\t\tswitch (mask) {\n\t\tcase 1 << SB_MIC_VOL:\n\t\t\tsbport = SBP_FROM_MIC;\n\t\t\tbreak;\n\t\tcase 1 << SB_LINE_IN_VOL:\n\t\t\tsbport = SBP_FROM_LINE;\n\t\t\tbreak;\n\t\tcase 1 << SB_CD_VOL:\n\t\t\tsbport = SBP_FROM_CD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn (EINVAL);\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE, sbport | sc->in_filter);\n\t\tbreak;\n\tcase SBM_CT1XX5:\n\tcase SBM_CT1745:\n\t\tif (mask & ~((1<<SB_MIDI_VOL) | (1<<SB_LINE_IN_VOL) |\n\t\t\t     (1<<SB_CD_VOL) | (1<<SB_MIC_VOL)))\n\t\t\treturn EINVAL;\n\t\tbitsr = 0;\n\t\tif (mask & (1<<SB_MIDI_VOL))    bitsr |= SBP_MIDI_SRC_R;\n\t\tif (mask & (1<<SB_LINE_IN_VOL)) bitsr |= SBP_LINE_SRC_R;\n\t\tif (mask & (1<<SB_CD_VOL))      bitsr |= SBP_CD_SRC_R;\n\t\tbitsl = SB_SRC_R_TO_L(bitsr);\n\t\tif (mask & (1<<SB_MIC_VOL)) {\n\t\t\tbitsl |= SBP_MIC_SRC;\n\t\t\tbitsr |= SBP_MIC_SRC;\n\t\t}\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_L, bitsl);\n\t\tsbdsp_mix_write(sc, SBP_RECORD_SOURCE_R, bitsr);\n\t\tbreak;\n\t}\n\tsc->in_mask = mask;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_set_params",
          "args": [
            "sc",
            "AUMODE_RECORD|AUMODE_PLAY",
            "0",
            "&pparams",
            "&rparams"
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_set_params",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "518-720",
          "snippet": "int\nsbdsp_set_params(addr, setmode, usemode, play, rec)\n\tvoid *addr;\n\tint setmode, usemode;\n\tstruct audio_params *play, *rec;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tstruct sbmode *m;\n\tu_int rate, tc, bmode;\n\tvoid (*swcode) __P((void *, u_char *buf, int cnt));\n\tint factor;\n\tint model;\n\tint chan;\n\tstruct audio_params *p;\n\tint mode;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tmodel = sc->sc_model;\n\tif (model > SB_16) \n\t\tmodel = SB_16;\t/* later models work like SB16 */\n\n\t/*\n\t * Prior to the SB16, we have only one clock, so make the sample\n\t * rates match.\n\t */\n\tif (!ISSB16CLASS(sc) &&\n\t    play->sample_rate != rec->sample_rate &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD)) {\n\t\tif (setmode == AUMODE_PLAY) {\n\t\t\trec->sample_rate = play->sample_rate;\n\t\t\tsetmode |= AUMODE_RECORD;\n\t\t} else if (setmode == AUMODE_RECORD) {\n\t\t\tplay->sample_rate = rec->sample_rate;\n\t\t\tsetmode |= AUMODE_PLAY;\n\t\t} else\n\t\t\treturn (EINVAL);\n\t}\n\n\t/* Set first record info, then play info */\n\tfor (mode = AUMODE_RECORD; mode != -1; \n\t     mode = mode == AUMODE_RECORD ? AUMODE_PLAY : -1) {\n\t\tif ((setmode & mode) == 0)\n\t\t\tcontinue;\n\n\t\tp = mode == AUMODE_PLAY ? play : rec;\n\t\t/* Locate proper commands */\n\t\tfor(m = mode == AUMODE_PLAY ? sbpmodes : sbrmodes; \n\t\t    m->model != -1; m++) {\n\t\t\tif (model == m->model &&\n\t\t\t    p->channels == m->channels &&\n\t\t\t    p->precision == m->precision &&\n\t\t\t    p->sample_rate >= m->lowrate && \n\t\t\t    p->sample_rate < m->highrate)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (m->model == -1)\n\t\t\treturn EINVAL;\n\t\trate = p->sample_rate;\n\t\tswcode = 0;\n\t\tfactor = 1;\n\t\ttc = 1;\n\t\tbmode = -1;\n\t\tif (model == SB_16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_SIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = mulaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_mulaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = alaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_alaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tif (p->channels == 2)\n\t\t\t\tbmode |= SB_BMODE_STEREO;\n\t\t} else if (m->model == SB_JAZZ && m->precision == 16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tswcode = change_sign16;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tswcode = swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tswcode = mode == AUMODE_PLAY ?\n\t\t\t\t\tswap_bytes_change_sign16 : change_sign16_swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t} else {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tswcode = change_sign8;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t}\n\n\t\tchan = m->precision == 16 ? sc->sc_drq16 : sc->sc_drq8;\n\t\tif (mode == AUMODE_PLAY) {\n\t\t\tsc->sc_o.rate = rate;\n\t\t\tsc->sc_o.tc = tc;\n\t\t\tsc->sc_o.modep = m;\n\t\t\tsc->sc_o.bmode = bmode;\n\t\t\tsc->sc_o.dmachan = chan;\n\t\t} else {\n\t\t\tsc->sc_i.rate = rate;\n\t\t\tsc->sc_i.tc = tc;\n\t\t\tsc->sc_i.modep = m;\n\t\t\tsc->sc_i.bmode = bmode;\n\t\t\tsc->sc_i.dmachan = chan;\n\t\t}\n\n\t\tp->sw_code = swcode;\n\t\tp->factor = factor;\n\t\tDPRINTF((\"sbdsp_set_params: model=%d, mode=%d, rate=%ld, prec=%d, chan=%d, enc=%d -> tc=%02x, cmd=%02x, bmode=%02x, cmdchan=%02x, swcode=%p, factor=%d\\n\", \n\t\t\t sc->sc_model, mode, p->sample_rate, p->precision, p->channels,\n\t\t\t p->encoding, tc, m->cmd, bmode, m->cmdchan, swcode, factor));\n\n\t}\n\n\t/*\n\t * XXX\n\t * Should wait for chip to be idle.\n\t */\n\tsc->sc_i.run = SB_NOTRUNNING;\n\tsc->sc_o.run = SB_NOTRUNNING;\n\n\tif (sc->sc_fullduplex &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD) &&\n\t    sc->sc_i.dmachan == sc->sc_o.dmachan) {\n\t\tDPRINTF((\"sbdsp_set_params: fd=%d, usemode=%d, idma=%d, odma=%d\\n\", sc->sc_fullduplex, usemode, sc->sc_i.dmachan, sc->sc_o.dmachan));\n\t\tif (sc->sc_o.dmachan == sc->sc_drq8) {\n\t\t\t/* Use 16 bit DMA for playing by expanding the samples. */\n\t\t\tplay->sw_code = linear8_to_linear16;\n\t\t\tplay->factor = 2;\n\t\t\tsc->sc_o.modep = &sbpmodes[PLAY16];\n\t\t\tsc->sc_o.dmachan = sc->sc_drq16;\n\t\t} else {\n\t\t\treturn EINVAL;\n\t\t}\n\t}\n\tDPRINTF((\"sbdsp_set_params ichan=%d, ochan=%d\\n\", \n\t\t sc->sc_i.dmachan, sc->sc_o.dmachan));\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static struct sbmode sbpmodes[] = {\n { SB_1,    1,  8,  4000, 22727, SB_DSP_WDMA      },\n { SB_20,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_OUTPUT },\n /* Yes, we write the record mode to set 16-bit playback mode. weird, huh? */\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_WDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_WDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n#define PLAY16 15 /* must be the index of the next entry in the table */\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { -1 }\n};",
            "static struct sbmode sbrmodes[] = {\n { SB_1,    1,  8,  4000, 12987, SB_DSP_RDMA      },\n { SB_20,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8, 12987, 14925, SB_DSP_HS_INPUT  },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_RDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_INPUT,  JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_INPUT,  JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { -1 }\n};",
            "__P((int, int));",
            "void *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nstatic struct sbmode sbpmodes[] = {\n { SB_1,    1,  8,  4000, 22727, SB_DSP_WDMA      },\n { SB_20,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_2x,   1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_WDMA_LOOP },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_OUTPUT },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_OUTPUT },\n /* Yes, we write the record mode to set 16-bit playback mode. weird, huh? */\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_WDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_OUTPUT, SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_WDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_OUTPUT, JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_WDMA_8  },\n#define PLAY16 15 /* must be the index of the next entry in the table */\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_WDMA_16 },\n { -1 }\n};\nstatic struct sbmode sbrmodes[] = {\n { SB_1,    1,  8,  4000, 12987, SB_DSP_RDMA      },\n { SB_20,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8,  4000, 12987, SB_DSP_RDMA_LOOP },\n { SB_2x,   1,  8, 12987, 14925, SB_DSP_HS_INPUT  },\n { SB_PRO,  1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_PRO,  1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_PRO,  2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1,  8,  4000, 22727, SB_DSP_RDMA_LOOP, SB_DSP_RECORD_MONO },\n { SB_JAZZ, 1,  8, 22727, 45454, SB_DSP_HS_INPUT,  SB_DSP_RECORD_MONO },\n { SB_JAZZ, 2,  8, 11025, 22727, SB_DSP_HS_INPUT,  SB_DSP_RECORD_STEREO },\n { SB_JAZZ, 1, 16,  4000, 22727, SB_DSP_RDMA_LOOP, JAZZ16_RECORD_MONO },\n { SB_JAZZ, 1, 16, 22727, 45454, SB_DSP_HS_INPUT,  JAZZ16_RECORD_MONO },\n { SB_JAZZ, 2, 16, 11025, 22727, SB_DSP_HS_INPUT,  JAZZ16_RECORD_STEREO },\n { SB_16,   1,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   2,  8,  5000, 45000, SB_DSP16_RDMA_8  },\n { SB_16,   1, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { SB_16,   2, 16,  5000, 45000, SB_DSP16_RDMA_16 },\n { -1 }\n};\n__P((int, int));\nvoid *\nsb_malloc(addr, size, pool, flags)\n\tvoid *addr;\n\nint\nsbdsp_set_params(addr, setmode, usemode, play, rec)\n\tvoid *addr;\n\tint setmode, usemode;\n\tstruct audio_params *play, *rec;\n{\n\tstruct sbdsp_softc *sc = addr;\n\tstruct sbmode *m;\n\tu_int rate, tc, bmode;\n\tvoid (*swcode) __P((void *, u_char *buf, int cnt));\n\tint factor;\n\tint model;\n\tint chan;\n\tstruct audio_params *p;\n\tint mode;\n\n\tif (sc->sc_open == SB_OPEN_MIDI)\n\t\treturn EBUSY;\n\n\tmodel = sc->sc_model;\n\tif (model > SB_16) \n\t\tmodel = SB_16;\t/* later models work like SB16 */\n\n\t/*\n\t * Prior to the SB16, we have only one clock, so make the sample\n\t * rates match.\n\t */\n\tif (!ISSB16CLASS(sc) &&\n\t    play->sample_rate != rec->sample_rate &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD)) {\n\t\tif (setmode == AUMODE_PLAY) {\n\t\t\trec->sample_rate = play->sample_rate;\n\t\t\tsetmode |= AUMODE_RECORD;\n\t\t} else if (setmode == AUMODE_RECORD) {\n\t\t\tplay->sample_rate = rec->sample_rate;\n\t\t\tsetmode |= AUMODE_PLAY;\n\t\t} else\n\t\t\treturn (EINVAL);\n\t}\n\n\t/* Set first record info, then play info */\n\tfor (mode = AUMODE_RECORD; mode != -1; \n\t     mode = mode == AUMODE_RECORD ? AUMODE_PLAY : -1) {\n\t\tif ((setmode & mode) == 0)\n\t\t\tcontinue;\n\n\t\tp = mode == AUMODE_PLAY ? play : rec;\n\t\t/* Locate proper commands */\n\t\tfor(m = mode == AUMODE_PLAY ? sbpmodes : sbrmodes; \n\t\t    m->model != -1; m++) {\n\t\t\tif (model == m->model &&\n\t\t\t    p->channels == m->channels &&\n\t\t\t    p->precision == m->precision &&\n\t\t\t    p->sample_rate >= m->lowrate && \n\t\t\t    p->sample_rate < m->highrate)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (m->model == -1)\n\t\t\treturn EINVAL;\n\t\trate = p->sample_rate;\n\t\tswcode = 0;\n\t\tfactor = 1;\n\t\ttc = 1;\n\t\tbmode = -1;\n\t\tif (model == SB_16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_SIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tif (p->precision == 16)\n\t\t\t\t\tswcode = swap_bytes;\n\t\t\t\t/* fall into */\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = mulaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_mulaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tif (mode == AUMODE_PLAY) {\n\t\t\t\t\tswcode = alaw_to_ulinear16;\n\t\t\t\t\tfactor = 2;\n\t\t\t\t\tm = &sbpmodes[PLAY16];\n\t\t\t\t} else\n\t\t\t\t\tswcode = ulinear8_to_alaw;\n\t\t\t\tbmode = SB_BMODE_UNSIGNED;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\tif (p->channels == 2)\n\t\t\t\tbmode |= SB_BMODE_STEREO;\n\t\t} else if (m->model == SB_JAZZ && m->precision == 16) {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tswcode = change_sign16;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\t\tswcode = swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\t\tswcode = mode == AUMODE_PLAY ?\n\t\t\t\t\tswap_bytes_change_sign16 : change_sign16_swap_bytes;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t} else {\n\t\t\tswitch (p->encoding) {\n\t\t\tcase AUDIO_ENCODING_SLINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_SLINEAR_LE:\n\t\t\t\tswcode = change_sign8;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULINEAR_BE:\n\t\t\tcase AUDIO_ENCODING_ULINEAR_LE:\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ULAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\tmulaw_to_ulinear8 : ulinear8_to_mulaw;\n\t\t\t\tbreak;\n\t\t\tcase AUDIO_ENCODING_ALAW:\n\t\t\t\tswcode = mode == AUMODE_PLAY ? \n\t\t\t\t\talaw_to_ulinear8 : ulinear8_to_alaw;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn EINVAL;\n\t\t\t}\n\t\t\ttc = SB_RATE_TO_TC(p->sample_rate * p->channels);\n\t\t\tp->sample_rate = SB_TC_TO_RATE(tc) / p->channels;\n\t\t}\n\n\t\tchan = m->precision == 16 ? sc->sc_drq16 : sc->sc_drq8;\n\t\tif (mode == AUMODE_PLAY) {\n\t\t\tsc->sc_o.rate = rate;\n\t\t\tsc->sc_o.tc = tc;\n\t\t\tsc->sc_o.modep = m;\n\t\t\tsc->sc_o.bmode = bmode;\n\t\t\tsc->sc_o.dmachan = chan;\n\t\t} else {\n\t\t\tsc->sc_i.rate = rate;\n\t\t\tsc->sc_i.tc = tc;\n\t\t\tsc->sc_i.modep = m;\n\t\t\tsc->sc_i.bmode = bmode;\n\t\t\tsc->sc_i.dmachan = chan;\n\t\t}\n\n\t\tp->sw_code = swcode;\n\t\tp->factor = factor;\n\t\tDPRINTF((\"sbdsp_set_params: model=%d, mode=%d, rate=%ld, prec=%d, chan=%d, enc=%d -> tc=%02x, cmd=%02x, bmode=%02x, cmdchan=%02x, swcode=%p, factor=%d\\n\", \n\t\t\t sc->sc_model, mode, p->sample_rate, p->precision, p->channels,\n\t\t\t p->encoding, tc, m->cmd, bmode, m->cmdchan, swcode, factor));\n\n\t}\n\n\t/*\n\t * XXX\n\t * Should wait for chip to be idle.\n\t */\n\tsc->sc_i.run = SB_NOTRUNNING;\n\tsc->sc_o.run = SB_NOTRUNNING;\n\n\tif (sc->sc_fullduplex &&\n\t    usemode == (AUMODE_PLAY | AUMODE_RECORD) &&\n\t    sc->sc_i.dmachan == sc->sc_o.dmachan) {\n\t\tDPRINTF((\"sbdsp_set_params: fd=%d, usemode=%d, idma=%d, odma=%d\\n\", sc->sc_fullduplex, usemode, sc->sc_i.dmachan, sc->sc_o.dmachan));\n\t\tif (sc->sc_o.dmachan == sc->sc_drq8) {\n\t\t\t/* Use 16 bit DMA for playing by expanding the samples. */\n\t\t\tplay->sw_code = linear8_to_linear16;\n\t\t\tplay->factor = 2;\n\t\t\tsc->sc_o.modep = &sbpmodes[PLAY16];\n\t\t\tsc->sc_o.dmachan = sc->sc_drq16;\n\t\t} else {\n\t\t\treturn EINVAL;\n\t\t}\n\t}\n\tDPRINTF((\"sbdsp_set_params ichan=%d, ochan=%d\\n\", \n\t\t sc->sc_i.dmachan, sc->sc_o.dmachan));\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "isa_dmamap_create",
          "args": [
            "sc->sc_isa",
            "sc->sc_drq16",
            "MAX_ISADMA",
            "BUS_DMA_NOWAIT|BUS_DMA_ALLOCNOW"
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "isa_dmamap_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/isadma.c",
          "lines": "220-255",
          "snippet": "int\nisa_dmamap_create(isadev, chan, size, flags)\n\tstruct device *isadev;\n\tint chan;\n\tbus_size_t size;\n\tint flags;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\tbus_size_t maxsize;\n\n\tif (chan < 0 || chan > 7) {\n\t\tprintf(\"%s: bogus drq %d\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n\tif (chan & 4)\n\t\tmaxsize = (1 << 17);\n\telse\n\t\tmaxsize = (1 << 16);\n\n\tif (size > maxsize)\n\t\treturn (EINVAL);\n\n\tif (ISA_DRQ_ISFREE(sc, chan) == 0) {\n\t\tprintf(\"%s: drq %d is not free\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n\tISA_DRQ_ALLOC(sc, chan);\n\n\treturn (bus_dmamap_create(sc->sc_dmat, size, 1, size, maxsize,\n\t    flags, &sc->sc_dmamaps[chan]));\n\n lose:\n\tpanic(\"isa_dmamap_create\");\n}",
          "includes": [
            "#include <sys/malloc.h>",
            "#include <dev/isa/isadmareg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/isa/isareg.h>",
            "#include <machine/bus.h>",
            "#include <vm/vm.h>",
            "#include <sys/device.h>",
            "#include <sys/proc.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;",
            "int chan;",
            "size_t size;",
            "int flags;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/malloc.h>\n#include <dev/isa/isadmareg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/isa/isareg.h>\n#include <machine/bus.h>\n#include <vm/vm.h>\n#include <sys/device.h>\n#include <sys/proc.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nvoid *\nisa_malloc(isadev, chan, size, pool, flags)\n\tstruct device *isadev;\nint chan;\nsize_t size;\nint flags;\n\nint\nisa_dmamap_create(isadev, chan, size, flags)\n\tstruct device *isadev;\n\tint chan;\n\tbus_size_t size;\n\tint flags;\n{\n\tstruct isa_softc *sc = (struct isa_softc *)isadev;\n\tbus_size_t maxsize;\n\n\tif (chan < 0 || chan > 7) {\n\t\tprintf(\"%s: bogus drq %d\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n\tif (chan & 4)\n\t\tmaxsize = (1 << 17);\n\telse\n\t\tmaxsize = (1 << 16);\n\n\tif (size > maxsize)\n\t\treturn (EINVAL);\n\n\tif (ISA_DRQ_ISFREE(sc, chan) == 0) {\n\t\tprintf(\"%s: drq %d is not free\\n\", sc->sc_dev.dv_xname, chan);\n\t\tgoto lose;\n\t}\n\n\tISA_DRQ_ALLOC(sc, chan);\n\n\treturn (bus_dmamap_create(sc->sc_dmat, size, 1, size, maxsize,\n\t    flags, &sc->sc_dmamaps[chan]));\n\n lose:\n\tpanic(\"isa_dmamap_create\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbdsp_set_mixer_gain;\nint\tsbdsp_set_in_ports;\n\nvoid\nsbdsp_attach(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tstruct audio_params pparams, rparams;\n        int i;\n        u_int v;\n\n\t/*\n\t * Create our DMA maps.\n\t */\n\tif (sc->sc_drq8 != -1) {\n\t\tif (isa_dmamap_create(sc->sc_isa, sc->sc_drq8,\n\t\t    MAX_ISADMA, BUS_DMA_NOWAIT|BUS_DMA_ALLOCNOW)) {\n\t\t\tprintf(\"%s: can't create map for drq %d\\n\",\n\t\t\t    sc->sc_dev.dv_xname, sc->sc_drq8);\n\t\t\treturn;\n\t\t}\n\t}\n\tif (sc->sc_drq16 != -1 && sc->sc_drq16 != sc->sc_drq8) {\n\t\tif (isa_dmamap_create(sc->sc_isa, sc->sc_drq16,\n\t\t    MAX_ISADMA, BUS_DMA_NOWAIT|BUS_DMA_ALLOCNOW)) {\n\t\t\tprintf(\"%s: can't create map for drq %d\\n\",\n\t\t\t    sc->sc_dev.dv_xname, sc->sc_drq16);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tpparams = audio_default;\n\trparams = audio_default;\n        sbdsp_set_params(sc, AUMODE_RECORD|AUMODE_PLAY, 0, &pparams, &rparams);\n\n\tsbdsp_set_in_ports(sc, 1 << SB_MIC_VOL);\n\n\tif (sc->sc_mixer_model != SBM_NONE) {\n        \t/* Reset the mixer.*/\n\t\tsbdsp_mix_write(sc, SBP_MIX_RESET, SBP_MIX_RESET);\n                /* And set our own default values */\n\t\tfor (i = 0; i < SB_NDEVS; i++) {\n\t\t\tswitch(i) {\n\t\t\tcase SB_MIC_VOL:\n\t\t\tcase SB_LINE_IN_VOL:\n\t\t\t\tv = 0;\n\t\t\t\tbreak;\n\t\t\tcase SB_BASS:\n\t\t\tcase SB_TREBLE:\n\t\t\t\tv = SB_ADJUST_GAIN(sc, AUDIO_MAX_GAIN/2);\n\t\t\t\tbreak;\n\t\t\tcase SB_CD_IN_MUTE:\n\t\t\tcase SB_MIC_IN_MUTE:\n\t\t\tcase SB_LINE_IN_MUTE:\n\t\t\tcase SB_MIDI_IN_MUTE:\n\t\t\tcase SB_CD_SWAP:\n\t\t\tcase SB_MIC_SWAP:\n\t\t\tcase SB_LINE_SWAP:\n\t\t\tcase SB_MIDI_SWAP:\n\t\t\tcase SB_CD_OUT_MUTE:\n\t\t\tcase SB_MIC_OUT_MUTE:\n\t\t\tcase SB_LINE_OUT_MUTE:\n\t\t\t\tv = 0;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tv = SB_ADJUST_GAIN(sc, AUDIO_MAX_GAIN / 2);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tsc->gain[i][SB_LEFT] = sc->gain[i][SB_RIGHT] = v;\n\t\t\tsbdsp_set_mixer_gain(sc, i);\n\t\t}\n\t\tsc->in_filter = 0;\t/* no filters turned on, please */\n\t}\n\n\tprintf(\": dsp v%d.%02d%s\\n\",\n\t       SBVER_MAJOR(sc->sc_version), SBVER_MINOR(sc->sc_version),\n\t       sc->sc_model == SB_JAZZ ? \": <Jazz16>\" : \"\");\n\n\tsc->sc_fullduplex = ISSB16CLASS(sc) && \n\t\tsc->sc_drq8 != -1 && sc->sc_drq16 != -1 &&\n\t\tsc->sc_drq8 != sc->sc_drq16;\n}"
  },
  {
    "function_name": "sbdsp_jazz16_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "255-321",
    "snippet": "void\nsbdsp_jazz16_probe(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tstatic u_char jazz16_irq_conf[16] = {\n\t    -1, -1, 0x02, 0x03,\n\t    -1, 0x01, -1, 0x04,\n\t    -1, 0x02, 0x05, -1,\n\t    -1, -1, -1, 0x06};\n\tstatic u_char jazz16_drq_conf[8] = {\n\t    -1, 0x01, -1, 0x02,\n\t    -1, 0x03, -1, 0x04};\n\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh;\n\n\tsbversion(sc);\n\n\tDPRINTF((\"jazz16 probe\\n\"));\n\n\tif (bus_space_map(iot, JAZZ16_CONFIG_PORT, 1, 0, &ioh)) {\n\t\tDPRINTF((\"bus map failed\\n\"));\n\t\treturn;\n\t}\n\n\tif (jazz16_drq_conf[sc->sc_drq8] == (u_char)-1 ||\n\t    jazz16_irq_conf[sc->sc_irq] == (u_char)-1) {\n\t\tDPRINTF((\"drq/irq check failed\\n\"));\n\t\tgoto done;\t\t/* give up, we can't do it. */\n\t}\n\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_WAKEUP);\n\tdelay(10000);\t\t\t/* delay 10 ms */\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_SETBASE);\n\tbus_space_write_1(iot, ioh, 0, sc->sc_iobase & 0x70);\n\n\tif (sbdsp_reset(sc) < 0) {\n\t\tDPRINTF((\"sbdsp_reset check failed\\n\"));\n\t\tgoto done;\t\t/* XXX? what else could we do? */\n\t}\n\n\tif (sbdsp_wdsp(sc, JAZZ16_READ_VER)) {\n\t\tDPRINTF((\"read16 setup failed\\n\"));\n\t\tgoto done;\n\t}\n\n\tif (sbdsp_rdsp(sc) != JAZZ16_VER_JAZZ) {\n\t\tDPRINTF((\"read16 failed\\n\"));\n\t\tgoto done;\n\t}\n\n\t/* XXX set both 8 & 16-bit drq to same channel, it works fine. */\n\tsc->sc_drq16 = sc->sc_drq8;\n\tif (sbdsp_wdsp(sc, JAZZ16_SET_DMAINTR) ||\n\t    sbdsp_wdsp(sc, (jazz16_drq_conf[sc->sc_drq16] << 4) |\n\t\tjazz16_drq_conf[sc->sc_drq8]) ||\n\t    sbdsp_wdsp(sc, jazz16_irq_conf[sc->sc_irq])) {\n\t\tDPRINTF((\"sbdsp: can't write jazz16 probe stuff\\n\"));\n\t} else {\n\t\tDPRINTF((\"jazz16 detected!\\n\"));\n\t\tsc->sc_model = SB_JAZZ;\n\t\tsc->sc_mixer_model = SBM_CT1345; /* XXX really? */\n\t}\n\ndone:\n\tbus_space_unmap(iot, ioh, 1);\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbversion",
      "void\tsbdsp_jazz16_probe"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_unmap",
          "args": [
            "iot",
            "ioh",
            "1"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"jazz16 detected!\\n\")"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp: can't write jazz16 probe stuff\\n\")"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_wdsp",
          "args": [
            "sc",
            "jazz16_irq_conf[sc->sc_irq]"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_wdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "956-977",
          "snippet": "int\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_wdsp(sc, v)\n\tstruct sbdsp_softc *sc;\n\tint v;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_WSTAT);\n\t\tdelay(10);\n\t\tif ((x & SB_DSP_BUSY) == 0) {\n\t\t\tbus_space_write_1(iot, ioh, SBP_DSP_WRITE, v);\n\t\t\tdelay(10);\n\t\t\treturn 0;\n\t\t}\n\t}\n\t++sberr.wdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"read16 failed\\n\")"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_rdsp",
          "args": [
            "sc"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_rdsp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "982-1002",
          "snippet": "int\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [
            "#define SBDSP_NPOLL 3000"
          ],
          "globals_used": [
            "struct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\n#define SBDSP_NPOLL 3000\n\nstruct {\n\tint wdsp;\n\tint rdsp;\n\tint wmidi;\n} sberr;\n\nint\nsbdsp_rdsp(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\tint i;\n\tu_char x;\n\n\tfor (i = SBDSP_NPOLL; --i >= 0; ) {\n\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_RSTAT);\n\t\tdelay(10);\n\t\tif (x & SB_DSP_READY) {\n\t\t\tx = bus_space_read_1(iot, ioh, SBP_DSP_READ);\n\t\t\tdelay(10);\n\t\t\treturn x;\n\t\t}\n\t}\n\t++sberr.rdsp;\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"read16 setup failed\\n\")"
          ],
          "line": 297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp_reset check failed\\n\")"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_reset",
          "args": [
            "sc"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "918-949",
          "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "0",
            "sc->sc_iobase & 0x70"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "0",
            "JAZZ16_SETBASE"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delay",
          "args": [
            "10000"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "lmc_delay_300ns",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/pci/if_lmc.c",
          "lines": "217-223",
          "snippet": "static inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}",
          "includes": [
            "#include \"i386/pci/if_lmcvar.h\"",
            "#include \"i386/pci/if_lmcioctl.h\"",
            "#include \"i386/pci/if_lmctypes.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"",
            "#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"",
            "#include <dev/ic/dc21040reg.h>",
            "#include <dev/pci/pcivar.h>",
            "#include <dev/pci/pcireg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <i386/pci/pci.h>",
            "#include <i386/isa/isavar.h>",
            "#include <i386/isa/dma.h>",
            "#include <i386/isa/icu.h>",
            "#include <i386/isa/isa.h>",
            "#include <i386/pci/ic/dc21040.h>",
            "#include <pci/dc21040reg.h>",
            "#include <pci/pcivar.h>",
            "#include <pci.h>",
            "#include <vm/pmap.h>",
            "#include <net/if_c_hdlc.h>",
            "#include <net/if_p2p.h>",
            "#include <net/if_types.h>",
            "#include <net/netisr.h>",
            "#include <net/if.h>",
            "#include <net/netisr.h>",
            "#include <netinet/ip.h>",
            "#include <netinet/in_systm.h>",
            "#include <netinet/in.h>",
            "#include <net/if_sppp.h>",
            "#include <vm/vm_kern.h>",
            "#include <vm/vm_param.h>",
            "#include <vm/vm.h>",
            "#include <net/bpfdesc.h>",
            "#include <net/bpf.h>",
            "#include \"bpfilter.h\"",
            "#include <net/netisr.h>",
            "#include <net/if_dl.h>",
            "#include <net/if_types.h>",
            "#include <net/if.h>",
            "#include <sys/rnd.h>",
            "#include \"rnd.h\"",
            "#include <dev/pci/pcidevs.h>",
            "#include <dev/pci/pcidevs.h>",
            "#include <sys/device.h>",
            "#include <machine/clock.h>",
            "#include <sys/proc.h>",
            "#include <sys/kernel.h>",
            "#include <sys/malloc.h>",
            "#include <sys/errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <sys/mbuf.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void lmc_rx_intr(lmc_softc_t * const sc);",
            "static void lmc_ifup(lmc_softc_t * const sc);",
            "static void lmc_ifdown(lmc_softc_t * const sc);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"i386/pci/if_lmcvar.h\"\n#include \"i386/pci/if_lmcioctl.h\"\n#include \"i386/pci/if_lmctypes.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcvar.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmcioctl.h\"\n#include INCLUDE_PATH_PREFIX \"if_lmc_types.h\"\n#include <dev/ic/dc21040reg.h>\n#include <dev/pci/pcivar.h>\n#include <dev/pci/pcireg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <i386/pci/pci.h>\n#include <i386/isa/isavar.h>\n#include <i386/isa/dma.h>\n#include <i386/isa/icu.h>\n#include <i386/isa/isa.h>\n#include <i386/pci/ic/dc21040.h>\n#include <pci/dc21040reg.h>\n#include <pci/pcivar.h>\n#include <pci.h>\n#include <vm/pmap.h>\n#include <net/if_c_hdlc.h>\n#include <net/if_p2p.h>\n#include <net/if_types.h>\n#include <net/netisr.h>\n#include <net/if.h>\n#include <net/netisr.h>\n#include <netinet/ip.h>\n#include <netinet/in_systm.h>\n#include <netinet/in.h>\n#include <net/if_sppp.h>\n#include <vm/vm_kern.h>\n#include <vm/vm_param.h>\n#include <vm/vm.h>\n#include <net/bpfdesc.h>\n#include <net/bpf.h>\n#include \"bpfilter.h\"\n#include <net/netisr.h>\n#include <net/if_dl.h>\n#include <net/if_types.h>\n#include <net/if.h>\n#include <sys/rnd.h>\n#include \"rnd.h\"\n#include <dev/pci/pcidevs.h>\n#include <dev/pci/pcidevs.h>\n#include <sys/device.h>\n#include <machine/clock.h>\n#include <sys/proc.h>\n#include <sys/kernel.h>\n#include <sys/malloc.h>\n#include <sys/errno.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <sys/mbuf.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nstatic void lmc_rx_intr(lmc_softc_t * const sc);\nstatic void lmc_ifup(lmc_softc_t * const sc);\nstatic void lmc_ifdown(lmc_softc_t * const sc);\n\nstatic inline void\nlmc_delay_300ns(lmc_softc_t * const sc)\n{\n\tint idx;\n\tfor (idx = (300 / 33) + 1; idx > 0; idx--)\n\t\t(void)LMC_CSR_READ(sc, csr_busmode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "ioh",
            "0",
            "JAZZ16_WAKEUP"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"drq/irq check failed\\n\")"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"bus map failed\\n\")"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "JAZZ16_CONFIG_PORT",
            "1",
            "0",
            "&ioh"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"jazz16 probe\\n\")"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbversion",
          "args": [
            "sc"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "sbversion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1058-1120",
          "snippet": "void\nsbversion(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint v;\n\n\tsc->sc_model = SB_UNK;\n\tsc->sc_version = 0;\n\tif (sbdsp_wdsp(sc, SB_DSP_VERSION) < 0)\n\t\treturn;\n\tv = sbdsp_rdsp(sc) << 8;\n\tv |= sbdsp_rdsp(sc);\n\tif (v < 0)\n\t\treturn;\n\tsc->sc_version = v;\n\tswitch(SBVER_MAJOR(v)) {\n\tcase 1:\n\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tsc->sc_model = SB_1;\n\t\tbreak;\n\tcase 2:\n\t\t/* Some SB2 have a mixer, some don't. */\n\t\tsbdsp_mix_write(sc, SBP_1335_MASTER_VOL, 0x04);\n\t\tsbdsp_mix_write(sc, SBP_1335_MIDI_VOL,   0x06);\n\t\t/* Check if we can read back the mixer values. */\n\t\tif ((sbdsp_mix_read(sc, SBP_1335_MASTER_VOL) & 0x0e) == 0x04 &&\n\t\t    (sbdsp_mix_read(sc, SBP_1335_MIDI_VOL)   & 0x0e) == 0x06)\n\t\t\tsc->sc_mixer_model = SBM_CT1335;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tif (SBVER_MINOR(v) == 0)\n\t\t\tsc->sc_model = SB_20;\n\t\telse\n\t\t\tsc->sc_model = SB_2x;\n\t\tbreak;\n\tcase 3:\n\t\tsc->sc_mixer_model = SBM_CT1345;\n\t\tsc->sc_model = SB_PRO;\n\t\tbreak;\n\tcase 4:\n#if 0\n/* XXX This does not work */\n\t\t/* Most SB16 have a tone controls, but some don't. */\n\t\tsbdsp_mix_write(sc, SB16P_TREBLE_L, 0x80);\n\t\t/* Check if we can read back the mixer value. */\n\t\tif ((sbdsp_mix_read(sc, SB16P_TREBLE_L) & 0xf0) == 0x80)\n\t\t\tsc->sc_mixer_model = SBM_CT1745;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_CT1XX5;\n#else\n\t\tsc->sc_mixer_model = SBM_CT1745;\n#endif\n#if 0\n/* XXX figure out a good way of determining the model */\n\t\t/* XXX what about SB_32 */\n\t\tif (SBVER_MINOR(v) == 16)\n\t\t\tsc->sc_model = SB_64;\n\t\telse\n#endif\n\t\t\tsc->sc_model = SB_16;\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbversion"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbversion;\n\nvoid\nsbversion(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint v;\n\n\tsc->sc_model = SB_UNK;\n\tsc->sc_version = 0;\n\tif (sbdsp_wdsp(sc, SB_DSP_VERSION) < 0)\n\t\treturn;\n\tv = sbdsp_rdsp(sc) << 8;\n\tv |= sbdsp_rdsp(sc);\n\tif (v < 0)\n\t\treturn;\n\tsc->sc_version = v;\n\tswitch(SBVER_MAJOR(v)) {\n\tcase 1:\n\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tsc->sc_model = SB_1;\n\t\tbreak;\n\tcase 2:\n\t\t/* Some SB2 have a mixer, some don't. */\n\t\tsbdsp_mix_write(sc, SBP_1335_MASTER_VOL, 0x04);\n\t\tsbdsp_mix_write(sc, SBP_1335_MIDI_VOL,   0x06);\n\t\t/* Check if we can read back the mixer values. */\n\t\tif ((sbdsp_mix_read(sc, SBP_1335_MASTER_VOL) & 0x0e) == 0x04 &&\n\t\t    (sbdsp_mix_read(sc, SBP_1335_MIDI_VOL)   & 0x0e) == 0x06)\n\t\t\tsc->sc_mixer_model = SBM_CT1335;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tif (SBVER_MINOR(v) == 0)\n\t\t\tsc->sc_model = SB_20;\n\t\telse\n\t\t\tsc->sc_model = SB_2x;\n\t\tbreak;\n\tcase 3:\n\t\tsc->sc_mixer_model = SBM_CT1345;\n\t\tsc->sc_model = SB_PRO;\n\t\tbreak;\n\tcase 4:\n#if 0\n/* XXX This does not work */\n\t\t/* Most SB16 have a tone controls, but some don't. */\n\t\tsbdsp_mix_write(sc, SB16P_TREBLE_L, 0x80);\n\t\t/* Check if we can read back the mixer value. */\n\t\tif ((sbdsp_mix_read(sc, SB16P_TREBLE_L) & 0xf0) == 0x80)\n\t\t\tsc->sc_mixer_model = SBM_CT1745;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_CT1XX5;\n#else\n\t\tsc->sc_mixer_model = SBM_CT1745;\n#endif\n#if 0\n/* XXX figure out a good way of determining the model */\n\t\t/* XXX what about SB_32 */\n\t\tif (SBVER_MINOR(v) == 16)\n\t\t\tsc->sc_model = SB_64;\n\t\telse\n#endif\n\t\t\tsc->sc_model = SB_16;\n\t\tbreak;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbversion;\nvoid\tsbdsp_jazz16_probe;\n\nvoid\nsbdsp_jazz16_probe(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tstatic u_char jazz16_irq_conf[16] = {\n\t    -1, -1, 0x02, 0x03,\n\t    -1, 0x01, -1, 0x04,\n\t    -1, 0x02, 0x05, -1,\n\t    -1, -1, -1, 0x06};\n\tstatic u_char jazz16_drq_conf[8] = {\n\t    -1, 0x01, -1, 0x02,\n\t    -1, 0x03, -1, 0x04};\n\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh;\n\n\tsbversion(sc);\n\n\tDPRINTF((\"jazz16 probe\\n\"));\n\n\tif (bus_space_map(iot, JAZZ16_CONFIG_PORT, 1, 0, &ioh)) {\n\t\tDPRINTF((\"bus map failed\\n\"));\n\t\treturn;\n\t}\n\n\tif (jazz16_drq_conf[sc->sc_drq8] == (u_char)-1 ||\n\t    jazz16_irq_conf[sc->sc_irq] == (u_char)-1) {\n\t\tDPRINTF((\"drq/irq check failed\\n\"));\n\t\tgoto done;\t\t/* give up, we can't do it. */\n\t}\n\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_WAKEUP);\n\tdelay(10000);\t\t\t/* delay 10 ms */\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_SETBASE);\n\tbus_space_write_1(iot, ioh, 0, sc->sc_iobase & 0x70);\n\n\tif (sbdsp_reset(sc) < 0) {\n\t\tDPRINTF((\"sbdsp_reset check failed\\n\"));\n\t\tgoto done;\t\t/* XXX? what else could we do? */\n\t}\n\n\tif (sbdsp_wdsp(sc, JAZZ16_READ_VER)) {\n\t\tDPRINTF((\"read16 setup failed\\n\"));\n\t\tgoto done;\n\t}\n\n\tif (sbdsp_rdsp(sc) != JAZZ16_VER_JAZZ) {\n\t\tDPRINTF((\"read16 failed\\n\"));\n\t\tgoto done;\n\t}\n\n\t/* XXX set both 8 & 16-bit drq to same channel, it works fine. */\n\tsc->sc_drq16 = sc->sc_drq8;\n\tif (sbdsp_wdsp(sc, JAZZ16_SET_DMAINTR) ||\n\t    sbdsp_wdsp(sc, (jazz16_drq_conf[sc->sc_drq16] << 4) |\n\t\tjazz16_drq_conf[sc->sc_drq8]) ||\n\t    sbdsp_wdsp(sc, jazz16_irq_conf[sc->sc_irq])) {\n\t\tDPRINTF((\"sbdsp: can't write jazz16 probe stuff\\n\"));\n\t} else {\n\t\tDPRINTF((\"jazz16 detected!\\n\"));\n\t\tsc->sc_model = SB_JAZZ;\n\t\tsc->sc_mixer_model = SBM_CT1345; /* XXX really? */\n\t}\n\ndone:\n\tbus_space_unmap(iot, ioh, 1);\n}"
  },
  {
    "function_name": "sbdsp_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "230-250",
    "snippet": "int\nsbdsp_probe(sc)\n\tstruct sbdsp_softc *sc;\n{\n\n\tif (sbdsp_reset(sc) < 0) {\n\t\tDPRINTF((\"sbdsp: couldn't reset card\\n\"));\n\t\treturn 0;\n\t}\n\t/* if flags set, go and probe the jazz16 stuff */\n\tif (sc->sc_dev.dv_cfdata->cf_flags & 1)\n\t\tsbdsp_jazz16_probe(sc);\n\telse\n\t\tsbversion(sc);\n\tif (sc->sc_model == SB_UNK) {\n\t\t/* Unknown SB model found. */\n\t\tDPRINTF((\"sbdsp: unknown SB model found\\n\"));\n\t\treturn 0;\n\t}\n\treturn 1;\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void\tsbversion",
      "void\tsbdsp_jazz16_probe",
      "int flags;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp: unknown SB model found\\n\")"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbversion",
          "args": [
            "sc"
          ],
          "line": 243
        },
        "resolved": true,
        "details": {
          "function_name": "sbversion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "1058-1120",
          "snippet": "void\nsbversion(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint v;\n\n\tsc->sc_model = SB_UNK;\n\tsc->sc_version = 0;\n\tif (sbdsp_wdsp(sc, SB_DSP_VERSION) < 0)\n\t\treturn;\n\tv = sbdsp_rdsp(sc) << 8;\n\tv |= sbdsp_rdsp(sc);\n\tif (v < 0)\n\t\treturn;\n\tsc->sc_version = v;\n\tswitch(SBVER_MAJOR(v)) {\n\tcase 1:\n\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tsc->sc_model = SB_1;\n\t\tbreak;\n\tcase 2:\n\t\t/* Some SB2 have a mixer, some don't. */\n\t\tsbdsp_mix_write(sc, SBP_1335_MASTER_VOL, 0x04);\n\t\tsbdsp_mix_write(sc, SBP_1335_MIDI_VOL,   0x06);\n\t\t/* Check if we can read back the mixer values. */\n\t\tif ((sbdsp_mix_read(sc, SBP_1335_MASTER_VOL) & 0x0e) == 0x04 &&\n\t\t    (sbdsp_mix_read(sc, SBP_1335_MIDI_VOL)   & 0x0e) == 0x06)\n\t\t\tsc->sc_mixer_model = SBM_CT1335;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tif (SBVER_MINOR(v) == 0)\n\t\t\tsc->sc_model = SB_20;\n\t\telse\n\t\t\tsc->sc_model = SB_2x;\n\t\tbreak;\n\tcase 3:\n\t\tsc->sc_mixer_model = SBM_CT1345;\n\t\tsc->sc_model = SB_PRO;\n\t\tbreak;\n\tcase 4:\n#if 0\n/* XXX This does not work */\n\t\t/* Most SB16 have a tone controls, but some don't. */\n\t\tsbdsp_mix_write(sc, SB16P_TREBLE_L, 0x80);\n\t\t/* Check if we can read back the mixer value. */\n\t\tif ((sbdsp_mix_read(sc, SB16P_TREBLE_L) & 0xf0) == 0x80)\n\t\t\tsc->sc_mixer_model = SBM_CT1745;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_CT1XX5;\n#else\n\t\tsc->sc_mixer_model = SBM_CT1745;\n#endif\n#if 0\n/* XXX figure out a good way of determining the model */\n\t\t/* XXX what about SB_32 */\n\t\tif (SBVER_MINOR(v) == 16)\n\t\t\tsc->sc_model = SB_64;\n\t\telse\n#endif\n\t\t\tsc->sc_model = SB_16;\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbversion"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbversion;\n\nvoid\nsbversion(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint v;\n\n\tsc->sc_model = SB_UNK;\n\tsc->sc_version = 0;\n\tif (sbdsp_wdsp(sc, SB_DSP_VERSION) < 0)\n\t\treturn;\n\tv = sbdsp_rdsp(sc) << 8;\n\tv |= sbdsp_rdsp(sc);\n\tif (v < 0)\n\t\treturn;\n\tsc->sc_version = v;\n\tswitch(SBVER_MAJOR(v)) {\n\tcase 1:\n\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tsc->sc_model = SB_1;\n\t\tbreak;\n\tcase 2:\n\t\t/* Some SB2 have a mixer, some don't. */\n\t\tsbdsp_mix_write(sc, SBP_1335_MASTER_VOL, 0x04);\n\t\tsbdsp_mix_write(sc, SBP_1335_MIDI_VOL,   0x06);\n\t\t/* Check if we can read back the mixer values. */\n\t\tif ((sbdsp_mix_read(sc, SBP_1335_MASTER_VOL) & 0x0e) == 0x04 &&\n\t\t    (sbdsp_mix_read(sc, SBP_1335_MIDI_VOL)   & 0x0e) == 0x06)\n\t\t\tsc->sc_mixer_model = SBM_CT1335;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_NONE;\n\t\tif (SBVER_MINOR(v) == 0)\n\t\t\tsc->sc_model = SB_20;\n\t\telse\n\t\t\tsc->sc_model = SB_2x;\n\t\tbreak;\n\tcase 3:\n\t\tsc->sc_mixer_model = SBM_CT1345;\n\t\tsc->sc_model = SB_PRO;\n\t\tbreak;\n\tcase 4:\n#if 0\n/* XXX This does not work */\n\t\t/* Most SB16 have a tone controls, but some don't. */\n\t\tsbdsp_mix_write(sc, SB16P_TREBLE_L, 0x80);\n\t\t/* Check if we can read back the mixer value. */\n\t\tif ((sbdsp_mix_read(sc, SB16P_TREBLE_L) & 0xf0) == 0x80)\n\t\t\tsc->sc_mixer_model = SBM_CT1745;\n\t\telse\n\t\t\tsc->sc_mixer_model = SBM_CT1XX5;\n#else\n\t\tsc->sc_mixer_model = SBM_CT1745;\n#endif\n#if 0\n/* XXX figure out a good way of determining the model */\n\t\t/* XXX what about SB_32 */\n\t\tif (SBVER_MINOR(v) == 16)\n\t\t\tsc->sc_model = SB_64;\n\t\telse\n#endif\n\t\t\tsc->sc_model = SB_16;\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sbdsp_jazz16_probe",
          "args": [
            "sc"
          ],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_jazz16_probe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "255-321",
          "snippet": "void\nsbdsp_jazz16_probe(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tstatic u_char jazz16_irq_conf[16] = {\n\t    -1, -1, 0x02, 0x03,\n\t    -1, 0x01, -1, 0x04,\n\t    -1, 0x02, 0x05, -1,\n\t    -1, -1, -1, 0x06};\n\tstatic u_char jazz16_drq_conf[8] = {\n\t    -1, 0x01, -1, 0x02,\n\t    -1, 0x03, -1, 0x04};\n\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh;\n\n\tsbversion(sc);\n\n\tDPRINTF((\"jazz16 probe\\n\"));\n\n\tif (bus_space_map(iot, JAZZ16_CONFIG_PORT, 1, 0, &ioh)) {\n\t\tDPRINTF((\"bus map failed\\n\"));\n\t\treturn;\n\t}\n\n\tif (jazz16_drq_conf[sc->sc_drq8] == (u_char)-1 ||\n\t    jazz16_irq_conf[sc->sc_irq] == (u_char)-1) {\n\t\tDPRINTF((\"drq/irq check failed\\n\"));\n\t\tgoto done;\t\t/* give up, we can't do it. */\n\t}\n\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_WAKEUP);\n\tdelay(10000);\t\t\t/* delay 10 ms */\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_SETBASE);\n\tbus_space_write_1(iot, ioh, 0, sc->sc_iobase & 0x70);\n\n\tif (sbdsp_reset(sc) < 0) {\n\t\tDPRINTF((\"sbdsp_reset check failed\\n\"));\n\t\tgoto done;\t\t/* XXX? what else could we do? */\n\t}\n\n\tif (sbdsp_wdsp(sc, JAZZ16_READ_VER)) {\n\t\tDPRINTF((\"read16 setup failed\\n\"));\n\t\tgoto done;\n\t}\n\n\tif (sbdsp_rdsp(sc) != JAZZ16_VER_JAZZ) {\n\t\tDPRINTF((\"read16 failed\\n\"));\n\t\tgoto done;\n\t}\n\n\t/* XXX set both 8 & 16-bit drq to same channel, it works fine. */\n\tsc->sc_drq16 = sc->sc_drq8;\n\tif (sbdsp_wdsp(sc, JAZZ16_SET_DMAINTR) ||\n\t    sbdsp_wdsp(sc, (jazz16_drq_conf[sc->sc_drq16] << 4) |\n\t\tjazz16_drq_conf[sc->sc_drq8]) ||\n\t    sbdsp_wdsp(sc, jazz16_irq_conf[sc->sc_irq])) {\n\t\tDPRINTF((\"sbdsp: can't write jazz16 probe stuff\\n\"));\n\t} else {\n\t\tDPRINTF((\"jazz16 detected!\\n\"));\n\t\tsc->sc_model = SB_JAZZ;\n\t\tsc->sc_mixer_model = SBM_CT1345; /* XXX really? */\n\t}\n\ndone:\n\tbus_space_unmap(iot, ioh, 1);\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void\tsbversion",
            "void\tsbdsp_jazz16_probe"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbversion;\nvoid\tsbdsp_jazz16_probe;\n\nvoid\nsbdsp_jazz16_probe(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tstatic u_char jazz16_irq_conf[16] = {\n\t    -1, -1, 0x02, 0x03,\n\t    -1, 0x01, -1, 0x04,\n\t    -1, 0x02, 0x05, -1,\n\t    -1, -1, -1, 0x06};\n\tstatic u_char jazz16_drq_conf[8] = {\n\t    -1, 0x01, -1, 0x02,\n\t    -1, 0x03, -1, 0x04};\n\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh;\n\n\tsbversion(sc);\n\n\tDPRINTF((\"jazz16 probe\\n\"));\n\n\tif (bus_space_map(iot, JAZZ16_CONFIG_PORT, 1, 0, &ioh)) {\n\t\tDPRINTF((\"bus map failed\\n\"));\n\t\treturn;\n\t}\n\n\tif (jazz16_drq_conf[sc->sc_drq8] == (u_char)-1 ||\n\t    jazz16_irq_conf[sc->sc_irq] == (u_char)-1) {\n\t\tDPRINTF((\"drq/irq check failed\\n\"));\n\t\tgoto done;\t\t/* give up, we can't do it. */\n\t}\n\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_WAKEUP);\n\tdelay(10000);\t\t\t/* delay 10 ms */\n\tbus_space_write_1(iot, ioh, 0, JAZZ16_SETBASE);\n\tbus_space_write_1(iot, ioh, 0, sc->sc_iobase & 0x70);\n\n\tif (sbdsp_reset(sc) < 0) {\n\t\tDPRINTF((\"sbdsp_reset check failed\\n\"));\n\t\tgoto done;\t\t/* XXX? what else could we do? */\n\t}\n\n\tif (sbdsp_wdsp(sc, JAZZ16_READ_VER)) {\n\t\tDPRINTF((\"read16 setup failed\\n\"));\n\t\tgoto done;\n\t}\n\n\tif (sbdsp_rdsp(sc) != JAZZ16_VER_JAZZ) {\n\t\tDPRINTF((\"read16 failed\\n\"));\n\t\tgoto done;\n\t}\n\n\t/* XXX set both 8 & 16-bit drq to same channel, it works fine. */\n\tsc->sc_drq16 = sc->sc_drq8;\n\tif (sbdsp_wdsp(sc, JAZZ16_SET_DMAINTR) ||\n\t    sbdsp_wdsp(sc, (jazz16_drq_conf[sc->sc_drq16] << 4) |\n\t\tjazz16_drq_conf[sc->sc_drq8]) ||\n\t    sbdsp_wdsp(sc, jazz16_irq_conf[sc->sc_irq])) {\n\t\tDPRINTF((\"sbdsp: can't write jazz16 probe stuff\\n\"));\n\t} else {\n\t\tDPRINTF((\"jazz16 detected!\\n\"));\n\t\tsc->sc_model = SB_JAZZ;\n\t\tsc->sc_mixer_model = SBM_CT1345; /* XXX really? */\n\t}\n\ndone:\n\tbus_space_unmap(iot, ioh, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"sbdsp: couldn't reset card\\n\")"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sbdsp_reset",
          "args": [
            "sc"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "sbdsp_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
          "lines": "918-949",
          "snippet": "int\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <dev/isa/sbdspvar.h>",
            "#include <dev/isa/sbreg.h>",
            "#include <dev/isa/isadmavar.h>",
            "#include <dev/isa/isavar.h>",
            "#include <dev/auconv.h>",
            "#include <dev/mulaw.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/audioio.h>",
            "#include <machine/bus.h>",
            "#include <machine/intr.h>",
            "#include <machine/cpu.h>",
            "#include <vm/vm.h>",
            "#include <sys/buf.h>",
            "#include <sys/proc.h>",
            "#include <sys/device.h>",
            "#include <sys/syslog.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/errno.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>",
            "#include \"midi.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nint\nsbdsp_reset(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tbus_space_tag_t iot = sc->sc_iot;\n\tbus_space_handle_t ioh = sc->sc_ioh;\n\n\tsc->sc_intr8 = 0;\n\tsc->sc_intr16 = 0;\n\tif (sc->sc_i.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_i.dmachan);\n\t\tsc->sc_i.run = SB_NOTRUNNING;\n\t}\n\tif (sc->sc_o.run != SB_NOTRUNNING) {\n\t\tisa_dmaabort(sc->sc_isa, sc->sc_o.dmachan);\n\t\tsc->sc_o.run = SB_NOTRUNNING;\n\t}\n\n\t/*\n\t * See SBK, section 11.3.\n\t * We pulse a reset signal into the card.\n\t * Gee, what a brilliant hardware design.\n\t */\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 1);\n\tdelay(10);\n\tbus_space_write_1(iot, ioh, SBP_DSP_RESET, 0);\n\tdelay(30);\n\tif (sbdsp_rdsp(sc) != SB_MAGIC)\n\t\treturn -1;\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\tsbversion;\nvoid\tsbdsp_jazz16_probe;\nint flags;\n\nint\nsbdsp_probe(sc)\n\tstruct sbdsp_softc *sc;\n{\n\n\tif (sbdsp_reset(sc) < 0) {\n\t\tDPRINTF((\"sbdsp: couldn't reset card\\n\"));\n\t\treturn 0;\n\t}\n\t/* if flags set, go and probe the jazz16 stuff */\n\tif (sc->sc_dev.dv_cfdata->cf_flags & 1)\n\t\tsbdsp_jazz16_probe(sc);\n\telse\n\t\tsbversion(sc);\n\tif (sc->sc_model == SB_UNK) {\n\t\t/* Unknown SB model found. */\n\t\tDPRINTF((\"sbdsp: unknown SB model found\\n\"));\n\t\treturn 0;\n\t}\n\treturn 1;\n}"
  },
  {
    "function_name": "sb_printsc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/sbdsp.c",
    "lines": "197-220",
    "snippet": "void\nsb_printsc(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint i;\n    \n\tprintf(\"open %d dmachan %d/%d %d/%d iobase 0x%x irq %d\\n\",\n\t    (int)sc->sc_open, sc->sc_i.run, sc->sc_o.run, \n\t    sc->sc_drq8, sc->sc_drq16,\n\t    sc->sc_iobase, sc->sc_irq);\n\tprintf(\"irate %d itc %x orate %d otc %x\\n\",\n\t    sc->sc_i.rate, sc->sc_i.tc,\n\t    sc->sc_o.rate, sc->sc_o.tc);\n\tprintf(\"spkron %u nintr %lu\\n\",\n\t    sc->spkr_state, sc->sc_interrupts);\n\tprintf(\"intr8 %p arg8 %p\\n\",\n\t    sc->sc_intr8, sc->sc_arg16);\n\tprintf(\"intr16 %p arg16 %p\\n\",\n\t    sc->sc_intr8, sc->sc_arg16);\n\tprintf(\"gain:\");\n\tfor (i = 0; i < SB_NDEVS; i++)\n\t\tprintf(\" %u,%u\", sc->gain[i][SB_LEFT], sc->gain[i][SB_RIGHT]);\n\tprintf(\"\\n\");\n}",
    "includes": [
      "#include <dev/isa/sbdspvar.h>",
      "#include <dev/isa/sbreg.h>",
      "#include <dev/isa/isadmavar.h>",
      "#include <dev/isa/isavar.h>",
      "#include <dev/auconv.h>",
      "#include <dev/mulaw.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/audioio.h>",
      "#include <machine/bus.h>",
      "#include <machine/intr.h>",
      "#include <machine/cpu.h>",
      "#include <vm/vm.h>",
      "#include <sys/buf.h>",
      "#include <sys/proc.h>",
      "#include <sys/device.h>",
      "#include <sys/syslog.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/errno.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>",
      "#include \"midi.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/isa/sbdspvar.h>\n#include <dev/isa/sbreg.h>\n#include <dev/isa/isadmavar.h>\n#include <dev/isa/isavar.h>\n#include <dev/auconv.h>\n#include <dev/mulaw.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/audioio.h>\n#include <machine/bus.h>\n#include <machine/intr.h>\n#include <machine/cpu.h>\n#include <vm/vm.h>\n#include <sys/buf.h>\n#include <sys/proc.h>\n#include <sys/device.h>\n#include <sys/syslog.h>\n#include <sys/ioctl.h>\n#include <sys/errno.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n#include \"midi.h\"\n\nvoid\nsb_printsc(sc)\n\tstruct sbdsp_softc *sc;\n{\n\tint i;\n    \n\tprintf(\"open %d dmachan %d/%d %d/%d iobase 0x%x irq %d\\n\",\n\t    (int)sc->sc_open, sc->sc_i.run, sc->sc_o.run, \n\t    sc->sc_drq8, sc->sc_drq16,\n\t    sc->sc_iobase, sc->sc_irq);\n\tprintf(\"irate %d itc %x orate %d otc %x\\n\",\n\t    sc->sc_i.rate, sc->sc_i.tc,\n\t    sc->sc_o.rate, sc->sc_o.tc);\n\tprintf(\"spkron %u nintr %lu\\n\",\n\t    sc->spkr_state, sc->sc_interrupts);\n\tprintf(\"intr8 %p arg8 %p\\n\",\n\t    sc->sc_intr8, sc->sc_arg16);\n\tprintf(\"intr16 %p arg16 %p\\n\",\n\t    sc->sc_intr8, sc->sc_arg16);\n\tprintf(\"gain:\");\n\tfor (i = 0; i < SB_NDEVS; i++)\n\t\tprintf(\" %u,%u\", sc->gain[i][SB_LEFT], sc->gain[i][SB_RIGHT]);\n\tprintf(\"\\n\");\n}"
  }
]