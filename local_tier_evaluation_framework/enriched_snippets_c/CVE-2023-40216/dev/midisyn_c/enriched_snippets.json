[
  {
    "function_name": "midisyn_finetune",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "353-427",
    "snippet": "u_int32_t\nmidisyn_finetune(base_freq, bend, range, vibrato_cents)\n\tu_int32_t base_freq;\n\tint bend;\n\tint range;\n\tint vibrato_cents;\n{\n\tstatic u_int16_t semitone_tuning[24] = \n\t{\n/*   0 */ 10000, 10595, 11225, 11892, 12599, 13348, 14142, 14983, \n/*   8 */ 15874, 16818, 17818, 18877, 20000, 21189, 22449, 23784, \n/*  16 */ 25198, 26697, 28284, 29966, 31748, 33636, 35636, 37755\n\t};\n\tstatic u_int16_t cent_tuning[100] =\n\t{\n/*   0 */ 10000, 10006, 10012, 10017, 10023, 10029, 10035, 10041, \n/*   8 */ 10046, 10052, 10058, 10064, 10070, 10075, 10081, 10087, \n/*  16 */ 10093, 10099, 10105, 10110, 10116, 10122, 10128, 10134, \n/*  24 */ 10140, 10145, 10151, 10157, 10163, 10169, 10175, 10181, \n/*  32 */ 10187, 10192, 10198, 10204, 10210, 10216, 10222, 10228, \n/*  40 */ 10234, 10240, 10246, 10251, 10257, 10263, 10269, 10275, \n/*  48 */ 10281, 10287, 10293, 10299, 10305, 10311, 10317, 10323, \n/*  56 */ 10329, 10335, 10341, 10347, 10353, 10359, 10365, 10371, \n/*  64 */ 10377, 10383, 10389, 10395, 10401, 10407, 10413, 10419, \n/*  72 */ 10425, 10431, 10437, 10443, 10449, 10455, 10461, 10467, \n/*  80 */ 10473, 10479, 10485, 10491, 10497, 10503, 10509, 10515, \n/*  88 */ 10521, 10528, 10534, 10540, 10546, 10552, 10558, 10564, \n/*  96 */ 10570, 10576, 10582, 10589\n\t};\n\tu_int32_t amount;\n\tint negative, semitones, cents, multiplier;\n\n\tif (range == 0)\n\t\treturn base_freq;\n\n\tif (base_freq == 0)\n\t\treturn base_freq;\n\n\tif (range >= 8192)\n\t\trange = 8192;\n\n\tbend = bend * range / 8192;\n\tbend += vibrato_cents;\n\n\tif (bend == 0)\n\t\treturn base_freq;\n\n\tif (bend < 0) {\n\t\tbend = -bend;\n\t\tnegative = 1;\n\t} else \n\t\tnegative = 0;\n\n\tif (bend > range)\n\t\tbend = range;\n\n\tmultiplier = 1;\n\twhile (bend > 2399) {\n\t\tmultiplier *= 4;\n\t\tbend -= 2400;\n\t}\n\n\tsemitones = bend / 100;\n\tif (semitones > 99)\n\t\tsemitones = 99;\n\tcents = bend % 100;\n\n\tamount = semitone_tuning[semitones] * multiplier * cent_tuning[cents]\n\t\t/ 10000;\n\n\tif (negative)\n\t\treturn (base_freq * 10000 / amount);\t/* Bend down */\n\telse\n\t\treturn (base_freq * amount / 10000);\t/* Bend up */\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "u_int32_t midisyn_finetune"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nu_int32_t midisyn_finetune;\n\nu_int32_t\nmidisyn_finetune(base_freq, bend, range, vibrato_cents)\n\tu_int32_t base_freq;\n\tint bend;\n\tint range;\n\tint vibrato_cents;\n{\n\tstatic u_int16_t semitone_tuning[24] = \n\t{\n/*   0 */ 10000, 10595, 11225, 11892, 12599, 13348, 14142, 14983, \n/*   8 */ 15874, 16818, 17818, 18877, 20000, 21189, 22449, 23784, \n/*  16 */ 25198, 26697, 28284, 29966, 31748, 33636, 35636, 37755\n\t};\n\tstatic u_int16_t cent_tuning[100] =\n\t{\n/*   0 */ 10000, 10006, 10012, 10017, 10023, 10029, 10035, 10041, \n/*   8 */ 10046, 10052, 10058, 10064, 10070, 10075, 10081, 10087, \n/*  16 */ 10093, 10099, 10105, 10110, 10116, 10122, 10128, 10134, \n/*  24 */ 10140, 10145, 10151, 10157, 10163, 10169, 10175, 10181, \n/*  32 */ 10187, 10192, 10198, 10204, 10210, 10216, 10222, 10228, \n/*  40 */ 10234, 10240, 10246, 10251, 10257, 10263, 10269, 10275, \n/*  48 */ 10281, 10287, 10293, 10299, 10305, 10311, 10317, 10323, \n/*  56 */ 10329, 10335, 10341, 10347, 10353, 10359, 10365, 10371, \n/*  64 */ 10377, 10383, 10389, 10395, 10401, 10407, 10413, 10419, \n/*  72 */ 10425, 10431, 10437, 10443, 10449, 10455, 10461, 10467, \n/*  80 */ 10473, 10479, 10485, 10491, 10497, 10503, 10509, 10515, \n/*  88 */ 10521, 10528, 10534, 10540, 10546, 10552, 10558, 10564, \n/*  96 */ 10570, 10576, 10582, 10589\n\t};\n\tu_int32_t amount;\n\tint negative, semitones, cents, multiplier;\n\n\tif (range == 0)\n\t\treturn base_freq;\n\n\tif (base_freq == 0)\n\t\treturn base_freq;\n\n\tif (range >= 8192)\n\t\trange = 8192;\n\n\tbend = bend * range / 8192;\n\tbend += vibrato_cents;\n\n\tif (bend == 0)\n\t\treturn base_freq;\n\n\tif (bend < 0) {\n\t\tbend = -bend;\n\t\tnegative = 1;\n\t} else \n\t\tnegative = 0;\n\n\tif (bend > range)\n\t\tbend = range;\n\n\tmultiplier = 1;\n\twhile (bend > 2399) {\n\t\tmultiplier *= 4;\n\t\tbend -= 2400;\n\t}\n\n\tsemitones = bend / 100;\n\tif (semitones > 99)\n\t\tsemitones = 99;\n\tcents = bend % 100;\n\n\tamount = semitone_tuning[semitones] * multiplier * cent_tuning[cents]\n\t\t/ 10000;\n\n\tif (negative)\n\t\treturn (base_freq * 10000 / amount);\t/* Bend down */\n\telse\n\t\treturn (base_freq * amount / 10000);\t/* Bend up */\n}"
  },
  {
    "function_name": "midisyn_note_to_freq",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "329-351",
    "snippet": "u_int32_t\nmidisyn_note_to_freq(note)\n\tint note;\n{\n\tint o, n, f;\n#define BASE_OCTAVE 5\n\tstatic u_int32_t notes[] = {\n\t\t17145893, 18165441, 19245614, 20390018, 21602472, 22887021,\n\t\t24247954, 25689813, 27217409, 28835840, 30550508, 32367136\n\t};\n\n\n\to = note / 12;\n\tn = note % 12;\n\n\tf = notes[n];\n\n\tif (o < BASE_OCTAVE)\n\t\tf >>= (BASE_OCTAVE - o);\n\telse if (o > BASE_OCTAVE)\n\t\tf <<= (o - BASE_OCTAVE);\n\treturn (f);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define BASE_OCTAVE 5"
    ],
    "globals_used": [
      "u_int32_t midisyn_note_to_freq"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\n#define BASE_OCTAVE 5\n\nu_int32_t midisyn_note_to_freq;\n\nu_int32_t\nmidisyn_note_to_freq(note)\n\tint note;\n{\n\tint o, n, f;\n#define BASE_OCTAVE 5\n\tstatic u_int32_t notes[] = {\n\t\t17145893, 18165441, 19245614, 20390018, 21602472, 22887021,\n\t\t24247954, 25689813, 27217409, 28835840, 30550508, 32367136\n\t};\n\n\n\to = note / 12;\n\tn = note % 12;\n\n\tf = notes[n];\n\n\tif (o < BASE_OCTAVE)\n\t\tf >>= (BASE_OCTAVE - o);\n\telse if (o > BASE_OCTAVE)\n\t\tf <<= (o - BASE_OCTAVE);\n\treturn (f);\n}"
  },
  {
    "function_name": "midisyn_output",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "240-323",
    "snippet": "int\nmidisyn_output(addr, b)\n\tvoid *addr;\n\tint b;\n{\n\tmidisyn *ms = addr;\n\tu_int8_t status, chan;\n\tint voice = 0;\t\t/* initialize to keep gcc quiet */\n\tstruct midisyn_methods *fs;\n\tu_int32_t note, vel;\n\n\tDPRINTF((\"midisyn_output: ms=%p b=0x%02x\\n\", ms, b));\n\tfs = ms->mets;\n\tif (ms->pos < 0) {\n\t\t/* Doing SYSEX */\n\t\tDPRINTF((\"midisyn_output: sysex 0x%02x\\n\", b));\n\t\tif (fs->sysex)\n\t\t\tfs->sysex(ms, b);\n\t\tif (b == MIDI_SYSEX_END)\n\t\t\tms->pos = 0;\n\t\treturn (0);\n\t}\n\tif (ms->pos == 0 && !MIDI_IS_STATUS(b))\n\t\tms->pos++;\t/* repeat last status byte */\n\tms->buf[ms->pos++] = b;\n\tstatus = ms->buf[0];\n\tif (ms->pos < MIDI_LENGTH(status))\n\t\treturn (0);\n\t/* Decode the MIDI command */\n\tchan = MIDI_GET_CHAN(status);\n\tnote = ms->buf[1];\n\tif (ms->flags & MS_FREQXLATE)\n\t\tnote = midisyn_note_to_freq(note);\n\tvel = ms->buf[2];\n\tswitch (MIDI_GET_STATUS(status)) {\n\tcase MIDI_NOTEOFF:\n\t\tvoice = midisyn_findvoice(ms, chan, ms->buf[1]);\n\t\tif (voice >= 0) {\n\t\t\tfs->noteoff(ms, voice, note, vel);\n\t\t\tmidisyn_freevoice(ms, voice);\n\t\t}\n\t\tbreak;\n\tcase MIDI_NOTEON:\n\t\tvoice = fs->allocv(ms, chan, ms->buf[1]);\n\t\tfs->noteon(ms, voice, note, vel);\n\t\tbreak;\n\tcase MIDI_KEY_PRESSURE:\n\t\tif (fs->keypres) {\n\t\t\tvoice = midisyn_findvoice(ms, voice, ms->buf[1]);\n\t\t\tif (voice >= 0)\n\t\t\t\tfs->keypres(ms, voice, note, vel);\n\t\t}\n\t\tbreak;\n\tcase MIDI_CTL_CHANGE:\n\t\tif (fs->ctlchg)\n\t\t\tfs->ctlchg(ms, chan, ms->buf[1], vel);\n\t\tbreak;\n\tcase MIDI_PGM_CHANGE:\n\t\tif (fs->pgmchg)\n\t\t\tfs->pgmchg(ms, chan, ms->buf[1]);\n\t\tbreak;\n\tcase MIDI_CHN_PRESSURE:\n\t\tif (fs->chnpres) {\n\t\t\tvoice = midisyn_findvoice(ms, chan, ms->buf[1]);\n\t\t\tif (voice >= 0)\n\t\t\t\tfs->chnpres(ms, voice, note);\n\t\t}\n\t\tbreak;\n\tcase MIDI_PITCH_BEND:\n\t\tif (fs->pitchb) {\n\t\t\tvoice = midisyn_findvoice(ms, chan, ms->buf[1]);\n\t\t\tif (voice >= 0)\n\t\t\t\tfs->pitchb(ms, chan, note, vel);\n\t\t}\n\t\tbreak;\n\tcase MIDI_SYSTEM_PREFIX:\n\t\tif (fs->sysex)\n\t\t\tfs->sysex(ms, status);\n\t\tms->pos = -1;\n\t\treturn (0);\n\t}\n\tms->pos = 0;\n\treturn (0);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmidisyn_findvoice",
      "void\tmidisyn_freevoice",
      "u_int32_t midisyn_note_to_freq",
      "int\tmidisyn_output"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fs->sysex",
          "args": [
            "ms",
            "status"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->pitchb",
          "args": [
            "ms",
            "chan",
            "note",
            "vel"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "midisyn_findvoice",
          "args": [
            "ms",
            "chan",
            "ms->buf[1]"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "midisyn_findvoice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
          "lines": "158-173",
          "snippet": "int\nmidisyn_findvoice(ms, chan, note)\n\tmidisyn *ms;\n\tint chan, note;\n{\n\tu_int cn;\n\tint v;\n\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn (chan);\n\tcn = MS_CHANNOTE(chan, note);\n\tfor (v = 0; v < ms->nvoice; v++)\n\t\tif (ms->voices[v].chan_note == cn && ms->voices[v].inuse)\n\t\t\treturn (v);\n\treturn (-1);\n}",
          "includes": [
            "#include <dev/midisynvar.h>",
            "#include <dev/midivar.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/device.h>",
            "#include <sys/midiio.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/malloc.h>",
            "#include <sys/proc.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int\tmidisyn_findvoice"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nint\tmidisyn_findvoice;\n\nint\nmidisyn_findvoice(ms, chan, note)\n\tmidisyn *ms;\n\tint chan, note;\n{\n\tu_int cn;\n\tint v;\n\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn (chan);\n\tcn = MS_CHANNOTE(chan, note);\n\tfor (v = 0; v < ms->nvoice; v++)\n\t\tif (ms->voices[v].chan_note == cn && ms->voices[v].inuse)\n\t\t\treturn (v);\n\treturn (-1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fs->chnpres",
          "args": [
            "ms",
            "voice",
            "note"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->pgmchg",
          "args": [
            "ms",
            "chan",
            "ms->buf[1]"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->ctlchg",
          "args": [
            "ms",
            "chan",
            "ms->buf[1]",
            "vel"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->keypres",
          "args": [
            "ms",
            "voice",
            "note",
            "vel"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->noteon",
          "args": [
            "ms",
            "voice",
            "note",
            "vel"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->allocv",
          "args": [
            "ms",
            "chan",
            "ms->buf[1]"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "midisyn_freevoice",
          "args": [
            "ms",
            "voice"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "midisyn_freevoice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
          "lines": "193-201",
          "snippet": "void\nmidisyn_freevoice(ms, voice)\n\tmidisyn *ms;\n\tint voice;\n{\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn;\n\tms->voices[voice].inuse = 0;\n}",
          "includes": [
            "#include <dev/midisynvar.h>",
            "#include <dev/midivar.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/device.h>",
            "#include <sys/midiio.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/malloc.h>",
            "#include <sys/proc.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void\tmidisyn_freevoice"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nvoid\tmidisyn_freevoice;\n\nvoid\nmidisyn_freevoice(ms, voice)\n\tmidisyn *ms;\n\tint voice;\n{\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn;\n\tms->voices[voice].inuse = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fs->noteoff",
          "args": [
            "ms",
            "voice",
            "note",
            "vel"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIDI_GET_STATUS",
          "args": [
            "status"
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "midisyn_note_to_freq",
          "args": [
            "note"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "midisyn_note_to_freq",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
          "lines": "329-351",
          "snippet": "u_int32_t\nmidisyn_note_to_freq(note)\n\tint note;\n{\n\tint o, n, f;\n#define BASE_OCTAVE 5\n\tstatic u_int32_t notes[] = {\n\t\t17145893, 18165441, 19245614, 20390018, 21602472, 22887021,\n\t\t24247954, 25689813, 27217409, 28835840, 30550508, 32367136\n\t};\n\n\n\to = note / 12;\n\tn = note % 12;\n\n\tf = notes[n];\n\n\tif (o < BASE_OCTAVE)\n\t\tf >>= (BASE_OCTAVE - o);\n\telse if (o > BASE_OCTAVE)\n\t\tf <<= (o - BASE_OCTAVE);\n\treturn (f);\n}",
          "includes": [
            "#include <dev/midisynvar.h>",
            "#include <dev/midivar.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/device.h>",
            "#include <sys/midiio.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/malloc.h>",
            "#include <sys/proc.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define BASE_OCTAVE 5"
          ],
          "globals_used": [
            "u_int32_t midisyn_note_to_freq"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\n#define BASE_OCTAVE 5\n\nu_int32_t midisyn_note_to_freq;\n\nu_int32_t\nmidisyn_note_to_freq(note)\n\tint note;\n{\n\tint o, n, f;\n#define BASE_OCTAVE 5\n\tstatic u_int32_t notes[] = {\n\t\t17145893, 18165441, 19245614, 20390018, 21602472, 22887021,\n\t\t24247954, 25689813, 27217409, 28835840, 30550508, 32367136\n\t};\n\n\n\to = note / 12;\n\tn = note % 12;\n\n\tf = notes[n];\n\n\tif (o < BASE_OCTAVE)\n\t\tf >>= (BASE_OCTAVE - o);\n\telse if (o > BASE_OCTAVE)\n\t\tf <<= (o - BASE_OCTAVE);\n\treturn (f);\n}"
        }
      },
      {
        "call_info": {
          "callee": "MIDI_GET_CHAN",
          "args": [
            "status"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIDI_LENGTH",
          "args": [
            "status"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIDI_IS_STATUS",
          "args": [
            "b"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs->sysex",
          "args": [
            "ms",
            "b"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"midisyn_output: sysex 0x%02x\\n\", b)"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"midisyn_output: ms=%p b=0x%02x\\n\", ms, b)"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nint\tmidisyn_findvoice;\nvoid\tmidisyn_freevoice;\nu_int32_t midisyn_note_to_freq;\nint\tmidisyn_output;\n\nint\nmidisyn_output(addr, b)\n\tvoid *addr;\n\tint b;\n{\n\tmidisyn *ms = addr;\n\tu_int8_t status, chan;\n\tint voice = 0;\t\t/* initialize to keep gcc quiet */\n\tstruct midisyn_methods *fs;\n\tu_int32_t note, vel;\n\n\tDPRINTF((\"midisyn_output: ms=%p b=0x%02x\\n\", ms, b));\n\tfs = ms->mets;\n\tif (ms->pos < 0) {\n\t\t/* Doing SYSEX */\n\t\tDPRINTF((\"midisyn_output: sysex 0x%02x\\n\", b));\n\t\tif (fs->sysex)\n\t\t\tfs->sysex(ms, b);\n\t\tif (b == MIDI_SYSEX_END)\n\t\t\tms->pos = 0;\n\t\treturn (0);\n\t}\n\tif (ms->pos == 0 && !MIDI_IS_STATUS(b))\n\t\tms->pos++;\t/* repeat last status byte */\n\tms->buf[ms->pos++] = b;\n\tstatus = ms->buf[0];\n\tif (ms->pos < MIDI_LENGTH(status))\n\t\treturn (0);\n\t/* Decode the MIDI command */\n\tchan = MIDI_GET_CHAN(status);\n\tnote = ms->buf[1];\n\tif (ms->flags & MS_FREQXLATE)\n\t\tnote = midisyn_note_to_freq(note);\n\tvel = ms->buf[2];\n\tswitch (MIDI_GET_STATUS(status)) {\n\tcase MIDI_NOTEOFF:\n\t\tvoice = midisyn_findvoice(ms, chan, ms->buf[1]);\n\t\tif (voice >= 0) {\n\t\t\tfs->noteoff(ms, voice, note, vel);\n\t\t\tmidisyn_freevoice(ms, voice);\n\t\t}\n\t\tbreak;\n\tcase MIDI_NOTEON:\n\t\tvoice = fs->allocv(ms, chan, ms->buf[1]);\n\t\tfs->noteon(ms, voice, note, vel);\n\t\tbreak;\n\tcase MIDI_KEY_PRESSURE:\n\t\tif (fs->keypres) {\n\t\t\tvoice = midisyn_findvoice(ms, voice, ms->buf[1]);\n\t\t\tif (voice >= 0)\n\t\t\t\tfs->keypres(ms, voice, note, vel);\n\t\t}\n\t\tbreak;\n\tcase MIDI_CTL_CHANGE:\n\t\tif (fs->ctlchg)\n\t\t\tfs->ctlchg(ms, chan, ms->buf[1], vel);\n\t\tbreak;\n\tcase MIDI_PGM_CHANGE:\n\t\tif (fs->pgmchg)\n\t\t\tfs->pgmchg(ms, chan, ms->buf[1]);\n\t\tbreak;\n\tcase MIDI_CHN_PRESSURE:\n\t\tif (fs->chnpres) {\n\t\t\tvoice = midisyn_findvoice(ms, chan, ms->buf[1]);\n\t\t\tif (voice >= 0)\n\t\t\t\tfs->chnpres(ms, voice, note);\n\t\t}\n\t\tbreak;\n\tcase MIDI_PITCH_BEND:\n\t\tif (fs->pitchb) {\n\t\t\tvoice = midisyn_findvoice(ms, chan, ms->buf[1]);\n\t\t\tif (voice >= 0)\n\t\t\t\tfs->pitchb(ms, chan, note, vel);\n\t\t}\n\t\tbreak;\n\tcase MIDI_SYSTEM_PREFIX:\n\t\tif (fs->sysex)\n\t\t\tfs->sysex(ms, status);\n\t\tms->pos = -1;\n\t\treturn (0);\n\t}\n\tms->pos = 0;\n\treturn (0);\n}"
  },
  {
    "function_name": "midisyn_allocvoice",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "203-238",
    "snippet": "int\nmidisyn_allocvoice(ms, chan, note)\n\tmidisyn *ms;\n\tu_int32_t chan, note;\n{\n\tint bestv, v;\n\tu_int bestseq, s;\n\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn (chan);\n\t/* Find a free voice, or if no free voice is found the oldest. */\n\tbestv = 0;\n\tbestseq = ms->voices[0].seqno + (ms->voices[0].inuse ? 0x40000000 : 0);\n\tfor (v = 1; v < ms->nvoice; v++) {\n\t\ts = ms->voices[v].seqno;\n\t\tif (ms->voices[v].inuse)\n\t\t\ts += 0x40000000;\n\t\tif (s < bestseq) {\n\t\t\tbestseq = s;\n\t\t\tbestv = v;\n\t\t}\n\t}\n\tDPRINTFN(10,(\"midisyn_allocvoice: v=%d seq=%d cn=%x inuse=%d\\n\",\n\t\t     bestv, ms->voices[bestv].seqno, \n\t\t     ms->voices[bestv].chan_note,\n\t\t     ms->voices[bestv].inuse));\n#ifdef AUDIO_DEBUG\n\tif (ms->voices[bestv].inuse)\n\t\tDPRINTFN(1,(\"midisyn_allocvoice: steal %x\\n\", \n\t\t\t    ms->voices[bestv].chan_note));\n#endif\n\tms->voices[bestv].chan_note = MS_CHANNOTE(chan, note);\n\tms->voices[bestv].seqno = ms->seqno++;\n\tms->voices[bestv].inuse = 1;\n\treturn (bestv);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmidisyn_allocvoice"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "MS_CHANNOTE",
          "args": [
            "chan",
            "note"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "1",
            "(\"midisyn_allocvoice: steal %x\\n\", \n\t\t\t    ms->voices[bestv].chan_note)"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTFN",
          "args": [
            "10",
            "(\"midisyn_allocvoice: v=%d seq=%d cn=%x inuse=%d\\n\",\n\t\t     bestv, ms->voices[bestv].seqno, \n\t\t     ms->voices[bestv].chan_note,\n\t\t     ms->voices[bestv].inuse)"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nint\tmidisyn_allocvoice;\n\nint\nmidisyn_allocvoice(ms, chan, note)\n\tmidisyn *ms;\n\tu_int32_t chan, note;\n{\n\tint bestv, v;\n\tu_int bestseq, s;\n\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn (chan);\n\t/* Find a free voice, or if no free voice is found the oldest. */\n\tbestv = 0;\n\tbestseq = ms->voices[0].seqno + (ms->voices[0].inuse ? 0x40000000 : 0);\n\tfor (v = 1; v < ms->nvoice; v++) {\n\t\ts = ms->voices[v].seqno;\n\t\tif (ms->voices[v].inuse)\n\t\t\ts += 0x40000000;\n\t\tif (s < bestseq) {\n\t\t\tbestseq = s;\n\t\t\tbestv = v;\n\t\t}\n\t}\n\tDPRINTFN(10,(\"midisyn_allocvoice: v=%d seq=%d cn=%x inuse=%d\\n\",\n\t\t     bestv, ms->voices[bestv].seqno, \n\t\t     ms->voices[bestv].chan_note,\n\t\t     ms->voices[bestv].inuse));\n#ifdef AUDIO_DEBUG\n\tif (ms->voices[bestv].inuse)\n\t\tDPRINTFN(1,(\"midisyn_allocvoice: steal %x\\n\", \n\t\t\t    ms->voices[bestv].chan_note));\n#endif\n\tms->voices[bestv].chan_note = MS_CHANNOTE(chan, note);\n\tms->voices[bestv].seqno = ms->seqno++;\n\tms->voices[bestv].inuse = 1;\n\treturn (bestv);\n}"
  },
  {
    "function_name": "midisyn_freevoice",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "193-201",
    "snippet": "void\nmidisyn_freevoice(ms, voice)\n\tmidisyn *ms;\n\tint voice;\n{\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn;\n\tms->voices[voice].inuse = 0;\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\tmidisyn_freevoice"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nvoid\tmidisyn_freevoice;\n\nvoid\nmidisyn_freevoice(ms, voice)\n\tmidisyn *ms;\n\tint voice;\n{\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn;\n\tms->voices[voice].inuse = 0;\n}"
  },
  {
    "function_name": "midisyn_attach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "175-191",
    "snippet": "void\nmidisyn_attach(sc, ms)\n\tstruct midi_softc *sc;\n\tmidisyn *ms;\n{\n\tif (ms->flags & MS_DOALLOC) {\n\t\tms->voices = malloc(ms->nvoice * sizeof (struct voice), \n\t\t\t\t    M_DEVBUF, M_WAITOK);\n\t\tmemset(ms->voices, 0, ms->nvoice * sizeof (struct voice));\n\t\tms->seqno = 1;\n\t\tif (ms->mets->allocv == 0)\n\t\t\tms->mets->allocv = &midisyn_allocvoice;\n\t}\n\tsc->hw_if = &midisyn_hw_if;\n\tsc->hw_hdl = ms;\n\tDPRINTF((\"midisyn_attach: ms=%p\\n\", sc->hw_hdl));\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmidisyn_allocvoice",
      "struct midi_hw_if midisyn_hw_if = {\n\tmidisyn_open,\n\tmidisyn_close,\n\tmidisyn_output,\n\tmidisyn_getinfo,\n\tmidisyn_ioctl,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"midisyn_attach: ms=%p\\n\", sc->hw_hdl)"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ms->voices",
            "0",
            "ms->nvoice * sizeof (struct voice)"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "ms->nvoice * sizeof (struct voice)",
            "M_DEVBUF",
            "M_WAITOK"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "rf_unrecord_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugMem.c",
          "lines": "84-99",
          "snippet": "void \nrf_unrecord_malloc(p, sz)\n\tvoid   *p;\n\tint     sz;\n{\n\tint     size;\n\n\t/* RF_LOCK_MUTEX(rf_debug_mem_mutex); */\n\tsize = memory_hash_remove(p, sz);\n\ttot_mem_in_use -= size;\n\t/* RF_UNLOCK_MUTEX(rf_debug_mem_mutex); */\n\tif ((long) p == rf_memDebugAddress) {\n\t\tprintf(\"Free: Found debug address\\n\");\t/* this is really only a\n\t\t\t\t\t\t\t * flag line for gdb */\n\t}\n}",
          "includes": [
            "#include \"rf_general.h\"",
            "#include \"rf_debugMem.h\"",
            "#include \"rf_options.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static long tot_mem_in_use = 0;",
            "static int memory_hash_remove(void *addr, int sz);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"rf_general.h\"\n#include \"rf_debugMem.h\"\n#include \"rf_options.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\nstatic long tot_mem_in_use = 0;\nstatic int memory_hash_remove(void *addr, int sz);\n\nvoid \nrf_unrecord_malloc(p, sz)\n\tvoid   *p;\n\tint     sz;\n{\n\tint     size;\n\n\t/* RF_LOCK_MUTEX(rf_debug_mem_mutex); */\n\tsize = memory_hash_remove(p, sz);\n\ttot_mem_in_use -= size;\n\t/* RF_UNLOCK_MUTEX(rf_debug_mem_mutex); */\n\tif ((long) p == rf_memDebugAddress) {\n\t\tprintf(\"Free: Found debug address\\n\");\t/* this is really only a\n\t\t\t\t\t\t\t * flag line for gdb */\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nint\tmidisyn_allocvoice;\nstruct midi_hw_if midisyn_hw_if = {\n\tmidisyn_open,\n\tmidisyn_close,\n\tmidisyn_output,\n\tmidisyn_getinfo,\n\tmidisyn_ioctl,\n};\n\nvoid\nmidisyn_attach(sc, ms)\n\tstruct midi_softc *sc;\n\tmidisyn *ms;\n{\n\tif (ms->flags & MS_DOALLOC) {\n\t\tms->voices = malloc(ms->nvoice * sizeof (struct voice), \n\t\t\t\t    M_DEVBUF, M_WAITOK);\n\t\tmemset(ms->voices, 0, ms->nvoice * sizeof (struct voice));\n\t\tms->seqno = 1;\n\t\tif (ms->mets->allocv == 0)\n\t\t\tms->mets->allocv = &midisyn_allocvoice;\n\t}\n\tsc->hw_if = &midisyn_hw_if;\n\tsc->hw_hdl = ms;\n\tDPRINTF((\"midisyn_attach: ms=%p\\n\", sc->hw_hdl));\n}"
  },
  {
    "function_name": "midisyn_findvoice",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "158-173",
    "snippet": "int\nmidisyn_findvoice(ms, chan, note)\n\tmidisyn *ms;\n\tint chan, note;\n{\n\tu_int cn;\n\tint v;\n\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn (chan);\n\tcn = MS_CHANNOTE(chan, note);\n\tfor (v = 0; v < ms->nvoice; v++)\n\t\tif (ms->voices[v].chan_note == cn && ms->voices[v].inuse)\n\t\t\treturn (v);\n\treturn (-1);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmidisyn_findvoice"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "MS_CHANNOTE",
          "args": [
            "chan",
            "note"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nint\tmidisyn_findvoice;\n\nint\nmidisyn_findvoice(ms, chan, note)\n\tmidisyn *ms;\n\tint chan, note;\n{\n\tu_int cn;\n\tint v;\n\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn (chan);\n\tcn = MS_CHANNOTE(chan, note);\n\tfor (v = 0; v < ms->nvoice; v++)\n\t\tif (ms->voices[v].chan_note == cn && ms->voices[v].inuse)\n\t\t\treturn (v);\n\treturn (-1);\n}"
  },
  {
    "function_name": "midisyn_ioctl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "142-156",
    "snippet": "int\nmidisyn_ioctl(maddr, cmd, addr, flag, p)\n\tvoid *maddr;\n\tu_long cmd;\n\tcaddr_t addr;\n\tint flag;\n\tstruct proc *p;\n{\n\tmidisyn *ms = maddr;\n\n\tif (ms->mets->ioctl)\n\t\treturn (ms->mets->ioctl(ms, cmd, addr, flag, p));\n\telse\n\t\treturn (EINVAL);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int\tmidisyn_ioctl"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ms->mets->ioctl",
          "args": [
            "ms",
            "cmd",
            "addr",
            "flag",
            "p"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nint\tmidisyn_ioctl;\n\nint\nmidisyn_ioctl(maddr, cmd, addr, flag, p)\n\tvoid *maddr;\n\tu_long cmd;\n\tcaddr_t addr;\n\tint flag;\n\tstruct proc *p;\n{\n\tmidisyn *ms = maddr;\n\n\tif (ms->mets->ioctl)\n\t\treturn (ms->mets->ioctl(ms, cmd, addr, flag, p));\n\telse\n\t\treturn (EINVAL);\n}"
  },
  {
    "function_name": "midisyn_getinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "131-140",
    "snippet": "void\nmidisyn_getinfo(addr, mi)\n\tvoid *addr;\n\tstruct midi_info *mi;\n{\n\tmidisyn *ms = addr;\n\n\tmi->name = ms->name;\n\tmi->props = 0;\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\tmidisyn_getinfo"
    ],
    "called_functions": [],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nvoid\tmidisyn_getinfo;\n\nvoid\nmidisyn_getinfo(addr, mi)\n\tvoid *addr;\n\tstruct midi_info *mi;\n{\n\tmidisyn *ms = addr;\n\n\tmi->name = ms->name;\n\tmi->props = 0;\n}"
  },
  {
    "function_name": "midisyn_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "112-129",
    "snippet": "void\nmidisyn_close(addr)\n\tvoid *addr;\n{\n\tmidisyn *ms = addr;\n\tstruct midisyn_methods *fs;\n\tint v;\n\n\tDPRINTF((\"midisyn_close: ms=%p ms->mets=%p\\n\", ms, ms->mets));\n\tfs = ms->mets;\n\tfor (v = 0; v < ms->nvoice; v++)\n\t\tif (ms->voices[v].inuse) {\n\t\t\tfs->noteoff(ms, v, 0, 0);\n\t\t\tmidisyn_freevoice(ms, v);\n\t\t}\n\tif (fs->close)\n\t\tfs->close(ms);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void\tmidisyn_freevoice",
      "void\tmidisyn_close"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fs->close",
          "args": [
            "ms"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "midisyn_freevoice",
          "args": [
            "ms",
            "v"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "midisyn_freevoice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
          "lines": "193-201",
          "snippet": "void\nmidisyn_freevoice(ms, voice)\n\tmidisyn *ms;\n\tint voice;\n{\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn;\n\tms->voices[voice].inuse = 0;\n}",
          "includes": [
            "#include <dev/midisynvar.h>",
            "#include <dev/midivar.h>",
            "#include <dev/midi_if.h>",
            "#include <dev/audio_if.h>",
            "#include <sys/device.h>",
            "#include <sys/midiio.h>",
            "#include <sys/audioio.h>",
            "#include <sys/conf.h>",
            "#include <sys/kernel.h>",
            "#include <sys/syslog.h>",
            "#include <sys/systm.h>",
            "#include <sys/malloc.h>",
            "#include <sys/proc.h>",
            "#include <sys/select.h>",
            "#include <sys/vnode.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void\tmidisyn_freevoice"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nvoid\tmidisyn_freevoice;\n\nvoid\nmidisyn_freevoice(ms, voice)\n\tmidisyn *ms;\n\tint voice;\n{\n\tif (!(ms->flags & MS_DOALLOC))\n\t\treturn;\n\tms->voices[voice].inuse = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fs->noteoff",
          "args": [
            "ms",
            "v",
            "0",
            "0"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"midisyn_close: ms=%p ms->mets=%p\\n\", ms, ms->mets)"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\nvoid\tmidisyn_freevoice;\nvoid\tmidisyn_close;\n\nvoid\nmidisyn_close(addr)\n\tvoid *addr;\n{\n\tmidisyn *ms = addr;\n\tstruct midisyn_methods *fs;\n\tint v;\n\n\tDPRINTF((\"midisyn_close: ms=%p ms->mets=%p\\n\", ms, ms->mets));\n\tfs = ms->mets;\n\tfor (v = 0; v < ms->nvoice; v++)\n\t\tif (ms->voices[v].inuse) {\n\t\t\tfs->noteoff(ms, v, 0, 0);\n\t\t\tmidisyn_freevoice(ms, v);\n\t\t}\n\tif (fs->close)\n\t\tfs->close(ms);\n}"
  },
  {
    "function_name": "midisyn_open",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/midisyn.c",
    "lines": "95-110",
    "snippet": "int\nmidisyn_open(addr, flags, iintr, ointr, arg)\n\tvoid *addr;\n\tint flags;\n\tvoid (*iintr)__P((void *, int));\n\tvoid (*ointr)__P((void *));\n\tvoid *arg;\n{\n\tmidisyn *ms = addr;\n\n\tDPRINTF((\"midisyn_open: ms=%p ms->mets=%p\\n\", ms, ms->mets));\n\tif (ms->mets->open)\n\t\treturn (ms->mets->open(ms, flags));\n\telse\n\t\treturn (0);\n}",
    "includes": [
      "#include <dev/midisynvar.h>",
      "#include <dev/midivar.h>",
      "#include <dev/midi_if.h>",
      "#include <dev/audio_if.h>",
      "#include <sys/device.h>",
      "#include <sys/midiio.h>",
      "#include <sys/audioio.h>",
      "#include <sys/conf.h>",
      "#include <sys/kernel.h>",
      "#include <sys/syslog.h>",
      "#include <sys/systm.h>",
      "#include <sys/malloc.h>",
      "#include <sys/proc.h>",
      "#include <sys/select.h>",
      "#include <sys/vnode.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "__P((int));",
      "int\tmidisyn_open"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ms->mets->open",
          "args": [
            "ms",
            "flags"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DPRINTF",
          "args": [
            "(\"midisyn_open: ms=%p ms->mets=%p\\n\", ms, ms->mets)"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/midisynvar.h>\n#include <dev/midivar.h>\n#include <dev/midi_if.h>\n#include <dev/audio_if.h>\n#include <sys/device.h>\n#include <sys/midiio.h>\n#include <sys/audioio.h>\n#include <sys/conf.h>\n#include <sys/kernel.h>\n#include <sys/syslog.h>\n#include <sys/systm.h>\n#include <sys/malloc.h>\n#include <sys/proc.h>\n#include <sys/select.h>\n#include <sys/vnode.h>\n#include <sys/fcntl.h>\n#include <sys/ioctl.h>\n#include <sys/param.h>\n\n__P((int));\nint\tmidisyn_open;\n\nint\nmidisyn_open(addr, flags, iintr, ointr, arg)\n\tvoid *addr;\n\tint flags;\n\tvoid (*iintr)__P((void *, int));\n\tvoid (*ointr)__P((void *));\n\tvoid *arg;\n{\n\tmidisyn *ms = addr;\n\n\tDPRINTF((\"midisyn_open: ms=%p ms->mets=%p\\n\", ms, ms->mets));\n\tif (ms->mets->open)\n\t\treturn (ms->mets->open(ms, flags));\n\telse\n\t\treturn (0);\n}"
  }
]