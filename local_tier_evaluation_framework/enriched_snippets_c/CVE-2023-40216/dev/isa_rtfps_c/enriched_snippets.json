[
  {
    "function_name": "rtfpsintr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/rtfps.c",
    "lines": "195-215",
    "snippet": "int\nrtfpsintr(arg)\n\tvoid *arg;\n{\n\tstruct rtfps_softc *sc = arg;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tint alive = sc->sc_alive;\n\n\tbus_space_write_1(iot, sc->sc_irqioh, 0, 0);\n\n#define\tTRY(n) \\\n\tif (alive & (1 << (n))) \\\n\t\tcomintr(sc->sc_slaves[n]);\n\tTRY(0);\n\tTRY(1);\n\tTRY(2);\n\tTRY(3);\n#undef TRY\n\n\treturn (1);\n}",
    "includes": [
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <dev/isa/isavar.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/termios.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int rtfpsintr"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "TRY",
          "args": [
            "3"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TRY",
          "args": [
            "2"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TRY",
          "args": [
            "1"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TRY",
          "args": [
            "0"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "sc->sc_irqioh",
            "0",
            "0"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <dev/isa/isavar.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/termios.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint rtfpsintr;\n\nint\nrtfpsintr(arg)\n\tvoid *arg;\n{\n\tstruct rtfps_softc *sc = arg;\n\tbus_space_tag_t iot = sc->sc_iot;\n\tint alive = sc->sc_alive;\n\n\tbus_space_write_1(iot, sc->sc_irqioh, 0, 0);\n\n#define\tTRY(n) \\\n\tif (alive & (1 << (n))) \\\n\t\tcomintr(sc->sc_slaves[n]);\n\tTRY(0);\n\tTRY(1);\n\tTRY(2);\n\tTRY(3);\n#undef TRY\n\n\treturn (1);\n}"
  },
  {
    "function_name": "rtfpsattach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/rtfps.c",
    "lines": "143-193",
    "snippet": "void\nrtfpsattach(parent, self, aux)\n\tstruct device *parent, *self;\n\tvoid *aux;\n{\n\tstruct rtfps_softc *sc = (void *)self;\n\tstruct isa_attach_args *ia = aux;\n\tstruct commulti_attach_args ca;\n\tstatic int irqport[] = {\n\t\tIOBASEUNK, IOBASEUNK, IOBASEUNK, IOBASEUNK,\n\t\tIOBASEUNK, IOBASEUNK, IOBASEUNK, IOBASEUNK,\n\t\tIOBASEUNK,     0x2f2,     0x6f2,     0x6f3,\n\t\tIOBASEUNK, IOBASEUNK, IOBASEUNK, IOBASEUNK\n\t};\n\tbus_space_tag_t iot = ia->ia_iot;\n\tint i;\n\n\tsc->sc_iot = ia->ia_iot;\n\tsc->sc_iobase = ia->ia_iobase;\n\n\tif (ia->ia_irq >= 16 || irqport[ia->ia_irq] == IOBASEUNK)\n\t\tpanic(\"rtfpsattach: invalid irq\");\n\tsc->sc_irqport = irqport[ia->ia_irq];\n\n\tfor (i = 0; i < NSLAVES; i++)\n\t\tif (bus_space_map(iot, sc->sc_iobase + i * COM_NPORTS,\n\t\t    COM_NPORTS, 0, &sc->sc_slaveioh[i]))\n\t\t\tpanic(\"rtfpsattach: couldn't map slave %d\", i);\n\tif (bus_space_map(iot, sc->sc_irqport, 1, 0, &sc->sc_irqioh))\n\t\tpanic(\"rtfpsattach: couldn't map irq port at 0x%x\",\n\t\t    sc->sc_irqport);\n\n\tbus_space_write_1(iot, sc->sc_irqioh, 0, 0);\n\n\tprintf(\"\\n\");\n\n\tfor (i = 0; i < NSLAVES; i++) {\n\t\tca.ca_slave = i;\n\t\tca.ca_iot = sc->sc_iot;\n\t\tca.ca_ioh = sc->sc_slaveioh[i];\n\t\tca.ca_iobase = sc->sc_iobase + i * COM_NPORTS;\n\t\tca.ca_noien = 0;\n\n\t\tsc->sc_slaves[i] = config_found(self, &ca, rtfpsprint);\n\t\tif (sc->sc_slaves[i] != NULL)\n\t\t\tsc->sc_alive |= 1 << i;\n\t}\n\n\tsc->sc_ih = isa_intr_establish(ia->ia_ic, ia->ia_irq, IST_EDGE,\n\t    IPL_TTY, rtfpsintr, sc, sc->sc_dev.dv_xname);\n}",
    "includes": [
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <dev/isa/isavar.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/termios.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tNSLAVES\t4"
    ],
    "globals_used": [
      "void rtfpsattach",
      "int rtfpsintr",
      "int rtfpsprint"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "isa_intr_establish",
          "args": [
            "ia->ia_ic",
            "ia->ia_irq",
            "IST_EDGE",
            "IPL_TTY",
            "rtfpsintr",
            "sc",
            "sc->sc_dev.dv_xname"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "config_found",
          "args": [
            "self",
            "&ca",
            "rtfpsprint"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_write_1",
          "args": [
            "iot",
            "sc->sc_irqioh",
            "0",
            "0"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"rtfpsattach: couldn't map irq port at 0x%x\"",
            "sc->sc_irqport"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "sc->sc_irqport",
            "1",
            "0",
            "&sc->sc_irqioh"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"rtfpsattach: couldn't map slave %d\"",
            "i"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "sc->sc_iobase + i * COM_NPORTS",
            "COM_NPORTS",
            "0",
            "&sc->sc_slaveioh[i]"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "panic",
          "args": [
            "\"rtfpsattach: invalid irq\""
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <dev/isa/isavar.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/termios.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tNSLAVES\t4\n\nvoid rtfpsattach;\nint rtfpsintr;\nint rtfpsprint;\n\nvoid\nrtfpsattach(parent, self, aux)\n\tstruct device *parent, *self;\n\tvoid *aux;\n{\n\tstruct rtfps_softc *sc = (void *)self;\n\tstruct isa_attach_args *ia = aux;\n\tstruct commulti_attach_args ca;\n\tstatic int irqport[] = {\n\t\tIOBASEUNK, IOBASEUNK, IOBASEUNK, IOBASEUNK,\n\t\tIOBASEUNK, IOBASEUNK, IOBASEUNK, IOBASEUNK,\n\t\tIOBASEUNK,     0x2f2,     0x6f2,     0x6f3,\n\t\tIOBASEUNK, IOBASEUNK, IOBASEUNK, IOBASEUNK\n\t};\n\tbus_space_tag_t iot = ia->ia_iot;\n\tint i;\n\n\tsc->sc_iot = ia->ia_iot;\n\tsc->sc_iobase = ia->ia_iobase;\n\n\tif (ia->ia_irq >= 16 || irqport[ia->ia_irq] == IOBASEUNK)\n\t\tpanic(\"rtfpsattach: invalid irq\");\n\tsc->sc_irqport = irqport[ia->ia_irq];\n\n\tfor (i = 0; i < NSLAVES; i++)\n\t\tif (bus_space_map(iot, sc->sc_iobase + i * COM_NPORTS,\n\t\t    COM_NPORTS, 0, &sc->sc_slaveioh[i]))\n\t\t\tpanic(\"rtfpsattach: couldn't map slave %d\", i);\n\tif (bus_space_map(iot, sc->sc_irqport, 1, 0, &sc->sc_irqioh))\n\t\tpanic(\"rtfpsattach: couldn't map irq port at 0x%x\",\n\t\t    sc->sc_irqport);\n\n\tbus_space_write_1(iot, sc->sc_irqioh, 0, 0);\n\n\tprintf(\"\\n\");\n\n\tfor (i = 0; i < NSLAVES; i++) {\n\t\tca.ca_slave = i;\n\t\tca.ca_iot = sc->sc_iot;\n\t\tca.ca_ioh = sc->sc_slaveioh[i];\n\t\tca.ca_iobase = sc->sc_iobase + i * COM_NPORTS;\n\t\tca.ca_noien = 0;\n\n\t\tsc->sc_slaves[i] = config_found(self, &ca, rtfpsprint);\n\t\tif (sc->sc_slaves[i] != NULL)\n\t\t\tsc->sc_alive |= 1 << i;\n\t}\n\n\tsc->sc_ih = isa_intr_establish(ia->ia_ic, ia->ia_irq, IST_EDGE,\n\t    IPL_TTY, rtfpsintr, sc, sc->sc_dev.dv_xname);\n}"
  },
  {
    "function_name": "rtfpsprint",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/rtfps.c",
    "lines": "130-141",
    "snippet": "int\nrtfpsprint(aux, pnp)\n\tvoid *aux;\n\tconst char *pnp;\n{\n\tstruct commulti_attach_args *ca = aux;\n\n\tif (pnp)\n\t\tprintf(\"com at %s\", pnp);\n\tprintf(\" slave %d\", ca->ca_slave);\n\treturn (UNCONF);\n}",
    "includes": [
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <dev/isa/isavar.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/termios.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "int rtfpsprint"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" slave %d\"",
            "ca->ca_slave"
          ],
          "line": 139
        },
        "resolved": true,
        "details": {
          "function_name": "rf_debug_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/raidframe/rf_debugprint.c",
          "lines": "82-108",
          "snippet": "void \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}",
          "includes": [
            "#include <sys/param.h>",
            "#include \"rf_options.h\"",
            "#include \"rf_general.h\"",
            "#include \"rf_debugprint.h\"",
            "#include \"rf_threadstuff.h\"",
            "#include \"rf_types.h\""
          ],
          "macros_used": [
            "#define BUFMASK  (BUFSIZE-1)"
          ],
          "globals_used": [
            "static struct RF_Entry_s rf_debugprint_buf[BUFSIZE];",
            "static int rf_debugprint_index = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/param.h>\n#include \"rf_options.h\"\n#include \"rf_general.h\"\n#include \"rf_debugprint.h\"\n#include \"rf_threadstuff.h\"\n#include \"rf_types.h\"\n\n#define BUFMASK  (BUFSIZE-1)\n\nstatic struct RF_Entry_s rf_debugprint_buf[BUFSIZE];\nstatic int rf_debugprint_index = 0;\n\nvoid \nrf_debug_printf(s, a1, a2, a3, a4, a5, a6, a7, a8)\n\tchar   *s;\n\tvoid   *a1, *a2, *a3, *a4, *a5, *a6, *a7, *a8;\n{\n\tint     idx;\n\n\tif (rf_debugPrintUseBuffer) {\n\n\t\tRF_LOCK_MUTEX(rf_debug_print_mutex);\n\t\tidx = rf_debugprint_index;\n\t\trf_debugprint_index = (rf_debugprint_index + 1) & BUFMASK;\n\t\tRF_UNLOCK_MUTEX(rf_debug_print_mutex);\n\n\t\trf_debugprint_buf[idx].cstring = s;\n\t\trf_debugprint_buf[idx].a1 = a1;\n\t\trf_debugprint_buf[idx].a2 = a2;\n\t\trf_debugprint_buf[idx].a3 = a3;\n\t\trf_debugprint_buf[idx].a4 = a4;\n\t\trf_debugprint_buf[idx].a5 = a5;\n\t\trf_debugprint_buf[idx].a6 = a6;\n\t\trf_debugprint_buf[idx].a7 = a7;\n\t\trf_debugprint_buf[idx].a8 = a8;\n\t} else {\n\t\tprintf(s, a1, a2, a3, a4, a5, a6, a7, a8);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <dev/isa/isavar.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/termios.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\nint rtfpsprint;\n\nint\nrtfpsprint(aux, pnp)\n\tvoid *aux;\n\tconst char *pnp;\n{\n\tstruct commulti_attach_args *ca = aux;\n\n\tif (pnp)\n\t\tprintf(\"com at %s\", pnp);\n\tprintf(\" slave %d\", ca->ca_slave);\n\treturn (UNCONF);\n}"
  },
  {
    "function_name": "rtfpsprobe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/isa/rtfps.c",
    "lines": "78-128",
    "snippet": "int\nrtfpsprobe(parent, self, aux)\n\tstruct device *parent;\n\tvoid *self;\n\tvoid *aux;\n{\n\tstruct isa_attach_args *ia = aux;\n\tint iobase = ia->ia_iobase;\n\tbus_space_tag_t iot = ia->ia_iot;\n\tbus_space_handle_t ioh;\n\tint i, rv = 1;\n\n\t/*\n\t * Do the normal com probe for the first UART and assume\n\t * its presence, and the ability to map the other UARTS,\n\t * means there is a multiport board there.\n\t * XXX Needs more robustness.\n\t */\n\n\t/* if the first port is in use as console, then it. */\n\tif (iobase == comconsaddr && !comconsattached)\n\t\tgoto checkmappings;\n\n\tif (bus_space_map(iot, iobase, COM_NPORTS, 0, &ioh)) {\n\t\trv = 0;\n\t\tgoto out;\n\t}\n\trv = comprobe1(iot, ioh);\n\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\tif (rv == 0)\n\t\tgoto out;\n\ncheckmappings:\n\tfor (i = 1; i < NSLAVES; i++) {\n\t\tiobase += COM_NPORTS;\n\n\t\tif (iobase == comconsaddr && !comconsattached)\n\t\t\tcontinue;\n\n\t\tif (bus_space_map(iot, iobase, COM_NPORTS, 0, &ioh)) {\n\t\t\trv = 0;\n\t\t\tgoto out;\n\t\t}\n\t\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\t}\n\nout:\n\tif (rv)\n\t\tia->ia_iosize = NSLAVES * COM_NPORTS;\n\treturn (rv);\n}",
    "includes": [
      "#include <dev/ic/comvar.h>",
      "#include <dev/ic/comreg.h>",
      "#include <dev/isa/isavar.h>",
      "#include <machine/intr.h>",
      "#include <machine/bus.h>",
      "#include <sys/termios.h>",
      "#include <sys/device.h>",
      "#include <sys/systm.h>",
      "#include <sys/param.h>"
    ],
    "macros_used": [
      "#define\tNSLAVES\t4"
    ],
    "globals_used": [
      "int rtfpsprobe"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_space_unmap",
          "args": [
            "iot",
            "ioh",
            "COM_NPORTS"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "iobase",
            "COM_NPORTS",
            "0",
            "&ioh"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bus_space_unmap",
          "args": [
            "iot",
            "ioh",
            "COM_NPORTS"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comprobe1",
          "args": [
            "iot",
            "ioh"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "comprobe1",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2023-40216/repo/sys/dev/ic/com.c",
          "lines": "220-241",
          "snippet": "int\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}",
          "includes": [
            "#include <dev/cons.h>",
            "#include <machine/remote-sl.h>",
            "#include <dev/isa/isavar.h>\t/* XXX */",
            "#include \"com.h\"",
            "#include <dev/ic/hayespreg.h>",
            "#include <dev/ic/ns16550reg.h>",
            "#include <dev/ic/comvar.h>",
            "#include <dev/ic/comreg.h>",
            "#include <machine/intr.h>",
            "#include <machine/bus.h>",
            "#include <ddb/db_var.h>",
            "#include <sys/vnode.h>",
            "#include <sys/device.h>",
            "#include <sys/types.h>",
            "#include <sys/syslog.h>",
            "#include <sys/kernel.h>",
            "#include <sys/uio.h>",
            "#include <sys/file.h>",
            "#include <sys/conf.h>",
            "#include <sys/user.h>",
            "#include <sys/proc.h>",
            "#include <sys/tty.h>",
            "#include <sys/select.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/systm.h>",
            "#include <sys/param.h>"
          ],
          "macros_used": [
            "#define\tcom_lcr\tcom_cfcr"
          ],
          "globals_used": [
            "bus_space_tag_t iot;",
            "bus_space_handle_t ioh;",
            "bus_space_tag_t iot = sc->sc_iot;",
            "bus_space_handle_t ioh = sc->sc_ioh;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <dev/cons.h>\n#include <machine/remote-sl.h>\n#include <dev/isa/isavar.h>\t/* XXX */\n#include \"com.h\"\n#include <dev/ic/hayespreg.h>\n#include <dev/ic/ns16550reg.h>\n#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <ddb/db_var.h>\n#include <sys/vnode.h>\n#include <sys/device.h>\n#include <sys/types.h>\n#include <sys/syslog.h>\n#include <sys/kernel.h>\n#include <sys/uio.h>\n#include <sys/file.h>\n#include <sys/conf.h>\n#include <sys/user.h>\n#include <sys/proc.h>\n#include <sys/tty.h>\n#include <sys/select.h>\n#include <sys/ioctl.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tcom_lcr\tcom_cfcr\n\nbus_space_tag_t iot;\nbus_space_handle_t ioh;\nbus_space_tag_t iot = sc->sc_iot;\nbus_space_handle_t ioh = sc->sc_ioh;\n\nint\ncomprobe1(iot, ioh)\n\tbus_space_tag_t iot;\n\tbus_space_handle_t ioh;\n{\n\tint i, k;\n\n\t/* force access to id reg */\n\tbus_space_write_1(iot, ioh, com_lcr, 0);\n\tbus_space_write_1(iot, ioh, com_iir, 0);\n\tfor (i = 0; i < 32; i++) {\n\t    k = bus_space_read_1(iot, ioh, com_iir);\n\t    if (k & 0x38) {\n\t\tbus_space_read_1(iot, ioh, com_data); /* cleanup */\n\t    } else\n\t\tbreak;\n\t}\n\tif (i >= 32) \n\t    return 0;\n\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bus_space_map",
          "args": [
            "iot",
            "iobase",
            "COM_NPORTS",
            "0",
            "&ioh"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <dev/ic/comvar.h>\n#include <dev/ic/comreg.h>\n#include <dev/isa/isavar.h>\n#include <machine/intr.h>\n#include <machine/bus.h>\n#include <sys/termios.h>\n#include <sys/device.h>\n#include <sys/systm.h>\n#include <sys/param.h>\n\n#define\tNSLAVES\t4\n\nint rtfpsprobe;\n\nint\nrtfpsprobe(parent, self, aux)\n\tstruct device *parent;\n\tvoid *self;\n\tvoid *aux;\n{\n\tstruct isa_attach_args *ia = aux;\n\tint iobase = ia->ia_iobase;\n\tbus_space_tag_t iot = ia->ia_iot;\n\tbus_space_handle_t ioh;\n\tint i, rv = 1;\n\n\t/*\n\t * Do the normal com probe for the first UART and assume\n\t * its presence, and the ability to map the other UARTS,\n\t * means there is a multiport board there.\n\t * XXX Needs more robustness.\n\t */\n\n\t/* if the first port is in use as console, then it. */\n\tif (iobase == comconsaddr && !comconsattached)\n\t\tgoto checkmappings;\n\n\tif (bus_space_map(iot, iobase, COM_NPORTS, 0, &ioh)) {\n\t\trv = 0;\n\t\tgoto out;\n\t}\n\trv = comprobe1(iot, ioh);\n\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\tif (rv == 0)\n\t\tgoto out;\n\ncheckmappings:\n\tfor (i = 1; i < NSLAVES; i++) {\n\t\tiobase += COM_NPORTS;\n\n\t\tif (iobase == comconsaddr && !comconsattached)\n\t\t\tcontinue;\n\n\t\tif (bus_space_map(iot, iobase, COM_NPORTS, 0, &ioh)) {\n\t\t\trv = 0;\n\t\t\tgoto out;\n\t\t}\n\t\tbus_space_unmap(iot, ioh, COM_NPORTS);\n\t}\n\nout:\n\tif (rv)\n\t\tia->ia_iosize = NSLAVES * COM_NPORTS;\n\treturn (rv);\n}"
  }
]