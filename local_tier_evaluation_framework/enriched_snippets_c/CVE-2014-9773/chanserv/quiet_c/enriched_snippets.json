[
  {
    "function_name": "cs_cmd_unquiet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "361-472",
    "snippet": "static void cs_cmd_unquiet(sourceinfo_t *si, int parc, char *parv[])\n{\n        const char *channel = parv[0];\n        const char *target = parv[1];\n\tchar banlike_char = get_quiet_ban_char();\n        channel_t *c = channel_find(channel);\n\tmychan_t *mc = mychan_find(channel);\n\tuser_t *tu;\n\tchanban_t *cb;\n\tchar *targetlist;\n\tchar *strtokctx;\n\tchar target_extban[BUFSIZE];\n\n\tif (!channel)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"UNQUIET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: UNQUIET <#channel> <nickname|hostmask> [...]\"));\n\t\treturn;\n\t}\n\n\tif (!target)\n\t{\n\t\tif (si->su == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"UNQUIET\");\n\t\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: UNQUIET <#channel> <nickname|hostmask> [...]\"));\n\t\t\treturn;\n\t\t}\n\t\ttarget = si->su->nick;\n\t}\n\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!c)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is currently empty.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_REMOVE) &&\n\t\t\t(si->su == NULL ||\n\t\t\t !chanacs_source_has_flag(mc, si, CA_EXEMPT) ||\n\t\t\t irccasecmp(target, si->su->nick)))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\ttargetlist = strdup(target);\n\ttarget = strtok_r(targetlist, \" \", &strtokctx);\n\tdo\n\t{\n\t\tif ((tu = user_find_named(target)))\n\t\t{\n\t\t\tmowgli_node_t *n, *tn;\n\t\t\tchar hostbuf2[BUFSIZE];\n\t\t\tint count = 0;\n\n\t\t\tmake_extban(hostbuf2, sizeof hostbuf2, tu);\n\t\t\tfor (n = next_matching_ban(c, tu, banlike_char, c->bans.head); n != NULL; n = next_matching_ban(c, tu, banlike_char, tn))\n\t\t\t{\n\t\t\t\ttn = n->next;\n\t\t\t\tcb = n->data;\n\n\t\t\t\tlogcommand(si, CMDLOG_DO, \"UNQUIET: \\2%s\\2 on \\2%s\\2 (for user \\2%s\\2)\", cb->mask, mc->name, hostbuf2);\n\t\t\t\tmodestack_mode_param(chansvs.nick, c, MTYPE_DEL, cb->type, cb->mask);\n\t\t\t\tchanban_delete(cb);\n\t\t\t\tcount++;\n\t\t\t}\n\t\t\tif (count > 0)\n\t\t\t{\n\t\t\t\t/* one notification only */\n\t\t\t\tif (chanuser_find(c, tu))\n\t\t\t\t\tnotify_one_victim(si, c, tu, MTYPE_DEL);\n\t\t\t\tcommand_success_nodata(si, _(\"Unquieted \\2%s\\2 on \\2%s\\2 (%d quiet%s removed).\"),\n\t\t\t\t\ttarget, channel, count, (count != 1 ? \"s\" : \"\"));\n\t\t\t}\n\t\t\telse\n\t\t\t\tcommand_success_nodata(si, _(\"No quiets found matching \\2%s\\2 on \\2%s\\2.\"), target, channel);\n\t\t\tcontinue;\n\t\t}\n\t\telse if (make_extbanmask(target_extban, sizeof target_extban, target),\n\t\t\t\t(cb = chanban_find(c, target_extban, banlike_char)) != NULL ||\n\t\t\t\tvalidhostmask(target))\n\t\t{\n\t\t\tif (cb != NULL)\n\t\t\t{\n\t\t\t\tmodestack_mode_param(chansvs.nick, c, MTYPE_DEL, banlike_char, cb->mask);\n\t\t\t\tnotify_victims(si, c, cb, MTYPE_DEL);\n\t\t\t\tchanban_delete(cb);\n\t\t\t\tlogcommand(si, CMDLOG_DO, \"UNQUIET: \\2%s\\2 on \\2%s\\2\", target_extban, mc->name);\n\t\t\t\tif (si->su == NULL || !chanuser_find(mc->chan, si->su))\n\t\t\t\t\tcommand_success_nodata(si, _(\"Unquieted \\2%s\\2 on \\2%s\\2.\"), target_extban, channel);\n\t\t\t}\n\t\t\telse\n\t\t\t\tcommand_fail(si, fault_nosuch_key, _(\"No such quiet \\2%s\\2 on \\2%s\\2.\"), target_extban, channel);\n\n\t\t\tcontinue;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"Invalid nickname/hostmask provided: \\2%s\\2\"), target);\n\t\t\tcommand_fail(si, fault_badparams, _(\"Syntax: UNQUIET <#channel> [nickname|hostmask] [...]\"));\n\t\t\tcontinue;\n\t\t}\n\t} while ((target = strtok_r(NULL, \" \", &strtokctx)) != NULL);\n\tfree(targetlist);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_quiet(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_unquiet(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "targetlist"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\" \"",
            "&strtokctx"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Syntax: UNQUIET <#channel> [nickname|hostmask] [...]\")"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Syntax: UNQUIET <#channel> [nickname|hostmask] [...]\""
          ],
          "line": 467
        },
        "resolved": true,
        "details": {
          "function_name": "strip_extban",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "66-73",
          "snippet": "static char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Invalid nickname/hostmask provided: \\2%s\\2\")",
            "target"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_key",
            "_(\"No such quiet \\2%s\\2 on \\2%s\\2.\")",
            "target_extban",
            "channel"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Unquieted \\2%s\\2 on \\2%s\\2.\")",
            "target_extban",
            "channel"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanuser_find",
          "args": [
            "mc->chan",
            "si->su"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_DO",
            "\"UNQUIET: \\2%s\\2 on \\2%s\\2\"",
            "target_extban",
            "mc->name"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanban_delete",
          "args": [
            "cb"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notify_victims",
          "args": [
            "si",
            "c",
            "cb",
            "MTYPE_DEL"
          ],
          "line": 453
        },
        "resolved": true,
        "details": {
          "function_name": "notify_victims",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "203-264",
          "snippet": "static void notify_victims(sourceinfo_t *si, channel_t *c, chanban_t *cb, int dir)\n{\n\tmowgli_node_t *n;\n\tchanuser_t *cu;\n\tchanban_t tmpban;\n\tmowgli_list_t ban_l = { NULL, NULL, 0 };\n\tmowgli_node_t ban_n;\n\tuser_t *to_notify[MAX_SINGLE_NOTIFY];\n\tunsigned int to_notify_count = 0, i;\n\tchar banlike_char = get_quiet_ban_char();\n\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\tif (cb == NULL)\n\t\treturn;\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\n\t/* some ircds use an action extban for mute\n\t * strip it from those who do so we can reliably match users */\n\tmemcpy(&tmpban, cb, sizeof(chanban_t));\n\ttmpban.mask = strip_extban(cb->mask);\n\n\t/* only check the newly added/removed quiet */\n\tmowgli_node_add(&tmpban, &ban_n, &ban_l);\n\n\tMOWGLI_ITER_FOREACH(n, c->members.head)\n\t{\n\t\tcu = n->data;\n\t\tif (cu->modes & (CSTATUS_OP | CSTATUS_VOICE))\n\t\t\tcontinue;\n\t\tif (is_internal_client(cu->user))\n\t\t\tcontinue;\n\t\tif (cu->user == si->su)\n\t\t\tcontinue;\n\t\tif (next_matching_ban(c, cu->user, banlike_char, &ban_n))\n\t\t{\n\t\t\tto_notify[to_notify_count++] = cu->user;\n\t\t\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t{\n\t\tif (dir == MTYPE_ADD)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 quieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t\telse if (dir == MTYPE_DEL)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 unquieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t}\n\telse\n\t\tfor (i = 0; i < to_notify_count; i++)\n\t\t\tnotify_one_victim(si, c, to_notify[i], dir);\n\n\tfree(tmpban.mask);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [
            "#define MAX_SINGLE_NOTIFY 3"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\n#define MAX_SINGLE_NOTIFY 3\n\nstatic void notify_victims(sourceinfo_t *si, channel_t *c, chanban_t *cb, int dir)\n{\n\tmowgli_node_t *n;\n\tchanuser_t *cu;\n\tchanban_t tmpban;\n\tmowgli_list_t ban_l = { NULL, NULL, 0 };\n\tmowgli_node_t ban_n;\n\tuser_t *to_notify[MAX_SINGLE_NOTIFY];\n\tunsigned int to_notify_count = 0, i;\n\tchar banlike_char = get_quiet_ban_char();\n\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\tif (cb == NULL)\n\t\treturn;\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\n\t/* some ircds use an action extban for mute\n\t * strip it from those who do so we can reliably match users */\n\tmemcpy(&tmpban, cb, sizeof(chanban_t));\n\ttmpban.mask = strip_extban(cb->mask);\n\n\t/* only check the newly added/removed quiet */\n\tmowgli_node_add(&tmpban, &ban_n, &ban_l);\n\n\tMOWGLI_ITER_FOREACH(n, c->members.head)\n\t{\n\t\tcu = n->data;\n\t\tif (cu->modes & (CSTATUS_OP | CSTATUS_VOICE))\n\t\t\tcontinue;\n\t\tif (is_internal_client(cu->user))\n\t\t\tcontinue;\n\t\tif (cu->user == si->su)\n\t\t\tcontinue;\n\t\tif (next_matching_ban(c, cu->user, banlike_char, &ban_n))\n\t\t{\n\t\t\tto_notify[to_notify_count++] = cu->user;\n\t\t\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t{\n\t\tif (dir == MTYPE_ADD)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 quieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t\telse if (dir == MTYPE_DEL)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 unquieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t}\n\telse\n\t\tfor (i = 0; i < to_notify_count; i++)\n\t\t\tnotify_one_victim(si, c, to_notify[i], dir);\n\n\tfree(tmpban.mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "modestack_mode_param",
          "args": [
            "chansvs.nick",
            "c",
            "MTYPE_DEL",
            "banlike_char",
            "cb->mask"
          ],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "validhostmask",
          "args": [
            "target"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanban_find",
          "args": [
            "c",
            "target_extban",
            "banlike_char"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_extbanmask",
          "args": [
            "target_extban",
            "sizeof target_extban",
            "target"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "make_extbanmask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "39-58",
          "snippet": "static void make_extbanmask(char *buf, size_t buflen, const char *mask)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(mask != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", buflen);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", buflen);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, mask, buflen);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void make_extbanmask(char *buf, size_t buflen, const char *mask)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(mask != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", buflen);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", buflen);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, mask, buflen);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"No quiets found matching \\2%s\\2 on \\2%s\\2.\")",
            "target",
            "channel"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Unquieted \\2%s\\2 on \\2%s\\2 (%d quiet%s removed).\")",
            "target",
            "channel",
            "count",
            "(count != 1 ? \"s\" : \"\")"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notify_one_victim",
          "args": [
            "si",
            "c",
            "tu",
            "MTYPE_DEL"
          ],
          "line": 438
        },
        "resolved": true,
        "details": {
          "function_name": "notify_one_victim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "182-201",
          "snippet": "static void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}"
        }
      },
      {
        "call_info": {
          "callee": "chanuser_find",
          "args": [
            "c",
            "tu"
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanban_delete",
          "args": [
            "cb"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "modestack_mode_param",
          "args": [
            "chansvs.nick",
            "c",
            "MTYPE_DEL",
            "cb->type",
            "cb->mask"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_DO",
            "\"UNQUIET: \\2%s\\2 on \\2%s\\2 (for user \\2%s\\2)\"",
            "cb->mask",
            "mc->name",
            "hostbuf2"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "next_matching_ban",
          "args": [
            "c",
            "tu",
            "banlike_char",
            "tn"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "next_matching_ban",
          "args": [
            "c",
            "tu",
            "banlike_char",
            "c->bans.head"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_extban",
          "args": [
            "hostbuf2",
            "sizeof hostbuf2",
            "tu"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "make_extban",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "89-112",
          "snippet": "static void make_extban(char *buf, size_t size, user_t *tu)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(tu != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", size);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", size);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, tu->nick, size);\n\tmowgli_strlcat(buf, \"!\", size);\n\tmowgli_strlcat(buf, tu->user, size);\n\tmowgli_strlcat(buf, \"@\", size);\n\tmowgli_strlcat(buf, tu->vhost, size);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void make_extban(char *buf, size_t size, user_t *tu)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(tu != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", size);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", size);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, tu->nick, size);\n\tmowgli_strlcat(buf, \"!\", size);\n\tmowgli_strlcat(buf, tu->user, size);\n\tmowgli_strlcat(buf, \"@\", size);\n\tmowgli_strlcat(buf, tu->vhost, size);\n}"
        }
      },
      {
        "call_info": {
          "callee": "user_find_named",
          "args": [
            "target"
          ],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "targetlist",
            "\" \"",
            "&strtokctx"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "target"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "irccasecmp",
          "args": [
            "target",
            "si->su->nick"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_EXEMPT"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_REMOVE"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"\\2%s\\2 is currently empty.\")",
            "channel"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: UNQUIET <#channel> <nickname|hostmask> [...]\")"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"UNQUIET\""
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: UNQUIET <#channel> <nickname|hostmask> [...]\")"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"UNQUIET\""
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "channel_find",
          "args": [
            "channel"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_quiet_ban_char",
          "args": [],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "get_quiet_ban_char",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "60-64",
          "snippet": "static char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_quiet(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_unquiet(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_unquiet(sourceinfo_t *si, int parc, char *parv[])\n{\n        const char *channel = parv[0];\n        const char *target = parv[1];\n\tchar banlike_char = get_quiet_ban_char();\n        channel_t *c = channel_find(channel);\n\tmychan_t *mc = mychan_find(channel);\n\tuser_t *tu;\n\tchanban_t *cb;\n\tchar *targetlist;\n\tchar *strtokctx;\n\tchar target_extban[BUFSIZE];\n\n\tif (!channel)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"UNQUIET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: UNQUIET <#channel> <nickname|hostmask> [...]\"));\n\t\treturn;\n\t}\n\n\tif (!target)\n\t{\n\t\tif (si->su == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"UNQUIET\");\n\t\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: UNQUIET <#channel> <nickname|hostmask> [...]\"));\n\t\t\treturn;\n\t\t}\n\t\ttarget = si->su->nick;\n\t}\n\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!c)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is currently empty.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_REMOVE) &&\n\t\t\t(si->su == NULL ||\n\t\t\t !chanacs_source_has_flag(mc, si, CA_EXEMPT) ||\n\t\t\t irccasecmp(target, si->su->nick)))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\ttargetlist = strdup(target);\n\ttarget = strtok_r(targetlist, \" \", &strtokctx);\n\tdo\n\t{\n\t\tif ((tu = user_find_named(target)))\n\t\t{\n\t\t\tmowgli_node_t *n, *tn;\n\t\t\tchar hostbuf2[BUFSIZE];\n\t\t\tint count = 0;\n\n\t\t\tmake_extban(hostbuf2, sizeof hostbuf2, tu);\n\t\t\tfor (n = next_matching_ban(c, tu, banlike_char, c->bans.head); n != NULL; n = next_matching_ban(c, tu, banlike_char, tn))\n\t\t\t{\n\t\t\t\ttn = n->next;\n\t\t\t\tcb = n->data;\n\n\t\t\t\tlogcommand(si, CMDLOG_DO, \"UNQUIET: \\2%s\\2 on \\2%s\\2 (for user \\2%s\\2)\", cb->mask, mc->name, hostbuf2);\n\t\t\t\tmodestack_mode_param(chansvs.nick, c, MTYPE_DEL, cb->type, cb->mask);\n\t\t\t\tchanban_delete(cb);\n\t\t\t\tcount++;\n\t\t\t}\n\t\t\tif (count > 0)\n\t\t\t{\n\t\t\t\t/* one notification only */\n\t\t\t\tif (chanuser_find(c, tu))\n\t\t\t\t\tnotify_one_victim(si, c, tu, MTYPE_DEL);\n\t\t\t\tcommand_success_nodata(si, _(\"Unquieted \\2%s\\2 on \\2%s\\2 (%d quiet%s removed).\"),\n\t\t\t\t\ttarget, channel, count, (count != 1 ? \"s\" : \"\"));\n\t\t\t}\n\t\t\telse\n\t\t\t\tcommand_success_nodata(si, _(\"No quiets found matching \\2%s\\2 on \\2%s\\2.\"), target, channel);\n\t\t\tcontinue;\n\t\t}\n\t\telse if (make_extbanmask(target_extban, sizeof target_extban, target),\n\t\t\t\t(cb = chanban_find(c, target_extban, banlike_char)) != NULL ||\n\t\t\t\tvalidhostmask(target))\n\t\t{\n\t\t\tif (cb != NULL)\n\t\t\t{\n\t\t\t\tmodestack_mode_param(chansvs.nick, c, MTYPE_DEL, banlike_char, cb->mask);\n\t\t\t\tnotify_victims(si, c, cb, MTYPE_DEL);\n\t\t\t\tchanban_delete(cb);\n\t\t\t\tlogcommand(si, CMDLOG_DO, \"UNQUIET: \\2%s\\2 on \\2%s\\2\", target_extban, mc->name);\n\t\t\t\tif (si->su == NULL || !chanuser_find(mc->chan, si->su))\n\t\t\t\t\tcommand_success_nodata(si, _(\"Unquieted \\2%s\\2 on \\2%s\\2.\"), target_extban, channel);\n\t\t\t}\n\t\t\telse\n\t\t\t\tcommand_fail(si, fault_nosuch_key, _(\"No such quiet \\2%s\\2 on \\2%s\\2.\"), target_extban, channel);\n\n\t\t\tcontinue;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"Invalid nickname/hostmask provided: \\2%s\\2\"), target);\n\t\t\tcommand_fail(si, fault_badparams, _(\"Syntax: UNQUIET <#channel> [nickname|hostmask] [...]\"));\n\t\t\tcontinue;\n\t\t}\n\t} while ((target = strtok_r(NULL, \" \", &strtokctx)) != NULL);\n\tfree(targetlist);\n}"
  },
  {
    "function_name": "cs_cmd_quiet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "266-359",
    "snippet": "static void cs_cmd_quiet(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchar *channel = parv[0];\n\tchar *target = parv[1];\n\tchar *newtarget;\n\tchannel_t *c = channel_find(channel);\n\tmychan_t *mc = mychan_find(channel);\n\tuser_t *tu;\n\tchanban_t *cb;\n\tint n;\n\tchar *targetlist;\n\tchar *strtokctx = NULL;\n\tenum devoice_result devoice_result;\n\n\tif (!channel || !target)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"QUIET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: QUIET <#channel> <nickname|hostmask> [...]\"));\n\t\treturn;\n\t}\n\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!c)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is currently empty.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_REMOVE))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (metadata_find(mc, \"private:close:closer\"))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"\\2%s\\2 is closed.\"), channel);\n\t\treturn;\n\t}\n\n\ttargetlist = strdup(target);\n\ttarget = strtok_r(targetlist, \" \", &strtokctx);\n\tdo\n\t{\n\t\tif ((tu = user_find_named(target)))\n\t\t{\n\t\t\tchar hostbuf[BUFSIZE];\n\n\t\t\tdevoice_result = devoice_user(si, mc, c, tu);\n\t\t\tif (devoice_result == DEVOICE_FAILED)\n\t\t\t\tcontinue;\n\n\t\t\thostbuf[0] = '\\0';\n\n\t\t\tmowgli_strlcat(hostbuf, \"*!*@\", BUFSIZE);\n\t\t\tmowgli_strlcat(hostbuf, tu->vhost, BUFSIZE);\n\n\t\t\tcb = place_quietmask(c, MTYPE_ADD, hostbuf);\n\t\t\tn = remove_ban_exceptions(si->service->me, c, tu);\n\t\t\tif (n > 0)\n\t\t\t\tcommand_success_nodata(si, _(\"To ensure the quiet takes effect, %d ban exception(s) matching \\2%s\\2 have been removed from \\2%s\\2.\"), n, tu->nick, c->name);\n\t\t\t/* Notify if we did anything. */\n\t\t\tif (cb != NULL)\n\t\t\t\tnotify_victims(si, c, cb, MTYPE_ADD);\n\t\t\telse if (devoice_result == DEVOICE_DONE || n > 0)\n\t\t\t\tnotify_one_victim(si, c, tu, MTYPE_ADD);\n\t\t\tlogcommand(si, CMDLOG_DO, \"QUIET: \\2%s\\2 on \\2%s\\2 (for user \\2%s!%s@%s\\2)\", hostbuf, mc->name, tu->nick, tu->user, tu->vhost);\n\t\t\tif (si->su == NULL || !chanuser_find(mc->chan, si->su))\n\t\t\t\tcommand_success_nodata(si, _(\"Quieted \\2%s\\2 on \\2%s\\2.\"), target, channel);\n\t\t\tcontinue;\n\t\t}\n\t\telse if ((is_extban(target) && (newtarget = target)) || ((newtarget = pretty_mask(target)) && validhostmask(newtarget)))\n\t\t{\n\t\t\tcb = place_quietmask(c, MTYPE_ADD, newtarget);\n\t\t\tnotify_victims(si, c, cb, MTYPE_ADD);\n\t\t\tlogcommand(si, CMDLOG_DO, \"QUIET: \\2%s\\2 on \\2%s\\2\", newtarget, mc->name);\n\t\t\tif (si->su == NULL || !chanuser_find(mc->chan, si->su))\n\t\t\t\tcommand_success_nodata(si, _(\"Quieted \\2%s\\2 on \\2%s\\2.\"), newtarget, channel);\n\t\t\tcontinue;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"Invalid nickname/hostmask provided: \\2%s\\2\"), target);\n\t\t\tcommand_fail(si, fault_badparams, _(\"Syntax: QUIET <#channel> <nickname|hostmask> [,,,]\"));\n\t\t\tcontinue;\n\t\t}\n\t} while ((target = strtok_r(NULL, \" \", &strtokctx)) != NULL);\n\tfree(targetlist);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_quiet(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_unquiet(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "targetlist"
          ],
          "line": 358
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "NULL",
            "\" \"",
            "&strtokctx"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Syntax: QUIET <#channel> <nickname|hostmask> [,,,]\")"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Syntax: QUIET <#channel> <nickname|hostmask> [,,,]\""
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "strip_extban",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "66-73",
          "snippet": "static char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Invalid nickname/hostmask provided: \\2%s\\2\")",
            "target"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Quieted \\2%s\\2 on \\2%s\\2.\")",
            "newtarget",
            "channel"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanuser_find",
          "args": [
            "mc->chan",
            "si->su"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_DO",
            "\"QUIET: \\2%s\\2 on \\2%s\\2\"",
            "newtarget",
            "mc->name"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notify_victims",
          "args": [
            "si",
            "c",
            "cb",
            "MTYPE_ADD"
          ],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "notify_victims",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "203-264",
          "snippet": "static void notify_victims(sourceinfo_t *si, channel_t *c, chanban_t *cb, int dir)\n{\n\tmowgli_node_t *n;\n\tchanuser_t *cu;\n\tchanban_t tmpban;\n\tmowgli_list_t ban_l = { NULL, NULL, 0 };\n\tmowgli_node_t ban_n;\n\tuser_t *to_notify[MAX_SINGLE_NOTIFY];\n\tunsigned int to_notify_count = 0, i;\n\tchar banlike_char = get_quiet_ban_char();\n\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\tif (cb == NULL)\n\t\treturn;\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\n\t/* some ircds use an action extban for mute\n\t * strip it from those who do so we can reliably match users */\n\tmemcpy(&tmpban, cb, sizeof(chanban_t));\n\ttmpban.mask = strip_extban(cb->mask);\n\n\t/* only check the newly added/removed quiet */\n\tmowgli_node_add(&tmpban, &ban_n, &ban_l);\n\n\tMOWGLI_ITER_FOREACH(n, c->members.head)\n\t{\n\t\tcu = n->data;\n\t\tif (cu->modes & (CSTATUS_OP | CSTATUS_VOICE))\n\t\t\tcontinue;\n\t\tif (is_internal_client(cu->user))\n\t\t\tcontinue;\n\t\tif (cu->user == si->su)\n\t\t\tcontinue;\n\t\tif (next_matching_ban(c, cu->user, banlike_char, &ban_n))\n\t\t{\n\t\t\tto_notify[to_notify_count++] = cu->user;\n\t\t\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t{\n\t\tif (dir == MTYPE_ADD)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 quieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t\telse if (dir == MTYPE_DEL)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 unquieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t}\n\telse\n\t\tfor (i = 0; i < to_notify_count; i++)\n\t\t\tnotify_one_victim(si, c, to_notify[i], dir);\n\n\tfree(tmpban.mask);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [
            "#define MAX_SINGLE_NOTIFY 3"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\n#define MAX_SINGLE_NOTIFY 3\n\nstatic void notify_victims(sourceinfo_t *si, channel_t *c, chanban_t *cb, int dir)\n{\n\tmowgli_node_t *n;\n\tchanuser_t *cu;\n\tchanban_t tmpban;\n\tmowgli_list_t ban_l = { NULL, NULL, 0 };\n\tmowgli_node_t ban_n;\n\tuser_t *to_notify[MAX_SINGLE_NOTIFY];\n\tunsigned int to_notify_count = 0, i;\n\tchar banlike_char = get_quiet_ban_char();\n\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\tif (cb == NULL)\n\t\treturn;\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\n\t/* some ircds use an action extban for mute\n\t * strip it from those who do so we can reliably match users */\n\tmemcpy(&tmpban, cb, sizeof(chanban_t));\n\ttmpban.mask = strip_extban(cb->mask);\n\n\t/* only check the newly added/removed quiet */\n\tmowgli_node_add(&tmpban, &ban_n, &ban_l);\n\n\tMOWGLI_ITER_FOREACH(n, c->members.head)\n\t{\n\t\tcu = n->data;\n\t\tif (cu->modes & (CSTATUS_OP | CSTATUS_VOICE))\n\t\t\tcontinue;\n\t\tif (is_internal_client(cu->user))\n\t\t\tcontinue;\n\t\tif (cu->user == si->su)\n\t\t\tcontinue;\n\t\tif (next_matching_ban(c, cu->user, banlike_char, &ban_n))\n\t\t{\n\t\t\tto_notify[to_notify_count++] = cu->user;\n\t\t\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t{\n\t\tif (dir == MTYPE_ADD)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 quieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t\telse if (dir == MTYPE_DEL)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 unquieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t}\n\telse\n\t\tfor (i = 0; i < to_notify_count; i++)\n\t\t\tnotify_one_victim(si, c, to_notify[i], dir);\n\n\tfree(tmpban.mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "place_quietmask",
          "args": [
            "c",
            "MTYPE_ADD",
            "newtarget"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "place_quietmask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "75-87",
          "snippet": "chanban_t *place_quietmask(channel_t *c, int dir, const char *hostbuf)\n{\n\tchar rhostbuf[BUFSIZE];\n\tchanban_t *cb = NULL;\n\tchar banlike_char = get_quiet_ban_char();\n\n\tmake_extbanmask(rhostbuf, sizeof rhostbuf, hostbuf);\n\tmodestack_mode_param(chansvs.nick, c, MTYPE_ADD, banlike_char,\n\t\t\trhostbuf);\n\tcb = chanban_add(c, rhostbuf, banlike_char);\n\n\treturn cb;\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nchanban_t *place_quietmask(channel_t *c, int dir, const char *hostbuf)\n{\n\tchar rhostbuf[BUFSIZE];\n\tchanban_t *cb = NULL;\n\tchar banlike_char = get_quiet_ban_char();\n\n\tmake_extbanmask(rhostbuf, sizeof rhostbuf, hostbuf);\n\tmodestack_mode_param(chansvs.nick, c, MTYPE_ADD, banlike_char,\n\t\t\trhostbuf);\n\tcb = chanban_add(c, rhostbuf, banlike_char);\n\n\treturn cb;\n}"
        }
      },
      {
        "call_info": {
          "callee": "validhostmask",
          "args": [
            "newtarget"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pretty_mask",
          "args": [
            "target"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_extban",
          "args": [
            "target"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Quieted \\2%s\\2 on \\2%s\\2.\")",
            "target",
            "channel"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanuser_find",
          "args": [
            "mc->chan",
            "si->su"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_DO",
            "\"QUIET: \\2%s\\2 on \\2%s\\2 (for user \\2%s!%s@%s\\2)\"",
            "hostbuf",
            "mc->name",
            "tu->nick",
            "tu->user",
            "tu->vhost"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notify_one_victim",
          "args": [
            "si",
            "c",
            "tu",
            "MTYPE_ADD"
          ],
          "line": 336
        },
        "resolved": true,
        "details": {
          "function_name": "notify_one_victim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "182-201",
          "snippet": "static void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"To ensure the quiet takes effect, %d ban exception(s) matching \\2%s\\2 have been removed from \\2%s\\2.\")",
            "n",
            "tu->nick",
            "c->name"
          ],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove_ban_exceptions",
          "args": [
            "si->service->me",
            "c",
            "tu"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "hostbuf",
            "tu->vhost",
            "BUFSIZE"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "hostbuf",
            "\"*!*@\"",
            "BUFSIZE"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "devoice_user",
          "args": [
            "si",
            "mc",
            "c",
            "tu"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "devoice_user",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "116-177",
          "snippet": "static enum devoice_result\ndevoice_user(sourceinfo_t *si, mychan_t *mc, channel_t *c, user_t *tu)\n{\n\tchanuser_t *cu;\n\tunsigned int flag;\n\tchar buf[3];\n\tenum devoice_result result = DEVOICE_NO_ACTION;\n\n\tcu = chanuser_find(c, tu);\n\tif (cu == NULL)\n\t\treturn DEVOICE_NO_ACTION;\n\tif (cu->modes & CSTATUS_OP)\n\t\tflag = CA_OP;\n\telse if (cu->modes & CSTATUS_VOICE)\n\t\tflag = CA_VOICE;\n\telse\n\t\tflag = 0;\n\tif (flag != 0 && !chanacs_source_has_flag(mc, si, flag))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tif (cu->modes & CSTATUS_OWNER || cu->modes & CSTATUS_PROTECT)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"\\2%s\\2 is protected from quiets; you cannot quiet them.\"), tu->nick);\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tbuf[0] = '-';\n\tbuf[2] = '\\0';\n\tif (cu->modes & CSTATUS_OP)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-o\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (cu->modes & CSTATUS_VOICE)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-v\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_owner && (cu->modes & ircd->owner_mode))\n\t{\n\t\tbuf[1] = ircd->owner_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_protect && (cu->modes & ircd->protect_mode))\n\t{\n\t\tbuf[1] = ircd->protect_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_halfops && (cu->modes & ircd->halfops_mode))\n\t{\n\t\tbuf[1] = ircd->halfops_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\n\treturn result;\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic enum devoice_result\ndevoice_user(sourceinfo_t *si, mychan_t *mc, channel_t *c, user_t *tu)\n{\n\tchanuser_t *cu;\n\tunsigned int flag;\n\tchar buf[3];\n\tenum devoice_result result = DEVOICE_NO_ACTION;\n\n\tcu = chanuser_find(c, tu);\n\tif (cu == NULL)\n\t\treturn DEVOICE_NO_ACTION;\n\tif (cu->modes & CSTATUS_OP)\n\t\tflag = CA_OP;\n\telse if (cu->modes & CSTATUS_VOICE)\n\t\tflag = CA_VOICE;\n\telse\n\t\tflag = 0;\n\tif (flag != 0 && !chanacs_source_has_flag(mc, si, flag))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tif (cu->modes & CSTATUS_OWNER || cu->modes & CSTATUS_PROTECT)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"\\2%s\\2 is protected from quiets; you cannot quiet them.\"), tu->nick);\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tbuf[0] = '-';\n\tbuf[2] = '\\0';\n\tif (cu->modes & CSTATUS_OP)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-o\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (cu->modes & CSTATUS_VOICE)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-v\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_owner && (cu->modes & ircd->owner_mode))\n\t{\n\t\tbuf[1] = ircd->owner_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_protect && (cu->modes & ircd->protect_mode))\n\t{\n\t\tbuf[1] = ircd->protect_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_halfops && (cu->modes & ircd->halfops_mode))\n\t{\n\t\tbuf[1] = ircd->halfops_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "user_find_named",
          "args": [
            "target"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok_r",
          "args": [
            "targetlist",
            "\" \"",
            "&strtokctx"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "target"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"\\2%s\\2 is closed.\")",
            "channel"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "metadata_find",
          "args": [
            "mc",
            "\"private:close:closer\""
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_REMOVE"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"\\2%s\\2 is currently empty.\")",
            "channel"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: QUIET <#channel> <nickname|hostmask> [...]\")"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"QUIET\""
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "channel_find",
          "args": [
            "channel"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_quiet(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_unquiet(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_quiet(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchar *channel = parv[0];\n\tchar *target = parv[1];\n\tchar *newtarget;\n\tchannel_t *c = channel_find(channel);\n\tmychan_t *mc = mychan_find(channel);\n\tuser_t *tu;\n\tchanban_t *cb;\n\tint n;\n\tchar *targetlist;\n\tchar *strtokctx = NULL;\n\tenum devoice_result devoice_result;\n\n\tif (!channel || !target)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"QUIET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: QUIET <#channel> <nickname|hostmask> [...]\"));\n\t\treturn;\n\t}\n\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!c)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is currently empty.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_REMOVE))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (metadata_find(mc, \"private:close:closer\"))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"\\2%s\\2 is closed.\"), channel);\n\t\treturn;\n\t}\n\n\ttargetlist = strdup(target);\n\ttarget = strtok_r(targetlist, \" \", &strtokctx);\n\tdo\n\t{\n\t\tif ((tu = user_find_named(target)))\n\t\t{\n\t\t\tchar hostbuf[BUFSIZE];\n\n\t\t\tdevoice_result = devoice_user(si, mc, c, tu);\n\t\t\tif (devoice_result == DEVOICE_FAILED)\n\t\t\t\tcontinue;\n\n\t\t\thostbuf[0] = '\\0';\n\n\t\t\tmowgli_strlcat(hostbuf, \"*!*@\", BUFSIZE);\n\t\t\tmowgli_strlcat(hostbuf, tu->vhost, BUFSIZE);\n\n\t\t\tcb = place_quietmask(c, MTYPE_ADD, hostbuf);\n\t\t\tn = remove_ban_exceptions(si->service->me, c, tu);\n\t\t\tif (n > 0)\n\t\t\t\tcommand_success_nodata(si, _(\"To ensure the quiet takes effect, %d ban exception(s) matching \\2%s\\2 have been removed from \\2%s\\2.\"), n, tu->nick, c->name);\n\t\t\t/* Notify if we did anything. */\n\t\t\tif (cb != NULL)\n\t\t\t\tnotify_victims(si, c, cb, MTYPE_ADD);\n\t\t\telse if (devoice_result == DEVOICE_DONE || n > 0)\n\t\t\t\tnotify_one_victim(si, c, tu, MTYPE_ADD);\n\t\t\tlogcommand(si, CMDLOG_DO, \"QUIET: \\2%s\\2 on \\2%s\\2 (for user \\2%s!%s@%s\\2)\", hostbuf, mc->name, tu->nick, tu->user, tu->vhost);\n\t\t\tif (si->su == NULL || !chanuser_find(mc->chan, si->su))\n\t\t\t\tcommand_success_nodata(si, _(\"Quieted \\2%s\\2 on \\2%s\\2.\"), target, channel);\n\t\t\tcontinue;\n\t\t}\n\t\telse if ((is_extban(target) && (newtarget = target)) || ((newtarget = pretty_mask(target)) && validhostmask(newtarget)))\n\t\t{\n\t\t\tcb = place_quietmask(c, MTYPE_ADD, newtarget);\n\t\t\tnotify_victims(si, c, cb, MTYPE_ADD);\n\t\t\tlogcommand(si, CMDLOG_DO, \"QUIET: \\2%s\\2 on \\2%s\\2\", newtarget, mc->name);\n\t\t\tif (si->su == NULL || !chanuser_find(mc->chan, si->su))\n\t\t\t\tcommand_success_nodata(si, _(\"Quieted \\2%s\\2 on \\2%s\\2.\"), newtarget, channel);\n\t\t\tcontinue;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"Invalid nickname/hostmask provided: \\2%s\\2\"), target);\n\t\t\tcommand_fail(si, fault_badparams, _(\"Syntax: QUIET <#channel> <nickname|hostmask> [,,,]\"));\n\t\t\tcontinue;\n\t\t}\n\t} while ((target = strtok_r(NULL, \" \", &strtokctx)) != NULL);\n\tfree(targetlist);\n}"
  },
  {
    "function_name": "notify_victims",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "203-264",
    "snippet": "static void notify_victims(sourceinfo_t *si, channel_t *c, chanban_t *cb, int dir)\n{\n\tmowgli_node_t *n;\n\tchanuser_t *cu;\n\tchanban_t tmpban;\n\tmowgli_list_t ban_l = { NULL, NULL, 0 };\n\tmowgli_node_t ban_n;\n\tuser_t *to_notify[MAX_SINGLE_NOTIFY];\n\tunsigned int to_notify_count = 0, i;\n\tchar banlike_char = get_quiet_ban_char();\n\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\tif (cb == NULL)\n\t\treturn;\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\n\t/* some ircds use an action extban for mute\n\t * strip it from those who do so we can reliably match users */\n\tmemcpy(&tmpban, cb, sizeof(chanban_t));\n\ttmpban.mask = strip_extban(cb->mask);\n\n\t/* only check the newly added/removed quiet */\n\tmowgli_node_add(&tmpban, &ban_n, &ban_l);\n\n\tMOWGLI_ITER_FOREACH(n, c->members.head)\n\t{\n\t\tcu = n->data;\n\t\tif (cu->modes & (CSTATUS_OP | CSTATUS_VOICE))\n\t\t\tcontinue;\n\t\tif (is_internal_client(cu->user))\n\t\t\tcontinue;\n\t\tif (cu->user == si->su)\n\t\t\tcontinue;\n\t\tif (next_matching_ban(c, cu->user, banlike_char, &ban_n))\n\t\t{\n\t\t\tto_notify[to_notify_count++] = cu->user;\n\t\t\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t{\n\t\tif (dir == MTYPE_ADD)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 quieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t\telse if (dir == MTYPE_DEL)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 unquieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t}\n\telse\n\t\tfor (i = 0; i < to_notify_count; i++)\n\t\t\tnotify_one_victim(si, c, to_notify[i], dir);\n\n\tfree(tmpban.mask);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [
      "#define MAX_SINGLE_NOTIFY 3"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "tmpban.mask"
          ],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_one_victim",
          "args": [
            "si",
            "c",
            "to_notify[i]",
            "dir"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "notify_one_victim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "182-201",
          "snippet": "static void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}"
        }
      },
      {
        "call_info": {
          "callee": "notice",
          "args": [
            "chansvs.nick",
            "c->name",
            "\"\\2%s\\2 unquieted \\2%s\\2\"",
            "get_source_name(si)",
            "tmpban.mask"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notice",
          "args": [
            "chansvs.nick",
            "c->name",
            "\"\\2%s\\2 quieted \\2%s\\2\"",
            "get_source_name(si)",
            "tmpban.mask"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "next_matching_ban",
          "args": [
            "c",
            "cu->user",
            "banlike_char",
            "&ban_n"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_internal_client",
          "args": [
            "cu->user"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "n",
            "c->members.head"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_node_add",
          "args": [
            "&tmpban",
            "&ban_n",
            "&ban_l"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strip_extban",
          "args": [
            "cb->mask"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "strip_extban",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "66-73",
          "snippet": "static char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&tmpban",
            "cb",
            "sizeof(chanban_t)"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "dir == MTYPE_ADD || dir == MTYPE_DEL"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_quiet_ban_char",
          "args": [],
          "line": 212
        },
        "resolved": true,
        "details": {
          "function_name": "get_quiet_ban_char",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "60-64",
          "snippet": "static char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\n#define MAX_SINGLE_NOTIFY 3\n\nstatic void notify_victims(sourceinfo_t *si, channel_t *c, chanban_t *cb, int dir)\n{\n\tmowgli_node_t *n;\n\tchanuser_t *cu;\n\tchanban_t tmpban;\n\tmowgli_list_t ban_l = { NULL, NULL, 0 };\n\tmowgli_node_t ban_n;\n\tuser_t *to_notify[MAX_SINGLE_NOTIFY];\n\tunsigned int to_notify_count = 0, i;\n\tchar banlike_char = get_quiet_ban_char();\n\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\tif (cb == NULL)\n\t\treturn;\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\n\t/* some ircds use an action extban for mute\n\t * strip it from those who do so we can reliably match users */\n\tmemcpy(&tmpban, cb, sizeof(chanban_t));\n\ttmpban.mask = strip_extban(cb->mask);\n\n\t/* only check the newly added/removed quiet */\n\tmowgli_node_add(&tmpban, &ban_n, &ban_l);\n\n\tMOWGLI_ITER_FOREACH(n, c->members.head)\n\t{\n\t\tcu = n->data;\n\t\tif (cu->modes & (CSTATUS_OP | CSTATUS_VOICE))\n\t\t\tcontinue;\n\t\tif (is_internal_client(cu->user))\n\t\t\tcontinue;\n\t\tif (cu->user == si->su)\n\t\t\tcontinue;\n\t\tif (next_matching_ban(c, cu->user, banlike_char, &ban_n))\n\t\t{\n\t\t\tto_notify[to_notify_count++] = cu->user;\n\t\t\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (to_notify_count >= MAX_SINGLE_NOTIFY)\n\t{\n\t\tif (dir == MTYPE_ADD)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 quieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t\telse if (dir == MTYPE_DEL)\n\t\t\tnotice(chansvs.nick, c->name,\n\t\t\t\t\t\"\\2%s\\2 unquieted \\2%s\\2\",\n\t\t\t\t\tget_source_name(si), tmpban.mask);\n\t}\n\telse\n\t\tfor (i = 0; i < to_notify_count; i++)\n\t\t\tnotify_one_victim(si, c, to_notify[i], dir);\n\n\tfree(tmpban.mask);\n}"
  },
  {
    "function_name": "notify_one_victim",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "182-201",
    "snippet": "static void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "change_notify",
          "args": [
            "chansvs.nick",
            "u",
            "\"You have been unquieted on %s by %s\"",
            "c->name",
            "get_source_name(si)"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "change_notify",
          "args": [
            "chansvs.nick",
            "u",
            "\"You have been quieted on %s by %s\"",
            "c->name",
            "get_source_name(si)"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "dir == MTYPE_ADD || dir == MTYPE_DEL"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void notify_one_victim(sourceinfo_t *si, channel_t *c, user_t *u, int dir)\n{\n\treturn_if_fail(dir == MTYPE_ADD || dir == MTYPE_DEL);\n\n\t/* fantasy command, they can see it */\n\tif (si->c != NULL)\n\t\treturn;\n\t/* self */\n\tif (si->su == u)\n\t\treturn;\n\n\tif (dir == MTYPE_ADD)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been quieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n\telse if (dir == MTYPE_DEL)\n\t\tchange_notify(chansvs.nick, u,\n\t\t\t\t\"You have been unquieted on %s by %s\",\n\t\t\t\tc->name, get_source_name(si));\n}"
  },
  {
    "function_name": "devoice_user",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "116-177",
    "snippet": "static enum devoice_result\ndevoice_user(sourceinfo_t *si, mychan_t *mc, channel_t *c, user_t *tu)\n{\n\tchanuser_t *cu;\n\tunsigned int flag;\n\tchar buf[3];\n\tenum devoice_result result = DEVOICE_NO_ACTION;\n\n\tcu = chanuser_find(c, tu);\n\tif (cu == NULL)\n\t\treturn DEVOICE_NO_ACTION;\n\tif (cu->modes & CSTATUS_OP)\n\t\tflag = CA_OP;\n\telse if (cu->modes & CSTATUS_VOICE)\n\t\tflag = CA_VOICE;\n\telse\n\t\tflag = 0;\n\tif (flag != 0 && !chanacs_source_has_flag(mc, si, flag))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tif (cu->modes & CSTATUS_OWNER || cu->modes & CSTATUS_PROTECT)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"\\2%s\\2 is protected from quiets; you cannot quiet them.\"), tu->nick);\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tbuf[0] = '-';\n\tbuf[2] = '\\0';\n\tif (cu->modes & CSTATUS_OP)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-o\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (cu->modes & CSTATUS_VOICE)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-v\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_owner && (cu->modes & ircd->owner_mode))\n\t{\n\t\tbuf[1] = ircd->owner_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_protect && (cu->modes & ircd->protect_mode))\n\t{\n\t\tbuf[1] = ircd->protect_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_halfops && (cu->modes & ircd->halfops_mode))\n\t{\n\t\tbuf[1] = ircd->halfops_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\n\treturn result;\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "channel_mode_va",
          "args": [
            "chansvs.me->me",
            "c",
            "2",
            "buf",
            "tu->nick"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "channel_mode_va",
          "args": [
            "chansvs.me->me",
            "c",
            "2",
            "buf",
            "tu->nick"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "channel_mode_va",
          "args": [
            "chansvs.me->me",
            "c",
            "2",
            "buf",
            "tu->nick"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "channel_mode_va",
          "args": [
            "chansvs.me->me",
            "c",
            "2",
            "\"-v\"",
            "tu->nick"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "channel_mode_va",
          "args": [
            "chansvs.me->me",
            "c",
            "2",
            "\"-o\"",
            "tu->nick"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"\\2%s\\2 is protected from quiets; you cannot quiet them.\")",
            "tu->nick"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"\\2%s\\2 is protected from quiets; you cannot quiet them.\""
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "strip_extban",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "66-73",
          "snippet": "static char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "flag"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanuser_find",
          "args": [
            "c",
            "tu"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic enum devoice_result\ndevoice_user(sourceinfo_t *si, mychan_t *mc, channel_t *c, user_t *tu)\n{\n\tchanuser_t *cu;\n\tunsigned int flag;\n\tchar buf[3];\n\tenum devoice_result result = DEVOICE_NO_ACTION;\n\n\tcu = chanuser_find(c, tu);\n\tif (cu == NULL)\n\t\treturn DEVOICE_NO_ACTION;\n\tif (cu->modes & CSTATUS_OP)\n\t\tflag = CA_OP;\n\telse if (cu->modes & CSTATUS_VOICE)\n\t\tflag = CA_VOICE;\n\telse\n\t\tflag = 0;\n\tif (flag != 0 && !chanacs_source_has_flag(mc, si, flag))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tif (cu->modes & CSTATUS_OWNER || cu->modes & CSTATUS_PROTECT)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"\\2%s\\2 is protected from quiets; you cannot quiet them.\"), tu->nick);\n\t\treturn DEVOICE_FAILED;\n\t}\n\n\tbuf[0] = '-';\n\tbuf[2] = '\\0';\n\tif (cu->modes & CSTATUS_OP)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-o\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (cu->modes & CSTATUS_VOICE)\n\t{\n\t\tchannel_mode_va(chansvs.me->me, c, 2, \"-v\", tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_owner && (cu->modes & ircd->owner_mode))\n\t{\n\t\tbuf[1] = ircd->owner_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_protect && (cu->modes & ircd->protect_mode))\n\t{\n\t\tbuf[1] = ircd->protect_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\tif (ircd->uses_halfops && (cu->modes & ircd->halfops_mode))\n\t{\n\t\tbuf[1] = ircd->halfops_mchar[1];\n\t\tchannel_mode_va(chansvs.me->me, c, 2, buf, tu->nick);\n\t\tresult = DEVOICE_DONE;\n\t}\n\n\treturn result;\n}"
  },
  {
    "function_name": "make_extban",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "89-112",
    "snippet": "static void make_extban(char *buf, size_t size, user_t *tu)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(tu != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", size);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", size);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, tu->nick, size);\n\tmowgli_strlcat(buf, \"!\", size);\n\tmowgli_strlcat(buf, tu->user, size);\n\tmowgli_strlcat(buf, \"@\", size);\n\tmowgli_strlcat(buf, tu->vhost, size);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "buf",
            "tu->vhost",
            "size"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "buf",
            "\"@\"",
            "size"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "buf",
            "tu->user",
            "size"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "buf",
            "\"!\"",
            "size"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "buf",
            "tu->nick",
            "size"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "buf",
            "\"~q:\"",
            "size"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "buf",
            "\"m:\"",
            "size"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "tu != NULL"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "buf != NULL"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void make_extban(char *buf, size_t size, user_t *tu)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(tu != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", size);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", size);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, tu->nick, size);\n\tmowgli_strlcat(buf, \"!\", size);\n\tmowgli_strlcat(buf, tu->user, size);\n\tmowgli_strlcat(buf, \"@\", size);\n\tmowgli_strlcat(buf, tu->vhost, size);\n}"
  },
  {
    "function_name": "place_quietmask",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "75-87",
    "snippet": "chanban_t *place_quietmask(channel_t *c, int dir, const char *hostbuf)\n{\n\tchar rhostbuf[BUFSIZE];\n\tchanban_t *cb = NULL;\n\tchar banlike_char = get_quiet_ban_char();\n\n\tmake_extbanmask(rhostbuf, sizeof rhostbuf, hostbuf);\n\tmodestack_mode_param(chansvs.nick, c, MTYPE_ADD, banlike_char,\n\t\t\trhostbuf);\n\tcb = chanban_add(c, rhostbuf, banlike_char);\n\n\treturn cb;\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "chanban_add",
          "args": [
            "c",
            "rhostbuf",
            "banlike_char"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "modestack_mode_param",
          "args": [
            "chansvs.nick",
            "c",
            "MTYPE_ADD",
            "banlike_char",
            "rhostbuf"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_extbanmask",
          "args": [
            "rhostbuf",
            "sizeof rhostbuf",
            "hostbuf"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "make_extbanmask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "39-58",
          "snippet": "static void make_extbanmask(char *buf, size_t buflen, const char *mask)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(mask != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", buflen);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", buflen);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, mask, buflen);\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void make_extbanmask(char *buf, size_t buflen, const char *mask)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(mask != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", buflen);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", buflen);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, mask, buflen);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_quiet_ban_char",
          "args": [],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "get_quiet_ban_char",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
          "lines": "60-64",
          "snippet": "static char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}",
          "includes": [
            "#include \"chanserv.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nchanban_t *place_quietmask(channel_t *c, int dir, const char *hostbuf)\n{\n\tchar rhostbuf[BUFSIZE];\n\tchanban_t *cb = NULL;\n\tchar banlike_char = get_quiet_ban_char();\n\n\tmake_extbanmask(rhostbuf, sizeof rhostbuf, hostbuf);\n\tmodestack_mode_param(chansvs.nick, c, MTYPE_ADD, banlike_char,\n\t\t\trhostbuf);\n\tcb = chanban_add(c, rhostbuf, banlike_char);\n\n\treturn cb;\n}"
  },
  {
    "function_name": "strip_extban",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "66-73",
    "snippet": "static char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sstrdup",
          "args": [
            "mask"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sstrdup",
          "args": [
            "&mask[3]"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sstrdup",
          "args": [
            "&mask[2]"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char *strip_extban(char *mask)\n{\n\tif (ircd->type == PROTOCOL_INSPIRCD)\n\t\treturn sstrdup(&mask[2]);\n\tif (ircd->type == PROTOCOL_UNREAL)\n\t\treturn sstrdup(&mask[3]);\n\treturn sstrdup(mask);\n}"
  },
  {
    "function_name": "get_quiet_ban_char",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "60-64",
    "snippet": "static char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic char get_quiet_ban_char(void)\n{\n\treturn (ircd->type == PROTOCOL_UNREAL ||\n\t\t\tircd->type == PROTOCOL_INSPIRCD) ? 'b' : 'q';\n}"
  },
  {
    "function_name": "make_extbanmask",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "39-58",
    "snippet": "static void make_extbanmask(char *buf, size_t buflen, const char *mask)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(mask != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", buflen);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", buflen);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, mask, buflen);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mowgli_strlcat",
          "args": [
            "buf",
            "mask",
            "buflen"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "buf",
            "\"~q:\"",
            "buflen"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "buf",
            "\"m:\"",
            "buflen"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "mask != NULL"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "buf != NULL"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\nstatic void make_extbanmask(char *buf, size_t buflen, const char *mask)\n{\n\treturn_if_fail(buf != NULL);\n\treturn_if_fail(mask != NULL);\n\n\tswitch (ircd->type)\n\t{\n\tcase PROTOCOL_INSPIRCD:\n\t\tmowgli_strlcpy(buf, \"m:\", buflen);\n\t\tbreak;\n\tcase PROTOCOL_UNREAL:\n\t\tmowgli_strlcpy(buf, \"~q:\", buflen);\n\t\tbreak;\n\tdefault:\n\t\t*buf = '\\0';\n\t\tbreak;\n\t}\n\n\tmowgli_strlcat(buf, mask, buflen);\n}"
  },
  {
    "function_name": "_moddeinit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "33-37",
    "snippet": "void _moddeinit(module_unload_intent_t intent)\n{\n\tservice_named_unbind_command(\"chanserv\", &cs_quiet);\n\tservice_named_unbind_command(\"chanserv\", &cs_unquiet);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "command_t cs_quiet = { \"QUIET\", N_(\"Sets a quiet on a channel.\"),\n                        AC_AUTHENTICATED, 2, cs_cmd_quiet, { .path = \"cservice/quiet\" } };",
      "command_t cs_unquiet = { \"UNQUIET\", N_(\"Removes a quiet on a channel.\"),\n\t\t\tAC_AUTHENTICATED, 2, cs_cmd_unquiet, { .path = \"cservice/unquiet\" } };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_named_unbind_command",
          "args": [
            "\"chanserv\"",
            "&cs_unquiet"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_named_unbind_command",
          "args": [
            "\"chanserv\"",
            "&cs_quiet"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\ncommand_t cs_quiet = { \"QUIET\", N_(\"Sets a quiet on a channel.\"),\n                        AC_AUTHENTICATED, 2, cs_cmd_quiet, { .path = \"cservice/quiet\" } };\ncommand_t cs_unquiet = { \"UNQUIET\", N_(\"Removes a quiet on a channel.\"),\n\t\t\tAC_AUTHENTICATED, 2, cs_cmd_unquiet, { .path = \"cservice/unquiet\" } };\n\nvoid _moddeinit(module_unload_intent_t intent)\n{\n\tservice_named_unbind_command(\"chanserv\", &cs_quiet);\n\tservice_named_unbind_command(\"chanserv\", &cs_unquiet);\n}"
  },
  {
    "function_name": "_modinit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/quiet.c",
    "lines": "27-31",
    "snippet": "void _modinit(module_t *m)\n{\n        service_named_bind_command(\"chanserv\", &cs_quiet);\n\tservice_named_bind_command(\"chanserv\", &cs_unquiet);\n}",
    "includes": [
      "#include \"chanserv.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "command_t cs_quiet = { \"QUIET\", N_(\"Sets a quiet on a channel.\"),\n                        AC_AUTHENTICATED, 2, cs_cmd_quiet, { .path = \"cservice/quiet\" } };",
      "command_t cs_unquiet = { \"UNQUIET\", N_(\"Removes a quiet on a channel.\"),\n\t\t\tAC_AUTHENTICATED, 2, cs_cmd_unquiet, { .path = \"cservice/unquiet\" } };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_named_bind_command",
          "args": [
            "\"chanserv\"",
            "&cs_unquiet"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_named_bind_command",
          "args": [
            "\"chanserv\"",
            "&cs_quiet"
          ],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"chanserv.h\"\n#include \"atheme.h\"\n\ncommand_t cs_quiet = { \"QUIET\", N_(\"Sets a quiet on a channel.\"),\n                        AC_AUTHENTICATED, 2, cs_cmd_quiet, { .path = \"cservice/quiet\" } };\ncommand_t cs_unquiet = { \"UNQUIET\", N_(\"Removes a quiet on a channel.\"),\n\t\t\tAC_AUTHENTICATED, 2, cs_cmd_unquiet, { .path = \"cservice/unquiet\" } };\n\nvoid _modinit(module_t *m)\n{\n        service_named_bind_command(\"chanserv\", &cs_quiet);\n\tservice_named_bind_command(\"chanserv\", &cs_unquiet);\n}"
  }
]