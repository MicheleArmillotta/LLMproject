[
  {
    "function_name": "cs_cmd_role_del",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "1357-1406",
    "snippet": "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tconst char *role = parv[1];\n\tunsigned int oldflags, restrictflags;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE DEL\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> DEL <role>\"));\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t\trestrictflags = allow_flags(mc, restrictflags);\n\toldflags = get_template_flags(mc, role);\n\tif (oldflags == 0)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\tif (oldflags & ~restrictflags)\n\t{\n\t\tunsigned int delta = oldflags & ~restrictflags;\n\n\t\tcommand_fail(si, fault_badparams, _(\"You do not have appropriate permissions to set flags: \\2%s\\2\"), xflag_tostr(delta));\n\t\treturn;\n\t}\n\n\tcommand_success_nodata(si, _(\"Role \\2%s\\2 has been deleted.\"), role);\n\tupdate_role_entry(si, mc, role, 0);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_role_entry",
          "args": [
            "si",
            "mc",
            "role",
            "0"
          ],
          "line": 1405
        },
        "resolved": true,
        "details": {
          "function_name": "update_role_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "424-539",
          "snippet": "static void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Role \\2%s\\2 has been deleted.\")",
            "role"
          ],
          "line": 1404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Role \\2%s\\2 has been deleted.\""
          ],
          "line": 1404
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"You do not have appropriate permissions to set flags: \\2%s\\2\")",
            "xflag_tostr(delta)"
          ],
          "line": 1400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "delta"
          ],
          "line": 1400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"Role \\2%s\\2 does not exist.\")",
            "role"
          ],
          "line": 1392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "mc",
            "role"
          ],
          "line": 1389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 1388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_flags",
          "args": [
            "mc",
            "si"
          ],
          "line": 1384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 1380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_FLAGS"
          ],
          "line": 1378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ROLE <#channel> DEL <role>\")"
          ],
          "line": 1374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ROLE DEL\""
          ],
          "line": 1373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 1367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 1364
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tconst char *role = parv[1];\n\tunsigned int oldflags, restrictflags;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE DEL\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> DEL <role>\"));\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t\trestrictflags = allow_flags(mc, restrictflags);\n\toldflags = get_template_flags(mc, role);\n\tif (oldflags == 0)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\tif (oldflags & ~restrictflags)\n\t{\n\t\tunsigned int delta = oldflags & ~restrictflags;\n\n\t\tcommand_fail(si, fault_badparams, _(\"You do not have appropriate permissions to set flags: \\2%s\\2\"), xflag_tostr(delta));\n\t\treturn;\n\t}\n\n\tcommand_success_nodata(si, _(\"Role \\2%s\\2 has been deleted.\"), role);\n\tupdate_role_entry(si, mc, role, 0);\n}"
  },
  {
    "function_name": "cs_cmd_role_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "1260-1348",
    "snippet": "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tmowgli_list_t *l;\n\tconst char *channel = parv[0];\n\tconst char *role = parv[1];\n\tunsigned int oldflags, newflags, restrictflags;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE ADD|SET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> ADD|SET <role> [flags]\"));\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t\trestrictflags = allow_flags(mc, restrictflags);\n\toldflags = get_template_flags(mc, role);\n\n\tif (oldflags == 0)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\tnewflags = xflag_apply_batch(oldflags, parc - 2, parv + 2);\n\tif ((oldflags | newflags) & ~restrictflags)\n\t{\n\t\tunsigned int delta = (oldflags | newflags) & ~restrictflags;\n\n\t\tcommand_fail(si, fault_badparams, _(\"You do not have appropriate permissions to set flags: \\2%s\\2\"), xflag_tostr(delta));\n\t\treturn;\n\t}\n\n\tif ((oldflags ^ newflags) & CA_FOUNDER)\n\t{\n\t\tcommand_fail(si, fault_unimplemented, _(\"Adding or removing founder status from a role is not implemented.\"));\n\t\treturn;\n\t}\n\n\tif (newflags & CA_FOUNDER)\n\t\tnewflags |= CA_FLAGS;\n\n\tif (newflags == 0)\n\t{\n\t\tif (oldflags == 0)\n\t\t\tcommand_fail(si, fault_badparams, _(\"No valid flags given, use /%s%s HELP ROLE ADD for a list\"), ircd->uses_rcommand ? \"\" : \"msg \", chansvs.me->disp);\n\t\telse\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"You cannot remove all flags from the role \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\tl = build_template_list(mc);\n\tif (l != NULL)\n\t{\n\t\tmowgli_node_t *n;\n\n\t\tMOWGLI_ITER_FOREACH(n, l->head)\n\t\t{\n\t\t\ttemplate_t *t = n->data;\n\n\t\t\tif (t->level == newflags)\n\t\t\t{\n\t\t\t\tcommand_fail(si, fault_alreadyexists, _(\"The role \\2%s\\2 already has flags \\2%s\\2.\"), t->name, xflag_tostr(newflags));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfree_template_list(l);\n\t}\n\n\tcommand_success_nodata(si, _(\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\"), role, xflag_tostr(newflags));\n\tupdate_role_entry(si, mc, role, newflags);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_role_entry",
          "args": [
            "si",
            "mc",
            "role",
            "newflags"
          ],
          "line": 1347
        },
        "resolved": true,
        "details": {
          "function_name": "update_role_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "424-539",
          "snippet": "static void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\")",
            "role",
            "xflag_tostr(newflags)"
          ],
          "line": 1346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "newflags"
          ],
          "line": 1346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\""
          ],
          "line": 1346
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_alreadyexists",
            "_(\"The role \\2%s\\2 already has flags \\2%s\\2.\")",
            "t->name",
            "xflag_tostr(newflags)"
          ],
          "line": 1338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "newflags"
          ],
          "line": 1338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "n",
            "l->head"
          ],
          "line": 1332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "build_template_list",
          "args": [
            "mc"
          ],
          "line": 1327
        },
        "resolved": true,
        "details": {
          "function_name": "build_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "297-356",
          "snippet": "static mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"You cannot remove all flags from the role \\2%s\\2.\")",
            "role"
          ],
          "line": 1324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"No valid flags given, use /%s%s HELP ROLE ADD for a list\")",
            "ircd->uses_rcommand ? \"\" : \"msg \"",
            "chansvs.me->disp"
          ],
          "line": 1322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_unimplemented",
            "_(\"Adding or removing founder status from a role is not implemented.\")"
          ],
          "line": 1312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"You do not have appropriate permissions to set flags: \\2%s\\2\")",
            "xflag_tostr(delta)"
          ],
          "line": 1306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "delta"
          ],
          "line": 1306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_apply_batch",
          "args": [
            "oldflags",
            "parc - 2",
            "parv + 2"
          ],
          "line": 1301
        },
        "resolved": true,
        "details": {
          "function_name": "xflag_apply_batch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "541-551",
          "snippet": "static unsigned int xflag_apply_batch(unsigned int in, int parc, char *parv[])\n{\n\tunsigned int out;\n\tint i;\n\n\tout = in;\n\tfor (i = 0; i < parc; i++)\n\t\tout = xflag_apply(out, parv[i]);\n\n\treturn out;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic unsigned int xflag_apply_batch(unsigned int in, int parc, char *parv[])\n{\n\tunsigned int out;\n\tint i;\n\n\tout = in;\n\tfor (i = 0; i < parc; i++)\n\t\tout = xflag_apply(out, parv[i]);\n\n\treturn out;\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Role \\2%s\\2 does not exist.\")",
            "role"
          ],
          "line": 1297
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "mc",
            "role"
          ],
          "line": 1293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 1292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_flags",
          "args": [
            "mc",
            "si"
          ],
          "line": 1288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 1284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_FLAGS"
          ],
          "line": 1282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ROLE <#channel> ADD|SET <role> [flags]\")"
          ],
          "line": 1278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ROLE ADD|SET\""
          ],
          "line": 1277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 1271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 1268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tmowgli_list_t *l;\n\tconst char *channel = parv[0];\n\tconst char *role = parv[1];\n\tunsigned int oldflags, newflags, restrictflags;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE ADD|SET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> ADD|SET <role> [flags]\"));\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t\trestrictflags = allow_flags(mc, restrictflags);\n\toldflags = get_template_flags(mc, role);\n\n\tif (oldflags == 0)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\tnewflags = xflag_apply_batch(oldflags, parc - 2, parv + 2);\n\tif ((oldflags | newflags) & ~restrictflags)\n\t{\n\t\tunsigned int delta = (oldflags | newflags) & ~restrictflags;\n\n\t\tcommand_fail(si, fault_badparams, _(\"You do not have appropriate permissions to set flags: \\2%s\\2\"), xflag_tostr(delta));\n\t\treturn;\n\t}\n\n\tif ((oldflags ^ newflags) & CA_FOUNDER)\n\t{\n\t\tcommand_fail(si, fault_unimplemented, _(\"Adding or removing founder status from a role is not implemented.\"));\n\t\treturn;\n\t}\n\n\tif (newflags & CA_FOUNDER)\n\t\tnewflags |= CA_FLAGS;\n\n\tif (newflags == 0)\n\t{\n\t\tif (oldflags == 0)\n\t\t\tcommand_fail(si, fault_badparams, _(\"No valid flags given, use /%s%s HELP ROLE ADD for a list\"), ircd->uses_rcommand ? \"\" : \"msg \", chansvs.me->disp);\n\t\telse\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"You cannot remove all flags from the role \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\tl = build_template_list(mc);\n\tif (l != NULL)\n\t{\n\t\tmowgli_node_t *n;\n\n\t\tMOWGLI_ITER_FOREACH(n, l->head)\n\t\t{\n\t\t\ttemplate_t *t = n->data;\n\n\t\t\tif (t->level == newflags)\n\t\t\t{\n\t\t\t\tcommand_fail(si, fault_alreadyexists, _(\"The role \\2%s\\2 already has flags \\2%s\\2.\"), t->name, xflag_tostr(newflags));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfree_template_list(l);\n\t}\n\n\tcommand_success_nodata(si, _(\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\"), role, xflag_tostr(newflags));\n\tupdate_role_entry(si, mc, role, newflags);\n}"
  },
  {
    "function_name": "cs_cmd_role_add",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "1169-1251",
    "snippet": "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tmowgli_list_t *l;\n\tconst char *channel = parv[0];\n\tconst char *role = parv[1];\n\tunsigned int oldflags, newflags, restrictflags;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE ADD|SET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> ADD|SET <role> [flags]\"));\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t\trestrictflags = allow_flags(mc, restrictflags);\n\toldflags = get_template_flags(mc, role);\n\n\tif (oldflags != 0)\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Role \\2%s\\2 already exists.\"), role);\n\t\treturn;\n\t}\n\n\tnewflags = xflag_apply_batch(oldflags, parc - 2, parv + 2);\n\tif (newflags & ~restrictflags)\n\t{\n\t\tunsigned int delta = newflags & ~restrictflags;\n\n\t\tcommand_fail(si, fault_badparams, _(\"You do not have appropriate permissions to add flags: \\2%s\\2\"), xflag_tostr(delta));\n\t\treturn;\n\t}\n\n\tif (newflags & CA_FOUNDER)\n\t\tnewflags |= CA_FLAGS;\n\n\tif (newflags == 0)\n\t{\n\t\tif (oldflags == 0)\n\t\t\tcommand_fail(si, fault_badparams, _(\"No valid flags given, use /%s%s HELP ROLE ADD for a list\"), ircd->uses_rcommand ? \"\" : \"msg \", chansvs.me->disp);\n\t\telse\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"You cannot remove all flags from the role \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\tl = build_template_list(mc);\n\tif (l != NULL)\n\t{\n\t\tmowgli_node_t *n;\n\n\t\tMOWGLI_ITER_FOREACH(n, l->head)\n\t\t{\n\t\t\ttemplate_t *t = n->data;\n\n\t\t\tif (t->level == newflags)\n\t\t\t{\n\t\t\t\tcommand_fail(si, fault_alreadyexists, _(\"The role \\2%s\\2 already has flags \\2%s\\2.\"), t->name, xflag_tostr(newflags));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfree_template_list(l);\n\t}\n\n\tcommand_success_nodata(si, _(\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\"), role, xflag_tostr(newflags));\n\tupdate_role_entry(si, mc, role, newflags);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "update_role_entry",
          "args": [
            "si",
            "mc",
            "role",
            "newflags"
          ],
          "line": 1250
        },
        "resolved": true,
        "details": {
          "function_name": "update_role_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "424-539",
          "snippet": "static void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\")",
            "role",
            "xflag_tostr(newflags)"
          ],
          "line": 1249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "newflags"
          ],
          "line": 1249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\""
          ],
          "line": 1249
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_alreadyexists",
            "_(\"The role \\2%s\\2 already has flags \\2%s\\2.\")",
            "t->name",
            "xflag_tostr(newflags)"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "newflags"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "n",
            "l->head"
          ],
          "line": 1235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "build_template_list",
          "args": [
            "mc"
          ],
          "line": 1230
        },
        "resolved": true,
        "details": {
          "function_name": "build_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "297-356",
          "snippet": "static mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"You cannot remove all flags from the role \\2%s\\2.\")",
            "role"
          ],
          "line": 1227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"No valid flags given, use /%s%s HELP ROLE ADD for a list\")",
            "ircd->uses_rcommand ? \"\" : \"msg \"",
            "chansvs.me->disp"
          ],
          "line": 1225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"You do not have appropriate permissions to add flags: \\2%s\\2\")",
            "xflag_tostr(delta)"
          ],
          "line": 1215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "delta"
          ],
          "line": 1215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_apply_batch",
          "args": [
            "oldflags",
            "parc - 2",
            "parv + 2"
          ],
          "line": 1210
        },
        "resolved": true,
        "details": {
          "function_name": "xflag_apply_batch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "541-551",
          "snippet": "static unsigned int xflag_apply_batch(unsigned int in, int parc, char *parv[])\n{\n\tunsigned int out;\n\tint i;\n\n\tout = in;\n\tfor (i = 0; i < parc; i++)\n\t\tout = xflag_apply(out, parv[i]);\n\n\treturn out;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
            "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic unsigned int xflag_apply_batch(unsigned int in, int parc, char *parv[])\n{\n\tunsigned int out;\n\tint i;\n\n\tout = in;\n\tfor (i = 0; i < parc; i++)\n\t\tout = xflag_apply(out, parv[i]);\n\n\treturn out;\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Role \\2%s\\2 already exists.\")",
            "role"
          ],
          "line": 1206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "mc",
            "role"
          ],
          "line": 1202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 1201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_flags",
          "args": [
            "mc",
            "si"
          ],
          "line": 1197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 1193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_FLAGS"
          ],
          "line": 1191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ROLE <#channel> ADD|SET <role> [flags]\")"
          ],
          "line": 1187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ROLE ADD|SET\""
          ],
          "line": 1186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 1180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 1177
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tmowgli_list_t *l;\n\tconst char *channel = parv[0];\n\tconst char *role = parv[1];\n\tunsigned int oldflags, newflags, restrictflags;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE ADD|SET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> ADD|SET <role> [flags]\"));\n\t\treturn;\n\t}\n\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t\trestrictflags = allow_flags(mc, restrictflags);\n\toldflags = get_template_flags(mc, role);\n\n\tif (oldflags != 0)\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Role \\2%s\\2 already exists.\"), role);\n\t\treturn;\n\t}\n\n\tnewflags = xflag_apply_batch(oldflags, parc - 2, parv + 2);\n\tif (newflags & ~restrictflags)\n\t{\n\t\tunsigned int delta = newflags & ~restrictflags;\n\n\t\tcommand_fail(si, fault_badparams, _(\"You do not have appropriate permissions to add flags: \\2%s\\2\"), xflag_tostr(delta));\n\t\treturn;\n\t}\n\n\tif (newflags & CA_FOUNDER)\n\t\tnewflags |= CA_FLAGS;\n\n\tif (newflags == 0)\n\t{\n\t\tif (oldflags == 0)\n\t\t\tcommand_fail(si, fault_badparams, _(\"No valid flags given, use /%s%s HELP ROLE ADD for a list\"), ircd->uses_rcommand ? \"\" : \"msg \", chansvs.me->disp);\n\t\telse\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"You cannot remove all flags from the role \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\tl = build_template_list(mc);\n\tif (l != NULL)\n\t{\n\t\tmowgli_node_t *n;\n\n\t\tMOWGLI_ITER_FOREACH(n, l->head)\n\t\t{\n\t\t\ttemplate_t *t = n->data;\n\n\t\t\tif (t->level == newflags)\n\t\t\t{\n\t\t\t\tcommand_fail(si, fault_alreadyexists, _(\"The role \\2%s\\2 already has flags \\2%s\\2.\"), t->name, xflag_tostr(newflags));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tfree_template_list(l);\n\t}\n\n\tcommand_success_nodata(si, _(\"Flags for role \\2%s\\2 were changed to: \\2%s\\2.\"), role, xflag_tostr(newflags));\n\tupdate_role_entry(si, mc, role, newflags);\n}"
  },
  {
    "function_name": "cs_cmd_role_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "1131-1160",
    "snippet": "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tmowgli_list_t *l;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tl = build_template_list(mc);\n\tif (l != NULL)\n\t{\n\t\tmowgli_node_t *n;\n\n\t\tcommand_success_nodata(si, _(\"List of channel-defined roles:\"));\n\n\t\tMOWGLI_ITER_FOREACH(n, l->head)\n\t\t{\n\t\t\ttemplate_t *t = n->data;\n\n\t\t\tcommand_success_nodata(si, \"%-20s: %s (%s)\", t->name, xflag_tostr(t->level), bitmask_to_flags(t->level));\n\t\t}\n\n\t\tfree_template_list(l);\n\t}\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free_template_list",
          "args": [
            "l"
          ],
          "line": 1158
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\"%-20s: %s (%s)\"",
            "t->name",
            "xflag_tostr(t->level)",
            "bitmask_to_flags(t->level)"
          ],
          "line": 1155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitmask_to_flags",
          "args": [
            "t->level"
          ],
          "line": 1155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "t->level"
          ],
          "line": 1155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "n",
            "l->head"
          ],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"List of channel-defined roles:\")"
          ],
          "line": 1149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "build_template_list",
          "args": [
            "mc"
          ],
          "line": 1144
        },
        "resolved": true,
        "details": {
          "function_name": "build_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "297-356",
          "snippet": "static mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[])\n{\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tmowgli_list_t *l;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tl = build_template_list(mc);\n\tif (l != NULL)\n\t{\n\t\tmowgli_node_t *n;\n\n\t\tcommand_success_nodata(si, _(\"List of channel-defined roles:\"));\n\n\t\tMOWGLI_ITER_FOREACH(n, l->head)\n\t\t{\n\t\t\ttemplate_t *t = n->data;\n\n\t\t\tcommand_success_nodata(si, \"%-20s: %s (%s)\", t->name, xflag_tostr(t->level), bitmask_to_flags(t->level));\n\t\t}\n\n\t\tfree_template_list(l);\n\t}\n}"
  },
  {
    "function_name": "cs_cmd_access_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "983-1115",
    "snippet": "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt = NULL;\n\tmychan_t *mc;\n\thook_channel_acl_req_t req;\n\tunsigned int oldflags, restrictflags;\n\tunsigned int newflags, addflags, removeflags;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tconst char *role = parv[2];\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target || !role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS SET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> SET <account|hostmask> <role>\"));\n\t\treturn;\n\t}\n\n\t/* allow a user to resign their access even without FLAGS access. this is\n\t * consistent with the other commands. --nenolod\n\t */\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_open(mc, NULL, target, true, entity(si->smu));\n\telse\n\t{\n\t\tif (!(mt = myentity_find_ext(target)))\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_open(mc, mt, NULL, true, entity(si->smu));\n\t}\n\n\tif (ca->level == 0 && chanacs_is_table_full(ca))\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Channel \\2%s\\2 access list is full.\"), mc->name);\n\t\treturn;\n\t}\n\n\tnewflags = get_template_flags(mc, role);\n\n\tif (newflags == 0)\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\tif ((ca->level & CA_FOUNDER) && !(newflags & CA_FOUNDER) && mychan_num_founders(mc) == 1)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not remove the last founder.\"));\n\t\treturn;\n\t}\n\n\treq.ca = ca;\n\treq.oldlevel = ca->level;\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t{\n\t\tif (restrictflags & CA_AKICK && entity(si->smu) == mt)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (mt != entity(si->smu))\n\t\t\trestrictflags = allow_flags(mc, restrictflags);\n\t\telse\n\t\t\trestrictflags |= allow_flags(mc, restrictflags);\n\t}\n\n\tif (!(ca->level & CA_FOUNDER) && newflags & CA_FOUNDER)\n\t{\n\t\tif (mychan_num_founders(mc) >= chansvs.maxfounders)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"Only %d founders allowed per channel.\"), chansvs.maxfounders);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (mt == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"You may not set founder status on a hostmask.\"));\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (!myentity_can_register_channel(mt))\n\t\t{\n\t\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 has too many channels registered.\"), mt->name);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t}\n\n\toldflags = ca->level;\n\n\taddflags = newflags & ~oldflags;\n\tremoveflags = ca_all & ~newflags;\n\n\tif (!chanacs_modify(ca, &addflags, &removeflags, restrictflags))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not add \\2%s\\2 to the \\2%s\\2 role.\"), target, role);\n\t\treturn;\n\t}\n\n\treq.newlevel = newflags;\n\n\thook_call_channel_acl_change(&req);\n\tchanacs_close(ca);\n\n\tcommand_success_nodata(si, _(\"\\2%s\\2 now has the \\2%s\\2 role in \\2%s\\2.\"), target, role, channel);\n\tverbose(mc, \"\\2%s\\2 changed the access list role for \\2%s\\2 to \\2%s\\2.\", get_source_name(si), target, role);\n\n\tlogcommand(si, CMDLOG_SET, \"ACCESS:SET: \\2%s\\2 to \\2%s\\2 as \\2%s\\2\", target, mc->name, role);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_SET",
            "\"ACCESS:SET: \\2%s\\2 to \\2%s\\2 as \\2%s\\2\"",
            "target",
            "mc->name",
            "role"
          ],
          "line": 1114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "mc",
            "\"\\2%s\\2 changed the access list role for \\2%s\\2 to \\2%s\\2.\"",
            "get_source_name(si)",
            "target",
            "role"
          ],
          "line": 1112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 1112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"\\2%s\\2 now has the \\2%s\\2 role in \\2%s\\2.\")",
            "target",
            "role",
            "channel"
          ],
          "line": 1111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"\\2%s\\2 now has the \\2%s\\2 role in \\2%s\\2.\""
          ],
          "line": 1111
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 1109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hook_call_channel_acl_change",
          "args": [
            "&req"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You may not add \\2%s\\2 to the \\2%s\\2 role.\")",
            "target",
            "role"
          ],
          "line": 1102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_modify",
          "args": [
            "ca",
            "&addflags",
            "&removeflags",
            "restrictflags"
          ],
          "line": 1100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"\\2%s\\2 has too many channels registered.\")",
            "mt->name"
          ],
          "line": 1089
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_can_register_channel",
          "args": [
            "mt"
          ],
          "line": 1087
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"You may not set founder status on a hostmask.\")"
          ],
          "line": 1083
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 1078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"Only %d founders allowed per channel.\")",
            "chansvs.maxfounders"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_num_founders",
          "args": [
            "mc"
          ],
          "line": 1075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 1070
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 1068
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 1067
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 1063
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 1061
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_flags",
          "args": [
            "mc",
            "si"
          ],
          "line": 1056
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You may not remove the last founder.\")"
          ],
          "line": 1049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_num_founders",
          "args": [
            "mc"
          ],
          "line": 1047
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"Role \\2%s\\2 does not exist.\")",
            "role"
          ],
          "line": 1043
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 1042
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "mc",
            "role"
          ],
          "line": 1038
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"Channel \\2%s\\2 access list is full.\")",
            "mc->name"
          ],
          "line": 1034
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 1033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_is_table_full",
          "args": [
            "ca"
          ],
          "line": 1031
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_open",
          "args": [
            "mc",
            "mt",
            "NULL",
            "true",
            "entity(si->smu)"
          ],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"\\2%s\\2 is not registered.\")",
            "target"
          ],
          "line": 1024
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_find_ext",
          "args": [
            "target"
          ],
          "line": 1022
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_open",
          "args": [
            "mc",
            "NULL",
            "target",
            "true",
            "entity(si->smu)"
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "validhostmask",
          "args": [
            "target"
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 1014
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_FLAGS"
          ],
          "line": 1012
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ACCESS <#channel> SET <account|hostmask> <role>\")"
          ],
          "line": 1005
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ACCESS SET\""
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 995
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt = NULL;\n\tmychan_t *mc;\n\thook_channel_acl_req_t req;\n\tunsigned int oldflags, restrictflags;\n\tunsigned int newflags, addflags, removeflags;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tconst char *role = parv[2];\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target || !role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS SET\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> SET <account|hostmask> <role>\"));\n\t\treturn;\n\t}\n\n\t/* allow a user to resign their access even without FLAGS access. this is\n\t * consistent with the other commands. --nenolod\n\t */\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_open(mc, NULL, target, true, entity(si->smu));\n\telse\n\t{\n\t\tif (!(mt = myentity_find_ext(target)))\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_open(mc, mt, NULL, true, entity(si->smu));\n\t}\n\n\tif (ca->level == 0 && chanacs_is_table_full(ca))\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Channel \\2%s\\2 access list is full.\"), mc->name);\n\t\treturn;\n\t}\n\n\tnewflags = get_template_flags(mc, role);\n\n\tif (newflags == 0)\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\tif ((ca->level & CA_FOUNDER) && !(newflags & CA_FOUNDER) && mychan_num_founders(mc) == 1)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not remove the last founder.\"));\n\t\treturn;\n\t}\n\n\treq.ca = ca;\n\treq.oldlevel = ca->level;\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t{\n\t\tif (restrictflags & CA_AKICK && entity(si->smu) == mt)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (mt != entity(si->smu))\n\t\t\trestrictflags = allow_flags(mc, restrictflags);\n\t\telse\n\t\t\trestrictflags |= allow_flags(mc, restrictflags);\n\t}\n\n\tif (!(ca->level & CA_FOUNDER) && newflags & CA_FOUNDER)\n\t{\n\t\tif (mychan_num_founders(mc) >= chansvs.maxfounders)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"Only %d founders allowed per channel.\"), chansvs.maxfounders);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (mt == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"You may not set founder status on a hostmask.\"));\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (!myentity_can_register_channel(mt))\n\t\t{\n\t\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 has too many channels registered.\"), mt->name);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t}\n\n\toldflags = ca->level;\n\n\taddflags = newflags & ~oldflags;\n\tremoveflags = ca_all & ~newflags;\n\n\tif (!chanacs_modify(ca, &addflags, &removeflags, restrictflags))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not add \\2%s\\2 to the \\2%s\\2 role.\"), target, role);\n\t\treturn;\n\t}\n\n\treq.newlevel = newflags;\n\n\thook_call_channel_acl_change(&req);\n\tchanacs_close(ca);\n\n\tcommand_success_nodata(si, _(\"\\2%s\\2 now has the \\2%s\\2 role in \\2%s\\2.\"), target, role, channel);\n\tverbose(mc, \"\\2%s\\2 changed the access list role for \\2%s\\2 to \\2%s\\2.\", get_source_name(si), target, role);\n\n\tlogcommand(si, CMDLOG_SET, \"ACCESS:SET: \\2%s\\2 to \\2%s\\2 as \\2%s\\2\", target, mc->name, role);\n}"
  },
  {
    "function_name": "cs_cmd_access_add",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "836-974",
    "snippet": "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt = NULL;\n\tmychan_t *mc;\n\thook_channel_acl_req_t req;\n\tunsigned int oldflags, restrictflags;\n\tunsigned int newflags, addflags, removeflags;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tconst char *role = parv[2];\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target || !role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS ADD\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> ADD <account|hostmask> <role>\"));\n\t\treturn;\n\t}\n\n\t/* allow a user to resign their access even without FLAGS access. this is\n\t * consistent with the other commands. --nenolod\n\t */\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_open(mc, NULL, target, true, entity(si->smu));\n\telse\n\t{\n\t\tif (!(mt = myentity_find_ext(target)))\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_open(mc, mt, NULL, true, entity(si->smu));\n\t}\n\n\tif (ca->level == 0 && chanacs_is_table_full(ca))\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Channel %s access list is full.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (ca->level != 0)\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 already has the \\2%s\\2 role in \\2%s\\2.\"), target, get_template_name(mc, ca->level), mc->name);\n\t\treturn;\n\t}\n\n\treq.ca = ca;\n\treq.oldlevel = ca->level;\n\n\tnewflags = get_template_flags(mc, role);\n\tif (newflags == 0)\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t{\n\t\tif (restrictflags & CA_AKICK && entity(si->smu) == mt)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (mt != entity(si->smu))\n\t\t\trestrictflags = allow_flags(mc, restrictflags);\n\t\telse\n\t\t\trestrictflags |= allow_flags(mc, restrictflags);\n\t}\n\n\tif (!(ca->level & CA_FOUNDER) && newflags & CA_FOUNDER)\n\t{\n\t\tif (mychan_num_founders(mc) >= chansvs.maxfounders)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"Only %d founders allowed per channel.\"), chansvs.maxfounders);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (mt == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"You may not set founder status on a hostmask.\"));\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (!myentity_can_register_channel(mt))\n\t\t{\n\t\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 has too many channels registered.\"), mt->name);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (!myentity_allow_foundership(mt))\n\t\t{\n\t\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 cannot take foundership of a channel.\"), mt->name);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t}\n\n\toldflags = ca->level;\n\n\taddflags = newflags & ~oldflags;\n\tremoveflags = ca_all & ~newflags;\n\n\tif (!chanacs_modify(ca, &addflags, &removeflags, restrictflags))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not add \\2%s\\2 to the \\2%s\\2 role.\"), target, role);\n\t\treturn;\n\t}\n\n\treq.newlevel = newflags;\n\n\thook_call_channel_acl_change(&req);\n\tchanacs_close(ca);\n\n\tcommand_success_nodata(si, _(\"\\2%s\\2 was added with the \\2%s\\2 role in \\2%s\\2.\"), target, role, channel);\n\tverbose(mc, \"\\2%s\\2 added \\2%s\\2 to the access list (with role: \\2%s\\2).\", get_source_name(si), target, role);\n\n\tlogcommand(si, CMDLOG_SET, \"ACCESS:ADD: \\2%s\\2 to \\2%s\\2 as \\2%s\\2\", target, mc->name, role);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_SET",
            "\"ACCESS:ADD: \\2%s\\2 to \\2%s\\2 as \\2%s\\2\"",
            "target",
            "mc->name",
            "role"
          ],
          "line": 973
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "mc",
            "\"\\2%s\\2 added \\2%s\\2 to the access list (with role: \\2%s\\2).\"",
            "get_source_name(si)",
            "target",
            "role"
          ],
          "line": 971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"\\2%s\\2 was added with the \\2%s\\2 role in \\2%s\\2.\")",
            "target",
            "role",
            "channel"
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"\\2%s\\2 was added with the \\2%s\\2 role in \\2%s\\2.\""
          ],
          "line": 970
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hook_call_channel_acl_change",
          "args": [
            "&req"
          ],
          "line": 967
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You may not add \\2%s\\2 to the \\2%s\\2 role.\")",
            "target",
            "role"
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_modify",
          "args": [
            "ca",
            "&addflags",
            "&removeflags",
            "restrictflags"
          ],
          "line": 959
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 949
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"\\2%s\\2 cannot take foundership of a channel.\")",
            "mt->name"
          ],
          "line": 948
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_allow_foundership",
          "args": [
            "mt"
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"\\2%s\\2 has too many channels registered.\")",
            "mt->name"
          ],
          "line": 942
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_can_register_channel",
          "args": [
            "mt"
          ],
          "line": 940
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"You may not set founder status on a hostmask.\")"
          ],
          "line": 936
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"Only %d founders allowed per channel.\")",
            "chansvs.maxfounders"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_num_founders",
          "args": [
            "mc"
          ],
          "line": 928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 923
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_flags",
          "args": [
            "mc",
            "si"
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"Role \\2%s\\2 does not exist.\")",
            "role"
          ],
          "line": 905
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 904
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "mc",
            "role"
          ],
          "line": 901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"\\2%s\\2 already has the \\2%s\\2 role in \\2%s\\2.\")",
            "target",
            "get_template_name(mc, ca->level)",
            "mc->name"
          ],
          "line": 894
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_name",
          "args": [
            "mc",
            "ca->level"
          ],
          "line": 894
        },
        "resolved": true,
        "details": {
          "function_name": "get_template_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "393-419",
          "snippet": "static const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"Channel %s access list is full.\")",
            "mc->name"
          ],
          "line": 887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 886
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_is_table_full",
          "args": [
            "ca"
          ],
          "line": 884
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_open",
          "args": [
            "mc",
            "mt",
            "NULL",
            "true",
            "entity(si->smu)"
          ],
          "line": 881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"\\2%s\\2 is not registered.\")",
            "target"
          ],
          "line": 877
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_find_ext",
          "args": [
            "target"
          ],
          "line": 875
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_open",
          "args": [
            "mc",
            "NULL",
            "target",
            "true",
            "entity(si->smu)"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "validhostmask",
          "args": [
            "target"
          ],
          "line": 871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_FLAGS"
          ],
          "line": 865
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ACCESS <#channel> ADD <account|hostmask> <role>\")"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ACCESS ADD\""
          ],
          "line": 857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 851
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 848
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt = NULL;\n\tmychan_t *mc;\n\thook_channel_acl_req_t req;\n\tunsigned int oldflags, restrictflags;\n\tunsigned int newflags, addflags, removeflags;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tconst char *role = parv[2];\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target || !role)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS ADD\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> ADD <account|hostmask> <role>\"));\n\t\treturn;\n\t}\n\n\t/* allow a user to resign their access even without FLAGS access. this is\n\t * consistent with the other commands. --nenolod\n\t */\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_open(mc, NULL, target, true, entity(si->smu));\n\telse\n\t{\n\t\tif (!(mt = myentity_find_ext(target)))\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_open(mc, mt, NULL, true, entity(si->smu));\n\t}\n\n\tif (ca->level == 0 && chanacs_is_table_full(ca))\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Channel %s access list is full.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (ca->level != 0)\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 already has the \\2%s\\2 role in \\2%s\\2.\"), target, get_template_name(mc, ca->level), mc->name);\n\t\treturn;\n\t}\n\n\treq.ca = ca;\n\treq.oldlevel = ca->level;\n\n\tnewflags = get_template_flags(mc, role);\n\tif (newflags == 0)\n\t{\n\t\tchanacs_close(ca);\n\t\tcommand_fail(si, fault_toomany, _(\"Role \\2%s\\2 does not exist.\"), role);\n\t\treturn;\n\t}\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t{\n\t\tif (restrictflags & CA_AKICK && entity(si->smu) == mt)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (mt != entity(si->smu))\n\t\t\trestrictflags = allow_flags(mc, restrictflags);\n\t\telse\n\t\t\trestrictflags |= allow_flags(mc, restrictflags);\n\t}\n\n\tif (!(ca->level & CA_FOUNDER) && newflags & CA_FOUNDER)\n\t{\n\t\tif (mychan_num_founders(mc) >= chansvs.maxfounders)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"Only %d founders allowed per channel.\"), chansvs.maxfounders);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (mt == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_badparams, _(\"You may not set founder status on a hostmask.\"));\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (!myentity_can_register_channel(mt))\n\t\t{\n\t\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 has too many channels registered.\"), mt->name);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t\tif (!myentity_allow_foundership(mt))\n\t\t{\n\t\t\tcommand_fail(si, fault_toomany, _(\"\\2%s\\2 cannot take foundership of a channel.\"), mt->name);\n\t\t\tchanacs_close(ca);\n\t\t\treturn;\n\t\t}\n\t}\n\n\toldflags = ca->level;\n\n\taddflags = newflags & ~oldflags;\n\tremoveflags = ca_all & ~newflags;\n\n\tif (!chanacs_modify(ca, &addflags, &removeflags, restrictflags))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not add \\2%s\\2 to the \\2%s\\2 role.\"), target, role);\n\t\treturn;\n\t}\n\n\treq.newlevel = newflags;\n\n\thook_call_channel_acl_change(&req);\n\tchanacs_close(ca);\n\n\tcommand_success_nodata(si, _(\"\\2%s\\2 was added with the \\2%s\\2 role in \\2%s\\2.\"), target, role, channel);\n\tverbose(mc, \"\\2%s\\2 added \\2%s\\2 to the access list (with role: \\2%s\\2).\", get_source_name(si), target, role);\n\n\tlogcommand(si, CMDLOG_SET, \"ACCESS:ADD: \\2%s\\2 to \\2%s\\2 as \\2%s\\2\", target, mc->name, role);\n}"
  },
  {
    "function_name": "cs_cmd_access_del",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "730-827",
    "snippet": "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt;\n\tmychan_t *mc;\n\thook_channel_acl_req_t req;\n\tunsigned int restrictflags;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tconst char *role;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS DEL\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> DEL <account|hostmask>\"));\n\t\treturn;\n\t}\n\n\tmt = myentity_find_ext(target);\n\n\t/* allow a user to resign their access even without FLAGS access. this is\n\t * consistent with the other commands. --nenolod\n\t */\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS) && entity(si->smu) != mt)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_open(mc, NULL, target, true, entity(si->smu));\n\telse\n\t{\n\t\tif (mt == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_open(mc, mt, NULL, true, entity(si->smu));\n\t}\n\n\tif (ca->level == 0)\n\t{\n\t\tchanacs_close(ca);\n\n\t\tcommand_success_nodata(si, _(\"No ACL entry for \\2%s\\2 in \\2%s\\2 was found.\"), target, channel);\n\t\treturn;\n\t}\n\n\tif (ca->level & CA_FOUNDER && mychan_num_founders(mc) == 1)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not remove the last founder.\"));\n\t\treturn;\n\t}\n\n\trole = get_template_name(mc, ca->level);\n\n\treq.ca = ca;\n\treq.oldlevel = ca->level;\n\treq.newlevel = 0;\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t{\n\t\tif (restrictflags & CA_AKICK && entity(si->smu) == mt)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (entity(si->smu) != mt)\n\t\t\trestrictflags = allow_flags(mc, restrictflags);\n\t}\n\n\tif (!chanacs_modify(ca, &req.newlevel, &req.oldlevel, restrictflags))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not remove \\2%s\\2 from the \\2%s\\2 role.\"), target, role);\n\t\treturn;\n\t}\n\n\thook_call_channel_acl_change(&req);\n\tchanacs_close(ca);\n\n\tcommand_success_nodata(si, _(\"\\2%s\\2 was removed from the \\2%s\\2 role in \\2%s\\2.\"), target, role, channel);\n\tverbose(mc, \"\\2%s\\2 deleted \\2%s\\2 from the access list (had role: \\2%s\\2).\", get_source_name(si), target, role);\n\n\tlogcommand(si, CMDLOG_SET, \"ACCESS:DEL: \\2%s\\2 from \\2%s\\2\", target, mc->name);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_SET",
            "\"ACCESS:DEL: \\2%s\\2 from \\2%s\\2\"",
            "target",
            "mc->name"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "verbose",
          "args": [
            "mc",
            "\"\\2%s\\2 deleted \\2%s\\2 from the access list (had role: \\2%s\\2).\"",
            "get_source_name(si)",
            "target",
            "role"
          ],
          "line": 824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_source_name",
          "args": [
            "si"
          ],
          "line": 824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"\\2%s\\2 was removed from the \\2%s\\2 role in \\2%s\\2.\")",
            "target",
            "role",
            "channel"
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"\\2%s\\2 was removed from the \\2%s\\2 role in \\2%s\\2.\""
          ],
          "line": 823
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hook_call_channel_acl_change",
          "args": [
            "&req"
          ],
          "line": 820
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You may not remove \\2%s\\2 from the \\2%s\\2 role.\")",
            "target",
            "role"
          ],
          "line": 816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_modify",
          "args": [
            "ca",
            "&req.newlevel",
            "&req.oldlevel",
            "restrictflags"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allow_flags",
          "args": [
            "mc",
            "restrictflags"
          ],
          "line": 811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_flags",
          "args": [
            "mc",
            "si"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_name",
          "args": [
            "mc",
            "ca->level"
          ],
          "line": 793
        },
        "resolved": true,
        "details": {
          "function_name": "get_template_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "393-419",
          "snippet": "static const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You may not remove the last founder.\")"
          ],
          "line": 789
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_num_founders",
          "args": [
            "mc"
          ],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"No ACL entry for \\2%s\\2 in \\2%s\\2 was found.\")",
            "target",
            "channel"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_open",
          "args": [
            "mc",
            "mt",
            "NULL",
            "true",
            "entity(si->smu)"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"\\2%s\\2 is not registered.\")",
            "target"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_open",
          "args": [
            "mc",
            "NULL",
            "target",
            "true",
            "entity(si->smu)"
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "validhostmask",
          "args": [
            "target"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entity",
          "args": [
            "si->smu"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_FLAGS"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_find_ext",
          "args": [
            "target"
          ],
          "line": 755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ACCESS <#channel> DEL <account|hostmask>\")"
          ],
          "line": 751
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ACCESS DEL\""
          ],
          "line": 750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt;\n\tmychan_t *mc;\n\thook_channel_acl_req_t req;\n\tunsigned int restrictflags;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tconst char *role;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS DEL\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> DEL <account|hostmask>\"));\n\t\treturn;\n\t}\n\n\tmt = myentity_find_ext(target);\n\n\t/* allow a user to resign their access even without FLAGS access. this is\n\t * consistent with the other commands. --nenolod\n\t */\n\tif (!chanacs_source_has_flag(mc, si, CA_FLAGS) && entity(si->smu) != mt)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\treturn;\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_open(mc, NULL, target, true, entity(si->smu));\n\telse\n\t{\n\t\tif (mt == NULL)\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_open(mc, mt, NULL, true, entity(si->smu));\n\t}\n\n\tif (ca->level == 0)\n\t{\n\t\tchanacs_close(ca);\n\n\t\tcommand_success_nodata(si, _(\"No ACL entry for \\2%s\\2 in \\2%s\\2 was found.\"), target, channel);\n\t\treturn;\n\t}\n\n\tif (ca->level & CA_FOUNDER && mychan_num_founders(mc) == 1)\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not remove the last founder.\"));\n\t\treturn;\n\t}\n\n\trole = get_template_name(mc, ca->level);\n\n\treq.ca = ca;\n\treq.oldlevel = ca->level;\n\treq.newlevel = 0;\n\n\trestrictflags = chanacs_source_flags(mc, si);\n\tif (restrictflags & CA_FOUNDER)\n\t\trestrictflags = ca_all;\n\telse\n\t{\n\t\tif (restrictflags & CA_AKICK && entity(si->smu) == mt)\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif (entity(si->smu) != mt)\n\t\t\trestrictflags = allow_flags(mc, restrictflags);\n\t}\n\n\tif (!chanacs_modify(ca, &req.newlevel, &req.oldlevel, restrictflags))\n\t{\n\t\tcommand_fail(si, fault_noprivs, _(\"You may not remove \\2%s\\2 from the \\2%s\\2 role.\"), target, role);\n\t\treturn;\n\t}\n\n\thook_call_channel_acl_change(&req);\n\tchanacs_close(ca);\n\n\tcommand_success_nodata(si, _(\"\\2%s\\2 was removed from the \\2%s\\2 role in \\2%s\\2.\"), target, role, channel);\n\tverbose(mc, \"\\2%s\\2 deleted \\2%s\\2 from the access list (had role: \\2%s\\2).\", get_source_name(si), target, role);\n\n\tlogcommand(si, CMDLOG_SET, \"ACCESS:DEL: \\2%s\\2 from \\2%s\\2\", target, mc->name);\n}"
  },
  {
    "function_name": "cs_cmd_access_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "631-721",
    "snippet": "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt;\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tbool operoverride = false;\n\tconst char *role;\n\tstruct tm tm;\n\tchar strfbuf[BUFSIZE];\n\tmetadata_t *md;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS INFO\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> INFO <account|hostmask>\"));\n\t\treturn;\n\t}\n\n\tif (!(mc->flags & MC_PUBACL) && !chanacs_source_has_flag(mc, si, CA_ACLVIEW))\n\t{\n\t\tif (has_priv(si, PRIV_CHAN_AUSPEX))\n\t\t\toperoverride = true;\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_find_host_literal(mc, target, 0);\n\telse\n\t{\n\t\tif (!(mt = myentity_find_ext(target)))\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_find_literal(mc, mt, 0);\n\t}\n\n\tif (ca == NULL)\n\t{\n\t\tcommand_success_nodata(si, _(\"No ACL entry for \\2%s\\2 in \\2%s\\2 was found.\"), target, channel);\n\n\t\tif (operoverride)\n\t\t\tlogcommand(si, CMDLOG_ADMIN, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2 (oper override)\", mc->name, target);\n\t\telse\n\t\t\tlogcommand(si, CMDLOG_GET, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2\", mc->name, target);\n\n\t\treturn;\n\t}\n\n\trole = get_template_name(mc, ca->level);\n\n\ttm = *localtime(&ca->tmodified);\n\tstrftime(strfbuf, sizeof strfbuf, TIME_FORMAT, &tm);\n\n\tcommand_success_nodata(si, _(\"Access for \\2%s\\2 in \\2%s\\2:\"), target, channel);\n\n\tif (ca->level == CA_AKICK)\n\t{\n\t\tmd = metadata_find(ca, \"reason\");\n\t\tif (md != NULL)\n\t\t\tcommand_success_nodata(si, _(\"Ban reason : %s\"),\n\t\t\t\t\tmd->value);\n\t}\n\telse if (ca->entity && strcasecmp(target, ca->entity->name))\n\t\tcommand_success_nodata(si, _(\"Role       : %s (inherited from \\2%s\\2)\"), role, ca->entity->name);\n\telse\n\t\tcommand_success_nodata(si, _(\"Role       : %s\"), role);\n\n\tcommand_success_nodata(si, _(\"Flags      : %s (%s)\"), xflag_tostr(ca->level), bitmask_to_flags2(ca->level, 0));\n\tcommand_success_nodata(si, _(\"Modified   : %s (%s ago)\"), strfbuf, time_ago(ca->tmodified));\n\tcommand_success_nodata(si, _(\"*** \\2End of Info\\2 ***\"));\n\n\tif (operoverride)\n\t\tlogcommand(si, CMDLOG_ADMIN, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2 (oper override)\", mc->name, target);\n\telse\n\t\tlogcommand(si, CMDLOG_GET, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2\", mc->name, target);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_GET",
            "\"ACCESS:INFO: \\2%s\\2 on \\2%s\\2\"",
            "mc->name",
            "target"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_ADMIN",
            "\"ACCESS:INFO: \\2%s\\2 on \\2%s\\2 (oper override)\"",
            "mc->name",
            "target"
          ],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"*** \\2End of Info\\2 ***\")"
          ],
          "line": 715
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"*** \\2End of Info\\2 ***\""
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Modified   : %s (%s ago)\")",
            "strfbuf",
            "time_ago(ca->tmodified)"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time_ago",
          "args": [
            "ca->tmodified"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Flags      : %s (%s)\")",
            "xflag_tostr(ca->level)",
            "bitmask_to_flags2(ca->level, 0)"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitmask_to_flags2",
          "args": [
            "ca->level",
            "0"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xflag_tostr",
          "args": [
            "ca->level"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Role       : %s\")",
            "role"
          ],
          "line": 711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Role       : %s (inherited from \\2%s\\2)\")",
            "role",
            "ca->entity->name"
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "target",
            "ca->entity->name"
          ],
          "line": 708
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Ban reason : %s\")",
            "md->value"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "metadata_find",
          "args": [
            "ca",
            "\"reason\""
          ],
          "line": 703
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Access for \\2%s\\2 in \\2%s\\2:\")",
            "target",
            "channel"
          ],
          "line": 699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strftime",
          "args": [
            "strfbuf",
            "sizeof strfbuf",
            "TIME_FORMAT",
            "&tm"
          ],
          "line": 697
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "localtime",
          "args": [
            "&ca->tmodified"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_name",
          "args": [
            "mc",
            "ca->level"
          ],
          "line": 694
        },
        "resolved": true,
        "details": {
          "function_name": "get_template_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "393-419",
          "snippet": "static const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_GET",
            "\"ACCESS:INFO: \\2%s\\2 on \\2%s\\2\"",
            "mc->name",
            "target"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_ADMIN",
            "\"ACCESS:INFO: \\2%s\\2 on \\2%s\\2 (oper override)\"",
            "mc->name",
            "target"
          ],
          "line": 687
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"No ACL entry for \\2%s\\2 in \\2%s\\2 was found.\")",
            "target",
            "channel"
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_find_literal",
          "args": [
            "mc",
            "mt",
            "0"
          ],
          "line": 679
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"\\2%s\\2 is not registered.\")",
            "target"
          ],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "myentity_find_ext",
          "args": [
            "target"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_find_host_literal",
          "args": [
            "mc",
            "target",
            "0"
          ],
          "line": 670
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "validhostmask",
          "args": [
            "target"
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "has_priv",
          "args": [
            "si",
            "PRIV_CHAN_AUSPEX"
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_ACLVIEW"
          ],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ACCESS <#channel> INFO <account|hostmask>\")"
          ],
          "line": 654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ACCESS INFO\""
          ],
          "line": 653
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmyentity_t *mt;\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tconst char *target = parv[1];\n\tbool operoverride = false;\n\tconst char *role;\n\tstruct tm tm;\n\tchar strfbuf[BUFSIZE];\n\tmetadata_t *md;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!target)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS INFO\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> INFO <account|hostmask>\"));\n\t\treturn;\n\t}\n\n\tif (!(mc->flags & MC_PUBACL) && !chanacs_source_has_flag(mc, si, CA_ACLVIEW))\n\t{\n\t\tif (has_priv(si, PRIV_CHAN_AUSPEX))\n\t\t\toperoverride = true;\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (validhostmask(target))\n\t\tca = chanacs_find_host_literal(mc, target, 0);\n\telse\n\t{\n\t\tif (!(mt = myentity_find_ext(target)))\n\t\t{\n\t\t\tcommand_fail(si, fault_nosuch_target, _(\"\\2%s\\2 is not registered.\"), target);\n\t\t\treturn;\n\t\t}\n\t\ttarget = mt->name;\n\t\tca = chanacs_find_literal(mc, mt, 0);\n\t}\n\n\tif (ca == NULL)\n\t{\n\t\tcommand_success_nodata(si, _(\"No ACL entry for \\2%s\\2 in \\2%s\\2 was found.\"), target, channel);\n\n\t\tif (operoverride)\n\t\t\tlogcommand(si, CMDLOG_ADMIN, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2 (oper override)\", mc->name, target);\n\t\telse\n\t\t\tlogcommand(si, CMDLOG_GET, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2\", mc->name, target);\n\n\t\treturn;\n\t}\n\n\trole = get_template_name(mc, ca->level);\n\n\ttm = *localtime(&ca->tmodified);\n\tstrftime(strfbuf, sizeof strfbuf, TIME_FORMAT, &tm);\n\n\tcommand_success_nodata(si, _(\"Access for \\2%s\\2 in \\2%s\\2:\"), target, channel);\n\n\tif (ca->level == CA_AKICK)\n\t{\n\t\tmd = metadata_find(ca, \"reason\");\n\t\tif (md != NULL)\n\t\t\tcommand_success_nodata(si, _(\"Ban reason : %s\"),\n\t\t\t\t\tmd->value);\n\t}\n\telse if (ca->entity && strcasecmp(target, ca->entity->name))\n\t\tcommand_success_nodata(si, _(\"Role       : %s (inherited from \\2%s\\2)\"), role, ca->entity->name);\n\telse\n\t\tcommand_success_nodata(si, _(\"Role       : %s\"), role);\n\n\tcommand_success_nodata(si, _(\"Flags      : %s (%s)\"), xflag_tostr(ca->level), bitmask_to_flags2(ca->level, 0));\n\tcommand_success_nodata(si, _(\"Modified   : %s (%s ago)\"), strfbuf, time_ago(ca->tmodified));\n\tcommand_success_nodata(si, _(\"*** \\2End of Info\\2 ***\"));\n\n\tif (operoverride)\n\t\tlogcommand(si, CMDLOG_ADMIN, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2 (oper override)\", mc->name, target);\n\telse\n\t\tlogcommand(si, CMDLOG_GET, \"ACCESS:INFO: \\2%s\\2 on \\2%s\\2\", mc->name, target);\n}"
  },
  {
    "function_name": "cs_cmd_access_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "565-618",
    "snippet": "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmowgli_node_t *n;\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tbool operoverride = false;\n\tunsigned int i = 1;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!(mc->flags & MC_PUBACL) && !chanacs_source_has_flag(mc, si, CA_ACLVIEW))\n\t{\n\t\tif (has_priv(si, PRIV_CHAN_AUSPEX))\n\t\t\toperoverride = true;\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommand_success_nodata(si, _(\"Entry Nickname/Host          Role\"));\n\tcommand_success_nodata(si, \"----- ---------------------- ----\");\n\n\tMOWGLI_ITER_FOREACH(n, mc->chanacs.head)\n\t{\n\t\tconst char *role;\n\n\t\tca = n->data;\n\n\t\tif (ca->level == CA_AKICK)\n\t\t\tcontinue;\n\n\t\trole = get_template_name(mc, ca->level);\n\n\t\tcommand_success_nodata(si, _(\"%-5d %-22s %s\"), i, ca->entity ? ca->entity->name : ca->host, role);\n\n\t\ti++;\n\t}\n\n\tcommand_success_nodata(si, \"----- ---------------------- ----\");\n\tcommand_success_nodata(si, _(\"End of \\2%s\\2 ACCESS listing.\"), channel);\n\n\tif (operoverride)\n\t\tlogcommand(si, CMDLOG_ADMIN, \"ACCESS:LIST: \\2%s\\2 (oper override)\", mc->name);\n\telse\n\t\tlogcommand(si, CMDLOG_GET, \"ACCESS:LIST: \\2%s\\2\", mc->name);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_GET",
            "\"ACCESS:LIST: \\2%s\\2\"",
            "mc->name"
          ],
          "line": 617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_ADMIN",
            "\"ACCESS:LIST: \\2%s\\2 (oper override)\"",
            "mc->name"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"End of \\2%s\\2 ACCESS listing.\")",
            "channel"
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"End of \\2%s\\2 ACCESS listing.\""
          ],
          "line": 612
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\"----- ---------------------- ----\""
          ],
          "line": 611
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"%-5d %-22s %s\")",
            "i",
            "ca->entity ? ca->entity->name : ca->host",
            "role"
          ],
          "line": 606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_name",
          "args": [
            "mc",
            "ca->level"
          ],
          "line": 604
        },
        "resolved": true,
        "details": {
          "function_name": "get_template_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "393-419",
          "snippet": "static const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "n",
            "mc->chanacs.head"
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\"----- ---------------------- ----\""
          ],
          "line": 593
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Entry Nickname/Host          Role\")"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_noprivs",
            "_(\"You are not authorized to perform this operation.\")"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "has_priv",
          "args": [
            "si",
            "PRIV_CHAN_AUSPEX"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_source_has_flag",
          "args": [
            "mc",
            "si",
            "CA_ACLVIEW"
          ],
          "line": 581
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_nosuch_target",
            "_(\"Channel \\2%s\\2 is not registered.\")",
            "channel"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mychan_find",
          "args": [
            "channel"
          ],
          "line": 574
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchanacs_t *ca;\n\tmowgli_node_t *n;\n\tmychan_t *mc;\n\tconst char *channel = parv[0];\n\tbool operoverride = false;\n\tunsigned int i = 1;\n\n\tmc = mychan_find(channel);\n\tif (!mc)\n\t{\n\t\tcommand_fail(si, fault_nosuch_target, _(\"Channel \\2%s\\2 is not registered.\"), channel);\n\t\treturn;\n\t}\n\n\tif (!(mc->flags & MC_PUBACL) && !chanacs_source_has_flag(mc, si, CA_ACLVIEW))\n\t{\n\t\tif (has_priv(si, PRIV_CHAN_AUSPEX))\n\t\t\toperoverride = true;\n\t\telse\n\t\t{\n\t\t\tcommand_fail(si, fault_noprivs, _(\"You are not authorized to perform this operation.\"));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcommand_success_nodata(si, _(\"Entry Nickname/Host          Role\"));\n\tcommand_success_nodata(si, \"----- ---------------------- ----\");\n\n\tMOWGLI_ITER_FOREACH(n, mc->chanacs.head)\n\t{\n\t\tconst char *role;\n\n\t\tca = n->data;\n\n\t\tif (ca->level == CA_AKICK)\n\t\t\tcontinue;\n\n\t\trole = get_template_name(mc, ca->level);\n\n\t\tcommand_success_nodata(si, _(\"%-5d %-22s %s\"), i, ca->entity ? ca->entity->name : ca->host, role);\n\n\t\ti++;\n\t}\n\n\tcommand_success_nodata(si, \"----- ---------------------- ----\");\n\tcommand_success_nodata(si, _(\"End of \\2%s\\2 ACCESS listing.\"), channel);\n\n\tif (operoverride)\n\t\tlogcommand(si, CMDLOG_ADMIN, \"ACCESS:LIST: \\2%s\\2 (oper override)\", mc->name);\n\telse\n\t\tlogcommand(si, CMDLOG_GET, \"ACCESS:LIST: \\2%s\\2\", mc->name);\n}"
  },
  {
    "function_name": "xflag_apply_batch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "541-551",
    "snippet": "static unsigned int xflag_apply_batch(unsigned int in, int parc, char *parv[])\n{\n\tunsigned int out;\n\tint i;\n\n\tout = in;\n\tfor (i = 0; i < parc; i++)\n\t\tout = xflag_apply(out, parv[i]);\n\n\treturn out;\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "xflag_apply",
          "args": [
            "out",
            "parv[i]"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\n\nstatic unsigned int xflag_apply_batch(unsigned int in, int parc, char *parv[])\n{\n\tunsigned int out;\n\tint i;\n\n\tout = in;\n\tfor (i = 0; i < parc; i++)\n\t\tout = xflag_apply(out, parv[i]);\n\n\treturn out;\n}"
  },
  {
    "function_name": "update_role_entry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "424-539",
    "snippet": "static void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"%d access entries updated accordingly.\")",
            "changes"
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"%d access entries updated accordingly.\""
          ],
          "line": 538
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "logcommand",
          "args": [
            "si",
            "CMDLOG_SET",
            "\"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\"",
            "mc->name",
            "role",
            "flagstr",
            "changes"
          ],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_close",
          "args": [
            "ca"
          ],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hook_call_channel_acl_change",
          "args": [
            "&req"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chanacs_modify_simple",
          "args": [
            "ca",
            "flags",
            "~flags"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH_SAFE",
          "args": [
            "n",
            "tn",
            "mc->chanacs.head"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "metadata_add",
          "args": [
            "mc",
            "\"private:templates\"",
            "newstr"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "metadata_delete",
          "args": [
            "mc",
            "\"private:templates\""
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_toomany",
            "_(\"Sorry, too many templates on \\2%s\\2.\")",
            "mc->name"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "newstr"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Invalid template name \\2%s\\2.\")",
            "role"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "has_ctrl_chars",
          "args": [
            "role"
          ],
          "line": 493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "newstr",
            "sizeof newstr",
            "\"%s=%s\"",
            "role",
            "flagstr"
          ],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "newstr + strlen(newstr)",
            "sizeof newstr - strlen(newstr)",
            "\" %s=%s\"",
            "role",
            "flagstr"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "newstr"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "newstr"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "newstr + (p - md->value)",
            "sizeof newstr - (p - md->value)",
            "\"%s=%s%s\"",
            "role",
            "flagstr",
            "r != NULL ? r : \"\""
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "newstr + (p - md->value)",
            "r != NULL ? r : \"\"",
            "sizeof newstr - (p - md->value)"
          ],
          "line": 474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "newstr",
            "r != NULL ? r + 1 : \"\"",
            "sizeof newstr"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncasecmp",
          "args": [
            "role",
            "p",
            "l"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "ss",
            "q",
            "sizeof ss"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "q",
            "' '"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "p",
            "'='"
          ],
          "line": 451
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "newstr",
            "p",
            "sizeof newstr"
          ],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "metadata_find",
          "args": [
            "mc",
            "\"private:templates\""
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "role"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "mc",
            "role"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitmask_to_flags2",
          "args": [
            "flags",
            "0"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void update_role_entry(sourceinfo_t *si, mychan_t *mc, const char *role, unsigned int flags)\n{\n\tmetadata_t *md;\n\tsize_t l;\n\tchar *p, *q, *r;\n\tchar ss[40], newstr[400];\n\tbool found = false;\n\tunsigned int oldflags;\n\tchar *flagstr;\n\tmowgli_node_t *n, *tn;\n\tchanacs_t *ca;\n\tint changes = 0;\n\thook_channel_acl_req_t req;\n\n\tflagstr = bitmask_to_flags2(flags, 0);\n\toldflags = get_template_flags(mc, role);\n\tl = strlen(role);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\tmowgli_strlcpy(newstr, p, sizeof newstr);\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\t\t\tif ((size_t)(q - p) == l && !strncasecmp(role, p, l))\n\t\t\t{\n\t\t\t\tfound = true;\n\n\t\t\t\tif (flags == 0)\n\t\t\t\t{\n\t\t\t\t\tif (p == md->value)\n\t\t\t\t\t\tmowgli_strlcpy(newstr, r != NULL ? r + 1 : \"\", sizeof newstr);\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t/* otherwise, zap the space before it */\n\t\t\t\t\t\tp--;\n\t\t\t\t\t\tmowgli_strlcpy(newstr + (p - md->value), r != NULL ? r : \"\", sizeof newstr - (p - md->value));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsnprintf(newstr + (p - md->value), sizeof newstr - (p - md->value), \"%s=%s%s\", role, flagstr, r != NULL ? r : \"\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tif (!found)\n\t{\n\t\tif (md != NULL)\n\t\t\tsnprintf(newstr + strlen(newstr), sizeof newstr - strlen(newstr), \" %s=%s\", role, flagstr);\n\t\telse\n\t\t\tsnprintf(newstr, sizeof newstr, \"%s=%s\", role, flagstr);\n\t}\n\n\tif (oldflags == 0 && has_ctrl_chars(role))\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid template name \\2%s\\2.\"), role);\n\t\treturn;\n\t}\n\n\tif (strlen(newstr) >= 300)\n\t{\n\t\tcommand_fail(si, fault_toomany, _(\"Sorry, too many templates on \\2%s\\2.\"), mc->name);\n\t\treturn;\n\t}\n\n\tif (newstr[0] == '\\0')\n\t\tmetadata_delete(mc, \"private:templates\");\n\telse\n\t\tmetadata_add(mc, \"private:templates\", newstr);\n\n\tif (flags)\n\t{\n\t\tMOWGLI_ITER_FOREACH_SAFE(n, tn, mc->chanacs.head)\n\t\t{\n\t\t\tca = n->data;\n\t\t\tif (ca->level != oldflags)\n\t\t\t\tcontinue;\n\n\t\t\t/* don't change foundership status. */\n\t\t\tif ((oldflags ^ flags) & CA_FOUNDER)\n\t\t\t\tcontinue;\n\n\t\t\treq.ca = ca;\n\t\t\treq.oldlevel = ca->level;\n\n\t\t\tchanges++;\n\t\t\tchanacs_modify_simple(ca, flags, ~flags);\n\n\t\t\treq.newlevel = ca->level;\n\n\t\t\thook_call_channel_acl_change(&req);\n\t\t\tchanacs_close(ca);\n\t\t}\n\t}\n\n\tlogcommand(si, CMDLOG_SET, \"ROLE:MOD: \\2%s\\2 \\2%s\\2 !\\2%s\\2 (\\2%d\\2 changes)\", mc->name, role, flagstr, changes);\n\n\tif (changes > 0)\n\t\tcommand_success_nodata(si, _(\"%d access entries updated accordingly.\"), changes);\n}"
  },
  {
    "function_name": "get_template_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "393-419",
    "snippet": "static const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free_template_list",
          "args": [
            "l"
          ],
          "line": 416
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "flagname",
            "\"<Custom>\"",
            "sizeof flagname"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "flagname",
            "exact_t->name",
            "sizeof flagname"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "n",
            "l->head"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "build_template_list",
          "args": [
            "mc"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "build_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "297-356",
          "snippet": "static mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic const char *get_template_name(mychan_t *mc, unsigned int level)\n{\n\tmowgli_list_t *l;\n\tmowgli_node_t *n;\n\tstatic char flagname[400];\n\ttemplate_t *exact_t = NULL;\n\n\tl = build_template_list(mc);\n\n\t/* find exact_t, lesser_t and greater_t */\n\tMOWGLI_ITER_FOREACH(n, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tif (t->level == level)\n\t\t\texact_t = t;\n\t}\n\n\tif (exact_t != NULL)\n\t\tmowgli_strlcpy(flagname, exact_t->name, sizeof flagname);\n\telse\n\t\tmowgli_strlcpy(flagname, \"<Custom>\", sizeof flagname);\n\n\tfree_template_list(l);\n\n\treturn flagname;\n}"
  },
  {
    "function_name": "free_template_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "358-371",
    "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "t"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "mowgli_node_delete",
          "args": [
            "&t->node",
            "l"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH_SAFE",
          "args": [
            "n",
            "tn",
            "l->head"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_if_fail",
          "args": [
            "l != NULL"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
  },
  {
    "function_name": "build_template_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "297-356",
    "snippet": "static mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mowgli_list_reverse",
          "args": [
            "l"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_list_sort",
          "args": [
            "l",
            "compare_template_nodes",
            "NULL"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_patricia_foreach",
          "args": [
            "global_template_dict",
            "append_global_template",
            "&ti"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_node_add",
          "args": [
            "t",
            "&t->node",
            "l"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "flags_to_bitmask",
          "args": [
            "ss",
            "0"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "t->name",
            "flagname",
            "sizeof(t->name)"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "smalloc",
          "args": [
            "sizeof(template_t)"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "flagname",
            "'='"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "flagname",
            "p",
            "sizeof flagname"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "ss",
            "q",
            "sizeof ss"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "q",
            "' '"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "p",
            "'='"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "metadata_find",
          "args": [
            "mc",
            "\"private:templates\""
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_val_if_fail",
          "args": [
            "mc != NULL",
            "l"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_list_create",
          "args": [],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic mowgli_list_t *build_template_list(mychan_t *mc)\n{\n\tconst char *p, *q, *r;\n\tchar *s;\n\tchar ss[40];\n\tstatic char flagname[400];\n\tmetadata_t *md;\n\tmowgli_list_t *l;\n\ttemplate_t *t;\n\ttemplate_iter_t ti;\n\n\tl = mowgli_list_create();\n\n\treturn_val_if_fail(mc != NULL, l);\n\n\tmd = metadata_find(mc, \"private:templates\");\n\tif (md != NULL)\n\t{\n\t\tp = md->value;\n\t\twhile (p != NULL)\n\t\t{\n\t\t\twhile (*p == ' ')\n\t\t\t\tp++;\n\t\t\tq = strchr(p, '=');\n\t\t\tif (q == NULL)\n\t\t\t\tbreak;\n\t\t\tr = strchr(q, ' ');\n\t\t\tif (r != NULL && r < q)\n\t\t\t\tbreak;\n\t\t\tmowgli_strlcpy(ss, q, sizeof ss);\n\t\t\tif (r != NULL && r - q < (int)(sizeof ss - 1))\n\t\t\t{\n\t\t\t\tss[r - q] = '\\0';\n\t\t\t}\n\n\t\t\tmowgli_strlcpy(flagname, p, sizeof flagname);\n\t\t\ts = strchr(flagname, '=');\n\t\t\tif (s != NULL)\n\t\t\t\t*s = '\\0';\n\n\t\t\tt = smalloc(sizeof(template_t));\n\t\t\tmowgli_strlcpy(t->name, flagname, sizeof(t->name));\n\t\t\tt->level = flags_to_bitmask(ss, 0);\n\t\t\tmowgli_node_add(t, &t->node, l);\n\n\t\t\tp = r;\n\t\t}\n\t}\n\n\tti.l = l;\n\tti.mc = mc;\n\tmowgli_patricia_foreach(global_template_dict, append_global_template, &ti);\n\n\tmowgli_list_sort(l, compare_template_nodes, NULL);\n\n\t/* reverse the list so that we go from highest flags to lowest. */\n\tmowgli_list_reverse(l);\n\n\treturn l;\n}"
  },
  {
    "function_name": "append_global_template",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "271-295",
    "snippet": "static int append_global_template(const char *key, void *data, void *privdata)\n{\n\ttemplate_t *t;\n\ttemplate_iter_t *ti = privdata;\n\tdefault_template_t *def_t = data;\n\tunsigned int vopflags;\n\n\tif (!chansvs.hide_xop)\n\t{\n\t\tvopflags = get_global_template_flags(\"VOP\");\n\n\t\tif (def_t->flags == vopflags && !strcasecmp(key, \"HOP\"))\n\t\t\treturn 0;\n\t}\n\n\tif ((t = find_template(ti->l, key)) != NULL)\n\t\treturn 0;\n\n\tt = smalloc(sizeof(template_t));\n\tmowgli_strlcpy(t->name, key, sizeof(t->name));\n\tt->level = get_template_flags(ti->mc, key);\n\tmowgli_node_add(t, &t->node, ti->l);\n\n        return 0;\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mowgli_node_add",
          "args": [
            "t",
            "&t->node",
            "ti->l"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_template_flags",
          "args": [
            "ti->mc",
            "key"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "t->name",
            "key",
            "sizeof(t->name)"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "smalloc",
          "args": [
            "sizeof(template_t)"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_template",
          "args": [
            "ti->l",
            "key"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "find_template",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "253-269",
          "snippet": "static template_t *find_template(mowgli_list_t *l, const char *key)\n{\n\tmowgli_node_t *iter;\n\n\treturn_val_if_fail(l != NULL, NULL);\n\treturn_val_if_fail(key != NULL, NULL);\n\n\tMOWGLI_ITER_FOREACH(iter, l->head)\n\t{\n\t\ttemplate_t *t = iter->data;\n\n\t\tif (!strcasecmp(t->name, key))\n\t\t\treturn t;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic template_t *find_template(mowgli_list_t *l, const char *key)\n{\n\tmowgli_node_t *iter;\n\n\treturn_val_if_fail(l != NULL, NULL);\n\treturn_val_if_fail(key != NULL, NULL);\n\n\tMOWGLI_ITER_FOREACH(iter, l->head)\n\t{\n\t\ttemplate_t *t = iter->data;\n\n\t\tif (!strcasecmp(t->name, key))\n\t\t\treturn t;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"HOP\""
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_global_template_flags",
          "args": [
            "\"VOP\""
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic int append_global_template(const char *key, void *data, void *privdata)\n{\n\ttemplate_t *t;\n\ttemplate_iter_t *ti = privdata;\n\tdefault_template_t *def_t = data;\n\tunsigned int vopflags;\n\n\tif (!chansvs.hide_xop)\n\t{\n\t\tvopflags = get_global_template_flags(\"VOP\");\n\n\t\tif (def_t->flags == vopflags && !strcasecmp(key, \"HOP\"))\n\t\t\treturn 0;\n\t}\n\n\tif ((t = find_template(ti->l, key)) != NULL)\n\t\treturn 0;\n\n\tt = smalloc(sizeof(template_t));\n\tmowgli_strlcpy(t->name, key, sizeof(t->name));\n\tt->level = get_template_flags(ti->mc, key);\n\tmowgli_node_add(t, &t->node, ti->l);\n\n        return 0;\n}"
  },
  {
    "function_name": "find_template",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "253-269",
    "snippet": "static template_t *find_template(mowgli_list_t *l, const char *key)\n{\n\tmowgli_node_t *iter;\n\n\treturn_val_if_fail(l != NULL, NULL);\n\treturn_val_if_fail(key != NULL, NULL);\n\n\tMOWGLI_ITER_FOREACH(iter, l->head)\n\t{\n\t\ttemplate_t *t = iter->data;\n\n\t\tif (!strcasecmp(t->name, key))\n\t\t\treturn t;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "t->name",
            "key"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MOWGLI_ITER_FOREACH",
          "args": [
            "iter",
            "l->head"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_val_if_fail",
          "args": [
            "key != NULL",
            "NULL"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "return_val_if_fail",
          "args": [
            "l != NULL",
            "NULL"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic template_t *find_template(mowgli_list_t *l, const char *key)\n{\n\tmowgli_node_t *iter;\n\n\treturn_val_if_fail(l != NULL, NULL);\n\treturn_val_if_fail(key != NULL, NULL);\n\n\tMOWGLI_ITER_FOREACH(iter, l->head)\n\t{\n\t\ttemplate_t *t = iter->data;\n\n\t\tif (!strcasecmp(t->name, key))\n\t\t\treturn t;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "compare_template_nodes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "245-251",
    "snippet": "static int compare_template_nodes(mowgli_node_t *a, mowgli_node_t *b, void *opaque)\n{\n\ttemplate_t *ta = a->data;\n\ttemplate_t *tb = b->data;\n\n\treturn count_bits(ta->level) - count_bits(tb->level);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "count_bits",
          "args": [
            "tb->level"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "count_bits",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "221-232",
          "snippet": "static inline unsigned int count_bits(unsigned int bits)\n{\n\tunsigned int i = 1, count = 0;\n\n\tfor (i = 1; i < sizeof(bits) * 8; i++)\n\t{\n\t\tif (bits & (1 << i))\n\t\t\tcount++;\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic inline unsigned int count_bits(unsigned int bits)\n{\n\tunsigned int i = 1, count = 0;\n\n\tfor (i = 1; i < sizeof(bits) * 8; i++)\n\t{\n\t\tif (bits & (1 << i))\n\t\t\tcount++;\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic int compare_template_nodes(mowgli_node_t *a, mowgli_node_t *b, void *opaque)\n{\n\ttemplate_t *ta = a->data;\n\ttemplate_t *tb = b->data;\n\n\treturn count_bits(ta->level) - count_bits(tb->level);\n}"
  },
  {
    "function_name": "count_bits",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "221-232",
    "snippet": "static inline unsigned int count_bits(unsigned int bits)\n{\n\tunsigned int i = 1, count = 0;\n\n\tfor (i = 1; i < sizeof(bits) * 8; i++)\n\t{\n\t\tif (bits & (1 << i))\n\t\t\tcount++;\n\t}\n\n\treturn count;\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic inline unsigned int count_bits(unsigned int bits)\n{\n\tunsigned int i = 1, count = 0;\n\n\tfor (i = 1; i < sizeof(bits) * 8; i++)\n\t{\n\t\tif (bits & (1 << i))\n\t\t\tcount++;\n\t}\n\n\treturn count;\n}"
  },
  {
    "function_name": "cs_cmd_role",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "179-217",
    "snippet": "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchar *chan;\n\tchar *cmd;\n\tcommand_t *c;\n\tchar buf[BUFSIZE];\n\n\tif (parc < 2)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tif (parv[0][0] == '#')\n\t\tchan = parv[0], cmd = parv[1];\n\telse if (parv[1][0] == '#')\n\t\tcmd = parv[0], chan = parv[1];\n\telse\n\t{\n\t\tcommand_fail(si, fault_badparams, STR_INVALID_PARAMS, \"ROLE\");\n\t\tcommand_fail(si, fault_badparams, _(\"Syntax: ROLE <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tc = command_find(cs_role_cmds, cmd);\n\tif (c == NULL)\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\"), (ircd->uses_rcommand == false) ? \"msg \" : \"\", chansvs.me->disp);\n\t\treturn;\n\t}\n\n\tif (parc > 2)\n\t\tsnprintf(buf, BUFSIZE, \"%s %s\", chan, parv[2]);\n\telse\n\t\tmowgli_strlcpy(buf, chan, BUFSIZE);\n\n\tcommand_exec_split(si->service, si, c->name, buf, cs_role_cmds);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);",
      "mowgli_patricia_t *cs_role_cmds;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "command_exec_split",
          "args": [
            "si->service",
            "si",
            "c->name",
            "buf",
            "cs_role_cmds"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "buf",
            "chan",
            "BUFSIZE"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "BUFSIZE",
            "\"%s %s\"",
            "chan",
            "parv[2]"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\")",
            "(ircd->uses_rcommand == false) ? \"msg \" : \"\"",
            "chansvs.me->disp"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\""
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_find",
          "args": [
            "cs_role_cmds",
            "cmd"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Syntax: ROLE <#channel> <command> [parameters]\")"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "STR_INVALID_PARAMS",
            "\"ROLE\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ROLE <#channel> <command> [parameters]\")"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ROLE\""
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\nmowgli_patricia_t *cs_role_cmds;\n\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchar *chan;\n\tchar *cmd;\n\tcommand_t *c;\n\tchar buf[BUFSIZE];\n\n\tif (parc < 2)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ROLE\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ROLE <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tif (parv[0][0] == '#')\n\t\tchan = parv[0], cmd = parv[1];\n\telse if (parv[1][0] == '#')\n\t\tcmd = parv[0], chan = parv[1];\n\telse\n\t{\n\t\tcommand_fail(si, fault_badparams, STR_INVALID_PARAMS, \"ROLE\");\n\t\tcommand_fail(si, fault_badparams, _(\"Syntax: ROLE <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tc = command_find(cs_role_cmds, cmd);\n\tif (c == NULL)\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\"), (ircd->uses_rcommand == false) ? \"msg \" : \"\", chansvs.me->disp);\n\t\treturn;\n\t}\n\n\tif (parc > 2)\n\t\tsnprintf(buf, BUFSIZE, \"%s %s\", chan, parv[2]);\n\telse\n\t\tmowgli_strlcpy(buf, chan, BUFSIZE);\n\n\tcommand_exec_split(si->service, si, c->name, buf, cs_role_cmds);\n}"
  },
  {
    "function_name": "cs_cmd_access",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "139-177",
    "snippet": "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchar *chan;\n\tchar *cmd;\n\tcommand_t *c;\n\tchar buf[BUFSIZE];\n\n\tif (parc < 2)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tif (parv[0][0] == '#')\n\t\tchan = parv[0], cmd = parv[1];\n\telse if (parv[1][0] == '#')\n\t\tcmd = parv[0], chan = parv[1];\n\telse\n\t{\n\t\tcommand_fail(si, fault_badparams, STR_INVALID_PARAMS, \"ACCESS\");\n\t\tcommand_fail(si, fault_badparams, _(\"Syntax: ACCESS <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tc = command_find(cs_access_cmds, cmd);\n\tif (c == NULL)\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\"), (ircd->uses_rcommand == false) ? \"msg \" : \"\", chansvs.me->disp);\n\t\treturn;\n\t}\n\n\tif (parc > 2)\n\t\tsnprintf(buf, BUFSIZE, \"%s %s\", chan, parv[2]);\n\telse\n\t\tmowgli_strlcpy(buf, chan, BUFSIZE);\n\n\tcommand_exec_split(si->service, si, c->name, buf, cs_access_cmds);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);",
      "static void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);",
      "mowgli_patricia_t *cs_access_cmds;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "command_exec_split",
          "args": [
            "si->service",
            "si",
            "c->name",
            "buf",
            "cs_access_cmds"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_strlcpy",
          "args": [
            "buf",
            "chan",
            "BUFSIZE"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "BUFSIZE",
            "\"%s %s\"",
            "chan",
            "parv[2]"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\")",
            "(ircd->uses_rcommand == false) ? \"msg \" : \"\"",
            "chansvs.me->disp"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\""
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_find",
          "args": [
            "cs_access_cmds",
            "cmd"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "_(\"Syntax: ACCESS <#channel> <command> [parameters]\")"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_badparams",
            "STR_INVALID_PARAMS",
            "\"ACCESS\""
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "_(\"Syntax: ACCESS <#channel> <command> [parameters]\")"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_fail",
          "args": [
            "si",
            "fault_needmoreparams",
            "STR_INSUFFICIENT_PARAMS",
            "\"ACCESS\""
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_info(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_del(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_access_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_list(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_add(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_set(sourceinfo_t *si, int parc, char *parv[]);\nstatic void cs_cmd_role_del(sourceinfo_t *si, int parc, char *parv[]);\nmowgli_patricia_t *cs_access_cmds;\n\nstatic void cs_cmd_access(sourceinfo_t *si, int parc, char *parv[])\n{\n\tchar *chan;\n\tchar *cmd;\n\tcommand_t *c;\n\tchar buf[BUFSIZE];\n\n\tif (parc < 2)\n\t{\n\t\tcommand_fail(si, fault_needmoreparams, STR_INSUFFICIENT_PARAMS, \"ACCESS\");\n\t\tcommand_fail(si, fault_needmoreparams, _(\"Syntax: ACCESS <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tif (parv[0][0] == '#')\n\t\tchan = parv[0], cmd = parv[1];\n\telse if (parv[1][0] == '#')\n\t\tcmd = parv[0], chan = parv[1];\n\telse\n\t{\n\t\tcommand_fail(si, fault_badparams, STR_INVALID_PARAMS, \"ACCESS\");\n\t\tcommand_fail(si, fault_badparams, _(\"Syntax: ACCESS <#channel> <command> [parameters]\"));\n\t\treturn;\n\t}\n\n\tc = command_find(cs_access_cmds, cmd);\n\tif (c == NULL)\n\t{\n\t\tcommand_fail(si, fault_badparams, _(\"Invalid command. Use \\2/%s%s help\\2 for a command listing.\"), (ircd->uses_rcommand == false) ? \"msg \" : \"\", chansvs.me->disp);\n\t\treturn;\n\t}\n\n\tif (parc > 2)\n\t\tsnprintf(buf, BUFSIZE, \"%s %s\", chan, parv[2]);\n\telse\n\t\tmowgli_strlcpy(buf, chan, BUFSIZE);\n\n\tcommand_exec_split(si->service, si, c->name, buf, cs_access_cmds);\n}"
  },
  {
    "function_name": "cs_help_role",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "123-137",
    "snippet": "static void cs_help_role(sourceinfo_t *si, const char *subcmd)\n{\n\tif (!subcmd)\n\t{\n\t\tcommand_success_nodata(si, _(\"***** \\2%s Help\\2 *****\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"Help for \\2ROLE\\2:\"));\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_help(si, cs_role_cmds);\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_success_nodata(si, _(\"For more information, use \\2/msg %s HELP ROLE \\37command\\37\\2.\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"***** \\2End of Help\\2 *****\"));\n\t}\n\telse\n\t\thelp_display(si, si->service, subcmd, cs_role_cmds);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_help_access(sourceinfo_t *si, const char *subcmd);",
      "static void cs_help_role(sourceinfo_t *si, const char *subcmd);",
      "mowgli_patricia_t *cs_role_cmds;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "help_display",
          "args": [
            "si",
            "si->service",
            "subcmd",
            "cs_role_cmds"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"***** \\2End of Help\\2 *****\")"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"***** \\2End of Help\\2 *****\""
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"For more information, use \\2/msg %s HELP ROLE \\37command\\37\\2.\")",
            "chansvs.me->disp"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\" \""
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_help",
          "args": [
            "si",
            "cs_role_cmds"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\" \""
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Help for \\2ROLE\\2:\")"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"***** \\2%s Help\\2 *****\")",
            "chansvs.me->disp"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_help_access(sourceinfo_t *si, const char *subcmd);\nstatic void cs_help_role(sourceinfo_t *si, const char *subcmd);\nmowgli_patricia_t *cs_role_cmds;\n\nstatic void cs_help_role(sourceinfo_t *si, const char *subcmd)\n{\n\tif (!subcmd)\n\t{\n\t\tcommand_success_nodata(si, _(\"***** \\2%s Help\\2 *****\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"Help for \\2ROLE\\2:\"));\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_help(si, cs_role_cmds);\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_success_nodata(si, _(\"For more information, use \\2/msg %s HELP ROLE \\37command\\37\\2.\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"***** \\2End of Help\\2 *****\"));\n\t}\n\telse\n\t\thelp_display(si, si->service, subcmd, cs_role_cmds);\n}"
  },
  {
    "function_name": "cs_help_access",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "107-121",
    "snippet": "static void cs_help_access(sourceinfo_t *si, const char *subcmd)\n{\n\tif (!subcmd)\n\t{\n\t\tcommand_success_nodata(si, _(\"***** \\2%s Help\\2 *****\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"Help for \\2ACCESS\\2:\"));\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_help(si, cs_access_cmds);\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_success_nodata(si, _(\"For more information, use \\2/msg %s HELP ACCESS \\37command\\37\\2.\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"***** \\2End of Help\\2 *****\"));\n\t}\n\telse\n\t\thelp_display(si, si->service, subcmd, cs_access_cmds);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void cs_help_access(sourceinfo_t *si, const char *subcmd);",
      "static void cs_help_role(sourceinfo_t *si, const char *subcmd);",
      "mowgli_patricia_t *cs_access_cmds;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "help_display",
          "args": [
            "si",
            "si->service",
            "subcmd",
            "cs_access_cmds"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"***** \\2End of Help\\2 *****\")"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"***** \\2End of Help\\2 *****\""
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "free_template_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
          "lines": "358-371",
          "snippet": "static void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}",
          "includes": [
            "#include \"template.h\"",
            "#include \"atheme.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void free_template_list(mowgli_list_t *l)\n{\n\tmowgli_node_t *n, *tn;\n\n\treturn_if_fail(l != NULL);\n\n\tMOWGLI_ITER_FOREACH_SAFE(n, tn, l->head)\n\t{\n\t\ttemplate_t *t = n->data;\n\n\t\tmowgli_node_delete(&t->node, l);\n\t\tfree(t);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"For more information, use \\2/msg %s HELP ACCESS \\37command\\37\\2.\")",
            "chansvs.me->disp"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\" \""
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_help",
          "args": [
            "si",
            "cs_access_cmds"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "\" \""
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"Help for \\2ACCESS\\2:\")"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_success_nodata",
          "args": [
            "si",
            "_(\"***** \\2%s Help\\2 *****\")",
            "chansvs.me->disp"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\nstatic void cs_help_access(sourceinfo_t *si, const char *subcmd);\nstatic void cs_help_role(sourceinfo_t *si, const char *subcmd);\nmowgli_patricia_t *cs_access_cmds;\n\nstatic void cs_help_access(sourceinfo_t *si, const char *subcmd)\n{\n\tif (!subcmd)\n\t{\n\t\tcommand_success_nodata(si, _(\"***** \\2%s Help\\2 *****\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"Help for \\2ACCESS\\2:\"));\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_help(si, cs_access_cmds);\n\t\tcommand_success_nodata(si, \" \");\n\t\tcommand_success_nodata(si, _(\"For more information, use \\2/msg %s HELP ACCESS \\37command\\37\\2.\"), chansvs.me->disp);\n\t\tcommand_success_nodata(si, _(\"***** \\2End of Help\\2 *****\"));\n\t}\n\telse\n\t\thelp_display(si, si->service, subcmd, cs_access_cmds);\n}"
  },
  {
    "function_name": "_moddeinit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "98-105",
    "snippet": "void _moddeinit(module_unload_intent_t intent)\n{\n\tservice_named_unbind_command(\"chanserv\", &cs_access);\n\tservice_named_unbind_command(\"chanserv\", &cs_role);\n\n\tmowgli_patricia_destroy(cs_access_cmds, NULL, NULL);\n\tmowgli_patricia_destroy(cs_role_cmds, NULL, NULL);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "command_t cs_access = { \"ACCESS\", N_(\"Manage channel access.\"),\n                        AC_NONE, 3, cs_cmd_access, { .func = cs_help_access } };",
      "command_t cs_role =  { \"ROLE\", N_(\"Manage channel roles.\"),\n                        AC_NONE, 3, cs_cmd_role, { .func = cs_help_role } };",
      "mowgli_patricia_t *cs_access_cmds;",
      "mowgli_patricia_t *cs_role_cmds;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "mowgli_patricia_destroy",
          "args": [
            "cs_role_cmds",
            "NULL",
            "NULL"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_patricia_destroy",
          "args": [
            "cs_access_cmds",
            "NULL",
            "NULL"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_named_unbind_command",
          "args": [
            "\"chanserv\"",
            "&cs_role"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_named_unbind_command",
          "args": [
            "\"chanserv\"",
            "&cs_access"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\ncommand_t cs_access = { \"ACCESS\", N_(\"Manage channel access.\"),\n                        AC_NONE, 3, cs_cmd_access, { .func = cs_help_access } };\ncommand_t cs_role =  { \"ROLE\", N_(\"Manage channel roles.\"),\n                        AC_NONE, 3, cs_cmd_role, { .func = cs_help_role } };\nmowgli_patricia_t *cs_access_cmds;\nmowgli_patricia_t *cs_role_cmds;\n\nvoid _moddeinit(module_unload_intent_t intent)\n{\n\tservice_named_unbind_command(\"chanserv\", &cs_access);\n\tservice_named_unbind_command(\"chanserv\", &cs_role);\n\n\tmowgli_patricia_destroy(cs_access_cmds, NULL, NULL);\n\tmowgli_patricia_destroy(cs_role_cmds, NULL, NULL);\n}"
  },
  {
    "function_name": "_modinit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9773/repo/modules/chanserv/access.c",
    "lines": "78-96",
    "snippet": "void _modinit(module_t *m)\n{\n\tservice_named_bind_command(\"chanserv\", &cs_access);\n\tservice_named_bind_command(\"chanserv\", &cs_role);\n\n\tcs_access_cmds = mowgli_patricia_create(strcasecanon);\n\tcs_role_cmds  = mowgli_patricia_create(strcasecanon);\n\n\tcommand_add(&cs_access_list, cs_access_cmds);\n\tcommand_add(&cs_access_info, cs_access_cmds);\n\tcommand_add(&cs_access_del, cs_access_cmds);\n\tcommand_add(&cs_access_add, cs_access_cmds);\n\tcommand_add(&cs_access_set, cs_access_cmds);\n\n\tcommand_add(&cs_role_list, cs_role_cmds);\n\tcommand_add(&cs_role_add, cs_role_cmds);\n\tcommand_add(&cs_role_set, cs_role_cmds);\n\tcommand_add(&cs_role_del, cs_role_cmds);\n}",
    "includes": [
      "#include \"template.h\"",
      "#include \"atheme.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "command_t cs_access = { \"ACCESS\", N_(\"Manage channel access.\"),\n                        AC_NONE, 3, cs_cmd_access, { .func = cs_help_access } };",
      "command_t cs_role =  { \"ROLE\", N_(\"Manage channel roles.\"),\n                        AC_NONE, 3, cs_cmd_role, { .func = cs_help_role } };",
      "command_t cs_access_list = { \"LIST\", N_(\"List channel access entries.\"),\n                             AC_NONE, 1, cs_cmd_access_list, { .path = \"cservice/access_list\" } };",
      "command_t cs_access_info = { \"INFO\", N_(\"Display information on an access list entry.\"),\n                             AC_NONE, 2, cs_cmd_access_info, { .path = \"cservice/access_info\" } };",
      "command_t cs_access_del =  { \"DEL\", N_(\"Delete an access list entry.\"),\n                             AC_NONE, 2, cs_cmd_access_del, { .path = \"cservice/access_del\" } };",
      "command_t cs_access_add =  { \"ADD\", N_(\"Add an access list entry.\"),\n                             AC_NONE, 3, cs_cmd_access_add, { .path = \"cservice/access_add\" } };",
      "command_t cs_access_set =  { \"SET\", N_(\"Update an access list entry.\"),\n                             AC_NONE, 3, cs_cmd_access_set, { .path = \"cservice/access_set\" } };",
      "command_t cs_role_list = { \"LIST\", N_(\"List available roles.\"),\n                            AC_NONE, 1, cs_cmd_role_list, { .path = \"cservice/role_list\" } };",
      "command_t cs_role_add =  { \"ADD\", N_(\"Add a role.\"),\n                            AC_NONE, 20, cs_cmd_role_add, { .path = \"cservice/role_add\" } };",
      "command_t cs_role_set =  { \"SET\", N_(\"Change flags on a role.\"),\n                            AC_NONE, 20, cs_cmd_role_set, { .path = \"cservice/role_set\" } };",
      "command_t cs_role_del =  { \"DEL\", N_(\"Delete a role.\"),\n                            AC_NONE, 2, cs_cmd_role_del, { .path = \"cservice/role_del\" } };",
      "mowgli_patricia_t *cs_access_cmds;",
      "mowgli_patricia_t *cs_role_cmds;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_role_del",
            "cs_role_cmds"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_role_set",
            "cs_role_cmds"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_role_add",
            "cs_role_cmds"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_role_list",
            "cs_role_cmds"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_access_set",
            "cs_access_cmds"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_access_add",
            "cs_access_cmds"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_access_del",
            "cs_access_cmds"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_access_info",
            "cs_access_cmds"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "command_add",
          "args": [
            "&cs_access_list",
            "cs_access_cmds"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_patricia_create",
          "args": [
            "strcasecanon"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mowgli_patricia_create",
          "args": [
            "strcasecanon"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_named_bind_command",
          "args": [
            "\"chanserv\"",
            "&cs_role"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_named_bind_command",
          "args": [
            "\"chanserv\"",
            "&cs_access"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"template.h\"\n#include \"atheme.h\"\n\ncommand_t cs_access = { \"ACCESS\", N_(\"Manage channel access.\"),\n                        AC_NONE, 3, cs_cmd_access, { .func = cs_help_access } };\ncommand_t cs_role =  { \"ROLE\", N_(\"Manage channel roles.\"),\n                        AC_NONE, 3, cs_cmd_role, { .func = cs_help_role } };\ncommand_t cs_access_list = { \"LIST\", N_(\"List channel access entries.\"),\n                             AC_NONE, 1, cs_cmd_access_list, { .path = \"cservice/access_list\" } };\ncommand_t cs_access_info = { \"INFO\", N_(\"Display information on an access list entry.\"),\n                             AC_NONE, 2, cs_cmd_access_info, { .path = \"cservice/access_info\" } };\ncommand_t cs_access_del =  { \"DEL\", N_(\"Delete an access list entry.\"),\n                             AC_NONE, 2, cs_cmd_access_del, { .path = \"cservice/access_del\" } };\ncommand_t cs_access_add =  { \"ADD\", N_(\"Add an access list entry.\"),\n                             AC_NONE, 3, cs_cmd_access_add, { .path = \"cservice/access_add\" } };\ncommand_t cs_access_set =  { \"SET\", N_(\"Update an access list entry.\"),\n                             AC_NONE, 3, cs_cmd_access_set, { .path = \"cservice/access_set\" } };\ncommand_t cs_role_list = { \"LIST\", N_(\"List available roles.\"),\n                            AC_NONE, 1, cs_cmd_role_list, { .path = \"cservice/role_list\" } };\ncommand_t cs_role_add =  { \"ADD\", N_(\"Add a role.\"),\n                            AC_NONE, 20, cs_cmd_role_add, { .path = \"cservice/role_add\" } };\ncommand_t cs_role_set =  { \"SET\", N_(\"Change flags on a role.\"),\n                            AC_NONE, 20, cs_cmd_role_set, { .path = \"cservice/role_set\" } };\ncommand_t cs_role_del =  { \"DEL\", N_(\"Delete a role.\"),\n                            AC_NONE, 2, cs_cmd_role_del, { .path = \"cservice/role_del\" } };\nmowgli_patricia_t *cs_access_cmds;\nmowgli_patricia_t *cs_role_cmds;\n\nvoid _modinit(module_t *m)\n{\n\tservice_named_bind_command(\"chanserv\", &cs_access);\n\tservice_named_bind_command(\"chanserv\", &cs_role);\n\n\tcs_access_cmds = mowgli_patricia_create(strcasecanon);\n\tcs_role_cmds  = mowgli_patricia_create(strcasecanon);\n\n\tcommand_add(&cs_access_list, cs_access_cmds);\n\tcommand_add(&cs_access_info, cs_access_cmds);\n\tcommand_add(&cs_access_del, cs_access_cmds);\n\tcommand_add(&cs_access_add, cs_access_cmds);\n\tcommand_add(&cs_access_set, cs_access_cmds);\n\n\tcommand_add(&cs_role_list, cs_role_cmds);\n\tcommand_add(&cs_role_add, cs_role_cmds);\n\tcommand_add(&cs_role_set, cs_role_cmds);\n\tcommand_add(&cs_role_del, cs_role_cmds);\n}"
  }
]