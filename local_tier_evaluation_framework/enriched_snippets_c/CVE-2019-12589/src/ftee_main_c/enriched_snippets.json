[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "187-245",
    "snippet": "int main(int argc, char **argv) {\n\tif (argc < 2) {\n\t\tfprintf(stderr, \"Error: please provide a filename to store the program output\\n\");\n\t\tusage();\n\t\texit(1);\n\t}\n\tif (strcmp(argv[1], \"--help\") == 0) {\n\t\tusage();\n\t\treturn 0;\n\t}\n\tchar *fname = argv[1];\n\n\n\t// do not accept directories, links, and files with \"..\"\n\tif (strstr(fname, \"..\") || is_link(fname) || is_dir(fname))\n\t\tgoto errexit;\n\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\t// check permissions\n\t\tif (s.st_uid != getuid() || s.st_gid != getgid())\n\t\t\tgoto errexit;\n\n\t\t// check hard links\n\t\tif (s.st_nlink != 1)\n\t\t\tgoto errexit;\n\t}\n\n\t// check if we can append to this file\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"a\");\n\tif (!fp)\n\t\tgoto errexit;\n\tfclose(fp);\n\n\n\t// preserve the last log file\n\tlog_rotate(fname);\n\n\tsetvbuf (stdout, NULL, _IONBF, 0);\n\twhile(1) {\n\t\tint n = read(0, buf, sizeof(buf));\n\t\tif (n < 0 && errno == EINTR)\n\t\t\tcontinue;\n\t\tif (n <= 0)\n\t\t\tbreak;\n\n\t\tint rv = fwrite(buf, n, 1, stdout);\n\t\t(void) rv;\n\t\tlog_write(buf, n, fname);\n\t}\n\n\tlog_close();\n\treturn 0;\n\nerrexit:\n\tfprintf(stderr, \"Error ftee: invalid output file.\\n\");\n\treturn 1;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static unsigned char buf[MAXBUF];"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error ftee: invalid output file.\\n\""
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_close",
          "args": [],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "log_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "33-38",
          "snippet": "static void log_close(void) {\n\tif (out_fp) {\n\t\tfclose(out_fp);\n\t\tout_fp = NULL;\n\t}\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static FILE *out_fp = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\n\nstatic void log_close(void) {\n\tif (out_fp) {\n\t\tfclose(out_fp);\n\t\tout_fp = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_write",
          "args": [
            "buf",
            "n",
            "fname"
          ],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "log_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "104-135",
          "snippet": "static void log_write(const unsigned char *str, int len, const char *fname) {\n\tassert(fname);\n\n\tif (out_fp == NULL) {\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = 0;\n\t}\n\n\t// rotate files\n\tout_cnt += len;\n\tif (out_cnt >= out_max) {\n\t\tlog_rotate(fname);\n\n\t\t// reopen the first file\n\t\tif (out_fp)\n\t\t\tfclose(out_fp);\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = len;\n\t}\n\n\tint rv = fwrite(str, len, 1, out_fp);\n\t(void) rv;\n\tfflush(0);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static FILE *out_fp = NULL;",
            "static int out_cnt = 0;",
            "static int out_max = 500 * 1024;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\nstatic int out_cnt = 0;\nstatic int out_max = 500 * 1024;\n\nstatic void log_write(const unsigned char *str, int len, const char *fname) {\n\tassert(fname);\n\n\tif (out_fp == NULL) {\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = 0;\n\t}\n\n\t// rotate files\n\tout_cnt += len;\n\tif (out_cnt >= out_max) {\n\t\tlog_rotate(fname);\n\n\t\t// reopen the first file\n\t\tif (out_fp)\n\t\t\tfclose(out_fp);\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = len;\n\t}\n\n\tint rv = fwrite(str, len, 1, out_fp);\n\t(void) rv;\n\tfflush(0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fwrite",
          "args": [
            "buf",
            "n",
            "1",
            "stdout"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "0",
            "buf",
            "sizeof(buf)"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setvbuf",
          "args": [
            "stdout",
            "NULL",
            "_IONBF",
            "0"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_rotate",
          "args": [
            "fname"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "log_rotate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "40-102",
          "snippet": "static void log_rotate(const char *fname) {\n\tstruct stat s;\n\tint index = strlen(fname);\n\tchar *name1 = malloc(index + 2 + 1);\n\tchar *name2 = malloc(index + 2 + 1);\n\tif (!name1 || !name2)\n\t\terrExit(\"malloc\");\n\tstrcpy(name1, fname);\n\tstrcpy(name2, fname);\n\tfflush(0);\n\n\t// delete filename.5\n\tsprintf(name1 + index, \".5\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = unlink(name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"unlink\");\n\t}\n\n\t// move files 1 to 4 down one position\n\tsprintf(name2 + index, \".4\");\n\tif (stat(name2, &s) == 0) {\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".3\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name2 + index, \".2\");\n\tif (stat(name2, &s) == 0) {\n\t\t/* coverity[toctou] */\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".1\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\t// move the first file\n\tif (out_fp)\n\t\tfclose(out_fp);\n\n\tout_fp = NULL;\n\tif (stat(fname, &s) == 0) {\n\t\tint rv = rename(fname, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tfree(name1);\n\tfree(name2);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static FILE *out_fp = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\n\nstatic void log_rotate(const char *fname) {\n\tstruct stat s;\n\tint index = strlen(fname);\n\tchar *name1 = malloc(index + 2 + 1);\n\tchar *name2 = malloc(index + 2 + 1);\n\tif (!name1 || !name2)\n\t\terrExit(\"malloc\");\n\tstrcpy(name1, fname);\n\tstrcpy(name2, fname);\n\tfflush(0);\n\n\t// delete filename.5\n\tsprintf(name1 + index, \".5\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = unlink(name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"unlink\");\n\t}\n\n\t// move files 1 to 4 down one position\n\tsprintf(name2 + index, \".4\");\n\tif (stat(name2, &s) == 0) {\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".3\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name2 + index, \".2\");\n\tif (stat(name2, &s) == 0) {\n\t\t/* coverity[toctou] */\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".1\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\t// move the first file\n\tif (out_fp)\n\t\tfclose(out_fp);\n\n\tout_fp = NULL;\n\tif (stat(fname, &s) == 0) {\n\t\tint rv = rename(fname, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tfree(name1);\n\tfree(name2);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"a\""
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "fopen64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "320-327",
          "snippet": "FILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_fopen64_t orig_fopen64 = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_fopen64_t orig_fopen64 = NULL;\n\nFILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getgid",
          "args": [],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "fname",
            "&s"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "lstat64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "453-460",
          "snippet": "int lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char buf[1024];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic char buf[1024];\n\nint lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "is_dir",
          "args": [
            "fname"
          ],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "is_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "139-166",
          "snippet": "static int is_dir(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\t// if fname doesn't end in '/', add one\n\tint rv;\n\tstruct stat s;\n\tif (fname[strlen(fname) - 1] == '/')\n\t\trv = stat(fname, &s);\n\telse {\n\t\tchar *tmp;\n\t\tif (asprintf(&tmp, \"%s/\", fname) == -1) {\n\t\t\tfprintf(stderr, \"Error: cannot allocate memory, %s:%d\\n\", __FILE__, __LINE__);\n\t\t\texit(1);\n\t\t}\n\t\trv = stat(tmp, &s);\n\t\tfree(tmp);\n\t}\n\n\tif (rv == -1)\n\t\treturn 0;\n\n\tif (S_ISDIR(s.st_mode))\n\t\treturn 1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic int is_dir(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\t// if fname doesn't end in '/', add one\n\tint rv;\n\tstruct stat s;\n\tif (fname[strlen(fname) - 1] == '/')\n\t\trv = stat(fname, &s);\n\telse {\n\t\tchar *tmp;\n\t\tif (asprintf(&tmp, \"%s/\", fname) == -1) {\n\t\t\tfprintf(stderr, \"Error: cannot allocate memory, %s:%d\\n\", __FILE__, __LINE__);\n\t\t\texit(1);\n\t\t}\n\t\trv = stat(tmp, &s);\n\t\tfree(tmp);\n\t}\n\n\tif (rv == -1)\n\t\treturn 0;\n\n\tif (S_ISDIR(s.st_mode))\n\t\treturn 1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "is_link",
          "args": [
            "fname"
          ],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "is_link",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "169-181",
          "snippet": "static int is_link(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\tstruct stat s;\n\tif (lstat(fname, &s) == 0) {\n\t\tif (S_ISLNK(s.st_mode))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic int is_link(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\tstruct stat s;\n\tif (lstat(fname, &s) == 0) {\n\t\tif (S_ISLNK(s.st_mode))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "fname",
            "\"..\""
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "usage",
          "args": [],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "183-185",
          "snippet": "static void usage(void) {\n\tprintf(\"Usage: ftee filename\\n\");\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic void usage(void) {\n\tprintf(\"Usage: ftee filename\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[1]",
            "\"--help\""
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: please provide a filename to store the program output\\n\""
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic unsigned char buf[MAXBUF];\n\nint main(int argc, char **argv) {\n\tif (argc < 2) {\n\t\tfprintf(stderr, \"Error: please provide a filename to store the program output\\n\");\n\t\tusage();\n\t\texit(1);\n\t}\n\tif (strcmp(argv[1], \"--help\") == 0) {\n\t\tusage();\n\t\treturn 0;\n\t}\n\tchar *fname = argv[1];\n\n\n\t// do not accept directories, links, and files with \"..\"\n\tif (strstr(fname, \"..\") || is_link(fname) || is_dir(fname))\n\t\tgoto errexit;\n\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\t// check permissions\n\t\tif (s.st_uid != getuid() || s.st_gid != getgid())\n\t\t\tgoto errexit;\n\n\t\t// check hard links\n\t\tif (s.st_nlink != 1)\n\t\t\tgoto errexit;\n\t}\n\n\t// check if we can append to this file\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"a\");\n\tif (!fp)\n\t\tgoto errexit;\n\tfclose(fp);\n\n\n\t// preserve the last log file\n\tlog_rotate(fname);\n\n\tsetvbuf (stdout, NULL, _IONBF, 0);\n\twhile(1) {\n\t\tint n = read(0, buf, sizeof(buf));\n\t\tif (n < 0 && errno == EINTR)\n\t\t\tcontinue;\n\t\tif (n <= 0)\n\t\t\tbreak;\n\n\t\tint rv = fwrite(buf, n, 1, stdout);\n\t\t(void) rv;\n\t\tlog_write(buf, n, fname);\n\t}\n\n\tlog_close();\n\treturn 0;\n\nerrexit:\n\tfprintf(stderr, \"Error ftee: invalid output file.\\n\");\n\treturn 1;\n}"
  },
  {
    "function_name": "usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "183-185",
    "snippet": "static void usage(void) {\n\tprintf(\"Usage: ftee filename\\n\");\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Usage: ftee filename\\n\""
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic void usage(void) {\n\tprintf(\"Usage: ftee filename\\n\");\n}"
  },
  {
    "function_name": "is_link",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "169-181",
    "snippet": "static int is_link(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\tstruct stat s;\n\tif (lstat(fname, &s) == 0) {\n\t\tif (S_ISLNK(s.st_mode))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "S_ISLNK",
          "args": [
            "s.st_mode"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lstat",
          "args": [
            "fname",
            "&s"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "lstat64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "453-460",
          "snippet": "int lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char buf[1024];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic char buf[1024];\n\nint lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic int is_link(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\tstruct stat s;\n\tif (lstat(fname, &s) == 0) {\n\t\tif (S_ISLNK(s.st_mode))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "is_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "139-166",
    "snippet": "static int is_dir(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\t// if fname doesn't end in '/', add one\n\tint rv;\n\tstruct stat s;\n\tif (fname[strlen(fname) - 1] == '/')\n\t\trv = stat(fname, &s);\n\telse {\n\t\tchar *tmp;\n\t\tif (asprintf(&tmp, \"%s/\", fname) == -1) {\n\t\t\tfprintf(stderr, \"Error: cannot allocate memory, %s:%d\\n\", __FILE__, __LINE__);\n\t\t\texit(1);\n\t\t}\n\t\trv = stat(tmp, &s);\n\t\tfree(tmp);\n\t}\n\n\tif (rv == -1)\n\t\treturn 0;\n\n\tif (S_ISDIR(s.st_mode))\n\t\treturn 1;\n\n\treturn 0;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "s.st_mode"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "tmp"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "tmp",
            "&s"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "lstat64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "453-460",
          "snippet": "int lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char buf[1024];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic char buf[1024];\n\nint lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot allocate memory, %s:%d\\n\"",
            "__FILE__",
            "__LINE__"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&tmp",
            "\"%s/\"",
            "fname"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "fname"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "= strlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/macros.c",
          "lines": "83-91",
          "snippet": "len = strlen(name);\n\tif (len <= 4)\n\t\treturn 0;\n\tif (*name == '$' && name[1] == '{' && name[len - 1] == '}')\n\t\treturn 1;\n\treturn 0;\n}\n\n// returns mallocated memory\nstatic char *resolve_x",
          "includes": [
            "#include <sys/stat.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include \"firejail.h\"\n\nlen = strlen(name);\n\tif (len <= 4)\n\t\treturn 0;\n\tif (*name == '$' && name[1] == '{' && name[len - 1] == '}')\n\t\treturn 1;\n\treturn 0;\n}\n\n// returns mallocated memory\nstatic char *resolve_x"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic int is_dir(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\t// if fname doesn't end in '/', add one\n\tint rv;\n\tstruct stat s;\n\tif (fname[strlen(fname) - 1] == '/')\n\t\trv = stat(fname, &s);\n\telse {\n\t\tchar *tmp;\n\t\tif (asprintf(&tmp, \"%s/\", fname) == -1) {\n\t\t\tfprintf(stderr, \"Error: cannot allocate memory, %s:%d\\n\", __FILE__, __LINE__);\n\t\t\texit(1);\n\t\t}\n\t\trv = stat(tmp, &s);\n\t\tfree(tmp);\n\t}\n\n\tif (rv == -1)\n\t\treturn 0;\n\n\tif (S_ISDIR(s.st_mode))\n\t\treturn 1;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "log_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "104-135",
    "snippet": "static void log_write(const unsigned char *str, int len, const char *fname) {\n\tassert(fname);\n\n\tif (out_fp == NULL) {\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = 0;\n\t}\n\n\t// rotate files\n\tout_cnt += len;\n\tif (out_cnt >= out_max) {\n\t\tlog_rotate(fname);\n\n\t\t// reopen the first file\n\t\tif (out_fp)\n\t\t\tfclose(out_fp);\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = len;\n\t}\n\n\tint rv = fwrite(str, len, 1, out_fp);\n\t(void) rv;\n\tfflush(0);\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static FILE *out_fp = NULL;",
      "static int out_cnt = 0;",
      "static int out_max = 500 * 1024;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "0"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fwrite",
          "args": [
            "str",
            "len",
            "1",
            "out_fp"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open log file %s\\n\"",
            "fname"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "fopen64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "320-327",
          "snippet": "FILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_fopen64_t orig_fopen64 = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_fopen64_t orig_fopen64 = NULL;\n\nFILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "out_fp"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_rotate",
          "args": [
            "fname"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "log_rotate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
          "lines": "40-102",
          "snippet": "static void log_rotate(const char *fname) {\n\tstruct stat s;\n\tint index = strlen(fname);\n\tchar *name1 = malloc(index + 2 + 1);\n\tchar *name2 = malloc(index + 2 + 1);\n\tif (!name1 || !name2)\n\t\terrExit(\"malloc\");\n\tstrcpy(name1, fname);\n\tstrcpy(name2, fname);\n\tfflush(0);\n\n\t// delete filename.5\n\tsprintf(name1 + index, \".5\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = unlink(name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"unlink\");\n\t}\n\n\t// move files 1 to 4 down one position\n\tsprintf(name2 + index, \".4\");\n\tif (stat(name2, &s) == 0) {\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".3\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name2 + index, \".2\");\n\tif (stat(name2, &s) == 0) {\n\t\t/* coverity[toctou] */\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".1\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\t// move the first file\n\tif (out_fp)\n\t\tfclose(out_fp);\n\n\tout_fp = NULL;\n\tif (stat(fname, &s) == 0) {\n\t\tint rv = rename(fname, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tfree(name1);\n\tfree(name2);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include \"ftee.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static FILE *out_fp = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\n\nstatic void log_rotate(const char *fname) {\n\tstruct stat s;\n\tint index = strlen(fname);\n\tchar *name1 = malloc(index + 2 + 1);\n\tchar *name2 = malloc(index + 2 + 1);\n\tif (!name1 || !name2)\n\t\terrExit(\"malloc\");\n\tstrcpy(name1, fname);\n\tstrcpy(name2, fname);\n\tfflush(0);\n\n\t// delete filename.5\n\tsprintf(name1 + index, \".5\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = unlink(name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"unlink\");\n\t}\n\n\t// move files 1 to 4 down one position\n\tsprintf(name2 + index, \".4\");\n\tif (stat(name2, &s) == 0) {\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".3\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name2 + index, \".2\");\n\tif (stat(name2, &s) == 0) {\n\t\t/* coverity[toctou] */\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".1\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\t// move the first file\n\tif (out_fp)\n\t\tfclose(out_fp);\n\n\tout_fp = NULL;\n\tif (stat(fname, &s) == 0) {\n\t\tint rv = rename(fname, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tfree(name1);\n\tfree(name2);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open log file %s\\n\"",
            "fname"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\nstatic int out_cnt = 0;\nstatic int out_max = 500 * 1024;\n\nstatic void log_write(const unsigned char *str, int len, const char *fname) {\n\tassert(fname);\n\n\tif (out_fp == NULL) {\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = 0;\n\t}\n\n\t// rotate files\n\tout_cnt += len;\n\tif (out_cnt >= out_max) {\n\t\tlog_rotate(fname);\n\n\t\t// reopen the first file\n\t\tif (out_fp)\n\t\t\tfclose(out_fp);\n\t\tout_fp = fopen(fname, \"w\");\n\t\tif (!out_fp) {\n\t\t\tfprintf(stderr, \"Error: cannot open log file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\tout_cnt = len;\n\t}\n\n\tint rv = fwrite(str, len, 1, out_fp);\n\t(void) rv;\n\tfflush(0);\n}"
  },
  {
    "function_name": "log_rotate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "40-102",
    "snippet": "static void log_rotate(const char *fname) {\n\tstruct stat s;\n\tint index = strlen(fname);\n\tchar *name1 = malloc(index + 2 + 1);\n\tchar *name2 = malloc(index + 2 + 1);\n\tif (!name1 || !name2)\n\t\terrExit(\"malloc\");\n\tstrcpy(name1, fname);\n\tstrcpy(name2, fname);\n\tfflush(0);\n\n\t// delete filename.5\n\tsprintf(name1 + index, \".5\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = unlink(name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"unlink\");\n\t}\n\n\t// move files 1 to 4 down one position\n\tsprintf(name2 + index, \".4\");\n\tif (stat(name2, &s) == 0) {\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".3\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name2 + index, \".2\");\n\tif (stat(name2, &s) == 0) {\n\t\t/* coverity[toctou] */\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".1\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\t// move the first file\n\tif (out_fp)\n\t\tfclose(out_fp);\n\n\tout_fp = NULL;\n\tif (stat(fname, &s) == 0) {\n\t\tint rv = rename(fname, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tfree(name1);\n\tfree(name2);\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static FILE *out_fp = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "name2"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "name1"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"rename\""
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "fname",
            "name1"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "fname",
            "&s"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "lstat64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "453-460",
          "snippet": "int lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char buf[1024];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic char buf[1024];\n\nint lstat64(const char *pathname, struct stat64 *buf) {\n\tif (!orig_lstat64)\n\t\torig_lstat64 = (orig_lstat64_t)dlsym(RTLD_NEXT, \"lstat64\");\n\n\tint rv = orig_lstat64(pathname, buf);\n\tprintf(\"%u:%s:lstat64 %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "out_fp"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"rename\""
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "name1",
            "name2"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name1 + index",
            "\".1\""
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"rename\""
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "name2",
            "name1"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name2 + index",
            "\".2\""
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"rename\""
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "name1",
            "name2"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name1 + index",
            "\".3\""
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"rename\""
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "name2",
            "name1"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name2 + index",
            "\".4\""
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"unlink\""
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "name1"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "unlink",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "359-366",
          "snippet": "int unlink(const char *pathname) {\n\tif (!orig_unlink)\n\t\torig_unlink = (orig_unlink_t)dlsym(RTLD_NEXT, \"unlink\");\n\n\tint rv = orig_unlink(pathname);\n\tprintf(\"%u:%s:unlink %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_unlink_t orig_unlink = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_unlink_t orig_unlink = NULL;\n\nint unlink(const char *pathname) {\n\tif (!orig_unlink)\n\t\torig_unlink = (orig_unlink_t)dlsym(RTLD_NEXT, \"unlink\");\n\n\tint rv = orig_unlink(pathname);\n\tprintf(\"%u:%s:unlink %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "name1 + index",
            "\".5\""
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "0"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "name2",
            "fname"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "name1",
            "fname"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"malloc\""
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "index + 2 + 1"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "index + 2 + 1"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "fname"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "= strlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/macros.c",
          "lines": "83-91",
          "snippet": "len = strlen(name);\n\tif (len <= 4)\n\t\treturn 0;\n\tif (*name == '$' && name[1] == '{' && name[len - 1] == '}')\n\t\treturn 1;\n\treturn 0;\n}\n\n// returns mallocated memory\nstatic char *resolve_x",
          "includes": [
            "#include <sys/stat.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include \"firejail.h\"\n\nlen = strlen(name);\n\tif (len <= 4)\n\t\treturn 0;\n\tif (*name == '$' && name[1] == '{' && name[len - 1] == '}')\n\t\treturn 1;\n\treturn 0;\n}\n\n// returns mallocated memory\nstatic char *resolve_x"
        }
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\n\nstatic void log_rotate(const char *fname) {\n\tstruct stat s;\n\tint index = strlen(fname);\n\tchar *name1 = malloc(index + 2 + 1);\n\tchar *name2 = malloc(index + 2 + 1);\n\tif (!name1 || !name2)\n\t\terrExit(\"malloc\");\n\tstrcpy(name1, fname);\n\tstrcpy(name2, fname);\n\tfflush(0);\n\n\t// delete filename.5\n\tsprintf(name1 + index, \".5\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = unlink(name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"unlink\");\n\t}\n\n\t// move files 1 to 4 down one position\n\tsprintf(name2 + index, \".4\");\n\tif (stat(name2, &s) == 0) {\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".3\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name2 + index, \".2\");\n\tif (stat(name2, &s) == 0) {\n\t\t/* coverity[toctou] */\n\t\tint rv = rename(name2, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tsprintf(name1 + index, \".1\");\n\tif (stat(name1, &s) == 0) {\n\t\tint rv = rename(name1, name2);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\t// move the first file\n\tif (out_fp)\n\t\tfclose(out_fp);\n\n\tout_fp = NULL;\n\tif (stat(fname, &s) == 0) {\n\t\tint rv = rename(fname, name1);\n\t\tif (rv == -1)\n\t\t\tperror(\"rename\");\n\t}\n\n\tfree(name1);\n\tfree(name2);\n}"
  },
  {
    "function_name": "log_close",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/ftee/main.c",
    "lines": "33-38",
    "snippet": "static void log_close(void) {\n\tif (out_fp) {\n\t\tfclose(out_fp);\n\t\tout_fp = NULL;\n\t}\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <errno.h>",
      "#include \"ftee.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static FILE *out_fp = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "out_fp"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <errno.h>\n#include \"ftee.h\"\n\nstatic FILE *out_fp = NULL;\n\nstatic void log_close(void) {\n\tif (out_fp) {\n\t\tfclose(out_fp);\n\t\tout_fp = NULL;\n\t}\n}"
  }
]