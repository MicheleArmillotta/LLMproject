[
  {
    "function_name": "build_mount_array",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
    "lines": "204-285",
    "snippet": "char **build_mount_array(const int mount_id, const char *path) {\n\tassert(path);\n\n\t// open /proc/self/mountinfo\n\tFILE *fp = fopen(\"/proc/self/mountinfo\", \"re\");\n\tif (!fp) {\n\t\tperror(\"fopen\");\n\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\texit(1);\n\t}\n\n\t// array to be returned\n\tsize_t cnt = 0;\n\tsize_t size = 32;\n\tchar **rv = malloc(size * sizeof(*rv));\n\tif (!rv)\n\t\terrExit(\"malloc\");\n\n\t// read /proc/self/mountinfo\n\tsize_t pathlen = strlen(path);\n\tchar buf[MAX_BUF];\n\tMountData mntp;\n\tint found = 0;\n\n\tif (fgets(buf, MAX_BUF, fp) == NULL) {\n\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\texit(1);\n\t}\n\tdo {\n\t\t// find mount point with mount id\n\t\tif (!found) {\n\t\t\tparse_line(buf, &mntp);\n\t\t\tif (mntp.mountid == mount_id) {\n\t\t\t\t// give up if mount id has been reassigned,\n\t\t\t\t// don't remount blacklisted path\n\t\t\t\tif (strncmp(mntp.dir, path, strlen(mntp.dir)) ||\n\t\t\t\t    strstr(mntp.fsname, \"firejail.ro.dir\") ||\n\t\t\t\t    strstr(mntp.fsname, \"firejail.ro.file\"))\n\t\t\t\t\t    break;\n\n\t\t\t\t*rv = strdup(path);\n\t\t\t\tif (*rv == NULL)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\tcnt++;\n\t\t\t\tfound = 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\telse\n\t\t\t\tcontinue;\n\t\t}\n\t\t// from here on add all mount points below path,\n\t\t// don't remount blacklisted paths\n\t\tparse_line(buf, &mntp);\n\t\tif (strncmp(mntp.dir, path, pathlen) == 0 &&\n\t\t    mntp.dir[pathlen] == '/' &&\n\t\t    strstr(mntp.fsname, \"firejail.ro.dir\") == NULL &&\n\t\t    strstr(mntp.fsname, \"firejail.ro.file\") == NULL) {\n\n\t\t\tif (cnt == size) {\n\t\t\t\tsize *= 2;\n\t\t\t\trv = realloc(rv, size * sizeof(*rv));\n\t\t\t\tif (!rv)\n\t\t\t\t\terrExit(\"realloc\");\n\t\t\t}\n\t\t\trv[cnt] = strdup(mntp.dir);\n\t\t\tif (rv[cnt] == NULL)\n\t\t\t\terrExit(\"strdup\");\n\t\t\tcnt++;\n\t\t}\n\t} while (fgets(buf, MAX_BUF, fp));\n\n\tif (cnt == size) {\n\t\tsize++;\n\t\trv = realloc(rv, size * sizeof(*rv));\n\t\tif (!rv)\n\t\t\terrExit(\"realloc\");\n\t}\n\trv[cnt] = NULL; // end of the array\n\n\tfclose(fp);\n\treturn rv;\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define MAX_BUF 4096"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"realloc\""
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "rv",
            "size * sizeof(*rv)"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "MAX_BUF",
            "fp"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "mntp.dir"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"realloc\""
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "rv",
            "size * sizeof(*rv)"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "mntp.fsname",
            "\"firejail.ro.file\""
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "mntp.fsname",
            "\"firejail.ro.dir\""
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "mntp.dir",
            "path",
            "pathlen"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_line",
          "args": [
            "buf",
            "&mntp"
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "parse_line",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
          "lines": "69-128",
          "snippet": "static void parse_line(char *line, MountData *output) {\n\tassert(line && output);\n\tmemset(output, 0, sizeof(*output));\n\t// extract mount id, filesystem name, directory and filesystem types\n\t// examples:\n\t//\t587 543 8:1 /tmp /etc rw,relatime master:1 - ext4 /dev/sda1 rw,errors=remount-ro,data=ordered\n\t//\t\toutput.mountid: 587\n\t//\t\toutput.fsname: /tmp\n\t//\t\toutput.dir: /etc\n\t//\t\toutput.fstype: ext4\n\t//\t585 564 0:76 / /home/netblue/.cache rw,nosuid,nodev - tmpfs tmpfs rw\n\t//\t\toutput.mountid: 585\n\t//\t\toutput.fsname: /\n\t//\t\toutput.dir: /home/netblue/.cache\n\t//\t\toutput.fstype: tmpfs\n\n\tchar *ptr = strtok(line, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\tif (ptr != line)\n\t\tgoto errexit;\n\toutput->mountid = atoi(ptr);\n\tint cnt = 1;\n\n\twhile ((ptr = strtok(NULL, \" \")) != NULL) {\n\t\tcnt++;\n\t\tif (cnt == 4)\n\t\t\toutput->fsname = ptr;\n\t\telse if (cnt == 5) {\n\t\t\toutput->dir = ptr;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tptr = strtok(NULL, \"-\");\n\tif (!ptr)\n\t\tgoto errexit;\n\n\tptr = strtok(NULL, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\toutput->fstype = ptr++;\n\n\n\tif (output->mountid == 0 ||\n\t    output->fsname == NULL ||\n\t    output->dir == NULL ||\n\t    output->fstype == NULL)\n\t\tgoto errexit;\n\n\t// restore empty spaces\n\tunmangle_path(output->fsname);\n\tunmangle_path(output->dir);\n\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\texit(1);\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic void parse_line(char *line, MountData *output) {\n\tassert(line && output);\n\tmemset(output, 0, sizeof(*output));\n\t// extract mount id, filesystem name, directory and filesystem types\n\t// examples:\n\t//\t587 543 8:1 /tmp /etc rw,relatime master:1 - ext4 /dev/sda1 rw,errors=remount-ro,data=ordered\n\t//\t\toutput.mountid: 587\n\t//\t\toutput.fsname: /tmp\n\t//\t\toutput.dir: /etc\n\t//\t\toutput.fstype: ext4\n\t//\t585 564 0:76 / /home/netblue/.cache rw,nosuid,nodev - tmpfs tmpfs rw\n\t//\t\toutput.mountid: 585\n\t//\t\toutput.fsname: /\n\t//\t\toutput.dir: /home/netblue/.cache\n\t//\t\toutput.fstype: tmpfs\n\n\tchar *ptr = strtok(line, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\tif (ptr != line)\n\t\tgoto errexit;\n\toutput->mountid = atoi(ptr);\n\tint cnt = 1;\n\n\twhile ((ptr = strtok(NULL, \" \")) != NULL) {\n\t\tcnt++;\n\t\tif (cnt == 4)\n\t\t\toutput->fsname = ptr;\n\t\telse if (cnt == 5) {\n\t\t\toutput->dir = ptr;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tptr = strtok(NULL, \"-\");\n\tif (!ptr)\n\t\tgoto errexit;\n\n\tptr = strtok(NULL, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\toutput->fstype = ptr++;\n\n\n\tif (output->mountid == 0 ||\n\t    output->fsname == NULL ||\n\t    output->dir == NULL ||\n\t    output->fstype == NULL)\n\t\tgoto errexit;\n\n\t// restore empty spaces\n\tunmangle_path(output->fsname);\n\tunmangle_path(output->dir);\n\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "path"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "mntp.fsname",
            "\"firejail.ro.file\""
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "mntp.fsname",
            "\"firejail.ro.dir\""
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "mntp.dir",
            "path",
            "strlen(mntp.dir)"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "mntp.dir"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "= strlen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/macros.c",
          "lines": "83-91",
          "snippet": "len = strlen(name);\n\tif (len <= 4)\n\t\treturn 0;\n\tif (*name == '$' && name[1] == '{' && name[len - 1] == '}')\n\t\treturn 1;\n\treturn 0;\n}\n\n// returns mallocated memory\nstatic char *resolve_x",
          "includes": [
            "#include <sys/stat.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include \"firejail.h\"\n\nlen = strlen(name);\n\tif (len <= 4)\n\t\treturn 0;\n\tif (*name == '$' && name[1] == '{' && name[len - 1] == '}')\n\t\treturn 1;\n\treturn 0;\n}\n\n// returns mallocated memory\nstatic char *resolve_x"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 230
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc/self/mountinfo\\n\""
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "MAX_BUF",
            "fp"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"malloc\""
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "size * sizeof(*rv)"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc/self/mountinfo\\n\""
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"fopen\""
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/proc/self/mountinfo\"",
            "\"re\""
          ],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "fopen64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "320-327",
          "snippet": "FILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_fopen64_t orig_fopen64 = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_fopen64_t orig_fopen64 = NULL;\n\nFILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "path"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\n#define MAX_BUF 4096\n\nchar **build_mount_array(const int mount_id, const char *path) {\n\tassert(path);\n\n\t// open /proc/self/mountinfo\n\tFILE *fp = fopen(\"/proc/self/mountinfo\", \"re\");\n\tif (!fp) {\n\t\tperror(\"fopen\");\n\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\texit(1);\n\t}\n\n\t// array to be returned\n\tsize_t cnt = 0;\n\tsize_t size = 32;\n\tchar **rv = malloc(size * sizeof(*rv));\n\tif (!rv)\n\t\terrExit(\"malloc\");\n\n\t// read /proc/self/mountinfo\n\tsize_t pathlen = strlen(path);\n\tchar buf[MAX_BUF];\n\tMountData mntp;\n\tint found = 0;\n\n\tif (fgets(buf, MAX_BUF, fp) == NULL) {\n\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\texit(1);\n\t}\n\tdo {\n\t\t// find mount point with mount id\n\t\tif (!found) {\n\t\t\tparse_line(buf, &mntp);\n\t\t\tif (mntp.mountid == mount_id) {\n\t\t\t\t// give up if mount id has been reassigned,\n\t\t\t\t// don't remount blacklisted path\n\t\t\t\tif (strncmp(mntp.dir, path, strlen(mntp.dir)) ||\n\t\t\t\t    strstr(mntp.fsname, \"firejail.ro.dir\") ||\n\t\t\t\t    strstr(mntp.fsname, \"firejail.ro.file\"))\n\t\t\t\t\t    break;\n\n\t\t\t\t*rv = strdup(path);\n\t\t\t\tif (*rv == NULL)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\tcnt++;\n\t\t\t\tfound = 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\telse\n\t\t\t\tcontinue;\n\t\t}\n\t\t// from here on add all mount points below path,\n\t\t// don't remount blacklisted paths\n\t\tparse_line(buf, &mntp);\n\t\tif (strncmp(mntp.dir, path, pathlen) == 0 &&\n\t\t    mntp.dir[pathlen] == '/' &&\n\t\t    strstr(mntp.fsname, \"firejail.ro.dir\") == NULL &&\n\t\t    strstr(mntp.fsname, \"firejail.ro.file\") == NULL) {\n\n\t\t\tif (cnt == size) {\n\t\t\t\tsize *= 2;\n\t\t\t\trv = realloc(rv, size * sizeof(*rv));\n\t\t\t\tif (!rv)\n\t\t\t\t\terrExit(\"realloc\");\n\t\t\t}\n\t\t\trv[cnt] = strdup(mntp.dir);\n\t\t\tif (rv[cnt] == NULL)\n\t\t\t\terrExit(\"strdup\");\n\t\t\tcnt++;\n\t\t}\n\t} while (fgets(buf, MAX_BUF, fp));\n\n\tif (cnt == size) {\n\t\tsize++;\n\t\trv = realloc(rv, size * sizeof(*rv));\n\t\tif (!rv)\n\t\t\terrExit(\"realloc\");\n\t}\n\trv[cnt] = NULL; // end of the array\n\n\tfclose(fp);\n\treturn rv;\n}"
  },
  {
    "function_name": "get_mount_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
    "lines": "155-200",
    "snippet": "int get_mount_id(const char *path) {\n\tassert(path);\n\n\tint fd = open(path, O_PATH|O_CLOEXEC);\n\tif (fd == -1)\n\t\treturn -1;\n\n\tchar *fdinfo;\n\tif (asprintf(&fdinfo, \"/proc/self/fdinfo/%d\", fd) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fdinfo, \"re\");\n\tif (!fp) {\n\t\tperror(\"fopen\");\n\t\tfprintf(stderr, \"Error: cannot open %s\\n\", fdinfo);\n\t\texit(1);\n\t}\n\n\t// read the file\n\tchar buf[MAX_BUF];\n\tif (fgets(buf, MAX_BUF, fp) == NULL) {\n\t\tfprintf(stderr, \"Error: cannot read %s\\n\", fdinfo);\n\t\texit(1);\n\t}\n\tdo {\n\t\tif (strncmp(buf, \"mnt_id:\", 7) == 0) {\n\t\t\tchar *ptr = buf + 7;\n\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\tptr++;\n\t\t\t}\n\t\t\tif (*ptr == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: cannot read %s\\n\", fdinfo);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tfclose(fp);\n\t\t\tclose(fd);\n\t\t\tfree(fdinfo);\n\t\t\treturn atoi(ptr);\n\t\t}\n\t} while (fgets(buf, MAX_BUF, fp));\n\n\t// fallback, kernels older than 3.15 don't expose the mount id in this place\n\tfclose(fp);\n\tclose(fd);\n\tfree(fdinfo);\n\treturn -2;\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define MAX_BUF 4096"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fdinfo"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "rtnl_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/lib/libnetlink.c",
          "lines": "46-52",
          "snippet": "void rtnl_close(struct rtnl_handle *rth)\n{\n\tif (rth->fd >= 0) {\n\t\tclose(rth->fd);\n\t\trth->fd = -1;\n\t}\n}",
          "includes": [
            "#include \"../include/libnetlink.h\"",
            "#include <sys/uio.h>",
            "#include <time.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <net/if_arp.h>",
            "#include <fcntl.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"../include/libnetlink.h\"\n#include <sys/uio.h>\n#include <time.h>\n#include <errno.h>\n#include <string.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <net/if_arp.h>\n#include <fcntl.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nvoid rtnl_close(struct rtnl_handle *rth)\n{\n\tif (rth->fd >= 0) {\n\t\tclose(rth->fd);\n\t\trth->fd = -1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "MAX_BUF",
            "fp"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "ptr"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fdinfo"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read %s\\n\"",
            "fdinfo"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "buf",
            "\"mnt_id:\"",
            "7"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read %s\\n\"",
            "fdinfo"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "MAX_BUF",
            "fp"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open %s\\n\"",
            "fdinfo"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"fopen\""
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fdinfo",
            "\"re\""
          ],
          "line": 165
        },
        "resolved": true,
        "details": {
          "function_name": "fopen64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "320-327",
          "snippet": "FILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_fopen64_t orig_fopen64 = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_fopen64_t orig_fopen64 = NULL;\n\nFILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fdinfo",
            "\"/proc/self/fdinfo/%d\"",
            "fd"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "path"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\n#define MAX_BUF 4096\n\nint get_mount_id(const char *path) {\n\tassert(path);\n\n\tint fd = open(path, O_PATH|O_CLOEXEC);\n\tif (fd == -1)\n\t\treturn -1;\n\n\tchar *fdinfo;\n\tif (asprintf(&fdinfo, \"/proc/self/fdinfo/%d\", fd) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fdinfo, \"re\");\n\tif (!fp) {\n\t\tperror(\"fopen\");\n\t\tfprintf(stderr, \"Error: cannot open %s\\n\", fdinfo);\n\t\texit(1);\n\t}\n\n\t// read the file\n\tchar buf[MAX_BUF];\n\tif (fgets(buf, MAX_BUF, fp) == NULL) {\n\t\tfprintf(stderr, \"Error: cannot read %s\\n\", fdinfo);\n\t\texit(1);\n\t}\n\tdo {\n\t\tif (strncmp(buf, \"mnt_id:\", 7) == 0) {\n\t\t\tchar *ptr = buf + 7;\n\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\tptr++;\n\t\t\t}\n\t\t\tif (*ptr == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: cannot read %s\\n\", fdinfo);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tfclose(fp);\n\t\t\tclose(fd);\n\t\t\tfree(fdinfo);\n\t\t\treturn atoi(ptr);\n\t\t}\n\t} while (fgets(buf, MAX_BUF, fp));\n\n\t// fallback, kernels older than 3.15 don't expose the mount id in this place\n\tfclose(fp);\n\tclose(fd);\n\tfree(fdinfo);\n\treturn -2;\n}"
  },
  {
    "function_name": "get_last_mount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
    "lines": "131-152",
    "snippet": "MountData *get_last_mount(void) {\n\t// open /proc/self/mountinfo\n\tFILE *fp = fopen(\"/proc/self/mountinfo\", \"re\");\n\tif (!fp) {\n\t\tperror(\"fopen\");\n\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\texit(1);\n\t}\n\n\tmbuf[0] = '\\0';\n\t// go to the last line\n\twhile (fgets(mbuf, MAX_BUF, fp));\n\tfclose(fp);\n\tif (arg_debug)\n\t\tprintf(\"%s\", mbuf);\n\n\tparse_line(mbuf, &mdata);\n\n\tif (arg_debug)\n\t\tprintf(\"mountid=%d fsname=%s dir=%s fstype=%s\\n\", mdata.mountid, mdata.fsname, mdata.dir, mdata.fstype);\n\treturn &mdata;\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define MAX_BUF 4096"
    ],
    "globals_used": [
      "static char mbuf[MAX_BUF];",
      "static MountData mdata;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"mountid=%d fsname=%s dir=%s fstype=%s\\n\"",
            "mdata.mountid",
            "mdata.fsname",
            "mdata.dir",
            "mdata.fstype"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_line",
          "args": [
            "mbuf",
            "&mdata"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "parse_line",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
          "lines": "69-128",
          "snippet": "static void parse_line(char *line, MountData *output) {\n\tassert(line && output);\n\tmemset(output, 0, sizeof(*output));\n\t// extract mount id, filesystem name, directory and filesystem types\n\t// examples:\n\t//\t587 543 8:1 /tmp /etc rw,relatime master:1 - ext4 /dev/sda1 rw,errors=remount-ro,data=ordered\n\t//\t\toutput.mountid: 587\n\t//\t\toutput.fsname: /tmp\n\t//\t\toutput.dir: /etc\n\t//\t\toutput.fstype: ext4\n\t//\t585 564 0:76 / /home/netblue/.cache rw,nosuid,nodev - tmpfs tmpfs rw\n\t//\t\toutput.mountid: 585\n\t//\t\toutput.fsname: /\n\t//\t\toutput.dir: /home/netblue/.cache\n\t//\t\toutput.fstype: tmpfs\n\n\tchar *ptr = strtok(line, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\tif (ptr != line)\n\t\tgoto errexit;\n\toutput->mountid = atoi(ptr);\n\tint cnt = 1;\n\n\twhile ((ptr = strtok(NULL, \" \")) != NULL) {\n\t\tcnt++;\n\t\tif (cnt == 4)\n\t\t\toutput->fsname = ptr;\n\t\telse if (cnt == 5) {\n\t\t\toutput->dir = ptr;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tptr = strtok(NULL, \"-\");\n\tif (!ptr)\n\t\tgoto errexit;\n\n\tptr = strtok(NULL, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\toutput->fstype = ptr++;\n\n\n\tif (output->mountid == 0 ||\n\t    output->fsname == NULL ||\n\t    output->dir == NULL ||\n\t    output->fstype == NULL)\n\t\tgoto errexit;\n\n\t// restore empty spaces\n\tunmangle_path(output->fsname);\n\tunmangle_path(output->dir);\n\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\texit(1);\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic void parse_line(char *line, MountData *output) {\n\tassert(line && output);\n\tmemset(output, 0, sizeof(*output));\n\t// extract mount id, filesystem name, directory and filesystem types\n\t// examples:\n\t//\t587 543 8:1 /tmp /etc rw,relatime master:1 - ext4 /dev/sda1 rw,errors=remount-ro,data=ordered\n\t//\t\toutput.mountid: 587\n\t//\t\toutput.fsname: /tmp\n\t//\t\toutput.dir: /etc\n\t//\t\toutput.fstype: ext4\n\t//\t585 564 0:76 / /home/netblue/.cache rw,nosuid,nodev - tmpfs tmpfs rw\n\t//\t\toutput.mountid: 585\n\t//\t\toutput.fsname: /\n\t//\t\toutput.dir: /home/netblue/.cache\n\t//\t\toutput.fstype: tmpfs\n\n\tchar *ptr = strtok(line, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\tif (ptr != line)\n\t\tgoto errexit;\n\toutput->mountid = atoi(ptr);\n\tint cnt = 1;\n\n\twhile ((ptr = strtok(NULL, \" \")) != NULL) {\n\t\tcnt++;\n\t\tif (cnt == 4)\n\t\t\toutput->fsname = ptr;\n\t\telse if (cnt == 5) {\n\t\t\toutput->dir = ptr;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tptr = strtok(NULL, \"-\");\n\tif (!ptr)\n\t\tgoto errexit;\n\n\tptr = strtok(NULL, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\toutput->fstype = ptr++;\n\n\n\tif (output->mountid == 0 ||\n\t    output->fsname == NULL ||\n\t    output->dir == NULL ||\n\t    output->fstype == NULL)\n\t\tgoto errexit;\n\n\t// restore empty spaces\n\tunmangle_path(output->fsname);\n\tunmangle_path(output->dir);\n\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s\"",
            "mbuf"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "mbuf",
            "MAX_BUF",
            "fp"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc/self/mountinfo\\n\""
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"fopen\""
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/proc/self/mountinfo\"",
            "\"re\""
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "fopen64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "320-327",
          "snippet": "FILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_fopen64_t orig_fopen64 = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_fopen64_t orig_fopen64 = NULL;\n\nFILE *fopen64(const char *pathname, const char *mode) {\n\tif (!orig_fopen64)\n\t\torig_fopen64 = (orig_fopen_t)dlsym(RTLD_NEXT, \"fopen64\");\n\n\tFILE *rv = orig_fopen64(pathname, mode);\n\tprintf(\"%u:%s:fopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\n#define MAX_BUF 4096\n\nstatic char mbuf[MAX_BUF];\nstatic MountData mdata;\n\nMountData *get_last_mount(void) {\n\t// open /proc/self/mountinfo\n\tFILE *fp = fopen(\"/proc/self/mountinfo\", \"re\");\n\tif (!fp) {\n\t\tperror(\"fopen\");\n\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\texit(1);\n\t}\n\n\tmbuf[0] = '\\0';\n\t// go to the last line\n\twhile (fgets(mbuf, MAX_BUF, fp));\n\tfclose(fp);\n\tif (arg_debug)\n\t\tprintf(\"%s\", mbuf);\n\n\tparse_line(mbuf, &mdata);\n\n\tif (arg_debug)\n\t\tprintf(\"mountid=%d fsname=%s dir=%s fstype=%s\\n\", mdata.mountid, mdata.fsname, mdata.dir, mdata.fstype);\n\treturn &mdata;\n}"
  },
  {
    "function_name": "parse_line",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
    "lines": "69-128",
    "snippet": "static void parse_line(char *line, MountData *output) {\n\tassert(line && output);\n\tmemset(output, 0, sizeof(*output));\n\t// extract mount id, filesystem name, directory and filesystem types\n\t// examples:\n\t//\t587 543 8:1 /tmp /etc rw,relatime master:1 - ext4 /dev/sda1 rw,errors=remount-ro,data=ordered\n\t//\t\toutput.mountid: 587\n\t//\t\toutput.fsname: /tmp\n\t//\t\toutput.dir: /etc\n\t//\t\toutput.fstype: ext4\n\t//\t585 564 0:76 / /home/netblue/.cache rw,nosuid,nodev - tmpfs tmpfs rw\n\t//\t\toutput.mountid: 585\n\t//\t\toutput.fsname: /\n\t//\t\toutput.dir: /home/netblue/.cache\n\t//\t\toutput.fstype: tmpfs\n\n\tchar *ptr = strtok(line, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\tif (ptr != line)\n\t\tgoto errexit;\n\toutput->mountid = atoi(ptr);\n\tint cnt = 1;\n\n\twhile ((ptr = strtok(NULL, \" \")) != NULL) {\n\t\tcnt++;\n\t\tif (cnt == 4)\n\t\t\toutput->fsname = ptr;\n\t\telse if (cnt == 5) {\n\t\t\toutput->dir = ptr;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tptr = strtok(NULL, \"-\");\n\tif (!ptr)\n\t\tgoto errexit;\n\n\tptr = strtok(NULL, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\toutput->fstype = ptr++;\n\n\n\tif (output->mountid == 0 ||\n\t    output->fsname == NULL ||\n\t    output->dir == NULL ||\n\t    output->fstype == NULL)\n\t\tgoto errexit;\n\n\t// restore empty spaces\n\tunmangle_path(output->fsname);\n\tunmangle_path(output->dir);\n\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\texit(1);\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc/self/mountinfo\\n\""
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unmangle_path",
          "args": [
            "output->dir"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "unmangle_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
          "lines": "48-65",
          "snippet": "static void unmangle_path(char *path) {\n\tchar *p = strchr(path, '\\\\');\n\tif (p) {\n\t\tif (read_oct(p) == ' ') {\n\t\t\t*p = ' ';\n\t\t\tint i = 3;\n\t\t\tdo {\n\t\t\t\tp++;\n\t\t\t\tif (*(p + i) == '\\\\' && read_oct(p + i) == ' ') {\n\t\t\t\t\t*p = ' ';\n\t\t\t\t\ti += 3;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\t*p = *(p + i);\n\t\t\t} while (*p);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic void unmangle_path(char *path) {\n\tchar *p = strchr(path, '\\\\');\n\tif (p) {\n\t\tif (read_oct(p) == ' ') {\n\t\t\t*p = ' ';\n\t\t\tint i = 3;\n\t\t\tdo {\n\t\t\t\tp++;\n\t\t\t\tif (*(p + i) == '\\\\' && read_oct(p + i) == ' ') {\n\t\t\t\t\t*p = ' ';\n\t\t\t\t\ti += 3;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\t*p = *(p + i);\n\t\t\t} while (*p);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "NULL",
            "\" \""
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "NULL",
            "\"-\""
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "NULL",
            "\" \""
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "ptr"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtok",
          "args": [
            "line",
            "\" \""
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "output",
            "0",
            "sizeof(*output)"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "line && output"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic void parse_line(char *line, MountData *output) {\n\tassert(line && output);\n\tmemset(output, 0, sizeof(*output));\n\t// extract mount id, filesystem name, directory and filesystem types\n\t// examples:\n\t//\t587 543 8:1 /tmp /etc rw,relatime master:1 - ext4 /dev/sda1 rw,errors=remount-ro,data=ordered\n\t//\t\toutput.mountid: 587\n\t//\t\toutput.fsname: /tmp\n\t//\t\toutput.dir: /etc\n\t//\t\toutput.fstype: ext4\n\t//\t585 564 0:76 / /home/netblue/.cache rw,nosuid,nodev - tmpfs tmpfs rw\n\t//\t\toutput.mountid: 585\n\t//\t\toutput.fsname: /\n\t//\t\toutput.dir: /home/netblue/.cache\n\t//\t\toutput.fstype: tmpfs\n\n\tchar *ptr = strtok(line, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\tif (ptr != line)\n\t\tgoto errexit;\n\toutput->mountid = atoi(ptr);\n\tint cnt = 1;\n\n\twhile ((ptr = strtok(NULL, \" \")) != NULL) {\n\t\tcnt++;\n\t\tif (cnt == 4)\n\t\t\toutput->fsname = ptr;\n\t\telse if (cnt == 5) {\n\t\t\toutput->dir = ptr;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tptr = strtok(NULL, \"-\");\n\tif (!ptr)\n\t\tgoto errexit;\n\n\tptr = strtok(NULL, \" \");\n\tif (!ptr)\n\t\tgoto errexit;\n\toutput->fstype = ptr++;\n\n\n\tif (output->mountid == 0 ||\n\t    output->fsname == NULL ||\n\t    output->dir == NULL ||\n\t    output->fstype == NULL)\n\t\tgoto errexit;\n\n\t// restore empty spaces\n\tunmangle_path(output->fsname);\n\tunmangle_path(output->dir);\n\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\texit(1);\n}"
  },
  {
    "function_name": "unmangle_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
    "lines": "48-65",
    "snippet": "static void unmangle_path(char *path) {\n\tchar *p = strchr(path, '\\\\');\n\tif (p) {\n\t\tif (read_oct(p) == ' ') {\n\t\t\t*p = ' ';\n\t\t\tint i = 3;\n\t\t\tdo {\n\t\t\t\tp++;\n\t\t\t\tif (*(p + i) == '\\\\' && read_oct(p + i) == ' ') {\n\t\t\t\t\t*p = ' ';\n\t\t\t\t\ti += 3;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\t*p = *(p + i);\n\t\t\t} while (*p);\n\t\t}\n\t}\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "read_oct",
          "args": [
            "p + i"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "read_oct",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
          "lines": "31-45",
          "snippet": "static int read_oct(const char *path) {\n\tint decimal = 0;\n\tint digit, i;\n\t// there are always exactly three octal digits\n\tfor (i = 1; i < 4; i++) {\n\t\tdigit = *(path + i);\n\t\tif (digit < '0' || digit > '7') {\n\t\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\t\texit(1);\n\t\t}\n\t\tdecimal = (decimal + digit - '0') * 8;\n\t}\n\tdecimal /= 8;\n\treturn decimal;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic int read_oct(const char *path) {\n\tint decimal = 0;\n\tint digit, i;\n\t// there are always exactly three octal digits\n\tfor (i = 1; i < 4; i++) {\n\t\tdigit = *(path + i);\n\t\tif (digit < '0' || digit > '7') {\n\t\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\t\texit(1);\n\t\t}\n\t\tdecimal = (decimal + digit - '0') * 8;\n\t}\n\tdecimal /= 8;\n\treturn decimal;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "path",
            "'\\\\'"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic void unmangle_path(char *path) {\n\tchar *p = strchr(path, '\\\\');\n\tif (p) {\n\t\tif (read_oct(p) == ' ') {\n\t\t\t*p = ' ';\n\t\t\tint i = 3;\n\t\t\tdo {\n\t\t\t\tp++;\n\t\t\t\tif (*(p + i) == '\\\\' && read_oct(p + i) == ' ') {\n\t\t\t\t\t*p = ' ';\n\t\t\t\t\ti += 3;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\t*p = *(p + i);\n\t\t\t} while (*p);\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "read_oct",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/mountinfo.c",
    "lines": "31-45",
    "snippet": "static int read_oct(const char *path) {\n\tint decimal = 0;\n\tint digit, i;\n\t// there are always exactly three octal digits\n\tfor (i = 1; i < 4; i++) {\n\t\tdigit = *(path + i);\n\t\tif (digit < '0' || digit > '7') {\n\t\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\t\texit(1);\n\t\t}\n\t\tdecimal = (decimal + digit - '0') * 8;\n\t}\n\tdecimal /= 8;\n\treturn decimal;\n}",
    "includes": [
      "#include <fcntl.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 39
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc/self/mountinfo\\n\""
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <fcntl.h>\n#include \"firejail.h\"\n\nstatic int read_oct(const char *path) {\n\tint decimal = 0;\n\tint digit, i;\n\t// there are always exactly three octal digits\n\tfor (i = 1; i < 4; i++) {\n\t\tdigit = *(path + i);\n\t\tif (digit < '0' || digit > '7') {\n\t\t\tfprintf(stderr, \"Error: cannot read /proc/self/mountinfo\\n\");\n\t\t\texit(1);\n\t\t}\n\t\tdecimal = (decimal + digit - '0') * 8;\n\t}\n\tdecimal /= 8;\n\treturn decimal;\n}"
  }
]