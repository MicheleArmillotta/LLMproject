[
  {
    "function_name": "files_test",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/faudit/files.c",
    "lines": "44-75",
    "snippet": "void files_test(void) {\n\tstruct passwd *pw = getpwuid(getuid());\n\tif (!pw) {\n\t\tfprintf(stderr, \"Error: cannot retrieve user account information\\n\");\n\t\treturn;\n\t}\n\n\tusername = strdup(pw->pw_name);\n\tif (!username)\n\t\terrExit(\"strdup\");\n\thomedir = strdup(pw->pw_dir);\n\tif (!homedir)\n\t\terrExit(\"strdup\");\n\n\t// check access to .ssh directory\n\tcheck_home_file(\".ssh\");\n\n\t// check access to .gnupg directory\n\tcheck_home_file(\".gnupg\");\n\n\t// check access to Firefox browser directory\n\tcheck_home_file(\".mozilla\");\n\n\t// check access to Chromium browser directory\n\tcheck_home_file(\".config/chromium\");\n\n\t// check access to Debian Icedove directory\n\tcheck_home_file(\".icedove\");\n\n\t// check access to Thunderbird directory\n\tcheck_home_file(\".thunderbird\");\n}",
    "includes": [
      "#include <pwd.h>",
      "#include <fcntl.h>",
      "#include \"faudit.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char *username = NULL;",
      "static char *homedir = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "check_home_file",
          "args": [
            "\".thunderbird\""
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "check_home_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/faudit/files.c",
          "lines": "27-42",
          "snippet": "static void check_home_file(const char *name) {\n\tassert(homedir);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%s\", homedir, name) ==  -1)\n\t\terrExit(\"asprintf\");\n\n\tif (access(fname, R_OK) == 0) {\n\t\tprintf(\"UGLY: I can access files in %s directory. \", fname);\n\t\tprintf(\"Use \\\"firejail --blacklist=%s\\\" to block it.\\n\", fname);\n\t}\n\telse\n\t\tprintf(\"GOOD: I cannot access files in %s directory.\\n\", fname);\n\n\tfree(fname);\n}",
          "includes": [
            "#include <pwd.h>",
            "#include <fcntl.h>",
            "#include \"faudit.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static char *homedir = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <pwd.h>\n#include <fcntl.h>\n#include \"faudit.h\"\n\nstatic char *homedir = NULL;\n\nstatic void check_home_file(const char *name) {\n\tassert(homedir);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%s\", homedir, name) ==  -1)\n\t\terrExit(\"asprintf\");\n\n\tif (access(fname, R_OK) == 0) {\n\t\tprintf(\"UGLY: I can access files in %s directory. \", fname);\n\t\tprintf(\"Use \\\"firejail --blacklist=%s\\\" to block it.\\n\", fname);\n\t}\n\telse\n\t\tprintf(\"GOOD: I cannot access files in %s directory.\\n\", fname);\n\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "pw->pw_dir"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "pw->pw_name"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot retrieve user account information\\n\""
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpwuid",
          "args": [
            "getuid()"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pwd.h>\n#include <fcntl.h>\n#include \"faudit.h\"\n\nstatic char *username = NULL;\nstatic char *homedir = NULL;\n\nvoid files_test(void) {\n\tstruct passwd *pw = getpwuid(getuid());\n\tif (!pw) {\n\t\tfprintf(stderr, \"Error: cannot retrieve user account information\\n\");\n\t\treturn;\n\t}\n\n\tusername = strdup(pw->pw_name);\n\tif (!username)\n\t\terrExit(\"strdup\");\n\thomedir = strdup(pw->pw_dir);\n\tif (!homedir)\n\t\terrExit(\"strdup\");\n\n\t// check access to .ssh directory\n\tcheck_home_file(\".ssh\");\n\n\t// check access to .gnupg directory\n\tcheck_home_file(\".gnupg\");\n\n\t// check access to Firefox browser directory\n\tcheck_home_file(\".mozilla\");\n\n\t// check access to Chromium browser directory\n\tcheck_home_file(\".config/chromium\");\n\n\t// check access to Debian Icedove directory\n\tcheck_home_file(\".icedove\");\n\n\t// check access to Thunderbird directory\n\tcheck_home_file(\".thunderbird\");\n}"
  },
  {
    "function_name": "check_home_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/faudit/files.c",
    "lines": "27-42",
    "snippet": "static void check_home_file(const char *name) {\n\tassert(homedir);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%s\", homedir, name) ==  -1)\n\t\terrExit(\"asprintf\");\n\n\tif (access(fname, R_OK) == 0) {\n\t\tprintf(\"UGLY: I can access files in %s directory. \", fname);\n\t\tprintf(\"Use \\\"firejail --blacklist=%s\\\" to block it.\\n\", fname);\n\t}\n\telse\n\t\tprintf(\"GOOD: I cannot access files in %s directory.\\n\", fname);\n\n\tfree(fname);\n}",
    "includes": [
      "#include <pwd.h>",
      "#include <fcntl.h>",
      "#include \"faudit.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char *homedir = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"GOOD: I cannot access files in %s directory.\\n\"",
            "fname"
          ],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Use \\\"firejail --blacklist=%s\\\" to block it.\\n\"",
            "fname"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"UGLY: I can access files in %s directory. \"",
            "fname"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "fname",
            "R_OK"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "access",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "478-485",
          "snippet": "int access(const char *pathname, int mode) {\n\tif (!orig_access)\n\t\torig_access = (orig_access_t)dlsym(RTLD_NEXT, \"access\");\n\n\tint rv = orig_access(pathname, mode);\n\tprintf(\"%u:%s:access %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_access_t orig_access = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_access_t orig_access = NULL;\n\nint access(const char *pathname, int mode) {\n\tif (!orig_access)\n\t\torig_access = (orig_access_t)dlsym(RTLD_NEXT, \"access\");\n\n\tint rv = orig_access(pathname, mode);\n\tprintf(\"%u:%s:access %s:%d\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%s\"",
            "homedir",
            "name"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "homedir"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pwd.h>\n#include <fcntl.h>\n#include \"faudit.h\"\n\nstatic char *homedir = NULL;\n\nstatic void check_home_file(const char *name) {\n\tassert(homedir);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%s\", homedir, name) ==  -1)\n\t\terrExit(\"asprintf\");\n\n\tif (access(fname, R_OK) == 0) {\n\t\tprintf(\"UGLY: I can access files in %s directory. \", fname);\n\t\tprintf(\"Use \\\"firejail --blacklist=%s\\\" to block it.\\n\", fname);\n\t}\n\telse\n\t\tprintf(\"GOOD: I cannot access files in %s directory.\\n\", fname);\n\n\tfree(fname);\n}"
  }
]