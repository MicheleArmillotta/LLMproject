[
  {
    "function_name": "seccomp_secondary_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/fseccomp/seccomp_secondary.c",
    "lines": "122-152",
    "snippet": "void seccomp_secondary_block(const char *fname) {\n\tstruct sock_filter filter[] = {\n\t\t// block other architectures\n\t\tVALIDATE_ARCHITECTURE_KILL,\n\t\tEXAMINE_SYSCALL,\n#if defined(__x86_64__)\n\t\t// block x32\n\t\tHANDLE_X32_KILL,\n#endif\n\t\t// block personality(2) where domain != PER_LINUX or 0xffffffff (query current personality)\n\t\t// 0: if  personality(2), continue to 1, else goto 7 (allow)\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, SYS_personality, 0, jmp_from_to(0, 7)),\n\t\t// 1: get LSW of system call argument 0\n\t\tBPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(struct seccomp_data, args[0])) + LSW),\n\t\t// 2: if LSW(arg0) == PER_LINUX, goto step 4, else continue to 3\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, PER_LINUX, jmp_from_to(2, 4), 0),\n\t\t// 3: if LSW(arg0) == 0xffffffff, continue to 4, else goto 6 (kill)\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, 0xffffffff, 0, jmp_from_to(3, 6)),\n\t\t// 4: get MSW of system call argument 0\n\t\tBPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(struct seccomp_data, args[0])) + MSW),\n\t\t// 5: if MSW(arg0) == 0, goto 7 (allow) else continue to 6 (kill)\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, 0, jmp_from_to(5, 7), 0),\n\t\t// 6:\n\t\tKILL_PROCESS,\n\t\t// 7:\n\t\tRETURN_ALLOW\n\t};\n\n\t// save filter to file\n\twrite_filter(fname, sizeof(filter), filter);\n}",
    "includes": [
      "#include <sys/syscall.h>",
      "#include <sys/personality.h>",
      "#include \"../include/seccomp.h\"",
      "#include \"fseccomp.h\""
    ],
    "macros_used": [
      "#define LSW 0",
      "#define MSW (sizeof(int))",
      "#define LSW (sizeof(int))",
      "#define MSW 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "write_filter",
          "args": [
            "fname",
            "sizeof(filter)",
            "filter"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "write_filter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/fseccomp/seccomp_secondary.c",
          "lines": "25-43",
          "snippet": "static void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}",
          "includes": [
            "#include <sys/syscall.h>",
            "#include <sys/personality.h>",
            "#include \"../include/seccomp.h\"",
            "#include \"fseccomp.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/syscall.h>\n#include <sys/personality.h>\n#include \"../include/seccomp.h\"\n#include \"fseccomp.h\"\n\nstatic void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "BPF_JUMP",
          "args": [
            "BPF_JMP + BPF_JEQ + BPF_K",
            "0",
            "jmp_from_to(5, 7)",
            "0"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jmp_from_to",
          "args": [
            "5",
            "7"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BPF_STMT",
          "args": [
            "BPF_LD + BPF_W + BPF_ABS",
            "(offsetof(struct seccomp_data, args[0])"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BPF_JUMP",
          "args": [
            "BPF_JMP + BPF_JEQ + BPF_K",
            "0xffffffff",
            "0",
            "jmp_from_to(3, 6)"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jmp_from_to",
          "args": [
            "3",
            "6"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BPF_JUMP",
          "args": [
            "BPF_JMP + BPF_JEQ + BPF_K",
            "PER_LINUX",
            "jmp_from_to(2, 4)",
            "0"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jmp_from_to",
          "args": [
            "2",
            "4"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BPF_STMT",
          "args": [
            "BPF_LD + BPF_W + BPF_ABS",
            "(offsetof(struct seccomp_data, args[0])"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BPF_JUMP",
          "args": [
            "BPF_JMP + BPF_JEQ + BPF_K",
            "SYS_personality",
            "0",
            "jmp_from_to(0, 7)"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jmp_from_to",
          "args": [
            "0",
            "7"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/syscall.h>\n#include <sys/personality.h>\n#include \"../include/seccomp.h\"\n#include \"fseccomp.h\"\n\n#define LSW 0\n#define MSW (sizeof(int))\n#define LSW (sizeof(int))\n#define MSW 0\n\nvoid seccomp_secondary_block(const char *fname) {\n\tstruct sock_filter filter[] = {\n\t\t// block other architectures\n\t\tVALIDATE_ARCHITECTURE_KILL,\n\t\tEXAMINE_SYSCALL,\n#if defined(__x86_64__)\n\t\t// block x32\n\t\tHANDLE_X32_KILL,\n#endif\n\t\t// block personality(2) where domain != PER_LINUX or 0xffffffff (query current personality)\n\t\t// 0: if  personality(2), continue to 1, else goto 7 (allow)\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, SYS_personality, 0, jmp_from_to(0, 7)),\n\t\t// 1: get LSW of system call argument 0\n\t\tBPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(struct seccomp_data, args[0])) + LSW),\n\t\t// 2: if LSW(arg0) == PER_LINUX, goto step 4, else continue to 3\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, PER_LINUX, jmp_from_to(2, 4), 0),\n\t\t// 3: if LSW(arg0) == 0xffffffff, continue to 4, else goto 6 (kill)\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, 0xffffffff, 0, jmp_from_to(3, 6)),\n\t\t// 4: get MSW of system call argument 0\n\t\tBPF_STMT(BPF_LD + BPF_W + BPF_ABS, (offsetof(struct seccomp_data, args[0])) + MSW),\n\t\t// 5: if MSW(arg0) == 0, goto 7 (allow) else continue to 6 (kill)\n\t\tBPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, 0, jmp_from_to(5, 7), 0),\n\t\t// 6:\n\t\tKILL_PROCESS,\n\t\t// 7:\n\t\tRETURN_ALLOW\n\t};\n\n\t// save filter to file\n\twrite_filter(fname, sizeof(filter), filter);\n}"
  },
  {
    "function_name": "seccomp_secondary_32",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/fseccomp/seccomp_secondary.c",
    "lines": "47-110",
    "snippet": "void seccomp_secondary_32(const char *fname) {\n\t// hardcoded syscall values\n\tstruct sock_filter filter[] = {\n\t\tVALIDATE_ARCHITECTURE_32,\n\t\tEXAMINE_SYSCALL,\n\t\tBLACKLIST(21), // mount\n\t\tBLACKLIST(52), // umount2\n// todo: implement --allow-debuggers\n\t\tBLACKLIST(26), // ptrace\n\t\tBLACKLIST(283), // kexec_load\n\t\tBLACKLIST(341), // name_to_handle_at\n\t\tBLACKLIST(342), // open_by_handle_at\n\t\tBLACKLIST(127), // create_module\n\t\tBLACKLIST(128), // init_module\n\t\tBLACKLIST(350), // finit_module\n\t\tBLACKLIST(129), // delete_module\n\t\tBLACKLIST(110), // iopl\n\t\tBLACKLIST(101), // ioperm\n\t\tBLACKLIST(289), // ioprio_set\n\t\tBLACKLIST(87), // swapon\n\t\tBLACKLIST(115), // swapoff\n\t\tBLACKLIST(103), // syslog\n\t\tBLACKLIST(347), // process_vm_readv\n\t\tBLACKLIST(348), // process_vm_writev\n\t\tBLACKLIST(135), // sysfs\n\t\tBLACKLIST(149), // _sysctl\n\t\tBLACKLIST(124), // adjtimex\n\t\tBLACKLIST(343), // clock_adjtime\n\t\tBLACKLIST(253), // lookup_dcookie\n\t\tBLACKLIST(336), // perf_event_open\n\t\tBLACKLIST(338), // fanotify_init\n\t\tBLACKLIST(349), // kcmp\n\t\tBLACKLIST(286), // add_key\n\t\tBLACKLIST(287), // request_key\n\t\tBLACKLIST(288), // keyctl\n\t\tBLACKLIST(86), // uselib\n\t\tBLACKLIST(51), // acct\n\t\tBLACKLIST(123), // modify_ldt\n\t\tBLACKLIST(217), // pivot_root\n\t\tBLACKLIST(245), // io_setup\n\t\tBLACKLIST(246), // io_destroy\n\t\tBLACKLIST(247), // io_getevents\n\t\tBLACKLIST(248), // io_submit\n\t\tBLACKLIST(249), // io_cancel\n\t\tBLACKLIST(257), // remap_file_pages\n\t\tBLACKLIST(274), // mbind\n// breaking Firefox nightly when playing youtube videos\n// TODO: test again when firefox sandbox is finally released\n//\t\tBLACKLIST(275), // get_mempolicy\n\t\tBLACKLIST(276), // set_mempolicy\n\t\tBLACKLIST(294), // migrate_pages\n\t\tBLACKLIST(317), // move_pages\n\t\tBLACKLIST(316), // vmsplice\n\t\tBLACKLIST(61),  // chroot\n\t\tBLACKLIST(88), // reboot\n\t\tBLACKLIST(169), // nfsservctl\n\t\tBLACKLIST(130), // get_kernel_syms\n\n\t\tRETURN_ALLOW\n\t};\n\n\t// save filter to file\n\twrite_filter(fname, sizeof(filter), filter);\n}",
    "includes": [
      "#include <sys/syscall.h>",
      "#include <sys/personality.h>",
      "#include \"../include/seccomp.h\"",
      "#include \"fseccomp.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "write_filter",
          "args": [
            "fname",
            "sizeof(filter)",
            "filter"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "write_filter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/fseccomp/seccomp_secondary.c",
          "lines": "25-43",
          "snippet": "static void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}",
          "includes": [
            "#include <sys/syscall.h>",
            "#include <sys/personality.h>",
            "#include \"../include/seccomp.h\"",
            "#include \"fseccomp.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/syscall.h>\n#include <sys/personality.h>\n#include \"../include/seccomp.h\"\n#include \"fseccomp.h\"\n\nstatic void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "130"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "169"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "88"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "61"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "316"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "317"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "294"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "276"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "274"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "257"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "249"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "248"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "247"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "246"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "245"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "217"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "123"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "51"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "86"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "288"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "287"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "286"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "349"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "338"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "336"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "253"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "343"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "124"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "149"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "135"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "348"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "347"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "103"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "115"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "87"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "289"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "101"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "110"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "129"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "350"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "128"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "127"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "342"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "341"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "283"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "26"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "52"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BLACKLIST",
          "args": [
            "21"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/syscall.h>\n#include <sys/personality.h>\n#include \"../include/seccomp.h\"\n#include \"fseccomp.h\"\n\nvoid seccomp_secondary_32(const char *fname) {\n\t// hardcoded syscall values\n\tstruct sock_filter filter[] = {\n\t\tVALIDATE_ARCHITECTURE_32,\n\t\tEXAMINE_SYSCALL,\n\t\tBLACKLIST(21), // mount\n\t\tBLACKLIST(52), // umount2\n// todo: implement --allow-debuggers\n\t\tBLACKLIST(26), // ptrace\n\t\tBLACKLIST(283), // kexec_load\n\t\tBLACKLIST(341), // name_to_handle_at\n\t\tBLACKLIST(342), // open_by_handle_at\n\t\tBLACKLIST(127), // create_module\n\t\tBLACKLIST(128), // init_module\n\t\tBLACKLIST(350), // finit_module\n\t\tBLACKLIST(129), // delete_module\n\t\tBLACKLIST(110), // iopl\n\t\tBLACKLIST(101), // ioperm\n\t\tBLACKLIST(289), // ioprio_set\n\t\tBLACKLIST(87), // swapon\n\t\tBLACKLIST(115), // swapoff\n\t\tBLACKLIST(103), // syslog\n\t\tBLACKLIST(347), // process_vm_readv\n\t\tBLACKLIST(348), // process_vm_writev\n\t\tBLACKLIST(135), // sysfs\n\t\tBLACKLIST(149), // _sysctl\n\t\tBLACKLIST(124), // adjtimex\n\t\tBLACKLIST(343), // clock_adjtime\n\t\tBLACKLIST(253), // lookup_dcookie\n\t\tBLACKLIST(336), // perf_event_open\n\t\tBLACKLIST(338), // fanotify_init\n\t\tBLACKLIST(349), // kcmp\n\t\tBLACKLIST(286), // add_key\n\t\tBLACKLIST(287), // request_key\n\t\tBLACKLIST(288), // keyctl\n\t\tBLACKLIST(86), // uselib\n\t\tBLACKLIST(51), // acct\n\t\tBLACKLIST(123), // modify_ldt\n\t\tBLACKLIST(217), // pivot_root\n\t\tBLACKLIST(245), // io_setup\n\t\tBLACKLIST(246), // io_destroy\n\t\tBLACKLIST(247), // io_getevents\n\t\tBLACKLIST(248), // io_submit\n\t\tBLACKLIST(249), // io_cancel\n\t\tBLACKLIST(257), // remap_file_pages\n\t\tBLACKLIST(274), // mbind\n// breaking Firefox nightly when playing youtube videos\n// TODO: test again when firefox sandbox is finally released\n//\t\tBLACKLIST(275), // get_mempolicy\n\t\tBLACKLIST(276), // set_mempolicy\n\t\tBLACKLIST(294), // migrate_pages\n\t\tBLACKLIST(317), // move_pages\n\t\tBLACKLIST(316), // vmsplice\n\t\tBLACKLIST(61),  // chroot\n\t\tBLACKLIST(88), // reboot\n\t\tBLACKLIST(169), // nfsservctl\n\t\tBLACKLIST(130), // get_kernel_syms\n\n\t\tRETURN_ALLOW\n\t};\n\n\t// save filter to file\n\twrite_filter(fname, sizeof(filter), filter);\n}"
  },
  {
    "function_name": "write_filter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/fseccomp/seccomp_secondary.c",
    "lines": "25-43",
    "snippet": "static void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}",
    "includes": [
      "#include <sys/syscall.h>",
      "#include <sys/personality.h>",
      "#include \"../include/seccomp.h\"",
      "#include \"fseccomp.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "dst"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "rtnl_close",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/lib/libnetlink.c",
          "lines": "46-52",
          "snippet": "void rtnl_close(struct rtnl_handle *rth)\n{\n\tif (rth->fd >= 0) {\n\t\tclose(rth->fd);\n\t\trth->fd = -1;\n\t}\n}",
          "includes": [
            "#include \"../include/libnetlink.h\"",
            "#include <sys/uio.h>",
            "#include <time.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <net/if_arp.h>",
            "#include <fcntl.h>",
            "#include <syslog.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"../include/libnetlink.h\"\n#include <sys/uio.h>\n#include <time.h>\n#include <errno.h>\n#include <string.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <net/if_arp.h>\n#include <fcntl.h>\n#include <syslog.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nvoid rtnl_close(struct rtnl_handle *rth)\n{\n\tif (rth->fd >= 0) {\n\t\tclose(rth->fd);\n\t\trth->fd = -1;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 38
        },
        "resolved": true,
        "details": {
          "function_name": "exit_err_feature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/firejail/main.c",
          "lines": "329-332",
          "snippet": "static void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/firejail_user.h\"",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/firejail_user.h\"\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void exit_err_feature(const char *feature) {\n\tfprintf(stderr, \"Error: %s feature is disabled in Firejail configuration file\\n\", feature);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error fseccomp: cannot write %s file\\n\"",
            "fname"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "dst",
            "(unsigned char *) filter + written",
            "size - written"
          ],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "write_filter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/fseccomp/seccomp_secondary.c",
          "lines": "25-43",
          "snippet": "static void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error fseccomp: cannot open %s file\\n\"",
            "fname"
          ],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "fname",
            "O_CREAT|O_WRONLY|O_TRUNC",
            "S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH"
          ],
          "line": 27
        },
        "resolved": true,
        "details": {
          "function_name": "freopen64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "346-353",
          "snippet": "FILE *freopen64(const char *pathname, const char *mode, FILE *stream) {\n\tif (!orig_freopen64)\n\t\torig_freopen64 = (orig_freopen64_t)dlsym(RTLD_NEXT, \"freopen64\");\n\n\tFILE *rv = orig_freopen64(pathname, mode, stream);\n\tprintf(\"%u:%s:freopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nFILE *freopen64(const char *pathname, const char *mode, FILE *stream) {\n\tif (!orig_freopen64)\n\t\torig_freopen64 = (orig_freopen64_t)dlsym(RTLD_NEXT, \"freopen64\");\n\n\tFILE *rv = orig_freopen64(pathname, mode, stream);\n\tprintf(\"%u:%s:freopen64 %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/syscall.h>\n#include <sys/personality.h>\n#include \"../include/seccomp.h\"\n#include \"fseccomp.h\"\n\nstatic void write_filter(const char *fname, size_t size, const void *filter) {\n\t// save filter to file\n\tint dst = open(fname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Error fseccomp: cannot open %s file\\n\", fname);\n\t\texit(1);\n\t}\n\n\tsize_t written = 0;\n\twhile (written < size) {\n\t\tssize_t rv = write(dst, (unsigned char *) filter + written, size - written);\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Error fseccomp: cannot write %s file\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\twritten += rv;\n\t}\n\tclose(dst);\n}"
  }
]