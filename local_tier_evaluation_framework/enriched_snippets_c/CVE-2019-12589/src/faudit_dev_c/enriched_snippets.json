[
  {
    "function_name": "dev_test",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/faudit/dev.c",
    "lines": "23-47",
    "snippet": "void dev_test(void) {\n\tDIR *dir;\n\tif (!(dir = opendir(\"/dev\"))) {\n\t\tfprintf(stderr, \"Error: cannot open /dev directory\\n\");\n\t\treturn;\n\t}\n\n\tstruct dirent *entry;\n\tprintf(\"INFO: files visible in /dev directory: \");\n\tint cnt = 0;\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (strcmp(entry->d_name, \".\") == 0 || strcmp(entry->d_name, \"..\") == 0)\n\t\t\tcontinue;\n\n\t\tprintf(\"%s, \", entry->d_name);\n\t\tcnt++;\n\t}\n\tprintf(\"\\n\");\n\n\tif (cnt > 20)\n\t\tprintf(\"MAYBE: /dev directory seems to be fully populated. Use --private-dev or --whitelist to restrict the access.\\n\");\n\telse\n\t\tprintf(\"GOOD: Access to /dev directory is restricted.\\n\");\n\tclosedir(dir);\n}",
    "includes": [
      "#include <dirent.h>",
      "#include \"faudit.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "closedir",
          "args": [
            "dir"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"GOOD: Access to /dev directory is restricted.\\n\""
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"MAYBE: /dev directory seems to be fully populated. Use --private-dev or --whitelist to restrict the access.\\n\""
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s, \"",
            "entry->d_name"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "entry->d_name",
            "\"..\""
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "entry->d_name",
            "\".\""
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "readdir",
          "args": [
            "dir"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"INFO: files visible in /dev directory: \""
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open /dev directory\\n\""
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "\"/dev\""
          ],
          "line": 25
        },
        "resolved": true,
        "details": {
          "function_name": "opendir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2019-12589/repo/src/libtrace/libtrace.c",
          "lines": "466-473",
          "snippet": "DIR *opendir(const char *pathname) {\n\tif (!orig_opendir)\n\t\torig_opendir = (orig_opendir_t)dlsym(RTLD_NEXT, \"opendir\");\n\n\tDIR *rv = orig_opendir(pathname);\n\tprintf(\"%u:%s:opendir %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}",
          "includes": [
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <syslog.h>",
            "#include <sys/stat.h>",
            "#include <sys/un.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <unistd.h>",
            "#include <limits.h>",
            "#include <sys/types.h>",
            "#include <dlfcn.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static orig_opendir_t orig_opendir = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <limits.h>\n#include <dirent.h>\n#include <syslog.h>\n#include <sys/stat.h>\n#include <sys/un.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <unistd.h>\n#include <limits.h>\n#include <sys/types.h>\n#include <dlfcn.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n\nstatic orig_opendir_t orig_opendir = NULL;\n\nDIR *opendir(const char *pathname) {\n\tif (!orig_opendir)\n\t\torig_opendir = (orig_opendir_t)dlsym(RTLD_NEXT, \"opendir\");\n\n\tDIR *rv = orig_opendir(pathname);\n\tprintf(\"%u:%s:opendir %s:%p\\n\", pid(), name(), pathname, rv);\n\treturn rv;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <dirent.h>\n#include \"faudit.h\"\n\nvoid dev_test(void) {\n\tDIR *dir;\n\tif (!(dir = opendir(\"/dev\"))) {\n\t\tfprintf(stderr, \"Error: cannot open /dev directory\\n\");\n\t\treturn;\n\t}\n\n\tstruct dirent *entry;\n\tprintf(\"INFO: files visible in /dev directory: \");\n\tint cnt = 0;\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (strcmp(entry->d_name, \".\") == 0 || strcmp(entry->d_name, \"..\") == 0)\n\t\t\tcontinue;\n\n\t\tprintf(\"%s, \", entry->d_name);\n\t\tcnt++;\n\t}\n\tprintf(\"\\n\");\n\n\tif (cnt > 20)\n\t\tprintf(\"MAYBE: /dev directory seems to be fully populated. Use --private-dev or --whitelist to restrict the access.\\n\");\n\telse\n\t\tprintf(\"GOOD: Access to /dev directory is restricted.\\n\");\n\tclosedir(dir);\n}"
  }
]