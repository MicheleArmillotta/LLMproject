[
  {
    "function_name": "fuse_remove_signal_handlers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
    "lines": "85-98",
    "snippet": "void fuse_remove_signal_handlers(struct fuse_session *se)\n{\n    if (fuse_instance != se) {\n        fuse_log(FUSE_LOG_ERR,\n                 \"fuse: fuse_remove_signal_handlers: unknown session\\n\");\n    } else {\n        fuse_instance = NULL;\n    }\n\n    set_one_signal_handler(SIGHUP, exit_handler, 1);\n    set_one_signal_handler(SIGINT, exit_handler, 1);\n    set_one_signal_handler(SIGTERM, exit_handler, 1);\n    set_one_signal_handler(SIGPIPE, do_nothing, 1);\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include \"fuse_lowlevel.h\"",
      "#include \"fuse_i.h\"",
      "#include \"qemu/osdep.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct fuse_session *fuse_instance;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_one_signal_handler",
          "args": [
            "SIGPIPE",
            "do_nothing",
            "1"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "set_one_signal_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
          "lines": "40-63",
          "snippet": "static int set_one_signal_handler(int sig, void (*handler)(int), int remove)\n{\n    struct sigaction sa;\n    struct sigaction old_sa;\n\n    memset(&sa, 0, sizeof(struct sigaction));\n    sa.sa_handler = remove ? SIG_DFL : handler;\n    sigemptyset(&(sa.sa_mask));\n    sa.sa_flags = 0;\n\n    if (sigaction(sig, NULL, &old_sa) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot get old signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n\n    if (old_sa.sa_handler == (remove ? handler : SIG_DFL) &&\n        sigaction(sig, &sa, NULL) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot set signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include \"fuse_lowlevel.h\"",
            "#include \"fuse_i.h\"",
            "#include \"qemu/osdep.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic int set_one_signal_handler(int sig, void (*handler)(int), int remove)\n{\n    struct sigaction sa;\n    struct sigaction old_sa;\n\n    memset(&sa, 0, sizeof(struct sigaction));\n    sa.sa_handler = remove ? SIG_DFL : handler;\n    sigemptyset(&(sa.sa_mask));\n    sa.sa_flags = 0;\n\n    if (sigaction(sig, NULL, &old_sa) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot get old signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n\n    if (old_sa.sa_handler == (remove ? handler : SIG_DFL) &&\n        sigaction(sig, &sa, NULL) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot set signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fuse_log",
          "args": [
            "FUSE_LOG_ERR",
            "\"fuse: fuse_remove_signal_handlers: unknown session\\n\""
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "fuse_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_log.c",
          "lines": "34-41",
          "snippet": "void fuse_log(enum fuse_log_level level, const char *fmt, ...)\n{\n    va_list ap;\n\n    va_start(ap, fmt);\n    log_func(level, fmt, ap);\n    va_end(ap);\n}",
          "includes": [
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include \"fuse_log.h\"",
            "#include \"qemu/osdep.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static fuse_log_func_t log_func = default_log_func;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <stdarg.h>\n#include \"fuse_log.h\"\n#include \"qemu/osdep.h\"\n\nstatic fuse_log_func_t log_func = default_log_func;\n\nvoid fuse_log(enum fuse_log_level level, const char *fmt, ...)\n{\n    va_list ap;\n\n    va_start(ap, fmt);\n    log_func(level, fmt, ap);\n    va_end(ap);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic struct fuse_session *fuse_instance;\n\nvoid fuse_remove_signal_handlers(struct fuse_session *se)\n{\n    if (fuse_instance != se) {\n        fuse_log(FUSE_LOG_ERR,\n                 \"fuse: fuse_remove_signal_handlers: unknown session\\n\");\n    } else {\n        fuse_instance = NULL;\n    }\n\n    set_one_signal_handler(SIGHUP, exit_handler, 1);\n    set_one_signal_handler(SIGINT, exit_handler, 1);\n    set_one_signal_handler(SIGTERM, exit_handler, 1);\n    set_one_signal_handler(SIGPIPE, do_nothing, 1);\n}"
  },
  {
    "function_name": "fuse_set_signal_handlers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
    "lines": "65-83",
    "snippet": "int fuse_set_signal_handlers(struct fuse_session *se)\n{\n    /*\n     * If we used SIG_IGN instead of the do_nothing function,\n     * then we would be unable to tell if we set SIG_IGN (and\n     * thus should reset to SIG_DFL in fuse_remove_signal_handlers)\n     * or if it was already set to SIG_IGN (and should be left\n     * untouched.\n     */\n    if (set_one_signal_handler(SIGHUP, exit_handler, 0) == -1 ||\n        set_one_signal_handler(SIGINT, exit_handler, 0) == -1 ||\n        set_one_signal_handler(SIGTERM, exit_handler, 0) == -1 ||\n        set_one_signal_handler(SIGPIPE, do_nothing, 0) == -1) {\n        return -1;\n    }\n\n    fuse_instance = se;\n    return 0;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include \"fuse_lowlevel.h\"",
      "#include \"fuse_i.h\"",
      "#include \"qemu/osdep.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct fuse_session *fuse_instance;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_one_signal_handler",
          "args": [
            "SIGPIPE",
            "do_nothing",
            "0"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "set_one_signal_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
          "lines": "40-63",
          "snippet": "static int set_one_signal_handler(int sig, void (*handler)(int), int remove)\n{\n    struct sigaction sa;\n    struct sigaction old_sa;\n\n    memset(&sa, 0, sizeof(struct sigaction));\n    sa.sa_handler = remove ? SIG_DFL : handler;\n    sigemptyset(&(sa.sa_mask));\n    sa.sa_flags = 0;\n\n    if (sigaction(sig, NULL, &old_sa) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot get old signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n\n    if (old_sa.sa_handler == (remove ? handler : SIG_DFL) &&\n        sigaction(sig, &sa, NULL) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot set signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include \"fuse_lowlevel.h\"",
            "#include \"fuse_i.h\"",
            "#include \"qemu/osdep.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic int set_one_signal_handler(int sig, void (*handler)(int), int remove)\n{\n    struct sigaction sa;\n    struct sigaction old_sa;\n\n    memset(&sa, 0, sizeof(struct sigaction));\n    sa.sa_handler = remove ? SIG_DFL : handler;\n    sigemptyset(&(sa.sa_mask));\n    sa.sa_flags = 0;\n\n    if (sigaction(sig, NULL, &old_sa) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot get old signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n\n    if (old_sa.sa_handler == (remove ? handler : SIG_DFL) &&\n        sigaction(sig, &sa, NULL) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot set signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic struct fuse_session *fuse_instance;\n\nint fuse_set_signal_handlers(struct fuse_session *se)\n{\n    /*\n     * If we used SIG_IGN instead of the do_nothing function,\n     * then we would be unable to tell if we set SIG_IGN (and\n     * thus should reset to SIG_DFL in fuse_remove_signal_handlers)\n     * or if it was already set to SIG_IGN (and should be left\n     * untouched.\n     */\n    if (set_one_signal_handler(SIGHUP, exit_handler, 0) == -1 ||\n        set_one_signal_handler(SIGINT, exit_handler, 0) == -1 ||\n        set_one_signal_handler(SIGTERM, exit_handler, 0) == -1 ||\n        set_one_signal_handler(SIGPIPE, do_nothing, 0) == -1) {\n        return -1;\n    }\n\n    fuse_instance = se;\n    return 0;\n}"
  },
  {
    "function_name": "set_one_signal_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
    "lines": "40-63",
    "snippet": "static int set_one_signal_handler(int sig, void (*handler)(int), int remove)\n{\n    struct sigaction sa;\n    struct sigaction old_sa;\n\n    memset(&sa, 0, sizeof(struct sigaction));\n    sa.sa_handler = remove ? SIG_DFL : handler;\n    sigemptyset(&(sa.sa_mask));\n    sa.sa_flags = 0;\n\n    if (sigaction(sig, NULL, &old_sa) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot get old signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n\n    if (old_sa.sa_handler == (remove ? handler : SIG_DFL) &&\n        sigaction(sig, &sa, NULL) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot set signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include \"fuse_lowlevel.h\"",
      "#include \"fuse_i.h\"",
      "#include \"qemu/osdep.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fuse_log",
          "args": [
            "FUSE_LOG_ERR",
            "\"fuse: cannot set signal handler: %s\\n\"",
            "strerror(errno)"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "fuse_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_log.c",
          "lines": "34-41",
          "snippet": "void fuse_log(enum fuse_log_level level, const char *fmt, ...)\n{\n    va_list ap;\n\n    va_start(ap, fmt);\n    log_func(level, fmt, ap);\n    va_end(ap);\n}",
          "includes": [
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include \"fuse_log.h\"",
            "#include \"qemu/osdep.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static fuse_log_func_t log_func = default_log_func;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <stdarg.h>\n#include \"fuse_log.h\"\n#include \"qemu/osdep.h\"\n\nstatic fuse_log_func_t log_func = default_log_func;\n\nvoid fuse_log(enum fuse_log_level level, const char *fmt, ...)\n{\n    va_list ap;\n\n    va_start(ap, fmt);\n    log_func(level, fmt, ap);\n    va_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "sig",
            "&sa",
            "NULL"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigaction",
          "args": [
            "sig",
            "NULL",
            "&old_sa"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sigemptyset",
          "args": [
            "&(sa.sa_mask)"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&sa",
            "0",
            "sizeof(struct sigaction)"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic int set_one_signal_handler(int sig, void (*handler)(int), int remove)\n{\n    struct sigaction sa;\n    struct sigaction old_sa;\n\n    memset(&sa, 0, sizeof(struct sigaction));\n    sa.sa_handler = remove ? SIG_DFL : handler;\n    sigemptyset(&(sa.sa_mask));\n    sa.sa_flags = 0;\n\n    if (sigaction(sig, NULL, &old_sa) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot get old signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n\n    if (old_sa.sa_handler == (remove ? handler : SIG_DFL) &&\n        sigaction(sig, &sa, NULL) == -1) {\n        fuse_log(FUSE_LOG_ERR, \"fuse: cannot set signal handler: %s\\n\",\n                 strerror(errno));\n        return -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "do_nothing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
    "lines": "35-38",
    "snippet": "static void do_nothing(int sig)\n{\n    (void)sig;\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include \"fuse_lowlevel.h\"",
      "#include \"fuse_i.h\"",
      "#include \"qemu/osdep.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic void do_nothing(int sig)\n{\n    (void)sig;\n}"
  },
  {
    "function_name": "exit_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_signals.c",
    "lines": "23-33",
    "snippet": "static void exit_handler(int sig)\n{\n    if (fuse_instance) {\n        fuse_session_exit(fuse_instance);\n        if (sig <= 0) {\n            fuse_log(FUSE_LOG_ERR, \"assertion error: signal value <= 0\\n\");\n            abort();\n        }\n        fuse_instance->error = sig;\n    }\n}",
    "includes": [
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include \"fuse_lowlevel.h\"",
      "#include \"fuse_i.h\"",
      "#include \"qemu/osdep.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static struct fuse_session *fuse_instance;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "abort",
          "args": [],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fuse_log",
          "args": [
            "FUSE_LOG_ERR",
            "\"assertion error: signal value <= 0\\n\""
          ],
          "line": 28
        },
        "resolved": true,
        "details": {
          "function_name": "fuse_log",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_log.c",
          "lines": "34-41",
          "snippet": "void fuse_log(enum fuse_log_level level, const char *fmt, ...)\n{\n    va_list ap;\n\n    va_start(ap, fmt);\n    log_func(level, fmt, ap);\n    va_end(ap);\n}",
          "includes": [
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include \"fuse_log.h\"",
            "#include \"qemu/osdep.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static fuse_log_func_t log_func = default_log_func;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <stdarg.h>\n#include \"fuse_log.h\"\n#include \"qemu/osdep.h\"\n\nstatic fuse_log_func_t log_func = default_log_func;\n\nvoid fuse_log(enum fuse_log_level level, const char *fmt, ...)\n{\n    va_list ap;\n\n    va_start(ap, fmt);\n    log_func(level, fmt, ap);\n    va_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fuse_session_exit",
          "args": [
            "fuse_instance"
          ],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "fuse_session_exited",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-35517/repo/tools/virtiofsd/fuse_lowlevel.c",
          "lines": "2691-2694",
          "snippet": "int fuse_session_exited(struct fuse_session *se)\n{\n    return se->exited;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stddef.h>",
            "#include <stdbool.h>",
            "#include <limits.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"fuse_virtio.h\"",
            "#include \"fuse_opt.h\"",
            "#include \"fuse_misc.h\"",
            "#include \"standard-headers/linux/fuse.h\"",
            "#include \"fuse_i.h\"",
            "#include \"qemu/osdep.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <stddef.h>\n#include <stdbool.h>\n#include <limits.h>\n#include <glib.h>\n#include <errno.h>\n#include <assert.h>\n#include \"fuse_virtio.h\"\n#include \"fuse_opt.h\"\n#include \"fuse_misc.h\"\n#include \"standard-headers/linux/fuse.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nint fuse_session_exited(struct fuse_session *se)\n{\n    return se->exited;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <signal.h>\n#include <errno.h>\n#include \"fuse_lowlevel.h\"\n#include \"fuse_i.h\"\n#include \"qemu/osdep.h\"\n\nstatic struct fuse_session *fuse_instance;\n\nstatic void exit_handler(int sig)\n{\n    if (fuse_instance) {\n        fuse_session_exit(fuse_instance);\n        if (sig <= 0) {\n            fuse_log(FUSE_LOG_ERR, \"assertion error: signal value <= 0\\n\");\n            abort();\n        }\n        fuse_instance->error = sig;\n    }\n}"
  }
]