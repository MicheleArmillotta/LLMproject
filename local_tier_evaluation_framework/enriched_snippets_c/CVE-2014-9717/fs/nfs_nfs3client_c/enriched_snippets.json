[
  {
    "function_name": "nfs3_set_ds_client",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
    "lines": "79-106",
    "snippet": "struct nfs_client *nfs3_set_ds_client(struct nfs_client *mds_clp,\n\t\tconst struct sockaddr *ds_addr, int ds_addrlen,\n\t\tint ds_proto, unsigned int ds_timeo, unsigned int ds_retrans,\n\t\trpc_authflavor_t au_flavor)\n{\n\tstruct nfs_client_initdata cl_init = {\n\t\t.addr = ds_addr,\n\t\t.addrlen = ds_addrlen,\n\t\t.nfs_mod = &nfs_v3,\n\t\t.proto = ds_proto,\n\t\t.net = mds_clp->cl_net,\n\t};\n\tstruct rpc_timeout ds_timeout;\n\tstruct nfs_client *clp;\n\tchar buf[INET6_ADDRSTRLEN + 1];\n\n\t/* fake a hostname because lockd wants it */\n\tif (rpc_ntop(ds_addr, buf, sizeof(buf)) <= 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tcl_init.hostname = buf;\n\n\t/* Use the MDS nfs_client cl_ipaddr. */\n\tnfs_init_timeout_values(&ds_timeout, ds_proto, ds_timeo, ds_retrans);\n\tclp = nfs_get_client(&cl_init, &ds_timeout, mds_clp->cl_ipaddr,\n\t\t\t     au_flavor);\n\n\treturn clp;\n}",
    "includes": [
      "#include \"nfs3_fs.h\"",
      "#include \"internal.h\"",
      "#include <linux/sunrpc/addr.h>",
      "#include <linux/nfs_mount.h>",
      "#include <linux/nfs_fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nfs_get_client",
          "args": [
            "&cl_init",
            "&ds_timeout",
            "mds_clp->cl_ipaddr",
            "au_flavor"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_get_client",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/client.c",
          "lines": "478-523",
          "snippet": "struct nfs_client *\nnfs_get_client(const struct nfs_client_initdata *cl_init,\n\t       const struct rpc_timeout *timeparms,\n\t       const char *ip_addr,\n\t       rpc_authflavor_t authflavour)\n{\n\tstruct nfs_client *clp, *new = NULL;\n\tstruct nfs_net *nn = net_generic(cl_init->net, nfs_net_id);\n\tconst struct nfs_rpc_ops *rpc_ops = cl_init->nfs_mod->rpc_ops;\n\n\tif (cl_init->hostname == NULL) {\n\t\tWARN_ON(1);\n\t\treturn NULL;\n\t}\n\n\tdprintk(\"--> nfs_get_client(%s,v%u)\\n\",\n\t\tcl_init->hostname, rpc_ops->version);\n\n\t/* see if the client already exists */\n\tdo {\n\t\tspin_lock(&nn->nfs_client_lock);\n\n\t\tclp = nfs_match_client(cl_init);\n\t\tif (clp) {\n\t\t\tspin_unlock(&nn->nfs_client_lock);\n\t\t\tif (new)\n\t\t\t\tnew->rpc_ops->free_client(new);\n\t\t\treturn nfs_found_client(cl_init, clp);\n\t\t}\n\t\tif (new) {\n\t\t\tlist_add_tail(&new->cl_share_link,\n\t\t\t\t\t&nn->nfs_client_list);\n\t\t\tspin_unlock(&nn->nfs_client_lock);\n\t\t\tnew->cl_flags = cl_init->init_flags;\n\t\t\treturn rpc_ops->init_client(new, timeparms, ip_addr);\n\t\t}\n\n\t\tspin_unlock(&nn->nfs_client_lock);\n\n\t\tnew = rpc_ops->alloc_client(cl_init);\n\t} while (!IS_ERR(new));\n\n\tdprintk(\"<-- nfs_get_client() Failed to find %s (%ld)\\n\",\n\t\tcl_init->hostname, PTR_ERR(new));\n\treturn new;\n}",
          "includes": [
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/pid_namespace.h>",
            "#include <linux/nsproxy.h>",
            "#include <linux/sunrpc/bc_xprt.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <net/ipv6.h>",
            "#include <linux/idr.h>",
            "#include <linux/slab.h>",
            "#include <linux/in6.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/nfs_idmap.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/xprtrdma.h>",
            "#include <linux/sunrpc/xprtsock.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <linux/pid_namespace.h>\n#include <linux/nsproxy.h>\n#include <linux/sunrpc/bc_xprt.h>\n#include <linux/nfs_xdr.h>\n#include <net/ipv6.h>\n#include <linux/idr.h>\n#include <linux/slab.h>\n#include <linux/in6.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/nfs_idmap.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/xprtrdma.h>\n#include <linux/sunrpc/xprtsock.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nstruct nfs_client *\nnfs_get_client(const struct nfs_client_initdata *cl_init,\n\t       const struct rpc_timeout *timeparms,\n\t       const char *ip_addr,\n\t       rpc_authflavor_t authflavour)\n{\n\tstruct nfs_client *clp, *new = NULL;\n\tstruct nfs_net *nn = net_generic(cl_init->net, nfs_net_id);\n\tconst struct nfs_rpc_ops *rpc_ops = cl_init->nfs_mod->rpc_ops;\n\n\tif (cl_init->hostname == NULL) {\n\t\tWARN_ON(1);\n\t\treturn NULL;\n\t}\n\n\tdprintk(\"--> nfs_get_client(%s,v%u)\\n\",\n\t\tcl_init->hostname, rpc_ops->version);\n\n\t/* see if the client already exists */\n\tdo {\n\t\tspin_lock(&nn->nfs_client_lock);\n\n\t\tclp = nfs_match_client(cl_init);\n\t\tif (clp) {\n\t\t\tspin_unlock(&nn->nfs_client_lock);\n\t\t\tif (new)\n\t\t\t\tnew->rpc_ops->free_client(new);\n\t\t\treturn nfs_found_client(cl_init, clp);\n\t\t}\n\t\tif (new) {\n\t\t\tlist_add_tail(&new->cl_share_link,\n\t\t\t\t\t&nn->nfs_client_list);\n\t\t\tspin_unlock(&nn->nfs_client_lock);\n\t\t\tnew->cl_flags = cl_init->init_flags;\n\t\t\treturn rpc_ops->init_client(new, timeparms, ip_addr);\n\t\t}\n\n\t\tspin_unlock(&nn->nfs_client_lock);\n\n\t\tnew = rpc_ops->alloc_client(cl_init);\n\t} while (!IS_ERR(new));\n\n\tdprintk(\"<-- nfs_get_client() Failed to find %s (%ld)\\n\",\n\t\tcl_init->hostname, PTR_ERR(new));\n\treturn new;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nfs_init_timeout_values",
          "args": [
            "&ds_timeout",
            "ds_proto",
            "ds_timeo",
            "ds_retrans"
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_init_timeout_values",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/client.c",
          "lines": "540-576",
          "snippet": "void nfs_init_timeout_values(struct rpc_timeout *to, int proto,\n\t\t\t\t    unsigned int timeo, unsigned int retrans)\n{\n\tto->to_initval = timeo * HZ / 10;\n\tto->to_retries = retrans;\n\n\tswitch (proto) {\n\tcase XPRT_TRANSPORT_TCP:\n\tcase XPRT_TRANSPORT_RDMA:\n\t\tif (to->to_retries == 0)\n\t\t\tto->to_retries = NFS_DEF_TCP_RETRANS;\n\t\tif (to->to_initval == 0)\n\t\t\tto->to_initval = NFS_DEF_TCP_TIMEO * HZ / 10;\n\t\tif (to->to_initval > NFS_MAX_TCP_TIMEOUT)\n\t\t\tto->to_initval = NFS_MAX_TCP_TIMEOUT;\n\t\tto->to_increment = to->to_initval;\n\t\tto->to_maxval = to->to_initval + (to->to_increment * to->to_retries);\n\t\tif (to->to_maxval > NFS_MAX_TCP_TIMEOUT)\n\t\t\tto->to_maxval = NFS_MAX_TCP_TIMEOUT;\n\t\tif (to->to_maxval < to->to_initval)\n\t\t\tto->to_maxval = to->to_initval;\n\t\tto->to_exponential = 0;\n\t\tbreak;\n\tcase XPRT_TRANSPORT_UDP:\n\t\tif (to->to_retries == 0)\n\t\t\tto->to_retries = NFS_DEF_UDP_RETRANS;\n\t\tif (!to->to_initval)\n\t\t\tto->to_initval = NFS_DEF_UDP_TIMEO * HZ / 10;\n\t\tif (to->to_initval > NFS_MAX_UDP_TIMEOUT)\n\t\t\tto->to_initval = NFS_MAX_UDP_TIMEOUT;\n\t\tto->to_maxval = NFS_MAX_UDP_TIMEOUT;\n\t\tto->to_exponential = 1;\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n}",
          "includes": [
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/pid_namespace.h>",
            "#include <linux/nsproxy.h>",
            "#include <linux/sunrpc/bc_xprt.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <net/ipv6.h>",
            "#include <linux/idr.h>",
            "#include <linux/slab.h>",
            "#include <linux/in6.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/nfs_idmap.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/xprtrdma.h>",
            "#include <linux/sunrpc/xprtsock.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <linux/pid_namespace.h>\n#include <linux/nsproxy.h>\n#include <linux/sunrpc/bc_xprt.h>\n#include <linux/nfs_xdr.h>\n#include <net/ipv6.h>\n#include <linux/idr.h>\n#include <linux/slab.h>\n#include <linux/in6.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/nfs_idmap.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/xprtrdma.h>\n#include <linux/sunrpc/xprtsock.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nvoid nfs_init_timeout_values(struct rpc_timeout *to, int proto,\n\t\t\t\t    unsigned int timeo, unsigned int retrans)\n{\n\tto->to_initval = timeo * HZ / 10;\n\tto->to_retries = retrans;\n\n\tswitch (proto) {\n\tcase XPRT_TRANSPORT_TCP:\n\tcase XPRT_TRANSPORT_RDMA:\n\t\tif (to->to_retries == 0)\n\t\t\tto->to_retries = NFS_DEF_TCP_RETRANS;\n\t\tif (to->to_initval == 0)\n\t\t\tto->to_initval = NFS_DEF_TCP_TIMEO * HZ / 10;\n\t\tif (to->to_initval > NFS_MAX_TCP_TIMEOUT)\n\t\t\tto->to_initval = NFS_MAX_TCP_TIMEOUT;\n\t\tto->to_increment = to->to_initval;\n\t\tto->to_maxval = to->to_initval + (to->to_increment * to->to_retries);\n\t\tif (to->to_maxval > NFS_MAX_TCP_TIMEOUT)\n\t\t\tto->to_maxval = NFS_MAX_TCP_TIMEOUT;\n\t\tif (to->to_maxval < to->to_initval)\n\t\t\tto->to_maxval = to->to_initval;\n\t\tto->to_exponential = 0;\n\t\tbreak;\n\tcase XPRT_TRANSPORT_UDP:\n\t\tif (to->to_retries == 0)\n\t\t\tto->to_retries = NFS_DEF_UDP_RETRANS;\n\t\tif (!to->to_initval)\n\t\t\tto->to_initval = NFS_DEF_UDP_TIMEO * HZ / 10;\n\t\tif (to->to_initval > NFS_MAX_UDP_TIMEOUT)\n\t\t\tto->to_initval = NFS_MAX_UDP_TIMEOUT;\n\t\tto->to_maxval = NFS_MAX_UDP_TIMEOUT;\n\t\tto->to_exponential = 1;\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EINVAL"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rpc_ntop",
          "args": [
            "ds_addr",
            "buf",
            "sizeof(buf)"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstruct nfs_client *nfs3_set_ds_client(struct nfs_client *mds_clp,\n\t\tconst struct sockaddr *ds_addr, int ds_addrlen,\n\t\tint ds_proto, unsigned int ds_timeo, unsigned int ds_retrans,\n\t\trpc_authflavor_t au_flavor)\n{\n\tstruct nfs_client_initdata cl_init = {\n\t\t.addr = ds_addr,\n\t\t.addrlen = ds_addrlen,\n\t\t.nfs_mod = &nfs_v3,\n\t\t.proto = ds_proto,\n\t\t.net = mds_clp->cl_net,\n\t};\n\tstruct rpc_timeout ds_timeout;\n\tstruct nfs_client *clp;\n\tchar buf[INET6_ADDRSTRLEN + 1];\n\n\t/* fake a hostname because lockd wants it */\n\tif (rpc_ntop(ds_addr, buf, sizeof(buf)) <= 0)\n\t\treturn ERR_PTR(-EINVAL);\n\tcl_init.hostname = buf;\n\n\t/* Use the MDS nfs_client cl_ipaddr. */\n\tnfs_init_timeout_values(&ds_timeout, ds_proto, ds_timeo, ds_retrans);\n\tclp = nfs_get_client(&cl_init, &ds_timeout, mds_clp->cl_ipaddr,\n\t\t\t     au_flavor);\n\n\treturn clp;\n}"
  },
  {
    "function_name": "nfs3_clone_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
    "lines": "58-67",
    "snippet": "struct nfs_server *nfs3_clone_server(struct nfs_server *source,\n\t\t\t\t     struct nfs_fh *fh,\n\t\t\t\t     struct nfs_fattr *fattr,\n\t\t\t\t     rpc_authflavor_t flavor)\n{\n\tstruct nfs_server *server = nfs_clone_server(source, fh, fattr, flavor);\n\tif (!IS_ERR(server) && !IS_ERR(source->client_acl))\n\t\tnfs_init_server_aclclient(server);\n\treturn server;\n}",
    "includes": [
      "#include \"nfs3_fs.h\"",
      "#include \"internal.h\"",
      "#include <linux/sunrpc/addr.h>",
      "#include <linux/nfs_mount.h>",
      "#include <linux/nfs_fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nfs_init_server_aclclient",
          "args": [
            "server"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_init_server_aclclient",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
          "lines": "41-45",
          "snippet": "static inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}",
          "includes": [
            "#include \"nfs3_fs.h\"",
            "#include \"internal.h\"",
            "#include <linux/sunrpc/addr.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstatic inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "source->client_acl"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "server"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs_clone_server",
          "args": [
            "source",
            "fh",
            "fattr",
            "flavor"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_clone_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/client.c",
          "lines": "1116-1180",
          "snippet": "struct nfs_server *nfs_clone_server(struct nfs_server *source,\n\t\t\t\t    struct nfs_fh *fh,\n\t\t\t\t    struct nfs_fattr *fattr,\n\t\t\t\t    rpc_authflavor_t flavor)\n{\n\tstruct nfs_server *server;\n\tstruct nfs_fattr *fattr_fsinfo;\n\tint error;\n\n\tdprintk(\"--> nfs_clone_server(,%llx:%llx,)\\n\",\n\t\t(unsigned long long) fattr->fsid.major,\n\t\t(unsigned long long) fattr->fsid.minor);\n\n\tserver = nfs_alloc_server();\n\tif (!server)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\terror = -ENOMEM;\n\tfattr_fsinfo = nfs_alloc_fattr();\n\tif (fattr_fsinfo == NULL)\n\t\tgoto out_free_server;\n\n\t/* Copy data from the source */\n\tserver->nfs_client = source->nfs_client;\n\tserver->destroy = source->destroy;\n\tatomic_inc(&server->nfs_client->cl_count);\n\tnfs_server_copy_userdata(server, source);\n\n\tserver->fsid = fattr->fsid;\n\n\terror = nfs_init_server_rpcclient(server,\n\t\t\tsource->client->cl_timeout,\n\t\t\tflavor);\n\tif (error < 0)\n\t\tgoto out_free_server;\n\n\t/* probe the filesystem info for this server filesystem */\n\terror = nfs_probe_fsinfo(server, fh, fattr_fsinfo);\n\tif (error < 0)\n\t\tgoto out_free_server;\n\n\tif (server->namelen == 0 || server->namelen > NFS4_MAXNAMLEN)\n\t\tserver->namelen = NFS4_MAXNAMLEN;\n\n\tdprintk(\"Cloned FSID: %llx:%llx\\n\",\n\t\t(unsigned long long) server->fsid.major,\n\t\t(unsigned long long) server->fsid.minor);\n\n\terror = nfs_start_lockd(server);\n\tif (error < 0)\n\t\tgoto out_free_server;\n\n\tnfs_server_insert_lists(server);\n\tserver->mount_time = jiffies;\n\n\tnfs_free_fattr(fattr_fsinfo);\n\tdprintk(\"<-- nfs_clone_server() = %p\\n\", server);\n\treturn server;\n\nout_free_server:\n\tnfs_free_fattr(fattr_fsinfo);\n\tnfs_free_server(server);\n\tdprintk(\"<-- nfs_clone_server() = error %d\\n\", error);\n\treturn ERR_PTR(error);\n}",
          "includes": [
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/pid_namespace.h>",
            "#include <linux/nsproxy.h>",
            "#include <linux/sunrpc/bc_xprt.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <net/ipv6.h>",
            "#include <linux/idr.h>",
            "#include <linux/slab.h>",
            "#include <linux/in6.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/nfs_idmap.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/xprtrdma.h>",
            "#include <linux/sunrpc/xprtsock.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <linux/pid_namespace.h>\n#include <linux/nsproxy.h>\n#include <linux/sunrpc/bc_xprt.h>\n#include <linux/nfs_xdr.h>\n#include <net/ipv6.h>\n#include <linux/idr.h>\n#include <linux/slab.h>\n#include <linux/in6.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/nfs_idmap.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/xprtrdma.h>\n#include <linux/sunrpc/xprtsock.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nstruct nfs_server *nfs_clone_server(struct nfs_server *source,\n\t\t\t\t    struct nfs_fh *fh,\n\t\t\t\t    struct nfs_fattr *fattr,\n\t\t\t\t    rpc_authflavor_t flavor)\n{\n\tstruct nfs_server *server;\n\tstruct nfs_fattr *fattr_fsinfo;\n\tint error;\n\n\tdprintk(\"--> nfs_clone_server(,%llx:%llx,)\\n\",\n\t\t(unsigned long long) fattr->fsid.major,\n\t\t(unsigned long long) fattr->fsid.minor);\n\n\tserver = nfs_alloc_server();\n\tif (!server)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\terror = -ENOMEM;\n\tfattr_fsinfo = nfs_alloc_fattr();\n\tif (fattr_fsinfo == NULL)\n\t\tgoto out_free_server;\n\n\t/* Copy data from the source */\n\tserver->nfs_client = source->nfs_client;\n\tserver->destroy = source->destroy;\n\tatomic_inc(&server->nfs_client->cl_count);\n\tnfs_server_copy_userdata(server, source);\n\n\tserver->fsid = fattr->fsid;\n\n\terror = nfs_init_server_rpcclient(server,\n\t\t\tsource->client->cl_timeout,\n\t\t\tflavor);\n\tif (error < 0)\n\t\tgoto out_free_server;\n\n\t/* probe the filesystem info for this server filesystem */\n\terror = nfs_probe_fsinfo(server, fh, fattr_fsinfo);\n\tif (error < 0)\n\t\tgoto out_free_server;\n\n\tif (server->namelen == 0 || server->namelen > NFS4_MAXNAMLEN)\n\t\tserver->namelen = NFS4_MAXNAMLEN;\n\n\tdprintk(\"Cloned FSID: %llx:%llx\\n\",\n\t\t(unsigned long long) server->fsid.major,\n\t\t(unsigned long long) server->fsid.minor);\n\n\terror = nfs_start_lockd(server);\n\tif (error < 0)\n\t\tgoto out_free_server;\n\n\tnfs_server_insert_lists(server);\n\tserver->mount_time = jiffies;\n\n\tnfs_free_fattr(fattr_fsinfo);\n\tdprintk(\"<-- nfs_clone_server() = %p\\n\", server);\n\treturn server;\n\nout_free_server:\n\tnfs_free_fattr(fattr_fsinfo);\n\tnfs_free_server(server);\n\tdprintk(\"<-- nfs_clone_server() = error %d\\n\", error);\n\treturn ERR_PTR(error);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstruct nfs_server *nfs3_clone_server(struct nfs_server *source,\n\t\t\t\t     struct nfs_fh *fh,\n\t\t\t\t     struct nfs_fattr *fattr,\n\t\t\t\t     rpc_authflavor_t flavor)\n{\n\tstruct nfs_server *server = nfs_clone_server(source, fh, fattr, flavor);\n\tif (!IS_ERR(server) && !IS_ERR(source->client_acl))\n\t\tnfs_init_server_aclclient(server);\n\treturn server;\n}"
  },
  {
    "function_name": "nfs3_create_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
    "lines": "48-56",
    "snippet": "struct nfs_server *nfs3_create_server(struct nfs_mount_info *mount_info,\n\t\t\t\t      struct nfs_subversion *nfs_mod)\n{\n\tstruct nfs_server *server = nfs_create_server(mount_info, nfs_mod);\n\t/* Create a client RPC handle for the NFS v3 ACL management interface */\n\tif (!IS_ERR(server))\n\t\tnfs_init_server_aclclient(server);\n\treturn server;\n}",
    "includes": [
      "#include \"nfs3_fs.h\"",
      "#include \"internal.h\"",
      "#include <linux/sunrpc/addr.h>",
      "#include <linux/nfs_mount.h>",
      "#include <linux/nfs_fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nfs_init_server_aclclient",
          "args": [
            "server"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_init_server_aclclient",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
          "lines": "41-45",
          "snippet": "static inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}",
          "includes": [
            "#include \"nfs3_fs.h\"",
            "#include \"internal.h\"",
            "#include <linux/sunrpc/addr.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstatic inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "server"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nfs_create_server",
          "args": [
            "mount_info",
            "nfs_mod"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "nfs_create_server",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/client.c",
          "lines": "1053-1110",
          "snippet": "struct nfs_server *nfs_create_server(struct nfs_mount_info *mount_info,\n\t\t\t\t     struct nfs_subversion *nfs_mod)\n{\n\tstruct nfs_server *server;\n\tstruct nfs_fattr *fattr;\n\tint error;\n\n\tserver = nfs_alloc_server();\n\tif (!server)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\terror = -ENOMEM;\n\tfattr = nfs_alloc_fattr();\n\tif (fattr == NULL)\n\t\tgoto error;\n\n\t/* Get a client representation */\n\terror = nfs_init_server(server, mount_info->parsed, nfs_mod);\n\tif (error < 0)\n\t\tgoto error;\n\n\t/* Probe the root fh to retrieve its FSID */\n\terror = nfs_probe_fsinfo(server, mount_info->mntfh, fattr);\n\tif (error < 0)\n\t\tgoto error;\n\tif (server->nfs_client->rpc_ops->version == 3) {\n\t\tif (server->namelen == 0 || server->namelen > NFS3_MAXNAMLEN)\n\t\t\tserver->namelen = NFS3_MAXNAMLEN;\n\t\tif (!(mount_info->parsed->flags & NFS_MOUNT_NORDIRPLUS))\n\t\t\tserver->caps |= NFS_CAP_READDIRPLUS;\n\t} else {\n\t\tif (server->namelen == 0 || server->namelen > NFS2_MAXNAMLEN)\n\t\t\tserver->namelen = NFS2_MAXNAMLEN;\n\t}\n\n\tif (!(fattr->valid & NFS_ATTR_FATTR)) {\n\t\terror = nfs_mod->rpc_ops->getattr(server, mount_info->mntfh, fattr, NULL);\n\t\tif (error < 0) {\n\t\t\tdprintk(\"nfs_create_server: getattr error = %d\\n\", -error);\n\t\t\tgoto error;\n\t\t}\n\t}\n\tmemcpy(&server->fsid, &fattr->fsid, sizeof(server->fsid));\n\n\tdprintk(\"Server FSID: %llx:%llx\\n\",\n\t\t(unsigned long long) server->fsid.major,\n\t\t(unsigned long long) server->fsid.minor);\n\n\tnfs_server_insert_lists(server);\n\tserver->mount_time = jiffies;\n\tnfs_free_fattr(fattr);\n\treturn server;\n\nerror:\n\tnfs_free_fattr(fattr);\n\tnfs_free_server(server);\n\treturn ERR_PTR(error);\n}",
          "includes": [
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <linux/pid_namespace.h>",
            "#include <linux/nsproxy.h>",
            "#include <linux/sunrpc/bc_xprt.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <net/ipv6.h>",
            "#include <linux/idr.h>",
            "#include <linux/slab.h>",
            "#include <linux/in6.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/nfs_idmap.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/xprtrdma.h>",
            "#include <linux/sunrpc/xprtsock.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <linux/pid_namespace.h>\n#include <linux/nsproxy.h>\n#include <linux/sunrpc/bc_xprt.h>\n#include <linux/nfs_xdr.h>\n#include <net/ipv6.h>\n#include <linux/idr.h>\n#include <linux/slab.h>\n#include <linux/in6.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/nfs_idmap.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/xprtrdma.h>\n#include <linux/sunrpc/xprtsock.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nstruct nfs_server *nfs_create_server(struct nfs_mount_info *mount_info,\n\t\t\t\t     struct nfs_subversion *nfs_mod)\n{\n\tstruct nfs_server *server;\n\tstruct nfs_fattr *fattr;\n\tint error;\n\n\tserver = nfs_alloc_server();\n\tif (!server)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\terror = -ENOMEM;\n\tfattr = nfs_alloc_fattr();\n\tif (fattr == NULL)\n\t\tgoto error;\n\n\t/* Get a client representation */\n\terror = nfs_init_server(server, mount_info->parsed, nfs_mod);\n\tif (error < 0)\n\t\tgoto error;\n\n\t/* Probe the root fh to retrieve its FSID */\n\terror = nfs_probe_fsinfo(server, mount_info->mntfh, fattr);\n\tif (error < 0)\n\t\tgoto error;\n\tif (server->nfs_client->rpc_ops->version == 3) {\n\t\tif (server->namelen == 0 || server->namelen > NFS3_MAXNAMLEN)\n\t\t\tserver->namelen = NFS3_MAXNAMLEN;\n\t\tif (!(mount_info->parsed->flags & NFS_MOUNT_NORDIRPLUS))\n\t\t\tserver->caps |= NFS_CAP_READDIRPLUS;\n\t} else {\n\t\tif (server->namelen == 0 || server->namelen > NFS2_MAXNAMLEN)\n\t\t\tserver->namelen = NFS2_MAXNAMLEN;\n\t}\n\n\tif (!(fattr->valid & NFS_ATTR_FATTR)) {\n\t\terror = nfs_mod->rpc_ops->getattr(server, mount_info->mntfh, fattr, NULL);\n\t\tif (error < 0) {\n\t\t\tdprintk(\"nfs_create_server: getattr error = %d\\n\", -error);\n\t\t\tgoto error;\n\t\t}\n\t}\n\tmemcpy(&server->fsid, &fattr->fsid, sizeof(server->fsid));\n\n\tdprintk(\"Server FSID: %llx:%llx\\n\",\n\t\t(unsigned long long) server->fsid.major,\n\t\t(unsigned long long) server->fsid.minor);\n\n\tnfs_server_insert_lists(server);\n\tserver->mount_time = jiffies;\n\tnfs_free_fattr(fattr);\n\treturn server;\n\nerror:\n\tnfs_free_fattr(fattr);\n\tnfs_free_server(server);\n\treturn ERR_PTR(error);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstruct nfs_server *nfs3_create_server(struct nfs_mount_info *mount_info,\n\t\t\t\t      struct nfs_subversion *nfs_mod)\n{\n\tstruct nfs_server *server = nfs_create_server(mount_info, nfs_mod);\n\t/* Create a client RPC handle for the NFS v3 ACL management interface */\n\tif (!IS_ERR(server))\n\t\tnfs_init_server_aclclient(server);\n\treturn server;\n}"
  },
  {
    "function_name": "nfs_init_server_aclclient",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
    "lines": "41-45",
    "snippet": "static inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}",
    "includes": [
      "#include \"nfs3_fs.h\"",
      "#include \"internal.h\"",
      "#include <linux/sunrpc/addr.h>",
      "#include <linux/nfs_mount.h>",
      "#include <linux/nfs_fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstatic inline void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tserver->flags &= ~NFS_MOUNT_NOACL;\n\tserver->caps &= ~NFS_CAP_ACLS;\n}"
  },
  {
    "function_name": "nfs_init_server_aclclient",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/nfs3client.c",
    "lines": "24-39",
    "snippet": "static void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tif (server->flags & NFS_MOUNT_NOACL)\n\t\tgoto out_noacl;\n\n\tserver->client_acl = rpc_bind_new_program(server->client, &nfsacl_program, 3);\n\tif (IS_ERR(server->client_acl))\n\t\tgoto out_noacl;\n\n\t/* No errors! Assume that Sun nfsacls are supported */\n\tserver->caps |= NFS_CAP_ACLS;\n\treturn;\n\nout_noacl:\n\tserver->caps &= ~NFS_CAP_ACLS;\n}",
    "includes": [
      "#include \"nfs3_fs.h\"",
      "#include \"internal.h\"",
      "#include <linux/sunrpc/addr.h>",
      "#include <linux/nfs_mount.h>",
      "#include <linux/nfs_fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "server->client_acl"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rpc_bind_new_program",
          "args": [
            "server->client",
            "&nfsacl_program",
            "3"
          ],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"nfs3_fs.h\"\n#include \"internal.h\"\n#include <linux/sunrpc/addr.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n\nstatic void nfs_init_server_aclclient(struct nfs_server *server)\n{\n\tif (server->flags & NFS_MOUNT_NOACL)\n\t\tgoto out_noacl;\n\n\tserver->client_acl = rpc_bind_new_program(server->client, &nfsacl_program, 3);\n\tif (IS_ERR(server->client_acl))\n\t\tgoto out_noacl;\n\n\t/* No errors! Assume that Sun nfsacls are supported */\n\tserver->caps |= NFS_CAP_ACLS;\n\treturn;\n\nout_noacl:\n\tserver->caps &= ~NFS_CAP_ACLS;\n}"
  }
]