[
  {
    "function_name": "SMBNTencrypt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "230-249",
    "snippet": "int\nSMBNTencrypt(unsigned char *passwd, unsigned char *c8, unsigned char *p24,\n\t\tconst struct nls_table *codepage)\n{\n\tint rc;\n\tunsigned char p16[16], p21[21];\n\n\tmemset(p16, '\\0', 16);\n\tmemset(p21, '\\0', 21);\n\n\trc = E_md4hash(passwd, p16, codepage);\n\tif (rc) {\n\t\tcifs_dbg(FYI, \"%s Can't generate NT hash, error: %d\\n\",\n\t\t\t __func__, rc);\n\t\treturn rc;\n\t}\n\tmemcpy(p21, p16, 16);\n\trc = E_P24(p21, c8, p24);\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "E_P24",
          "args": [
            "p21",
            "c8",
            "p24"
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "E_P24",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "116-129",
          "snippet": "static int\nE_P24(unsigned char *p21, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\n\trc = smbhash(p24, c8, p21);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 8, c8, p21 + 7);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 16, c8, p21 + 14);\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nE_P24(unsigned char *p21, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\n\trc = smbhash(p24, c8, p21);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 8, c8, p21 + 7);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 16, c8, p21 + 14);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "p21",
            "p16",
            "16"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "FYI",
            "\"%s Can't generate NT hash, error: %d\\n\"",
            "__func__",
            "rc"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "E_md4hash",
          "args": [
            "passwd",
            "p16",
            "codepage"
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "E_md4hash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "207-227",
          "snippet": "int\nE_md4hash(const unsigned char *passwd, unsigned char *p16,\n\tconst struct nls_table *codepage)\n{\n\tint rc;\n\tint len;\n\t__le16 wpwd[129];\n\n\t/* Password cannot be longer than 128 characters */\n\tif (passwd) /* Password must be converted to NT unicode */\n\t\tlen = cifs_strtoUTF16(wpwd, passwd, 128, codepage);\n\telse {\n\t\tlen = 0;\n\t\t*wpwd = 0; /* Ensure string is null terminated */\n\t}\n\n\trc = mdfour(p16, (unsigned char *) wpwd, len * sizeof(__le16));\n\tmemzero_explicit(wpwd, sizeof(wpwd));\n\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nint\nE_md4hash(const unsigned char *passwd, unsigned char *p16,\n\tconst struct nls_table *codepage)\n{\n\tint rc;\n\tint len;\n\t__le16 wpwd[129];\n\n\t/* Password cannot be longer than 128 characters */\n\tif (passwd) /* Password must be converted to NT unicode */\n\t\tlen = cifs_strtoUTF16(wpwd, passwd, 128, codepage);\n\telse {\n\t\tlen = 0;\n\t\t*wpwd = 0; /* Ensure string is null terminated */\n\t}\n\n\trc = mdfour(p16, (unsigned char *) wpwd, len * sizeof(__le16));\n\tmemzero_explicit(wpwd, sizeof(wpwd));\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p21",
            "'\\0'",
            "21"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p16",
            "'\\0'",
            "16"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nint\nSMBNTencrypt(unsigned char *passwd, unsigned char *c8, unsigned char *p24,\n\t\tconst struct nls_table *codepage)\n{\n\tint rc;\n\tunsigned char p16[16], p21[21];\n\n\tmemset(p16, '\\0', 16);\n\tmemset(p21, '\\0', 21);\n\n\trc = E_md4hash(passwd, p16, codepage);\n\tif (rc) {\n\t\tcifs_dbg(FYI, \"%s Can't generate NT hash, error: %d\\n\",\n\t\t\t __func__, rc);\n\t\treturn rc;\n\t}\n\tmemcpy(p21, p16, 16);\n\trc = E_P24(p21, c8, p24);\n\treturn rc;\n}"
  },
  {
    "function_name": "E_md4hash",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "207-227",
    "snippet": "int\nE_md4hash(const unsigned char *passwd, unsigned char *p16,\n\tconst struct nls_table *codepage)\n{\n\tint rc;\n\tint len;\n\t__le16 wpwd[129];\n\n\t/* Password cannot be longer than 128 characters */\n\tif (passwd) /* Password must be converted to NT unicode */\n\t\tlen = cifs_strtoUTF16(wpwd, passwd, 128, codepage);\n\telse {\n\t\tlen = 0;\n\t\t*wpwd = 0; /* Ensure string is null terminated */\n\t}\n\n\trc = mdfour(p16, (unsigned char *) wpwd, len * sizeof(__le16));\n\tmemzero_explicit(wpwd, sizeof(wpwd));\n\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memzero_explicit",
          "args": [
            "wpwd",
            "sizeof(wpwd)"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mdfour",
          "args": [
            "p16",
            "(unsigned char *) wpwd",
            "len * sizeof(__le16)"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "mdfour",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "132-175",
          "snippet": "int\nmdfour(unsigned char *md4_hash, unsigned char *link_str, int link_len)\n{\n\tint rc;\n\tunsigned int size;\n\tstruct crypto_shash *md4;\n\tstruct sdesc *sdescmd4;\n\n\tmd4 = crypto_alloc_shash(\"md4\", 0, 0);\n\tif (IS_ERR(md4)) {\n\t\trc = PTR_ERR(md4);\n\t\tcifs_dbg(VFS, \"%s: Crypto md4 allocation error %d\\n\",\n\t\t\t __func__, rc);\n\t\treturn rc;\n\t}\n\tsize = sizeof(struct shash_desc) + crypto_shash_descsize(md4);\n\tsdescmd4 = kmalloc(size, GFP_KERNEL);\n\tif (!sdescmd4) {\n\t\trc = -ENOMEM;\n\t\tgoto mdfour_err;\n\t}\n\tsdescmd4->shash.tfm = md4;\n\tsdescmd4->shash.flags = 0x0;\n\n\trc = crypto_shash_init(&sdescmd4->shash);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not init md4 shash\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_update(&sdescmd4->shash, link_str, link_len);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not update with link_str\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_final(&sdescmd4->shash, md4_hash);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"%s: Could not generate md4 hash\\n\", __func__);\n\nmdfour_err:\n\tcrypto_free_shash(md4);\n\tkfree(sdescmd4);\n\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nint\nmdfour(unsigned char *md4_hash, unsigned char *link_str, int link_len)\n{\n\tint rc;\n\tunsigned int size;\n\tstruct crypto_shash *md4;\n\tstruct sdesc *sdescmd4;\n\n\tmd4 = crypto_alloc_shash(\"md4\", 0, 0);\n\tif (IS_ERR(md4)) {\n\t\trc = PTR_ERR(md4);\n\t\tcifs_dbg(VFS, \"%s: Crypto md4 allocation error %d\\n\",\n\t\t\t __func__, rc);\n\t\treturn rc;\n\t}\n\tsize = sizeof(struct shash_desc) + crypto_shash_descsize(md4);\n\tsdescmd4 = kmalloc(size, GFP_KERNEL);\n\tif (!sdescmd4) {\n\t\trc = -ENOMEM;\n\t\tgoto mdfour_err;\n\t}\n\tsdescmd4->shash.tfm = md4;\n\tsdescmd4->shash.flags = 0x0;\n\n\trc = crypto_shash_init(&sdescmd4->shash);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not init md4 shash\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_update(&sdescmd4->shash, link_str, link_len);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not update with link_str\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_final(&sdescmd4->shash, md4_hash);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"%s: Could not generate md4 hash\\n\", __func__);\n\nmdfour_err:\n\tcrypto_free_shash(md4);\n\tkfree(sdescmd4);\n\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cifs_strtoUTF16",
          "args": [
            "wpwd",
            "passwd",
            "128",
            "codepage"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "cifs_strtoUTF16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/cifs_unicode.c",
          "lines": "252-296",
          "snippet": "int\ncifs_strtoUTF16(__le16 *to, const char *from, int len,\n\t      const struct nls_table *codepage)\n{\n\tint charlen;\n\tint i;\n\twchar_t wchar_to; /* needed to quiet sparse */\n\n\t/* special case for utf8 to handle no plane0 chars */\n\tif (!strcmp(codepage->charset, \"utf8\")) {\n\t\t/*\n\t\t * convert utf8 -> utf16, we assume we have enough space\n\t\t * as caller should have assumed conversion does not overflow\n\t\t * in destination len is length in wchar_t units (16bits)\n\t\t */\n\t\ti  = utf8s_to_utf16s(from, len, UTF16_LITTLE_ENDIAN,\n\t\t\t\t       (wchar_t *) to, len);\n\n\t\t/* if success terminate and exit */\n\t\tif (i >= 0)\n\t\t\tgoto success;\n\t\t/*\n\t\t * if fails fall back to UCS encoding as this\n\t\t * function should not return negative values\n\t\t * currently can fail only if source contains\n\t\t * invalid encoded characters\n\t\t */\n\t}\n\n\tfor (i = 0; len && *from; i++, from += charlen, len -= charlen) {\n\t\tcharlen = codepage->char2uni(from, len, &wchar_to);\n\t\tif (charlen < 1) {\n\t\t\tcifs_dbg(VFS, \"strtoUTF16: char2uni of 0x%x returned %d\\n\",\n\t\t\t\t *from, charlen);\n\t\t\t/* A question mark */\n\t\t\twchar_to = 0x003f;\n\t\t\tcharlen = 1;\n\t\t}\n\t\tput_unaligned_le16(wchar_to, &to[i]);\n\t}\n\nsuccess:\n\tput_unaligned_le16(0, &to[i]);\n\treturn i;\n}",
          "includes": [
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_uniupr.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/slab.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_uniupr.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/slab.h>\n#include <linux/fs.h>\n\nint\ncifs_strtoUTF16(__le16 *to, const char *from, int len,\n\t      const struct nls_table *codepage)\n{\n\tint charlen;\n\tint i;\n\twchar_t wchar_to; /* needed to quiet sparse */\n\n\t/* special case for utf8 to handle no plane0 chars */\n\tif (!strcmp(codepage->charset, \"utf8\")) {\n\t\t/*\n\t\t * convert utf8 -> utf16, we assume we have enough space\n\t\t * as caller should have assumed conversion does not overflow\n\t\t * in destination len is length in wchar_t units (16bits)\n\t\t */\n\t\ti  = utf8s_to_utf16s(from, len, UTF16_LITTLE_ENDIAN,\n\t\t\t\t       (wchar_t *) to, len);\n\n\t\t/* if success terminate and exit */\n\t\tif (i >= 0)\n\t\t\tgoto success;\n\t\t/*\n\t\t * if fails fall back to UCS encoding as this\n\t\t * function should not return negative values\n\t\t * currently can fail only if source contains\n\t\t * invalid encoded characters\n\t\t */\n\t}\n\n\tfor (i = 0; len && *from; i++, from += charlen, len -= charlen) {\n\t\tcharlen = codepage->char2uni(from, len, &wchar_to);\n\t\tif (charlen < 1) {\n\t\t\tcifs_dbg(VFS, \"strtoUTF16: char2uni of 0x%x returned %d\\n\",\n\t\t\t\t *from, charlen);\n\t\t\t/* A question mark */\n\t\t\twchar_to = 0x003f;\n\t\t\tcharlen = 1;\n\t\t}\n\t\tput_unaligned_le16(wchar_to, &to[i]);\n\t}\n\nsuccess:\n\tput_unaligned_le16(0, &to[i]);\n\treturn i;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nint\nE_md4hash(const unsigned char *passwd, unsigned char *p16,\n\tconst struct nls_table *codepage)\n{\n\tint rc;\n\tint len;\n\t__le16 wpwd[129];\n\n\t/* Password cannot be longer than 128 characters */\n\tif (passwd) /* Password must be converted to NT unicode */\n\t\tlen = cifs_strtoUTF16(wpwd, passwd, 128, codepage);\n\telse {\n\t\tlen = 0;\n\t\t*wpwd = 0; /* Ensure string is null terminated */\n\t}\n\n\trc = mdfour(p16, (unsigned char *) wpwd, len * sizeof(__le16));\n\tmemzero_explicit(wpwd, sizeof(wpwd));\n\n\treturn rc;\n}"
  },
  {
    "function_name": "SMBencrypt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "182-201",
    "snippet": "int\nSMBencrypt(unsigned char *passwd, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\tunsigned char p14[14], p16[16], p21[21];\n\n\tmemset(p14, '\\0', 14);\n\tmemset(p16, '\\0', 16);\n\tmemset(p21, '\\0', 21);\n\n\tmemcpy(p14, passwd, 14);\n\trc = E_P16(p14, p16);\n\tif (rc)\n\t\treturn rc;\n\n\tmemcpy(p21, p16, 16);\n\trc = E_P24(p21, c8, p24);\n\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "E_P24",
          "args": [
            "p21",
            "c8",
            "p24"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "E_P24",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "116-129",
          "snippet": "static int\nE_P24(unsigned char *p21, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\n\trc = smbhash(p24, c8, p21);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 8, c8, p21 + 7);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 16, c8, p21 + 14);\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nE_P24(unsigned char *p21, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\n\trc = smbhash(p24, c8, p21);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 8, c8, p21 + 7);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 16, c8, p21 + 14);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "p21",
            "p16",
            "16"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "E_P16",
          "args": [
            "p14",
            "p16"
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "E_P16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "102-114",
          "snippet": "static int\nE_P16(unsigned char *p14, unsigned char *p16)\n{\n\tint rc;\n\tunsigned char sp8[8] =\n\t    { 0x4b, 0x47, 0x53, 0x21, 0x40, 0x23, 0x24, 0x25 };\n\n\trc = smbhash(p16, sp8, p14);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p16 + 8, sp8, p14 + 7);\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nE_P16(unsigned char *p14, unsigned char *p16)\n{\n\tint rc;\n\tunsigned char sp8[8] =\n\t    { 0x4b, 0x47, 0x53, 0x21, 0x40, 0x23, 0x24, 0x25 };\n\n\trc = smbhash(p16, sp8, p14);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p16 + 8, sp8, p14 + 7);\n\treturn rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "p14",
            "passwd",
            "14"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p21",
            "'\\0'",
            "21"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p16",
            "'\\0'",
            "16"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p14",
            "'\\0'",
            "14"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nint\nSMBencrypt(unsigned char *passwd, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\tunsigned char p14[14], p16[16], p21[21];\n\n\tmemset(p14, '\\0', 14);\n\tmemset(p16, '\\0', 16);\n\tmemset(p21, '\\0', 21);\n\n\tmemcpy(p14, passwd, 14);\n\trc = E_P16(p14, p16);\n\tif (rc)\n\t\treturn rc;\n\n\tmemcpy(p21, p16, 16);\n\trc = E_P24(p21, c8, p24);\n\n\treturn rc;\n}"
  },
  {
    "function_name": "mdfour",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "132-175",
    "snippet": "int\nmdfour(unsigned char *md4_hash, unsigned char *link_str, int link_len)\n{\n\tint rc;\n\tunsigned int size;\n\tstruct crypto_shash *md4;\n\tstruct sdesc *sdescmd4;\n\n\tmd4 = crypto_alloc_shash(\"md4\", 0, 0);\n\tif (IS_ERR(md4)) {\n\t\trc = PTR_ERR(md4);\n\t\tcifs_dbg(VFS, \"%s: Crypto md4 allocation error %d\\n\",\n\t\t\t __func__, rc);\n\t\treturn rc;\n\t}\n\tsize = sizeof(struct shash_desc) + crypto_shash_descsize(md4);\n\tsdescmd4 = kmalloc(size, GFP_KERNEL);\n\tif (!sdescmd4) {\n\t\trc = -ENOMEM;\n\t\tgoto mdfour_err;\n\t}\n\tsdescmd4->shash.tfm = md4;\n\tsdescmd4->shash.flags = 0x0;\n\n\trc = crypto_shash_init(&sdescmd4->shash);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not init md4 shash\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_update(&sdescmd4->shash, link_str, link_len);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not update with link_str\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_final(&sdescmd4->shash, md4_hash);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"%s: Could not generate md4 hash\\n\", __func__);\n\nmdfour_err:\n\tcrypto_free_shash(md4);\n\tkfree(sdescmd4);\n\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "sdescmd4"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_free_shash",
          "args": [
            "md4"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "VFS",
            "\"%s: Could not generate md4 hash\\n\"",
            "__func__"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_shash_final",
          "args": [
            "&sdescmd4->shash",
            "md4_hash"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "VFS",
            "\"%s: Could not update with link_str\\n\"",
            "__func__"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_shash_update",
          "args": [
            "&sdescmd4->shash",
            "link_str",
            "link_len"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "VFS",
            "\"%s: Could not init md4 shash\\n\"",
            "__func__"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_shash_init",
          "args": [
            "&sdescmd4->shash"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kmalloc",
          "args": [
            "size",
            "GFP_KERNEL"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "ocfs2_dx_dir_kmalloc_leaves",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ocfs2/dir.c",
          "lines": "2534-2546",
          "snippet": "static struct buffer_head **ocfs2_dx_dir_kmalloc_leaves(struct super_block *sb,\n\t\t\t\t\t\t\tint *ret_num_leaves)\n{\n\tint num_dx_leaves = ocfs2_clusters_to_blocks(sb, 1);\n\tstruct buffer_head **dx_leaves;\n\n\tdx_leaves = kcalloc(num_dx_leaves, sizeof(struct buffer_head *),\n\t\t\t    GFP_NOFS);\n\tif (dx_leaves && ret_num_leaves)\n\t\t*ret_num_leaves = num_dx_leaves;\n\n\treturn dx_leaves;\n}",
          "includes": [
            "#include \"buffer_head_io.h\"",
            "#include \"ocfs2_trace.h\"",
            "#include \"uptodate.h\"",
            "#include \"sysfile.h\"",
            "#include \"super.h\"",
            "#include \"suballoc.h\"",
            "#include \"namei.h\"",
            "#include \"journal.h\"",
            "#include \"inode.h\"",
            "#include \"file.h\"",
            "#include \"extent_map.h\"",
            "#include \"dlmglue.h\"",
            "#include \"dir.h\"",
            "#include \"blockcheck.h\"",
            "#include \"alloc.h\"",
            "#include \"ocfs2.h\"",
            "#include <cluster/masklog.h>",
            "#include <linux/sort.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/highmem.h>",
            "#include <linux/slab.h>",
            "#include <linux/types.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"buffer_head_io.h\"\n#include \"ocfs2_trace.h\"\n#include \"uptodate.h\"\n#include \"sysfile.h\"\n#include \"super.h\"\n#include \"suballoc.h\"\n#include \"namei.h\"\n#include \"journal.h\"\n#include \"inode.h\"\n#include \"file.h\"\n#include \"extent_map.h\"\n#include \"dlmglue.h\"\n#include \"dir.h\"\n#include \"blockcheck.h\"\n#include \"alloc.h\"\n#include \"ocfs2.h\"\n#include <cluster/masklog.h>\n#include <linux/sort.h>\n#include <linux/quotaops.h>\n#include <linux/highmem.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n#include <linux/fs.h>\n\nstatic struct buffer_head **ocfs2_dx_dir_kmalloc_leaves(struct super_block *sb,\n\t\t\t\t\t\t\tint *ret_num_leaves)\n{\n\tint num_dx_leaves = ocfs2_clusters_to_blocks(sb, 1);\n\tstruct buffer_head **dx_leaves;\n\n\tdx_leaves = kcalloc(num_dx_leaves, sizeof(struct buffer_head *),\n\t\t\t    GFP_NOFS);\n\tif (dx_leaves && ret_num_leaves)\n\t\t*ret_num_leaves = num_dx_leaves;\n\n\treturn dx_leaves;\n}"
        }
      },
      {
        "call_info": {
          "callee": "crypto_shash_descsize",
          "args": [
            "md4"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "VFS",
            "\"%s: Crypto md4 allocation error %d\\n\"",
            "__func__",
            "rc"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "md4"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "md4"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_alloc_shash",
          "args": [
            "\"md4\"",
            "0",
            "0"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nint\nmdfour(unsigned char *md4_hash, unsigned char *link_str, int link_len)\n{\n\tint rc;\n\tunsigned int size;\n\tstruct crypto_shash *md4;\n\tstruct sdesc *sdescmd4;\n\n\tmd4 = crypto_alloc_shash(\"md4\", 0, 0);\n\tif (IS_ERR(md4)) {\n\t\trc = PTR_ERR(md4);\n\t\tcifs_dbg(VFS, \"%s: Crypto md4 allocation error %d\\n\",\n\t\t\t __func__, rc);\n\t\treturn rc;\n\t}\n\tsize = sizeof(struct shash_desc) + crypto_shash_descsize(md4);\n\tsdescmd4 = kmalloc(size, GFP_KERNEL);\n\tif (!sdescmd4) {\n\t\trc = -ENOMEM;\n\t\tgoto mdfour_err;\n\t}\n\tsdescmd4->shash.tfm = md4;\n\tsdescmd4->shash.flags = 0x0;\n\n\trc = crypto_shash_init(&sdescmd4->shash);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not init md4 shash\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_update(&sdescmd4->shash, link_str, link_len);\n\tif (rc) {\n\t\tcifs_dbg(VFS, \"%s: Could not update with link_str\\n\", __func__);\n\t\tgoto mdfour_err;\n\t}\n\trc = crypto_shash_final(&sdescmd4->shash, md4_hash);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"%s: Could not generate md4 hash\\n\", __func__);\n\nmdfour_err:\n\tcrypto_free_shash(md4);\n\tkfree(sdescmd4);\n\n\treturn rc;\n}"
  },
  {
    "function_name": "E_P24",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "116-129",
    "snippet": "static int\nE_P24(unsigned char *p21, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\n\trc = smbhash(p24, c8, p21);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 8, c8, p21 + 7);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 16, c8, p21 + 14);\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "smbhash",
          "args": [
            "p24 + 16",
            "c8",
            "p21 + 14"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "smbhash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "68-100",
          "snippet": "static int\nsmbhash(unsigned char *out, const unsigned char *in, unsigned char *key)\n{\n\tint rc;\n\tunsigned char key2[8];\n\tstruct crypto_blkcipher *tfm_des;\n\tstruct scatterlist sgin, sgout;\n\tstruct blkcipher_desc desc;\n\n\tstr_to_key(key, key2);\n\n\ttfm_des = crypto_alloc_blkcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm_des)) {\n\t\trc = PTR_ERR(tfm_des);\n\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");\n\t\tgoto smbhash_err;\n\t}\n\n\tdesc.tfm = tfm_des;\n\n\tcrypto_blkcipher_setkey(tfm_des, key2, 8);\n\n\tsg_init_one(&sgin, in, 8);\n\tsg_init_one(&sgout, out, 8);\n\n\trc = crypto_blkcipher_encrypt(&desc, &sgout, &sgin, 8);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);\n\n\tcrypto_free_blkcipher(tfm_des);\nsmbhash_err:\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nsmbhash(unsigned char *out, const unsigned char *in, unsigned char *key)\n{\n\tint rc;\n\tunsigned char key2[8];\n\tstruct crypto_blkcipher *tfm_des;\n\tstruct scatterlist sgin, sgout;\n\tstruct blkcipher_desc desc;\n\n\tstr_to_key(key, key2);\n\n\ttfm_des = crypto_alloc_blkcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm_des)) {\n\t\trc = PTR_ERR(tfm_des);\n\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");\n\t\tgoto smbhash_err;\n\t}\n\n\tdesc.tfm = tfm_des;\n\n\tcrypto_blkcipher_setkey(tfm_des, key2, 8);\n\n\tsg_init_one(&sgin, in, 8);\n\tsg_init_one(&sgout, out, 8);\n\n\trc = crypto_blkcipher_encrypt(&desc, &sgout, &sgin, 8);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);\n\n\tcrypto_free_blkcipher(tfm_des);\nsmbhash_err:\n\treturn rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nE_P24(unsigned char *p21, const unsigned char *c8, unsigned char *p24)\n{\n\tint rc;\n\n\trc = smbhash(p24, c8, p21);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 8, c8, p21 + 7);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p24 + 16, c8, p21 + 14);\n\treturn rc;\n}"
  },
  {
    "function_name": "E_P16",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "102-114",
    "snippet": "static int\nE_P16(unsigned char *p14, unsigned char *p16)\n{\n\tint rc;\n\tunsigned char sp8[8] =\n\t    { 0x4b, 0x47, 0x53, 0x21, 0x40, 0x23, 0x24, 0x25 };\n\n\trc = smbhash(p16, sp8, p14);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p16 + 8, sp8, p14 + 7);\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "smbhash",
          "args": [
            "p16 + 8",
            "sp8",
            "p14 + 7"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "smbhash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "68-100",
          "snippet": "static int\nsmbhash(unsigned char *out, const unsigned char *in, unsigned char *key)\n{\n\tint rc;\n\tunsigned char key2[8];\n\tstruct crypto_blkcipher *tfm_des;\n\tstruct scatterlist sgin, sgout;\n\tstruct blkcipher_desc desc;\n\n\tstr_to_key(key, key2);\n\n\ttfm_des = crypto_alloc_blkcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm_des)) {\n\t\trc = PTR_ERR(tfm_des);\n\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");\n\t\tgoto smbhash_err;\n\t}\n\n\tdesc.tfm = tfm_des;\n\n\tcrypto_blkcipher_setkey(tfm_des, key2, 8);\n\n\tsg_init_one(&sgin, in, 8);\n\tsg_init_one(&sgout, out, 8);\n\n\trc = crypto_blkcipher_encrypt(&desc, &sgout, &sgin, 8);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);\n\n\tcrypto_free_blkcipher(tfm_des);\nsmbhash_err:\n\treturn rc;\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nsmbhash(unsigned char *out, const unsigned char *in, unsigned char *key)\n{\n\tint rc;\n\tunsigned char key2[8];\n\tstruct crypto_blkcipher *tfm_des;\n\tstruct scatterlist sgin, sgout;\n\tstruct blkcipher_desc desc;\n\n\tstr_to_key(key, key2);\n\n\ttfm_des = crypto_alloc_blkcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm_des)) {\n\t\trc = PTR_ERR(tfm_des);\n\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");\n\t\tgoto smbhash_err;\n\t}\n\n\tdesc.tfm = tfm_des;\n\n\tcrypto_blkcipher_setkey(tfm_des, key2, 8);\n\n\tsg_init_one(&sgin, in, 8);\n\tsg_init_one(&sgout, out, 8);\n\n\trc = crypto_blkcipher_encrypt(&desc, &sgout, &sgin, 8);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);\n\n\tcrypto_free_blkcipher(tfm_des);\nsmbhash_err:\n\treturn rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nE_P16(unsigned char *p14, unsigned char *p16)\n{\n\tint rc;\n\tunsigned char sp8[8] =\n\t    { 0x4b, 0x47, 0x53, 0x21, 0x40, 0x23, 0x24, 0x25 };\n\n\trc = smbhash(p16, sp8, p14);\n\tif (rc)\n\t\treturn rc;\n\trc = smbhash(p16 + 8, sp8, p14 + 7);\n\treturn rc;\n}"
  },
  {
    "function_name": "smbhash",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "68-100",
    "snippet": "static int\nsmbhash(unsigned char *out, const unsigned char *in, unsigned char *key)\n{\n\tint rc;\n\tunsigned char key2[8];\n\tstruct crypto_blkcipher *tfm_des;\n\tstruct scatterlist sgin, sgout;\n\tstruct blkcipher_desc desc;\n\n\tstr_to_key(key, key2);\n\n\ttfm_des = crypto_alloc_blkcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm_des)) {\n\t\trc = PTR_ERR(tfm_des);\n\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");\n\t\tgoto smbhash_err;\n\t}\n\n\tdesc.tfm = tfm_des;\n\n\tcrypto_blkcipher_setkey(tfm_des, key2, 8);\n\n\tsg_init_one(&sgin, in, 8);\n\tsg_init_one(&sgout, out, 8);\n\n\trc = crypto_blkcipher_encrypt(&desc, &sgout, &sgin, 8);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);\n\n\tcrypto_free_blkcipher(tfm_des);\nsmbhash_err:\n\treturn rc;\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "crypto_free_blkcipher",
          "args": [
            "tfm_des"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "VFS",
            "\"could not encrypt crypt key rc: %d\\n\"",
            "rc"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_blkcipher_encrypt",
          "args": [
            "&desc",
            "&sgout",
            "&sgin",
            "8"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sg_init_one",
          "args": [
            "&sgout",
            "out",
            "8"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sg_init_one",
          "args": [
            "&sgin",
            "in",
            "8"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_blkcipher_setkey",
          "args": [
            "tfm_des",
            "key2",
            "8"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cifs_dbg",
          "args": [
            "VFS",
            "\"could not allocate des crypto API\\n\""
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PTR_ERR",
          "args": [
            "tfm_des"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "tfm_des"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "crypto_alloc_blkcipher",
          "args": [
            "\"ecb(des)\"",
            "0",
            "CRYPTO_ALG_ASYNC"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "str_to_key",
          "args": [
            "key",
            "key2"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "str_to_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
          "lines": "51-66",
          "snippet": "static void\nstr_to_key(unsigned char *str, unsigned char *key)\n{\n\tint i;\n\n\tkey[0] = str[0] >> 1;\n\tkey[1] = ((str[0] & 0x01) << 6) | (str[1] >> 2);\n\tkey[2] = ((str[1] & 0x03) << 5) | (str[2] >> 3);\n\tkey[3] = ((str[2] & 0x07) << 4) | (str[3] >> 4);\n\tkey[4] = ((str[3] & 0x0F) << 3) | (str[4] >> 5);\n\tkey[5] = ((str[4] & 0x1F) << 2) | (str[5] >> 6);\n\tkey[6] = ((str[5] & 0x3F) << 1) | (str[6] >> 7);\n\tkey[7] = str[6] & 0x7F;\n\tfor (i = 0; i < 8; i++)\n\t\tkey[i] = (key[i] << 1);\n}",
          "includes": [
            "#include \"cifsproto.h\"",
            "#include \"cifs_debug.h\"",
            "#include \"cifsglob.h\"",
            "#include \"cifspdu.h\"",
            "#include \"cifs_unicode.h\"",
            "#include \"cifs_fs_sb.h\"",
            "#include <linux/random.h>",
            "#include <linux/kernel.h>",
            "#include <linux/string.h>",
            "#include <linux/fs.h>",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic void\nstr_to_key(unsigned char *str, unsigned char *key)\n{\n\tint i;\n\n\tkey[0] = str[0] >> 1;\n\tkey[1] = ((str[0] & 0x01) << 6) | (str[1] >> 2);\n\tkey[2] = ((str[1] & 0x03) << 5) | (str[2] >> 3);\n\tkey[3] = ((str[2] & 0x07) << 4) | (str[3] >> 4);\n\tkey[4] = ((str[3] & 0x0F) << 3) | (str[4] >> 5);\n\tkey[5] = ((str[4] & 0x1F) << 2) | (str[5] >> 6);\n\tkey[6] = ((str[5] & 0x3F) << 1) | (str[6] >> 7);\n\tkey[7] = str[6] & 0x7F;\n\tfor (i = 0; i < 8; i++)\n\t\tkey[i] = (key[i] << 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic int\nsmbhash(unsigned char *out, const unsigned char *in, unsigned char *key)\n{\n\tint rc;\n\tunsigned char key2[8];\n\tstruct crypto_blkcipher *tfm_des;\n\tstruct scatterlist sgin, sgout;\n\tstruct blkcipher_desc desc;\n\n\tstr_to_key(key, key2);\n\n\ttfm_des = crypto_alloc_blkcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);\n\tif (IS_ERR(tfm_des)) {\n\t\trc = PTR_ERR(tfm_des);\n\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");\n\t\tgoto smbhash_err;\n\t}\n\n\tdesc.tfm = tfm_des;\n\n\tcrypto_blkcipher_setkey(tfm_des, key2, 8);\n\n\tsg_init_one(&sgin, in, 8);\n\tsg_init_one(&sgout, out, 8);\n\n\trc = crypto_blkcipher_encrypt(&desc, &sgout, &sgin, 8);\n\tif (rc)\n\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);\n\n\tcrypto_free_blkcipher(tfm_des);\nsmbhash_err:\n\treturn rc;\n}"
  },
  {
    "function_name": "str_to_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/cifs/smbencrypt.c",
    "lines": "51-66",
    "snippet": "static void\nstr_to_key(unsigned char *str, unsigned char *key)\n{\n\tint i;\n\n\tkey[0] = str[0] >> 1;\n\tkey[1] = ((str[0] & 0x01) << 6) | (str[1] >> 2);\n\tkey[2] = ((str[1] & 0x03) << 5) | (str[2] >> 3);\n\tkey[3] = ((str[2] & 0x07) << 4) | (str[3] >> 4);\n\tkey[4] = ((str[3] & 0x0F) << 3) | (str[4] >> 5);\n\tkey[5] = ((str[4] & 0x1F) << 2) | (str[5] >> 6);\n\tkey[6] = ((str[5] & 0x3F) << 1) | (str[6] >> 7);\n\tkey[7] = str[6] & 0x7F;\n\tfor (i = 0; i < 8; i++)\n\t\tkey[i] = (key[i] << 1);\n}",
    "includes": [
      "#include \"cifsproto.h\"",
      "#include \"cifs_debug.h\"",
      "#include \"cifsglob.h\"",
      "#include \"cifspdu.h\"",
      "#include \"cifs_unicode.h\"",
      "#include \"cifs_fs_sb.h\"",
      "#include <linux/random.h>",
      "#include <linux/kernel.h>",
      "#include <linux/string.h>",
      "#include <linux/fs.h>",
      "#include <linux/slab.h>",
      "#include <linux/module.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"cifsproto.h\"\n#include \"cifs_debug.h\"\n#include \"cifsglob.h\"\n#include \"cifspdu.h\"\n#include \"cifs_unicode.h\"\n#include \"cifs_fs_sb.h\"\n#include <linux/random.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/fs.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic void\nstr_to_key(unsigned char *str, unsigned char *key)\n{\n\tint i;\n\n\tkey[0] = str[0] >> 1;\n\tkey[1] = ((str[0] & 0x01) << 6) | (str[1] >> 2);\n\tkey[2] = ((str[1] & 0x03) << 5) | (str[2] >> 3);\n\tkey[3] = ((str[2] & 0x07) << 4) | (str[3] >> 4);\n\tkey[4] = ((str[3] & 0x0F) << 3) | (str[4] >> 5);\n\tkey[5] = ((str[4] & 0x1F) << 2) | (str[5] >> 6);\n\tkey[6] = ((str[5] & 0x3F) << 1) | (str[6] >> 7);\n\tkey[7] = str[6] & 0x7F;\n\tfor (i = 0; i < 8; i++)\n\t\tkey[i] = (key[i] << 1);\n}"
  }
]