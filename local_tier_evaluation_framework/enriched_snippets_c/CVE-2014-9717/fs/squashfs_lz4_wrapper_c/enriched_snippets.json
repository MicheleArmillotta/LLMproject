[
  {
    "function_name": "lz4_uncompress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/lz4_wrapper.c",
    "lines": "93-132",
    "snippet": "static int lz4_uncompress(struct squashfs_sb_info *msblk, void *strm,\n\tstruct buffer_head **bh, int b, int offset, int length,\n\tstruct squashfs_page_actor *output)\n{\n\tstruct squashfs_lz4 *stream = strm;\n\tvoid *buff = stream->input, *data;\n\tint avail, i, bytes = length, res;\n\tsize_t dest_len = output->length;\n\n\tfor (i = 0; i < b; i++) {\n\t\tavail = min(bytes, msblk->devblksize - offset);\n\t\tmemcpy(buff, bh[i]->b_data + offset, avail);\n\t\tbuff += avail;\n\t\tbytes -= avail;\n\t\toffset = 0;\n\t\tput_bh(bh[i]);\n\t}\n\n\tres = lz4_decompress_unknownoutputsize(stream->input, length,\n\t\t\t\t\tstream->output, &dest_len);\n\tif (res)\n\t\treturn -EIO;\n\n\tbytes = dest_len;\n\tdata = squashfs_first_page(output);\n\tbuff = stream->output;\n\twhile (data) {\n\t\tif (bytes <= PAGE_CACHE_SIZE) {\n\t\t\tmemcpy(data, buff, bytes);\n\t\t\tbreak;\n\t\t}\n\t\tmemcpy(data, buff, PAGE_CACHE_SIZE);\n\t\tbuff += PAGE_CACHE_SIZE;\n\t\tbytes -= PAGE_CACHE_SIZE;\n\t\tdata = squashfs_next_page(output);\n\t}\n\tsquashfs_finish_page(output);\n\n\treturn dest_len;\n}",
    "includes": [
      "#include \"page_actor.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/lz4.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/buffer_head.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "squashfs_finish_page",
          "args": [
            "output"
          ],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "squashfs_finish_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/page_actor.h",
          "lines": "76-79",
          "snippet": "static inline void squashfs_finish_page(struct squashfs_page_actor *actor)\n{\n\tactor->squashfs_finish_page(actor);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "static inline void squashfs_finish_page(struct squashfs_page_actor *actor)\n{\n\tactor->squashfs_finish_page(actor);\n}"
        }
      },
      {
        "call_info": {
          "callee": "squashfs_next_page",
          "args": [
            "output"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "squashfs_next_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/page_actor.h",
          "lines": "72-75",
          "snippet": "static inline void *squashfs_next_page(struct squashfs_page_actor *actor)\n{\n\treturn actor->squashfs_next_page(actor);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "static inline void *squashfs_next_page(struct squashfs_page_actor *actor)\n{\n\treturn actor->squashfs_next_page(actor);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "data",
            "buff",
            "PAGE_CACHE_SIZE"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "data",
            "buff",
            "bytes"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "squashfs_first_page",
          "args": [
            "output"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "squashfs_first_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/page_actor.h",
          "lines": "68-71",
          "snippet": "static inline void *squashfs_first_page(struct squashfs_page_actor *actor)\n{\n\treturn actor->squashfs_first_page(actor);\n}",
          "includes": [],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "static inline void *squashfs_first_page(struct squashfs_page_actor *actor)\n{\n\treturn actor->squashfs_first_page(actor);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lz4_decompress_unknownoutputsize",
          "args": [
            "stream->input",
            "length",
            "stream->output",
            "&dest_len"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_bh",
          "args": [
            "bh[i]"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buff",
            "bh[i]->b_data + offset",
            "avail"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "min",
          "args": [
            "bytes",
            "msblk->devblksize - offset"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "get_dominating_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/pnode.c",
          "lines": "55-66",
          "snippet": "int get_dominating_id(struct mount *mnt, const struct path *root)\n{\n\tstruct mount *m;\n\n\tfor (m = mnt->mnt_master; m != NULL; m = m->mnt_master) {\n\t\tstruct mount *d = get_peer_under_root(m, mnt->mnt_ns, root);\n\t\tif (d)\n\t\t\treturn d->mnt_group_id;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"pnode.h\"",
            "#include \"internal.h\"",
            "#include <linux/nsproxy.h>",
            "#include <linux/fs.h>",
            "#include <linux/mount.h>",
            "#include <linux/mnt_namespace.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"pnode.h\"\n#include \"internal.h\"\n#include <linux/nsproxy.h>\n#include <linux/fs.h>\n#include <linux/mount.h>\n#include <linux/mnt_namespace.h>\n\nint get_dominating_id(struct mount *mnt, const struct path *root)\n{\n\tstruct mount *m;\n\n\tfor (m = mnt->mnt_master; m != NULL; m = m->mnt_master) {\n\t\tstruct mount *d = get_peer_under_root(m, mnt->mnt_ns, root);\n\t\tif (d)\n\t\t\treturn d->mnt_group_id;\n\t}\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"page_actor.h\"\n#include \"decompressor.h\"\n#include \"squashfs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/lz4.h>\n#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/buffer_head.h>\n\nstatic int lz4_uncompress(struct squashfs_sb_info *msblk, void *strm,\n\tstruct buffer_head **bh, int b, int offset, int length,\n\tstruct squashfs_page_actor *output)\n{\n\tstruct squashfs_lz4 *stream = strm;\n\tvoid *buff = stream->input, *data;\n\tint avail, i, bytes = length, res;\n\tsize_t dest_len = output->length;\n\n\tfor (i = 0; i < b; i++) {\n\t\tavail = min(bytes, msblk->devblksize - offset);\n\t\tmemcpy(buff, bh[i]->b_data + offset, avail);\n\t\tbuff += avail;\n\t\tbytes -= avail;\n\t\toffset = 0;\n\t\tput_bh(bh[i]);\n\t}\n\n\tres = lz4_decompress_unknownoutputsize(stream->input, length,\n\t\t\t\t\tstream->output, &dest_len);\n\tif (res)\n\t\treturn -EIO;\n\n\tbytes = dest_len;\n\tdata = squashfs_first_page(output);\n\tbuff = stream->output;\n\twhile (data) {\n\t\tif (bytes <= PAGE_CACHE_SIZE) {\n\t\t\tmemcpy(data, buff, bytes);\n\t\t\tbreak;\n\t\t}\n\t\tmemcpy(data, buff, PAGE_CACHE_SIZE);\n\t\tbuff += PAGE_CACHE_SIZE;\n\t\tbytes -= PAGE_CACHE_SIZE;\n\t\tdata = squashfs_next_page(output);\n\t}\n\tsquashfs_finish_page(output);\n\n\treturn dest_len;\n}"
  },
  {
    "function_name": "lz4_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/lz4_wrapper.c",
    "lines": "81-90",
    "snippet": "static void lz4_free(void *strm)\n{\n\tstruct squashfs_lz4 *stream = strm;\n\n\tif (stream) {\n\t\tvfree(stream->input);\n\t\tvfree(stream->output);\n\t}\n\tkfree(stream);\n}",
    "includes": [
      "#include \"page_actor.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/lz4.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/buffer_head.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "stream"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vfree",
          "args": [
            "stream->output"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vfree",
          "args": [
            "stream->input"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"page_actor.h\"\n#include \"decompressor.h\"\n#include \"squashfs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/lz4.h>\n#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/buffer_head.h>\n\nstatic void lz4_free(void *strm)\n{\n\tstruct squashfs_lz4 *stream = strm;\n\n\tif (stream) {\n\t\tvfree(stream->input);\n\t\tvfree(stream->output);\n\t}\n\tkfree(stream);\n}"
  },
  {
    "function_name": "lz4_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/lz4_wrapper.c",
    "lines": "54-78",
    "snippet": "static void *lz4_init(struct squashfs_sb_info *msblk, void *buff)\n{\n\tint block_size = max_t(int, msblk->block_size, SQUASHFS_METADATA_SIZE);\n\tstruct squashfs_lz4 *stream;\n\n\tstream = kzalloc(sizeof(*stream), GFP_KERNEL);\n\tif (stream == NULL)\n\t\tgoto failed;\n\tstream->input = vmalloc(block_size);\n\tif (stream->input == NULL)\n\t\tgoto failed2;\n\tstream->output = vmalloc(block_size);\n\tif (stream->output == NULL)\n\t\tgoto failed3;\n\n\treturn stream;\n\nfailed3:\n\tvfree(stream->input);\nfailed2:\n\tkfree(stream);\nfailed:\n\tERROR(\"Failed to initialise LZ4 decompressor\\n\");\n\treturn ERR_PTR(-ENOMEM);\n}",
    "includes": [
      "#include \"page_actor.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/lz4.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/buffer_head.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-ENOMEM"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Failed to initialise LZ4 decompressor\\n\""
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "stream"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vfree",
          "args": [
            "stream->input"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmalloc",
          "args": [
            "block_size"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "ffs2_blocks_use_vmalloc(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/nodelist.h",
          "lines": "292-295",
          "snippet": "tatic inline int jffs2_blocks_use_vmalloc(struct jffs2_sb_info *c)\n{\n\treturn ((c->flash_size / c->sector_size) * sizeof (struct jffs2_eraseblock)) > (128 * 1024);\n}",
          "includes": [
            "include \"debug.h\"",
            "include \"os-linux.h\"\n#",
            "include \"os-ecos.h\"\n#",
            "include \"summary.h\"",
            "include \"acl.h\"\n#",
            "include \"xattr.h\"\n#",
            "include \"jffs2_fs_i.h\"\n#",
            "include \"jffs2_fs_sb.h\"\n#",
            "include <linux/jffs2.h>\n#",
            "include <linux/types.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"debug.h\"\ninclude \"os-linux.h\"\n#\ninclude \"os-ecos.h\"\n#\ninclude \"summary.h\"\ninclude \"acl.h\"\n#\ninclude \"xattr.h\"\n#\ninclude \"jffs2_fs_i.h\"\n#\ninclude \"jffs2_fs_sb.h\"\n#\ninclude <linux/jffs2.h>\n#\ninclude <linux/types.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic inline int jffs2_blocks_use_vmalloc(struct jffs2_sb_info *c)\n{\n\treturn ((c->flash_size / c->sector_size) * sizeof (struct jffs2_eraseblock)) > (128 * 1024);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "sizeof(*stream)",
            "GFP_KERNEL"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "max_t",
          "args": [
            "int",
            "msblk->block_size",
            "SQUASHFS_METADATA_SIZE"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"page_actor.h\"\n#include \"decompressor.h\"\n#include \"squashfs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/lz4.h>\n#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/buffer_head.h>\n\nstatic void *lz4_init(struct squashfs_sb_info *msblk, void *buff)\n{\n\tint block_size = max_t(int, msblk->block_size, SQUASHFS_METADATA_SIZE);\n\tstruct squashfs_lz4 *stream;\n\n\tstream = kzalloc(sizeof(*stream), GFP_KERNEL);\n\tif (stream == NULL)\n\t\tgoto failed;\n\tstream->input = vmalloc(block_size);\n\tif (stream->input == NULL)\n\t\tgoto failed2;\n\tstream->output = vmalloc(block_size);\n\tif (stream->output == NULL)\n\t\tgoto failed3;\n\n\treturn stream;\n\nfailed3:\n\tvfree(stream->input);\nfailed2:\n\tkfree(stream);\nfailed:\n\tERROR(\"Failed to initialise LZ4 decompressor\\n\");\n\treturn ERR_PTR(-ENOMEM);\n}"
  },
  {
    "function_name": "lz4_comp_opts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/squashfs/lz4_wrapper.c",
    "lines": "34-51",
    "snippet": "static void *lz4_comp_opts(struct squashfs_sb_info *msblk,\n\tvoid *buff, int len)\n{\n\tstruct lz4_comp_opts *comp_opts = buff;\n\n\t/* LZ4 compressed filesystems always have compression options */\n\tif (comp_opts == NULL || len < sizeof(*comp_opts))\n\t\treturn ERR_PTR(-EIO);\n\n\tif (le32_to_cpu(comp_opts->version) != LZ4_LEGACY) {\n\t\t/* LZ4 format currently used by the kernel is the 'legacy'\n\t\t * format */\n\t\tERROR(\"Unknown LZ4 version\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"page_actor.h\"",
      "#include \"decompressor.h\"",
      "#include \"squashfs.h\"",
      "#include \"squashfs_fs_sb.h\"",
      "#include \"squashfs_fs.h\"",
      "#include <linux/lz4.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/slab.h>",
      "#include <linux/mutex.h>",
      "#include <linux/buffer_head.h>"
    ],
    "macros_used": [
      "#define LZ4_LEGACY\t1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EINVAL"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERROR",
          "args": [
            "\"Unknown LZ4 version\\n\""
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le32_to_cpu",
          "args": [
            "comp_opts->version"
          ],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "sle32_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "53-56",
          "snippet": "static inline s32 sle32_to_cpup(sle32 *x)\n{\n\treturn le32_to_cpu(*(__force le32*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s32 sle32_to_cpup(sle32 *x)\n{\n\treturn le32_to_cpu(*(__force le32*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EIO"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"page_actor.h\"\n#include \"decompressor.h\"\n#include \"squashfs.h\"\n#include \"squashfs_fs_sb.h\"\n#include \"squashfs_fs.h\"\n#include <linux/lz4.h>\n#include <linux/vmalloc.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/buffer_head.h>\n\n#define LZ4_LEGACY\t1\n\nstatic void *lz4_comp_opts(struct squashfs_sb_info *msblk,\n\tvoid *buff, int len)\n{\n\tstruct lz4_comp_opts *comp_opts = buff;\n\n\t/* LZ4 compressed filesystems always have compression options */\n\tif (comp_opts == NULL || len < sizeof(*comp_opts))\n\t\treturn ERR_PTR(-EIO);\n\n\tif (le32_to_cpu(comp_opts->version) != LZ4_LEGACY) {\n\t\t/* LZ4 format currently used by the kernel is the 'legacy'\n\t\t * format */\n\t\tERROR(\"Unknown LZ4 version\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\treturn NULL;\n}"
  }
]