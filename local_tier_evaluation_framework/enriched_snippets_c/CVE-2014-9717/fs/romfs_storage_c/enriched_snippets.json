[
  {
    "function_name": "omfs_dev_strcmp(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "271-293",
    "snippet": "nt romfs_dev_strcmp(struct super_block *sb, unsigned long pos,\n\t\t     const char *str, size_t size)\n{\n\tsize_t limit;\n\n\tlimit = romfs_maxsize(sb);\n\tif (pos >= limit)\n\t\treturn -EIO;\n\tif (size > ROMFS_MAXFN)\n\t\treturn -ENAMETOOLONG;\n\tif (size + 1 > limit - pos)\n\t\treturn -EIO;\n\n#ifdef CONFIG_ROMFS_ON_MTD\n\tif (sb->s_mtd)\n\t\treturn romfs_mtd_strcmp(sb, pos, str, size);\n#endif\n#ifdef CONFIG_ROMFS_ON_BLOCK\n\tif (sb->s_bdev)\n\t\treturn romfs_blk_strcmp(sb, pos, str, size);\n#endif\n\treturn -EIO;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "omfs_blk_strcmp(",
          "args": [
            "b,",
            "os,",
            "tr,",
            "ize)"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_blk_strcmp(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
          "lines": "167-212",
          "snippet": "tatic int romfs_blk_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\tbool matched, terminated = false;\n\n\t/* compare string up to a block at a time */\n\twhile (size > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, size, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = (memcmp(bh->b_data + offset, str, segment) == 0);\n\n\t\tsize -= segment;\n\t\tpos += segment;\n\t\tstr += segment;\n\t\tif (matched && size == 0 && offset + segment < ROMBSIZE) {\n\t\t\tif (!bh->b_data[offset + segment])\n\t\t\t\tterminated = true;\n\t\t\telse\n\t\t\t\tmatched = false;\n\t\t}\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\tif (!terminated) {\n\t\t/* the terminating NUL must be on the first byte of the next\n\t\t * block */\n\t\tBUG_ON((pos & (ROMBSIZE - 1)) != 0);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = !bh->b_data[0];\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\treturn 1;\n}",
          "includes": [
            "include \"internal.h\"",
            "include <linux/buffer_head.h>\n#",
            "include <linux/mtd/super.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_blk_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\tbool matched, terminated = false;\n\n\t/* compare string up to a block at a time */\n\twhile (size > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, size, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = (memcmp(bh->b_data + offset, str, segment) == 0);\n\n\t\tsize -= segment;\n\t\tpos += segment;\n\t\tstr += segment;\n\t\tif (matched && size == 0 && offset + segment < ROMBSIZE) {\n\t\t\tif (!bh->b_data[offset + segment])\n\t\t\t\tterminated = true;\n\t\t\telse\n\t\t\t\tmatched = false;\n\t\t}\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\tif (!terminated) {\n\t\t/* the terminating NUL must be on the first byte of the next\n\t\t * block */\n\t\tBUG_ON((pos & (ROMBSIZE - 1)) != 0);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = !bh->b_data[0];\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "omfs_mtd_strcmp(",
          "args": [
            "b,",
            "os,",
            "tr,",
            "ize)"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_mtd_strcmp(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
          "lines": "70-100",
          "snippet": "tatic int romfs_mtd_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tu_char buf[17];\n\tsize_t len, segment;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time, and attempt to grab the\n\t * trailing NUL whilst we're at it */\n\tbuf[0] = 0xff;\n\n\twhile (size > 0) {\n\t\tsegment = min_t(size_t, size + 1, 17);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tlen--;\n\t\tif (memcmp(buf, str, len) != 0)\n\t\t\treturn 0;\n\t\tbuf[0] = buf[len];\n\t\tsize -= len;\n\t\tpos += len;\n\t\tstr += len;\n\t}\n\n\t/* check the trailing NUL was */\n\tif (buf[0])\n\t\treturn 0;\n\n\treturn 1;\n}",
          "includes": [
            "include \"internal.h\"",
            "include <linux/buffer_head.h>\n#",
            "include <linux/mtd/super.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_mtd_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tu_char buf[17];\n\tsize_t len, segment;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time, and attempt to grab the\n\t * trailing NUL whilst we're at it */\n\tbuf[0] = 0xff;\n\n\twhile (size > 0) {\n\t\tsegment = min_t(size_t, size + 1, 17);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tlen--;\n\t\tif (memcmp(buf, str, len) != 0)\n\t\t\treturn 0;\n\t\tbuf[0] = buf[len];\n\t\tsize -= len;\n\t\tpos += len;\n\t\tstr += len;\n\t}\n\n\t/* check the trailing NUL was */\n\tif (buf[0])\n\t\treturn 0;\n\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "omfs_maxsize(",
          "args": [
            "b)"
          ],
          "line": 276
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_maxsize(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/internal.h",
          "lines": "20-23",
          "snippet": "tatic inline size_t romfs_maxsize(struct super_block *sb)\n{\n\treturn (size_t) (unsigned long) sb->s_fs_info;\n}",
          "includes": [
            "include <linux/romfs_fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include <linux/romfs_fs.h>\n\ntatic inline size_t romfs_maxsize(struct super_block *sb)\n{\n\treturn (size_t) (unsigned long) sb->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\nnt romfs_dev_strcmp(struct super_block *sb, unsigned long pos,\n\t\t     const char *str, size_t size)\n{\n\tsize_t limit;\n\n\tlimit = romfs_maxsize(sb);\n\tif (pos >= limit)\n\t\treturn -EIO;\n\tif (size > ROMFS_MAXFN)\n\t\treturn -ENAMETOOLONG;\n\tif (size + 1 > limit - pos)\n\t\treturn -EIO;\n\n#ifdef CONFIG_ROMFS_ON_MTD\n\tif (sb->s_mtd)\n\t\treturn romfs_mtd_strcmp(sb, pos, str, size);\n#endif\n#ifdef CONFIG_ROMFS_ON_BLOCK\n\tif (sb->s_bdev)\n\t\treturn romfs_blk_strcmp(sb, pos, str, size);\n#endif\n\treturn -EIO;\n}"
  },
  {
    "function_name": "omfs_dev_strnlen(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "243-263",
    "snippet": "size_t romfs_dev_strnlen(struct super_block *sb,\n\t\t\t  unsigned long pos, size_t maxlen)\n{\n\tsize_t limit;\n\n\tlimit = romfs_maxsize(sb);\n\tif (pos >= limit)\n\t\treturn -EIO;\n\tif (maxlen > limit - pos)\n\t\tmaxlen = limit - pos;\n\n#ifdef CONFIG_ROMFS_ON_MTD\n\tif (sb->s_mtd)\n\t\treturn romfs_mtd_strnlen(sb, pos, maxlen);\n#endif\n#ifdef CONFIG_ROMFS_ON_BLOCK\n\tif (sb->s_bdev)\n\t\treturn romfs_blk_strnlen(sb, pos, maxlen);\n#endif\n\treturn -EIO;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "omfs_blk_strnlen(",
          "args": [
            "b,",
            "os,",
            "axlen)"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_blk_strnlen(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
          "lines": "134-161",
          "snippet": "tatic ssize_t romfs_blk_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t limit)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char *buf, *p;\n\n\t/* scan the string up to blocksize bytes at a time */\n\twhile (limit > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, limit, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tbuf = bh->b_data + offset;\n\t\tp = memchr(buf, 0, segment);\n\t\tbrelse(bh);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tlimit -= segment;\n\t\tpos += segment;\n\t\tn += segment;\n\t}\n\n\treturn n;\n}",
          "includes": [
            "include \"internal.h\"",
            "include <linux/buffer_head.h>\n#",
            "include <linux/mtd/super.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic ssize_t romfs_blk_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t limit)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char *buf, *p;\n\n\t/* scan the string up to blocksize bytes at a time */\n\twhile (limit > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, limit, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tbuf = bh->b_data + offset;\n\t\tp = memchr(buf, 0, segment);\n\t\tbrelse(bh);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tlimit -= segment;\n\t\tpos += segment;\n\t\tn += segment;\n\t}\n\n\treturn n;\n}"
        }
      },
      {
        "call_info": {
          "callee": "omfs_mtd_strnlen(",
          "args": [
            "b,",
            "os,",
            "axlen)"
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_mtd_strnlen(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
          "lines": "40-64",
          "snippet": "tatic ssize_t romfs_mtd_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t maxlen)\n{\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char buf[16], *p;\n\tsize_t len;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time */\n\twhile (maxlen > 0) {\n\t\tsegment = min_t(size_t, maxlen, 16);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tp = memchr(buf, 0, len);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tmaxlen -= len;\n\t\tpos += len;\n\t\tn += len;\n\t}\n\n\treturn n;\n}",
          "includes": [
            "include \"internal.h\"",
            "include <linux/buffer_head.h>\n#",
            "include <linux/mtd/super.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic ssize_t romfs_mtd_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t maxlen)\n{\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char buf[16], *p;\n\tsize_t len;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time */\n\twhile (maxlen > 0) {\n\t\tsegment = min_t(size_t, maxlen, 16);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tp = memchr(buf, 0, len);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tmaxlen -= len;\n\t\tpos += len;\n\t\tn += len;\n\t}\n\n\treturn n;\n}"
        }
      },
      {
        "call_info": {
          "callee": "omfs_maxsize(",
          "args": [
            "b)"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_maxsize(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/internal.h",
          "lines": "20-23",
          "snippet": "tatic inline size_t romfs_maxsize(struct super_block *sb)\n{\n\treturn (size_t) (unsigned long) sb->s_fs_info;\n}",
          "includes": [
            "include <linux/romfs_fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include <linux/romfs_fs.h>\n\ntatic inline size_t romfs_maxsize(struct super_block *sb)\n{\n\treturn (size_t) (unsigned long) sb->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\nsize_t romfs_dev_strnlen(struct super_block *sb,\n\t\t\t  unsigned long pos, size_t maxlen)\n{\n\tsize_t limit;\n\n\tlimit = romfs_maxsize(sb);\n\tif (pos >= limit)\n\t\treturn -EIO;\n\tif (maxlen > limit - pos)\n\t\tmaxlen = limit - pos;\n\n#ifdef CONFIG_ROMFS_ON_MTD\n\tif (sb->s_mtd)\n\t\treturn romfs_mtd_strnlen(sb, pos, maxlen);\n#endif\n#ifdef CONFIG_ROMFS_ON_BLOCK\n\tif (sb->s_bdev)\n\t\treturn romfs_blk_strnlen(sb, pos, maxlen);\n#endif\n\treturn -EIO;\n}"
  },
  {
    "function_name": "omfs_dev_read(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "218-238",
    "snippet": "nt romfs_dev_read(struct super_block *sb, unsigned long pos,\n\t\t   void *buf, size_t buflen)\n{\n\tsize_t limit;\n\n\tlimit = romfs_maxsize(sb);\n\tif (pos >= limit)\n\t\treturn -EIO;\n\tif (buflen > limit - pos)\n\t\tbuflen = limit - pos;\n\n#ifdef CONFIG_ROMFS_ON_MTD\n\tif (sb->s_mtd)\n\t\treturn romfs_mtd_read(sb, pos, buf, buflen);\n#endif\n#ifdef CONFIG_ROMFS_ON_BLOCK\n\tif (sb->s_bdev)\n\t\treturn romfs_blk_read(sb, pos, buf, buflen);\n#endif\n\treturn -EIO;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "omfs_blk_read(",
          "args": [
            "b,",
            "os,",
            "uf,",
            "uflen)"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_blk_read(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
          "lines": "107-129",
          "snippet": "tatic int romfs_blk_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\n\t/* copy the string up to blocksize bytes at a time */\n\twhile (buflen > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, buflen, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmemcpy(buf, bh->b_data + offset, segment);\n\t\tbrelse(bh);\n\t\tbuf += segment;\n\t\tbuflen -= segment;\n\t\tpos += segment;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "include \"internal.h\"",
            "include <linux/buffer_head.h>\n#",
            "include <linux/mtd/super.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_blk_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\n\t/* copy the string up to blocksize bytes at a time */\n\twhile (buflen > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, buflen, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmemcpy(buf, bh->b_data + offset, segment);\n\t\tbrelse(bh);\n\t\tbuf += segment;\n\t\tbuflen -= segment;\n\t\tpos += segment;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "omfs_mtd_read(",
          "args": [
            "b,",
            "os,",
            "uf,",
            "uflen)"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_mtd_read(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
          "lines": "27-35",
          "snippet": "tatic int romfs_mtd_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tsize_t rlen;\n\tint ret;\n\n\tret = ROMFS_MTD_READ(sb, pos, buflen, &rlen, buf);\n\treturn (ret < 0 || rlen != buflen) ? -EIO : 0;\n}",
          "includes": [
            "include \"internal.h\"",
            "include <linux/buffer_head.h>\n#",
            "include <linux/mtd/super.h>\n#",
            "include <linux/fs.h>\n#"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_mtd_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tsize_t rlen;\n\tint ret;\n\n\tret = ROMFS_MTD_READ(sb, pos, buflen, &rlen, buf);\n\treturn (ret < 0 || rlen != buflen) ? -EIO : 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "omfs_maxsize(",
          "args": [
            "b)"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "omfs_maxsize(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/internal.h",
          "lines": "20-23",
          "snippet": "tatic inline size_t romfs_maxsize(struct super_block *sb)\n{\n\treturn (size_t) (unsigned long) sb->s_fs_info;\n}",
          "includes": [
            "include <linux/romfs_fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include <linux/romfs_fs.h>\n\ntatic inline size_t romfs_maxsize(struct super_block *sb)\n{\n\treturn (size_t) (unsigned long) sb->s_fs_info;\n}"
        }
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\nnt romfs_dev_read(struct super_block *sb, unsigned long pos,\n\t\t   void *buf, size_t buflen)\n{\n\tsize_t limit;\n\n\tlimit = romfs_maxsize(sb);\n\tif (pos >= limit)\n\t\treturn -EIO;\n\tif (buflen > limit - pos)\n\t\tbuflen = limit - pos;\n\n#ifdef CONFIG_ROMFS_ON_MTD\n\tif (sb->s_mtd)\n\t\treturn romfs_mtd_read(sb, pos, buf, buflen);\n#endif\n#ifdef CONFIG_ROMFS_ON_BLOCK\n\tif (sb->s_bdev)\n\t\treturn romfs_blk_read(sb, pos, buf, buflen);\n#endif\n\treturn -EIO;\n}"
  },
  {
    "function_name": "omfs_blk_strcmp(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "167-212",
    "snippet": "tatic int romfs_blk_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\tbool matched, terminated = false;\n\n\t/* compare string up to a block at a time */\n\twhile (size > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, size, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = (memcmp(bh->b_data + offset, str, segment) == 0);\n\n\t\tsize -= segment;\n\t\tpos += segment;\n\t\tstr += segment;\n\t\tif (matched && size == 0 && offset + segment < ROMBSIZE) {\n\t\t\tif (!bh->b_data[offset + segment])\n\t\t\t\tterminated = true;\n\t\t\telse\n\t\t\t\tmatched = false;\n\t\t}\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\tif (!terminated) {\n\t\t/* the terminating NUL must be on the first byte of the next\n\t\t * block */\n\t\tBUG_ON((pos & (ROMBSIZE - 1)) != 0);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = !bh->b_data[0];\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\treturn 1;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "relse(",
          "args": [
            "h)"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "b_bread(",
          "args": [
            "b,",
            "os >> ROMBSBITS)"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UG_ON(",
          "args": [
            "pos & (ROMBSIZE - 1)) != 0)"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "relse(",
          "args": [
            "h)"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcmp(",
          "args": [
            "h->b_data + offset,",
            "tr,",
            "egment)"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "b_bread(",
          "args": [
            "b,",
            "os >> ROMBSBITS)"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "ize_t,",
            "ize,",
            "OMBSIZE - offset)"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_blk_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\tbool matched, terminated = false;\n\n\t/* compare string up to a block at a time */\n\twhile (size > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, size, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = (memcmp(bh->b_data + offset, str, segment) == 0);\n\n\t\tsize -= segment;\n\t\tpos += segment;\n\t\tstr += segment;\n\t\tif (matched && size == 0 && offset + segment < ROMBSIZE) {\n\t\t\tif (!bh->b_data[offset + segment])\n\t\t\t\tterminated = true;\n\t\t\telse\n\t\t\t\tmatched = false;\n\t\t}\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\tif (!terminated) {\n\t\t/* the terminating NUL must be on the first byte of the next\n\t\t * block */\n\t\tBUG_ON((pos & (ROMBSIZE - 1)) != 0);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmatched = !bh->b_data[0];\n\t\tbrelse(bh);\n\t\tif (!matched)\n\t\t\treturn 0;\n\t}\n\n\treturn 1;\n}"
  },
  {
    "function_name": "omfs_blk_strnlen(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "134-161",
    "snippet": "tatic ssize_t romfs_blk_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t limit)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char *buf, *p;\n\n\t/* scan the string up to blocksize bytes at a time */\n\twhile (limit > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, limit, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tbuf = bh->b_data + offset;\n\t\tp = memchr(buf, 0, segment);\n\t\tbrelse(bh);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tlimit -= segment;\n\t\tpos += segment;\n\t\tn += segment;\n\t}\n\n\treturn n;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "relse(",
          "args": [
            "h)"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emchr(",
          "args": [
            "uf,",
            ",",
            "egment)"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "b_bread(",
          "args": [
            "b,",
            "os >> ROMBSBITS)"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "ize_t,",
            "imit,",
            "OMBSIZE - offset)"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic ssize_t romfs_blk_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t limit)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char *buf, *p;\n\n\t/* scan the string up to blocksize bytes at a time */\n\twhile (limit > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, limit, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tbuf = bh->b_data + offset;\n\t\tp = memchr(buf, 0, segment);\n\t\tbrelse(bh);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tlimit -= segment;\n\t\tpos += segment;\n\t\tn += segment;\n\t}\n\n\treturn n;\n}"
  },
  {
    "function_name": "omfs_blk_read(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "107-129",
    "snippet": "tatic int romfs_blk_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\n\t/* copy the string up to blocksize bytes at a time */\n\twhile (buflen > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, buflen, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmemcpy(buf, bh->b_data + offset, segment);\n\t\tbrelse(bh);\n\t\tbuf += segment;\n\t\tbuflen -= segment;\n\t\tpos += segment;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "relse(",
          "args": [
            "h)"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emcpy(",
          "args": [
            "uf,",
            "h->b_data + offset,",
            "egment)"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "b_bread(",
          "args": [
            "b,",
            "os >> ROMBSBITS)"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "ize_t,",
            "uflen,",
            "OMBSIZE - offset)"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_blk_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tstruct buffer_head *bh;\n\tunsigned long offset;\n\tsize_t segment;\n\n\t/* copy the string up to blocksize bytes at a time */\n\twhile (buflen > 0) {\n\t\toffset = pos & (ROMBSIZE - 1);\n\t\tsegment = min_t(size_t, buflen, ROMBSIZE - offset);\n\t\tbh = sb_bread(sb, pos >> ROMBSBITS);\n\t\tif (!bh)\n\t\t\treturn -EIO;\n\t\tmemcpy(buf, bh->b_data + offset, segment);\n\t\tbrelse(bh);\n\t\tbuf += segment;\n\t\tbuflen -= segment;\n\t\tpos += segment;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "omfs_mtd_strcmp(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "70-100",
    "snippet": "tatic int romfs_mtd_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tu_char buf[17];\n\tsize_t len, segment;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time, and attempt to grab the\n\t * trailing NUL whilst we're at it */\n\tbuf[0] = 0xff;\n\n\twhile (size > 0) {\n\t\tsegment = min_t(size_t, size + 1, 17);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tlen--;\n\t\tif (memcmp(buf, str, len) != 0)\n\t\t\treturn 0;\n\t\tbuf[0] = buf[len];\n\t\tsize -= len;\n\t\tpos += len;\n\t\tstr += len;\n\t}\n\n\t/* check the trailing NUL was */\n\tif (buf[0])\n\t\treturn 0;\n\n\treturn 1;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "emcmp(",
          "args": [
            "uf,",
            "tr,",
            "en)"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OMFS_MTD_READ(",
          "args": [
            "b,",
            "os,",
            "egment,",
            "len,",
            "uf)"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "ize_t,",
            "ize + 1,",
            "7)"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_mtd_strcmp(struct super_block *sb, unsigned long pos,\n\t\t\t    const char *str, size_t size)\n{\n\tu_char buf[17];\n\tsize_t len, segment;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time, and attempt to grab the\n\t * trailing NUL whilst we're at it */\n\tbuf[0] = 0xff;\n\n\twhile (size > 0) {\n\t\tsegment = min_t(size_t, size + 1, 17);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tlen--;\n\t\tif (memcmp(buf, str, len) != 0)\n\t\t\treturn 0;\n\t\tbuf[0] = buf[len];\n\t\tsize -= len;\n\t\tpos += len;\n\t\tstr += len;\n\t}\n\n\t/* check the trailing NUL was */\n\tif (buf[0])\n\t\treturn 0;\n\n\treturn 1;\n}"
  },
  {
    "function_name": "omfs_mtd_strnlen(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "40-64",
    "snippet": "tatic ssize_t romfs_mtd_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t maxlen)\n{\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char buf[16], *p;\n\tsize_t len;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time */\n\twhile (maxlen > 0) {\n\t\tsegment = min_t(size_t, maxlen, 16);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tp = memchr(buf, 0, len);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tmaxlen -= len;\n\t\tpos += len;\n\t\tn += len;\n\t}\n\n\treturn n;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "emchr(",
          "args": [
            "uf,",
            ",",
            "en)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OMFS_MTD_READ(",
          "args": [
            "b,",
            "os,",
            "egment,",
            "len,",
            "uf)"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_t(",
          "args": [
            "ize_t,",
            "axlen,",
            "6)"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic ssize_t romfs_mtd_strnlen(struct super_block *sb,\n\t\t\t\t unsigned long pos, size_t maxlen)\n{\n\tssize_t n = 0;\n\tsize_t segment;\n\tu_char buf[16], *p;\n\tsize_t len;\n\tint ret;\n\n\t/* scan the string up to 16 bytes at a time */\n\twhile (maxlen > 0) {\n\t\tsegment = min_t(size_t, maxlen, 16);\n\t\tret = ROMFS_MTD_READ(sb, pos, segment, &len, buf);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tp = memchr(buf, 0, len);\n\t\tif (p)\n\t\t\treturn n + (p - buf);\n\t\tmaxlen -= len;\n\t\tpos += len;\n\t\tn += len;\n\t}\n\n\treturn n;\n}"
  },
  {
    "function_name": "omfs_mtd_read(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/storage.c",
    "lines": "27-35",
    "snippet": "tatic int romfs_mtd_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tsize_t rlen;\n\tint ret;\n\n\tret = ROMFS_MTD_READ(sb, pos, buflen, &rlen, buf);\n\treturn (ret < 0 || rlen != buflen) ? -EIO : 0;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/buffer_head.h>\n#",
      "include <linux/mtd/super.h>\n#",
      "include <linux/fs.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "OMFS_MTD_READ(",
          "args": [
            "b,",
            "os,",
            "uflen,",
            "rlen,",
            "uf)"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/buffer_head.h>\n#\ninclude <linux/mtd/super.h>\n#\ninclude <linux/fs.h>\n#\n\ntatic int romfs_mtd_read(struct super_block *sb, unsigned long pos,\n\t\t\t  void *buf, size_t buflen)\n{\n\tsize_t rlen;\n\tint ret;\n\n\tret = ROMFS_MTD_READ(sb, pos, buflen, &rlen, buf);\n\treturn (ret < 0 || rlen != buflen) ? -EIO : 0;\n}"
  }
]