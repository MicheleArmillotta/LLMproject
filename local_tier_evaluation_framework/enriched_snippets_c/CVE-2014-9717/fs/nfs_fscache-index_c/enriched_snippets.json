[
  {
    "function_name": "nfs_fh_put_context",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "311-315",
    "snippet": "static void nfs_fh_put_context(void *cookie_netfs_data, void *context)\n{\n\tif (context)\n\t\tput_nfs_open_context(context);\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "put_nfs_open_context",
          "args": [
            "context"
          ],
          "line": 314
        },
        "resolved": true,
        "details": {
          "function_name": "put_nfs_open_context",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/inode.c",
          "lines": "833-836",
          "snippet": "void put_nfs_open_context(struct nfs_open_context *ctx)\n{\n\t__put_nfs_open_context(ctx, 0);\n}",
          "includes": [
            "#include \"nfstrace.h\"",
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/freezer.h>",
            "#include <linux/compat.h>",
            "#include <linux/slab.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfstrace.h\"\n#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <asm/uaccess.h>\n#include <linux/freezer.h>\n#include <linux/compat.h>\n#include <linux/slab.h>\n#include <linux/nfs_xdr.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nvoid put_nfs_open_context(struct nfs_open_context *ctx)\n{\n\t__put_nfs_open_context(ctx, 0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic void nfs_fh_put_context(void *cookie_netfs_data, void *context)\n{\n\tif (context)\n\t\tput_nfs_open_context(context);\n}"
  },
  {
    "function_name": "nfs_fh_get_context",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "301-304",
    "snippet": "static void nfs_fh_get_context(void *cookie_netfs_data, void *context)\n{\n\tget_nfs_open_context(context);\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_nfs_open_context",
          "args": [
            "context"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "get_nfs_open_context",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/inode.c",
          "lines": "803-808",
          "snippet": "struct nfs_open_context *get_nfs_open_context(struct nfs_open_context *ctx)\n{\n\tif (ctx != NULL)\n\t\tatomic_inc(&ctx->lock_context.count);\n\treturn ctx;\n}",
          "includes": [
            "#include \"nfstrace.h\"",
            "#include \"netns.h\"",
            "#include \"nfs.h\"",
            "#include \"pnfs.h\"",
            "#include \"fscache.h\"",
            "#include \"internal.h\"",
            "#include \"iostat.h\"",
            "#include \"delegation.h\"",
            "#include \"callback.h\"",
            "#include \"nfs4_fs.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/freezer.h>",
            "#include <linux/compat.h>",
            "#include <linux/slab.h>",
            "#include <linux/nfs_xdr.h>",
            "#include <linux/inet.h>",
            "#include <linux/vfs.h>",
            "#include <linux/mount.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/lockd/bind.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/nfs_mount.h>",
            "#include <linux/nfs_fs.h>",
            "#include <linux/sunrpc/metrics.h>",
            "#include <linux/sunrpc/stats.h>",
            "#include <linux/sunrpc/clnt.h>",
            "#include <linux/unistd.h>",
            "#include <linux/errno.h>",
            "#include <linux/stat.h>",
            "#include <linux/string.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/time.h>",
            "#include <linux/sched.h>",
            "#include <linux/init.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"nfstrace.h\"\n#include \"netns.h\"\n#include \"nfs.h\"\n#include \"pnfs.h\"\n#include \"fscache.h\"\n#include \"internal.h\"\n#include \"iostat.h\"\n#include \"delegation.h\"\n#include \"callback.h\"\n#include \"nfs4_fs.h\"\n#include <asm/uaccess.h>\n#include <linux/freezer.h>\n#include <linux/compat.h>\n#include <linux/slab.h>\n#include <linux/nfs_xdr.h>\n#include <linux/inet.h>\n#include <linux/vfs.h>\n#include <linux/mount.h>\n#include <linux/seq_file.h>\n#include <linux/lockd/bind.h>\n#include <linux/nfs4_mount.h>\n#include <linux/nfs_mount.h>\n#include <linux/nfs_fs.h>\n#include <linux/sunrpc/metrics.h>\n#include <linux/sunrpc/stats.h>\n#include <linux/sunrpc/clnt.h>\n#include <linux/unistd.h>\n#include <linux/errno.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <linux/sched.h>\n#include <linux/init.h>\n#include <linux/module.h>\n\nstruct nfs_open_context *get_nfs_open_context(struct nfs_open_context *ctx)\n{\n\tif (ctx != NULL)\n\t\tatomic_inc(&ctx->lock_context.count);\n\treturn ctx;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic void nfs_fh_get_context(void *cookie_netfs_data, void *context)\n{\n\tget_nfs_open_context(context);\n}"
  },
  {
    "function_name": "nfs_fscache_inode_now_uncached",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "261-291",
    "snippet": "static void nfs_fscache_inode_now_uncached(void *cookie_netfs_data)\n{\n\tstruct nfs_inode *nfsi = cookie_netfs_data;\n\tstruct pagevec pvec;\n\tpgoff_t first;\n\tint loop, nr_pages;\n\n\tpagevec_init(&pvec, 0);\n\tfirst = 0;\n\n\tdprintk(\"NFS: nfs_inode_now_uncached: nfs_inode 0x%p\\n\", nfsi);\n\n\tfor (;;) {\n\t\t/* grab a bunch of pages to unmark */\n\t\tnr_pages = pagevec_lookup(&pvec,\n\t\t\t\t\t  nfsi->vfs_inode.i_mapping,\n\t\t\t\t\t  first,\n\t\t\t\t\t  PAGEVEC_SIZE - pagevec_count(&pvec));\n\t\tif (!nr_pages)\n\t\t\tbreak;\n\n\t\tfor (loop = 0; loop < nr_pages; loop++)\n\t\t\tClearPageFsCache(pvec.pages[loop]);\n\n\t\tfirst = pvec.pages[nr_pages - 1]->index + 1;\n\n\t\tpvec.nr = nr_pages;\n\t\tpagevec_release(&pvec);\n\t\tcond_resched();\n\t}\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cond_resched",
          "args": [],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagevec_release",
          "args": [
            "&pvec"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "huge_pagevec_release",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/hugetlbfs/inode.c",
          "lines": "84-92",
          "snippet": "static void huge_pagevec_release(struct pagevec *pvec)\n{\n\tint i;\n\n\tfor (i = 0; i < pagevec_count(pvec); ++i)\n\t\tput_page(pvec->pages[i]);\n\n\tpagevec_reinit(pvec);\n}",
          "includes": [
            "#include <asm/uaccess.h>",
            "#include <linux/migrate.h>",
            "#include <linux/magic.h>",
            "#include <linux/security.h>",
            "#include <linux/statfs.h>",
            "#include <linux/dnotify.h>",
            "#include <linux/slab.h>",
            "#include <linux/mman.h>",
            "#include <linux/parser.h>",
            "#include <linux/pagevec.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/ctype.h>",
            "#include <linux/capability.h>",
            "#include <linux/string.h>",
            "#include <linux/init.h>",
            "#include <linux/highmem.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/writeback.h>",
            "#include <linux/kernel.h>",
            "#include <linux/file.h>",
            "#include <linux/mount.h>",
            "#include <linux/fs.h>",
            "#include <linux/sched.h>\t\t/* remove ASAP */",
            "#include <asm/current.h>",
            "#include <linux/thread_info.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/uaccess.h>\n#include <linux/migrate.h>\n#include <linux/magic.h>\n#include <linux/security.h>\n#include <linux/statfs.h>\n#include <linux/dnotify.h>\n#include <linux/slab.h>\n#include <linux/mman.h>\n#include <linux/parser.h>\n#include <linux/pagevec.h>\n#include <linux/hugetlb.h>\n#include <linux/backing-dev.h>\n#include <linux/ctype.h>\n#include <linux/capability.h>\n#include <linux/string.h>\n#include <linux/init.h>\n#include <linux/highmem.h>\n#include <linux/pagemap.h>\n#include <linux/writeback.h>\n#include <linux/kernel.h>\n#include <linux/file.h>\n#include <linux/mount.h>\n#include <linux/fs.h>\n#include <linux/sched.h>\t\t/* remove ASAP */\n#include <asm/current.h>\n#include <linux/thread_info.h>\n#include <linux/module.h>\n\nstatic void huge_pagevec_release(struct pagevec *pvec)\n{\n\tint i;\n\n\tfor (i = 0; i < pagevec_count(pvec); ++i)\n\t\tput_page(pvec->pages[i]);\n\n\tpagevec_reinit(pvec);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ClearPageFsCache",
          "args": [
            "pvec.pages[loop]"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagevec_lookup",
          "args": [
            "&pvec",
            "nfsi->vfs_inode.i_mapping",
            "first",
            "PAGEVEC_SIZE - pagevec_count(&pvec)"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagevec_count",
          "args": [
            "&pvec"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dprintk",
          "args": [
            "\"NFS: nfs_inode_now_uncached: nfs_inode 0x%p\\n\"",
            "nfsi"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagevec_init",
          "args": [
            "&pvec",
            "0"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic void nfs_fscache_inode_now_uncached(void *cookie_netfs_data)\n{\n\tstruct nfs_inode *nfsi = cookie_netfs_data;\n\tstruct pagevec pvec;\n\tpgoff_t first;\n\tint loop, nr_pages;\n\n\tpagevec_init(&pvec, 0);\n\tfirst = 0;\n\n\tdprintk(\"NFS: nfs_inode_now_uncached: nfs_inode 0x%p\\n\", nfsi);\n\n\tfor (;;) {\n\t\t/* grab a bunch of pages to unmark */\n\t\tnr_pages = pagevec_lookup(&pvec,\n\t\t\t\t\t  nfsi->vfs_inode.i_mapping,\n\t\t\t\t\t  first,\n\t\t\t\t\t  PAGEVEC_SIZE - pagevec_count(&pvec));\n\t\tif (!nr_pages)\n\t\t\tbreak;\n\n\t\tfor (loop = 0; loop < nr_pages; loop++)\n\t\t\tClearPageFsCache(pvec.pages[loop]);\n\n\t\tfirst = pvec.pages[nr_pages - 1]->index + 1;\n\n\t\tpvec.nr = nr_pages;\n\t\tpagevec_release(&pvec);\n\t\tcond_resched();\n\t}\n}"
  },
  {
    "function_name": "nfs_fscache_inode_check_aux",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "229-252",
    "snippet": "static\nenum fscache_checkaux nfs_fscache_inode_check_aux(void *cookie_netfs_data,\n\t\t\t\t\t\t  const void *data,\n\t\t\t\t\t\t  uint16_t datalen)\n{\n\tstruct nfs_fscache_inode_auxdata auxdata;\n\tstruct nfs_inode *nfsi = cookie_netfs_data;\n\n\tif (datalen != sizeof(auxdata))\n\t\treturn FSCACHE_CHECKAUX_OBSOLETE;\n\n\tmemset(&auxdata, 0, sizeof(auxdata));\n\tauxdata.size = nfsi->vfs_inode.i_size;\n\tauxdata.mtime = nfsi->vfs_inode.i_mtime;\n\tauxdata.ctime = nfsi->vfs_inode.i_ctime;\n\n\tif (NFS_SERVER(&nfsi->vfs_inode)->nfs_client->rpc_ops->version == 4)\n\t\tauxdata.change_attr = nfsi->vfs_inode.i_version;\n\n\tif (memcmp(data, &auxdata, datalen) != 0)\n\t\treturn FSCACHE_CHECKAUX_OBSOLETE;\n\n\treturn FSCACHE_CHECKAUX_OKAY;\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "data",
            "&auxdata",
            "datalen"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NFS_SERVER",
          "args": [
            "&nfsi->vfs_inode"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&auxdata",
            "0",
            "sizeof(auxdata)"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic\nenum fscache_checkaux nfs_fscache_inode_check_aux(void *cookie_netfs_data,\n\t\t\t\t\t\t  const void *data,\n\t\t\t\t\t\t  uint16_t datalen)\n{\n\tstruct nfs_fscache_inode_auxdata auxdata;\n\tstruct nfs_inode *nfsi = cookie_netfs_data;\n\n\tif (datalen != sizeof(auxdata))\n\t\treturn FSCACHE_CHECKAUX_OBSOLETE;\n\n\tmemset(&auxdata, 0, sizeof(auxdata));\n\tauxdata.size = nfsi->vfs_inode.i_size;\n\tauxdata.mtime = nfsi->vfs_inode.i_mtime;\n\tauxdata.ctime = nfsi->vfs_inode.i_ctime;\n\n\tif (NFS_SERVER(&nfsi->vfs_inode)->nfs_client->rpc_ops->version == 4)\n\t\tauxdata.change_attr = nfsi->vfs_inode.i_version;\n\n\tif (memcmp(data, &auxdata, datalen) != 0)\n\t\treturn FSCACHE_CHECKAUX_OBSOLETE;\n\n\treturn FSCACHE_CHECKAUX_OKAY;\n}"
  },
  {
    "function_name": "nfs_fscache_inode_get_aux",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "202-221",
    "snippet": "static uint16_t nfs_fscache_inode_get_aux(const void *cookie_netfs_data,\n\t\t\t\t\t  void *buffer, uint16_t bufmax)\n{\n\tstruct nfs_fscache_inode_auxdata auxdata;\n\tconst struct nfs_inode *nfsi = cookie_netfs_data;\n\n\tmemset(&auxdata, 0, sizeof(auxdata));\n\tauxdata.size = nfsi->vfs_inode.i_size;\n\tauxdata.mtime = nfsi->vfs_inode.i_mtime;\n\tauxdata.ctime = nfsi->vfs_inode.i_ctime;\n\n\tif (NFS_SERVER(&nfsi->vfs_inode)->nfs_client->rpc_ops->version == 4)\n\t\tauxdata.change_attr = nfsi->vfs_inode.i_version;\n\n\tif (bufmax > sizeof(auxdata))\n\t\tbufmax = sizeof(auxdata);\n\n\tmemcpy(buffer, &auxdata, bufmax);\n\treturn bufmax;\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buffer",
            "&auxdata",
            "bufmax"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NFS_SERVER",
          "args": [
            "&nfsi->vfs_inode"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&auxdata",
            "0",
            "sizeof(auxdata)"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic uint16_t nfs_fscache_inode_get_aux(const void *cookie_netfs_data,\n\t\t\t\t\t  void *buffer, uint16_t bufmax)\n{\n\tstruct nfs_fscache_inode_auxdata auxdata;\n\tconst struct nfs_inode *nfsi = cookie_netfs_data;\n\n\tmemset(&auxdata, 0, sizeof(auxdata));\n\tauxdata.size = nfsi->vfs_inode.i_size;\n\tauxdata.mtime = nfsi->vfs_inode.i_mtime;\n\tauxdata.ctime = nfsi->vfs_inode.i_ctime;\n\n\tif (NFS_SERVER(&nfsi->vfs_inode)->nfs_client->rpc_ops->version == 4)\n\t\tauxdata.change_attr = nfsi->vfs_inode.i_version;\n\n\tif (bufmax > sizeof(auxdata))\n\t\tbufmax = sizeof(auxdata);\n\n\tmemcpy(buffer, &auxdata, bufmax);\n\treturn bufmax;\n}"
  },
  {
    "function_name": "nfs_fscache_inode_get_attr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "186-192",
    "snippet": "static void nfs_fscache_inode_get_attr(const void *cookie_netfs_data,\n\t\t\t\t       uint64_t *size)\n{\n\tconst struct nfs_inode *nfsi = cookie_netfs_data;\n\n\t*size = nfsi->vfs_inode.i_size;\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic void nfs_fscache_inode_get_attr(const void *cookie_netfs_data,\n\t\t\t\t       uint64_t *size)\n{\n\tconst struct nfs_inode *nfsi = cookie_netfs_data;\n\n\t*size = nfsi->vfs_inode.i_size;\n}"
  },
  {
    "function_name": "nfs_fscache_inode_get_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "168-178",
    "snippet": "static uint16_t nfs_fscache_inode_get_key(const void *cookie_netfs_data,\n\t\t\t\t\t  void *buffer, uint16_t bufmax)\n{\n\tconst struct nfs_inode *nfsi = cookie_netfs_data;\n\tuint16_t nsize;\n\n\t/* use the inode's NFS filehandle as the key */\n\tnsize = nfsi->fh.size;\n\tmemcpy(buffer, nfsi->fh.data, nsize);\n\treturn nsize;\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buffer",
            "nfsi->fh.data",
            "nsize"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic uint16_t nfs_fscache_inode_get_key(const void *cookie_netfs_data,\n\t\t\t\t\t  void *buffer, uint16_t bufmax)\n{\n\tconst struct nfs_inode *nfsi = cookie_netfs_data;\n\tuint16_t nsize;\n\n\t/* use the inode's NFS filehandle as the key */\n\tnsize = nfsi->fh.size;\n\tmemcpy(buffer, nfsi->fh.data, nsize);\n\treturn nsize;\n}"
  },
  {
    "function_name": "nfs_super_get_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "118-136",
    "snippet": "static uint16_t nfs_super_get_key(const void *cookie_netfs_data,\n\t\t\t\t  void *buffer, uint16_t bufmax)\n{\n\tconst struct nfs_fscache_key *key;\n\tconst struct nfs_server *nfss = cookie_netfs_data;\n\tuint16_t len;\n\n\tkey = nfss->fscache_key;\n\tlen = sizeof(key->key) + key->key.uniq_len;\n\tif (len > bufmax) {\n\t\tlen = 0;\n\t} else {\n\t\tmemcpy(buffer, &key->key, sizeof(key->key));\n\t\tmemcpy(buffer + sizeof(key->key),\n\t\t       key->key.uniquifier, key->key.uniq_len);\n\t}\n\n\treturn len;\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buffer + sizeof(key->key)",
            "key->key.uniquifier",
            "key->key.uniq_len"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buffer",
            "&key->key",
            "sizeof(key->key)"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic uint16_t nfs_super_get_key(const void *cookie_netfs_data,\n\t\t\t\t  void *buffer, uint16_t bufmax)\n{\n\tconst struct nfs_fscache_key *key;\n\tconst struct nfs_server *nfss = cookie_netfs_data;\n\tuint16_t len;\n\n\tkey = nfss->fscache_key;\n\tlen = sizeof(key->key) + key->key.uniq_len;\n\tif (len > bufmax) {\n\t\tlen = 0;\n\t} else {\n\t\tmemcpy(buffer, &key->key, sizeof(key->key));\n\t\tmemcpy(buffer + sizeof(key->key),\n\t\t       key->key.uniquifier, key->key.uniq_len);\n\t}\n\n\treturn len;\n}"
  },
  {
    "function_name": "nfs_server_get_key",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "68-102",
    "snippet": "static uint16_t nfs_server_get_key(const void *cookie_netfs_data,\n\t\t\t\t   void *buffer, uint16_t bufmax)\n{\n\tconst struct nfs_client *clp = cookie_netfs_data;\n\tconst struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *) &clp->cl_addr;\n\tconst struct sockaddr_in *sin = (struct sockaddr_in *) &clp->cl_addr;\n\tstruct nfs_server_key *key = buffer;\n\tuint16_t len = sizeof(struct nfs_server_key);\n\n\tmemset(key, 0, len);\n\tkey->nfsversion = clp->rpc_ops->version;\n\tkey->family = clp->cl_addr.ss_family;\n\n\tswitch (clp->cl_addr.ss_family) {\n\tcase AF_INET:\n\t\tkey->port = sin->sin_port;\n\t\tkey->addr[0].ipv4_addr = sin->sin_addr;\n\t\tlen += sizeof(key->addr[0].ipv4_addr);\n\t\tbreak;\n\n\tcase AF_INET6:\n\t\tkey->port = sin6->sin6_port;\n\t\tkey->addr[0].ipv6_addr = sin6->sin6_addr;\n\t\tlen += sizeof(key->addr[0].ipv6_addr);\n\t\tbreak;\n\n\tdefault:\n\t\tprintk(KERN_WARNING \"NFS: Unknown network family '%d'\\n\",\n\t\t       clp->cl_addr.ss_family);\n\t\tlen = 0;\n\t\tbreak;\n\t}\n\n\treturn len;\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "KERN_WARNING \"NFS: Unknown network family '%d'\\n\"",
            "clp->cl_addr.ss_family"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "compat_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/compat.c",
          "lines": "59-69",
          "snippet": "int compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/ioctls.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/uaccess.h>",
            "#include <linux/aio.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_struct.h>",
            "#include <linux/mm.h>",
            "#include <linux/poll.h>",
            "#include <linux/signal.h>",
            "#include <linux/highmem.h>",
            "#include <linux/security.h>",
            "#include <linux/tsacct_kern.h>",
            "#include <linux/rwsem.h>",
            "#include <linux/personality.h>",
            "#include <linux/highuid.h>",
            "#include <linux/fsnotify.h>",
            "#include <linux/dirent.h>",
            "#include <linux/ctype.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/ncp_mount.h>",
            "#include <linux/init.h>",
            "#include <linux/ioctl.h>",
            "#include <linux/vfs.h>",
            "#include <linux/fdtable.h>",
            "#include <linux/file.h>",
            "#include <linux/namei.h>",
            "#include <linux/fcntl.h>",
            "#include <linux/fs.h>",
            "#include <linux/time.h>",
            "#include <linux/errno.h>",
            "#include <linux/compat.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kernel.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int compat_log = 1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/ioctls.h>\n#include <asm/mmu_context.h>\n#include <asm/uaccess.h>\n#include <linux/aio.h>\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <linux/fs_struct.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/highmem.h>\n#include <linux/security.h>\n#include <linux/tsacct_kern.h>\n#include <linux/rwsem.h>\n#include <linux/personality.h>\n#include <linux/highuid.h>\n#include <linux/fsnotify.h>\n#include <linux/dirent.h>\n#include <linux/ctype.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/ncp_mount.h>\n#include <linux/init.h>\n#include <linux/ioctl.h>\n#include <linux/vfs.h>\n#include <linux/fdtable.h>\n#include <linux/file.h>\n#include <linux/namei.h>\n#include <linux/fcntl.h>\n#include <linux/fs.h>\n#include <linux/time.h>\n#include <linux/errno.h>\n#include <linux/compat.h>\n#include <linux/linkage.h>\n#include <linux/kernel.h>\n#include <linux/stddef.h>\n\nint compat_log = 1;\n\nint compat_printk(const char *fmt, ...)\n{\n\tva_list ap;\n\tint ret;\n\tif (!compat_log)\n\t\treturn 0;\n\tva_start(ap, fmt);\n\tret = vprintk(fmt, ap);\n\tva_end(ap);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "key",
            "0",
            "len"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstatic uint16_t nfs_server_get_key(const void *cookie_netfs_data,\n\t\t\t\t   void *buffer, uint16_t bufmax)\n{\n\tconst struct nfs_client *clp = cookie_netfs_data;\n\tconst struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *) &clp->cl_addr;\n\tconst struct sockaddr_in *sin = (struct sockaddr_in *) &clp->cl_addr;\n\tstruct nfs_server_key *key = buffer;\n\tuint16_t len = sizeof(struct nfs_server_key);\n\n\tmemset(key, 0, len);\n\tkey->nfsversion = clp->rpc_ops->version;\n\tkey->family = clp->cl_addr.ss_family;\n\n\tswitch (clp->cl_addr.ss_family) {\n\tcase AF_INET:\n\t\tkey->port = sin->sin_port;\n\t\tkey->addr[0].ipv4_addr = sin->sin_addr;\n\t\tlen += sizeof(key->addr[0].ipv4_addr);\n\t\tbreak;\n\n\tcase AF_INET6:\n\t\tkey->port = sin6->sin6_port;\n\t\tkey->addr[0].ipv6_addr = sin6->sin6_addr;\n\t\tlen += sizeof(key->addr[0].ipv6_addr);\n\t\tbreak;\n\n\tdefault:\n\t\tprintk(KERN_WARNING \"NFS: Unknown network family '%d'\\n\",\n\t\t       clp->cl_addr.ss_family);\n\t\tlen = 0;\n\t\tbreak;\n\t}\n\n\treturn len;\n}"
  },
  {
    "function_name": "nfs_fscache_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "46-49",
    "snippet": "void nfs_fscache_unregister(void)\n{\n\tfscache_unregister_netfs(&nfs_fscache_netfs);\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct fscache_netfs nfs_fscache_netfs = {\n\t.name\t\t= \"nfs\",\n\t.version\t= 0,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fscache_unregister_netfs",
          "args": [
            "&nfs_fscache_netfs"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "__fscache_unregister_netfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fscache/netfs.c",
          "lines": "88-103",
          "snippet": "void __fscache_unregister_netfs(struct fscache_netfs *netfs)\n{\n\t_enter(\"{%s.%u}\", netfs->name, netfs->version);\n\n\tdown_write(&fscache_addremove_sem);\n\n\tlist_del(&netfs->link);\n\tfscache_relinquish_cookie(netfs->primary_index, 0);\n\n\tup_write(&fscache_addremove_sem);\n\n\tpr_notice(\"Netfs '%s' unregistered from caching\\n\",\n\t\t  netfs->name);\n\n\t_leave(\"\");\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/slab.h>\n#include <linux/module.h>\n\nvoid __fscache_unregister_netfs(struct fscache_netfs *netfs)\n{\n\t_enter(\"{%s.%u}\", netfs->name, netfs->version);\n\n\tdown_write(&fscache_addremove_sem);\n\n\tlist_del(&netfs->link);\n\tfscache_relinquish_cookie(netfs->primary_index, 0);\n\n\tup_write(&fscache_addremove_sem);\n\n\tpr_notice(\"Netfs '%s' unregistered from caching\\n\",\n\t\t  netfs->name);\n\n\t_leave(\"\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstruct fscache_netfs nfs_fscache_netfs = {\n\t.name\t\t= \"nfs\",\n\t.version\t= 0,\n};\n\nvoid nfs_fscache_unregister(void)\n{\n\tfscache_unregister_netfs(&nfs_fscache_netfs);\n}"
  },
  {
    "function_name": "nfs_fscache_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/nfs/fscache-index.c",
    "lines": "38-41",
    "snippet": "int nfs_fscache_register(void)\n{\n\treturn fscache_register_netfs(&nfs_fscache_netfs);\n}",
    "includes": [
      "#include \"fscache.h\"",
      "#include \"internal.h\"",
      "#include <linux/in6.h>",
      "#include <linux/nfs_fs_sb.h>",
      "#include <linux/nfs_fs.h>",
      "#include <linux/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/kernel.h>",
      "#include <linux/init.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct fscache_netfs nfs_fscache_netfs = {\n\t.name\t\t= \"nfs\",\n\t.version\t= 0,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fscache_register_netfs",
          "args": [
            "&nfs_fscache_netfs"
          ],
          "line": 40
        },
        "resolved": true,
        "details": {
          "function_name": "__fscache_register_netfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/fscache/netfs.c",
          "lines": "22-81",
          "snippet": "int __fscache_register_netfs(struct fscache_netfs *netfs)\n{\n\tstruct fscache_netfs *ptr;\n\tint ret;\n\n\t_enter(\"{%s}\", netfs->name);\n\n\tINIT_LIST_HEAD(&netfs->link);\n\n\t/* allocate a cookie for the primary index */\n\tnetfs->primary_index =\n\t\tkmem_cache_zalloc(fscache_cookie_jar, GFP_KERNEL);\n\n\tif (!netfs->primary_index) {\n\t\t_leave(\" = -ENOMEM\");\n\t\treturn -ENOMEM;\n\t}\n\n\t/* initialise the primary index cookie */\n\tatomic_set(&netfs->primary_index->usage, 1);\n\tatomic_set(&netfs->primary_index->n_children, 0);\n\tatomic_set(&netfs->primary_index->n_active, 1);\n\n\tnetfs->primary_index->def\t\t= &fscache_fsdef_netfs_def;\n\tnetfs->primary_index->parent\t\t= &fscache_fsdef_index;\n\tnetfs->primary_index->netfs_data\t= netfs;\n\tnetfs->primary_index->flags\t\t= 1 << FSCACHE_COOKIE_ENABLED;\n\n\tatomic_inc(&netfs->primary_index->parent->usage);\n\tatomic_inc(&netfs->primary_index->parent->n_children);\n\n\tspin_lock_init(&netfs->primary_index->lock);\n\tINIT_HLIST_HEAD(&netfs->primary_index->backing_objects);\n\n\t/* check the netfs type is not already present */\n\tdown_write(&fscache_addremove_sem);\n\n\tret = -EEXIST;\n\tlist_for_each_entry(ptr, &fscache_netfs_list, link) {\n\t\tif (strcmp(ptr->name, netfs->name) == 0)\n\t\t\tgoto already_registered;\n\t}\n\n\tlist_add(&netfs->link, &fscache_netfs_list);\n\tret = 0;\n\n\tpr_notice(\"Netfs '%s' registered for caching\\n\", netfs->name);\n\nalready_registered:\n\tup_write(&fscache_addremove_sem);\n\n\tif (ret < 0) {\n\t\tnetfs->primary_index->parent = NULL;\n\t\t__fscache_cookie_put(netfs->primary_index);\n\t\tnetfs->primary_index = NULL;\n\t}\n\n\t_leave(\" = %d\", ret);\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/slab.h>",
            "#include <linux/module.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(fscache_netfs_list);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/slab.h>\n#include <linux/module.h>\n\nstatic LIST_HEAD(fscache_netfs_list);\n\nint __fscache_register_netfs(struct fscache_netfs *netfs)\n{\n\tstruct fscache_netfs *ptr;\n\tint ret;\n\n\t_enter(\"{%s}\", netfs->name);\n\n\tINIT_LIST_HEAD(&netfs->link);\n\n\t/* allocate a cookie for the primary index */\n\tnetfs->primary_index =\n\t\tkmem_cache_zalloc(fscache_cookie_jar, GFP_KERNEL);\n\n\tif (!netfs->primary_index) {\n\t\t_leave(\" = -ENOMEM\");\n\t\treturn -ENOMEM;\n\t}\n\n\t/* initialise the primary index cookie */\n\tatomic_set(&netfs->primary_index->usage, 1);\n\tatomic_set(&netfs->primary_index->n_children, 0);\n\tatomic_set(&netfs->primary_index->n_active, 1);\n\n\tnetfs->primary_index->def\t\t= &fscache_fsdef_netfs_def;\n\tnetfs->primary_index->parent\t\t= &fscache_fsdef_index;\n\tnetfs->primary_index->netfs_data\t= netfs;\n\tnetfs->primary_index->flags\t\t= 1 << FSCACHE_COOKIE_ENABLED;\n\n\tatomic_inc(&netfs->primary_index->parent->usage);\n\tatomic_inc(&netfs->primary_index->parent->n_children);\n\n\tspin_lock_init(&netfs->primary_index->lock);\n\tINIT_HLIST_HEAD(&netfs->primary_index->backing_objects);\n\n\t/* check the netfs type is not already present */\n\tdown_write(&fscache_addremove_sem);\n\n\tret = -EEXIST;\n\tlist_for_each_entry(ptr, &fscache_netfs_list, link) {\n\t\tif (strcmp(ptr->name, netfs->name) == 0)\n\t\t\tgoto already_registered;\n\t}\n\n\tlist_add(&netfs->link, &fscache_netfs_list);\n\tret = 0;\n\n\tpr_notice(\"Netfs '%s' registered for caching\\n\", netfs->name);\n\nalready_registered:\n\tup_write(&fscache_addremove_sem);\n\n\tif (ret < 0) {\n\t\tnetfs->primary_index->parent = NULL;\n\t\t__fscache_cookie_put(netfs->primary_index);\n\t\tnetfs->primary_index = NULL;\n\t}\n\n\t_leave(\" = %d\", ret);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"fscache.h\"\n#include \"internal.h\"\n#include <linux/in6.h>\n#include <linux/nfs_fs_sb.h>\n#include <linux/nfs_fs.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nstruct fscache_netfs nfs_fscache_netfs = {\n\t.name\t\t= \"nfs\",\n\t.version\t= 0,\n};\n\nint nfs_fscache_register(void)\n{\n\treturn fscache_register_netfs(&nfs_fscache_netfs);\n}"
  }
]