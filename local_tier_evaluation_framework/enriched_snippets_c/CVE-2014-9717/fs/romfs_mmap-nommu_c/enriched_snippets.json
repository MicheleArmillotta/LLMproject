[
  {
    "function_name": "omfs_mmap_capabilities(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/mmap-nommu.c",
    "lines": "73-80",
    "snippet": "tatic unsigned romfs_mmap_capabilities(struct file *file)\n{\n\tstruct mtd_info *mtd = file_inode(file)->i_sb->s_mtd;\n\n\tif (!mtd)\n\t\treturn NOMMU_MAP_COPY;\n\treturn mtd_mmap_capabilities(mtd);\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/mtd/super.h>\n#",
      "include <linux/mm.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "td_mmap_capabilities(",
          "args": [
            "td)"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ile_inode(",
          "args": [
            "ile)"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/mtd/super.h>\n#\ninclude <linux/mm.h>\n#\n\ntatic unsigned romfs_mmap_capabilities(struct file *file)\n{\n\tstruct mtd_info *mtd = file_inode(file)->i_sb->s_mtd;\n\n\tif (!mtd)\n\t\treturn NOMMU_MAP_COPY;\n\treturn mtd_mmap_capabilities(mtd);\n}"
  },
  {
    "function_name": "omfs_mmap(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/mmap-nommu.c",
    "lines": "68-71",
    "snippet": "tatic int romfs_mmap(struct file *file, struct vm_area_struct *vma)\n{\n\treturn vma->vm_flags & (VM_SHARED | VM_MAYSHARE) ? 0 : -ENOSYS;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/mtd/super.h>\n#",
      "include <linux/mm.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/mtd/super.h>\n#\ninclude <linux/mm.h>\n#\n\ntatic int romfs_mmap(struct file *file, struct vm_area_struct *vma)\n{\n\treturn vma->vm_flags & (VM_SHARED | VM_MAYSHARE) ? 0 : -ENOSYS;\n}"
  },
  {
    "function_name": "omfs_get_unmapped_area(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/mmap-nommu.c",
    "lines": "22-62",
    "snippet": "tatic unsigned long romfs_get_unmapped_area(struct file *file,\n\t\t\t\t\t     unsigned long addr,\n\t\t\t\t\t     unsigned long len,\n\t\t\t\t\t     unsigned long pgoff,\n\t\t\t\t\t     unsigned long flags)\n{\n\tstruct inode *inode = file->f_mapping->host;\n\tstruct mtd_info *mtd = inode->i_sb->s_mtd;\n\tunsigned long isize, offset, maxpages, lpages;\n\tint ret;\n\n\tif (!mtd)\n\t\treturn (unsigned long) -ENOSYS;\n\n\t/* the mapping mustn't extend beyond the EOF */\n\tlpages = (len + PAGE_SIZE - 1) >> PAGE_SHIFT;\n\tisize = i_size_read(inode);\n\toffset = pgoff << PAGE_SHIFT;\n\n\tmaxpages = (isize + PAGE_SIZE - 1) >> PAGE_SHIFT;\n\tif ((pgoff >= maxpages) || (maxpages - pgoff < lpages))\n\t\treturn (unsigned long) -EINVAL;\n\n\tif (addr != 0)\n\t\treturn (unsigned long) -EINVAL;\n\n\tif (len > mtd->size || pgoff >= (mtd->size >> PAGE_SHIFT))\n\t\treturn (unsigned long) -EINVAL;\n\n\toffset += ROMFS_I(inode)->i_dataoffset;\n\tif (offset >= mtd->size)\n\t\treturn (unsigned long) -EINVAL;\n\t/* the mapping mustn't extend beyond the EOF */\n\tif ((offset + len) > mtd->size)\n\t\tlen = mtd->size - offset;\n\n\tret = mtd_get_unmapped_area(mtd, len, offset, flags);\n\tif (ret == -EOPNOTSUPP)\n\t\tret = -ENOSYS;\n\treturn (unsigned long) ret;\n}",
    "includes": [
      "include \"internal.h\"",
      "include <linux/mtd/super.h>\n#",
      "include <linux/mm.h>\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "td_get_unmapped_area(",
          "args": [
            "td,",
            "en,",
            "ffset,",
            "lags)"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OMFS_I(",
          "args": [
            "node)"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "OMFS_I(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/romfs/internal.h",
          "lines": "25-28",
          "snippet": "tatic inline struct romfs_inode_info *ROMFS_I(struct inode *inode)\n{\n\treturn container_of(inode, struct romfs_inode_info, vfs_inode);\n}",
          "includes": [
            "include <linux/romfs_fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include <linux/romfs_fs.h>\n\ntatic inline struct romfs_inode_info *ROMFS_I(struct inode *inode)\n{\n\treturn container_of(inode, struct romfs_inode_info, vfs_inode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "_size_read(",
          "args": [
            "node)"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"internal.h\"\ninclude <linux/mtd/super.h>\n#\ninclude <linux/mm.h>\n#\n\ntatic unsigned long romfs_get_unmapped_area(struct file *file,\n\t\t\t\t\t     unsigned long addr,\n\t\t\t\t\t     unsigned long len,\n\t\t\t\t\t     unsigned long pgoff,\n\t\t\t\t\t     unsigned long flags)\n{\n\tstruct inode *inode = file->f_mapping->host;\n\tstruct mtd_info *mtd = inode->i_sb->s_mtd;\n\tunsigned long isize, offset, maxpages, lpages;\n\tint ret;\n\n\tif (!mtd)\n\t\treturn (unsigned long) -ENOSYS;\n\n\t/* the mapping mustn't extend beyond the EOF */\n\tlpages = (len + PAGE_SIZE - 1) >> PAGE_SHIFT;\n\tisize = i_size_read(inode);\n\toffset = pgoff << PAGE_SHIFT;\n\n\tmaxpages = (isize + PAGE_SIZE - 1) >> PAGE_SHIFT;\n\tif ((pgoff >= maxpages) || (maxpages - pgoff < lpages))\n\t\treturn (unsigned long) -EINVAL;\n\n\tif (addr != 0)\n\t\treturn (unsigned long) -EINVAL;\n\n\tif (len > mtd->size || pgoff >= (mtd->size >> PAGE_SHIFT))\n\t\treturn (unsigned long) -EINVAL;\n\n\toffset += ROMFS_I(inode)->i_dataoffset;\n\tif (offset >= mtd->size)\n\t\treturn (unsigned long) -EINVAL;\n\t/* the mapping mustn't extend beyond the EOF */\n\tif ((offset + len) > mtd->size)\n\t\tlen = mtd->size - offset;\n\n\tret = mtd_get_unmapped_area(mtd, len, offset, flags);\n\tif (ret == -EOPNOTSUPP)\n\t\tret = -ENOSYS;\n\treturn (unsigned long) ret;\n}"
  }
]