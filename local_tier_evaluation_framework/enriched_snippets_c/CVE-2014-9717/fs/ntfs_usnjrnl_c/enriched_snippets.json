[
  {
    "function_name": "ntfs_stamp_usnjrnl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/usnjrnl.c",
    "lines": "47-82",
    "snippet": "bool ntfs_stamp_usnjrnl(ntfs_volume *vol)\n{\n\tntfs_debug(\"Entering.\");\n\tif (likely(!NVolUsnJrnlStamped(vol))) {\n\t\tsle64 stamp;\n\t\tstruct page *page;\n\t\tUSN_HEADER *uh;\n\n\t\tpage = ntfs_map_page(vol->usnjrnl_max_ino->i_mapping, 0);\n\t\tif (IS_ERR(page)) {\n\t\t\tntfs_error(vol->sb, \"Failed to read from \"\n\t\t\t\t\t\"$UsnJrnl/$DATA/$Max attribute.\");\n\t\t\treturn false;\n\t\t}\n\t\tuh = (USN_HEADER*)page_address(page);\n\t\tstamp = get_current_ntfs_time();\n\t\tntfs_debug(\"Stamping transaction log ($UsnJrnl): old \"\n\t\t\t\t\"journal_id 0x%llx, old lowest_valid_usn \"\n\t\t\t\t\"0x%llx, new journal_id 0x%llx, new \"\n\t\t\t\t\"lowest_valid_usn 0x%llx.\",\n\t\t\t\t(long long)sle64_to_cpu(uh->journal_id),\n\t\t\t\t(long long)sle64_to_cpu(uh->lowest_valid_usn),\n\t\t\t\t(long long)sle64_to_cpu(stamp),\n\t\t\t\ti_size_read(vol->usnjrnl_j_ino));\n\t\tuh->lowest_valid_usn =\n\t\t\t\tcpu_to_sle64(i_size_read(vol->usnjrnl_j_ino));\n\t\tuh->journal_id = stamp;\n\t\tflush_dcache_page(page);\n\t\tset_page_dirty(page);\n\t\tntfs_unmap_page(page);\n\t\t/* Set the flag so we do not have to do it again on remount. */\n\t\tNVolSetUsnJrnlStamped(vol);\n\t}\n\tntfs_debug(\"Done.\");\n\treturn true;\n}",
    "includes": [
      "#include \"volume.h\"",
      "#include \"usnjrnl.h\"",
      "#include \"types.h\"",
      "#include \"time.h\"",
      "#include \"endian.h\"",
      "#include \"debug.h\"",
      "#include \"aops.h\"",
      "#include <linux/mm.h>",
      "#include <linux/highmem.h>",
      "#include <linux/fs.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ntfs_debug",
          "args": [
            "\"Done.\""
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "ntfs_debug_dump_runlist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/debug.c",
          "lines": "134-171",
          "snippet": "void ntfs_debug_dump_runlist(const runlist_element *rl)\n{\n\tint i;\n\tconst char *lcn_str[5] = { \"LCN_HOLE         \", \"LCN_RL_NOT_MAPPED\",\n\t\t\t\t   \"LCN_ENOENT       \", \"LCN_unknown      \" };\n\n\tif (!debug_msgs)\n\t\treturn;\n\tpr_debug(\"Dumping runlist (values in hex):\\n\");\n\tif (!rl) {\n\t\tpr_debug(\"Run list not present.\\n\");\n\t\treturn;\n\t}\n\tpr_debug(\"VCN              LCN               Run length\\n\");\n\tfor (i = 0; ; i++) {\n\t\tLCN lcn = (rl + i)->lcn;\n\n\t\tif (lcn < (LCN)0) {\n\t\t\tint index = -lcn - 1;\n\n\t\t\tif (index > -LCN_ENOENT - 1)\n\t\t\t\tindex = 3;\n\t\t\tpr_debug(\"%-16Lx %s %-16Lx%s\\n\",\n\t\t\t\t\t(long long)(rl + i)->vcn, lcn_str[index],\n\t\t\t\t\t(long long)(rl + i)->length,\n\t\t\t\t\t(rl + i)->length ? \"\" :\n\t\t\t\t\t\t\" (runlist end)\");\n\t\t} else\n\t\t\tpr_debug(\"%-16Lx %-16Lx  %-16Lx%s\\n\",\n\t\t\t\t\t(long long)(rl + i)->vcn,\n\t\t\t\t\t(long long)(rl + i)->lcn,\n\t\t\t\t\t(long long)(rl + i)->length,\n\t\t\t\t\t(rl + i)->length ? \"\" :\n\t\t\t\t\t\t\" (runlist end)\");\n\t\tif (!(rl + i)->length)\n\t\t\tbreak;\n\t}\n}",
          "includes": [
            "#include \"debug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"debug.h\"\n\nvoid ntfs_debug_dump_runlist(const runlist_element *rl)\n{\n\tint i;\n\tconst char *lcn_str[5] = { \"LCN_HOLE         \", \"LCN_RL_NOT_MAPPED\",\n\t\t\t\t   \"LCN_ENOENT       \", \"LCN_unknown      \" };\n\n\tif (!debug_msgs)\n\t\treturn;\n\tpr_debug(\"Dumping runlist (values in hex):\\n\");\n\tif (!rl) {\n\t\tpr_debug(\"Run list not present.\\n\");\n\t\treturn;\n\t}\n\tpr_debug(\"VCN              LCN               Run length\\n\");\n\tfor (i = 0; ; i++) {\n\t\tLCN lcn = (rl + i)->lcn;\n\n\t\tif (lcn < (LCN)0) {\n\t\t\tint index = -lcn - 1;\n\n\t\t\tif (index > -LCN_ENOENT - 1)\n\t\t\t\tindex = 3;\n\t\t\tpr_debug(\"%-16Lx %s %-16Lx%s\\n\",\n\t\t\t\t\t(long long)(rl + i)->vcn, lcn_str[index],\n\t\t\t\t\t(long long)(rl + i)->length,\n\t\t\t\t\t(rl + i)->length ? \"\" :\n\t\t\t\t\t\t\" (runlist end)\");\n\t\t} else\n\t\t\tpr_debug(\"%-16Lx %-16Lx  %-16Lx%s\\n\",\n\t\t\t\t\t(long long)(rl + i)->vcn,\n\t\t\t\t\t(long long)(rl + i)->lcn,\n\t\t\t\t\t(long long)(rl + i)->length,\n\t\t\t\t\t(rl + i)->length ? \"\" :\n\t\t\t\t\t\t\" (runlist end)\");\n\t\tif (!(rl + i)->length)\n\t\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "NVolSetUsnJrnlStamped",
          "args": [
            "vol"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntfs_unmap_page",
          "args": [
            "page"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "ntfs_unmap_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/aops.h",
          "lines": "40-44",
          "snippet": "static inline void ntfs_unmap_page(struct page *page)\n{\n\tkunmap(page);\n\tpage_cache_release(page);\n}",
          "includes": [
            "#include \"inode.h\"",
            "#include <linux/fs.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inode.h\"\n#include <linux/fs.h>\n#include <linux/pagemap.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n\nstatic inline void ntfs_unmap_page(struct page *page)\n{\n\tkunmap(page);\n\tpage_cache_release(page);\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_page_dirty",
          "args": [
            "page"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "anon_set_page_dirty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/libfs.c",
          "lines": "1040-1043",
          "snippet": "static int anon_set_page_dirty(struct page *page)\n{\n\treturn 0;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/uaccess.h>",
            "#include <linux/buffer_head.h> /* sync_mapping_buffers */",
            "#include <linux/writeback.h>",
            "#include <linux/exportfs.h>",
            "#include <linux/namei.h>",
            "#include <linux/mutex.h>",
            "#include <linux/quotaops.h>",
            "#include <linux/vfs.h>",
            "#include <linux/mount.h>",
            "#include <linux/slab.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/export.h>",
            "#include <linux/blkdev.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/uaccess.h>\n#include <linux/buffer_head.h> /* sync_mapping_buffers */\n#include <linux/writeback.h>\n#include <linux/exportfs.h>\n#include <linux/namei.h>\n#include <linux/mutex.h>\n#include <linux/quotaops.h>\n#include <linux/vfs.h>\n#include <linux/mount.h>\n#include <linux/slab.h>\n#include <linux/pagemap.h>\n#include <linux/export.h>\n#include <linux/blkdev.h>\n\nstatic int anon_set_page_dirty(struct page *page)\n{\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "flush_dcache_page",
          "args": [
            "page"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "ntfs_index_entry_flush_dcache_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/index.h",
          "lines": "111-117",
          "snippet": "static inline void ntfs_index_entry_flush_dcache_page(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tflush_dcache_mft_record_page(ictx->actx->ntfs_ino);\n\telse\n\t\tflush_dcache_page(ictx->page);\n}",
          "includes": [
            "#include \"aops.h\"",
            "#include \"mft.h\"",
            "#include \"attrib.h\"",
            "#include \"inode.h\"",
            "#include \"layout.h\"",
            "#include \"types.h\"",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"aops.h\"\n#include \"mft.h\"\n#include \"attrib.h\"\n#include \"inode.h\"\n#include \"layout.h\"\n#include \"types.h\"\n#include <linux/fs.h>\n\nstatic inline void ntfs_index_entry_flush_dcache_page(ntfs_index_context *ictx)\n{\n\tif (ictx->is_in_root)\n\t\tflush_dcache_mft_record_page(ictx->actx->ntfs_ino);\n\telse\n\t\tflush_dcache_page(ictx->page);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cpu_to_sle64",
          "args": [
            "i_size_read(vol->usnjrnl_j_ino)"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "cpu_to_sle64p",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "88-91",
          "snippet": "static inline sle64 cpu_to_sle64p(s64 *x)\n{\n\treturn (__force sle64)cpu_to_le64(*x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline sle64 cpu_to_sle64p(s64 *x)\n{\n\treturn (__force sle64)cpu_to_le64(*x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "i_size_read",
          "args": [
            "vol->usnjrnl_j_ino"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntfs_debug",
          "args": [
            "\"Stamping transaction log ($UsnJrnl): old \"\n\t\t\t\t\"journal_id 0x%llx, old lowest_valid_usn \"\n\t\t\t\t\"0x%llx, new journal_id 0x%llx, new \"\n\t\t\t\t\"lowest_valid_usn 0x%llx.\"",
            "(long long)sle64_to_cpu(uh->journal_id)",
            "(long long)sle64_to_cpu(uh->lowest_valid_usn)",
            "(long long)sle64_to_cpu(stamp)",
            "i_size_read(vol->usnjrnl_j_ino)"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "__ntfs_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/debug.c",
          "lines": "115-131",
          "snippet": "void __ntfs_debug(const char *file, int line, const char *function,\n\t\tconst char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\tint flen = 0;\n\n\tif (!debug_msgs)\n\t\treturn;\n\tif (function)\n\t\tflen = strlen(function);\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s, %d): %s(): %pV\", file, line, flen ? function : \"\", &vaf);\n\tva_end(args);\n}",
          "includes": [
            "#include \"debug.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"debug.h\"\n\nvoid __ntfs_debug(const char *file, int line, const char *function,\n\t\tconst char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\tint flen = 0;\n\n\tif (!debug_msgs)\n\t\treturn;\n\tif (function)\n\t\tflen = strlen(function);\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_debug(\"(%s, %d): %s(): %pV\", file, line, flen ? function : \"\", &vaf);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "i_size_read",
          "args": [
            "vol->usnjrnl_j_ino"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sle64_to_cpu",
          "args": [
            "stamp"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "sle64_to_cpup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/endian.h",
          "lines": "58-61",
          "snippet": "static inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}",
          "includes": [
            "#include \"types.h\"",
            "#include <asm/byteorder.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"types.h\"\n#include <asm/byteorder.h>\n\nstatic inline s64 sle64_to_cpup(sle64 *x)\n{\n\treturn le64_to_cpu(*(__force le64*)x);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_current_ntfs_time",
          "args": [],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "get_current_ntfs_time",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/time.h",
          "lines": "64-67",
          "snippet": "static inline sle64 get_current_ntfs_time(void)\n{\n\treturn utc2ntfs(current_kernel_time());\n}",
          "includes": [
            "#include \"endian.h\"",
            "#include <asm/div64.h>\t\t/* For do_div(). */",
            "#include <linux/time.h>\t\t/* For current_kernel_time(). */"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endian.h\"\n#include <asm/div64.h>\t\t/* For do_div(). */\n#include <linux/time.h>\t\t/* For current_kernel_time(). */\n\nstatic inline sle64 get_current_ntfs_time(void)\n{\n\treturn utc2ntfs(current_kernel_time());\n}"
        }
      },
      {
        "call_info": {
          "callee": "page_address",
          "args": [
            "page"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntfs_error",
          "args": [
            "vol->sb",
            "\"Failed to read from \"\n\t\t\t\t\t\"$UsnJrnl/$DATA/$Max attribute.\""
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_ERR",
          "args": [
            "page"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntfs_map_page",
          "args": [
            "vol->usnjrnl_max_ino->i_mapping",
            "0"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "ntfs_map_page",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ntfs/aops.h",
          "lines": "86-99",
          "snippet": "static inline struct page *ntfs_map_page(struct address_space *mapping,\n\t\tunsigned long index)\n{\n\tstruct page *page = read_mapping_page(mapping, index, NULL);\n\n\tif (!IS_ERR(page)) {\n\t\tkmap(page);\n\t\tif (!PageError(page))\n\t\t\treturn page;\n\t\tntfs_unmap_page(page);\n\t\treturn ERR_PTR(-EIO);\n\t}\n\treturn page;\n}",
          "includes": [
            "#include \"inode.h\"",
            "#include <linux/fs.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"inode.h\"\n#include <linux/fs.h>\n#include <linux/pagemap.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n\nstatic inline struct page *ntfs_map_page(struct address_space *mapping,\n\t\tunsigned long index)\n{\n\tstruct page *page = read_mapping_page(mapping, index, NULL);\n\n\tif (!IS_ERR(page)) {\n\t\tkmap(page);\n\t\tif (!PageError(page))\n\t\t\treturn page;\n\t\tntfs_unmap_page(page);\n\t\treturn ERR_PTR(-EIO);\n\t}\n\treturn page;\n}"
        }
      },
      {
        "call_info": {
          "callee": "likely",
          "args": [
            "!NVolUsnJrnlStamped(vol)"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NVolUsnJrnlStamped",
          "args": [
            "vol"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"volume.h\"\n#include \"usnjrnl.h\"\n#include \"types.h\"\n#include \"time.h\"\n#include \"endian.h\"\n#include \"debug.h\"\n#include \"aops.h\"\n#include <linux/mm.h>\n#include <linux/highmem.h>\n#include <linux/fs.h>\n\nbool ntfs_stamp_usnjrnl(ntfs_volume *vol)\n{\n\tntfs_debug(\"Entering.\");\n\tif (likely(!NVolUsnJrnlStamped(vol))) {\n\t\tsle64 stamp;\n\t\tstruct page *page;\n\t\tUSN_HEADER *uh;\n\n\t\tpage = ntfs_map_page(vol->usnjrnl_max_ino->i_mapping, 0);\n\t\tif (IS_ERR(page)) {\n\t\t\tntfs_error(vol->sb, \"Failed to read from \"\n\t\t\t\t\t\"$UsnJrnl/$DATA/$Max attribute.\");\n\t\t\treturn false;\n\t\t}\n\t\tuh = (USN_HEADER*)page_address(page);\n\t\tstamp = get_current_ntfs_time();\n\t\tntfs_debug(\"Stamping transaction log ($UsnJrnl): old \"\n\t\t\t\t\"journal_id 0x%llx, old lowest_valid_usn \"\n\t\t\t\t\"0x%llx, new journal_id 0x%llx, new \"\n\t\t\t\t\"lowest_valid_usn 0x%llx.\",\n\t\t\t\t(long long)sle64_to_cpu(uh->journal_id),\n\t\t\t\t(long long)sle64_to_cpu(uh->lowest_valid_usn),\n\t\t\t\t(long long)sle64_to_cpu(stamp),\n\t\t\t\ti_size_read(vol->usnjrnl_j_ino));\n\t\tuh->lowest_valid_usn =\n\t\t\t\tcpu_to_sle64(i_size_read(vol->usnjrnl_j_ino));\n\t\tuh->journal_id = stamp;\n\t\tflush_dcache_page(page);\n\t\tset_page_dirty(page);\n\t\tntfs_unmap_page(page);\n\t\t/* Set the flag so we do not have to do it again on remount. */\n\t\tNVolSetUsnJrnlStamped(vol);\n\t}\n\tntfs_debug(\"Done.\");\n\treturn true;\n}"
  }
]