[
  {
    "function_name": "ecryptfs_dump_hex",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ecryptfs/debug.c",
    "lines": "98-120",
    "snippet": "void ecryptfs_dump_hex(char *data, int bytes)\n{\n\tint i = 0;\n\tint add_newline = 1;\n\n\tif (ecryptfs_verbosity < 1)\n\t\treturn;\n\tif (bytes != 0) {\n\t\tprintk(KERN_DEBUG \"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t}\n\twhile (i < bytes) {\n\t\tprintk(\"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t\tif (i % 16 == 0) {\n\t\t\tprintk(\"\\n\");\n\t\t\tadd_newline = 0;\n\t\t} else\n\t\t\tadd_newline = 1;\n\t}\n\tif (add_newline)\n\t\tprintk(\"\\n\");\n}",
    "includes": [
      "#include \"ecryptfs_kernel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printk",
          "args": [
            "\"\\n\""
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "__ecryptfs_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ecryptfs/main.c",
          "lines": "86-96",
          "snippet": "void __ecryptfs_printk(const char *fmt, ...)\n{\n\tva_list args;\n\tva_start(args, fmt);\n\tif (fmt[1] == '7') { /* KERN_DEBUG */\n\t\tif (ecryptfs_verbosity >= 1)\n\t\t\tvprintk(fmt, args);\n\t} else\n\t\tvprintk(fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"ecryptfs_kernel.h\"",
            "#include <linux/magic.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_stack.h>",
            "#include <linux/parser.h>",
            "#include <linux/key.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mount.h>",
            "#include <linux/crypto.h>",
            "#include <linux/skbuff.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/file.h>",
            "#include <linux/dcache.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int ecryptfs_verbosity = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ecryptfs_kernel.h\"\n#include <linux/magic.h>\n#include <linux/slab.h>\n#include <linux/fs_stack.h>\n#include <linux/parser.h>\n#include <linux/key.h>\n#include <linux/pagemap.h>\n#include <linux/mount.h>\n#include <linux/crypto.h>\n#include <linux/skbuff.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/file.h>\n#include <linux/dcache.h>\n\nint ecryptfs_verbosity = 0;\n\nvoid __ecryptfs_printk(const char *fmt, ...)\n{\n\tva_list args;\n\tva_start(args, fmt);\n\tif (fmt[1] == '7') { /* KERN_DEBUG */\n\t\tif (ecryptfs_verbosity >= 1)\n\t\t\tvprintk(fmt, args);\n\t} else\n\t\tvprintk(fmt, args);\n\tva_end(args);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"ecryptfs_kernel.h\"\n\nvoid ecryptfs_dump_hex(char *data, int bytes)\n{\n\tint i = 0;\n\tint add_newline = 1;\n\n\tif (ecryptfs_verbosity < 1)\n\t\treturn;\n\tif (bytes != 0) {\n\t\tprintk(KERN_DEBUG \"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t}\n\twhile (i < bytes) {\n\t\tprintk(\"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t\tif (i % 16 == 0) {\n\t\t\tprintk(\"\\n\");\n\t\t\tadd_newline = 0;\n\t\t} else\n\t\t\tadd_newline = 1;\n\t}\n\tif (add_newline)\n\t\tprintk(\"\\n\");\n}"
  },
  {
    "function_name": "ecryptfs_dump_auth_tok",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ecryptfs/debug.c",
    "lines": "32-89",
    "snippet": "void ecryptfs_dump_auth_tok(struct ecryptfs_auth_tok *auth_tok)\n{\n\tchar salt[ECRYPTFS_SALT_SIZE * 2 + 1];\n\tchar sig[ECRYPTFS_SIG_SIZE_HEX + 1];\n\n\tecryptfs_printk(KERN_DEBUG, \"Auth tok at mem loc [%p]:\\n\",\n\t\t\tauth_tok);\n\tif (auth_tok->flags & ECRYPTFS_PRIVATE_KEY) {\n\t\tecryptfs_printk(KERN_DEBUG, \" * private key type\\n\");\n\t} else {\n\t\tecryptfs_printk(KERN_DEBUG, \" * passphrase type\\n\");\n\t\tecryptfs_to_hex(salt, auth_tok->token.password.salt,\n\t\t\t\tECRYPTFS_SALT_SIZE);\n\t\tsalt[ECRYPTFS_SALT_SIZE * 2] = '\\0';\n\t\tecryptfs_printk(KERN_DEBUG, \" * salt = [%s]\\n\", salt);\n\t\tif (auth_tok->token.password.flags &\n\t\t    ECRYPTFS_PERSISTENT_PASSWORD) {\n\t\t\tecryptfs_printk(KERN_DEBUG, \" * persistent\\n\");\n\t\t}\n\t\tmemcpy(sig, auth_tok->token.password.signature,\n\t\t       ECRYPTFS_SIG_SIZE_HEX);\n\t\tsig[ECRYPTFS_SIG_SIZE_HEX] = '\\0';\n\t\tecryptfs_printk(KERN_DEBUG, \" * signature = [%s]\\n\", sig);\n\t}\n\tecryptfs_printk(KERN_DEBUG, \" * session_key.flags = [0x%x]\\n\",\n\t\t\tauth_tok->session_key.flags);\n\tif (auth_tok->session_key.flags\n\t    & ECRYPTFS_USERSPACE_SHOULD_TRY_TO_DECRYPT)\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * Userspace decrypt request set\\n\");\n\tif (auth_tok->session_key.flags\n\t    & ECRYPTFS_USERSPACE_SHOULD_TRY_TO_ENCRYPT)\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * Userspace encrypt request set\\n\");\n\tif (auth_tok->session_key.flags & ECRYPTFS_CONTAINS_DECRYPTED_KEY) {\n\t\tecryptfs_printk(KERN_DEBUG, \" * Contains decrypted key\\n\");\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * session_key.decrypted_key_size = [0x%x]\\n\",\n\t\t\t\tauth_tok->session_key.decrypted_key_size);\n\t\tecryptfs_printk(KERN_DEBUG, \" * Decrypted session key \"\n\t\t\t\t\"dump:\\n\");\n\t\tif (ecryptfs_verbosity > 0)\n\t\t\tecryptfs_dump_hex(auth_tok->session_key.decrypted_key,\n\t\t\t\t\t  ECRYPTFS_DEFAULT_KEY_BYTES);\n\t}\n\tif (auth_tok->session_key.flags & ECRYPTFS_CONTAINS_ENCRYPTED_KEY) {\n\t\tecryptfs_printk(KERN_DEBUG, \" * Contains encrypted key\\n\");\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * session_key.encrypted_key_size = [0x%x]\\n\",\n\t\t\t\tauth_tok->session_key.encrypted_key_size);\n\t\tecryptfs_printk(KERN_DEBUG, \" * Encrypted session key \"\n\t\t\t\t\"dump:\\n\");\n\t\tif (ecryptfs_verbosity > 0)\n\t\t\tecryptfs_dump_hex(auth_tok->session_key.encrypted_key,\n\t\t\t\t\t  auth_tok->session_key.\n\t\t\t\t\t  encrypted_key_size);\n\t}\n}",
    "includes": [
      "#include \"ecryptfs_kernel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ecryptfs_dump_hex",
          "args": [
            "auth_tok->session_key.encrypted_key",
            "auth_tok->session_key.\n\t\t\t\t\t  encrypted_key_size"
          ],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "ecryptfs_dump_hex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ecryptfs/debug.c",
          "lines": "98-120",
          "snippet": "void ecryptfs_dump_hex(char *data, int bytes)\n{\n\tint i = 0;\n\tint add_newline = 1;\n\n\tif (ecryptfs_verbosity < 1)\n\t\treturn;\n\tif (bytes != 0) {\n\t\tprintk(KERN_DEBUG \"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t}\n\twhile (i < bytes) {\n\t\tprintk(\"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t\tif (i % 16 == 0) {\n\t\t\tprintk(\"\\n\");\n\t\t\tadd_newline = 0;\n\t\t} else\n\t\t\tadd_newline = 1;\n\t}\n\tif (add_newline)\n\t\tprintk(\"\\n\");\n}",
          "includes": [
            "#include \"ecryptfs_kernel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ecryptfs_kernel.h\"\n\nvoid ecryptfs_dump_hex(char *data, int bytes)\n{\n\tint i = 0;\n\tint add_newline = 1;\n\n\tif (ecryptfs_verbosity < 1)\n\t\treturn;\n\tif (bytes != 0) {\n\t\tprintk(KERN_DEBUG \"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t}\n\twhile (i < bytes) {\n\t\tprintk(\"0x%.2x.\", (unsigned char)data[i]);\n\t\ti++;\n\t\tif (i % 16 == 0) {\n\t\t\tprintk(\"\\n\");\n\t\t\tadd_newline = 0;\n\t\t} else\n\t\t\tadd_newline = 1;\n\t}\n\tif (add_newline)\n\t\tprintk(\"\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "ecryptfs_printk",
          "args": [
            "KERN_DEBUG",
            "\" * Encrypted session key \"\n\t\t\t\t\"dump:\\n\""
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "__ecryptfs_printk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ecryptfs/main.c",
          "lines": "86-96",
          "snippet": "void __ecryptfs_printk(const char *fmt, ...)\n{\n\tva_list args;\n\tva_start(args, fmt);\n\tif (fmt[1] == '7') { /* KERN_DEBUG */\n\t\tif (ecryptfs_verbosity >= 1)\n\t\t\tvprintk(fmt, args);\n\t} else\n\t\tvprintk(fmt, args);\n\tva_end(args);\n}",
          "includes": [
            "#include \"ecryptfs_kernel.h\"",
            "#include <linux/magic.h>",
            "#include <linux/slab.h>",
            "#include <linux/fs_stack.h>",
            "#include <linux/parser.h>",
            "#include <linux/key.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mount.h>",
            "#include <linux/crypto.h>",
            "#include <linux/skbuff.h>",
            "#include <linux/namei.h>",
            "#include <linux/module.h>",
            "#include <linux/file.h>",
            "#include <linux/dcache.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "int ecryptfs_verbosity = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"ecryptfs_kernel.h\"\n#include <linux/magic.h>\n#include <linux/slab.h>\n#include <linux/fs_stack.h>\n#include <linux/parser.h>\n#include <linux/key.h>\n#include <linux/pagemap.h>\n#include <linux/mount.h>\n#include <linux/crypto.h>\n#include <linux/skbuff.h>\n#include <linux/namei.h>\n#include <linux/module.h>\n#include <linux/file.h>\n#include <linux/dcache.h>\n\nint ecryptfs_verbosity = 0;\n\nvoid __ecryptfs_printk(const char *fmt, ...)\n{\n\tva_list args;\n\tva_start(args, fmt);\n\tif (fmt[1] == '7') { /* KERN_DEBUG */\n\t\tif (ecryptfs_verbosity >= 1)\n\t\t\tvprintk(fmt, args);\n\t} else\n\t\tvprintk(fmt, args);\n\tva_end(args);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "sig",
            "auth_tok->token.password.signature",
            "ECRYPTFS_SIG_SIZE_HEX"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ecryptfs_to_hex",
          "args": [
            "salt",
            "auth_tok->token.password.salt",
            "ECRYPTFS_SALT_SIZE"
          ],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "ecryptfs_to_hex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/ecryptfs/crypto.c",
          "lines": "50-56",
          "snippet": "void ecryptfs_to_hex(char *dst, char *src, size_t src_size)\n{\n\tint x;\n\n\tfor (x = 0; x < src_size; x++)\n\t\tsprintf(&dst[x * 2], \"%.2x\", (unsigned char)src[x]);\n}",
          "includes": [
            "#include \"ecryptfs_kernel.h\"",
            "#include <asm/unaligned.h>",
            "#include <linux/slab.h>",
            "#include <linux/scatterlist.h>",
            "#include <linux/file.h>",
            "#include <linux/crypto.h>",
            "#include <linux/namei.h>",
            "#include <linux/key.h>",
            "#include <linux/compiler.h>",
            "#include <linux/random.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/mount.h>",
            "#include <linux/fs.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ecryptfs_kernel.h\"\n#include <asm/unaligned.h>\n#include <linux/slab.h>\n#include <linux/scatterlist.h>\n#include <linux/file.h>\n#include <linux/crypto.h>\n#include <linux/namei.h>\n#include <linux/key.h>\n#include <linux/compiler.h>\n#include <linux/random.h>\n#include <linux/pagemap.h>\n#include <linux/mount.h>\n#include <linux/fs.h>\n\nvoid ecryptfs_to_hex(char *dst, char *src, size_t src_size)\n{\n\tint x;\n\n\tfor (x = 0; x < src_size; x++)\n\t\tsprintf(&dst[x * 2], \"%.2x\", (unsigned char)src[x]);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"ecryptfs_kernel.h\"\n\nvoid ecryptfs_dump_auth_tok(struct ecryptfs_auth_tok *auth_tok)\n{\n\tchar salt[ECRYPTFS_SALT_SIZE * 2 + 1];\n\tchar sig[ECRYPTFS_SIG_SIZE_HEX + 1];\n\n\tecryptfs_printk(KERN_DEBUG, \"Auth tok at mem loc [%p]:\\n\",\n\t\t\tauth_tok);\n\tif (auth_tok->flags & ECRYPTFS_PRIVATE_KEY) {\n\t\tecryptfs_printk(KERN_DEBUG, \" * private key type\\n\");\n\t} else {\n\t\tecryptfs_printk(KERN_DEBUG, \" * passphrase type\\n\");\n\t\tecryptfs_to_hex(salt, auth_tok->token.password.salt,\n\t\t\t\tECRYPTFS_SALT_SIZE);\n\t\tsalt[ECRYPTFS_SALT_SIZE * 2] = '\\0';\n\t\tecryptfs_printk(KERN_DEBUG, \" * salt = [%s]\\n\", salt);\n\t\tif (auth_tok->token.password.flags &\n\t\t    ECRYPTFS_PERSISTENT_PASSWORD) {\n\t\t\tecryptfs_printk(KERN_DEBUG, \" * persistent\\n\");\n\t\t}\n\t\tmemcpy(sig, auth_tok->token.password.signature,\n\t\t       ECRYPTFS_SIG_SIZE_HEX);\n\t\tsig[ECRYPTFS_SIG_SIZE_HEX] = '\\0';\n\t\tecryptfs_printk(KERN_DEBUG, \" * signature = [%s]\\n\", sig);\n\t}\n\tecryptfs_printk(KERN_DEBUG, \" * session_key.flags = [0x%x]\\n\",\n\t\t\tauth_tok->session_key.flags);\n\tif (auth_tok->session_key.flags\n\t    & ECRYPTFS_USERSPACE_SHOULD_TRY_TO_DECRYPT)\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * Userspace decrypt request set\\n\");\n\tif (auth_tok->session_key.flags\n\t    & ECRYPTFS_USERSPACE_SHOULD_TRY_TO_ENCRYPT)\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * Userspace encrypt request set\\n\");\n\tif (auth_tok->session_key.flags & ECRYPTFS_CONTAINS_DECRYPTED_KEY) {\n\t\tecryptfs_printk(KERN_DEBUG, \" * Contains decrypted key\\n\");\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * session_key.decrypted_key_size = [0x%x]\\n\",\n\t\t\t\tauth_tok->session_key.decrypted_key_size);\n\t\tecryptfs_printk(KERN_DEBUG, \" * Decrypted session key \"\n\t\t\t\t\"dump:\\n\");\n\t\tif (ecryptfs_verbosity > 0)\n\t\t\tecryptfs_dump_hex(auth_tok->session_key.decrypted_key,\n\t\t\t\t\t  ECRYPTFS_DEFAULT_KEY_BYTES);\n\t}\n\tif (auth_tok->session_key.flags & ECRYPTFS_CONTAINS_ENCRYPTED_KEY) {\n\t\tecryptfs_printk(KERN_DEBUG, \" * Contains encrypted key\\n\");\n\t\tecryptfs_printk(KERN_DEBUG,\n\t\t\t\t\" * session_key.encrypted_key_size = [0x%x]\\n\",\n\t\t\t\tauth_tok->session_key.encrypted_key_size);\n\t\tecryptfs_printk(KERN_DEBUG, \" * Encrypted session key \"\n\t\t\t\t\"dump:\\n\");\n\t\tif (ecryptfs_verbosity > 0)\n\t\t\tecryptfs_dump_hex(auth_tok->session_key.encrypted_key,\n\t\t\t\t\t  auth_tok->session_key.\n\t\t\t\t\t  encrypted_key_size);\n\t}\n}"
  }
]