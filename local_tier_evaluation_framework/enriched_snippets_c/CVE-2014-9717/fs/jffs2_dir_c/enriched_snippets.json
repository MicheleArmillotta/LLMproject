[
  {
    "function_name": "fs2_rename (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "759-861",
    "snippet": "atic int jffs2_rename (struct inode *old_dir_i, struct dentry *old_dentry,\n\t\t\t struct inode *new_dir_i, struct dentry *new_dentry)\n{\n\tint ret;\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(old_dir_i->i_sb);\n\tstruct jffs2_inode_info *victim_f = NULL;\n\tuint8_t type;\n\tuint32_t now;\n\n\t/* The VFS will check for us and prevent trying to rename a\n\t * file over a directory and vice versa, but if it's a directory,\n\t * the VFS can't check whether the victim is empty. The filesystem\n\t * needs to do that for itself.\n\t */\n\tif (new_dentry->d_inode) {\n\t\tvictim_f = JFFS2_INODE_INFO(new_dentry->d_inode);\n\t\tif (d_is_dir(new_dentry)) {\n\t\t\tstruct jffs2_full_dirent *fd;\n\n\t\t\tmutex_lock(&victim_f->sem);\n\t\t\tfor (fd = victim_f->dents; fd; fd = fd->next) {\n\t\t\t\tif (fd->ino) {\n\t\t\t\t\tmutex_unlock(&victim_f->sem);\n\t\t\t\t\treturn -ENOTEMPTY;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmutex_unlock(&victim_f->sem);\n\t\t}\n\t}\n\n\t/* XXX: We probably ought to alloc enough space for\n\t   both nodes at the same time. Writing the new link,\n\t   then getting -ENOSPC, is quite bad :)\n\t*/\n\n\t/* Make a hard link */\n\n\t/* XXX: This is ugly */\n\ttype = (old_dentry->d_inode->i_mode & S_IFMT) >> 12;\n\tif (!type) type = DT_REG;\n\n\tnow = get_seconds();\n\tret = jffs2_do_link(c, JFFS2_INODE_INFO(new_dir_i),\n\t\t\t    old_dentry->d_inode->i_ino, type,\n\t\t\t    new_dentry->d_name.name, new_dentry->d_name.len, now);\n\n\tif (ret)\n\t\treturn ret;\n\n\tif (victim_f) {\n\t\t/* There was a victim. Kill it off nicely */\n\t\tif (d_is_dir(new_dentry))\n\t\t\tclear_nlink(new_dentry->d_inode);\n\t\telse\n\t\t\tdrop_nlink(new_dentry->d_inode);\n\t\t/* Don't oops if the victim was a dirent pointing to an\n\t\t   inode which didn't exist. */\n\t\tif (victim_f->inocache) {\n\t\t\tmutex_lock(&victim_f->sem);\n\t\t\tif (d_is_dir(new_dentry))\n\t\t\t\tvictim_f->inocache->pino_nlink = 0;\n\t\t\telse\n\t\t\t\tvictim_f->inocache->pino_nlink--;\n\t\t\tmutex_unlock(&victim_f->sem);\n\t\t}\n\t}\n\n\t/* If it was a directory we moved, and there was no victim,\n\t   increase i_nlink on its new parent */\n\tif (d_is_dir(old_dentry) && !victim_f)\n\t\tinc_nlink(new_dir_i);\n\n\t/* Unlink the original */\n\tret = jffs2_do_unlink(c, JFFS2_INODE_INFO(old_dir_i),\n\t\t\t      old_dentry->d_name.name, old_dentry->d_name.len, NULL, now);\n\n\t/* We don't touch inode->i_nlink */\n\n\tif (ret) {\n\t\t/* Oh shit. We really ought to make a single node which can do both atomically */\n\t\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(old_dentry->d_inode);\n\t\tmutex_lock(&f->sem);\n\t\tinc_nlink(old_dentry->d_inode);\n\t\tif (f->inocache && !d_is_dir(old_dentry))\n\t\t\tf->inocache->pino_nlink++;\n\t\tmutex_unlock(&f->sem);\n\n\t\tpr_notice(\"%s(): Link succeeded, unlink failed (err %d). You now have a hard link\\n\",\n\t\t\t  __func__, ret);\n\t\t/* Might as well let the VFS know */\n\t\td_instantiate(new_dentry, old_dentry->d_inode);\n\t\tihold(old_dentry->d_inode);\n\t\tnew_dir_i->i_mtime = new_dir_i->i_ctime = ITIME(now);\n\t\treturn ret;\n\t}\n\n\tif (d_is_dir(old_dentry))\n\t\tdrop_nlink(old_dir_i);\n\n\tnew_dir_i->i_mtime = new_dir_i->i_ctime = old_dir_i->i_mtime = old_dir_i->i_ctime = ITIME(now);\n\n\treturn 0;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns",
      "atic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns",
      "atic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns",
      "atic int jffs2_unlink (struct inode *,struct dentry *);\ns",
      "atic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns",
      "atic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns",
      "atic int jffs2_rmdir (struct inode *,struct dentry *);\ns",
      "atic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns",
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "IME(n",
          "args": [
            "w);"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "op_nlink(o",
          "args": [
            "d_dir_i);"
          ],
          "line": 856
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(o",
          "args": [
            "d_dentry))"
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(n",
          "args": [
            "w);"
          ],
          "line": 851
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old(o",
          "args": [
            "d_dentry->d_inode);"
          ],
          "line": 850
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "instantiate(n",
          "args": [
            "w_dentry,",
            "d_dentry->d_inode);"
          ],
          "line": 849
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_notice(\"",
          "args": [
            "s(): Link succeeded, unlink failed (err %d). You now have a hard link\\n\",",
            "func__,",
            "t);"
          ],
          "line": 846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 844
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(o",
          "args": [
            "d_dentry))"
          ],
          "line": 842
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c_nlink(o",
          "args": [
            "d_dentry->d_inode);"
          ],
          "line": 841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "->sem);"
          ],
          "line": 840
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(o",
          "args": [
            "d_dentry->d_inode);"
          ],
          "line": 839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_unlink(c",
          "args": [
            "FS2_INODE_INFO(old_dir_i),",
            "d_dentry->d_name.name,",
            "d_dentry->d_name.len,",
            "LL,",
            "w);"
          ],
          "line": 832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(o",
          "args": [
            "d_dir_i),"
          ],
          "line": 832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c_nlink(n",
          "args": [
            "w_dir_i);"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(o",
          "args": [
            "d_dentry)"
          ],
          "line": 828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ictim_f->sem);"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(n",
          "args": [
            "w_dentry))"
          ],
          "line": 818
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "ictim_f->sem);"
          ],
          "line": 817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "op_nlink(n",
          "args": [
            "w_dentry->d_inode);"
          ],
          "line": 813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ear_nlink(n",
          "args": [
            "w_dentry->d_inode);"
          ],
          "line": 811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(n",
          "args": [
            "w_dentry))"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_link(c",
          "args": [
            "FS2_INODE_INFO(new_dir_i),",
            "d_dentry->d_inode->i_ino,",
            "pe,",
            "w_dentry->d_name.name,",
            "w_dentry->d_name.len,",
            "w);"
          ],
          "line": 801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(n",
          "args": [
            "w_dir_i),"
          ],
          "line": 801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ictim_f->sem);"
          ],
          "line": 785
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ictim_f->sem);"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "ictim_f->sem);"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(n",
          "args": [
            "w_dentry))"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(n",
          "args": [
            "w_dentry->d_inode);"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(o",
          "args": [
            "d_dir_i->i_sb);"
          ],
          "line": 763
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns;\natic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns;\natic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns;\natic int jffs2_unlink (struct inode *,struct dentry *);\ns;\natic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns;\natic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns;\natic int jffs2_rmdir (struct inode *,struct dentry *);\ns;\natic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns;\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_rename (struct inode *old_dir_i, struct dentry *old_dentry,\n\t\t\t struct inode *new_dir_i, struct dentry *new_dentry)\n{\n\tint ret;\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(old_dir_i->i_sb);\n\tstruct jffs2_inode_info *victim_f = NULL;\n\tuint8_t type;\n\tuint32_t now;\n\n\t/* The VFS will check for us and prevent trying to rename a\n\t * file over a directory and vice versa, but if it's a directory,\n\t * the VFS can't check whether the victim is empty. The filesystem\n\t * needs to do that for itself.\n\t */\n\tif (new_dentry->d_inode) {\n\t\tvictim_f = JFFS2_INODE_INFO(new_dentry->d_inode);\n\t\tif (d_is_dir(new_dentry)) {\n\t\t\tstruct jffs2_full_dirent *fd;\n\n\t\t\tmutex_lock(&victim_f->sem);\n\t\t\tfor (fd = victim_f->dents; fd; fd = fd->next) {\n\t\t\t\tif (fd->ino) {\n\t\t\t\t\tmutex_unlock(&victim_f->sem);\n\t\t\t\t\treturn -ENOTEMPTY;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmutex_unlock(&victim_f->sem);\n\t\t}\n\t}\n\n\t/* XXX: We probably ought to alloc enough space for\n\t   both nodes at the same time. Writing the new link,\n\t   then getting -ENOSPC, is quite bad :)\n\t*/\n\n\t/* Make a hard link */\n\n\t/* XXX: This is ugly */\n\ttype = (old_dentry->d_inode->i_mode & S_IFMT) >> 12;\n\tif (!type) type = DT_REG;\n\n\tnow = get_seconds();\n\tret = jffs2_do_link(c, JFFS2_INODE_INFO(new_dir_i),\n\t\t\t    old_dentry->d_inode->i_ino, type,\n\t\t\t    new_dentry->d_name.name, new_dentry->d_name.len, now);\n\n\tif (ret)\n\t\treturn ret;\n\n\tif (victim_f) {\n\t\t/* There was a victim. Kill it off nicely */\n\t\tif (d_is_dir(new_dentry))\n\t\t\tclear_nlink(new_dentry->d_inode);\n\t\telse\n\t\t\tdrop_nlink(new_dentry->d_inode);\n\t\t/* Don't oops if the victim was a dirent pointing to an\n\t\t   inode which didn't exist. */\n\t\tif (victim_f->inocache) {\n\t\t\tmutex_lock(&victim_f->sem);\n\t\t\tif (d_is_dir(new_dentry))\n\t\t\t\tvictim_f->inocache->pino_nlink = 0;\n\t\t\telse\n\t\t\t\tvictim_f->inocache->pino_nlink--;\n\t\t\tmutex_unlock(&victim_f->sem);\n\t\t}\n\t}\n\n\t/* If it was a directory we moved, and there was no victim,\n\t   increase i_nlink on its new parent */\n\tif (d_is_dir(old_dentry) && !victim_f)\n\t\tinc_nlink(new_dir_i);\n\n\t/* Unlink the original */\n\tret = jffs2_do_unlink(c, JFFS2_INODE_INFO(old_dir_i),\n\t\t\t      old_dentry->d_name.name, old_dentry->d_name.len, NULL, now);\n\n\t/* We don't touch inode->i_nlink */\n\n\tif (ret) {\n\t\t/* Oh shit. We really ought to make a single node which can do both atomically */\n\t\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(old_dentry->d_inode);\n\t\tmutex_lock(&f->sem);\n\t\tinc_nlink(old_dentry->d_inode);\n\t\tif (f->inocache && !d_is_dir(old_dentry))\n\t\t\tf->inocache->pino_nlink++;\n\t\tmutex_unlock(&f->sem);\n\n\t\tpr_notice(\"%s(): Link succeeded, unlink failed (err %d). You now have a hard link\\n\",\n\t\t\t  __func__, ret);\n\t\t/* Might as well let the VFS know */\n\t\td_instantiate(new_dentry, old_dentry->d_inode);\n\t\tihold(old_dentry->d_inode);\n\t\tnew_dir_i->i_mtime = new_dir_i->i_ctime = ITIME(now);\n\t\treturn ret;\n\t}\n\n\tif (d_is_dir(old_dentry))\n\t\tdrop_nlink(old_dir_i);\n\n\tnew_dir_i->i_mtime = new_dir_i->i_ctime = old_dir_i->i_mtime = old_dir_i->i_ctime = ITIME(now);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "fs2_mknod (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "608-757",
    "snippet": "atic int jffs2_mknod (struct inode *dir_i, struct dentry *dentry, umode_t mode, dev_t rdev)\n{\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_raw_dirent *rd;\n\tstruct jffs2_full_dnode *fn;\n\tstruct jffs2_full_dirent *fd;\n\tint namelen;\n\tunion jffs2_device_node dev;\n\tint devlen = 0;\n\tuint32_t alloclen;\n\tint ret;\n\n\tif (!new_valid_dev(rdev))\n\t\treturn -EINVAL;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\tif (S_ISBLK(mode) || S_ISCHR(mode))\n\t\tdevlen = jffs2_encode_dev(&dev, rdev);\n\n\t/* Try to reserve enough space for both node and dirent.\n\t * Just the node will do for now, though\n\t */\n\tnamelen = dentry->d_name.len;\n\tret = jffs2_reserve_space(c, sizeof(*ri) + devlen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_INODE_SIZE);\n\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn ret;\n\t}\n\n\tinode = jffs2_new_inode(dir_i, mode, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tjffs2_complete_reservation(c);\n\t\treturn PTR_ERR(inode);\n\t}\n\tinode->i_op = &jffs2_file_inode_operations;\n\tinit_special_inode(inode, inode->i_mode, rdev);\n\n\tf = JFFS2_INODE_INFO(inode);\n\n\tri->dsize = ri->csize = cpu_to_je32(devlen);\n\tri->totlen = cpu_to_je32(sizeof(*ri) + devlen);\n\tri->hdr_crc = cpu_to_je32(crc32(0, ri, sizeof(struct jffs2_unknown_node)-4));\n\n\tri->compr = JFFS2_COMPR_NONE;\n\tri->data_crc = cpu_to_je32(crc32(0, &dev, devlen));\n\tri->node_crc = cpu_to_je32(crc32(0, ri, sizeof(*ri)-8));\n\n\tfn = jffs2_write_dnode(c, f, ri, (char *)&dev, devlen, ALLOC_NORMAL);\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (IS_ERR(fn)) {\n\t\t/* Eeek. Wave bye bye */\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = PTR_ERR(fn);\n\t\tgoto fail;\n\t}\n\t/* No data here. Only a metadata node, which will be\n\t   obsoleted by the first data write\n\t*/\n\tf->metadata = fn;\n\tmutex_unlock(&f->sem);\n\n\tjffs2_complete_reservation(c);\n\n\tret = jffs2_init_security(inode, dir_i, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_init_acl_post(inode);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_reserve_space(c, sizeof(*rd)+namelen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_DIRENT_SIZE(namelen));\n\tif (ret)\n\t\tgoto fail;\n\n\trd = jffs2_alloc_raw_dirent();\n\tif (!rd) {\n\t\t/* Argh. Now we treat it like a normal delete */\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\tmutex_lock(&dir_f->sem);\n\n\trd->magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\trd->nodetype = cpu_to_je16(JFFS2_NODETYPE_DIRENT);\n\trd->totlen = cpu_to_je32(sizeof(*rd) + namelen);\n\trd->hdr_crc = cpu_to_je32(crc32(0, rd, sizeof(struct jffs2_unknown_node)-4));\n\n\trd->pino = cpu_to_je32(dir_i->i_ino);\n\trd->version = cpu_to_je32(++dir_f->highest_version);\n\trd->ino = cpu_to_je32(inode->i_ino);\n\trd->mctime = cpu_to_je32(get_seconds());\n\trd->nsize = namelen;\n\n\t/* XXX: This is ugly. */\n\trd->type = (mode & S_IFMT) >> 12;\n\n\trd->node_crc = cpu_to_je32(crc32(0, rd, sizeof(*rd)-8));\n\trd->name_crc = cpu_to_je32(crc32(0, dentry->d_name.name, namelen));\n\n\tfd = jffs2_write_dirent(c, dir_f, rd, dentry->d_name.name, namelen, ALLOC_NORMAL);\n\n\tif (IS_ERR(fd)) {\n\t\t/* dirent failed to write. Delete the inode normally\n\t\t   as if it were the final unlink() */\n\t\tjffs2_complete_reservation(c);\n\t\tjffs2_free_raw_dirent(rd);\n\t\tmutex_unlock(&dir_f->sem);\n\t\tret = PTR_ERR(fd);\n\t\tgoto fail;\n\t}\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(rd->mctime));\n\n\tjffs2_free_raw_dirent(rd);\n\n\t/* Link the fd into the inode's list, obsoleting an old\n\t   one if necessary. */\n\tjffs2_add_fd_to_list(c, fd, &dir_f->dents);\n\n\tmutex_unlock(&dir_f->sem);\n\tjffs2_complete_reservation(c);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns",
      "atic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns",
      "atic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns",
      "atic int jffs2_unlink (struct inode *,struct dentry *);\ns",
      "atic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns",
      "atic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns",
      "atic int jffs2_rmdir (struct inode *,struct dentry *);\ns",
      "atic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns",
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "et_failed(i",
          "args": [
            "ode);"
          ],
          "line": 755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "instantiate(d",
          "args": [
            "ntry,",
            "ode);"
          ],
          "line": 751
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_new_inode(i",
          "args": [
            "ode);"
          ],
          "line": 750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_add_fd_to_list(c",
          "args": [
            ",",
            "ir_f->dents);"
          ],
          "line": 745
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_dirent(r",
          "args": [
            ");"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(j",
          "args": [
            "32_to_cpu(rd->mctime));"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "32_to_cpu(r",
          "args": [
            "->mctime))"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 734
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_dirent(r",
          "args": [
            ");"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 732
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dirent(c",
          "args": [
            "r_f,",
            ",",
            "ntry->d_name.name,",
            "melen,",
            "LOC_NORMAL);"
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, dentry->d_name.name, namelen));"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "ntry->d_name.name,",
            "melen))"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, rd, sizeof(*rd)-8));"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(*rd)-8))"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(g",
          "args": [
            "t_seconds());"
          ],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(i",
          "args": [
            "ode->i_ino);"
          ],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(+",
          "args": [
            "dir_f->highest_version);"
          ],
          "line": 716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(d",
          "args": [
            "r_i->i_ino);"
          ],
          "line": 715
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, rd, sizeof(struct jffs2_unknown_node)-4));"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(struct jffs2_unknown_node)-4))"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(s",
          "args": [
            "zeof(*rd) + namelen);"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_NODETYPE_DIRENT);"
          ],
          "line": 711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_MAGIC_BITMASK);"
          ],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 708
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_dirent()",
          "args": [],
          "line": 699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(*rd)+namelen,",
            "lloclen,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_DIRENT_SIZE(namelen));"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SUMMARY_DIRENT_SIZE(n",
          "args": [
            "melen))"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_init_acl_post(i",
          "args": [
            "ode);"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_init_security(i",
          "args": [
            "ode,",
            "r_i,",
            "entry->d_name);"
          ],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dnode(c",
          "args": [
            ",",
            "har *)&dev,",
            "vlen,",
            "LOC_NORMAL);"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, ri, sizeof(*ri)-8));"
          ],
          "line": 665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(*ri)-8))"
          ],
          "line": 665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, &dev, devlen));"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "ev,",
            "vlen))"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, ri, sizeof(struct jffs2_unknown_node)-4));"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(struct jffs2_unknown_node)-4))"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(s",
          "args": [
            "zeof(*ri) + devlen);"
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(d",
          "args": [
            "vlen);"
          ],
          "line": 659
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 657
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "it_special_inode(i",
          "args": [
            "ode,",
            "ode->i_mode,",
            "ev);"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(i",
          "args": [
            "ode);"
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(i",
          "args": [
            "ode))"
          ],
          "line": 649
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_new_inode(d",
          "args": [
            "r_i,",
            "de,",
            ");"
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 643
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(*ri) + devlen,",
            "lloclen,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_INODE_SIZE);"
          ],
          "line": 639
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_encode_dev(&",
          "args": [
            "ev,",
            "ev);"
          ],
          "line": 633
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISCHR(m",
          "args": [
            "de))"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ISBLK(m",
          "args": [
            "de)"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(d",
          "args": [
            "r_i->i_sb);"
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_inode()",
          "args": [],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_valid_dev(r",
          "args": [
            "ev))"
          ],
          "line": 623
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns;\natic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns;\natic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns;\natic int jffs2_unlink (struct inode *,struct dentry *);\ns;\natic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns;\natic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns;\natic int jffs2_rmdir (struct inode *,struct dentry *);\ns;\natic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns;\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_mknod (struct inode *dir_i, struct dentry *dentry, umode_t mode, dev_t rdev)\n{\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_raw_dirent *rd;\n\tstruct jffs2_full_dnode *fn;\n\tstruct jffs2_full_dirent *fd;\n\tint namelen;\n\tunion jffs2_device_node dev;\n\tint devlen = 0;\n\tuint32_t alloclen;\n\tint ret;\n\n\tif (!new_valid_dev(rdev))\n\t\treturn -EINVAL;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\tif (S_ISBLK(mode) || S_ISCHR(mode))\n\t\tdevlen = jffs2_encode_dev(&dev, rdev);\n\n\t/* Try to reserve enough space for both node and dirent.\n\t * Just the node will do for now, though\n\t */\n\tnamelen = dentry->d_name.len;\n\tret = jffs2_reserve_space(c, sizeof(*ri) + devlen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_INODE_SIZE);\n\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn ret;\n\t}\n\n\tinode = jffs2_new_inode(dir_i, mode, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tjffs2_complete_reservation(c);\n\t\treturn PTR_ERR(inode);\n\t}\n\tinode->i_op = &jffs2_file_inode_operations;\n\tinit_special_inode(inode, inode->i_mode, rdev);\n\n\tf = JFFS2_INODE_INFO(inode);\n\n\tri->dsize = ri->csize = cpu_to_je32(devlen);\n\tri->totlen = cpu_to_je32(sizeof(*ri) + devlen);\n\tri->hdr_crc = cpu_to_je32(crc32(0, ri, sizeof(struct jffs2_unknown_node)-4));\n\n\tri->compr = JFFS2_COMPR_NONE;\n\tri->data_crc = cpu_to_je32(crc32(0, &dev, devlen));\n\tri->node_crc = cpu_to_je32(crc32(0, ri, sizeof(*ri)-8));\n\n\tfn = jffs2_write_dnode(c, f, ri, (char *)&dev, devlen, ALLOC_NORMAL);\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (IS_ERR(fn)) {\n\t\t/* Eeek. Wave bye bye */\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = PTR_ERR(fn);\n\t\tgoto fail;\n\t}\n\t/* No data here. Only a metadata node, which will be\n\t   obsoleted by the first data write\n\t*/\n\tf->metadata = fn;\n\tmutex_unlock(&f->sem);\n\n\tjffs2_complete_reservation(c);\n\n\tret = jffs2_init_security(inode, dir_i, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_init_acl_post(inode);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_reserve_space(c, sizeof(*rd)+namelen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_DIRENT_SIZE(namelen));\n\tif (ret)\n\t\tgoto fail;\n\n\trd = jffs2_alloc_raw_dirent();\n\tif (!rd) {\n\t\t/* Argh. Now we treat it like a normal delete */\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\tmutex_lock(&dir_f->sem);\n\n\trd->magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\trd->nodetype = cpu_to_je16(JFFS2_NODETYPE_DIRENT);\n\trd->totlen = cpu_to_je32(sizeof(*rd) + namelen);\n\trd->hdr_crc = cpu_to_je32(crc32(0, rd, sizeof(struct jffs2_unknown_node)-4));\n\n\trd->pino = cpu_to_je32(dir_i->i_ino);\n\trd->version = cpu_to_je32(++dir_f->highest_version);\n\trd->ino = cpu_to_je32(inode->i_ino);\n\trd->mctime = cpu_to_je32(get_seconds());\n\trd->nsize = namelen;\n\n\t/* XXX: This is ugly. */\n\trd->type = (mode & S_IFMT) >> 12;\n\n\trd->node_crc = cpu_to_je32(crc32(0, rd, sizeof(*rd)-8));\n\trd->name_crc = cpu_to_je32(crc32(0, dentry->d_name.name, namelen));\n\n\tfd = jffs2_write_dirent(c, dir_f, rd, dentry->d_name.name, namelen, ALLOC_NORMAL);\n\n\tif (IS_ERR(fd)) {\n\t\t/* dirent failed to write. Delete the inode normally\n\t\t   as if it were the final unlink() */\n\t\tjffs2_complete_reservation(c);\n\t\tjffs2_free_raw_dirent(rd);\n\t\tmutex_unlock(&dir_f->sem);\n\t\tret = PTR_ERR(fd);\n\t\tgoto fail;\n\t}\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(rd->mctime));\n\n\tjffs2_free_raw_dirent(rd);\n\n\t/* Link the fd into the inode's list, obsoleting an old\n\t   one if necessary. */\n\tjffs2_add_fd_to_list(c, fd, &dir_f->dents);\n\n\tmutex_unlock(&dir_f->sem);\n\tjffs2_complete_reservation(c);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_rmdir (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "584-606",
    "snippet": "atic int jffs2_rmdir (struct inode *dir_i, struct dentry *dentry)\n{\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(dir_i->i_sb);\n\tstruct jffs2_inode_info *dir_f = JFFS2_INODE_INFO(dir_i);\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(dentry->d_inode);\n\tstruct jffs2_full_dirent *fd;\n\tint ret;\n\tuint32_t now = get_seconds();\n\n\tfor (fd = f->dents ; fd; fd = fd->next) {\n\t\tif (fd->ino)\n\t\t\treturn -ENOTEMPTY;\n\t}\n\n\tret = jffs2_do_unlink(c, dir_f, dentry->d_name.name,\n\t\t\t      dentry->d_name.len, f, now);\n\tif (!ret) {\n\t\tdir_i->i_mtime = dir_i->i_ctime = ITIME(now);\n\t\tclear_nlink(dentry->d_inode);\n\t\tdrop_nlink(dir_i);\n\t}\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "op_nlink(d",
          "args": [
            "r_i);"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ear_nlink(d",
          "args": [
            "ntry->d_inode);"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(n",
          "args": [
            "w);"
          ],
          "line": 601
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_unlink(c",
          "args": [
            "r_f,",
            "ntry->d_name.name,",
            "ntry->d_name.len,",
            "w);"
          ],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "ntry->d_inode);"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(d",
          "args": [
            "r_i->i_sb);"
          ],
          "line": 586
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_rmdir (struct inode *dir_i, struct dentry *dentry)\n{\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(dir_i->i_sb);\n\tstruct jffs2_inode_info *dir_f = JFFS2_INODE_INFO(dir_i);\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(dentry->d_inode);\n\tstruct jffs2_full_dirent *fd;\n\tint ret;\n\tuint32_t now = get_seconds();\n\n\tfor (fd = f->dents ; fd; fd = fd->next) {\n\t\tif (fd->ino)\n\t\t\treturn -ENOTEMPTY;\n\t}\n\n\tret = jffs2_do_unlink(c, dir_f, dentry->d_name.name,\n\t\t\t      dentry->d_name.len, f, now);\n\tif (!ret) {\n\t\tdir_i->i_mtime = dir_i->i_ctime = ITIME(now);\n\t\tclear_nlink(dentry->d_inode);\n\t\tdrop_nlink(dir_i);\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_mkdir (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "440-582",
    "snippet": "atic int jffs2_mkdir (struct inode *dir_i, struct dentry *dentry, umode_t mode)\n{\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_raw_dirent *rd;\n\tstruct jffs2_full_dnode *fn;\n\tstruct jffs2_full_dirent *fd;\n\tint namelen;\n\tuint32_t alloclen;\n\tint ret;\n\n\tmode |= S_IFDIR;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\t/* Try to reserve enough space for both node and dirent.\n\t * Just the node will do for now, though\n\t */\n\tnamelen = dentry->d_name.len;\n\tret = jffs2_reserve_space(c, sizeof(*ri), &alloclen, ALLOC_NORMAL,\n\t\t\t\t  JFFS2_SUMMARY_INODE_SIZE);\n\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn ret;\n\t}\n\n\tinode = jffs2_new_inode(dir_i, mode, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tjffs2_complete_reservation(c);\n\t\treturn PTR_ERR(inode);\n\t}\n\n\tinode->i_op = &jffs2_dir_inode_operations;\n\tinode->i_fop = &jffs2_dir_operations;\n\n\tf = JFFS2_INODE_INFO(inode);\n\n\t/* Directories get nlink 2 at start */\n\tset_nlink(inode, 2);\n\t/* but ic->pino_nlink is the parent ino# */\n\tf->inocache->pino_nlink = dir_i->i_ino;\n\n\tri->data_crc = cpu_to_je32(0);\n\tri->node_crc = cpu_to_je32(crc32(0, ri, sizeof(*ri)-8));\n\n\tfn = jffs2_write_dnode(c, f, ri, NULL, 0, ALLOC_NORMAL);\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (IS_ERR(fn)) {\n\t\t/* Eeek. Wave bye bye */\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = PTR_ERR(fn);\n\t\tgoto fail;\n\t}\n\t/* No data here. Only a metadata node, which will be\n\t   obsoleted by the first data write\n\t*/\n\tf->metadata = fn;\n\tmutex_unlock(&f->sem);\n\n\tjffs2_complete_reservation(c);\n\n\tret = jffs2_init_security(inode, dir_i, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_init_acl_post(inode);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_reserve_space(c, sizeof(*rd)+namelen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_DIRENT_SIZE(namelen));\n\tif (ret)\n\t\tgoto fail;\n\n\trd = jffs2_alloc_raw_dirent();\n\tif (!rd) {\n\t\t/* Argh. Now we treat it like a normal delete */\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\tmutex_lock(&dir_f->sem);\n\n\trd->magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\trd->nodetype = cpu_to_je16(JFFS2_NODETYPE_DIRENT);\n\trd->totlen = cpu_to_je32(sizeof(*rd) + namelen);\n\trd->hdr_crc = cpu_to_je32(crc32(0, rd, sizeof(struct jffs2_unknown_node)-4));\n\n\trd->pino = cpu_to_je32(dir_i->i_ino);\n\trd->version = cpu_to_je32(++dir_f->highest_version);\n\trd->ino = cpu_to_je32(inode->i_ino);\n\trd->mctime = cpu_to_je32(get_seconds());\n\trd->nsize = namelen;\n\trd->type = DT_DIR;\n\trd->node_crc = cpu_to_je32(crc32(0, rd, sizeof(*rd)-8));\n\trd->name_crc = cpu_to_je32(crc32(0, dentry->d_name.name, namelen));\n\n\tfd = jffs2_write_dirent(c, dir_f, rd, dentry->d_name.name, namelen, ALLOC_NORMAL);\n\n\tif (IS_ERR(fd)) {\n\t\t/* dirent failed to write. Delete the inode normally\n\t\t   as if it were the final unlink() */\n\t\tjffs2_complete_reservation(c);\n\t\tjffs2_free_raw_dirent(rd);\n\t\tmutex_unlock(&dir_f->sem);\n\t\tret = PTR_ERR(fd);\n\t\tgoto fail;\n\t}\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(rd->mctime));\n\tinc_nlink(dir_i);\n\n\tjffs2_free_raw_dirent(rd);\n\n\t/* Link the fd into the inode's list, obsoleting an old\n\t   one if necessary. */\n\tjffs2_add_fd_to_list(c, fd, &dir_f->dents);\n\n\tmutex_unlock(&dir_f->sem);\n\tjffs2_complete_reservation(c);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns",
      "atic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns",
      "atic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns",
      "atic int jffs2_unlink (struct inode *,struct dentry *);\ns",
      "atic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns",
      "atic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns",
      "atic int jffs2_rmdir (struct inode *,struct dentry *);\ns",
      "atic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns",
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);",
      "nst struct file_operations jffs2_dir_operations =\n{\n\t.read =\t\tgeneric_read_dir,\n\t.iterate =\tjffs2_readdir,\n\t.unlocked_ioctl=jffs2_ioctl,\n\t.fsync =\tjffs2_fsync,\n\t.llseek =\tgeneric_file_llseek,\n};",
      "nst struct inode_operations jffs2_dir_inode_operations =\n{\n\t.create =\tjffs2_create,\n\t.lookup =\tjffs2_lookup,\n\t.link =\t\tjffs2_link,\n\t.unlink =\tjffs2_unlink,\n\t.symlink =\tjffs2_symlink,\n\t.mkdir =\tjffs2_mkdir,\n\t.rmdir =\tjffs2_rmdir,\n\t.mknod =\tjffs2_mknod,\n\t.rename =\tjffs2_rename,\n\t.get_acl =\tjffs2_get_acl,\n\t.set_acl =\tjffs2_set_acl,\n\t.setattr =\tjffs2_setattr,\n\t.setxattr =\tjffs2_setxattr,\n\t.getxattr =\tjffs2_getxattr,\n\t.listxattr =\tjffs2_listxattr,\n\t.removexattr =\tjffs2_removexattr\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "et_failed(i",
          "args": [
            "ode);"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "instantiate(d",
          "args": [
            "ntry,",
            "ode);"
          ],
          "line": 576
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_new_inode(i",
          "args": [
            "ode);"
          ],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_add_fd_to_list(c",
          "args": [
            ",",
            "ir_f->dents);"
          ],
          "line": 570
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_dirent(r",
          "args": [
            ");"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c_nlink(d",
          "args": [
            "r_i);"
          ],
          "line": 564
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(j",
          "args": [
            "32_to_cpu(rd->mctime));"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "32_to_cpu(r",
          "args": [
            "->mctime))"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 559
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 558
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_dirent(r",
          "args": [
            ");"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 556
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dirent(c",
          "args": [
            "r_f,",
            ",",
            "ntry->d_name.name,",
            "melen,",
            "LOC_NORMAL);"
          ],
          "line": 551
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, dentry->d_name.name, namelen));"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "ntry->d_name.name,",
            "melen))"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, rd, sizeof(*rd)-8));"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(*rd)-8))"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(g",
          "args": [
            "t_seconds());"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(i",
          "args": [
            "ode->i_ino);"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(+",
          "args": [
            "dir_f->highest_version);"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(d",
          "args": [
            "r_i->i_ino);"
          ],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, rd, sizeof(struct jffs2_unknown_node)-4));"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(struct jffs2_unknown_node)-4))"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(s",
          "args": [
            "zeof(*rd) + namelen);"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_NODETYPE_DIRENT);"
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_MAGIC_BITMASK);"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_dirent()",
          "args": [],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(*rd)+namelen,",
            "lloclen,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_DIRENT_SIZE(namelen));"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SUMMARY_DIRENT_SIZE(n",
          "args": [
            "melen))"
          ],
          "line": 522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_init_acl_post(i",
          "args": [
            "ode);"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_init_security(i",
          "args": [
            "ode,",
            "r_i,",
            "entry->d_name);"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 496
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dnode(c",
          "args": [
            ",",
            "LL,",
            "LOC_NORMAL);"
          ],
          "line": 494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, ri, sizeof(*ri)-8));"
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(*ri)-8))"
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(0",
          "args": [
            ";"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_nlink(i",
          "args": [
            "ode,",
            ";"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(i",
          "args": [
            "ode);"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(i",
          "args": [
            "ode))"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_new_inode(d",
          "args": [
            "r_i,",
            "de,",
            ");"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(*ri),",
            "lloclen,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_INODE_SIZE);"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(d",
          "args": [
            "r_i->i_sb);"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_inode()",
          "args": [],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns;\natic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns;\natic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns;\natic int jffs2_unlink (struct inode *,struct dentry *);\ns;\natic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns;\natic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns;\natic int jffs2_rmdir (struct inode *,struct dentry *);\ns;\natic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns;\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\nnst struct file_operations jffs2_dir_operations =\n{\n\t.read =\t\tgeneric_read_dir,\n\t.iterate =\tjffs2_readdir,\n\t.unlocked_ioctl=jffs2_ioctl,\n\t.fsync =\tjffs2_fsync,\n\t.llseek =\tgeneric_file_llseek,\n};\nnst struct inode_operations jffs2_dir_inode_operations =\n{\n\t.create =\tjffs2_create,\n\t.lookup =\tjffs2_lookup,\n\t.link =\t\tjffs2_link,\n\t.unlink =\tjffs2_unlink,\n\t.symlink =\tjffs2_symlink,\n\t.mkdir =\tjffs2_mkdir,\n\t.rmdir =\tjffs2_rmdir,\n\t.mknod =\tjffs2_mknod,\n\t.rename =\tjffs2_rename,\n\t.get_acl =\tjffs2_get_acl,\n\t.set_acl =\tjffs2_set_acl,\n\t.setattr =\tjffs2_setattr,\n\t.setxattr =\tjffs2_setxattr,\n\t.getxattr =\tjffs2_getxattr,\n\t.listxattr =\tjffs2_listxattr,\n\t.removexattr =\tjffs2_removexattr\n};\n\natic int jffs2_mkdir (struct inode *dir_i, struct dentry *dentry, umode_t mode)\n{\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_raw_dirent *rd;\n\tstruct jffs2_full_dnode *fn;\n\tstruct jffs2_full_dirent *fd;\n\tint namelen;\n\tuint32_t alloclen;\n\tint ret;\n\n\tmode |= S_IFDIR;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\t/* Try to reserve enough space for both node and dirent.\n\t * Just the node will do for now, though\n\t */\n\tnamelen = dentry->d_name.len;\n\tret = jffs2_reserve_space(c, sizeof(*ri), &alloclen, ALLOC_NORMAL,\n\t\t\t\t  JFFS2_SUMMARY_INODE_SIZE);\n\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn ret;\n\t}\n\n\tinode = jffs2_new_inode(dir_i, mode, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tjffs2_complete_reservation(c);\n\t\treturn PTR_ERR(inode);\n\t}\n\n\tinode->i_op = &jffs2_dir_inode_operations;\n\tinode->i_fop = &jffs2_dir_operations;\n\n\tf = JFFS2_INODE_INFO(inode);\n\n\t/* Directories get nlink 2 at start */\n\tset_nlink(inode, 2);\n\t/* but ic->pino_nlink is the parent ino# */\n\tf->inocache->pino_nlink = dir_i->i_ino;\n\n\tri->data_crc = cpu_to_je32(0);\n\tri->node_crc = cpu_to_je32(crc32(0, ri, sizeof(*ri)-8));\n\n\tfn = jffs2_write_dnode(c, f, ri, NULL, 0, ALLOC_NORMAL);\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (IS_ERR(fn)) {\n\t\t/* Eeek. Wave bye bye */\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = PTR_ERR(fn);\n\t\tgoto fail;\n\t}\n\t/* No data here. Only a metadata node, which will be\n\t   obsoleted by the first data write\n\t*/\n\tf->metadata = fn;\n\tmutex_unlock(&f->sem);\n\n\tjffs2_complete_reservation(c);\n\n\tret = jffs2_init_security(inode, dir_i, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_init_acl_post(inode);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_reserve_space(c, sizeof(*rd)+namelen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_DIRENT_SIZE(namelen));\n\tif (ret)\n\t\tgoto fail;\n\n\trd = jffs2_alloc_raw_dirent();\n\tif (!rd) {\n\t\t/* Argh. Now we treat it like a normal delete */\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\tmutex_lock(&dir_f->sem);\n\n\trd->magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\trd->nodetype = cpu_to_je16(JFFS2_NODETYPE_DIRENT);\n\trd->totlen = cpu_to_je32(sizeof(*rd) + namelen);\n\trd->hdr_crc = cpu_to_je32(crc32(0, rd, sizeof(struct jffs2_unknown_node)-4));\n\n\trd->pino = cpu_to_je32(dir_i->i_ino);\n\trd->version = cpu_to_je32(++dir_f->highest_version);\n\trd->ino = cpu_to_je32(inode->i_ino);\n\trd->mctime = cpu_to_je32(get_seconds());\n\trd->nsize = namelen;\n\trd->type = DT_DIR;\n\trd->node_crc = cpu_to_je32(crc32(0, rd, sizeof(*rd)-8));\n\trd->name_crc = cpu_to_je32(crc32(0, dentry->d_name.name, namelen));\n\n\tfd = jffs2_write_dirent(c, dir_f, rd, dentry->d_name.name, namelen, ALLOC_NORMAL);\n\n\tif (IS_ERR(fd)) {\n\t\t/* dirent failed to write. Delete the inode normally\n\t\t   as if it were the final unlink() */\n\t\tjffs2_complete_reservation(c);\n\t\tjffs2_free_raw_dirent(rd);\n\t\tmutex_unlock(&dir_f->sem);\n\t\tret = PTR_ERR(fd);\n\t\tgoto fail;\n\t}\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(rd->mctime));\n\tinc_nlink(dir_i);\n\n\tjffs2_free_raw_dirent(rd);\n\n\t/* Link the fd into the inode's list, obsoleting an old\n\t   one if necessary. */\n\tjffs2_add_fd_to_list(c, fd, &dir_f->dents);\n\n\tmutex_unlock(&dir_f->sem);\n\tjffs2_complete_reservation(c);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_symlink (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "278-437",
    "snippet": "atic int jffs2_symlink (struct inode *dir_i, struct dentry *dentry, const char *target)\n{\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_raw_dirent *rd;\n\tstruct jffs2_full_dnode *fn;\n\tstruct jffs2_full_dirent *fd;\n\tint namelen;\n\tuint32_t alloclen;\n\tint ret, targetlen = strlen(target);\n\n\t/* FIXME: If you care. We'd need to use frags for the target\n\t   if it grows much more than this */\n\tif (targetlen > 254)\n\t\treturn -ENAMETOOLONG;\n\n\tri = jffs2_alloc_raw_inode();\n\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\t/* Try to reserve enough space for both node and dirent.\n\t * Just the node will do for now, though\n\t */\n\tnamelen = dentry->d_name.len;\n\tret = jffs2_reserve_space(c, sizeof(*ri) + targetlen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_INODE_SIZE);\n\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn ret;\n\t}\n\n\tinode = jffs2_new_inode(dir_i, S_IFLNK | S_IRWXUGO, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tjffs2_complete_reservation(c);\n\t\treturn PTR_ERR(inode);\n\t}\n\n\tinode->i_op = &jffs2_symlink_inode_operations;\n\n\tf = JFFS2_INODE_INFO(inode);\n\n\tinode->i_size = targetlen;\n\tri->isize = ri->dsize = ri->csize = cpu_to_je32(inode->i_size);\n\tri->totlen = cpu_to_je32(sizeof(*ri) + inode->i_size);\n\tri->hdr_crc = cpu_to_je32(crc32(0, ri, sizeof(struct jffs2_unknown_node)-4));\n\n\tri->compr = JFFS2_COMPR_NONE;\n\tri->data_crc = cpu_to_je32(crc32(0, target, targetlen));\n\tri->node_crc = cpu_to_je32(crc32(0, ri, sizeof(*ri)-8));\n\n\tfn = jffs2_write_dnode(c, f, ri, target, targetlen, ALLOC_NORMAL);\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (IS_ERR(fn)) {\n\t\t/* Eeek. Wave bye bye */\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = PTR_ERR(fn);\n\t\tgoto fail;\n\t}\n\n\t/* We use f->target field to store the target path. */\n\tf->target = kmemdup(target, targetlen + 1, GFP_KERNEL);\n\tif (!f->target) {\n\t\tpr_warn(\"Can't allocate %d bytes of memory\\n\", targetlen + 1);\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tjffs2_dbg(1, \"%s(): symlink's target '%s' cached\\n\",\n\t\t  __func__, (char *)f->target);\n\n\t/* No data here. Only a metadata node, which will be\n\t   obsoleted by the first data write\n\t*/\n\tf->metadata = fn;\n\tmutex_unlock(&f->sem);\n\n\tjffs2_complete_reservation(c);\n\n\tret = jffs2_init_security(inode, dir_i, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_init_acl_post(inode);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_reserve_space(c, sizeof(*rd)+namelen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_DIRENT_SIZE(namelen));\n\tif (ret)\n\t\tgoto fail;\n\n\trd = jffs2_alloc_raw_dirent();\n\tif (!rd) {\n\t\t/* Argh. Now we treat it like a normal delete */\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\tmutex_lock(&dir_f->sem);\n\n\trd->magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\trd->nodetype = cpu_to_je16(JFFS2_NODETYPE_DIRENT);\n\trd->totlen = cpu_to_je32(sizeof(*rd) + namelen);\n\trd->hdr_crc = cpu_to_je32(crc32(0, rd, sizeof(struct jffs2_unknown_node)-4));\n\n\trd->pino = cpu_to_je32(dir_i->i_ino);\n\trd->version = cpu_to_je32(++dir_f->highest_version);\n\trd->ino = cpu_to_je32(inode->i_ino);\n\trd->mctime = cpu_to_je32(get_seconds());\n\trd->nsize = namelen;\n\trd->type = DT_LNK;\n\trd->node_crc = cpu_to_je32(crc32(0, rd, sizeof(*rd)-8));\n\trd->name_crc = cpu_to_je32(crc32(0, dentry->d_name.name, namelen));\n\n\tfd = jffs2_write_dirent(c, dir_f, rd, dentry->d_name.name, namelen, ALLOC_NORMAL);\n\n\tif (IS_ERR(fd)) {\n\t\t/* dirent failed to write. Delete the inode normally\n\t\t   as if it were the final unlink() */\n\t\tjffs2_complete_reservation(c);\n\t\tjffs2_free_raw_dirent(rd);\n\t\tmutex_unlock(&dir_f->sem);\n\t\tret = PTR_ERR(fd);\n\t\tgoto fail;\n\t}\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(rd->mctime));\n\n\tjffs2_free_raw_dirent(rd);\n\n\t/* Link the fd into the inode's list, obsoleting an old\n\t   one if necessary. */\n\tjffs2_add_fd_to_list(c, fd, &dir_f->dents);\n\n\tmutex_unlock(&dir_f->sem);\n\tjffs2_complete_reservation(c);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns",
      "atic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns",
      "atic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns",
      "atic int jffs2_unlink (struct inode *,struct dentry *);\ns",
      "atic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns",
      "atic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns",
      "atic int jffs2_rmdir (struct inode *,struct dentry *);\ns",
      "atic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns",
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "et_failed(i",
          "args": [
            "ode);"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "instantiate(d",
          "args": [
            "ntry,",
            "ode);"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_new_inode(i",
          "args": [
            "ode);"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_add_fd_to_list(c",
          "args": [
            ",",
            "ir_f->dents);"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_dirent(r",
          "args": [
            ");"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(j",
          "args": [
            "32_to_cpu(rd->mctime));"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "32_to_cpu(r",
          "args": [
            "->mctime))"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_dirent(r",
          "args": [
            ");"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dirent(c",
          "args": [
            "r_f,",
            ",",
            "ntry->d_name.name,",
            "melen,",
            "LOC_NORMAL);"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, dentry->d_name.name, namelen));"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "ntry->d_name.name,",
            "melen))"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, rd, sizeof(*rd)-8));"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(*rd)-8))"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(g",
          "args": [
            "t_seconds());"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(i",
          "args": [
            "ode->i_ino);"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(+",
          "args": [
            "dir_f->highest_version);"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(d",
          "args": [
            "r_i->i_ino);"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, rd, sizeof(struct jffs2_unknown_node)-4));"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(struct jffs2_unknown_node)-4))"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(s",
          "args": [
            "zeof(*rd) + namelen);"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_NODETYPE_DIRENT);"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je16(J",
          "args": [
            "FS2_MAGIC_BITMASK);"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_dirent()",
          "args": [],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(*rd)+namelen,",
            "lloclen,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_DIRENT_SIZE(namelen));"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SUMMARY_DIRENT_SIZE(n",
          "args": [
            "melen))"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_init_acl_post(i",
          "args": [
            "ode);"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_init_security(i",
          "args": [
            "ode,",
            "r_i,",
            "entry->d_name);"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s(): symlink's target '%s' cached\\n\",",
            "func__,",
            "har *)f->target);"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_warn(\"",
          "args": [
            "an't allocate %d bytes of memory\\n\",",
            "rgetlen + 1);"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "emdup(t",
          "args": [
            "rget,",
            "rgetlen + 1,",
            "P_KERNEL);"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(f",
          "args": [
            ");"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(f",
          "args": [
            "))"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_write_dnode(c",
          "args": [
            ",",
            "rget,",
            "rgetlen,",
            "LOC_NORMAL);"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, ri, sizeof(*ri)-8));"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(*ri)-8))"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, target, targetlen));"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            "rget,",
            "rgetlen))"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(c",
          "args": [
            "c32(0, ri, sizeof(struct jffs2_unknown_node)-4));"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "c32(0",
          "args": [
            ",",
            "zeof(struct jffs2_unknown_node)-4))"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(s",
          "args": [
            "zeof(*ri) + inode->i_size);"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "u_to_je32(i",
          "args": [
            "ode->i_size);"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(i",
          "args": [
            "ode);"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_complete_reservation(c",
          "args": [
            ";"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(i",
          "args": [
            "ode))"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_new_inode(d",
          "args": [
            "r_i,",
            "IFLNK | S_IRWXUGO,",
            ");"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_reserve_space(c",
          "args": [
            "zeof(*ri) + targetlen,",
            "lloclen,",
            "LOC_NORMAL,",
            "FS2_SUMMARY_INODE_SIZE);"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(d",
          "args": [
            "r_i->i_sb);"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_inode()",
          "args": [],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rlen(t",
          "args": [
            "rget);"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns;\natic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns;\natic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns;\natic int jffs2_unlink (struct inode *,struct dentry *);\ns;\natic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns;\natic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns;\natic int jffs2_rmdir (struct inode *,struct dentry *);\ns;\natic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns;\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_symlink (struct inode *dir_i, struct dentry *dentry, const char *target)\n{\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_raw_dirent *rd;\n\tstruct jffs2_full_dnode *fn;\n\tstruct jffs2_full_dirent *fd;\n\tint namelen;\n\tuint32_t alloclen;\n\tint ret, targetlen = strlen(target);\n\n\t/* FIXME: If you care. We'd need to use frags for the target\n\t   if it grows much more than this */\n\tif (targetlen > 254)\n\t\treturn -ENAMETOOLONG;\n\n\tri = jffs2_alloc_raw_inode();\n\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\t/* Try to reserve enough space for both node and dirent.\n\t * Just the node will do for now, though\n\t */\n\tnamelen = dentry->d_name.len;\n\tret = jffs2_reserve_space(c, sizeof(*ri) + targetlen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_INODE_SIZE);\n\n\tif (ret) {\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn ret;\n\t}\n\n\tinode = jffs2_new_inode(dir_i, S_IFLNK | S_IRWXUGO, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_free_raw_inode(ri);\n\t\tjffs2_complete_reservation(c);\n\t\treturn PTR_ERR(inode);\n\t}\n\n\tinode->i_op = &jffs2_symlink_inode_operations;\n\n\tf = JFFS2_INODE_INFO(inode);\n\n\tinode->i_size = targetlen;\n\tri->isize = ri->dsize = ri->csize = cpu_to_je32(inode->i_size);\n\tri->totlen = cpu_to_je32(sizeof(*ri) + inode->i_size);\n\tri->hdr_crc = cpu_to_je32(crc32(0, ri, sizeof(struct jffs2_unknown_node)-4));\n\n\tri->compr = JFFS2_COMPR_NONE;\n\tri->data_crc = cpu_to_je32(crc32(0, target, targetlen));\n\tri->node_crc = cpu_to_je32(crc32(0, ri, sizeof(*ri)-8));\n\n\tfn = jffs2_write_dnode(c, f, ri, target, targetlen, ALLOC_NORMAL);\n\n\tjffs2_free_raw_inode(ri);\n\n\tif (IS_ERR(fn)) {\n\t\t/* Eeek. Wave bye bye */\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = PTR_ERR(fn);\n\t\tgoto fail;\n\t}\n\n\t/* We use f->target field to store the target path. */\n\tf->target = kmemdup(target, targetlen + 1, GFP_KERNEL);\n\tif (!f->target) {\n\t\tpr_warn(\"Can't allocate %d bytes of memory\\n\", targetlen + 1);\n\t\tmutex_unlock(&f->sem);\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tjffs2_dbg(1, \"%s(): symlink's target '%s' cached\\n\",\n\t\t  __func__, (char *)f->target);\n\n\t/* No data here. Only a metadata node, which will be\n\t   obsoleted by the first data write\n\t*/\n\tf->metadata = fn;\n\tmutex_unlock(&f->sem);\n\n\tjffs2_complete_reservation(c);\n\n\tret = jffs2_init_security(inode, dir_i, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_init_acl_post(inode);\n\tif (ret)\n\t\tgoto fail;\n\n\tret = jffs2_reserve_space(c, sizeof(*rd)+namelen, &alloclen,\n\t\t\t\t  ALLOC_NORMAL, JFFS2_SUMMARY_DIRENT_SIZE(namelen));\n\tif (ret)\n\t\tgoto fail;\n\n\trd = jffs2_alloc_raw_dirent();\n\tif (!rd) {\n\t\t/* Argh. Now we treat it like a normal delete */\n\t\tjffs2_complete_reservation(c);\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\tmutex_lock(&dir_f->sem);\n\n\trd->magic = cpu_to_je16(JFFS2_MAGIC_BITMASK);\n\trd->nodetype = cpu_to_je16(JFFS2_NODETYPE_DIRENT);\n\trd->totlen = cpu_to_je32(sizeof(*rd) + namelen);\n\trd->hdr_crc = cpu_to_je32(crc32(0, rd, sizeof(struct jffs2_unknown_node)-4));\n\n\trd->pino = cpu_to_je32(dir_i->i_ino);\n\trd->version = cpu_to_je32(++dir_f->highest_version);\n\trd->ino = cpu_to_je32(inode->i_ino);\n\trd->mctime = cpu_to_je32(get_seconds());\n\trd->nsize = namelen;\n\trd->type = DT_LNK;\n\trd->node_crc = cpu_to_je32(crc32(0, rd, sizeof(*rd)-8));\n\trd->name_crc = cpu_to_je32(crc32(0, dentry->d_name.name, namelen));\n\n\tfd = jffs2_write_dirent(c, dir_f, rd, dentry->d_name.name, namelen, ALLOC_NORMAL);\n\n\tif (IS_ERR(fd)) {\n\t\t/* dirent failed to write. Delete the inode normally\n\t\t   as if it were the final unlink() */\n\t\tjffs2_complete_reservation(c);\n\t\tjffs2_free_raw_dirent(rd);\n\t\tmutex_unlock(&dir_f->sem);\n\t\tret = PTR_ERR(fd);\n\t\tgoto fail;\n\t}\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(rd->mctime));\n\n\tjffs2_free_raw_dirent(rd);\n\n\t/* Link the fd into the inode's list, obsoleting an old\n\t   one if necessary. */\n\tjffs2_add_fd_to_list(c, fd, &dir_f->dents);\n\n\tmutex_unlock(&dir_f->sem);\n\tjffs2_complete_reservation(c);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_link (",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "242-274",
    "snippet": "atic int jffs2_link (struct dentry *old_dentry, struct inode *dir_i, struct dentry *dentry)\n{\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(old_dentry->d_inode->i_sb);\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(old_dentry->d_inode);\n\tstruct jffs2_inode_info *dir_f = JFFS2_INODE_INFO(dir_i);\n\tint ret;\n\tuint8_t type;\n\tuint32_t now;\n\n\t/* Don't let people make hard links to bad inodes. */\n\tif (!f->inocache)\n\t\treturn -EIO;\n\n\tif (d_is_dir(old_dentry))\n\t\treturn -EPERM;\n\n\t/* XXX: This is ugly */\n\ttype = (old_dentry->d_inode->i_mode & S_IFMT) >> 12;\n\tif (!type) type = DT_REG;\n\n\tnow = get_seconds();\n\tret = jffs2_do_link(c, dir_f, f->inocache->ino, type, dentry->d_name.name, dentry->d_name.len, now);\n\n\tif (!ret) {\n\t\tmutex_lock(&f->sem);\n\t\tset_nlink(old_dentry->d_inode, ++f->inocache->pino_nlink);\n\t\tmutex_unlock(&f->sem);\n\t\td_instantiate(dentry, old_dentry->d_inode);\n\t\tdir_i->i_mtime = dir_i->i_ctime = ITIME(now);\n\t\tihold(old_dentry->d_inode);\n\t}\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "old(o",
          "args": [
            "d_dentry->d_inode);"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(n",
          "args": [
            "w);"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "instantiate(d",
          "args": [
            "ntry,",
            "d_dentry->d_inode);"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_nlink(o",
          "args": [
            "d_dentry->d_inode,",
            "f->inocache->pino_nlink);"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "->sem);"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_link(c",
          "args": [
            "r_f,",
            ">inocache->ino,",
            "pe,",
            "ntry->d_name.name,",
            "ntry->d_name.len,",
            "w);"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_dir(o",
          "args": [
            "d_dentry))"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(o",
          "args": [
            "d_dentry->d_inode);"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(o",
          "args": [
            "d_dentry->d_inode->i_sb);"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_link (struct dentry *old_dentry, struct inode *dir_i, struct dentry *dentry)\n{\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(old_dentry->d_inode->i_sb);\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(old_dentry->d_inode);\n\tstruct jffs2_inode_info *dir_f = JFFS2_INODE_INFO(dir_i);\n\tint ret;\n\tuint8_t type;\n\tuint32_t now;\n\n\t/* Don't let people make hard links to bad inodes. */\n\tif (!f->inocache)\n\t\treturn -EIO;\n\n\tif (d_is_dir(old_dentry))\n\t\treturn -EPERM;\n\n\t/* XXX: This is ugly */\n\ttype = (old_dentry->d_inode->i_mode & S_IFMT) >> 12;\n\tif (!type) type = DT_REG;\n\n\tnow = get_seconds();\n\tret = jffs2_do_link(c, dir_f, f->inocache->ino, type, dentry->d_name.name, dentry->d_name.len, now);\n\n\tif (!ret) {\n\t\tmutex_lock(&f->sem);\n\t\tset_nlink(old_dentry->d_inode, ++f->inocache->pino_nlink);\n\t\tmutex_unlock(&f->sem);\n\t\td_instantiate(dentry, old_dentry->d_inode);\n\t\tdir_i->i_mtime = dir_i->i_ctime = ITIME(now);\n\t\tihold(old_dentry->d_inode);\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_unlink(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "223-238",
    "snippet": "atic int jffs2_unlink(struct inode *dir_i, struct dentry *dentry)\n{\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(dir_i->i_sb);\n\tstruct jffs2_inode_info *dir_f = JFFS2_INODE_INFO(dir_i);\n\tstruct jffs2_inode_info *dead_f = JFFS2_INODE_INFO(dentry->d_inode);\n\tint ret;\n\tuint32_t now = get_seconds();\n\n\tret = jffs2_do_unlink(c, dir_f, dentry->d_name.name,\n\t\t\t      dentry->d_name.len, dead_f, now);\n\tif (dead_f->inocache)\n\t\tset_nlink(dentry->d_inode, dead_f->inocache->pino_nlink);\n\tif (!ret)\n\t\tdir_i->i_mtime = dir_i->i_ctime = ITIME(now);\n\treturn ret;\n}\n/",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "IME(n",
          "args": [
            "w);"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_nlink(d",
          "args": [
            "ntry->d_inode,",
            "ad_f->inocache->pino_nlink);"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_unlink(c",
          "args": [
            "r_f,",
            "ntry->d_name.name,",
            "ntry->d_name.len,",
            "ad_f,",
            "w);"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t_seconds()",
          "args": [],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "ntry->d_inode);"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(d",
          "args": [
            "r_i->i_sb);"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_unlink(struct inode *dir_i, struct dentry *dentry)\n{\n\tstruct jffs2_sb_info *c = JFFS2_SB_INFO(dir_i->i_sb);\n\tstruct jffs2_inode_info *dir_f = JFFS2_INODE_INFO(dir_i);\n\tstruct jffs2_inode_info *dead_f = JFFS2_INODE_INFO(dentry->d_inode);\n\tint ret;\n\tuint32_t now = get_seconds();\n\n\tret = jffs2_do_unlink(c, dir_f, dentry->d_name.name,\n\t\t\t      dentry->d_name.len, dead_f, now);\n\tif (dead_f->inocache)\n\t\tset_nlink(dentry->d_inode, dead_f->inocache->pino_nlink);\n\tif (!ret)\n\t\tdir_i->i_mtime = dir_i->i_ctime = ITIME(now);\n\treturn ret;\n}\n/"
  },
  {
    "function_name": "fs2_create(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "158-218",
    "snippet": "atic int jffs2_create(struct inode *dir_i, struct dentry *dentry,\n\t\t\tumode_t mode, bool excl)\n{\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tint ret;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\tjffs2_dbg(1, \"%s()\\n\", __func__);\n\n\tinode = jffs2_new_inode(dir_i, mode, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_dbg(1, \"jffs2_new_inode() failed\\n\");\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn PTR_ERR(inode);\n\t}\n\n\tinode->i_op = &jffs2_file_inode_operations;\n\tinode->i_fop = &jffs2_file_operations;\n\tinode->i_mapping->a_ops = &jffs2_file_address_operations;\n\tinode->i_mapping->nrpages = 0;\n\n\tf = JFFS2_INODE_INFO(inode);\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\n\t/* jffs2_do_create() will want to lock it, _after_ reserving\n\t   space and taking c-alloc_sem. If we keep it locked here,\n\t   lockdep gets unhappy (although it's a false positive;\n\t   nothing else will be looking at this inode yet so there's\n\t   no chance of AB-BA deadlock involving its f->sem). */\n\tmutex_unlock(&f->sem);\n\n\tret = jffs2_do_create(c, dir_f, f, ri, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(ri->ctime));\n\n\tjffs2_free_raw_inode(ri);\n\n\tjffs2_dbg(1, \"%s(): Created ino #%lu with mode %o, nlink %d(%d). nrpages %ld\\n\",\n\t\t  __func__, inode->i_ino, inode->i_mode, inode->i_nlink,\n\t\t  f->inocache->pino_nlink, inode->i_mapping->nrpages);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\tjffs2_free_raw_inode(ri);\n\treturn ret;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns",
      "atic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns",
      "atic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns",
      "atic int jffs2_unlink (struct inode *,struct dentry *);\ns",
      "atic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns",
      "atic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns",
      "atic int jffs2_rmdir (struct inode *,struct dentry *);\ns",
      "atic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns",
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "et_failed(i",
          "args": [
            "ode);"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "instantiate(d",
          "args": [
            "ntry,",
            "ode);"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lock_new_inode(i",
          "args": [
            "ode);"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s(): Created ino #%lu with mode %o, nlink %d(%d). nrpages %ld\\n\",",
            "func__,",
            "ode->i_ino,",
            "ode->i_mode,",
            "ode->i_nlink,",
            ">inocache->pino_nlink,",
            "ode->i_mapping->nrpages);"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IME(j",
          "args": [
            "32_to_cpu(ri->ctime));"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "32_to_cpu(r",
          "args": [
            "->ctime))"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_do_create(c",
          "args": [
            "r_f,",
            ",",
            "entry->d_name);"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_ERR(i",
          "args": [
            "ode);"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_free_raw_inode(r",
          "args": [
            ");"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "ffs2_new_inode() failed\\n\");"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(i",
          "args": [
            "ode))"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_new_inode(d",
          "args": [
            "r_i,",
            "de,",
            ");"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "s()\\n\",",
            "func__);"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_SB_INFO(d",
          "args": [
            "r_i->i_sb);"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_alloc_raw_inode()",
          "args": [],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns;\natic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns;\natic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns;\natic int jffs2_unlink (struct inode *,struct dentry *);\ns;\natic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns;\natic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns;\natic int jffs2_rmdir (struct inode *,struct dentry *);\ns;\natic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns;\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic int jffs2_create(struct inode *dir_i, struct dentry *dentry,\n\t\t\tumode_t mode, bool excl)\n{\n\tstruct jffs2_raw_inode *ri;\n\tstruct jffs2_inode_info *f, *dir_f;\n\tstruct jffs2_sb_info *c;\n\tstruct inode *inode;\n\tint ret;\n\n\tri = jffs2_alloc_raw_inode();\n\tif (!ri)\n\t\treturn -ENOMEM;\n\n\tc = JFFS2_SB_INFO(dir_i->i_sb);\n\n\tjffs2_dbg(1, \"%s()\\n\", __func__);\n\n\tinode = jffs2_new_inode(dir_i, mode, ri);\n\n\tif (IS_ERR(inode)) {\n\t\tjffs2_dbg(1, \"jffs2_new_inode() failed\\n\");\n\t\tjffs2_free_raw_inode(ri);\n\t\treturn PTR_ERR(inode);\n\t}\n\n\tinode->i_op = &jffs2_file_inode_operations;\n\tinode->i_fop = &jffs2_file_operations;\n\tinode->i_mapping->a_ops = &jffs2_file_address_operations;\n\tinode->i_mapping->nrpages = 0;\n\n\tf = JFFS2_INODE_INFO(inode);\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\n\t/* jffs2_do_create() will want to lock it, _after_ reserving\n\t   space and taking c-alloc_sem. If we keep it locked here,\n\t   lockdep gets unhappy (although it's a false positive;\n\t   nothing else will be looking at this inode yet so there's\n\t   no chance of AB-BA deadlock involving its f->sem). */\n\tmutex_unlock(&f->sem);\n\n\tret = jffs2_do_create(c, dir_f, f, ri, &dentry->d_name);\n\tif (ret)\n\t\tgoto fail;\n\n\tdir_i->i_mtime = dir_i->i_ctime = ITIME(je32_to_cpu(ri->ctime));\n\n\tjffs2_free_raw_inode(ri);\n\n\tjffs2_dbg(1, \"%s(): Created ino #%lu with mode %o, nlink %d(%d). nrpages %ld\\n\",\n\t\t  __func__, inode->i_ino, inode->i_mode, inode->i_nlink,\n\t\t  f->inocache->pino_nlink, inode->i_mapping->nrpages);\n\n\tunlock_new_inode(inode);\n\td_instantiate(dentry, inode);\n\treturn 0;\n\n fail:\n\tiget_failed(inode);\n\tjffs2_free_raw_inode(ri);\n\treturn ret;\n}"
  },
  {
    "function_name": "fs2_readdir(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "118-153",
    "snippet": "atic int jffs2_readdir(struct file *file, struct dir_context *ctx)\n{\n\tstruct inode *inode = file_inode(file);\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_full_dirent *fd;\n\tunsigned long curofs = 1;\n\n\tjffs2_dbg(1, \"jffs2_readdir() for dir_i #%lu\\n\", inode->i_ino);\n\n\tif (!dir_emit_dots(file, ctx))\n\t\treturn 0;\n\n\tmutex_lock(&f->sem);\n\tfor (fd = f->dents; fd; fd = fd->next) {\n\t\tcurofs++;\n\t\t/* First loop: curofs = 2; pos = 2 */\n\t\tif (curofs < ctx->pos) {\n\t\t\tjffs2_dbg(2, \"Skipping dirent: \\\"%s\\\", ino #%u, type %d, because curofs %ld < offset %ld\\n\",\n\t\t\t\t  fd->name, fd->ino, fd->type, curofs, (unsigned long)ctx->pos);\n\t\t\tcontinue;\n\t\t}\n\t\tif (!fd->ino) {\n\t\t\tjffs2_dbg(2, \"Skipping deletion dirent \\\"%s\\\"\\n\",\n\t\t\t\t  fd->name);\n\t\t\tctx->pos++;\n\t\t\tcontinue;\n\t\t}\n\t\tjffs2_dbg(2, \"Dirent %ld: \\\"%s\\\", ino #%u, type %d\\n\",\n\t\t\t  (unsigned long)ctx->pos, fd->name, fd->ino, fd->type);\n\t\tif (!dir_emit(ctx, fd->name, strlen(fd->name), fd->ino, fd->type))\n\t\t\tbreak;\n\t\tctx->pos++;\n\t}\n\tmutex_unlock(&f->sem);\n\treturn 0;\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_readdir (struct file *, struct dir_context *);",
      "atic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns",
      "atic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns",
      "atic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns",
      "atic int jffs2_unlink (struct inode *,struct dentry *);\ns",
      "atic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns",
      "atic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns",
      "atic int jffs2_rmdir (struct inode *,struct dentry *);\ns",
      "atic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "->sem);"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_emit(c",
          "args": [
            "x,",
            "->name,",
            "rlen(fd->name),",
            "->ino,",
            "->type))"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rlen(f",
          "args": [
            "->name),"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(2",
          "args": [
            "irent %ld: \\\"%s\\\", ino #%u, type %d\\n\",",
            "nsigned long)ctx->pos,",
            "->name,",
            "->ino,",
            "->type);"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(2",
          "args": [
            "kipping deletion dirent \\\"%s\\\"\\n\",",
            "->name);"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(2",
          "args": [
            "kipping dirent: \\\"%s\\\", ino #%u, type %d, because curofs %ld < offset %ld\\n\",",
            "->name,",
            "->ino,",
            "->type,",
            "rofs,",
            "nsigned long)ctx->pos);"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "->sem);"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r_emit_dots(f",
          "args": [
            "le,",
            "x))"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "ffs2_readdir() for dir_i #%lu\\n\",",
            "ode->i_ino);"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(i",
          "args": [
            "ode);"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le_inode(f",
          "args": [
            "le);"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_readdir (struct file *, struct dir_context *);\natic int jffs2_create (struct inode *,struct dentry *,umode_t,\n\t\t\t bool);\ns;\natic struct dentry *jffs2_lookup (struct inode *,struct dentry *,\n\t\t\t\t    unsigned int);\ns;\natic int jffs2_link (struct dentry *,struct inode *,struct dentry *);\ns;\natic int jffs2_unlink (struct inode *,struct dentry *);\ns;\natic int jffs2_symlink (struct inode *,struct dentry *,const char *);\ns;\natic int jffs2_mkdir (struct inode *,struct dentry *,umode_t);\ns;\natic int jffs2_rmdir (struct inode *,struct dentry *);\ns;\natic int jffs2_mknod (struct inode *,struct dentry *,umode_t,dev_t);\ns;\n\natic int jffs2_readdir(struct file *file, struct dir_context *ctx)\n{\n\tstruct inode *inode = file_inode(file);\n\tstruct jffs2_inode_info *f = JFFS2_INODE_INFO(inode);\n\tstruct jffs2_full_dirent *fd;\n\tunsigned long curofs = 1;\n\n\tjffs2_dbg(1, \"jffs2_readdir() for dir_i #%lu\\n\", inode->i_ino);\n\n\tif (!dir_emit_dots(file, ctx))\n\t\treturn 0;\n\n\tmutex_lock(&f->sem);\n\tfor (fd = f->dents; fd; fd = fd->next) {\n\t\tcurofs++;\n\t\t/* First loop: curofs = 2; pos = 2 */\n\t\tif (curofs < ctx->pos) {\n\t\t\tjffs2_dbg(2, \"Skipping dirent: \\\"%s\\\", ino #%u, type %d, because curofs %ld < offset %ld\\n\",\n\t\t\t\t  fd->name, fd->ino, fd->type, curofs, (unsigned long)ctx->pos);\n\t\t\tcontinue;\n\t\t}\n\t\tif (!fd->ino) {\n\t\t\tjffs2_dbg(2, \"Skipping deletion dirent \\\"%s\\\"\\n\",\n\t\t\t\t  fd->name);\n\t\t\tctx->pos++;\n\t\t\tcontinue;\n\t\t}\n\t\tjffs2_dbg(2, \"Dirent %ld: \\\"%s\\\", ino #%u, type %d\\n\",\n\t\t\t  (unsigned long)ctx->pos, fd->name, fd->ino, fd->type);\n\t\tif (!dir_emit(ctx, fd->name, strlen(fd->name), fd->ino, fd->type))\n\t\t\tbreak;\n\t\tctx->pos++;\n\t}\n\tmutex_unlock(&f->sem);\n\treturn 0;\n}"
  },
  {
    "function_name": "fs2_lookup(s",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2014-9717/repo/fs/jffs2/dir.c",
    "lines": "77-113",
    "snippet": "atic struct dentry *jffs2_lookup(struct inode *dir_i, struct dentry *target,\n\t\t\t\t   unsigned int flags)\n{\n\tstruct jffs2_inode_info *dir_f;\n\tstruct jffs2_full_dirent *fd = NULL, *fd_list;\n\tuint32_t ino = 0;\n\tstruct inode *inode = NULL;\n\n\tjffs2_dbg(1, \"jffs2_lookup()\\n\");\n\n\tif (target->d_name.len > JFFS2_MAX_NAME_LEN)\n\t\treturn ERR_PTR(-ENAMETOOLONG);\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\n\tmutex_lock(&dir_f->sem);\n\n\t/* NB: The 2.2 backport will need to explicitly check for '.' and '..' here */\n\tfor (fd_list = dir_f->dents; fd_list && fd_list->nhash <= target->d_name.hash; fd_list = fd_list->next) {\n\t\tif (fd_list->nhash == target->d_name.hash &&\n\t\t    (!fd || fd_list->version > fd->version) &&\n\t\t    strlen(fd_list->name) == target->d_name.len &&\n\t\t    !strncmp(fd_list->name, target->d_name.name, target->d_name.len)) {\n\t\t\tfd = fd_list;\n\t\t}\n\t}\n\tif (fd)\n\t\tino = fd->ino;\n\tmutex_unlock(&dir_f->sem);\n\tif (ino) {\n\t\tinode = jffs2_iget(dir_i->i_sb, ino);\n\t\tif (IS_ERR(inode))\n\t\t\tpr_warn(\"iget() failed for ino #%u\\n\", ino);\n\t}\n\n\treturn d_splice_alias(inode, target);\n}",
    "includes": [
      "nclude \"nodelist.h\"\n\ns",
      "nclude <linux/time.h>\n#i",
      "nclude \"jffs2_fs_sb.h\"\n#i",
      "nclude \"jffs2_fs_i.h\"\n#i",
      "nclude <linux/jffs2.h>\n#i",
      "nclude <linux/crc32.h>\n#i",
      "nclude <linux/fs.h>\n#i",
      "nclude <linux/slab.h>\n#i",
      "nclude <linux/kernel.h>\n#i"
    ],
    "macros_used": [],
    "globals_used": [
      "atic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "splice_alias(i",
          "args": [
            "ode,",
            "rget);"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_warn(\"",
          "args": [
            "get() failed for ino #%u\\n\",",
            "o);"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_ERR(i",
          "args": [
            "ode))"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_iget(d",
          "args": [
            "r_i->i_sb,",
            "o);"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_unlock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rncmp(f",
          "args": [
            "_list->name,",
            "rget->d_name.name,",
            "rget->d_name.len))"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rlen(f",
          "args": [
            "_list->name)"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tex_lock(&",
          "args": [
            "ir_f->sem);"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FS2_INODE_INFO(d",
          "args": [
            "r_i);"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "R_PTR(-",
          "args": [
            "NAMETOOLONG);"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs2_dbg(1",
          "args": [
            "ffs2_lookup()\\n\");"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "nclude \"nodelist.h\"\n\ns\nnclude <linux/time.h>\n#i\nnclude \"jffs2_fs_sb.h\"\n#i\nnclude \"jffs2_fs_i.h\"\n#i\nnclude <linux/jffs2.h>\n#i\nnclude <linux/crc32.h>\n#i\nnclude <linux/fs.h>\n#i\nnclude <linux/slab.h>\n#i\nnclude <linux/kernel.h>\n#i\n\natic int jffs2_rename (struct inode *, struct dentry *,\n\t\t\t struct inode *, struct dentry *);\n\natic struct dentry *jffs2_lookup(struct inode *dir_i, struct dentry *target,\n\t\t\t\t   unsigned int flags)\n{\n\tstruct jffs2_inode_info *dir_f;\n\tstruct jffs2_full_dirent *fd = NULL, *fd_list;\n\tuint32_t ino = 0;\n\tstruct inode *inode = NULL;\n\n\tjffs2_dbg(1, \"jffs2_lookup()\\n\");\n\n\tif (target->d_name.len > JFFS2_MAX_NAME_LEN)\n\t\treturn ERR_PTR(-ENAMETOOLONG);\n\n\tdir_f = JFFS2_INODE_INFO(dir_i);\n\n\tmutex_lock(&dir_f->sem);\n\n\t/* NB: The 2.2 backport will need to explicitly check for '.' and '..' here */\n\tfor (fd_list = dir_f->dents; fd_list && fd_list->nhash <= target->d_name.hash; fd_list = fd_list->next) {\n\t\tif (fd_list->nhash == target->d_name.hash &&\n\t\t    (!fd || fd_list->version > fd->version) &&\n\t\t    strlen(fd_list->name) == target->d_name.len &&\n\t\t    !strncmp(fd_list->name, target->d_name.name, target->d_name.len)) {\n\t\t\tfd = fd_list;\n\t\t}\n\t}\n\tif (fd)\n\t\tino = fd->ino;\n\tmutex_unlock(&dir_f->sem);\n\tif (ino) {\n\t\tinode = jffs2_iget(dir_i->i_sb, ino);\n\t\tif (IS_ERR(inode))\n\t\t\tpr_warn(\"iget() failed for ino #%u\\n\", ino);\n\t}\n\n\treturn d_splice_alias(inode, target);\n}"
  }
]